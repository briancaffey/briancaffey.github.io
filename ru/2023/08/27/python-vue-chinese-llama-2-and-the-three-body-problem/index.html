<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Python, Vue, Chinese-LLaMA-2 and The Three-Body Problem</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Brian Caffey's personal website"><meta data-n-head="ssr" name="robots" content="noindex"><meta data-n-head="ssr" property="og:title" content="Python, Vue, Chinese-LLaMA-2 and The Three-Body Problem"><meta data-n-head="ssr" property="og:description" content="null"><meta data-n-head="ssr" property="og:image" content="https://briancaffey.github.io/img/three-body-problem/invokeai/confucius/1.png"><meta data-n-head="ssr" property="twitter:card" content="https://briancaffey.github.io/img/three-body-problem/invokeai/confucius/1.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/8d55c13.js" as="script"><link rel="preload" href="/_nuxt/8bfa011.js" as="script"><link rel="preload" href="/_nuxt/e851bee.js" as="script"><link rel="preload" href="/_nuxt/4f82569.js" as="script"><link rel="preload" href="/_nuxt/55e3c8e.js" as="script"><style data-vue-ssr-id="38dfa7e4:0 f52d43e0:0 9592d830:0 517a8dd7:0 072b2f8a:0 fa7ff0ca:0 56b15182:0 507279a1:0 14b1eaf9:0 a0fa61ae:0 68e9f29f:0 68771c59:0 23961490:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-black{--bg-opacity:1;background-color:#000;background-color:rgba(0,0,0,var(--bg-opacity))}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-red-300{--bg-opacity:1;background-color:#feb2b2;background-color:rgba(254,178,178,var(--bg-opacity))}.bg-green-100{--bg-opacity:1;background-color:#f0fff4;background-color:rgba(240,255,244,var(--bg-opacity))}.border-white{--border-opacity:1;border-color:#fff;border-color:rgba(255,255,255,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t{border-top-left-radius:.25rem;border-top-right-radius:.25rem}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border{border-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.flex-shrink{flex-shrink:1}.float-right{float:right}.font-bold{font-weight:700}.h-3{height:.75rem}.h-4{height:1rem}.h-12{height:3rem}.h-32{height:8rem}.h-64{height:16rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.text-4xl{font-size:2.25rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.m-2{margin:.5rem}.m-4{margin:1rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mb-1{margin-bottom:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.mt-8{margin-top:2rem}.mb-8{margin-bottom:2rem}.-ml-1{margin-left:-.25rem}.max-w-5xl{max-width:64rem}.max-w-6xl{max-width:72rem}.object-cover{-o-object-fit:cover;object-fit:cover}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.px-16{padding-left:4rem;padding-right:4rem}.py-32{padding-top:8rem;padding-bottom:8rem}.pt-2{padding-top:.5rem}.pb-2{padding-bottom:.5rem}.pt-4{padding-top:1rem}.pr-4{padding-right:1rem}.pb-4{padding-bottom:1rem}.pt-8{padding-top:2rem}.pb-8{padding-bottom:2rem}.pt-16{padding-top:4rem}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.resize{resize:both}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-black{--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.text-gray-500{--text-opacity:1;color:#a0aec0;color:rgba(160,174,192,var(--text-opacity))}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-red-400{--text-opacity:1;color:#fc8181;color:rgba(252,129,129,var(--text-opacity))}.text-red-600{--text-opacity:1;color:#e53e3e;color:rgba(229,62,62,var(--text-opacity))}.uppercase{text-transform:uppercase}.visible{visibility:visible}.w-3{width:.75rem}.w-4{width:1rem}.w-12{width:3rem}.w-32{width:8rem}.w-full{width:100%}.z-10{z-index:10}.gap-4{grid-gap:1rem;gap:1rem}.gap-6{grid-gap:1.5rem;gap:1.5rem}.gap-16{grid-gap:4rem;gap:4rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition-all{transition-property:all}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform}.duration-150{transition-duration:.15s}.delay-150{transition-delay:.15s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:640px){.sm\:inline{display:inline}.sm\:hidden{display:none}.sm\:p-16{padding:4rem}.sm\:px-4{padding-left:1rem;padding-right:1rem}.sm\:py-16{padding-top:4rem;padding-bottom:4rem}.sm\:w-2\/3{width:66.666667%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:768px){.md\:flex{display:flex}.md\:hidden{display:none}.md\:px-1{padding-left:.25rem;padding-right:.25rem}.md\:px-4{padding-left:1rem;padding-right:1rem}.md\:w-1\/2{width:50%}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (min-width:1024px){.lg\:px-16{padding-left:4rem;padding-right:4rem}.lg\:px-32{padding-left:8rem;padding-right:8rem}.lg\:pl-64{padding-left:16rem}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:1280px){.xl\:pb-16{padding-bottom:4rem}}:root{--color:#243746;--color-primary:#158876;--color-secondary:#0e2233;--bg:#f3f5f4;--bg-secondary:#fff;--bg-code:#ddd;--border-color:#ddd}.dark-mode{--color:#ebf4f1;--color-primary:#41b38a;--color-secondary:#fdf9f3;--bg:#091a28;--bg-secondary:#071521;--bg-code:#ddd;--border-color:#0d2538}.sepia-mode{--color:#433422;--color-primary:#504231;--color-secondary:#504231;--bg:#f1e7d0;--bg-code:#ddd;--bg-secondary:#eae0c9;--border-color:#ded0bf}body{font-family:Montserrat,Arial,Sans Serif;background-color:#f3f5f4;background-color:var(--bg);color:#243746;color:var(--color);transition:background-color .7s}a{color:#158876;color:var(--color-primary)}.py-05{padding-top:.125rem;padding-bottom:.125rem}.markdown{--text-opacity:1;color:#1a202c;color:rgba(26,32,44,var(--text-opacity));line-height:1.5;color:#0e2233;color:var(--color-secondary)}.markdown .token.operator{background:0 0}.markdown>*+*{margin-top:0;margin-bottom:1rem}.markdown li+li{margin-top:.25rem}.markdown li>p+p{margin-top:1.5rem;color:#158876;color:var(--color-primary)}.markdown img{margin:auto}.markdown a,.markdown strong{font-weight:600}.markdown strong a{font-weight:700}.markdown h1{font-size:2.25rem}.markdown h1,.markdown h2{border-color:#158876;border-color:var(--color-primary);line-height:1.25;border-bottom-width:1px;font-weight:600;margin-bottom:1rem;margin-top:1.5rem;padding-bottom:.5rem}.markdown h2{font-size:1.5rem}.markdown h3{line-height:1.375;font-size:1.125rem}.markdown h3,.markdown h4{border-color:#158876;border-color:var(--color-primary);font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown h4{line-height:1;font-size:1rem}.markdown h5{border-color:#158876;border-color:var(--color-primary)}.markdown h5,.markdown h6{line-height:1.25;font-size:.875rem;font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown blockquote,.markdown h6{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.markdown blockquote{font-size:1rem;border-left-width:4px;--border-opacity:1;border-color:#e2e8f0;border-color:rgba(226,232,240,var(--border-opacity));padding-left:1rem;padding-right:1rem;border-color:#158876;border-color:var(--color-primary)}.markdown code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.875rem;display:inline;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity));padding:.125rem .25rem;background-color:#ddd;background-color:var(--bg-code);color:#000}.markdown code,.markdown pre{--bg-opacity:1;border-radius:.25rem}.markdown pre{background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity));padding:1rem}.markdown pre code{display:block;background-color:transparent;padding:0;overflow:visible;border-radius:0;color:#000}.markdown p{margin-bottom:10px}code[class*=language-],pre[class*=language-]{background:#ddd!important;background:var(--bg-code)!important;text-shadow:none!important}.markdown ul{list-style-type:disc}.markdown ol,.markdown ul{font-size:1rem;padding-left:2rem}.markdown ol{list-style-type:decimal}.markdown kbd{font-size:.75rem;display:inline-block;border-radius:.25rem;border-width:1px;padding:.125rem .25rem;vertical-align:middle;font-weight:400;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.markdown table,td,th{font-size:1rem;border:1px solid #243746;border-color:var(--color)}.markdown table{overflow-x:scroll}.markdown td,.markdown th{border-width:1px;padding:.25rem .75rem}.markdown .highlight pre{--bg-opacity:1!important;background-color:#f7fafc!important;background-color:rgba(247,250,252,var(--bg-opacity))!important}.article-card{box-shadow:0 0 0 0 #0e2233;box-shadow:0 0 0 0 var(--color-secondary);transition:box-shadow .2s,transform .2s;height:100%}.article-card:hover{box-shadow:0 0 30px 2px #0e2233;box-shadow:0 0 30px 2px var(--color-secondary);transform:scale(1.025)}.blog-card-description,.blog-date{color:#0e2233;color:var(--color-secondary)}.blog-date{font-size:smaller}hr{background-color:#243746;background-color:var(--color);border:none;height:1px}.menu-icon{background-color:#ddd;background-color:var(--border-color)}.menu-icon,.mobile-menu{color:#243746;color:var(--color)}.mobile-menu{background-color:#fff;background-color:var(--bg-secondary)}.btn{border-radius:1;border-color:#158876;border-color:var(--color-primary)}.btn:hover{background-color:#fff;background-color:var(--bg-secondary)}.hero{border-color:#158876;border-color:var(--color-primary);color:#158876;color:var(--color-primary)}.markdown{word-wrap:break-word}.markdown h2:before,.markdown h3:before{content:" ";margin-top:-85px;pointer-events:none}.markdown h2>a,.markdown h3>a{margin-left:1.25rem}.markdown h2>a:before,.markdown h3>a:before{content:"#";font-weight:400;font-size:1.25rem;line-height:2rem;margin-left:-1.25rem;padding-right:.5rem;position:absolute;opacity:1}@media (min-width:1024px){.markdown h2>a,.markdown h3>a{margin-left:0}.markdown h2>a:before,.markdown h3>a:before{opacity:0}}.markdown h2:hover>a:before,.markdown h3:hover>a:before{opacity:1}& pre[class*=language-]{--bg-opacity:1;background-color:#2d3748;background-color:rgba(45,55,72,var(--bg-opacity));position:static}.mc{background-color:#f3f5f4;background-color:var(--bg);border-color:#158876;border-color:var(--color-primary);border-width:1px;color:#158876;color:var(--color-primary);justify-content:center;padding:5px 10px;border-radius:5px;width:100%}.mc-btn{color:#fff;color:var(--bg-secondary);background-color:#0e2233;background-color:var(--color-secondary);cursor:pointer}.page-enter-active,.page-leave-active{transition:filter 2s linear;transition:margin-top .15s,opacity .15s}.page-enter,.page-leave-to{opacity:0;margin-top:5px}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.emoji-mart,.emoji-mart *{-webkit-box-sizing:border-box;box-sizing:border-box;line-height:1.15}.emoji-mart{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;font-size:16px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;height:420px;color:#222427;border:1px solid #d9d9d9;border-radius:5px;background:#fff}.emoji-mart-emoji{padding:6px;border:none;background:0 0;-webkit-box-shadow:none;box-shadow:none}.emoji-mart-emoji span{display:inline-block}.emoji-mart-preview-emoji .emoji-mart-emoji span{width:38px;height:38px;font-size:32px}.emoji-type-native{font-family:"Segoe UI Emoji","Segoe UI Symbol","Segoe UI","Apple Color Emoji","Twemoji Mozilla","Noto Color Emoji","EmojiOne Color","Android Emoji";word-break:keep-all}.emoji-type-image{background-size:5700%}.emoji-type-image.emoji-set-apple{background-image:url(https://unpkg.com/emoji-datasource-apple@6.0.1/img/apple/sheets-256/64.png)}.emoji-type-image.emoji-set-facebook{background-image:url(https://unpkg.com/emoji-datasource-facebook@6.0.1/img/facebook/sheets-256/64.png)}.emoji-type-image.emoji-set-google{background-image:url(https://unpkg.com/emoji-datasource-google@6.0.1/img/google/sheets-256/64.png)}.emoji-type-image.emoji-set-twitter{background-image:url(https://unpkg.com/emoji-datasource-twitter@6.0.1/img/twitter/sheets-256/64.png)}.emoji-mart-bar{border:0 solid #d9d9d9}.emoji-mart-bar:first-child{border-bottom-width:1px;border-top-left-radius:5px;border-top-right-radius:5px}.emoji-mart-bar:last-child{border-top-width:1px;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.emoji-mart-scroll{position:relative;overflow-y:scroll;-webkit-box-flex:1;-ms-flex:1;flex:1;padding:0 6px 6px;z-index:0;will-change:transform;-webkit-overflow-scrolling:touch}.emoji-mart-anchors{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding:0 6px;color:#858585;line-height:0}.emoji-mart-anchor{position:relative;display:block;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;text-align:center;padding:12px 4px;overflow:hidden;-webkit-transition:color .1s ease-out;-o-transition:color .1s ease-out;transition:color .1s ease-out;border:none;background:0 0;-webkit-box-shadow:none;box-shadow:none}.emoji-mart-anchor-selected,.emoji-mart-anchor:hover{color:#464646}.emoji-mart-anchor-selected .emoji-mart-anchor-bar{bottom:0}.emoji-mart-anchor-bar{position:absolute;bottom:-3px;left:0;width:100%;height:3px;background-color:#464646}.emoji-mart-anchors i{display:inline-block;width:100%;max-width:22px}.emoji-mart-anchors svg{fill:currentColor;max-height:18px}.emoji-mart .scroller{height:250px;position:relative;-webkit-box-flex:1;-ms-flex:1;flex:1;padding:0 6px 6px;z-index:0;will-change:transform;-webkit-overflow-scrolling:touch}.emoji-mart-search{margin-top:6px;padding:0 6px}.emoji-mart-search input{font-size:16px;display:block;width:100%;padding:.2em .6em;border-radius:25px;border:1px solid #d9d9d9;outline:0}.emoji-mart-search-results{height:250px;overflow-y:scroll}.emoji-mart-category{position:relative}.emoji-mart-category .emoji-mart-emoji span{z-index:1;position:relative;text-align:center;cursor:default}.emoji-mart-category .emoji-mart-emoji:hover:before,.emoji-mart-emoji-selected:before{z-index:0;content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#f4f4f4;border-radius:100%;opacity:0;opacity:1}.emoji-mart-category-label{position:-webkit-sticky;position:sticky;top:0}.emoji-mart-static .emoji-mart-category-label{z-index:2;position:relative}.emoji-mart-category-label h3{display:block;font-size:16px;width:100%;font-weight:500;padding:5px 6px;background-color:#fff;background-color:hsla(0,0%,100%,.95)}.emoji-mart-emoji{position:relative;display:inline-block;font-size:0}.emoji-mart-no-results{font-size:14px;text-align:center;padding-top:70px;color:#858585}.emoji-mart-no-results .emoji-mart-category-label{display:none}.emoji-mart-no-results .emoji-mart-no-results-label{margin-top:.2em}.emoji-mart-no-results .emoji-mart-emoji:hover:before{content:none}.emoji-mart-preview{position:relative;height:70px}.emoji-mart-preview-data,.emoji-mart-preview-emoji,.emoji-mart-preview-skins{position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%)}.emoji-mart-preview-emoji{left:12px}.emoji-mart-preview-data{left:68px;right:12px;word-break:break-all}.emoji-mart-preview-skins{right:30px;text-align:right}.emoji-mart-preview-name{font-size:14px}.emoji-mart-preview-shortname{font-size:12px;color:#888}.emoji-mart-preview-emoticon+.emoji-mart-preview-emoticon,.emoji-mart-preview-shortname+.emoji-mart-preview-emoticon,.emoji-mart-preview-shortname+.emoji-mart-preview-shortname{margin-left:.5em}.emoji-mart-preview-emoticon{font-size:11px;color:#bbb}.emoji-mart-title span{display:inline-block;vertical-align:middle}.emoji-mart-title .emoji-mart-emoji{padding:0}.emoji-mart-title-label{color:#999a9c;font-size:21px;font-weight:300}.emoji-mart-skin-swatches{font-size:0;padding:2px 0;border:1px solid #d9d9d9;border-radius:12px;background-color:#fff}.emoji-mart-skin-swatches-opened .emoji-mart-skin-swatch{width:16px;padding:0 2px}.emoji-mart-skin-swatches-opened .emoji-mart-skin-swatch-selected:after{opacity:.75}.emoji-mart-skin-swatch{display:inline-block;width:0;vertical-align:middle;-webkit-transition-property:width,padding;-o-transition-property:width,padding;transition-property:width,padding;-webkit-transition-duration:.125s;-o-transition-duration:.125s;transition-duration:.125s;-webkit-transition-timing-function:ease-out;-o-transition-timing-function:ease-out;transition-timing-function:ease-out}.emoji-mart-skin-swatch:first-child{-webkit-transition-delay:0s;-o-transition-delay:0s;transition-delay:0s}.emoji-mart-skin-swatch:nth-child(2){-webkit-transition-delay:.03s;-o-transition-delay:.03s;transition-delay:.03s}.emoji-mart-skin-swatch:nth-child(3){-webkit-transition-delay:.06s;-o-transition-delay:.06s;transition-delay:.06s}.emoji-mart-skin-swatch:nth-child(4){-webkit-transition-delay:.09s;-o-transition-delay:.09s;transition-delay:.09s}.emoji-mart-skin-swatch:nth-child(5){-webkit-transition-delay:.12s;-o-transition-delay:.12s;transition-delay:.12s}.emoji-mart-skin-swatch:nth-child(6){-webkit-transition-delay:.15s;-o-transition-delay:.15s;transition-delay:.15s}.emoji-mart-skin-swatch-selected{position:relative;width:16px;padding:0 2px}.emoji-mart-skin-swatch-selected:after{content:"";position:absolute;top:50%;left:50%;width:4px;height:4px;margin:-2px 0 0 -2px;background-color:#fff;border-radius:100%;pointer-events:none;opacity:0;-webkit-transition:opacity .2s ease-out;-o-transition:opacity .2s ease-out;transition:opacity .2s ease-out}.emoji-mart-skin{display:inline-block;width:100%;padding-top:100%;max-width:12px;border-radius:100%}.emoji-mart-skin-tone-1{background-color:#ffc93a}.emoji-mart-skin-tone-2{background-color:#fadcbc}.emoji-mart-skin-tone-3{background-color:#e0bb95}.emoji-mart-skin-tone-4{background-color:#bf8f68}.emoji-mart-skin-tone-5{background-color:#9b643d}.emoji-mart-skin-tone-6{background-color:#594539}.emoji-mart .vue-recycle-scroller{position:relative}.emoji-mart .vue-recycle-scroller.direction-vertical:not(.page-mode){overflow-y:auto}.emoji-mart .vue-recycle-scroller.direction-horizontal:not(.page-mode){overflow-x:auto}.emoji-mart .vue-recycle-scroller.direction-horizontal{display:-webkit-box;display:-ms-flexbox;display:flex}.emoji-mart .vue-recycle-scroller__slot{-webkit-box-flex:1;-ms-flex:auto 0 0px;flex:auto 0 0}.emoji-mart .vue-recycle-scroller__item-wrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;position:relative}.emoji-mart .vue-recycle-scroller.ready .vue-recycle-scroller__item-view{position:absolute;top:0;left:0;will-change:transform}.emoji-mart .vue-recycle-scroller.direction-vertical .vue-recycle-scroller__item-wrapper{width:100%}.emoji-mart .vue-recycle-scroller.direction-horizontal .vue-recycle-scroller__item-wrapper{height:100%}.emoji-mart .vue-recycle-scroller.ready.direction-vertical .vue-recycle-scroller__item-view{width:100%}.emoji-mart .vue-recycle-scroller.ready.direction-horizontal .vue-recycle-scroller__item-view{height:100%}.emoji-mart .resize-observer[data-v-b329ee4c]{border:none;background-color:transparent;opacity:0}.emoji-mart .resize-observer[data-v-b329ee4c],.emoji-mart .resize-observer[data-v-b329ee4c] object{position:absolute;top:0;left:0;z-index:-1;width:100%;height:100%;pointer-events:none;display:block;overflow:hidden}.emoji-mart-search .hidden{display:none;visibility:hidden}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:Montserrat,Arial,Sans Serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}span.emoji-mart-emoji[data-v-913fe8d6]{padding:0}.selected[data-v-913fe8d6]{text-shadow:.25px 0 0 #000}.picker[data-v-913fe8d6]{position:absolute;top:10px;margin-left:auto;margin-right:auto;transform:translate(50%,50%)}.top[data-v-913fe8d6]{width:100%;background-color:var(--color-primary);height:3px}.selected[data-v-107ae01e]{text-shadow:.9px 0 0}span.emoji-mart-emoji[data-v-288717a6]{padding:0;transition:transform .2s}span.emoji-mart-emoji[data-v-288717a6]:hover{transform:scale(1.3)}.centered[data-v-288717a6]{position:absolute;left:50vw;right:50vw;margin-left:auto;margin-right:auto}span.emoji-mart-emoji[data-v-40f34933]{padding:0;transition:transform .2s}span.emoji-mart-emoji[data-v-40f34933]:hover{transform:scale(1.3)}.modal[data-v-40f34933]{z-index:100000000;top:0;-webkit-backdrop-filter:blur(.4px);backdrop-filter:blur(.4px);background-color:rgba(0,0,0,.2)}.modal[data-v-40f34933],.picker[data-v-40f34933]{position:absolute;left:0}.picker[data-v-40f34933]{z-index:10000000000;right:0;margin-left:auto;margin-right:auto}.tag[data-v-d8ade784]{background-color:var(--color-primary);transition:transform .2s}.tag[data-v-d8ade784]:hover{transform:scale(1.05)}</style><link rel="preload" href="/_nuxt/static/1693367994/ru/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem/state.js" as="script"><link rel="preload" href="/_nuxt/static/1693367994/ru/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1693367994/manifest.js" as="script">
  </head>
  <body>
    <script data-n-head="ssr" data-hid="nuxt-color-mode-script" data-pbody="true">!function(){"use strict";var t=window,r=document,s=r.documentElement,n=["dark","light"],e=function(){for(var e="nuxt-color-mode=",t=r.cookie.split(";"),s=0;s<t.length;s++){for(var n=t[s];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null}()||"system",a="system"===e?l():e;function c(e){e+="-mode";s.classList?s.classList.add(e):s.className+=" "+e}function o(e){return t.matchMedia("(prefers-color-scheme"+e+")")}function l(){if(t.matchMedia&&"not all"!==o("").media)for(var e of n)if(o(":"+e).matches)return e;return"light"}c(a),t.__NUXT_COLOR_MODE__={preference:e,value:a,getColorScheme:l,addClass:c,removeClass:function(e){e+="-mode";s.classList?s.classList.remove(e):s.className=s.className.replace(new RegExp(e,"g"),"")}}}()</script><div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div data-v-913fe8d6><div class="mx-auto flex py-2 px-2 sm:px-4 items-center max-w-6xl justify-center" data-v-913fe8d6><div class="justify-left flex-grow flex-cols-4" data-v-913fe8d6><a href="/ru" class="text-xl nuxt-link-active" data-v-913fe8d6><span class="hidden sm:inline text-2xl" data-v-913fe8d6>–ë–æ—è–Ω –ö–∞—Ñ—Ñ–∏</span><span class="inline sm:hidden" data-v-913fe8d6>JBC</span></a></div> <div class="flex-grow relative" data-v-913fe8d6><nav z-index="10000" data-v-107ae01e data-v-913fe8d6><div data-v-107ae01e><ul class="items-right float-right hidden md:flex" data-v-107ae01e><li class="px-4 text-lg" data-v-107ae01e><a href="/ru/blog/1" data-v-107ae01e>
          –±–ª–æ–≥
        </a></li> <li class="px-4 text-lg" data-v-107ae01e><a href="/ru/projects" data-v-107ae01e>
          –ü—Ä–æ–µ–∫—Ç—ã
        </a></li> <li class="px-4 text-lg" data-v-107ae01e><a href="/ru/contact" data-v-107ae01e>
          –∫–æ–Ω—Ç–∞–∫—Ç
        </a></li></ul> <div class="flex justify-end md:hidden z-1000" data-v-107ae01e><button class="flex items-center px-3 py-2 border rounded menu-icon" data-v-107ae01e><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="fill-current h-3 w-3" data-v-107ae01e><title data-v-107ae01e>Menu</title> <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" data-v-107ae01e></path></svg></button></div> <!----></div></nav></div></div> <div class="picker" data-v-913fe8d6><div class="centered" data-v-288717a6 data-v-913fe8d6><div class="grid items-center justify-center" data-v-288717a6><ul class="flex px-4" data-v-288717a6><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="üñ•Ô∏è, desktop_computer" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:52.63% 12.28%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="üåû, sun_with_face" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:8.77% 77.19%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="üåö, new_moon_with_face" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:8.77% 70.18%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="‚òï, coffee" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:94.74% 8.77%;width:32px;height:32px"></span></span></li> <li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><div data-v-40f34933 data-v-288717a6><!----> <ul data-v-40f34933><li class="md:px-1 px-1 cursor-pointer" data-v-40f34933><span aria-label="üá∑üá∫, ru, flag-ru" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:5.26% 92.98%;width:32px;height:32px"></span></span></li></ul> <div class="rounded-md z-10 picker" data-v-40f34933><div class="bg-white shadow-md rounded px-4 py-2 w-32 text" style="display:none" data-v-40f34933><a href="/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" data-v-40f34933><span aria-label="üá∫üá∏, us, flag-us" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:7.02% 68.42%;width:16px;height:16px"></span></span> English <br data-v-40f34933></a><a href="/fr/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" data-v-40f34933><span aria-label="üá´üá∑, fr, flag-fr" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:1.75% 91.23%;width:16px;height:16px"></span></span> Fran√ßais <br data-v-40f34933></a><a href="/zh/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" data-v-40f34933><span aria-label="üá®üá≥, cn, flag-cn" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:1.75% 36.84%;width:16px;height:16px"></span></span> ÁÆÄ‰Ωì‰∏≠Êñá <br data-v-40f34933></a><a href="/ru/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" aria-current="page" class="nuxt-link-exact-active nuxt-link-active" data-v-40f34933><span aria-label="üá∑üá∫, ru, flag-ru" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:5.26% 92.98%;width:16px;height:16px"></span></span> –†—É—Å—Å–∫–∏–π <br data-v-40f34933></a><a href="/jp/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" data-v-40f34933><span aria-label="üáØüáµ, jp, flag-jp" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:3.51% 59.65%;width:16px;height:16px"></span></span> Êó•Êú¨Ë™û <br data-v-40f34933></a><a href="/in/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem" data-v-40f34933><span aria-label="üáÆüá≥, flag-in" class="emoji-mart-emoji" data-v-40f34933><span class="emoji-set-apple emoji-type-image" style="background-position:3.51% 43.86%;width:16px;height:16px"></span></span> ‡§π‡§ø‡§Ç‡§¶‡•Ä <br data-v-40f34933></a></div></div></div></li></ul></div></div></div></div> <article data-v-07b74c72><img src="/img/three-body-problem/invokeai/confucius/1.png" class="pt-2 w-full object-cover cover-image" style="height:24rem" data-v-07b74c72> <div class="mx-auto max-w-5xl px-2 sm:px-4 md:px-4 lg:px-16 mt-2" data-v-07b74c72><h1 class="prose text-4xl leading-9 py-4 font-bold" data-v-07b74c72>
      Python, Vue, Chinese-LLaMA-2 and The Three-Body Problem
    </h1> <div class="flex flex-wrap -ml-1 py-2" data-v-21780fb6 data-v-07b74c72><a href="/ru/blog/tags/three-body-problem" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    three-body-problem üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/llama" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    llama üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/llm" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    llm üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/ai" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    ai üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/chinese" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    chinese üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/python" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    python üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/nvidia" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    nvidia üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/cuda" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    cuda üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/gpu" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    gpu üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/stable-diffusion" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    stable-diffusion üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/langchain" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    langchain üè∑Ô∏è
    <!----></div></a><a href="/ru/blog/tags/vue" data-v-d8ade784 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-d8ade784>
    vue üè∑Ô∏è
    <!----></div></a></div> <!----> <p class="blog-date text-gray-500 mb-4" data-v-07b74c72>
      –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 
      17 –∏—é–Ω—è 2023 –≥.
    </p> <div class="p-4 my-4 bg-red-300 rounded" data-v-07b74c72><p data-v-07b74c72><strong data-v-07b74c72>
          ‚ö†Ô∏è This article is a draft and is not yet complete. ‚ö†Ô∏è
        </strong></p></div> <div class="markdown nuxt-content" data-v-07b74c72 data-v-07b74c72><h1 id="tldr" data-v-07b74c72 data-v-07b74c72><a href="#tldr" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>tl;dr</h1>
<p data-v-07b74c72 data-v-07b74c72>This articles brings together several of my interest, both old and new:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>The Chinese Sci-Fi book series 'Three-Body Problem'</li>
<li data-v-07b74c72 data-v-07b74c72>Chinese language</li>
<li data-v-07b74c72 data-v-07b74c72>NLP techniques</li>
<li data-v-07b74c72 data-v-07b74c72>AI</li>
<li data-v-07b74c72 data-v-07b74c72>Large Language Models (LLMs)</li>
<li data-v-07b74c72 data-v-07b74c72>Stable Diffusion</li>
<li data-v-07b74c72 data-v-07b74c72>Data visualization and 3D graphics</li>
<li data-v-07b74c72 data-v-07b74c72>Mathematics</li>
<li data-v-07b74c72 data-v-07b74c72>NVIDIA / CUDA</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>I translated 'The Three-Body Problem' into English using Meta's LLaMa 2, <code data-v-07b74c72 data-v-07b74c72>llama.cpp</code>, <code data-v-07b74c72 data-v-07b74c72>llama-cpp-python</code> and the <a href="https://huggingface.co/ziqingyang/chinese-llama-2-7b" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>Chinese-LLaMa-2</code> model from Hugging Face</a>. I implemented a basic Retrieval Augmented Generated (RAG) program using LangChain with a local vector database that allowed me to ask the LLM questions about the book. To visualize scenes from the book I wrote prompts for Stable Diffusion. Finally, I dipped my toes into nbody simulations with both CuPy (Python library for CUDA) and Three.js. This article will walk through code samples and give more background on the tools, libraries and languages used.</p>
<p data-v-07b74c72 data-v-07b74c72>When discussing particulars of the Three Body novel series, I will add the emoji for the Chinese character for "secret" „äôÔ∏è (Áßò).</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>The "„äô" emote, also known as the "Chinese Character" emote, is a symbol used in Japanese culture to indicate secrecy or confidentiality. It is derived from the Chinese character "Áßò" (m√¨), which means "secret." In online communication, it is often used to suggest that something should be kept private or not discussed openly.</p>
</blockquote>
<h2 id="back-story" data-v-07b74c72 data-v-07b74c72><a href="#back-story" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Back story</h2>
<p data-v-07b74c72 data-v-07b74c72>About a month ago my company announced that another round of layoffs was coming the following week. I'm on an engineering team that had already been impacted by two rounds of layoffs in the past year, and I was fully expecting to be let go this time. In an impulse-buy I ordered a book at the top of my reading list from Amazon: "The Three-Body Problem". It is a Sci-Fi trilogy written by Liu Cixin, a Chinese computer engineer who started writing the book as a series of essays that were published in China's "World of Sci-Fi" publication. I bought the original trilogy of books written in Chinese as well as the English translation, six books in total.</p>
<p data-v-07b74c72 data-v-07b74c72><img alt="Images of Three Body Problem Book Series" src="/img/three-body-problem/books.png" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72>I started learning Chinese in college, adding a major in Chinese Language to the mathematics major I decided on in my sophomore year. I did an exchange program through my college with Fudan University, a top Chinese University. In 2007, living and studying Chinese in Shanghai as a 19 year old American was a really fun time. I was placed in an advanced-level course with a diverse group of students where English was not the lowest common linguistic denominator. We had a demanding cirriculum that emphasized reading, listening and speaking Chinese. Alcohol, food and partying was an effective catalyst for absorbing the Chinese language. I also took a course on Differential Equations with my college's mathematics department chair who was on sebatical at Fudan during the same time.</p>
<p data-v-07b74c72 data-v-07b74c72><img alt="3-6-9 drinking game rules" src="/img/three-body-problem/3-6-9.jpeg" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72>My favorite memory of that semester at Fudan was travelling on an epic over-night sleeper train from Shanghai to Guangxi province with a school-sponsored class trip to see Guilin. Multiple games of sam-yuk-gu (3-6-9) ran in parallel across the matrix of 3-by-2 sleeper car bunk beds like workloads distributed across multiple GPU cores. The rules of 3-6-9 are simple: sit in a circle counting up from 1. If your number contains a 3, 6 or 9, you clap once for each occurance of the number your hands instead of saying your number. The first person to break the rules takes a drink. Our volume level swelled to a fever pitch as the drinking games created a feedback loop that rapidly diminished our alcohol supply. Everyone passed out later in the evening as the train pushed forward through the night. The next morning we all boarded a river cruise in a daze to see Guilin's stunning limestone peaks:</p>
<p data-v-07b74c72 data-v-07b74c72><img alt="20 yuan note with Guilin rock formations" src="/img/three-body-problem/20_yuan_note.jpeg" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72>After college, my second job took me back to China where I specialized in the technologies, policies and applications of large scale battery storage systems for use in renewable energy projects. I worked for a man in Beijing who founded China's energy storage industry association after pioneering the commercialization of vinadium redox flow batteries for renewable energy projects. The job exposed me to exciting battery projects all over China, and also sharpened my technical Chinese skills as I was frequently reading, translating and intepreting in a bi-linguagl, hi-tech environment. At one of the annual industry conferences our organization hosted, I had the opportunity to be an interpreter for a conversation between American battery entrepreurs and representative from China's State Grid. State Grid is China's state-owned power utility and was the world's 3rd largest company by revenue in 2022 behind Walmart and Amazon.</p>
<p data-v-07b74c72 data-v-07b74c72><img alt="State Grid HQ in Xi Cheng" src="/img/three-body-problem/invokeai/castles.png" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72>My first introduction to the 'Three-Body' book came from one of my very best friends from college. He lived at the inner-most leaf-node of one of Beijing's more labrythnian hutongs next to a family that raised and trained pigeons. Visiting my friend where he lived often involved exchanges with his pigeon master neighbor in the narrow alleys of their corner of the hutong. In one such exchange the neighbor quipped to me with a croaking voice: ‰ªñÊÄï‰Ω†Áê¥ÔºÅ, or "he's afraid of your guitar!". The pigeons cooing at my were apparently fearful of the backpack case for my classical guitar which extended over my head by about a foot, an unwelcomed advance into their roost! This simple pleasentry became a refrain that echoed every time we joked about life in the hutong. My friend and I bonded over Chinese language, classical guitar among many other things. I strongly considered his recommendation to check out ‰∏â‰Ωì (Three Body), the Chinese Sci-Fi novel about alien life in a solar system with three stars as he described it, but with already lots going on in Beijing I never had the chance to check out the book.</p>
<hr data-v-07b74c72 data-v-07b74c72>
<iframe width="100%" height="315" src="https://www.youtube.com/embed/5lj99Uz1d50?si=TwrypbY4vTfeWGRf" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen data-v-07b74c72 data-v-07b74c72></iframe>
<p data-v-07b74c72 data-v-07b74c72>Almost 10 years later I came across across a preview for the Netflix production of "3 Body Problem" scheduled to come out in early 2024. With the possibility of loosing my job weighing heavily on me, I picked up the books on Amazon on an impulse buy hoping to have something to do if I was layed off this time. I ended up reading the first book on my Kindle. Reading Chinese on the kindle is nice because your can use built in dictionaries and Google translate for looking up difficult passages with just a few taps on the Kindle or Kindle iPad app.</p>
<p data-v-07b74c72 data-v-07b74c72>Even though these look ups are simple, it can still be a distraction to have to do lots of look ups for certain chapters or passages that were hard to follow without doing so. I got the idea to build a simple online reader with built-in translation of each word. I scraped the Chinese text of the book from an online Â±±ÂØ®Áâà (a term from Shen Zhen--the heart of China's electronics industry--which referes to an unofficial version of something, a copy-cat or knock-off). This online version of the book contains some simple watermarks that I was able to remove, and I noticed that some words are rarely replaced with incorrect synonym characters, for examlpe:</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>Âç±Èô© would be written Âç±ËÑ∏, this jumped out at me as an obvious intentional typo. The first character of the word "dangerous" Âç± is the same, but in the second character, the phonetic component on the right side of the character is the same (‰Ω•), but the left side is replaced with another radical Êúà Ôºàüà∑Ô∏èÔºâ which means moon or flesh, making the meaning of the character ËÑ∏ "face", not danger or Èô©.</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>For the most part the text from the website seemed to be a faithful reproduction of the book. I found two open source projects that could be use to parse text and translate words:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>CC-CEDICT
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>an open-source Chinese->English dictionary</li>
<li data-v-07b74c72 data-v-07b74c72><a href="https://www.mdbg.net/chinese/dictionary?page=cedict" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>https://www.mdbg.net/chinese/dictionary?page=cedict</a></li>
</ul>
</li>
<li data-v-07b74c72 data-v-07b74c72>Chinese Natural Language Processing (spaCy) (NTNU)
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72><a href="https://alvinntnu.github.io/python-notes/nlp/nlp-spacy-zh.html" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>https://alvinntnu.github.io/python-notes/nlp/nlp-spacy-zh.html</a></li>
</ul>
</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>The spaCy tool parses words which in Chinese are typically two characters long, and sometimes three or four characters in length. The Chinese -> English dictionary contains tranlsations both for both individual Chinese characters and multiple character words. I wrote some Python scripts to loop over each paragraph of each chapter of each book and parse then Chinese words and look up definitions from them in the Chinese dictonary with over 150K entries. I saved each chapter as a file containing the parsed text and definitions as well as pinyin. I also added the frequency rank for each character to visualize the "difficulty" of reading certain passages. The darker the background of an individual character, the less frequent the character occurs in written Chinese. Hovering over a word you can see the meaning of an individual character as well as the word or "linguistic token" that the NLP software parsed.</p>
<p data-v-07b74c72 data-v-07b74c72>I built a simple UI to parse and display the text and related "metadata" using Vue, a popular library that rival the dominant UI framework that Facebook, now Meta, is famous for open sourcing. I love Vue's simple API and have had a lot of luck getting it to do what I want it to do.</p>
<p data-v-07b74c72 data-v-07b74c72>I'm also a big fan of Vue's author and BDFL, Evan You. His chinese name is Â∞§Èõ®Ê∫™ ÔºàYou YuXiÔºâ. The word "You" in Chinese is pronounced "yo" as in "yo-yo", but Evan seems to have adopted the pronciation "you" as in "you and me" which in Chinese pinyin would actually be "yu". Chinese and English in my experience are totally butchered. For example my name is "Brian" but it is more than not misspelled as "Brain" but native Chinese speakers. ü§∑‚Äç‚ôÇÔ∏è So I typically adopt the phonetic translation of Brian: Â∏ÉËé±ÊÅ© (Bu Lai En) or Â∞èÂ∏É (Little Bu).</p>
<p data-v-07b74c72 data-v-07b74c72>Here are some quick facts about the first book in the series:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>36 chapters in the book</li>
<li data-v-07b74c72 data-v-07b74c72>188380 total charactes in the book</li>
<li data-v-07b74c72 data-v-07b74c72>average of 69.78 chapters per paragraph</li>
<li data-v-07b74c72 data-v-07b74c72>2859 unique characters in the book (TODO: look this up)</li>
<li data-v-07b74c72 data-v-07b74c72>total of 2512 in the book</li>
<li data-v-07b74c72 data-v-07b74c72>average of 74.99 characters per paragraph</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72><img alt="Character Frequency" src="/img/three-body-problem/char_freq.png" data-v-07b74c72 data-v-07b74c72></p>
<div class="wrap" data-v-07b74c72 data-v-07b74c72>
<iframe class="p-4" src="https://briancaffey.github.io/three-body-problem/freq/" width="100%" height="550" data-v-07b74c72 data-v-07b74c72></iframe>
</div>
<h2 id="llms-metas-llama-2-and-chinese-llama-2" data-v-07b74c72 data-v-07b74c72><a href="#llms-metas-llama-2-and-chinese-llama-2" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>LLMs, Meta's LLaMA 2 and Chinese-LLaMA-2</h2>
<p data-v-07b74c72 data-v-07b74c72>In recent months I have been following the development of some interesting open source AI projects. Two projects in particular are InvokeAI, an image generation tool based on stable diffusion, and <a href="https://ai.meta.com/llama/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>LLaMA 2</a>, the next generation of Meta's open source large language model (LLM). The casing of the word <code data-v-07b74c72 data-v-07b74c72>LLaMA</code> indicates that LLaMa 2 takes its name from the acronym LLM (Large Language Model), which is a general term for the technology that underpins the massively popular ChatGPT from OpenAI. LLMs are so hot right now. Before going deeper into LLMs we need a quick Chinese lesson.</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>ËçâÊ≥•È©¨ is a non-technical word that referes to animals like Llama or Alpaca. It can be directly translated as "Grass Mud Horse" it is phonetically similar to the most common Chinese profanity: Êìç‰Ω†Â¶à, which literally means "fuck your mother". The characters in the two words are nearly synonymous: the sounds of both words are "cao ni ma", but the tones are different, which in Chinese changes the meaning completely. In English this would be like two words spelled the same way that have emphsis placed on different syllables. The llama is basically a legendary Chinese internet meme subversive in the face of Chinese censorship. ü¶ô was approved as part of Unicode 11.0 in 2018.</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>There's a lot more to say about the significance of the Llama in Chinese internet culture, have a look at <a href="https://en.wikipedia.org/wiki/Grass_Mud_Horse" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>the Wikipedia article on <strong data-v-07b74c72 data-v-07b74c72>Grass Mud Horse</strong></a> if you want to go deeper. I think it is safe to assume that the naming of LLaMa has something to do with Facebook/Meta's hacker mentality and the large number of Chinese people working on AI at Meta. This mostly likely is OK with Mark Z now since <a href="https://www.voanews.com/a/silicon-valley-technology_how-facebooks-zuckerberg-went-courting-criticizing-beijing/6195455.html" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>his attitude toward China has changed</a> in the last few years from one of courtship to one of criticism.</p>
<p data-v-07b74c72 data-v-07b74c72>I requested access to Meta's LLaMa 2 models as soon as they came out and was able to get the models to run on my computer. I have an I9-13900K CPU and an NVIDIA 4090 graphics card which I was able to get a hold of in Febrauary after resellers had made these cards almost impossible to buy from major retailers. I also started lurking in a subreddit called <a href="https://www.reddit.com/r/LocalLLaMA/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>r/LocalLLaMa</code></a> with over fifty thousand members. The forum has a lot of helpful information about running Large Language Models on computer hardware like mine which is most commonly used play computer games. Another annoucement that caught my attention in July was the release of <a href="https://github.com/ymcui/Chinese-LLaMA-Alpaca-2" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Chinese LLaMa 2</a>, a Large Language Model trained on Chinese and English which does very well against Chinese Language Benchmarks.</p>
<p data-v-07b74c72 data-v-07b74c72><img alt="image of Chinese LLaMa 2" src="/img/three-body-problem/chinese_llama_2.png" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72><a href="https://github.com/haonan-li/CMMLU" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>https://github.com/haonan-li/CMMLU</a></p>
<p data-v-07b74c72 data-v-07b74c72><img alt="image of CMMLU" src="/img/three-body-problem/cmmlu.jpeg" data-v-07b74c72 data-v-07b74c72></p>
<h2 id="translation" data-v-07b74c72 data-v-07b74c72><a href="#translation" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Translation</h2>
<p data-v-07b74c72 data-v-07b74c72>„äôÔ∏è From the documents of the the Red Coast Base we learn about the plans to develop a universal language based on math and physics that can be understood by any sufficiently advanced civilization. There is also a plan to build a full linguistic system on top of this universal language which effectively allows for communication with alien civilizations in Chinese and Esperanto.</p>
<p data-v-07b74c72 data-v-07b74c72>The books idea of universal translation made me think a lot about LLMs that are so popular today. In essence they are calculators for words. When you feed a prompt to an LLM, it first puts the prompt through a process called tokenization. Tokenization takes a string of text and breaks it down into tokens (defined by the Large Language Model you are using). These tokens are numbers. Here's an example of tokenization in action:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> json
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> os
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> llama_cpp <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> Llama<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> LlamaTokenizer

llm <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Llama<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
    model_path<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>"/path/to/models/ggml-model-q4_0.bin"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    n_ctx<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>4096</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    n_gpu_layers<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>30</span>
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

tokenizer <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> LlamaTokenizer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>llama<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>llm<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

TEXT<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>"Âú®ÈÇ£‰∏™Â∑≤Ë¢´ÂøòÂç¥ÁöÑÊó•Â≠êÈáåÔºåÂÆÉÁöÑ‰∏ñÁïåÈ¢†Ë¶Ü‰∫Ü„ÄÇÊ≥•ÂúüÈ£ûËµ∞ÔºåÂá∫Áé∞‰∫Ü‰∏ÄÊù°ÂèàÊ∑±ÂèàÂÆΩÁöÑÂ≥°Ë∞∑ÔºåÁÑ∂ÂêéÊ≥•ÂúüÂèàËΩ∞ÈöÜÈöÜÂú∞È£ûÂõûÊù•ÔºåÂ≥°Ë∞∑Ê∂àÂ§±‰∫ÜÔºåÂú®ÂéüÊù•Â≥°Ë∞∑ÁöÑÂ∞ΩÂ§¥Âá∫Áé∞‰∫Ü‰∏ÄÂ∫ßÈªëËâ≤ÁöÑÂ≠§Â≥∞„ÄÇÂÖ∂ÂÆûÔºåÂú®ËøôÁâáÂπøÈòîÁöÑÁñÜÂüü‰∏äÔºåËøôÁßç‰∫ãÂ∏∏Â∏∏ÂèëÁîüÔºåÊ≥•ÂúüÈ£ûËµ∞ÂèàÈ£ûÂõûÔºåÂ≥°Ë∞∑Âá∫Áé∞ÂèàÊ∂àÂ§±ÔºåÁÑ∂ÂêéÊòØÂ≠§Â≥∞Èôç‰∏¥ÔºåÂ•ΩÂÉèÊòØÁªôÊØèÊ¨°ÁÅæÂèòÊâì‰∏ä‰∏Ä‰∏™ÈÜíÁõÆÁöÑÊ†áËÆ∞„ÄÇË§êËöÅÂíåÂá†Áôæ‰∏™ÂêåÊóèÂ∏¶ÁùÄÂπ∏Â≠òÁöÑËöÅÂêéÂêëÂ§™Èò≥ËêΩ‰∏ãÁöÑÊñπÂêëËµ∞‰∫Ü‰∏ÄÊÆµË∑ØÔºåÂª∫Á´ã‰∫ÜÊñ∞ÁöÑÂ∏ùÂõΩ„ÄÇ"</span>
tokens <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> tokenizer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>encode<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>TEXT<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>print(str(tokens[:4]) + " ...")
</code></pre></div>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>[1, 30505, 32380, 36812] ...</p>
</blockquote>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>for token in tokens:
    text = tokenizer.decode([token])
    print(text, end=" ")
</code></pre></div>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>Âú® ÈÇ£‰∏™ Â∑≤Ë¢´ Âøò Âç¥ ÁöÑÊó•Â≠ê Èáå Ôºå ÂÆÉÁöÑ ‰∏ñÁïå È¢†Ë¶Ü ‰∫Ü „ÄÇ Ê≥• Âúü È£û Ëµ∞ Ôºå Âá∫Áé∞‰∫Ü ‰∏ÄÊù° Âèà Ê∑± Âèà ÂÆΩ ÁöÑ Â≥°Ë∞∑ Ôºå ÁÑ∂Âêé Ê≥• Âúü Âèà ËΩ∞ ÈöÜ ÈöÜ Âú∞ È£û ÂõûÊù• Ôºå Â≥°Ë∞∑ Ê∂àÂ§± ‰∫Ü Ôºå Âú® ÂéüÊù• Â≥°Ë∞∑ ÁöÑ Â∞ΩÂ§¥ Âá∫Áé∞‰∫Ü ‰∏ÄÂ∫ß ÈªëËâ≤ ÁöÑ Â≠§ Â≥∞ „ÄÇ ÂÖ∂ÂÆû Ôºå Âú®Ëøô Áâá ÂπøÈòî ÁöÑ ÁñÜ Âüü ‰∏ä Ôºå ËøôÁßç‰∫ã Â∏∏Â∏∏ ÂèëÁîü Ôºå Ê≥• Âúü È£û Ëµ∞ Âèà È£û Âõû Ôºå Â≥°Ë∞∑ Âá∫Áé∞ Âèà Ê∂àÂ§± Ôºå ÁÑ∂Âêé ÊòØ Â≠§ Â≥∞ Èôç‰∏¥ Ôºå Â•ΩÂÉèÊòØ Áªô ÊØèÊ¨° ÁÅæ Âèò Êâì ‰∏ä ‰∏Ä‰∏™ ÈÜíÁõÆ ÁöÑ Ê†áËÆ∞ „ÄÇ Ë§ê ËöÅ Âíå Âá†Áôæ ‰∏™ Âêå Êóè Â∏¶ÁùÄ Âπ∏ Â≠ò ÁöÑ ËöÅ Âêé Âêë Â§™Èò≥ ËêΩ ‰∏ãÁöÑ ÊñπÂêë Ëµ∞‰∫Ü ‰∏ÄÊÆµ Ë∑Ø Ôºå Âª∫Á´ã‰∫Ü Êñ∞ÁöÑ Â∏ùÂõΩ „ÄÇ</p>
</blockquote>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>english_text <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"This is an example of tokenization using a large language model."</span>
english_tokens <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> tokenizer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>encode<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>english_text<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>str</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>english_tokens<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token number" data-v-07b74c72 data-v-07b74c72>4</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>" ..."</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

<span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> token <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> english_tokens<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    text <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> tokenizer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>decode<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>token<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string-interpolation" data-v-07b74c72 data-v-07b74c72><span class="token string" data-v-07b74c72 data-v-07b74c72>f"'</span><span class="token interpolation" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>text<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span></span><span class="token string" data-v-07b74c72 data-v-07b74c72>'"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> end<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>" "</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>[1, 4013, 338, 385] ...</p>
</blockquote>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>'' 'This' ' is' ' an' ' example' ' of' ' token' 'ization' ' using' ' a' ' large' ' language' ' model' '.'</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>This is a good time to talk about some of the obvious differences between Chinese and English.</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>The Chinese does not use spaces between words like English does</li>
<li data-v-07b74c72 data-v-07b74c72>Chinese words are typically formed from 2 or more characters</li>
<li data-v-07b74c72 data-v-07b74c72>Chinese does not conjugate verbs</li>
<li data-v-07b74c72 data-v-07b74c72>Chinese characters not have capitization like ASCII characters</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>(TODO: compare how other LLMs tokenize Chinese text.)</p>
<p data-v-07b74c72 data-v-07b74c72>After using basic NLP techniques to translate individual words, I did some basic prompt engineering to get the LLM to translate the books in the Three-Body problem paragraph by paragraph. My computer was able to translate the first book overnight in under 500 minutes. Here's the prompt I used:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>completion_prompt = f"### Chinese:\n‰Ω†Â•Ω\n\n### English:\nHello\n\n### Chinese:\n${text}\n\n### English:\n"
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>My initial impression of the Chinese LLaMa 2's accuracy at translation tasks is that it is almost unbelievably good, with the occasional occurance of task failure include some of these failure modes:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>responding to a request with the same Chinese text that I asked it to translate</li>
<li data-v-07b74c72 data-v-07b74c72>translating the only the first sentence of a multi-sentence paragraph</li>
<li data-v-07b74c72 data-v-07b74c72>not translating the text at all</li>
<li data-v-07b74c72 data-v-07b74c72>Translating most of the text to English while some words are left not translated in the response: For example: Ëøô‰ΩçÊòØÁ∫¢Â≤∏Âü∫Âú∞ÁöÑÈõ∑ÂøóÊàêÊîøÂßî -> This is Red Bank Base's Li Zhi-chengÊîøÂßî. ÊîøÂßî is an abreviation of Political commissar (ÊîøÊ≤ªÂßîÂëò) In the military, a political commissar or political officer is a supervisory officer responsible for the political education and organization of the unit to which they are assigned, with the intention of ensuring political control of the military.</li>
<li data-v-07b74c72 data-v-07b74c72>responding only with "```" (this may have something to do with the prompt I used)</li>
<li data-v-07b74c72 data-v-07b74c72>Butchering names with different translations offered between paragraphs, particularly ÁôΩÊ≤êÈúñ which it translated as White Moxin, White Mullin, White Mow Lin. None of the varieties used the pinyin translation of the characters: Bai Mu Lin. This isn't necessarily a failure of the translation, just interesting to see this type of variation across translated paragraphs.</li>
<li data-v-07b74c72 data-v-07b74c72>Some of the dialog started with the Chinese word for subtitles (Â≠óÂπïÔºö), which was not included as part of the translation, also understandable</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>It was nice to have the English book as a reference for qualitative analysis of the translation tasks I gave to the Chinese LLaMa 2 model. I look forward to reading the second and third books with all characters, words and paragraphs fully translated (for the most part).</p>
<p data-v-07b74c72 data-v-07b74c72>Here are the results of my translation of Three-Body Problem with Chinese-Alpaca-2 7 Billion parameter model from Hugging Face with 4 bit quantization:</p>
<iframe class="p-4" src="https://briancaffey.github.io/three-body-problem/reader/?book=three_body&chapterNumber=3" width="100%" height="550" data-v-07b74c72 data-v-07b74c72></iframe>
<p data-v-07b74c72 data-v-07b74c72>I used <code data-v-07b74c72 data-v-07b74c72>nvtop</code> to monitor GPU usage:</p>
<p data-v-07b74c72 data-v-07b74c72>[image of nvtop]</p>
<p data-v-07b74c72 data-v-07b74c72>Here are some of the statistics from individual paragraph translations:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72># model initialization
llama.cpp: loading model from /home/brian/github/llama.cpp/models/7B/Chinese-Alpaca-2/ggml-model-q4_0.bin
llama_model_load_internal: format     = ggjt v3 (latest)
llama_model_load_internal: n_vocab    = 55296
llama_model_load_internal: n_ctx      = 4096
llama_model_load_internal: n_embd     = 4096
llama_model_load_internal: n_mult     = 5504
llama_model_load_internal: n_head     = 32
llama_model_load_internal: n_head_kv  = 32
llama_model_load_internal: n_layer    = 32
llama_model_load_internal: n_rot      = 128
llama_model_load_internal: n_gqa      = 1
llama_model_load_internal: rnorm_eps  = 1.0e-06
llama_model_load_internal: n_ff       = 11008
llama_model_load_internal: freq_base  = 10000.0
llama_model_load_internal: freq_scale = 1
llama_model_load_internal: ftype      = 2 (mostly Q4_0)
llama_model_load_internal: model size = 7B
llama_model_load_internal: ggml ctx size =    0.08 MB
llama_model_load_internal: using CUDA for GPU acceleration
llama_model_load_internal: mem required  = 4299.79 MB (+ 2048.00 MB per state)
llama_model_load_internal: offloading 0 repeating layers to GPU
llama_model_load_internal: offloaded 0/35 layers to GPU
llama_model_load_internal: total VRAM used: 512 MB
llama_new_context_with_model: kv self size  = 2048.00 MB
AVX = 1 | AVX2 = 1 | AVX512 = 0 | AVX512_VBMI = 0 | AVX512_VNNI = 0 | FMA = 1 | NEON = 0 | ARM_FMA = 0 | F16C = 1 | FP16_VA = 0 | WASM_SIMD = 0 | BLAS = 1 | SSE3 = 1 | VSX = 0 |
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>BLAS = 1</code> means that it is able to use the GPU, we also see <code data-v-07b74c72 data-v-07b74c72>using CUDA for GPU acceleration</code>.</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72># translation task logs
llama_print_timings:        load time =   640.04 ms
llama_print_timings:      sample time =    20.00 ms /    45 runs   (    0.44 ms per token,  2249.66 tokens per second)
llama_print_timings: prompt eval time =   640.00 ms /    77 tokens (    8.31 ms per token,   120.31 tokens per second)
llama_print_timings:        eval time =  3898.99 ms /    44 runs   (   88.61 ms per token,    11.28 tokens per second)
llama_print_timings:       total time =  4631.62 ms
</code></pre></div>
<h2 id="-hugging-face" data-v-07b74c72 data-v-07b74c72><a href="#-hugging-face" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>ü§ó Hugging Face</h2>
<p data-v-07b74c72 data-v-07b74c72>Going over the <a href="https://huggingface.co/learn" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Hugging Face learning resources</a> were very useful for building foundational knowledge in LLMs and understanding the terminologly and alphabet soup.</p>
<p data-v-07b74c72 data-v-07b74c72>I also learned that Hugging Face python library offers language-to-language translation via it's <code data-v-07b74c72 data-v-07b74c72>pipeline</code> interface. This could be interesting to try, but I wasn't able to make it work with the Chinese-LLaMa-2 model.</p>
<h2 id="retrieval-augmented-generation-rag-reading-comprehension-for-computers" data-v-07b74c72 data-v-07b74c72><a href="#retrieval-augmented-generation-rag-reading-comprehension-for-computers" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Retrieval Augmented Generation (RAG): Reading Comprehension for Computers</h2>
<p data-v-07b74c72 data-v-07b74c72>Currently there is a lot of interest in the LLM community "chatting with your documents", and it certainly something I am interested in. After taking a first-pass at translation and getting decent results, I started looking into what I later learned is refered to in the community as RAG. RAG stands for retrieval augmented generation. Here's my understanding of RAG:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>Your body of documents (the Three-Body Problem books, in my case) is first grouped into digestable chunks (called documents)</li>
<li data-v-07b74c72 data-v-07b74c72>These chunks are processed into embeddings which are stored in a vector database
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>Word embedding is an AI technique representing words and sentences in a very large vector space</li>
<li data-v-07b74c72 data-v-07b74c72>Check out this article from Microsoft for more info: <a href="https://learn.microsoft.com/en-us/semantic-kernel/memories/embeddings#what-are-embeddings-to-a-programmer" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>https://learn.microsoft.com/en-us/semantic-kernel/memories/embeddings#what-are-embeddings-to-a-programmer</a></li>
</ul>
</li>
<li data-v-07b74c72 data-v-07b74c72>Your request to the LLM is first passed into a vector database and it pulls out certain documents ("chunks") that it determines are relavant to your query.</li>
<li data-v-07b74c72 data-v-07b74c72>With addional (supposedly relevant) data from your documents, the LLM responses should be better</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>I found out that you can do RAG using <code data-v-07b74c72 data-v-07b74c72>llama-cpp-python</code> along with a really popular open-source python library started by Harrison Chase called LangChain.</p>
<p data-v-07b74c72 data-v-07b74c72>Here's how I approached building a RAG program using Langchain:</p>
<p data-v-07b74c72 data-v-07b74c72>[Link to LangChain Notebook]</p>
<p data-v-07b74c72 data-v-07b74c72>With my vector database full of embeddings created from the complete text of the first book, I was ready to to starting RAGing.</p>
<p data-v-07b74c72 data-v-07b74c72>I wanted to use RAG to test the LLM's reading comprehnsion with the following questions:</p>
<ul data-v-07b74c72 data-v-07b74c72>
<li data-v-07b74c72 data-v-07b74c72>„äôÔ∏è Which methods of predicting the momevement of the sun were used in the three body game?</li>
<li data-v-07b74c72 data-v-07b74c72>What is Wang Miao's daughter's name?</li>
<li data-v-07b74c72 data-v-07b74c72>What is the Frontiers of Science?</li>
<li data-v-07b74c72 data-v-07b74c72>Who is Shi Qiang?</li>
</ul>
<p data-v-07b74c72 data-v-07b74c72>There book invites a lot of deep questions about our place in the universe, but I wanted to start with some factual questions to get a sense of how well RAG works. The results from my first attempts at RAG were terrible, so I'm interested in doing more tests with different parameters, different types of prompt structures and learning more from the LangChain community about how to improve RAG results. This is all still pretty new to me! But it is great to know that there is a big community of people working on enhancing LLMs with tools and frameworks like LangChain.</p>
<p data-v-07b74c72 data-v-07b74c72>„äôÔ∏è While I was unable to get good results with my first pass in LangChain, here are some fun images I generated with InvokeAI. The prompt I used aims to describe one such attempt at predicting the movement of the sun in the three body game, which is a system of etiquette that can be used to understand patterns in celstial movement developed by Confucius, a player who appears in Wang Miao's experience in the Three-Body VR game.</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>Prompt: Ceremonies and etiquette system related to the sun and multiple celestial++ bodies Confucius artistic style</p>
</blockquote>
<!----><!---->
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>Prompt metadata:</p>
</blockquote>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-json" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"app_version"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"3.0.2post1"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"generation_mode"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"txt2img"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"positive_prompt"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"Ceremonies and etiquette system related to the sun and multiple celestial++ bodies Confucius artistic style"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"negative_prompt"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>""</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"width"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>768</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"height"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>768</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"seed"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1748220044</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"rand_device"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"cpu"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"cfg_scale"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>10.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"steps"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>35</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"scheduler"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"euler_k"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"clip_skip"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"model"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    <span class="token property" data-v-07b74c72 data-v-07b74c72>"model_name"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"stable-diffusion-2-1"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    <span class="token property" data-v-07b74c72 data-v-07b74c72>"base_model"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"sd-2"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    <span class="token property" data-v-07b74c72 data-v-07b74c72>"model_type"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"main"</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"controlnets"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token property" data-v-07b74c72 data-v-07b74c72>"loras"</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
</code></pre></div>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>array of chinese++ warriors++ on a electronics+ circuit+ board qing+ dynasty style art logic puzzle</p>
</blockquote>
<!----><!---->
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>{
  "app_version": "3.0.2post1",
  "generation_mode": "txt2img",
  "positive_prompt": "array of chinese++ warriors++ on a electronics+ circuit+ board qing+ dynasty style art logic puzzle",
  "negative_prompt": "",
  "width": 768,
  "height": 768,
  "seed": 740286719,
  "rand_device": "cpu",
  "cfg_scale": 7.5,
  "steps": 50,
  "scheduler": "euler",
  "clip_skip": 0,
  "model": {
    "model_name": "stable-diffusion-2-1",
    "base_model": "sd-2",
    "model_type": "main"
  },
  "controlnets": [],
  "loras": []
}
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Congrats to the InvokeAI team on the 3.0 release. It has been awesome to use and the current docker compose setup is a huge improvement on the 2.x version.</p>
<h2 id="n-body-simulations-cuda-and-cupy" data-v-07b74c72 data-v-07b74c72><a href="#n-body-simulations-cuda-and-cupy" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>n-body simulations, CUDA and CuPy</h2>
<p data-v-07b74c72 data-v-07b74c72>üöß Warning: this section contains errors that I'm still working out. My nbody CuPy simulation can run by I don't think the forces are calucalated properly. I dumped the simulation data into blender to model the position of three spheres and the spheres instantly shot off in different directions. üöß</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>"Other than Stable Eras, all times are Chaotic Eras"</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>This is one of my favorite lines from the book. It said twice by King Wen of Zhou during Wang Miao's first experience in the Three-Body game where we start to learn about the peculiarities of irregular gravity in a solar system with three suns.</p>
<p data-v-07b74c72 data-v-07b74c72>NVIDIA released CUDA was realease in 2006, back when the company's stock price was around $5, compared to its recent peak of around $450 in July 2023. If the Three-Body Problem book was written any later, it would perhaps make references to a juggernaut private enterprise that develops specialized hardware for physics simulations like the n-body problem.</p>
<p data-v-07b74c72 data-v-07b74c72>The nbody problem is supposed to be unsolvable, but it can be silumated pretty easily using graphics cards. NVIDIA provides some sample code for running nbody simulations, but I wasn't able to get these samples working due to appears to be driver issues. I could write a long article about my misadventures in installing and uninstalling CUDA and NVIDIA drivers to get things working for all things related that use the GPU: stable diffusion, LLMs and CUDA programs. I have a decent understanding now of how things should be installed but I'm still slightly nervous of unintentionally breaking things in my development environment. As a DevOps engineer, Murphy's law elementary. Everything I love about containers for simplifying developer environments seems to not really apply to graphics cards and their drivers, even when you are using the <code data-v-07b74c72 data-v-07b74c72>nvidia-container-toolkit</code>.</p>
<p data-v-07b74c72 data-v-07b74c72>When my drivers were working correctly, I was in a "Stable Era" of development and both my programs and my working knowledge of GPUs evolved. Sometimes when I tried changing versions or reinstalling things or tuning parameters the wrong way, I found myself sent into a "Chaotic Era" where either my scripts and notebooks were left in cold, unrunable states due to driver issues, or I would get lost in the steps needed to prepare the model to run on with llama.cpp on the GPU: quantization and building with support for <a href="https://www.netlib.org/blas/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>BLAS (Basic Linear Algebra Subprograms)</a>.</p>
<p data-v-07b74c72 data-v-07b74c72>„äôÔ∏è Yang Dong is driven to suicide by her conclusion that physics no longer exist when her particle physics experiment yeilded inconsistent results due to intentional interference by an alien civilization. During "Chaotic Eras" of my development, the conclusion I reach that nearly drove me insane was simply that CUDA didn't exist anymore. In the end, I just needed to restart my computer. I also felt a little like Ding Yi with moving his pool table around his apartment for the expirment he demonstrates to Wang Miao.</p>
<p data-v-07b74c72 data-v-07b74c72>Currently I have most things working correctly with the following configurations:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>brian@a2:~$ nvidia-smi
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 535.86.10              Driver Version: 535.86.10    CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  NVIDIA GeForce RTX 4090        On  | 00000000:01:00.0  On |                  Off |
|  0%   40C    P0              62W / 450W |     83MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
</code></pre></div>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>$ nvcc --version
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2021 NVIDIA Corporation
Built on Thu_Nov_18_09:45:30_PST_2021
Cuda compilation tools, release 11.5, V11.5.119
Build cuda_11.5.r11.5/compiler.30672275_0
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>I'm still not sure why <code data-v-07b74c72 data-v-07b74c72>nvcc</code> (NVIDIA CUDA compiler) reads one version of CUDA (11.5) and <code data-v-07b74c72 data-v-07b74c72>nvidia-smi</code> reports a higher version (12.2).</p>
<p data-v-07b74c72 data-v-07b74c72>I wrote a simple program with the help of ChatGPT for running nbody problem simulations. The program uses CuPy, a Python library that exposes APIs for doing matrix multiplication to predict the position of three bodies using Euclidian Integration. Here's the script:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-py" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> numpy <span class="token keyword" data-v-07b74c72 data-v-07b74c72>as</span> np
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> cupy <span class="token keyword" data-v-07b74c72 data-v-07b74c72>as</span> cp
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> time
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> json

<span class="token comment" data-v-07b74c72 data-v-07b74c72># Simulation parameters</span>
NUM_PARTICLES <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span>
DIMENSIONS <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72># 3D space</span>
NUM_STEPS <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>30</span>
DT <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0.1</span>

<span class="token comment" data-v-07b74c72 data-v-07b74c72># Generate initial positions and velocities</span>
np_positions <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> np<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>random<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>randn<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>NUM_PARTICLES<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> DIMENSIONS<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
np_velocities <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> np<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>random<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>randn<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>NUM_PARTICLES<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> DIMENSIONS<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

cp_positions <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>array<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>np_positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
cp_velocities <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>array<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>np_velocities<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

np_ticks <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> np<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>expand_dims<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>np_positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> axis<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
cp_ticks <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>array<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>np_ticks<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

<span class="token comment" data-v-07b74c72 data-v-07b74c72># nbody simulation loop</span>
start_time <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> time<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>time<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> step <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>range</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>NUM_STEPS<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># this gets pairwise differences</span>
    diff <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp_positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span> cp_positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
    distances <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>sqrt<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>sum</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>diff<span class="token operator" data-v-07b74c72 data-v-07b74c72>**</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> axis<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># avoid division by zero</span>
    epsilon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1e-5</span>
    inv_distances <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1.0</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>maximum<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>distances<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> epsilon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># calculate forces</span>
    cp_forces <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>sum</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>diff<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>T <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> inv_distances<span class="token operator" data-v-07b74c72 data-v-07b74c72>**</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>T<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> axis<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>1</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># update velocities and positions</span>
    cp_velocities <span class="token operator" data-v-07b74c72 data-v-07b74c72>+=</span> DT <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> cp_forces
    cp_positions <span class="token operator" data-v-07b74c72 data-v-07b74c72>+=</span> DT <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> cp_velocities
    cp_ticks <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>append<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>cp_ticks<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>expand_dims<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>cp_positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

sim_time <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> time<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>time<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span> start_time
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>"Simulation time:"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> sim_time<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>


<span class="token keyword" data-v-07b74c72 data-v-07b74c72>class</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>NumpyArrayEncoder</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>json<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>JSONEncoder<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>default</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>self<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> obj<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>isinstance</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>obj<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> np<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>ndarray<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> obj<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>tolist<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> json<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>JSONEncoder<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>default<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>self<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> obj<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>


np_ticks <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp_ticks<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>


<span class="token comment" data-v-07b74c72 data-v-07b74c72># this is data we can work with in python and write to a file</span>
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>with</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>open</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>"ticks.json"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>"w"</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>as</span> f<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    f<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>write<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>json<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>dumps<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>np_ticks<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> cls<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>NumpyArrayEncoder<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>To better understand the matrix math here I walked through a simple example of what each step does:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-py" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token comment" data-v-07b74c72 data-v-07b74c72># particle coordinates (x,y,z) in 3D space</span>
positions <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>array<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>1</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>4</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>7</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>8</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token number" data-v-07b74c72 data-v-07b74c72>9</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>The first operation creates an array for pairwise distances for each dimension:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>diff <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span> positions<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>diff<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

array<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>2.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>5.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>

       <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>

       <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>5.5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>  <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>The rows of zeros correspond to a particle's <code data-v-07b74c72 data-v-07b74c72>x</code>, <code data-v-07b74c72 data-v-07b74c72>y</code> and <code data-v-07b74c72 data-v-07b74c72>z</code> distances to itself, which are all zero by axioms of Euclidian vector spaces.</p>
<p data-v-07b74c72 data-v-07b74c72>The next operation calculates the distance between each particle:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>distances = cp.sqrt(cp.sum(diff**2, axis=2))
print(distances)

array([[ 0.        ,  4.9244289 , 10.11187421],
       [ 4.9244289 ,  0.        ,  5.19615242],
       [10.11187421,  5.19615242,  0.        ]])
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>The diagonal or zeros represents that fact that a particle <code data-v-07b74c72 data-v-07b74c72>n</code> has a distance of zero to iself.</p>
<p data-v-07b74c72 data-v-07b74c72>The next step calculates inverse distances:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>epsilon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1e-5</span>
inv_distances <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1.0</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span> cp<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>maximum<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>distances<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> epsilon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>array([[1.00000000e+05, 2.03069233e-01, 9.88936353e-02],
       [2.03069233e-01, 1.00000000e+05, 1.92450090e-01],
       [9.88936353e-02, 1.92450090e-01, 1.00000000e+05]])
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>The next step is the most elegant part of the simulation in my opinion:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>cp_forces = cp.sum((diff.T * inv_distances**3).T, axis=1)
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>The <code data-v-07b74c72 data-v-07b74c72>.T</code> operation transposes a matrix, multiplies by the cube of inverse distances, then transposes the matrix again before summing along the first axis. Transposing a matrix basically swaps rows and columns.</p>
<p data-v-07b74c72 data-v-07b74c72>The next two steps are also pretty elegant:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token comment" data-v-07b74c72 data-v-07b74c72># update velocities and positions</span>
cp_velocities <span class="token operator" data-v-07b74c72 data-v-07b74c72>+=</span> DT <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> cp_forces
cp_positions <span class="token operator" data-v-07b74c72 data-v-07b74c72>+=</span> DT <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> cp_velocities
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>In the last step I append the updated positions to an array that holds every "tick" (the positions of each particle between each time interval, <code data-v-07b74c72 data-v-07b74c72>DT</code> - "delta time")</p>
<p data-v-07b74c72 data-v-07b74c72>A simpler way to view particle physics can be acheived with Three.js:</p>
<iframe src="https://briancaffey.github.io/three-body-problem/three/" width="100%" height="350" data-v-07b74c72 data-v-07b74c72></iframe>
<p data-v-07b74c72 data-v-07b74c72>Three.js and WebGL and still feels like alien technologies to me. It doesn't feel like these simulations should be run so fluidly on my computer in the browser. Wang Miao's comments about hidden data in the Three-Body game resonated with me when I came across this Three.js example:</p>
<p data-v-07b74c72 data-v-07b74c72>„äôÔ∏è</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>„Ää‰∏â‰Ωì„ÄãÊ≠£ÊòØËøôÊ†∑ÔºåÂÆÉÁöÑÊµ∑Èáè‰ø°ÊÅØÊòØÈöêËóèÂú®Ê∑±Â§ÑÁöÑÔºåÊ±™Ê∑ºËÉΩÊÑüËßâÂà∞Ôºå‰ΩÜËØ¥‰∏çÊ∏Ö„ÄÇ‰ªñÁ™ÅÁÑ∂ÊÇüÂá∫Ôºå„Ää‰∏â‰Ωì„ÄãÁöÑ‰∏çÂØªÂ∏∏Âú®‰∫éÔºå‰∏éÂÖ∂‰ªñÁöÑÊ∏∏ÊàèÁõ∏ÊØîÔºåÂÆÉÁöÑËÆæËÆ°ËÄÖÊòØÂèçÂÖ∂ÈÅìËÄåË°å‰πã‚Äî‚Äî‰∏ÄËà¨Ê∏∏ÊàèÁöÑËÆæËÆ°ËÄÖÈÉΩÊòØÂ∞ΩÂèØËÉΩÂú∞Â¢ûÂä†ÊòæÁ§∫ÁöÑ‰ø°ÊÅØÈáèÔºå‰ª•‰∫ßÁîüÁúüÂÆûÊÑüÔºõ‰ΩÜ„Ää‰∏â‰Ωì„ÄãÁöÑËÆæËÆ°ËÄÖÂç¥ÊòØÂú®ÊûÅÂäõÂéãÁº©‰ø°ÊÅØÈáèÔºå‰ª•ÈöêËóèÊüêÁßçÂ∑®Â§ßÁöÑÁúüÂÆûÔºåÂ∞±ÂÉèÈÇ£Âº†Áúã‰ººÁ©∫Êó∑ÁöÑÂ§©Á©∫ÁÖßÁâá„ÄÇ</p>
</blockquote></div> <div class="text-center pb-4 pt-8" data-v-07b74c72><button class="mc-btn rounded py-1 px-2" data-v-07b74c72>
        Show Disqus Comments üí¨
      </button></div> <!----> <h1 data-v-07b74c72></h1></div></article> <div class="mx-auto max-w-6xl p-4 lg:px-16 text-center" data-v-7718c60c><hr class="mt-4" data-v-7718c60c> <div class="align-center py-4" data-v-7718c60c><div class="pb-4" data-v-7718c60c>
      –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –º–æ–µ–º—É —Å–ø–∏—Å–∫—É —Ä–∞—Å—Å—ã–ª–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —è –ø—É–±–ª–∏–∫—É—é –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é.
    </div> <div class="flex align-center justify-center" data-v-5690d13b data-v-7718c60c><div id="mc_embed_signup" class="w-full md:w-1/2 flex-shrink justify-center" data-v-5690d13b><form id="mc-embedded-subscribe-form" action="https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6&id=9937fe4fc5" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="validate" data-v-5690d13b><div id="mc_embed_signup_scroll" class="grid grid-cols-1 sm:grid-cols-2 gap-4" data-v-5690d13b><input id="mce-EMAIL" type="email" name="EMAIL" placeholder="–≠–ª. –∞–¥—Ä–µ—Å" class="rounded mc text-center" data-v-5690d13b> <div aria-hidden="true" style="position:absolute;left:-5000px" data-v-5690d13b><input name="b_43a795784ca963e25903a0da6_9937fe4fc5" tabindex="-1" data-v-5690d13b></div> <div class="text-right" style="width:100%" data-v-5690d13b><input id="mc-embedded-subscribe" type="submit" name="subscribe" value="–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è" class="mc-btn rounded px-2 py-1 w-full" data-v-5690d13b></div></div></form></div></div></div> <hr data-v-7718c60c> <div class="py-4" data-v-7718c60c>
    –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–µ–≥–æ —Å–∞–π—Ç–∞!
  </div> <div class="pb-4" data-v-7718c60c>
    ¬© 2023 Brian Caffey
  </div></div></div></div></div><script defer src="/_nuxt/static/1693367994/ru/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem/state.js"></script><script src="/_nuxt/8d55c13.js" defer></script><script src="/_nuxt/55e3c8e.js" defer></script><script src="/_nuxt/8bfa011.js" defer></script><script src="/_nuxt/e851bee.js" defer></script><script src="/_nuxt/4f82569.js" defer></script>
  </body>
</html>
