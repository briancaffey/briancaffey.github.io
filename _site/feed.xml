<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Brian Caffey</title>
    <description>Thanks for visiting my site, please take a minute to look around!
</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 24 Sep 2018 20:38:36 -0400</pubDate>
    <lastBuildDate>Mon, 24 Sep 2018 20:38:36 -0400</lastBuildDate>
    <generator>Jekyll v3.0.1</generator>
    
      <item>
        <title>Scripting my daily development environment setup</title>
        <description>&lt;p&gt;This article shows how I automated the setup of my daily development environment for work with a bash script. Hereâ€™s the script:&lt;/p&gt;

&lt;p&gt;```bash
#!/bin/sh
PROJDIR=/home/bcaffey/git/project-directory/src
NOTESDIR=/home/bcaffey/Documents/notes&lt;/p&gt;

&lt;p&gt;gnome-terminal \
    â€“tab â€“working-directory=$PROJDIR -e â€œbash -c â€˜echo -ne &quot;\033]0;Django - Server\007&quot;; . ./setup-virtualenv.bash &amp;amp;&amp;amp; ./runserverâ€™â€ \
    â€“tab â€“working-directory=$PROJDIR -e â€œbash -c â€˜echo -ne &quot;\033]0;Celery - Queue 1\007&quot;; . ./setup-virtualenv.bash &amp;amp;&amp;amp; ./runcelery_1â€™â€ \
    â€“tab â€“working-directory=$PROJDIR -e â€œbash -c â€˜echo -ne &quot;\033]0;Celery - Queue 2\007&quot;; . ./setup.-virtualenvbash &amp;amp;&amp;amp; ./runcelery_2â€™â€ \
    â€“tab â€“working-directory=$PROJDIR -e â€œbash -c â€˜echo -ne &quot;\033]0;Flower\007&quot;; . ./setup-virtualenv.bash &amp;amp;&amp;amp; ./runflowerâ€™â€ \
    â€“tab â€“working-directory=$PROJDIR -e â€œbash -c â€˜echo -ne &quot;\033]0;Django - Shell\007&quot;; . ./setup-virtualenv.bash &amp;amp;&amp;amp; ./manage shellâ€™â€ \&lt;/p&gt;

&lt;p&gt;cd $PROJDIR &amp;amp;&amp;amp; code .
cd $NOTESDIR &amp;amp;&amp;amp; code .&lt;/p&gt;

&lt;p&gt;google-chrome http://subdomain.domain.com:8222/admin/
```&lt;/p&gt;

&lt;p&gt;This script opens a &lt;code class=&quot;highlighter-rouge&quot;&gt;gnome-terminal&lt;/code&gt; window with 5 tabs, one for a Django app, another for a Django shell, 2 for celery workers and one to run flower. Additionally, we specify a name for the tabs with &lt;code class=&quot;highlighter-rouge&quot;&gt;\033]0;Django - Shell\007\&quot;&lt;/code&gt;. I then launch VS Code and open up my Django app and Iâ€™m all ready to go. This might only take minute or two to do manually each morning, but the script can be launched at startup so that my development environment is set as soon as I turn on my computer. An easy way to do this on Ubuntu is to use &lt;code class=&quot;highlighter-rouge&quot;&gt;Startup Applications&lt;/code&gt;.&lt;/p&gt;
</description>
        <pubDate>Mon, 20 Aug 2018 00:00:00 -0400</pubDate>
        <link>/2018/08/20/startup-script-for-work.html</link>
        <guid isPermaLink="true">/2018/08/20/startup-script-for-work.html</guid>
        
        
      </item>
    
      <item>
        <title>Generating MIDI files from guitar tablatures with Python and regular expressions</title>
        <description>&lt;p&gt;Recently I have been playing lots of classical guitar. I use &lt;a href=&quot;classtab.org&quot;&gt;classtab.org&lt;/a&gt;, a website with hundreds of classical guitar pieces in tab form. Hereâ€™s an example of a guitar tab:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
|---------------0---|---3-2-3-----------|-----0-------------|
|-------0-3-1-1---3-|-3-------3-0-----0-|-1-3---3-1-0---0---|
|---0-2-0-----------|-------------0-2---|-------------2---0-|
|-------------2-----|-------2-----------|-------------------|
|-------------------|-2-----------------|-0-----2-----3-----|
|-3-----------------|-------------0-----|-------------------|
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;It is a representation of where and when strings are played. The six lines here represent the six strings of the guitar e, A, D, G, B and E and the numbers indicate where on the fretboard to press for each note. The vertical bars represent one bar of music.&lt;/p&gt;

&lt;p&gt;My goal is to write an application that can read in guitar tabs and then produce a corresponding MIDI file for the song.&lt;/p&gt;

&lt;p&gt;To start, I will use regular expressions to parse the bars of music in a guitar tab text file.&lt;/p&gt;

&lt;p&gt;Next, I will use a Python package called MIDIUtil to generate &lt;code class=&quot;highlighter-rouge&quot;&gt;.mid&lt;/code&gt; files from the guitar tabs.&lt;/p&gt;

&lt;p&gt;Finally, Iâ€™ll put this into a simple web app that lets users copy paste guitar tab text or enter a URL from a site like classtab.org that will similarly generate a MIDI file.&lt;/p&gt;

&lt;h2 id=&quot;regex&quot;&gt;Regex&lt;/h2&gt;

&lt;p&gt;First, letâ€™s look at a few different examples of guitar tabs to get a better sense of what our goal should be in using regular expressions to parse notes.&lt;/p&gt;

&lt;h3 id=&quot;tab-examples&quot;&gt;Tab examples&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.classtab.org/barrios_la_catedral_3_allegro.txt&quot;&gt;http://www.classtab.org/barrios_la_catedral_3_allegro.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```
La Catedral
Author: Agustin Barrios
Tablature by: Gianpiero Ciammaricone
              giancian@yahoo.com
              http://www.geocities.com/vienna/6619&lt;/p&gt;

&lt;p&gt;Tablature Explanation at the end.&lt;/p&gt;

&lt;p&gt;[key corrected from â€œD Majorâ€ Jan 99]&lt;/p&gt;

&lt;p&gt;This is Revision 3 (5/2/98), I have added a modification made by
Barrios in line 5 of the TAB, both ways of playing it are included,
so you can choose the best one for you.
Revision 2: Made a few corrections.
Revision 1: The first release of the tab.&lt;/p&gt;

&lt;p&gt;3rd Movement (Allegro):
Key: B Minor
Time signature: 6/8&lt;/p&gt;

&lt;p&gt;E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
B-|â€”â€”â€”â€”â€”â€“3â€”â€”-|â€”â€”â€”â€”â€”â€“3â€”â€”â€”â€“|
G-|â€”â€”â€”0â€”4â€”â€”-4â€”|â€”â€”â€”0â€”4â€”â€”-4â€”â€”-|
D-|â€”4-3h4â€”4â€”4â€”4â€”4-|â€”4-3h4â€”4â€”4â€”4â€”4â€”â€“|
A-|-2â€”â€”â€”â€”â€”â€”â€”â€“|-2â€”â€”â€”â€”â€”â€”â€”â€”â€”|
E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
    p m i   m i m i a i m i&lt;/p&gt;

&lt;p&gt;E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
B-|â€”â€”â€”â€”â€”â€“3â€”â€”-|â€”â€”â€”â€”â€”â€“3â€”â€”â€”â€“|
G-|â€”â€”â€”2â€”4â€”â€”-4â€”|â€”â€”â€”2â€”4â€”â€”-4â€”â€”-|
D-|â€”5-4h5â€”5â€”5â€”5â€”5-|â€”5-4h5â€”5â€”5â€”5â€”5â€”â€“|
A-|-2â€”â€”â€”â€”â€”â€”â€”â€“|-2â€”â€”â€”â€”â€”â€”â€”â€”â€”|
E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
    p m i   m i m i a i m i&lt;/p&gt;

&lt;p&gt;E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
B-|â€”â€”â€”â€”â€”â€“5â€”â€”-|â€”â€”â€”â€”â€”â€“5â€”â€”â€”â€“|
G-|â€”â€”â€”4â€”6â€”â€”-6â€”|â€”â€”â€”4â€”6â€”â€”-6â€”â€”-|
D-|â€”7-6h7â€”7â€”7â€”7â€”7-|â€”7-6h7â€”7â€”7â€”7â€”7â€”â€“|
A-|-4â€”â€”â€”â€”â€”â€”â€”â€“|-4â€”â€”â€”â€”â€”â€”â€”â€”â€”|
E-|â€”â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
    p m i   m i m i a i m i&lt;br /&gt;
```&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.classtab.org/moreno_torroba_siete_piezas_de_album_6_chisperada.txt&quot;&gt;http://www.classtab.org/moreno_torroba_siete_piezas_de_album_6_chisperada.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```
SIETE PIEZAS DE ALBUM: VI. CHISPERADA
As recorded by Federico Moreno Torroba&lt;/p&gt;

&lt;p&gt;Music by Federico Moreno Torroba&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”â€“0â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€“0-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”1â€”â€“0â€”&lt;/td&gt;
      &lt;td&gt;â€”â€“3â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”1â€”â€“0â€”&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”2â€”â€“0â€”&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€”-1-&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€“0â€”&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”2â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”3â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€”â€”&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-0â€”â€”â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”2â€”&lt;/td&gt;
      &lt;td&gt;-0â€”â€”â€”â€“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”â€”-3â€”â€“&lt;/td&gt;
      &lt;td&gt;-1â€”â€“0â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”-3â€”â€“&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”â€”â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”â€“0â€“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”â€“3â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”1â€”â€“0â€”&lt;/td&gt;
      &lt;td&gt;â€”â€“3â€”â€“0-&lt;/td&gt;
      &lt;td&gt;â€”â€“3â€”â€“0â€“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”2â€”â€”-1-&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€“0â€”&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€”-1-&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€”-1â€“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”3â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”2â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”3â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”3â€”â€”â€”-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€”â€”â€”2â€”&lt;/td&gt;
      &lt;td&gt;-0â€”â€”â€”â€“&lt;/td&gt;
      &lt;td&gt;-0â€”â€”-2â€”&lt;/td&gt;
      &lt;td&gt;-0â€”â€”-2â€”-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-1â€”â€“0â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”-3â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”-0â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”-0â€”â€”&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;|â€”â€”â€”â€”â€”0â€“|-0â€”â€“0â€”â€“|-1â€”â€“1-3p1-0â€”|
|â€”1-0â€”â€”â€”0â€“|-1â€”â€”â€”â€“|â€”â€”â€”â€”â€”3-|
|-2â€”â€“2-0â€”â€“1â€“|-2â€”â€“1â€”â€“|-2â€”â€“2â€”â€”â€”|
|â€”â€”â€”â€“3â€”â€”|â€”â€”â€”â€”-|â€”â€”-0â€”â€”â€”|
|-3â€”â€”â€”â€”â€”-|â€”0-0â€”2-2-|â€”3-3â€”â€”â€”â€“|
|â€”â€”â€”â€”-0â€”-|â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€“|
```&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.classtab.org/moreno_torroba_sonatina_in_a_2_andante.txt&quot;&gt;http://www.classtab.org/moreno_torroba_sonatina_in_a_2_andante.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```
Sonatina in A - II - Andante&lt;/p&gt;

&lt;p&gt;F. Moreno Torroba (1891-1982)&lt;/p&gt;

&lt;p&gt;tuning DADGBE&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;E&lt;/td&gt;
      &lt;td&gt;â€”â€“2â€“3â€”5â€”â€”â€”-10â€“8â€“7â€”â€”-&lt;/td&gt;
      &lt;td&gt;â€”â€“8â€”-7^8^7â€”â€”â€”â€”â€”â€”â€”â€“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;B&lt;/td&gt;
      &lt;td&gt;â€”â€“3â€“5â€”7â€”â€”â€”-7â€”â€”â€”â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€“8â€”â€”â€”â€“10â€”â€”â€”8â€”â€”â€”&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;G&lt;/td&gt;
      &lt;td&gt;â€”â€“2â€”â€”â€”â€”â€”â€”â€”9â€“7â€”â€”-&lt;/td&gt;
      &lt;td&gt;â€”â€“9â€”â€”â€”â€”â€”â€”â€”â€”â€“11â€”-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;D&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€”â€”â€”â€“4â€”â€”â€”â€”â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”â€”â€”â€”â€”â€”â€“10â€”â€”â€”-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;A&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€”â€”-0â€”â€”â€”â€”â€”â€”â€”&lt;/td&gt;
      &lt;td&gt;â€”â€”â€”â€”â€”â€”â€”-7â€”â€”â€”â€”â€”&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;D&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“&lt;/td&gt;
      &lt;td&gt;â€”â€“0â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;E|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|
B|â€”â€”â€”â€”â€”â€”7â€“8^10-8â€”7^5â€”â€“|â€”5â€”â€”â€”7-8-7-5â€”â€“5â€”â€”â€”â€”|
G|â€“9^11^9â€”-7â€“9â€”â€”â€”â€”â€”â€”7â€”|â€”6â€”â€”â€”â€”â€”â€“7â€”6â€”â€”â€”â€”|
D|â€”â€”-8â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”|â€”5â€”â€”â€”â€”â€”â€”â€”5â€“7â€”-19Â°â€“|
A|â€”â€”-10â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“|â€”â€”0â€“12Â°â€”â€”â€”â€”â€”â€”â€”â€”â€“|
D|â€”â€”-0â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”|â€”0â€”â€”â€”â€”â€”â€”â€”0â€”â€”â€”â€”|
```&lt;/p&gt;

&lt;p&gt;Here are a few things that we need to consider:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The start of each line sometimes starts with a the note of the string (&lt;code class=&quot;highlighter-rouge&quot;&gt;E&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;e&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;D&lt;/code&gt;, etc.) followed by &lt;code class=&quot;highlighter-rouge&quot;&gt;|&lt;/code&gt; or just simply start with &lt;code class=&quot;highlighter-rouge&quot;&gt;|&lt;/code&gt;. Some lines may start with &lt;code class=&quot;highlighter-rouge&quot;&gt;E-|&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There is generally a &lt;code class=&quot;highlighter-rouge&quot;&gt;-&lt;/code&gt; character between each note. When this is not the case, we may have a &lt;code class=&quot;highlighter-rouge&quot;&gt;p&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;h&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;^&lt;/code&gt; which indicates â€œpull offâ€ or â€œhammer onâ€. This means that you are playing the string with the hand on the fretboard, not the hand over the sound hole. We should replace these with &lt;code class=&quot;highlighter-rouge&quot;&gt;-&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A tab may have an inconsistant number of characters in each bar. Iâ€™m not too concerned about this. Iâ€™m not going for perfection just yet, but it could make this task very difficult if you want to get the timing of your sounds just right.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Notes played on the 10th fret and higher must be read together. For example, &lt;code class=&quot;highlighter-rouge&quot;&gt;---12---&lt;/code&gt; should be played on the 12 fret; it does not mean play &lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt; and then play &lt;code class=&quot;highlighter-rouge&quot;&gt;2&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There are some other special characters such as &lt;code class=&quot;highlighter-rouge&quot;&gt;Â°&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt;&lt;/code&gt;. I think these both denote harmonics. This is when you place your finger on the string at a position along the fretboard, but do not press down. We probably want to replace these characters with &lt;code class=&quot;highlighter-rouge&quot;&gt;-&lt;/code&gt; as well.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;tab-text-file-processing&quot;&gt;Tab text file processing&lt;/h3&gt;

&lt;p&gt;Here are some things that may be helpful to do as soon as we read a text file:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;convert everything to upper or lower case&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;replace non-numeric characters with &lt;code class=&quot;highlighter-rouge&quot;&gt;-&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When I work with regex, I usually go straight to &lt;a href=&quot;regex101.com&quot;&gt;regex101.com&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;midiutil&quot;&gt;MIDIUtil&lt;/h2&gt;

&lt;p&gt;At this point, I think it will be helpful to examine MIDIUtil and create and play a basic MIDI file.&lt;/p&gt;

&lt;p&gt;Before you do that, you might want to read over the &lt;a href=&quot;https://wiki.archlinux.org/index.php/MIDI&quot;&gt;MIDI Arch Wiki article&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;MIDIUtil is a pure Python library that allows one to write multi-track Musical Instrument Digital Interface (MIDI) files from within Python programs (both format 1 and format 2 files are now supported). It is object-oriented and allows one to create and write these files with a minimum of fuss.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Hereâ€™s a basic example of MIDIUtil. This script generates a MIDI file that contains a major scale.&lt;/p&gt;

&lt;p&gt;```python
#!/usr/bin/env python&lt;/p&gt;

&lt;p&gt;from midiutil import MIDIFile&lt;/p&gt;

&lt;p&gt;degrees  = [60, 62, 64, 65, 67, 69, 71, 72]  # MIDI note number
track    = 0
channel  = 0
time     = 0    # In beats
duration = 1    # In beats
tempo    = 60   # In BPM
volume   = 100  # 0-127, as per the MIDI standard&lt;/p&gt;

&lt;p&gt;MyMIDI = MIDIFile(1)  # One track, defaults to format 1 (tempo track is created
                      # automatically)
MyMIDI.addTempo(track, time, tempo)&lt;/p&gt;

&lt;p&gt;for i, pitch in enumerate(degrees):
    MyMIDI.addNote(track, channel, pitch, time + i, duration, volume)&lt;/p&gt;

&lt;p&gt;with open(â€œmajor-scale.midâ€, â€œwbâ€) as output_file:
    MyMIDI.writeFile(output_file)
```&lt;/p&gt;

&lt;p&gt;Now letâ€™s try to play this file. Well, if you read the MIDI article, you would know that this isnâ€™t really what we are doing. We want to see what our major scale sounds like. In order to do that, we need to install and configure both a MIDI synthesizer as well as a soundfont.&lt;/p&gt;

&lt;p&gt;We can use timidity++ for our MIDI synth. There are very simple instructions on how to do this &lt;a href=&quot;https://wiki.archlinux.org/index.php/timidity&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here are the steps I followed:&lt;/p&gt;

&lt;p&gt;From the AUR, install &lt;code class=&quot;highlighter-rouge&quot;&gt;timidity++&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;timidity-freepats&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Add yourself to the audio group:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
# gpasswd -a brian audio
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Add the following line to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/timidity++/timidity.cfg&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
soundfont /usr/share/soundfonts/timidity-freepats.sf2
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
sudo systemctl start timidity.service
sudo systemctl enable timidity.service
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;aplaymidi -l&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
 $ aplaymidi -l
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
130:0    TiMidity                         TiMidity port 0
130:1    TiMidity                         TiMidity port 1
130:2    TiMidity                         TiMidity port 2
130:3    TiMidity                         TiMidity port 3
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Finally, we can play our MIDI file that we generated by running the python script above:&lt;/p&gt;

&lt;p&gt;```
 $ aplaymidi major-scale.mid â€“port 130:0&lt;/p&gt;
&lt;music plays...=&quot;&quot;&gt;
```

For this project, playing files using a synthesizer is useful to verify that the MIDI was successfully created. If/when we get to the point of making a web app to convert midi files to music files, we will generate the midifile in-memory, convert it to a WAV file and then return that to the user. 

Let&#39;s try to process a very simple tab file with just one string and a few notes, and then generate a simple MIDI file based on the tab. 

Our sample tab can be: 

*simple-tab.txt*
```
--0--2--4--
```

```python
#!/usr/bin/env python

from midiutil import MIDIFile

degrees  = [60, 62, 64, 65, 67, 69, 71, 72]  # MIDI note number
track    = 0
channel  = 0
time     = 0    # In beats
duration = 1    # In beats
tempo    = 60   # In BPM
volume   = 100  # 0-127, as per the MIDI standard

MyMIDI = MIDIFile(1)  # One track, defaults to format 1 (tempo track is created
                      # automatically)
MyMIDI.addTempo(track, time, tempo)

for i, pitch in enumerate(degrees):
    MyMIDI.addNote(track, channel, pitch, time + i, duration, volume)

with open(&quot;major-scale.mid&quot;, &quot;wb&quot;) as output_file:
    MyMIDI.writeFile(output_file)
```

```
 $ echo &quot;--0--2--4--&quot; &amp;gt; simple-tab.txt
```

Here&#39;s the script I used to generate some fairly accurate MIDI files. There are still some bugs in the script that generates the MIDI file, but this meets the goal I had last weekend of writing a simple script to generate music from guitar tabs. 

```python
#!/usr/bin/env python

from midiutil import MIDIFile
import sys
import re

string_notes = [&quot;high_e&quot;, &quot;B&quot;, &quot;G&quot;, &quot;D&quot;, &quot;A&quot;, &quot;E&quot;]

guitar_strings = {
    &#39;E&#39;:{&#39;note_val&#39;:52, &#39;track_num&#39;:0},
    &#39;A&#39;:{&#39;note_val&#39;:57, &#39;track_num&#39;:1},
    &#39;D&#39;:{&#39;note_val&#39;:62, &#39;track_num&#39;:2},
    &#39;G&#39;:{&#39;note_val&#39;:67, &#39;track_num&#39;:3},
    &#39;B&#39;:{&#39;note_val&#39;:71, &#39;track_num&#39;:4},
    &#39;high_e&#39;:{&#39;note_val&#39;:76, &#39;track_num&#39;:5},
}

# read the tab file
file_name = sys.argv[1]
if file_name.split(&quot;.&quot;)[-1] != &#39;txt&#39;:
    print(&quot;Please select a text file&quot;)

with open(file_name) as f: 
    contents = f.read()

contents = contents.replace(&quot;h&quot;, &quot;-&quot;)
contents = contents.replace(&quot;p&quot;, &quot;-&quot;)
contents = contents.replace(&quot;/&quot;, &quot;-&quot;)
contents = contents.replace(&quot;*&quot;, &quot;-&quot;)
contents = contents.upper()
bar_group = re.findall(r&quot;(?:[E,B,G,D,A,-]+\|[0-9-h|]+\n){6}&quot;,contents)

#bar_group = re.findall(r&quot;(?:\|[0-9-\*h\|]+\n){6}&quot;,contents)


track    = 0
channel  = 0
time     = 0    # In beats
duration = 1    # In beats
tempo    = 1000   # In BPM
volume   = 100  # 0-127, as per the MIDI standard

MyMIDI = MIDIFile(6)  # One track, defaults to format 1 (tempo track is created
                      # automatically)
MyMIDI.addTempo(track, time, tempo)

interval = len(bar_group[0].split(&quot;\n&quot;)) - 1

for b in bar_group:

    strings = b.split(&quot;\n&quot;)
    strings = [x for x in strings if x != &#39;&#39;]
    e_count = 0
    for i,s in enumerate(strings):
        
        current_string = strings[i][0]
        if current_string not in guitar_strings.keys():
            current_string = string_notes[i]
        if current_string == &quot;E&quot;:
            e_count += 1
        if e_count == 2:
            current_string == &quot;high_e&quot;

        track = guitar_strings[current_string][&#39;track_num&#39;]

        s = s[1:]
        s = s.replace(&#39;|&#39;, &#39;&#39;)
        s = list(s)

        for i, pitch in enumerate(s):
            volume = 100
            
            if pitch == &quot;\n&quot;:
                break
            if pitch == &quot;-&quot;:
                volume = 0
                pitch = 50
            print(&quot;adding note&quot;)
            pitch = int(pitch) + guitar_strings[current_string][&#39;note_val&#39;]
            MyMIDI.addNote(track, channel, pitch, time + i, duration, volume)
        
    time += interval*8

with open(&quot;major-scale.mid&quot;, &quot;wb&quot;) as output_file:
    MyMIDI.writeFile(output_file)
```

Here&#39;s me playing one of my favorite songs, you might recognize it!

&lt;blockquote class=&quot;instagram-media&quot; data-instgrm-captioned=&quot;&quot; data-instgrm-permalink=&quot;https://www.instagram.com/p/rg2gmyyFdC/&quot; data-instgrm-version=&quot;8&quot; style=&quot; background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);&quot;&gt;&lt;div style=&quot;padding:8px;&quot;&gt; &lt;div style=&quot; background:#F8F8F8; line-height:0; margin-top:40px; padding:50% 0; text-align:center; width:100%;&quot;&gt; &lt;div style=&quot; background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;&quot;&gt;&lt;/div&gt;&lt;/div&gt; &lt;p style=&quot; margin:8px 0 0 0; padding:0 4px;&quot;&gt; &lt;a href=&quot;https://www.instagram.com/p/rg2gmyyFdC/&quot; style=&quot; color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;&quot; target=&quot;_blank&quot;&gt;Written in 1902, this catchy tune from Fransico TÃ¡rrega&amp;#39;s &amp;#39;Gran Vals&amp;#39; is now heard by an estimated 22,000 per second worldwide.. it is also a registered sound trademark of a billion dollar Finnish company ğŸµ #franciscotÃ¡rrega #tarrega #tÃ¡rrega #classicalguitar #spanishguitarist #spain #instamusic #granvals #grandevalse #grandwaltz #crownmolding&lt;/a&gt;&lt;/p&gt; &lt;p style=&quot; color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;&quot;&gt;A post shared by &lt;a href=&quot;https://www.instagram.com/briancaffey/&quot; style=&quot; color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px;&quot; target=&quot;_blank&quot;&gt; Brian&lt;/a&gt; (@briancaffey) on &lt;time style=&quot; font-family:Arial,sans-serif; font-size:14px; line-height:17px;&quot; datetime=&quot;2014-08-10T09:48:59+00:00&quot;&gt;Aug 10, 2014 at 2:48am PDT&lt;/time&gt;&lt;/p&gt;&lt;/div&gt;&lt;/blockquote&gt; &lt;script async=&quot;&quot; defer=&quot;&quot; src=&quot;//www.instagram.com/embed.js&quot;&gt;&lt;/script&gt;
&lt;/music&gt;
</description>
        <pubDate>Thu, 26 Apr 2018 00:00:00 -0400</pubDate>
        <link>/2018/04/26/generating-music-from-guitar-tabs-with-python.html</link>
        <guid isPermaLink="true">/2018/04/26/generating-music-from-guitar-tabs-with-python.html</guid>
        
        
      </item>
    
      <item>
        <title>Ubuntu 16.04.4 Installation and Setup Notes</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/ubuntu_installation.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;ubuntu-setup&quot;&gt;Ubuntu Setup&lt;/h1&gt;

&lt;p&gt;I have recently been working between MacOS, Windows 10 and Linux machines, but I havenâ€™t spent much time on Ubuntu. This is a collection of notes on setting up Ubunutu with a few different development environments:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;nodejs&lt;/li&gt;
  &lt;li&gt;ruby&lt;/li&gt;
  &lt;li&gt;python&lt;/li&gt;
  &lt;li&gt;postgresql&lt;/li&gt;
  &lt;li&gt;various development tools&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;installation&quot;&gt;Installation&lt;/h3&gt;

&lt;p&gt;To install Ubuntu you need the ISO image. The fastest way to download this is BitTorrent, using a client like Deluge. Grad the torrent file from &lt;a href=&quot;https://www.ubuntu.com/download/alternative-downloads&quot;&gt;Ubuntu Alternative Downloads&lt;/a&gt; and make sure you get the correct version. I will be using &lt;strong&gt;Ubuntu 16.04.4 Desktop (64-bit)&lt;/strong&gt;. Next, use a utility like Rufus to put the ISO image on a USB drive. Then you will need to boot into the USB that contains the ISO image. At this point, you need to make some decisions about where to install Ubuntu. I select the &lt;em&gt;Do something else&lt;/em&gt; option that allows me to create partition tables.&lt;/p&gt;

&lt;p&gt;Here is how I partitioned my drive using a 240GB SSD:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;200MB&lt;/code&gt; - &lt;code class=&quot;highlighter-rouge&quot;&gt;efi boot&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1MB&lt;/code&gt; - &lt;code class=&quot;highlighter-rouge&quot;&gt;swap area&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;40GB&lt;/code&gt; - &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;185GB&lt;/code&gt; - &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
brian@brian-ThinkPad-T430:~$ df -h | grep sdb
/dev/sdb1             188M  3.4M  184M   2% /boot/efi
/dev/sdb3              37G  5.3G   30G  16% /
/dev/sdb4             183G  2.3G  171G   2% /home
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;ubunutu-software&quot;&gt;Ubunutu Software&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Chrome&lt;/li&gt;
  &lt;li&gt;VSCode&lt;/li&gt;
  &lt;li&gt;Gimp&lt;/li&gt;
  &lt;li&gt;Blender&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;git&quot;&gt;git&lt;/h3&gt;

&lt;p&gt;Install and configure git with the following commands:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install git 
$ git config --global user.name &quot;John Doe&quot;
$ git config --global user.email johndoe@example.com
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;curl&quot;&gt;curl&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt install curl
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;npm&quot;&gt;npm&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
$ sudo apt-get install -y nodejs
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;vim&quot;&gt;vim&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt install vim
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;ssh-keys-for-github&quot;&gt;SSH Keys for github&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
brian@brian-ThinkPad-T430:~$ ssh-keygen -t rsa -C &quot;briancaffey2010@gmail.com&quot;
[sudo] password for brian: 
Generating public/private rsa key pair.
Enter file in which to save the key (/home/brian/.ssh/id_rsa): 
Created directory &#39;/home/brian/.ssh&#39;.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/brian/.ssh/id_rsa.
Your public key has been saved in /home/brian/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:DSFNVSFDLKUVSIVUHTR98948W498FH54W54H/g briancaffey2010@gmail.com
The key&#39;s randomart image is:
+---[RSA 2048]----+
| o=v++o.         |
|..D-*. o         |
|+. .O.+ o .      |
|o+ * x = * .     |
|- o X . S .      |
| B = +   o       |
|  o =            |
|   + .           |
|                 |
+----[SHA256]-----+
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To get the public key, run:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
brian@brian-ThinkPad-T430:~$ cat ~/.ssh/id_rsa.pub
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://security.stackexchange.com/questions/120706/why-would-i-sign-my-git-commits-with-a-gpg-key-when-i-already-use-an-ssh-key-to&quot;&gt;Why you should have both GPG and SSH&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;gpg-key-for-github&quot;&gt;GPG Key for github&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ gpg --gen-key
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
$ gpg --list-secret-keys --keyid-format LONG
brian@brian-ThinkPad-T430:~/Documents$ gpg --list-secret-keys --keyid-format LONG
/home/brian/.gnupg/secring.gpg
------------------------------
sec   2048R/A4E10BFF341S64V3 2018-03-06
uid                          Brian Caffey (t430 key) &amp;lt;briancaffey2010@gmail.com&amp;gt;
ssb   2048R/49B26066D2G5E456 2018-03-06
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Finally, print out the key and add it to github.&lt;/p&gt;

&lt;p&gt;```terminal
$ gpg â€“armor â€“export A4E10BFF341S64V3
â€”â€“BEGIN PGP PUBLIC KEY BLOCKâ€”â€“
Version: GnuPG v1&lt;/p&gt;

&lt;p&gt;UREFLIUWFWOI8F98F98U459FU43982U4F98UP9432UFP98U4
[â€¦]
FWERO8FEFPHHSLIREUFHWEIRHUFWREHWRLFUWH5LIFU4H5F=
=6H/K
â€”â€“END PGP PUBLIC KEY BLOCKâ€”â€“
```&lt;/p&gt;

&lt;h3 id=&quot;jekyll-ruby-based-static-blog-generator&quot;&gt;Jekyll (Ruby-based static blog generator)&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install ruby ruby-dev make gcc
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We need to reinstall Ruby to fix permission issues:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get remove ruby
$ git clone https://github.com/rbenv/rbenv.git ~/.rbenv
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Follow instructions on &lt;a href=&quot;https://stackoverflow.com/questions/37720892/you-dont-have-write-permissions-for-the-var-lib-gems-2-3-0-directory&quot;&gt;this SO post&lt;/a&gt; to install a newer version of Ruby with rbenv.&lt;/p&gt;

&lt;p&gt;```
cd $HOME
sudo apt-get update 
sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev&lt;/p&gt;

&lt;p&gt;git clone https://github.com/rbenv/rbenv.git ~/.rbenv
echo â€˜export PATH=â€$HOME/.rbenv/bin:$PATHâ€â€™ Â» ~/.bashrc
echo â€˜eval â€œ$(rbenv init -)â€â€™ Â» ~/.bashrc
exec $SHELL&lt;/p&gt;

&lt;p&gt;git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
echo â€˜export PATH=â€$HOME/.rbenv/plugins/ruby-build/bin:$PATHâ€â€™ Â» ~/.bashrc
exec $SHELL&lt;/p&gt;

&lt;p&gt;rbenv install 2.3.1
rbenv global 2.3.1
ruby -v
```&lt;/p&gt;

&lt;p&gt;Note: This failed:&lt;/p&gt;

&lt;p&gt;```
$ rbenv install 2.3.1
Downloading ruby-2.3.1.tar.bz2â€¦
-&amp;gt; https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.bz2
Installing ruby-2.3.1â€¦&lt;/p&gt;

&lt;p&gt;BUILD FAILED (Ubuntu 16.04 using ruby-build 20180224)&lt;/p&gt;

&lt;p&gt;Inspect or clean up the working tree at /tmp/ruby-build.20180306153138.18887
Results logged to /tmp/ruby-build.20180306153138.18887.log&lt;/p&gt;

&lt;p&gt;Last 10 log lines:
The Ruby openssl extension was not compiled.
The Ruby readline extension was not compiled.
The Ruby zlib extension was not compiled.
ERROR: Ruby install aborted due to missing extensions
Try running &lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get install -y libssl-dev libreadline-dev zlib1g-dev&lt;/code&gt; to fetch missing dependencies.&lt;/p&gt;

&lt;p&gt;Configure options used:
  â€“prefix=/home/brian/.rbenv/versions/2.3.1
  LDFLAGS=-L/home/brian/.rbenv/versions/2.3.1/lib 
  CPPFLAGS=-I/home/brian/.rbenv/versions/2.3.1/include 
```&lt;/p&gt;

&lt;p&gt;As the message recommends, we should install some missing dependencies:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install -y libssl-dev libreadline-dev zlib1g-dev
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;And now it should work:&lt;/p&gt;

&lt;p&gt;```
$ rbenv install 2.3.1
Downloading ruby-2.3.1.tar.bz2â€¦
-&amp;gt; https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.bz2
Installing ruby-2.3.1â€¦
Installed ruby-2.3.1 to /home/brian/.rbenv/versions/2.3.1&lt;/p&gt;

&lt;p&gt;$ 
```&lt;/p&gt;

&lt;p&gt;Finally, run:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ rbenv global 2.3.1
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;install-jekyll&quot;&gt;Install Jekyll&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ gem install jekyll bundler
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;node-permission-issues&quot;&gt;Node permission issues&lt;/h3&gt;

&lt;p&gt;(Following steps from &lt;a href=&quot;http://nodesource.com/blog/installing-node-js-tutorial-using-nvm-on-mac-os-x-and-ubuntu/&quot;&gt;this article&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I need root permission to run &lt;code class=&quot;highlighter-rouge&quot;&gt;npm install -g ...&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;First, remove &lt;code class=&quot;highlighter-rouge&quot;&gt;nodejs&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;npm&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get remove nodejs
$ sudo apt-get remove npm
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Then, update:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get update
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now we can install &lt;code class=&quot;highlighter-rouge&quot;&gt;nvm&lt;/code&gt; (Node Version Manager):&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, reload &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.bashrc&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ source ~/.bashrc
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now we can run &lt;code class=&quot;highlighter-rouge&quot;&gt;nvm&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ nvm --version
0.33.0
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now we can install &lt;code class=&quot;highlighter-rouge&quot;&gt;nodejs&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ nvm install node
Downloading and installing node v9.7.1...
Downloading https://nodejs.org/dist/v9.7.1/node-v9.7.1-linux-x64.tar.xz...
######################################################################## 100.0%
Computing checksum with sha256sum
Checksums matched!
Now using node v9.7.1 (npm v5.6.0)
Creating default alias: default -&amp;gt; node (-&amp;gt; v9.7.1)
brian@brian-ThinkPad-T430:~$ 
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now we can try to install something with node, like &lt;code class=&quot;highlighter-rouge&quot;&gt;create-react-app&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
brian@brian-ThinkPad-T430:~$ npm install -g create-react-app
/home/brian/.nvm/versions/node/v9.7.1/bin/create-react-app -&amp;gt; /home/brian/.nvm/versions/node/v9.7.1/lib/node_modules/create-react-app/index.js
+ create-react-app@1.5.2
added 114 packages in 6.634s
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;utilities&quot;&gt;Utilities&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install htop
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;compizconfig&quot;&gt;CompizConfig&lt;/h3&gt;

&lt;p&gt;For:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;changing UI&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;settings&quot;&gt;Settings&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;keyboard speed&lt;/li&gt;
  &lt;li&gt;mouse speed&lt;/li&gt;
  &lt;li&gt;workspaces shortcuts&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;python-3-python-36&quot;&gt;Python 3, Python 3.6&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt install virtualenv
$ virtualenv -p python3 venv
Already using interpreter /usr/bin/python3
Using base prefix &#39;/usr&#39;
New python executable in /home/brian/Documents/python/venv/bin/python3
Also creating executable in /home/brian/Documents/python/venv/bin/python
Installing setuptools, pkg_resources, pip, wheel...done.
$ source venv/bin/activate
(venv) $ python -V
Python 3.5.2
(venv) $ deactivate 
$ python -V
Python 2.7.12
$ source venv/bin/activate
(venv) $ 
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Install &lt;code class=&quot;highlighter-rouge&quot;&gt;python3-pip&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install python3-pip
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If we run &lt;code class=&quot;highlighter-rouge&quot;&gt;pip freeze&lt;/code&gt;, we will see &lt;code class=&quot;highlighter-rouge&quot;&gt;pkg-resources==0.0.0&lt;/code&gt;. See this note about &lt;a href=&quot;https://stackoverflow.com/questions/39577984/what-is-pkg-resources-0-0-0-in-output-of-pip-freeze-command&quot;&gt;what &lt;code class=&quot;highlighter-rouge&quot;&gt;pkg-resources==0.0.0&lt;/code&gt;&lt;/a&gt; is.&lt;/p&gt;

&lt;h3 id=&quot;python-36&quot;&gt;Python 3.6&lt;/h3&gt;

&lt;p&gt;We can install a newer version of Python (3.6) to use with Anaconda. Instructions are &lt;a href=&quot;https://askubuntu.com/questions/865554/how-do-i-install-python-3-6-using-apt-get&quot;&gt;in this Ask Ubuntu post&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get update
sudo apt-get install python3.6
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;After running these commands, we can now use Python3.6:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
brian@brian-ThinkPad-T430:~/Documents/python/demo$ python3.6
Python 3.6.4 (default, Jan 28 2018, 17:52:01) 
[GCC 5.4.0 20160609] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import sys; print(sys.version)
3.6.4 (default, Jan 28 2018, 17:52:01) 
[GCC 5.4.0 20160609]
&amp;gt;&amp;gt;&amp;gt; 
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;anaconda&quot;&gt;Anaconda&lt;/h3&gt;

&lt;p&gt;Now letâ€™s install the Anaconda distribution of Python. First, download the Linux Installer from &lt;a href=&quot;https://www.anaconda.com/download/#linux&quot;&gt;https://www.anaconda.com/download/#linux&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Then, run:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ bash ~/Downloads/Anaconda3-5.1.0-Linux-x86_64.sh
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;postgresql&quot;&gt;Postgresql&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-get install postgresql postgresql-contrib
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s how to access Postgres:&lt;/p&gt;

&lt;p&gt;```
brian@brian-ThinkPad-T430:~$ sudo -i -u postgres
postgres@brian-ThinkPad-T430:~$ psql
psql (9.5.12)
Type â€œhelpâ€ for help.&lt;/p&gt;

&lt;p&gt;postgres=# \q
postgres@brian-ThinkPad-T430:~$ exit
logout
```&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo -u postgres psql
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;More information on postgresql &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04&quot;&gt;in this DigitalOcean article&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;brightness-controller&quot;&gt;Brightness Controller&lt;/h3&gt;

&lt;p&gt;This is a must-have program that is similar to flux:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo add-apt-repository ppa:apandada1/brightness-controller
$ sudo apt-get update
$ sudo apt-get install brightness-controller
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;obs&quot;&gt;OBS&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo apt-add-repository ppa:obsproject/obs-studio
$ sudo apt-get update
$ sudo apt-get install ffmpeg obs-studio
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;neofetch&quot;&gt;neofetch&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ sudo add-apt-repository ppa:dawidd0811/neofetch
$ sudo apt update
$ sudo apt install neofetch
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;disabling-whoopsie&quot;&gt;Disabling whoopsie&lt;/h3&gt;

&lt;p&gt;Hereâ€™s an &lt;a href=&quot;https://askubuntu.com/questions/135540/what-is-the-whoopsie-process-and-how-can-i-remove-it&quot;&gt;Ask Ubuntu post about how to disable &lt;code class=&quot;highlighter-rouge&quot;&gt;whoopsie&lt;/code&gt;&lt;/a&gt;, an error reporting daemon that ships with Ubuntu.&lt;/p&gt;
</description>
        <pubDate>Thu, 01 Mar 2018 00:00:00 -0500</pubDate>
        <link>/2018/03/01/ubuntu-installation-and-setup-notes.html</link>
        <guid isPermaLink="true">/2018/03/01/ubuntu-installation-and-setup-notes.html</guid>
        
        
      </item>
    
      <item>
        <title>Display, filter and export geographical data in a Django app with Leaflet, Mapbox, DataTables, Bootstrap 4 and Travis-CI</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/map_entire.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;live-demo-on-digitaloceanhttp15989235193books&quot;&gt;&lt;a href=&quot;http://159.89.235.193/books/&quot;&gt;Live Demo on DigitalOcean&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;This post is a review of my first attempt at using geographical data in a Django project. I have been interested in working with map APIs, and I once looked into the Google Maps API. For this project I chose to use &lt;a href=&quot;http://leafletjs.com/&quot;&gt;Leaflet&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;an open-source JavaScript library for mobile-friendly interactive maps&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Getting started with Leaflet is easy. All you need to do is request a public Mapbox API key which is free (with no credit card required). You can get a key from &lt;a href=&quot;https://www.mapbox.com/account/access-tokens/&quot;&gt;https://www.mapbox.com/account/access-tokens/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Then you will follow steps on the &lt;a href=&quot;http://leafletjs.com/examples/quick-start/&quot;&gt;quickstart guide&lt;/a&gt; and replace &lt;code class=&quot;highlighter-rouge&quot;&gt;your.mapbox.access.token&lt;/code&gt; with your Mapbox API key.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;javascript
L.tileLayer(&#39;https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}&#39;, {
    attribution: &#39;Map data &amp;amp;copy; &amp;lt;a href=&quot;http://openstreetmap.org&quot;&amp;gt;OpenStreetMap&amp;lt;/a&amp;gt; contributors, &amp;lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&amp;gt;CC-BY-SA&amp;lt;/a&amp;gt;, Imagery Â© &amp;lt;a href=&quot;http://mapbox.com&quot;&amp;gt;Mapbox&amp;lt;/a&amp;gt;&#39;,
    maxZoom: 18,
    id: &#39;mapbox.streets&#39;,
    accessToken: &#39;your.mapbox.access.token&#39;
}).addTo(mymap);
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Iâ€™ll come back to using Leaflet later on, and also show how to use Leaflet plugins that can be used to add functionality such as aggregating markers on a map.&lt;/p&gt;

&lt;h2 id=&quot;django-model&quot;&gt;Django model&lt;/h2&gt;

&lt;p&gt;Next, letâ€™s look at the Django setup. For now Iâ€™m simply working with a local project and SQLite3 backend.&lt;/p&gt;

&lt;p&gt;To store latitude and longitude data, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;DecimalField&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
class Book(models.Model):
    title = models.CharField(max_length=300)
    lat = models.DecimalField(max_digits=9, decimal_places=6)
    lon = models.DecimalField(max_digits=9, decimal_places=6)
    [...]
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This allows us to store numbers to six decimal places. The difference between 0 and 0.00001 is about 3 feet, so this gives us plenty of accuracy for our geographical coordinate data.&lt;/p&gt;

&lt;h2 id=&quot;plotting-books-on-a-map&quot;&gt;Plotting books on a map&lt;/h2&gt;

&lt;p&gt;Plotting our books on a map is fairly straightforward, but there were a few obstacles to work around. Initially I setup an additional endpoint that returned an AJAX response with the longitude, latitude, title and link for each book. The &lt;code class=&quot;highlighter-rouge&quot;&gt;success&lt;/code&gt; function in the AJAX call then passed the returned JSON into a function that populated the book data in the map.&lt;/p&gt;

&lt;p&gt;The main &lt;code class=&quot;highlighter-rouge&quot;&gt;books&lt;/code&gt; page displays book data in two places: on the map and on the DataTable below the map. Since I was already making one database query for DataTables, I decided to reuse this data for the map and not use a separate request and database query. There are a few helpful idioms in Python and JavaScript to accomplish this.&lt;/p&gt;

&lt;p&gt;First, letâ€™s look at the request with some added comments:&lt;/p&gt;

&lt;p&gt;```python
def all_books(request):
    â€œâ€â€
    Main view for books. request.GET parameters are used to filter books
    â€œâ€â€
    books = Book.objects.all()
    form = QueryForm(request.GET or None)
    paramDict = request.GET&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;books = filter_books(books, paramDict)

page_count = books.aggregate(Sum(&#39;pages&#39;))

# This takes the first book query an reformats the data so it can be read
# by the map script on the frontend. 
map_books = [{&#39;loc&#39;:[float(book.lon), float(book.lat)], 
              &#39;title&#39;:book.title,
              &#39;url&#39;:book.get_absolute_url()} for book in books]
context = {
    &#39;books&#39;:books,
    # Here, we apply `json.dumps`, `escapejs` and `marksafe` for security 
    # and proper formatting
    &#39;map_books&#39;: mark_safe(escapejs(json.dumps(map_books))),
    &#39;page_count&#39;:page_count[&#39;pages__sum&#39;], 
    &#39;form&#39;:form}
return render(request, &#39;books/books.html&#39;, context)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;On the frontend, I passed the &lt;code class=&quot;highlighter-rouge&quot;&gt;map_books&lt;/code&gt; variable to the template like this:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;javascript
var map_books =  JSON.parse(&#39;&#39;)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now that I have &lt;code class=&quot;highlighter-rouge&quot;&gt;map_books&lt;/code&gt; as a JavaScript object, I can simply pass it into the map function that populates data in the Leaflet map. Hereâ€™s the function that does that:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;javascript
function populateMap(data){
    for(i in data) {
    var title = data[i].title,	//value searched
        loc = data[i].loc,		//position found
        url = data[i].url,
        marker = new L.Marker(new L.latLng(loc), {title: title, icon: bookIcon} );//se property searched
    marker.bindPopup(&#39;&amp;lt;p&amp;gt;&amp;lt;a href=&quot;&#39;+ url + &#39;&quot;&amp;gt;&#39; + title + &#39;&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&#39;);
    markersLayer.addLayer(marker);
    }
}
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This adds our markers to the map, and also passes link and title data to the popup box when a marker is clicked.&lt;/p&gt;

&lt;p&gt;Hereâ€™s the entire script that is used to populate map data:&lt;/p&gt;

&lt;p&gt;```html
&lt;script&gt;&lt;/script&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var mymap = new L.Map(&#39;mapid&#39;, {zoom: 9, center: new L.latLng([40,13]) });	//set center from first location

L.tileLayer(&#39;https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}&#39;, {
    attribution: &#39;Map data &amp;amp;copy; &amp;lt;a href=&quot;http://openstreetmap.org&quot;&amp;gt;OpenStreetMap&amp;lt;/a&amp;gt; contributors, &amp;lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&amp;gt;CC-BY-SA&amp;lt;/a&amp;gt;, Imagery Â© &amp;lt;a href=&quot;http://mapbox.com&quot;&amp;gt;Mapbox&amp;lt;/a&amp;gt;&#39;,
    maxZoom: 18,
    id: &#39;mapbox.streets&#39;,
    accessToken: &#39;pk.eyJ1IjoiYnJpYW5jYWZmZXkiLCJhIjoiY2pkczJycjl5MmhqbTMzbzQ3bHJuaHA3aiJ9.cvRYYPNjQJVpFjdUcmIHzA&#39;
}).addTo(mymap);

var bookIcon = L.icon({
    iconUrl: &#39;/static/images/marker-icon.png&#39;,
    iconSize:     [35, 35], // size of the icon
    iconAnchor:   [17, 35], // point of the icon which will correspond to marker&#39;s location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
    });

var markersLayer = L.markerClusterGroup();

mymap.addLayer(markersLayer);

var controlSearch = new L.Control.Search({
    position:&#39;topright&#39;,		
    layer: markersLayer,
    initial: false,
    zoom: 12,
    marker: false
});

mymap.addControl( controlSearch );

function populateMap(data){
    for(i in data) {
    var title = data[i].title,	//value searched
        loc = data[i].loc,		//position found
        url = data[i].url,
        marker = new L.Marker(new L.latLng(loc), {title: title, icon: bookIcon} );//se property searched
    marker.bindPopup(&#39;&amp;lt;p&amp;gt;&amp;lt;a href=&quot;&#39;+ url + &#39;&quot;&amp;gt;&#39; + title + &#39;&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&#39;);
    markersLayer.addLayer(marker);
    }
}

// use context variable instead of making AJAX call 
var map_books =  JSON.parse(&#39;{{ map_books }}&#39;)
var new_lat = map_books[0].loc[0]
var new_lon = map_books[0].loc[1]
mymap.setView([0, 0], 2);
populateMap(map_books)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&amp;lt;/script&amp;gt;
```&lt;/p&gt;

&lt;h2 id=&quot;login-redirect&quot;&gt;Login Redirect&lt;/h2&gt;

&lt;p&gt;I wanted to include a small note on a simple issue that I previously had trouble with, which is using the &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; parameter to do a redirect to a page that an unauthenticated user will be redirected to after they successfully login.&lt;/p&gt;

&lt;p&gt;Hereâ€™s the login view:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
def login_view(request):
	next_redirect = request.GET.get(&#39;next&#39;)
	form = UserLoginForm(request.POST or None)
	if form.is_valid():
		next_redirect = request.POST.get(&#39;next&#39;)
		username = form.cleaned_data.get(&#39;username&#39;)
		password = form.cleaned_data.get(&#39;password&#39;)
		user = authenticate(username=username, password=password)
		login(request, user)
		print(next_redirect)
		if next_redirect != &#39;None&#39;:
			return redirect(next_redirect)
		return redirect(&#39;books:all&#39;)
	context = { &#39;form&#39;:form, &#39;next&#39;:next_redirect }
	return render(request, &#39;accounts/login_form.html&#39;, context)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Notice that I pass &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; as a context variable. I use this in the login form here:&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;
&lt;form method=&quot;POST&quot; action=&quot;.&quot;&gt;
{% csrf_token %}
{{ form | crispy }}
&lt;input type=&quot;hidden&quot; value=&quot;{{ next }}&quot; name=&quot;next&quot; /&gt;
&lt;div class=&quot;login-center&quot;&gt;
    &lt;input class=&quot;btn btn-success login-center&quot; type=&quot;submit&quot; value=&quot;Login&quot; /&gt;
&lt;/div&gt;
&lt;br /&gt;  or &lt;a href=&quot;{% url &#39;accounts:register&#39; %}&quot;&gt;create an account&lt;/a&gt;
&lt;/form&gt;
&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;By passing this as a hidden value to the form, when a &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt; request is made, we are redirected to the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; if it is not &lt;code class=&quot;highlighter-rouge&quot;&gt;None&lt;/code&gt;, or if there is no redirect.&lt;/p&gt;

&lt;p&gt;When a &lt;code class=&quot;highlighter-rouge&quot;&gt;@login_required&lt;/code&gt; decorator is used, and we want to access a url such as &lt;code class=&quot;highlighter-rouge&quot;&gt;/books/add&lt;/code&gt;, we are redirected to a url that looks like this:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;html
http://localhost:8000/accounts/login/?next=/books/new/
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;In this way we can pass the next parameter from the &lt;code class=&quot;highlighter-rouge&quot;&gt;GET&lt;/code&gt; request to the &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt; request that is made when the login view is hit.&lt;/p&gt;

&lt;h2 id=&quot;authors&quot;&gt;Authors&lt;/h2&gt;

&lt;p&gt;For illustration purposes, I included an &lt;code class=&quot;highlighter-rouge&quot;&gt;Author&lt;/code&gt; model. Since a book can have zero, one or many Authors, I used a many-to-many relationship to link authors to books. Here is how we do this in our Book model:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
class Book(models.Model):
    [...other fields...]
    authors = models.ManyToManyField(&#39;authors.Author&#39;)  
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This dot notation with &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;authors.Author&#39;&lt;/code&gt; is important. Previously I would have just imported the &lt;code class=&quot;highlighter-rouge&quot;&gt;Author&lt;/code&gt;model and then referenced that in the ManyToManyField. However, this can lead to circular import errors which are hard to debug unless you know what a circular import is.&lt;/p&gt;

&lt;p&gt;Now letâ€™s look at how to find all &lt;code class=&quot;highlighter-rouge&quot;&gt;Books&lt;/code&gt; by a certain author, as well as all &lt;code class=&quot;highlighter-rouge&quot;&gt;Authors&lt;/code&gt; of a given book. Uing the Django shell, we can do the following:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
from authors.models import Author
from books.models import Book
a = Author.objects.all().first()
a.book_set.values()
&amp;lt;QuerySet [{&#39;id&#39;: 583, &#39;title&#39;: &#39;None Or Other&#39;, &#39;lat&#39;: Decimal(&#39;-118.035345&#39;), &#39;lon&#39;: Decimal(&#39;34.139729&#39;), &#39;pages&#39;: 1881, &#39;publish_date&#39;: datetime.date(2018, 3, 18), &#39;website&#39;: &#39;https://www.fleming-mitchell.com/&#39;, &#39;synopsis&#39;: &#39;Option ever large throw dinner worker ahead realize clearly congress as smile size spend expert chair well. Brother item win follow hope coach garden later arrive who if ago voice analysis simply reflect. Amount under data drug kind book fish still information president minute stage dog. Focus full green society parent door according my management sell arrive only send international tonight. Player character financial detail oil check bring pressure possible former. Learn politics compare position large loss exactly probably approach physical international machine as model. &#39;, &#39;slug&#39;: &#39;none-or-other&#39;, &#39;status&#39;: True}, {&#39;id&#39;: 601, &#39;title&#39;: &#39;Teacher Them Step&#39;, &#39;lat&#39;: Decimal(&#39;-80.268357&#39;), &#39;lon&#39;: Decimal(&#39;26.661763&#39;), &#39;pages&#39;: 206, &#39;publish_date&#39;: datetime.date(2018, 2, 27), &#39;website&#39;: &#39;http://www.rodriguez.net/&#39;, &#39;synopsis&#39;: &#39;Drug fact behavior environment green try account where training brother building particular window even reach. Pressure lawyer dog world thought near institution we get force market can guy receive matter structure research foot of small. Professor production very this practice car wind wish relationship after follow professor news card concern media property have. According majority owner go mention reach store computer project kitchen group quality present several another time school and will. Before during central artist page only health region happen share traditional section well out human. Mention quite short race only education heavy book up recent official here spring oil buy which language information practice. Time mother better peace girl defense rock mr never feeling tax city stock bar tv others right conference skin. &#39;, &#39;slug&#39;: &#39;teacher-them-step&#39;, &#39;status&#39;: True}]&amp;gt;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This gave us two books by an author.&lt;/p&gt;

&lt;p&gt;Now, letâ€™s look at how to find all authors of a given book. For this example, we can get authors directly in the template from a book object. This example come from the &lt;code class=&quot;highlighter-rouge&quot;&gt;book_detail&lt;/code&gt; template:&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;
&lt;h3&gt;
    Authors: 
        {% for author in book.authors.all %}
            &lt;a href=&quot;{% url &#39;authors:author_detail&#39; id=author.id %}&quot;&gt;{{ author.full_name }}&lt;/a&gt;
        {% endfor %}
&lt;/h3&gt;
&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We could just as well access &lt;code class=&quot;highlighter-rouge&quot;&gt;books.authors.all&lt;/code&gt; in the view and pass authors in a variable that we can iterate over in the template, but this keeps things simpler without much more code to write.&lt;/p&gt;

&lt;h2 id=&quot;filtering-data&quot;&gt;Filtering Data&lt;/h2&gt;

&lt;p&gt;One other question I wanted to answer with this project is how to do relatively complex data filtering. To do this, I used Django forms to create a form that calls a &lt;code class=&quot;highlighter-rouge&quot;&gt;GET&lt;/code&gt; request to the same view it came from, which is to say, a filter form on the template for the &lt;code class=&quot;highlighter-rouge&quot;&gt;all&lt;/code&gt; books view has a form action with an &lt;code class=&quot;highlighter-rouge&quot;&gt;action&lt;/code&gt; value of the url that returns the &lt;code class=&quot;highlighter-rouge&quot;&gt;all&lt;/code&gt; view.&lt;/p&gt;

&lt;p&gt;Hereâ€™s a look at the form I put together for filtering data:&lt;/p&gt;

&lt;p&gt;```python
class QueryForm(forms.Form):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;publish_date_before = forms.DateField(
    label=&#39;&#39;,
    required=False,
    # initial = datetime.datetime.now(),
    widget = forms.TextInput(
        attrs={
            &#39;class&#39;: &#39;form-control&#39;,
            &#39;id&#39;:&#39;datepicker1&#39;, 
            &#39;placeholder&#39;:&#39;published before&#39;
        }))

publish_date_after = forms.DateField(
    label=&#39;&#39;,
    required=False,
    # initial = datetime.datetime.now(),
    widget = forms.TextInput(
        attrs={
            &#39;class&#39;: &#39;form-control&#39;,
            &#39;id&#39;:&#39;datepicker2&#39;, 
            &#39;placeholder&#39;:&#39;published after&#39;
        }))

keywords = forms.CharField(
    required=False,
    label=&#39;&#39;,
    widget=forms.TextInput(
        
        attrs={
            &#39;class&#39;:&#39;form-control&#39;,
            &#39;placeholder&#39;:&#39;space-separated words matching title, synopsis, website or tags&#39;
        })) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here we are using three fields to filter data, a &lt;code class=&quot;highlighter-rouge&quot;&gt;published_before&lt;/code&gt; date, a &lt;code class=&quot;highlighter-rouge&quot;&gt;published_after&lt;/code&gt; date and a &lt;code class=&quot;highlighter-rouge&quot;&gt;keywords&lt;/code&gt; field.&lt;/p&gt;

&lt;p&gt;Filtering this data can really clog up code in &lt;code class=&quot;highlighter-rouge&quot;&gt;views.py&lt;/code&gt;, and I know I was going to need this same code again for filtering data for CSV and XLS file downloads (more on this in a minute), so I decided to wrote a utility function that takes a &lt;code class=&quot;highlighter-rouge&quot;&gt;Book&lt;/code&gt; queryset and parameter dictionary (&lt;code class=&quot;highlighter-rouge&quot;&gt;request.GET&lt;/code&gt;), and returns a filtered &lt;code class=&quot;highlighter-rouge&quot;&gt;Book&lt;/code&gt; queryset. Hereâ€™s what that function looks like:&lt;/p&gt;

&lt;p&gt;```python
from django.db.models import Q
from functools import reduce
from ..models import Book
import datetime&lt;/p&gt;

&lt;p&gt;def filter_books(books, paramDict):
    # paramDict = request.GET
    params = paramDict.keys()&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# data filtering
if any(x!=&#39;&#39; for x in paramDict.values()):
    if paramDict[&#39;publish_date_after&#39;] != &#39;&#39;:
        after_date = paramDict[&#39;publish_date_after&#39;]
        _after_date = datetime.datetime.strptime(after_date, &#39;%m/%d/%Y&#39;)
    
        books = books.filter(publish_date__gte=_after_date)

    if paramDict[&#39;publish_date_before&#39;] != &#39;&#39;:
        before_date = paramDict[&#39;publish_date_before&#39;]
        _before_date = datetime.datetime.strptime(before_date, &#39;%m/%d/%Y&#39;)
        books = books.filter(publish_date__lte=_before_date)

    # filters records that contain any of the following keywords
    if paramDict[&#39;keywords&#39;] != &#39;&#39;:
        kws = paramDict[&#39;keywords&#39;].split()
        q_lookups = [Q(title__icontains=kw) for kw in kws] + \
                    [Q(synopsis__icontains=kw) for kw in kws] + \
                    [Q(website__icontains=kw) for kw in kws]
        filters = Q()
        filters |= reduce(lambda x, y: x | y, q_lookups)
        books = books.filter(filters)

return books ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This makes things much more simple in our views. Hereâ€™s the code in the main &lt;code class=&quot;highlighter-rouge&quot;&gt;books&lt;/code&gt; view that uses this filter function, truncated for simplicity:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
def all_books(request):
    books = Book.objects.all()
    form = QueryForm(request.GET or None)
    paramDict = request.GET
    books = filter_books(books, paramDict)
    [...]
    context = {
        &#39;books&#39;:books,
        &#39;form&#39;:form, 
        [...],}
    return render(request, &#39;books/books.html&#39;, context)
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;exporting-data-as-csv-or-xls&quot;&gt;Exporting data as CSV or XLS&lt;/h2&gt;

&lt;p&gt;One other requirement I gave myself for this project was giving users the option to export data in CSV or XLS file formats.&lt;/p&gt;

&lt;p&gt;With the filter data function, I was able to keep things DRY (Donâ€™t Repeart Yourself). This task taught me about a few aspects of HTML5 and forms that I wasnâ€™t aware of. First, letâ€™s take a look at the CSV export function that I learned about throught &lt;a href=&quot;https://simpleisbetterthancomplex.com/tutorial/2016/07/29/how-to-export-to-excel.html&quot;&gt;this blog post&lt;/a&gt;, from a great Django blog called &lt;a href=&quot;https://simpleisbetterthancomplex.com/tutorial/2016/07/29/how-to-export-to-excel.html&quot;&gt;Simple is Better than Complex&lt;/a&gt; by &lt;a href=&quot;https://github.com/vitorfs&quot;&gt;Vitor Freitas&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;```python
def export_filtered_books_csv(request):
    response = HttpResponse(content_type=â€™text/csvâ€™)
    response[â€˜Content-Dispositionâ€™] = â€˜attachment; filename=â€books.csvâ€â€™&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;writer = csv.writer(response)
writer.writerow([&#39;Title&#39;, &#39;Synopsis&#39;, &#39;Pages&#39;])
books = Book.objects.all()
paramDict = request.GET
books = filter_books(books, paramDict)
books = books.values_list(
    &#39;title&#39;,
    &#39;synopsis&#39;, 
    &#39;pages&#39;)

for book in books:
    writer.writerow(book)

return response ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I wanted to put this button in the filter form on the main &lt;code class=&quot;highlighter-rouge&quot;&gt;books&lt;/code&gt; page, but I need to place the button outside of the form tag. To get around this, here is the HTML I used:&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;
&lt;form action=&quot;{% url &#39;books:csv&#39; %}&quot;&gt;

    &lt;a class=&quot;btn btn-primary&quot; data-toggle=&quot;collapse&quot; href=&quot;#collapseExample&quot; aria-expanded=&quot;false&quot; aria-controls=&quot;collapseExample&quot;&gt;
        Filter Books
    &lt;/a&gt;
    &lt;input type=&quot;submit&quot; class=&quot;btn btn-info&quot; form=&quot;id_query_form&quot; formaction=&quot;{% url &#39;books:csv&#39; %}&quot; value=&quot;Export CSV&quot; /&gt;
    &lt;input type=&quot;submit&quot; class=&quot;btn btn-default&quot; form=&quot;id_query_form&quot; formaction=&quot;{% url &#39;books:xls&#39; %}&quot; value=&quot;Export XLS&quot; /&gt;
&lt;/form&gt;

&lt;form method=&quot;get&quot; action=&quot;.&quot; id=&quot;id_query_form&quot;&gt;
    &lt;p&gt;
        {{ form.keywords }}
    &lt;/p&gt;
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-md-6&quot;&gt;
            {{ form.publish_date_before }}
        &lt;/div&gt;
        &lt;div class=&quot;col-md-6&quot;&gt;
            {{ form.publish_date_after }}
        &lt;/div&gt;
    &lt;/div&gt;
        
    &lt;p&gt;&lt;/p&gt;
    &lt;p&gt;
        &lt;input class=&quot;btn btn-success&quot; type=&quot;submit&quot; /&gt;
        &lt;button type=&quot;reset&quot; class=&quot;btn btn-info&quot; value=&quot;Reset filters&quot;&gt;Reset filters&lt;/button&gt;
        &lt;button type=&quot;reset&quot; class=&quot;btn btn-warning&quot; id=&quot;id_clear_filters&quot; onclick=&quot;return resetForm(this.form);&quot;&gt;Clear Filters&lt;/button&gt;
    &lt;/p&gt;

&lt;/form&gt;
&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;There are two forms here, but the first form has an &lt;code class=&quot;highlighter-rouge&quot;&gt;input&lt;/code&gt; of &lt;code class=&quot;highlighter-rouge&quot;&gt;type=submit&lt;/code&gt; that references another form with &lt;code class=&quot;highlighter-rouge&quot;&gt;form=&quot;id_query_form&quot;&lt;/code&gt;, and this buttonâ€™s action is the url for the &lt;code class=&quot;highlighter-rouge&quot;&gt;export_filtered_books_csv&lt;/code&gt; function shown above.&lt;/p&gt;

&lt;p&gt;For the filter function, I make a &lt;code class=&quot;highlighter-rouge&quot;&gt;utils&lt;/code&gt; folder in the app I am working with, so the directory structure looks like this (for the &lt;code class=&quot;highlighter-rouge&quot;&gt;books&lt;/code&gt; app):&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
.
â”œâ”€â”€ admin.py
â”œâ”€â”€ apps.py
â”œâ”€â”€ forms.py
â”œâ”€â”€ __init__.py
â”œâ”€â”€ migrations
â”‚Â Â  â”œâ”€â”€ 0001_initial.py
â”‚Â Â  â”œâ”€â”€ 0002_book_authors.py
â”‚Â Â  â””â”€â”€ __init__.py
â”œâ”€â”€ models.py
â”œâ”€â”€ templates
â”‚Â Â  â””â”€â”€ books
â”œâ”€â”€ tests.py
â”œâ”€â”€ urls.py
â”œâ”€â”€ utils
â”‚Â Â  â”œâ”€â”€ filter.py
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â””â”€â”€ nearby.py
â””â”€â”€ views.py
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;I initially had a litte bit of confusion on how to write a simple search query. I wanted a user to be able to enter terms that would return a query set where the items in the query set contained at least on of the terms in at least on of a few different fields (&lt;code class=&quot;highlighter-rouge&quot;&gt;title&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;synopsis&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;website&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;To make this filter, I found a nice idiomatic pattern:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
if paramDict[&#39;keywords&#39;] != &#39;&#39;:
    kws = paramDict[&#39;keywords&#39;].split()
    q_lookups = [Q(title__icontains=kw) for kw in kws] + \
                [Q(synopsis__icontains=kw) for kw in kws] + \
                [Q(website__icontains=kw) for kw in kws]
    filters = Q()
    filters |= reduce(lambda x, y: x | y, q_lookups)
    books = books.filter(filters)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This is good for a small database, but could end up having to do lots of operations, especially if I decided that I want to add more fields to be searched, such as category or tags.&lt;/p&gt;

&lt;p&gt;One option that I have considered to simplify the search query is to make one field called something like &lt;code class=&quot;highlighter-rouge&quot;&gt;search_string&lt;/code&gt;. This field would be modified on &lt;code class=&quot;highlighter-rouge&quot;&gt;save&lt;/code&gt;, and it would simply appends the text from all of the fields Iâ€™m interested in searching. Then, instead of doing Q lookups for each word over many different fields, I could search each word in &lt;code class=&quot;highlighter-rouge&quot;&gt;keywords&lt;/code&gt; over one field. I havenâ€™t implemented this here, but I would like to test this in the future.&lt;/p&gt;

&lt;h2 id=&quot;finding-books-nearby&quot;&gt;Finding â€œBooks Nearbyâ€&lt;/h2&gt;

&lt;p&gt;On the pages that show details for each book I wanted to add additional information. I thought it would be interesting to show the 5 books closest to the book we are currently showing. Since we are dealing with coordinate points on a globe, the best way to calculate distance between two points is to use the Halversine formula:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The haversine formula determines the great-circle distance between two points on a sphere given their longitudes and latitudes. Important in navigation, it is a special case of a more general formula in spherical trigonometry, the law of haversines, that relates the sides and angles of spherical triangles.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/static/great_circle.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s the code I used for calculating distance (using the Halversine formula):&lt;/p&gt;

&lt;p&gt;```python
from math import radians, cos, sin, asin, sqrt&lt;/p&gt;

&lt;p&gt;def distance(origin, destination):
    â€œâ€â€
    Calculate the great circle distance between two points 
    on the earth (specified in decimal degrees)
    â€œâ€â€&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lon1, lat1 = origin
lon2, lat2 = destination
# convert decimal degrees to radians 
lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])
# haversine formula 
dlon = lon2 - lon1 
dlat = lat2 - lat1 
a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2
c = 2 * asin(sqrt(a)) 
r = 3956 # miles
return c * r ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This formula assumes that the earth is a perfect sphere. Another approach would be to use the the Vincety Formula:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Vincentyâ€™s formulae are two related iterative methods used in geodesy to calculate the distance between two points on the surface of a spheroid, developed by Thaddeus Vincenty (1975a). They are based on the assumption that the figure of the Earth is an oblate spheroid, and hence are more accurate than methods that assume a spherical Earth, such as great-circle distance.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This distance is packaged in &lt;code class=&quot;highlighter-rouge&quot;&gt;geopy&lt;/code&gt; and can be calculated easily:&lt;/p&gt;

&lt;p&gt;```python
import geopy.distance&lt;/p&gt;

&lt;p&gt;coords_1 = (52.2296756, 21.0122287)
coords_2 = (52.406374, 16.9251681)&lt;/p&gt;

&lt;p&gt;print geopy.distance.vincenty(coords_1, coords_2).km
```&lt;/p&gt;

&lt;p&gt;Hereâ€™s a look at the function I wrote for the &lt;code class=&quot;highlighter-rouge&quot;&gt;book_detail&lt;/code&gt; view. I have commented out parts that arenâ€™t related to finding nearby books:&lt;/p&gt;

&lt;p&gt;```python
def book_detail(request, id, slug):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;book = Book.objects.get(id=id, slug=slug)
b_coords = (book.lat, book.lon)
all_books = Book.objects.all()
coords = [((b.lat, b.lon),b) for b in all_books]

distance_dict = {}
for c in coords:
    if c[0] != b_coords:
        distance_dict[c[0]]=(distance(c[0],b_coords),c)

sorted_nearby = sorted(distance_dict.items(), key=lambda x: x[1][0])[:5]

# map_book = [{&#39;loc&#39;:[float(book.lon), float(book.lat)], 
#              &#39;title&#39;:book.title, 
#              &#39;url&#39;:book.get_absolute_url()}]
context = {
    &#39;book&#39;:book, 
    # &#39;map_book&#39;:mark_safe(escapejs(json.dumps(map_book))), 
    &#39;sorted_nearby&#39;:sorted_nearby,
}
return render(request, &#39;books/book_detail.html&#39;, context) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;To find the 5 closest books I arrived at a solution that seems fairly convoluted and should be refactored, but works! I start with a queryset of all books, then use list comprehension to make a list of tuples containing &lt;code class=&quot;highlighter-rouge&quot;&gt;((&amp;lt; longitutde &amp;gt;, &amp;lt; latitude &amp;gt;), &amp;lt; Book Object &amp;gt;)&lt;/code&gt;. Then I loop over this list and create a dictionary where the keys are &lt;code class=&quot;highlighter-rouge&quot;&gt;(&amp;lt; longitutde &amp;gt;, &amp;lt; latitude &amp;gt;)&lt;/code&gt; and the values are tuples of the form: &lt;code class=&quot;highlighter-rouge&quot;&gt;(&amp;lt; distance in miles &amp;gt;, &amp;lt; Book Object &amp;gt;)&lt;/code&gt;. Finally, I use &lt;code class=&quot;highlighter-rouge&quot;&gt;sorted&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;dictionary_dict.items()&lt;/code&gt; where the key is &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda x: x[1][0]&lt;/code&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;[1]&lt;/code&gt; accesses the &lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt; of the &lt;code class=&quot;highlighter-rouge&quot;&gt;(&amp;lt; key &amp;gt;, &amp;lt; value&amp;gt;)&lt;/code&gt; tuple returned by &lt;code class=&quot;highlighter-rouge&quot;&gt;items()&lt;/code&gt;, and the &lt;code class=&quot;highlighter-rouge&quot;&gt;[0]&lt;/code&gt; access the first item, which is the &lt;code class=&quot;highlighter-rouge&quot;&gt;distance&lt;/code&gt; value we calculated. Finally, I take the first &lt;code class=&quot;highlighter-rouge&quot;&gt;[:5]&lt;/code&gt; items of this sorted list.&lt;/p&gt;

&lt;p&gt;With this approach I think I avoided the possible issue of ambiguity if we have two books with the same coordinates. Iâ€™ll need to add this scenario to my test suite later.&lt;/p&gt;

&lt;h2 id=&quot;testing--travis-ci&quot;&gt;Testing &amp;amp; Travis CI&lt;/h2&gt;

&lt;p&gt;Speaking of testing, this applcation includes a simple testing suite (that I am currently working on expanding). I have also managed to setup Travis CI for this project. When I push code from my local repo to GitHub, Travis CI automatically runs test, and the commit message contains additional information about whether or not all of the tests were successful.&lt;/p&gt;

&lt;p&gt;Setting up Travis CI is very simple. We need to grant Travis CI (.org) access to our GitHub account, enable Travis CI on the repository we are working with, and then add a &lt;code class=&quot;highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt; file to the top level of the project directory. Hereâ€™s the &lt;code class=&quot;highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt; file I have for this project:&lt;/p&gt;

&lt;p&gt;```yml
language: python&lt;/p&gt;

&lt;p&gt;python:
    - â€œ3.5â€&lt;/p&gt;

&lt;p&gt;services: 
    - postgresql&lt;/p&gt;

&lt;p&gt;env:
    -DJANGO=2.0 DB=postgresql&lt;/p&gt;

&lt;p&gt;install: 
    - pip install -r requirements.txt&lt;/p&gt;

&lt;p&gt;before_script:
    - psql -c â€œCREATE USER u_brian WITH PASSWORD â€˜passwordâ€™; ALTER USER u_brian CREATEDB;â€ -U postgres&lt;/p&gt;

&lt;p&gt;script: 
    - python manage.py test books/
```&lt;/p&gt;

&lt;p&gt;We can generate a Travis CI badge that shows the status of the current Github deploy with the following code:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;html
[![Build Status](https://travis-ci.org/briancaffey/django-leaflet-demo.svg?branch=master)](https://travis-ci.org/briancaffey/django-leaflet-demo)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/briancaffey/django-leaflet-demo&quot;&gt;&lt;img src=&quot;https://travis-ci.org/briancaffey/django-leaflet-demo.svg?branch=master&quot; alt=&quot;Build Status&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;deploying-to-digitalocean&quot;&gt;Deploying to DigitalOcean&lt;/h2&gt;

&lt;p&gt;Finally, I used DigitalOcean to deploy this app. I have used Heroku for most of my previous projects, but I decided to use DigitalOcean for this one to learn something new and get more experience with using Ubuntu and related tools for running a website: nginx and gunicorn.&lt;/p&gt;

&lt;p&gt;Again, for I turned to Vitorâ€™s blog for a very straightforward introduction to deploying on DigitalOcean with a simple Droplet. You can read more about the instructions for deployment &lt;a href=&quot;https://simpleisbetterthancomplex.com/tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html&quot;&gt;here&lt;/a&gt;, and I can say that I had no problems following the instructions step by step. Here are the &lt;code class=&quot;highlighter-rouge&quot;&gt;gunicorn&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; scripts I have used to successfully deploy my project:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;/home/brian/bin/gunicorn_start&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;```bash
#!/bin/bash&lt;/p&gt;

&lt;p&gt;NAME=â€django-leaflet-demoâ€
DIR=/home/brian/django-leaflet-demo
USER=brian
GROUP=brian
WORKERS=3
BIND=unix:/home/brian/run/gunicorn.sock
DJANGO_SETTINGS_MODULE=djangoapp.settings
DJANGO_WSGI_MODULE=djangoapp.wsgi
LOG_LEVEL=error
cd $DIR
source ../bin/activate&lt;/p&gt;

&lt;p&gt;export DJANGO_SETTINGS_MODULE=$DJANGO_SETTINGS_MODULE
export PYTHONPATH=$DIR:$PYTHONPATH&lt;/p&gt;

&lt;p&gt;exec ../bin/gunicorn ${DJANGO_WSGI_MODULE}:application \
  â€“name=$NAME \
  â€“workers=$WORKERS \
  â€“user=$USER \
  â€“group=$GROUP \
  â€“bind=$BIND \
  â€“log-level=$LOG_LEVEL \
  â€“log-file=-
```&lt;/p&gt;

&lt;p&gt;&lt;em&gt;/etc/nginx/sites-available&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;```yml
upstream app_server {
    server unix:/home/brian/run/gunicorn.sock fail_timeout=0;
}&lt;/p&gt;

&lt;p&gt;server {
    listen 80;
    server_name 159.89.235.193
    keepalive_timeout 5;
    client_max_body_size 4G;
    access_log /home/brian/logs/nginx-access.log;
    error_log /home/brian/logs/nginx-error.log;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location /static/ {
    alias /home/brian/static/; }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;location / {
    try_files $uri @proxy_to_app;
}&lt;/p&gt;

&lt;p&gt;location @proxy_to_app {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    proxy_pass http://app_server;
    }
}
```&lt;/p&gt;

&lt;p&gt;Finally, here is the Supervisor configuration file that runs the gunicorn server:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cs
[program:django-leaflet-demo]
command=/home/brian/bin/gunicorn_start
user=brian
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/home/brian/logs/gunicorn-error.log
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;I would definitely like to dive into DigitalOcean deployment in more depth in my next post.&lt;/p&gt;

&lt;p&gt;For now, you can view the live project on DigitalOcean here: &lt;a href=&quot;http://159.89.235.193/books/&quot;&gt;http://159.89.235.193/books/&lt;/a&gt;. In the future I would like to use this Droplet to do more demo apps like this one as I continue to learn the ins and outs of using Django and more frontend tools. Thanks for reading to the end and let me know if you have any comments or critiques on how I went about this project, I would be happy to hear from you!&lt;/p&gt;
</description>
        <pubDate>Mon, 19 Feb 2018 00:00:00 -0500</pubDate>
        <link>/2018/02/19/leaflet-maps-with-django.html</link>
        <guid isPermaLink="true">/2018/02/19/leaflet-maps-with-django.html</guid>
        
        
      </item>
    
      <item>
        <title>Detailed setup of a mini Django News App project with Bootstrap, AJAX, Celery and RabbitMQ</title>
        <description>&lt;p&gt;The Django project started in the news room. This article will offer detailed documentation of the setup process for a simple news application. This project was given as a takehome assignment for another Django position I am interview for. I wonâ€™t focus on any production considerations as this is only a demo project that is supposed to work locally.&lt;/p&gt;

&lt;p&gt;For reference, the code is on &lt;a href=&quot;https://github.com/briancaffey/django-news-app&quot;&gt;this Github repository&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;requirements&quot;&gt;Requirements&lt;/h2&gt;

&lt;p&gt;This project included some interesting requirements that were outside of the scope of simple apps I have put together with Django. Two import ones were page caching and using celery to execute tasks asynchronously. I also set up a unit tests and functional tests and tested the core functionalities of the application. Here are some the basic requirements:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Implement a news model with fields such as title, body, content, author, etc.&lt;/li&gt;
  &lt;li&gt;Display published posts on a page styled with Bootstrap&lt;/li&gt;
  &lt;li&gt;Implement and admin page that allows staff to create and publish posts&lt;/li&gt;
  &lt;li&gt;Cache the public facing home page&lt;/li&gt;
  &lt;li&gt;On the home page use jQuery to poll a URL for updates, and refresh the page if an update is found.&lt;/li&gt;
  &lt;li&gt;Add a button on the public facing page that when pressed launches a celery task that send an email to the site admin.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;release-notes-and-code-snippets&quot;&gt;Release Notes and code snippets&lt;/h2&gt;

&lt;p&gt;Hereâ€™s a quick description of the design decisions I made for the various specifications with code snippets:&lt;/p&gt;

&lt;h4 id=&quot;post-model&quot;&gt;Post Model&lt;/h4&gt;

&lt;p&gt;For the Post model I decided to use two DateTimeFields: &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;timestamp&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;timestamp&lt;/code&gt; is the public-facing time that shows on each article. &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt; is changed when a publish or unpublish action is taken on a Post.&lt;/p&gt;

&lt;p&gt;When a &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt; request is made to the &lt;code class=&quot;highlighter-rouge&quot;&gt;toggle_publish&lt;/code&gt; view, three things happen:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The Postâ€™s &lt;code class=&quot;highlighter-rouge&quot;&gt;published&lt;/code&gt; field is toggled and the Postâ€™s &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt; field is set to the current time.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The only record in &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdate&lt;/code&gt; is updated. This model only contains a &lt;code class=&quot;highlighter-rouge&quot;&gt;DateTimeField&lt;/code&gt; also called &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The cache is cleared, clearing any pages cached from the &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; view.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;home-page&quot;&gt;Home Page&lt;/h4&gt;

&lt;p&gt;For the public facing home page, I return a list of Posts where &lt;code class=&quot;highlighter-rouge&quot;&gt;published&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; and also return a UNIX time epoch of the Post with the most recent &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt; field.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;views.py&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;```python
@cache_page(None)
def home(request):
    â€œâ€â€
    This is the public view that displays only published posts. 
    The view also returns a UNIX timestamp of the most recently updated post.
    This timestamp is compared with the &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdate&lt;/code&gt; value to determine when the page should be refreshed.
    Every 5 seconds, the &lt;code class=&quot;highlighter-rouge&quot;&gt;latest&lt;/code&gt; timestamp is compared with the &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdate&lt;/code&gt; timestamp. 
    If &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdate&lt;/code&gt; is greater that &lt;code class=&quot;highlighter-rouge&quot;&gt;latest&lt;/code&gt;, this implies that a Post has either been published or unpublished.
    â€œâ€â€&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;posts = Post.objects.filter(published=True)
latest = 0
if posts:
    latest = Post.objects.latest(&#39;updated&#39;).unix_time()

return render(request, &#39;posts/home.html&#39;, {&#39;posts&#39;:posts, &#39;latest&#39;:latest}) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;ajax-poll-on-home-page&quot;&gt;AJAX poll on home page&lt;/h4&gt;

&lt;p&gt;I use an AJAX poll that returns a JSON response containing the &lt;code class=&quot;highlighter-rouge&quot;&gt;updated&lt;/code&gt; field of &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdate&lt;/code&gt; as a UNIX time epoch called &lt;code class=&quot;highlighter-rouge&quot;&gt;latest&lt;/code&gt;. I compare this UNIX time epoch with the the UNIX time epoch returned with context data in &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt;. If the &lt;code class=&quot;highlighter-rouge&quot;&gt;latest&lt;/code&gt; value is greater than the the UNIX time stamp of the most recently updated article, then the page is reloaded. At this point, the cache will have been cleared by &lt;code class=&quot;highlighter-rouge&quot;&gt;toggle_publish&lt;/code&gt;, and the new Posts are displayed.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;home.html&lt;/em&gt; (AJAX poll)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;html
&amp;lt;script&amp;gt;
    console.log(&quot;working&quot;)
    poll = function() {
        $.ajax({
        url: &#39;/refresh&#39;,
        dataType: &#39;json&#39;,
        type: &#39;get&#39;,
        success: function(data) {
            var latest = parseInt(data.latest)
            var latest_local = parseInt($(&quot;#last&quot;).attr(&#39;data&#39;))
            if (latest &amp;gt; latest_local + 2){
                location.reload()
            }
        },
        error: function() {
            console.log(&#39;The refresh poll was not successful&#39;);
        }
        });
    },
    pollInterval = setInterval(function() {
        poll();
        }, 5000);
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;views.py&lt;/em&gt; (the view that the AJAX poll requests; return JSON)&lt;/p&gt;

&lt;p&gt;```python
def refresh(request):
    â€œâ€â€
    This is the URL that is polled by the public-facing page.
    It returns a UNIX timestamp of the last time an article was published or unpublished. 
    This timestamp comes from the &lt;code class=&quot;highlighter-rouge&quot;&gt;LastUpdated&lt;/code&gt;, a table that stores and updates only one row with one datetime column.
    Publishing and unpublishing are the only two actions that clear the cached homepage. 
    When the returned UNIX timestamp is greater than the UNIX timestamp of the most recently updated article,
    The page is refreshed with &lt;code class=&quot;highlighter-rouge&quot;&gt;location.reload()&lt;/code&gt;.
    â€œâ€â€&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;t, created = LastUpdate.objects.get_or_create(id=1)
if created:
    t.save()
    t = t.unix_time()
else:
    t = t.unix_time()
latest = int(t) - 2
return JsonResponse({&#39;latest&#39;:int(latest)}) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;email-admin-through-a-celery-task&quot;&gt;Email admin through a celery task&lt;/h4&gt;

&lt;p&gt;The email feature is functional, but the button returns a JSON response that says â€œsuccessfulâ€ if the message was sent to celery. My plan was to make another AJAX call and then updated the &lt;code class=&quot;highlighter-rouge&quot;&gt;Email Admin&lt;/code&gt; link to say &lt;code class=&quot;highlighter-rouge&quot;&gt;Your email was sent.&lt;/code&gt; if it the task was sent the messaging service.&lt;/p&gt;

&lt;p&gt;For details on how celery can be set up with a Django project, I reference on of my favorite Django blogs, &lt;a href=&quot;https://simpleisbetterthancomplex.com/tutorial/2017/08/20/how-to-use-celery-with-django.html&quot;&gt;simpleisbetterthancomplex.com&lt;/a&gt;. This article shows how to set up celery in a Django project and my set up almost exactly mirrors this setup, but my celery task simply sends an email.&lt;/p&gt;

&lt;h4 id=&quot;admin-page&quot;&gt;Admin Page&lt;/h4&gt;

&lt;p&gt;The admin page contains a list of all articles. Each article contains a link to manage publish settings. This calls the &lt;code class=&quot;highlighter-rouge&quot;&gt;toggle_publish&lt;/code&gt; page that displays the selected article and contains a button that says &lt;code class=&quot;highlighter-rouge&quot;&gt;Publish&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;Unpublish&lt;/code&gt; depending on the value of the Postâ€™s &lt;code class=&quot;highlighter-rouge&quot;&gt;published&lt;/code&gt; value.&lt;/p&gt;

&lt;h4 id=&quot;cache&quot;&gt;Cache&lt;/h4&gt;

&lt;p&gt;For caching I chose the memcached backend. Other options included using file caching and database caching, but this seemed to be the simplest approach. I used a decorator function to cache the results of the &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; view.&lt;/p&gt;

&lt;p&gt;Here are some additional notes on how I used caching in this project:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;To cache a page from the &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; view, I used a decorator: &lt;code class=&quot;highlighter-rouge&quot;&gt;from django.views.decorators.cache import cache_page&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
@cache_page(None)
def home(request):
    [...]
&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;We pass the argument of &lt;code class=&quot;highlighter-rouge&quot;&gt;None&lt;/code&gt; so that the page cache does not expire; we will manually clear the cache when a staff member publishes an article.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The first time we access the &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; view, we will see our print statement, in subsequent requests, the cached page will be used and we will not see the print statement.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In order for caching to work we need to add the following to &lt;code class=&quot;highlighter-rouge&quot;&gt;settings.py&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
CACHES = {
    &#39;default&#39;: {
        &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.MemcachedCache&#39;,
        &#39;LOCATION&#39;: &#39;127.0.0.1:11211&#39;,
    }
}
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, we need to install the following packages:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
(virtualenv) $ pip install memcache 
# pacman -S memcached
# systemctl start memcached
# systemctl enable memcached
&lt;/code&gt;&lt;/p&gt;

&lt;h5 id=&quot;clearing-the-cache&quot;&gt;Clearing the cache&lt;/h5&gt;

&lt;p&gt;To clear the cache, we can simply do the following in a view:&lt;/p&gt;

&lt;p&gt;```python
from django.core.cache import cache&lt;/p&gt;

&lt;p&gt;@login_required
def toggle_publish(request,id):
    instance = get_object_or_404(Post, id=id)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if request.method==&quot;POST&quot;:
    instance.published = not instance.published
    instance.save()

    t = LastUpdate.objects.all().first()
    t.updated = instance.updated
    t.save()

    cache.clear()
    return redirect(&#39;posts:home&#39;)

context = {&#39;post&#39;:instance}

return render(request, &#39;posts/publish.html&#39;, context) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cache.clear()&lt;/code&gt; clears the cache, and the &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; view is regenerated from the Queryset and template rather the being served directly from the cache. This newly generated page is then saved to the cache and used on subsequent calls to &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; until the cache is cleared again.&lt;/p&gt;

&lt;h2 id=&quot;basic-setup&quot;&gt;Basic setup&lt;/h2&gt;

&lt;p&gt;Here are the first steps need to set up the project correctly:&lt;/p&gt;

&lt;p&gt;First, letâ€™s start with creating a virtual environment:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ virtualenv -p python3 virtualenv
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, letâ€™s activate the virtual environment with:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
$ source virtualenv/bin/activate
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, letâ€™s install &lt;code class=&quot;highlighter-rouge&quot;&gt;django&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;selenium&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
(virtualenv) $ pip install django selenium
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, letâ€™s start our app:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
(virtualenv) $ django-admin.py startproject news .
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;.&lt;/code&gt; will start the project in the current environment. Letâ€™s take a look at the directory structure:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
(virtualenv) $ tree -L 2
 $ tree -L 2
.
â”œâ”€â”€ manage.py
â”œâ”€â”€ news
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ settings.py
â”‚Â Â  â”œâ”€â”€ urls.py
â”‚Â Â  â””â”€â”€ wsgi.py
â””â”€â”€ virtualenv
    â”œâ”€â”€ bin
    â”œâ”€â”€ include
    â”œâ”€â”€ lib
    â”œâ”€â”€ pip-selfcheck.json
    â””â”€â”€ selenium
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;At this point, we can start the local server:&lt;/p&gt;

&lt;p&gt;```
(virtualenv) $ python manage.py runserver
Performing system checksâ€¦&lt;/p&gt;

&lt;p&gt;System check identified no issues (0 silenced).&lt;/p&gt;

&lt;p&gt;You have 14 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run â€˜python manage.py migrateâ€™ to apply them.&lt;/p&gt;

&lt;p&gt;February 10, 2018 - 02:16:47
Django version 2.0.2, using settings â€˜news.settingsâ€™
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
```&lt;/p&gt;

&lt;p&gt;Now we should see the new Django 2 startup screen in our browser if we navigate to &lt;a href=&quot;&quot;&gt;http://127.0.0.1:8000/&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/static/news/django2.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;testing&quot;&gt;Testing&lt;/h2&gt;

&lt;p&gt;I had a few difficulties setting up selenium testing with this projects. Here the &lt;code class=&quot;highlighter-rouge&quot;&gt;functional_tests.py&lt;/code&gt; file that is hopefully configured correctly:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;functional_tests.py&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;```python
from selenium import webdriver
from django.conf import settings&lt;/p&gt;

&lt;p&gt;import os
os.environ.setdefault(â€˜DJANGO_SETTINGS_MODULEâ€™, â€˜news.settingsâ€™)&lt;/p&gt;

&lt;p&gt;from django.test import LiveServerTestCase
import unittest
import time
import factory&lt;/p&gt;

&lt;p&gt;from django.contrib.auth import get_user_model
from selenium import webdriver&lt;/p&gt;

&lt;p&gt;User = get_user_model()&lt;/p&gt;

&lt;p&gt;class UserFactory(factory.DjangoModelFactory):
    â€œ&quot;â€This class sets up a staff user that we can use for testing using factoryâ€â€â€&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;class Meta:
    model = User

email = &#39;brian@djangonews.com&#39;
username = &#39;brian1&#39;
password = factory.PostGenerationMethodCall(&#39;set_password&#39;, &#39;qwer1234&#39;)

is_superuser = True
is_staff = True
is_active = True
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;class NewsAppTest(LiveServerTestCase):
    â€œ&quot;â€Main Testsâ€â€â€&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def setUp(self):
    self.browser = webdriver.Firefox()
    self.domain = &#39;http://127.0.0.1:8081&#39;
    self.user = UserFactory.create()

def tearDown(self):
    self.browser.quit()


def test_page_title_is_correct(self):
    self.browser.get(self.domain)
    self.assertIn(&#39;Django News&#39;, self.browser.title)


def test_staff_can_create_and_publish_article(self):
    &quot;&quot;&quot;
    Tests the core functionality of a staff member loging in, creating an article, then publishing that article
    &quot;&quot;&quot;

    # staff logs into admin page
    self.browser.get(self.domain+&quot;/admin&quot;)
    self.browser.find_element_by_id(&#39;id_username&#39;).send_keys(&#39;brian1&#39;)
    self.browser.find_element_by_id(&#39;id_password&#39;).send_keys(&#39;qwer1234&#39;)
    self.browser.find_element_by_class_name(&#39;submit-row&#39;).click()

    # navigate to homepage
    self.browser.get(self.domain)
    time.sleep(2)

    # navigate to new article page and write sample article
    self.browser.find_element_by_id(&#39;new-article&#39;).click()
    html = str(self.browser.page_source.encode(&#39;utf-8&#39;))
    self.assertIn(&#39;Write your Django News article here&#39;, html)
    self.browser.find_element_by_id(&#39;id_title&#39;).send_keys(&#39;testing with selenium&#39;)
    self.browser.find_element_by_id(&#39;id_content&#39;).send_keys(&#39;about testing with selenium&#39;)
    self.browser.find_element_by_id(&#39;id_submit&#39;).click()
    html = str(self.browser.page_source.encode(&#39;utf-8&#39;))
    self.assertIn(&#39;publish settings&#39;, html)

    # go back to home page and check that the article is not displayed
    self.browser.get(self.domain)
    html = str(self.browser.page_source.encode(&#39;utf-8&#39;))
    self.assertNotIn(&#39;testing with selenium&#39;, html)

    self.browser.back()

    self.browser.find_element_by_id(&#39;toggle-publish&#39;).click()
    html = str(self.browser.page_source.encode(&#39;utf-8&#39;))
    self.assertIn(&#39;testing with selenium&#39;, html)

def test_public_page_reloads_when_article_is_published(self):
    browser2 = webdriver.Firefox()
    browser2.get(self.domain)
    html = browser2.page_source
    self.test_staff_can_create_and_publish_article()
    time.sleep(2)
    browser2.get(self.domain)
    html_after_publish = browser2.page_source
    self.assertNotEqual(html, html_after_publish)
    browser2.quit()
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;if &lt;strong&gt;name&lt;/strong&gt; == â€œ&lt;strong&gt;main&lt;/strong&gt;â€:
    unittest.main(warnings=â€ignoreâ€)
```&lt;/p&gt;

&lt;p&gt;I used the package called &lt;code class=&quot;highlighter-rouge&quot;&gt;factory_boy&lt;/code&gt; to setup create a user that I could use in my test. This project didnâ€™t include a staff registration page, so to test regular staff functionality I used &lt;code class=&quot;highlighter-rouge&quot;&gt;factory&lt;/code&gt; to create a dummy user that can login and perform tasks.&lt;/p&gt;

&lt;p&gt;For the full repo, please find it on my github account: &lt;a href=&quot;https://github.com/briancaffey/django-news-app&quot;&gt;https://github.com/briancaffey/django-news-app&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Fri, 09 Feb 2018 00:00:00 -0500</pubDate>
        <link>/2018/02/09/a-sample-django-news-app.html</link>
        <guid isPermaLink="true">/2018/02/09/a-sample-django-news-app.html</guid>
        
        
      </item>
    
      <item>
        <title>Reading 13F SEC filings with python</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/sec.jpg&quot; alt=&quot;jpg&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The SEC Form 13F is a filing with the Securities and Exchange Commission (SEC) also known as the Information Required of Institutional Investment Managers Form. It is a quarterly filing required of institutional investment managers with over $100 million in qualifying assets. -&lt;a href=&quot;https://www.investopedia.com/terms/f/form-13f.asp&quot;&gt;Investopedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In this article I will show how to collect and parse 13F filing data from the SEC.&lt;/p&gt;

&lt;p&gt;First, use &lt;a href=&quot;https://www.sec.gov/edgar/searchedgar/companysearch.html&quot;&gt;EDGAR&lt;/a&gt; to search the company of interest.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;EDGAR, the Electronic Data Gathering, Analysis, and Retrieval system, performs automated collection, validation, indexing, acceptance, and forwarding of submissions by companies and others who are required by law to file forms with the U.S. Securities and Exchange Commission (the â€œSECâ€). -&lt;a href=&quot;https://en.wikipedia.org/wiki/EDGAR&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Click on the Central Index Key (CIK) of the company you are search for, and then click on &lt;code class=&quot;highlighter-rouge&quot;&gt;Documents&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Youâ€™ll want to grab the HTML version of the &lt;code class=&quot;highlighter-rouge&quot;&gt;Information Table&lt;/code&gt;. I have saved them in a folder with their file names cooresponding to their dates (&lt;code class=&quot;highlighter-rouge&quot;&gt;YYYY-MM-DD&lt;/code&gt; format).&lt;/p&gt;

&lt;p&gt;For this example, I have manually collected the files for a few years of data filed by a hedge fund. Here are the files Iâ€™ll be working with:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
files = os.listdir(&quot;13f/&quot;)
print(*sorted(files), sep=&quot;\n&quot;)
&lt;/code&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;
2014-02-14.html
2014-05-15.html
2014-08-14.html
2014-11-14.html
2015-02-17.html
2015-05-14.html
2015-08-14.html
2015-11-12.html
2016-02-16.html
2016-05-16.html
2016-08-12.html
2016-11-14.html
2017-02-14.html
2017-05-15.html
2017-08-10.html
2017-10-30.html
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s a quick script we can use to parse information from each filing document:&lt;/p&gt;

&lt;p&gt;```python
def scrape_13f(file):
    date = file
    html = open(â€œ13f/â€+file).read()
    soup = BeautifulSoup(html, â€˜lxmlâ€™)
    rows = soup.find_all(â€˜trâ€™)[11:]
    positions = []
    for row in rows:
        dic = {}
        position = row.find_all(â€˜tdâ€™)
        dic[â€œNAME_OF_ISSUERâ€] = position[0].text
        dic[â€œTITLE_OF_CLASSâ€] = position[1].text
        dic[â€œCUSIPâ€] = position[2].text
        dic[â€œVALUEâ€] = int(position[3].text.replace(â€˜,â€™, â€˜â€™))*1000
        dic[â€œSHARESâ€] = int(position[4].text.replace(â€˜,â€™, â€˜â€™))
        dic[â€œDATEâ€] = date.strip(â€œ.htmlâ€)
        positions.append(dic)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;df = pd.DataFrame(positions)
return df ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Using this function we can get a quick snapshot of this hedge fund by filing total over the last 4 years:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
fund_growth = [sum(scrape_13f(file).VALUE) for file in sorted(files)]
dates = [f.strip(&#39;.html&#39;) for f in sorted(files)]
plt.figure(figsize=(10,5))
plt.title(&#39;Total Fund Size&#39;)
plt.xlabel(&#39;Filing Date&#39;)
plt.ylabel(&#39;USD&#39;)
plt.bar(dates, fund_growth)
plt.yticks()
plt.xticks(rotation=&#39;vertical&#39;)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/static/fund_size.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;fund-positions-with-bubble-chart&quot;&gt;Fund Positions with Bubble Chart&lt;/h2&gt;

&lt;p&gt;Next, it would be great to get a snapshot of the stocks owned by this fund in a given year. Letâ€™s use a D3 bubble chart. The names for each stock are quite long, so first letâ€™s convert them to stock ticker values. Hereâ€™s a quick script I hacked together using a Fidelity lookup service:&lt;/p&gt;

&lt;p&gt;```python
cusip_nums = set()
for file in files:
    cusip_nums = cusip_nums | set(scrape_13f(file).CUSIP)&lt;/p&gt;

&lt;p&gt;ticker_dic = {c:â€â€ for c in cusip_nums}
for c in list(ticker_dic.keys()):
    url = â€œhttp://quotes.fidelity.com/mmnet/SymLookup.phtml?reqforlookup=REQUESTFORLOOKUP&amp;amp;productid=mmnet&amp;amp;isLoggedIn=mmnet&amp;amp;rows=50&amp;amp;for=stock&amp;amp;by=cusip&amp;amp;criteria=â€+c+â€&amp;amp;submit=Searchâ€
    html = requests.get(url).text
    soup = BeautifulSoup(html, â€˜lxmlâ€™)
    ticker_elem = soup.find(â€˜trâ€™, attrs={â€œbgcolorâ€:â€#666666â€})
    ticker = â€œâ€
    try:
        ticker = ticker_elem.next_sibling.next_sibling.find(â€˜aâ€™).text
        ticker_dic[c] = ticker
    except:
        pass&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;time.sleep(1) ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I couldnâ€™t get all the CUSIP numbers, but I was able to get most of them. Some of the CUSIP numbers have changed for certain stocks and couldnâ€™t be looked up with this service. For now I wonâ€™t fill these in. With the &lt;code class=&quot;highlighter-rouge&quot;&gt;ticker_dic&lt;/code&gt; dictionary, we can make a quick edit to our &lt;code class=&quot;highlighter-rouge&quot;&gt;scrape_13f&lt;/code&gt; function to populate ticker data for each holding:&lt;/p&gt;

&lt;p&gt;```python
ticker_dict = {â€˜00206R102â€™: â€˜Tâ€™, â€˜00507V109â€™: â€˜ATVIâ€™, â€˜00724F101â€™: â€˜ADBEâ€™, â€¦ }&lt;/p&gt;

&lt;p&gt;def scrape_13f(file):
    date = file
    html = open(â€œ13f/â€+file).read()
    soup = BeautifulSoup(html, â€˜lxmlâ€™)
    rows = soup.find_all(â€˜trâ€™)[11:]
    positions = []
    for row in rows:
        dic = {}
        position = row.find_all(â€˜tdâ€™)
        dic[â€œNAME_OF_ISSUERâ€] = position[0].text
        dic[â€œTITLE_OF_CLASSâ€] = position[1].text
        dic[â€œCUSIPâ€] = position[2].text
        dic[â€œVALUEâ€] = int(position[3].text.replace(â€˜,â€™, â€˜â€™))*1000
        dic[â€œSHARESâ€] = int(position[4].text.replace(â€˜,â€™, â€˜â€™))
        dic[â€œDATEâ€] = date.strip(â€œ.htmlâ€)
        dic[â€œTICKERâ€] = ticker_dict[position[2].text]
        positions.append(dic)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;df = pd.DataFrame(positions)
return df ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Letâ€™s check this:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
df = scrape_13f(files[2])
print(df[[&quot;CUSIP&quot;, &quot;NAME_OF_ISSUER&quot;, &quot;TICKER&quot;]].head())
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
       CUSIP         NAME_OF_ISSUER TICKER
0  88579Y101                  3M CO    MMM
1  G1151C101  ACCENTURE PLC IRELAND    ACN
2  02209S103       ALTRIA GROUP INC     MO
3  03076C106    AMERIPRISE FINL INC    AMP
4  035710409    ANNALY CAP MGMT INC    NLY
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s take a look at the last filing, Q4 2017.&lt;/p&gt;

&lt;p&gt;```python
q4_2017 = sorted(files)[-1]
df_q4_2017 = scrape_13f(q4_2017)&lt;/p&gt;

&lt;p&gt;top_20 = df_q4_2017.sort_values(by=â€VALUEâ€, ascending=False)[[â€œTICKERâ€, â€œVALUEâ€]][:40]
a = top_20.TICKER
b = top_20.VALUE
c = range(len(b))&lt;/p&gt;

&lt;p&gt;fig = plt.figure(figsize=(15,5))
ax = fig.add_subplot(111)
ax.bar(c, b)&lt;/p&gt;

&lt;p&gt;plt.xticks(c, a, rotation=90)
plt.title(â€˜Top 40 Stock Holdings by Valueâ€™)
plt.xlabel(â€˜Stock Tickerâ€™)
plt.ylabel(â€˜USD (10 MM))â€™)
plt.show()
```&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/static/2017_filing.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Tue, 30 Jan 2018 00:00:00 -0500</pubDate>
        <link>/2018/01/30/reading-13f-sec-filings-with-python.html</link>
        <guid isPermaLink="true">/2018/01/30/reading-13f-sec-filings-with-python.html</guid>
        
        
      </item>
    
      <item>
        <title>How to do simple SQL tasks with MariaDB</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/mariadb.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In this article Iâ€™ll look at another interview takehome assignment. This assignment included SQL, python and some logic puzzles. If you read to the end Iâ€™ll share a fun â€œtrick questionâ€ that was also included.&lt;/p&gt;

&lt;p&gt;I mostly want to talk about the SQL portion of the test. Since I mostly work with postgresql through the Django ORM, this was a good refresher. Iâ€™ll show how I approached some simple SQL tasks, and how to use MariaDB.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;MariaDB&lt;/strong&gt; is the default implementation of MySQL in Arch Linux, provided with the mariadb package.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;the-task&quot;&gt;The Task&lt;/h2&gt;

&lt;p&gt;Here are the three questions I was asked:&lt;/p&gt;

&lt;p&gt;Please reference the 3 tables below.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Using SQL please write the code to generate a table that includes all individuals on the file and contains the following fields: ID, Congressional District, and Gender&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Using SQL please write the code to generate a table that includes only individuals with a gender on file that have a DistrictID of 3. Also please convert the values for Gender from â€œMâ€ and â€œFâ€ to â€œMaleâ€ and â€œFemaleâ€ respectively. Your final table should include only ID and the converted Gender.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Using SQL please generate the code to run a count of gender by Congressional District.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/static/sql.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ID is a unique ID that is applied to each individual on file&lt;/li&gt;
  &lt;li&gt;DistrictID is a unique ID that is applied to each district on  file&lt;/li&gt;
  &lt;li&gt;Gender is a value that is recorded on some records on file&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;install-mysqlmariadb&quot;&gt;Install MySQL/MariaDB&lt;/h3&gt;

&lt;p&gt;First, we need to install MariaDB. As usual, just &lt;a href=&quot;https://wiki.archlinux.org/index.php/MySQL&quot;&gt;follow the Arch Wiki&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;run-mysql&quot;&gt;Run mysql&lt;/h3&gt;

&lt;p&gt;Next, we can run &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; in the terminal:&lt;/p&gt;

&lt;p&gt;```
 $ mysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 18
Server version: 10.1.30-MariaDB MariaDB Server&lt;/p&gt;

&lt;p&gt;Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.&lt;/p&gt;

&lt;p&gt;Type â€˜help;â€™ or â€˜\hâ€™ for help. Type â€˜\câ€™ to clear the current input statement.
```&lt;/p&gt;

&lt;h3 id=&quot;create-and-set-a-database-to-use&quot;&gt;Create &lt;em&gt;and set&lt;/em&gt; a database to use&lt;/h3&gt;

&lt;p&gt;The next step is to create a database. We can do the following:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
MariaDB [(none)]&amp;gt; create database sample_db default character set utf8 default collate utf8_bin;
ERROR 1044 (42000): Access denied for user &#39;&#39;@&#39;localhost&#39; to database &#39;sample_db&#39;
MariaDB [(none)]&amp;gt; Ctrl-C -- exit!
Aborted
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If you see this error, it is because we arenâ€™t using the correct user for SQL. We can use the default root user with no password instead. So here we will rerun the &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; command with additional arguments:&lt;/p&gt;

&lt;p&gt;```
 $ mysql -u root
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 19
Server version: 10.1.30-MariaDB MariaDB Server&lt;/p&gt;

&lt;p&gt;Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.&lt;/p&gt;

&lt;p&gt;Type â€˜help;â€™ or â€˜\hâ€™ for help. Type â€˜\câ€™ to clear the current input statement.&lt;/p&gt;

&lt;p&gt;MariaDB [(none)]&amp;gt; create database sample_db default character set utf8 default collate utf8_bin;
Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;MariaDB [(none)]&amp;gt; use sample_db
Database changed
MariaDB [sample_db]&amp;gt; 
```&lt;/p&gt;

&lt;p&gt;Great, no we are using the blank database called &lt;code class=&quot;highlighter-rouge&quot;&gt;sample_db&lt;/code&gt; and we are using it, notice that &lt;code class=&quot;highlighter-rouge&quot;&gt;[sample_db]&amp;gt;&lt;/code&gt; has repaced &lt;code class=&quot;highlighter-rouge&quot;&gt;[(none)]&amp;gt;&lt;/code&gt; in the MariaDB prompt.&lt;/p&gt;

&lt;h3 id=&quot;create-tables-and-insert-data-into-the-tables&quot;&gt;Create tables and insert data into the tables&lt;/h3&gt;

&lt;p&gt;Now we are read to get going with our questions. Before we write our queries, we need to get the data from the question into our database. To do this I wrote &lt;code class=&quot;highlighter-rouge&quot;&gt;insert.sql&lt;/code&gt; and ran it in MariaDB. Here is the script:&lt;/p&gt;

&lt;p&gt;```
CREATE TABLE table_A (
  ID int,
  District_ID int
  );&lt;/p&gt;

&lt;p&gt;CREATE TABLE table_B (
  District_ID int,
  Congressional_District int
  );&lt;/p&gt;

&lt;p&gt;CREATE TABLE table_C (
  ID int,
  Gender CHAR(1)
  );&lt;/p&gt;

&lt;p&gt;INSERT INTO table_A (ID, District_ID) VALUES (â€˜1â€™, â€˜3â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜2â€™, â€˜3â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜3â€™, â€˜4â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜4â€™, â€˜4â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜5â€™, â€˜3â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜6â€™, â€˜4â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜7â€™, â€˜4â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜8â€™, â€˜3â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜9â€™, â€˜4â€™);
INSERT INTO table_A (ID, District_ID) VALUES (â€˜10â€™, â€˜3â€™);&lt;/p&gt;

&lt;p&gt;INSERT INTO table_B (District_ID, Congressional_District) VALUES (â€˜1â€™, â€˜8â€™);
INSERT INTO table_B (District_ID, Congressional_District) VALUES (â€˜2â€™, â€˜2â€™);
INSERT INTO table_B (District_ID, Congressional_District) VALUES (â€˜3â€™, â€˜14â€™);
INSERT INTO table_B (District_ID, Congressional_District) VALUES (â€˜4â€™, â€˜7â€™);
INSERT INTO table_B (District_ID, Congressional_District) VALUES (â€˜5â€™, â€˜11â€™);&lt;/p&gt;

&lt;p&gt;INSERT INTO table_C (ID, Gender) VALUES (â€˜1â€™, â€˜Mâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜3â€™, â€˜Fâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜4â€™, â€˜Mâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜5â€™, â€˜Fâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜6â€™, â€˜Fâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜7â€™, â€˜Fâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜8â€™, â€˜Mâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜9â€™, â€˜Fâ€™);
INSERT INTO table_C (ID, Gender) VALUES (â€˜10â€™, â€˜Mâ€™);
```&lt;/p&gt;

&lt;p&gt;Now we can run the script with the following command:&lt;/p&gt;

&lt;p&gt;```
MariaDB [sample_db]&amp;gt; source my_sql_script.sql
Query OK, 0 rows affected (0.08 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 0 rows affected (0.07 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 0 rows affected (0.06 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.02 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.00 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.03 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.00 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.02 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;Query OK, 1 row affected (0.01 sec)&lt;/p&gt;

&lt;p&gt;MariaDB [sample_db]&amp;gt; 
```&lt;/p&gt;

&lt;p&gt;Great, now letâ€™s test it out with a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;select * from table_name&lt;/code&gt; command:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
MariaDB [sample_db]&amp;gt; select * from table_A;
+------+-------------+
| ID   | District_ID |
+------+-------------+
|    1 |           3 |
|    2 |           3 |
|    3 |           4 |
|    4 |           4 |
|    5 |           3 |
|    6 |           4 |
|    7 |           4 |
|    8 |           3 |
|    9 |           4 |
|   10 |           3 |
+------+-------------+
10 rows in set (0.00 sec)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This matches what we were given, so now letâ€™s move on to the first task, creating one table from the three we are given.&lt;/p&gt;

&lt;h4 id=&quot;section&quot;&gt;1&lt;/h4&gt;

&lt;p&gt;Using SQL please write the code to generate a table that includes all individuals on the file and contains the following fields: ID, Congressional District, and Gender&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sql
select table_A.ID, Congressional_District, Gender 
from table_A 
  left join table_B 
    on table_A.District_ID = table_B.District_ID 
  left join table_C 
    on table_A.ID = table_C.ID order by ID;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
+------+------------------------+--------+
| ID   | Congressional_District | Gender |
+------+------------------------+--------+
|    1 |                     14 | M      |
|    2 |                     14 | NULL   |
|    3 |                      7 | F      |
|    4 |                      7 | M      |
|    5 |                     14 | F      |
|    6 |                      7 | F      |
|    7 |                      7 | F      |
|    8 |                     14 | M      |
|    9 |                      7 | F      |
|   10 |                     14 | M      |
+------+------------------------+--------+
10 rows in set (0.00 sec)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-1&quot;&gt;2&lt;/h4&gt;

&lt;p&gt;Using SQL please write the code to generate a table that includes only individuals with a gender on file that have a DistrictID of 3. Also please convert the values for Gender from â€œMâ€ and â€œFâ€ to â€œMaleâ€ and â€œFemaleâ€ respectively. Your final table should include only ID and the converted Gender.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sql
select 
  table_A.ID, 
  case 
    when Gender = &quot;M&quot; then &quot;Male&quot; 
    when Gender = &quot;F&quot; then &quot;Female&quot; 
  end as Gender 
from table_A 
  left join table_B 
    on table_A.District_ID = table_B.District_ID 
  left join table_C on table_A.ID = table_C.ID 
where table_A.District_ID = 3 and table_C.Gender is not null 
order by ID;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
+------+--------+
| ID   | Gender |
+------+--------+
|    1 | Male   |
|    5 | Female |
|    8 | Male   |
|   10 | Male   |
+------+--------+
4 rows in set (0.00 sec)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-2&quot;&gt;3&lt;/h4&gt;

&lt;p&gt;Using SQL please generate the code to run a count of gender by Congressional District.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sql
select 
  count(table_C.Gender) Count, 
  Congressional_District, 
  Gender 
from table_A 
  left join table_B 
    on table_A.District_ID = table_B.District_ID 
  left join table_C 
    on table_A.ID = table_C.ID 
group by Congressional_District, Gender;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
+-------+------------------------+--------+
| Count | Congressional_District | Gender |
+-------+------------------------+--------+
|     4 |                      7 | F      |
|     1 |                      7 | M      |
|     0 |                     14 | NULL   |
|     1 |                     14 | F      |
|     3 |                     14 | M      |
+-------+------------------------+--------+
5 rows in set (0.00 sec)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Thatâ€™s it for the three SQL tasks. Hereâ€™s the bonus question:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Assume there are 6,000,000,000 (6 billion) people on Earth. What would you estimate to be the result, if you multiply together the number of fingers on every personâ€™s left-hands? (For the purposes of this exercise, thumbs count as fingers.)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Think about it for a minute. I have hidden my answer at the end of the URL for this article.&lt;/p&gt;
</description>
        <pubDate>Sun, 28 Jan 2018 00:00:00 -0500</pubDate>
        <link>/2018/01/28/how-to-do-simple-sql-tasks-with-mariadb-0</link>
        <guid isPermaLink="true">/2018/01/28/how-to-do-simple-sql-tasks-with-mariadb-0</guid>
        
        
      </item>
    
      <item>
        <title>Finding the best poker hand in five-card draw with python</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/poker.jpg&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I recently took a Hackerrank challenge for a job application that involved poker. Iâ€™m not a poker player, so I had a brief moment of panic as I read over the problem the description. In this article I want to do some reflection on how I approached the problem.&lt;/p&gt;

&lt;h1 id=&quot;the-problem&quot;&gt;The Problem&lt;/h1&gt;

&lt;p&gt;The hackerrank question asked me to write a program that would determine the best poker hand possible in &lt;a href=&quot;https://en.wikipedia.org/wiki/Five-card_draw&quot;&gt;five-card draw&lt;/a&gt; poker. We are given 10 cards, the first 5 are the current hand, and the second 5 are the next five cards in the deck. We assume that we can see the next five cards (they are not hidden). We want to exchange any &lt;code class=&quot;highlighter-rouge&quot;&gt;n&lt;/code&gt; number of cards (where &lt;code class=&quot;highlighter-rouge&quot;&gt;n &amp;lt;= 5&lt;/code&gt;) in our hand for the next &lt;code class=&quot;highlighter-rouge&quot;&gt;n&lt;/code&gt; cards in the deck. For example, we can take out any combination of 2 cards from the hand we are given, but we must replace these two cards with the next two cards from the deck (we canâ€™t pick any two cards from the deck).&lt;/p&gt;

&lt;h1 id=&quot;evaluating-hands&quot;&gt;Evaluating hands&lt;/h1&gt;

&lt;p&gt;Suit and value make up the value of playing cards. For example, you can have a 3 of clubs. 3 is the value, clubs is the suit. We can represent this as &lt;code class=&quot;highlighter-rouge&quot;&gt;3C&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Suits&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Clubs C
Spades S
Heart H
Diamonds D&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Value (Rank)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;2, 3, 4, 5, 6, 7, 8, 9, 10, Jack, Queen, King, Ace&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
values = {&quot;2&quot;:2, &quot;3&quot;:3, &quot;4&quot;:4, &quot;5&quot;:5, &quot;6&quot;:6, &quot;7&quot;:7, &quot;8&quot;:8, &quot;9&quot;:9, &quot;10&quot;:10, &quot;J&quot;:11, &quot;Q&quot;:12, &quot;K&quot;:13, &quot;A&quot;:14}
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;hands&quot;&gt;Hands&lt;/h2&gt;

&lt;p&gt;Here are the hands of poker&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Royal flush (the problem didnâ€™t ask me to consider Royal Flush)
&amp;gt; A, K, Q, J, 10, all the same suit.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Straight flush
&amp;gt; Five cards in a sequence, all in the same suit. &lt;strong&gt;Ace can either come before 2 or come after King.&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Four of a kind
&amp;gt; All four cards of the same rank.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Full house
&amp;gt; Three of a kind with a pair.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Flush
&amp;gt; Any five cards of the same suit, but not in a sequence.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Straight
&amp;gt; Five cards in a sequence, but not of the same suit.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Three of a kind
&amp;gt; Three cards of the same rank.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Two pair
&amp;gt; Two different pairs.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Pair
&amp;gt; Two cards of the same rank.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;High Card
&amp;gt; When you havenâ€™t made any of the hands above, the highest card plays.
In the example below, the jack plays as the highest card.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;evaluating-a-hand-of-cards&quot;&gt;Evaluating a hand of cards&lt;/h2&gt;

&lt;p&gt;A hand is five cards. The first thing I did was write out functions to evaluate if a group of 5 cards satisfies the conditions of one of the ten hands.&lt;/p&gt;

&lt;p&gt;Hereâ€™s a sample hand:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
hand = [&quot;3S&quot;, &quot;JC&quot;, &quot;QD&quot;, &quot;5D&quot;, &quot;AH&quot;]
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To write functions, I reached for using 2 important python features: &lt;code class=&quot;highlighter-rouge&quot;&gt;set&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;defaultdict&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Hereâ€™s an example of a simple function to detect a flush, a hand with cards of all the same suit:&lt;/p&gt;

&lt;h2 id=&quot;checking-a-flush&quot;&gt;Checking a flush&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
def check_flush(hand):
    suits = [h[1] for h in hand]
    if len(set(suits)) == 1:
      return True
    else:
      return False
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This function creates a list of the suits in our hand, and then counts the unique elements in that list by making it a set. If the length of the set is 1, then all the cards in the hand must be of the same suit.&lt;/p&gt;

&lt;p&gt;But wait, what if we have a straight flush? Also, a hand that satisfies a flush could also be described as a two pair hand. The problem asked me to find the highest possible hand for a given set of cards, so I tried to keep things simple by writing a &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hand()&lt;/code&gt; function that checks each hand starting from straight flush down to high card. As soon as a condition for a hand was satisfied, I returned a number that corresponded to the strength of the hand (1 for high card up to 10 for straight flush). The problem didnâ€™t include Royal flush, so I will not include that here.&lt;/p&gt;

&lt;p&gt;Hereâ€™s the &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hand&lt;/code&gt; function:&lt;/p&gt;

&lt;p&gt;```python
def check_hand(hand):
    if check_straight_flush(hand):
        return 9
    if check_four_of_a_kind(hand):
        return 8&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
if check_two_pair(hand):
    return 3
if check_pair(hand):
    return 2
return 1 ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This function starts checking the most valuable hands. After it checks the second to lowest hand (pair), it returns a value of 1. This value of 1 corresponds to the â€œhighest cardâ€ hand. Since Iâ€™m not comparing the relative value of hands, it doesnâ€™t matter what the highest card is, so the number just represents the &lt;em&gt;type&lt;/em&gt; of hand that is the strongest.&lt;/p&gt;

&lt;h2 id=&quot;other-hands&quot;&gt;Other hands&lt;/h2&gt;

&lt;p&gt;Here are the all of the functions I used to detect hands:&lt;/p&gt;

&lt;p&gt;```python
card_order_dict = {â€œ2â€:2, â€œ3â€:3, â€œ4â€:4, â€œ5â€:5, â€œ6â€:6, â€œ7â€:7, â€œ8â€:8, â€œ9â€:9, â€œTâ€:10,â€Jâ€:11, â€œQâ€:12, â€œKâ€:13, â€œAâ€:14}&lt;/p&gt;

&lt;p&gt;def check_straight_flush(hand):
    if check_flush(hand) and check_straight(hand):
        return True
    else:
        return False&lt;/p&gt;

&lt;p&gt;def check_four_of_a_kind(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values: 
        value_counts[v]+=1
    if sorted(value_counts.values()) == [1,4]:
        return True
    return False&lt;/p&gt;

&lt;p&gt;def check_full_house(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values: 
        value_counts[v]+=1
    if sorted(value_counts.values()) == [2,3]:
        return True
    return False&lt;/p&gt;

&lt;p&gt;def check_flush(hand):
    suits = [i[1] for i in hand]
    if len(set(suits))==1:
        return True
    else:
        return False&lt;/p&gt;

&lt;p&gt;def check_straight(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values:
        value_counts[v] += 1
    rank_values = [card_order_dict[i] for i in values]
    value_range = max(rank_values) - min(rank_values)
    if len(set(value_counts.values())) == 1 and (value_range==4):
        return True
    else: 
        #check straight with low Ace
        if set(values) == set([â€œAâ€, â€œ2â€, â€œ3â€, â€œ4â€, â€œ5â€]):
            return True
        return False&lt;/p&gt;

&lt;p&gt;def check_three_of_a_kind(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values:
        value_counts[v]+=1
    if set(value_counts.values()) == set([3,1]):
        return True
    else:
        return False&lt;/p&gt;

&lt;p&gt;def check_two_pairs(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values:
        value_counts[v]+=1
    if sorted(value_counts.values())==[1,2,2]:
        return True
    else:
        return False&lt;/p&gt;

&lt;p&gt;def check_one_pairs(hand):
    values = [i[0] for i in hand]
    value_counts = defaultdict(lambda:0)
    for v in values:
        value_counts[v]+=1
    if 2 in value_counts.values():
        return True
    else:
        return False
```&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;defaultdict&lt;/code&gt; is a great built-in that is good to use when you donâ€™t know what elements will be in your dictionary, but you know what the initial values of any key that could be added should be. We donâ€™t need it here, but the alternative would be to write a very long dictionary where keys are the possible card values and the values of each key is 0.&lt;/p&gt;

&lt;h1 id=&quot;finding-the-best-hand&quot;&gt;Finding the best hand&lt;/h1&gt;

&lt;p&gt;It would certainly be cleaner and more efficient to write out the above functions into one large function, but I wanted to keep things simple as I was under time constraints.&lt;/p&gt;

&lt;p&gt;The next step in the problem is to determine the best possible hand we can get given the hand we are dealt and the 5 cards on top of the deck. I decided to first solve this problem with brute force. Here was my logic for this part: use &lt;code class=&quot;highlighter-rouge&quot;&gt;itertools&lt;/code&gt; to get all combinations of groups of 0, 1, 2, 3, 4 and 5 cards from my hand and add the first &lt;code class=&quot;highlighter-rouge&quot;&gt;5 - n&lt;/code&gt; cards from the deck so we get a five card deck. For each combination of cards we can run &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hand()&lt;/code&gt; and keep track of the highest rank hand, and then return that hand as the best hand. Hereâ€™s the code I wrote for this part of the problem:&lt;/p&gt;

&lt;p&gt;```python
from itertools import combinations&lt;/p&gt;

&lt;p&gt;hand_dict = {9:â€straight-flushâ€, 8:â€four-of-a-kindâ€, 7:â€full-houseâ€, 6:â€flushâ€, 5:â€straightâ€, 4:â€three-of-a-kindâ€, 3:â€two-pairsâ€, 2:â€one-pairâ€, 1:â€highest-cardâ€}&lt;/p&gt;

&lt;h1 id=&quot;exhaustive-search-using-itertoolscombinations&quot;&gt;exhaustive search using itertools.combinations&lt;/h1&gt;
&lt;p&gt;def play(cards):
    hand = cards[:5]
    deck = cards[5:]
    best_hand = 0
    for i in range(6):
        possible_combos = combinations(hand, 5-i)
        for c in possible_combos: 
            current_hand = list(c) + deck[:i]
            hand_value = check_hand(current_hand)
            if hand_value &amp;gt; best_hand:
                best_hand = hand_value&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;return hand_dict[best_hand] ```
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;checking-test-cases&quot;&gt;Checking test cases&lt;/h1&gt;

&lt;p&gt;Lastly, I need to check each hand and print out the best hand possible. Hereâ€™s the loop I wrote to do this:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
for i in sys.stdin.readlines():
    cards = list(map(lambda x:x, i.split()))
    hand = cards[:5]
    deck = cards[5:]
    print(&quot;Hand:&quot;, &quot; &quot;.join(hand), &quot;Deck:&quot;, &quot; &quot;.join(deck), &quot;Best hand:&quot;, play(cards))
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This will accept one round of cards per line:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
2C 3D 4S 5D 7H KD QH 6C JH 2D
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;and it will output the following:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
Hand: 2C 3D 4S 5D 7H Deck: KD QH 6C JH 2D Best hand: straight
&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;optimization&quot;&gt;Optimization&lt;/h1&gt;

&lt;p&gt;This was an interesting problem to deal with as the solution contained several parts that worked together. While solving the problem I aimed worked through to the end leaving some parts to come back to that I felt confident in solving. Instead of writing each function to check differnt hands at the beginning, I filled most of these functions with &lt;code class=&quot;highlighter-rouge&quot;&gt;pass&lt;/code&gt; and moved on to write the next part that involves checking each different combination of cards. Recently having worked through pythonâ€™s &lt;code class=&quot;highlighter-rouge&quot;&gt;itertools&lt;/code&gt; exercises on Hackerrank, the &lt;code class=&quot;highlighter-rouge&quot;&gt;combinations&lt;/code&gt; functions was fresh in my mind.&lt;/p&gt;

&lt;p&gt;While I was able to arrive at a solution that satisfied the test cases, I did not have time to think about the efficiency or Big O analysis of the problem.&lt;/p&gt;

&lt;p&gt;There is obviously some refactoring that I could do to make things cleaner. With more time I would take an object oriented approach by making classes for cards and hands, and adding class methods to evaluate the hands.&lt;/p&gt;

&lt;p&gt;For each round, we have to run &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hand()&lt;/code&gt; on each hand combination. Letâ€™s think about how many hands we have to evaluate:&lt;/p&gt;

&lt;p&gt;We have to consider combinations of cards formed by taking out groups of 0, 1, 2, 3, 4 and 5 cards and adding the next number of cards in the deck that bring the total card count to 5, which means we have to do 5C0 + 5C1 + 5C2 + 5C3 + 5C4 + 5C5 calls to &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hand()&lt;/code&gt;. So the sum of total calls is 1 + 5 + 10 + 10 + 5 + 1 = &lt;strong&gt;32&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;For each of these 32 calls that happen when we run &lt;code class=&quot;highlighter-rouge&quot;&gt;play()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hands()&lt;/code&gt; runs through each of the &lt;code class=&quot;highlighter-rouge&quot;&gt;check_&lt;/code&gt; functions starting with the highest value hand. As soon as it finds a â€œmatchâ€, &lt;code class=&quot;highlighter-rouge&quot;&gt;check_hands()&lt;/code&gt; returns a number value (&lt;code class=&quot;highlighter-rouge&quot;&gt;hand_value&lt;/code&gt;) corresponding to straight flush, four of a kind, etc. This value is then compared with the highest value that has been previously found (&lt;code class=&quot;highlighter-rouge&quot;&gt;best_hand&lt;/code&gt;) and replaces that value if the current handâ€™s hand rank has a higher value.&lt;/p&gt;

&lt;p&gt;Iâ€™m not sure if there is faster way to find the best hand than the brute force method I implemented.&lt;/p&gt;
</description>
        <pubDate>Tue, 02 Jan 2018 00:00:00 -0500</pubDate>
        <link>/2018/01/02/checking-poker-hands-with-python.html</link>
        <guid isPermaLink="true">/2018/01/02/checking-poker-hands-with-python.html</guid>
        
        
      </item>
    
      <item>
        <title>Getting started with Python&#39;s Twisted Framework</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/twisted-snakes.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In this article Iâ€™m going to be exploring pythonâ€™s twisted framework. Iâ€™m working through the &lt;em&gt;Twisted Network Programming Essentials&lt;/em&gt; book from Oâ€™Reilly.&lt;/p&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ pip install twisted
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The main idea behind Twisted is that it gives us the parallelism of multithreading programming with the ease of reasoning of single threaded programming.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/static/event-driven.jpg&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-reactor&quot;&gt;The Reactor&lt;/h2&gt;

&lt;p&gt;This is the core of Twisted. Here is a simple explanation of what the reactor does with psuedo-code:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
while True:
    timeout = timeout_until_next_timed_event()
    events = wait_for_events(timeout)
    events += timed_events_until(now())
    for event in events:
        event.process()
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s a simple echo server/client example that illustrates how the reactor works. It is composed of &lt;code class=&quot;highlighter-rouge&quot;&gt;echoclient.py&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;echoserver.py&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;echoclient.py&lt;/em&gt;
```python
from twisted.internet import reactor, protocol&lt;/p&gt;

&lt;p&gt;class EchoClient(protocol.Protocol):
    def connectionMade(self):
        self.transport.write(uâ€Hello, world!â€.encode(â€˜utf-8â€™))&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def dataReceived(self, data):
    print(&quot;Server said:&quot;, data)
    self.transport.loseConnection()
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;class EchoFactory(protocol.ClientFactory):
    def buildProtocol(self, addr):
        return EchoClient()&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def clientConnectionFailed(self, connector, reason):
    print(&quot;Connection failed.&quot;)
    reactor.stop()

def clientConnectionLost(self, connector, reason):
    print(&quot;Connection lost.&quot;)
    reactor.stop()
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;reactor.connectTCP(â€œlocalhostâ€, 8000, EchoFactory())
reactor.run()
```&lt;/p&gt;

&lt;p&gt;&lt;em&gt;echoserver.py&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;```python
from twisted.internet import protocol, reactor&lt;/p&gt;

&lt;p&gt;class Echo(protocol.Protocol):
    def dataReceived(self,data):
        self.transport.write(data)&lt;/p&gt;

&lt;p&gt;class EchoFactory(protocol.Factory):
    def buildProtocol(self, addr):
        return Echo()&lt;/p&gt;

&lt;p&gt;reactor.listenTCP(8000, EchoFactory())
reactor.run()
```&lt;/p&gt;
</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 -0500</pubDate>
        <link>/2017/12/22/getting-started-with-twisted.html</link>
        <guid isPermaLink="true">/2017/12/22/getting-started-with-twisted.html</guid>
        
        
      </item>
    
      <item>
        <title>Setting up a Flask project with Flask CLI and Docker</title>
        <description>&lt;p&gt;&lt;img src=&quot;/static/flask-docker.png&quot; alt=&quot;png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;âš ï¸ This article is under contruction âš ï¸&lt;/p&gt;

&lt;p&gt;Iâ€™ve recently been working on an awesome tutorial from &lt;a href=&quot;https://testdriven.io&quot;&gt;testdriven.io&lt;/a&gt; that covers flask, react and docker. The beginning of the project covers how to setup a basic flask app using &lt;code class=&quot;highlighter-rouge&quot;&gt;flask-scripts&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;flask-scripts&lt;/code&gt; is a deprecated tool and the tutorial recommends using &lt;code class=&quot;highlighter-rouge&quot;&gt;Flask CLI&lt;/code&gt;. I have fumbled with this the first time I tried to set it up and while I was able to get it working, I couldnâ€™t get it working inside of docker. In this article Iâ€™ll detail the setup of my flask project with &lt;code class=&quot;highlighter-rouge&quot;&gt;Flask CLI&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;One of the nice new features in Flask 0.11 is the built-in integration of the click command line interface. This enables a wide range of new features for the Flask ecosystem and your own applications.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;OK. Letâ€™s set up a basic flask app:&lt;/p&gt;

&lt;h3 id=&quot;directories&quot;&gt;Directories&lt;/h3&gt;

&lt;p&gt;```terminal
 $ mkdir test-flask &amp;amp;&amp;amp; cd test-flask
 $ mkdir users-service &amp;amp;&amp;amp; cd users-service
 $ mkdir project&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3 id=&quot;virtual-environment&quot;&gt;Virtual Environment&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
 $ virtualenv -p python3 env
Running virtualenv with interpreter /home/brian/anaconda3/bin/python3
Using base prefix &#39;/home/brian/anaconda3&#39;
New python executable in /home/brian/Documents/flask/test-flask/users-service/env/bin/python3
Also creating executable in /home/brian/Documents/flask/test-flask/users-service/env/bin/python
Installing setuptools, pip, wheel...done.
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;activate-virtual-environment&quot;&gt;Activate Virtual Environment&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ source env/bin/activate
(env) $
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We will come back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;activate&lt;/code&gt; script and add some environment variables to the bottom if it so we have them accessible when we activate the virtual environment.&lt;/p&gt;

&lt;h3 id=&quot;install-flask-in-the-virtual-environment&quot;&gt;Install flask in the virtual environment&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ pip install flask==0.12.2
Collecting flask==0.12.2
  Using cached Flask-0.12.2-py2.py3-none-any.whl
Collecting itsdangerous&amp;gt;=0.21 (from flask==0.12.2)
Collecting Werkzeug&amp;gt;=0.7 (from flask==0.12.2)
  Using cached Werkzeug-0.13-py2.py3-none-any.whl
Collecting click&amp;gt;=2.0 (from flask==0.12.2)
  Using cached click-6.7-py2.py3-none-any.whl
Collecting Jinja2&amp;gt;=2.4 (from flask==0.12.2)
  Using cached Jinja2-2.10-py2.py3-none-any.whl
Collecting MarkupSafe&amp;gt;=0.23 (from Jinja2&amp;gt;=2.4-&amp;gt;flask==0.12.2)
Installing collected packages: itsdangerous, Werkzeug, click, MarkupSafe, Jinja2, flask
Successfully installed Jinja2-2.10 MarkupSafe-1.0 Werkzeug-0.13 click-6.7 flask-0.12.2 itsdangerous-0.24
(env) $
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;At this point we are ready to create our flask app.&lt;/p&gt;

&lt;p&gt;Hereâ€™s a note about the CLI:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;For the &lt;strong&gt;flask&lt;/strong&gt; script to work, an application needs to be discovered. This is achieved by exporting the &lt;code class=&quot;highlighter-rouge&quot;&gt;FLASK_APP&lt;/code&gt; environment variable. It can be either set to an import path or to a filename of a Python module that contains a Flask application.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Letâ€™s add an &lt;code class=&quot;highlighter-rouge&quot;&gt;app.py&lt;/code&gt; file inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;project&lt;/code&gt; folder:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;app.py&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;```python
from flask import Flask, jsonify&lt;/p&gt;

&lt;p&gt;app = Flask(&lt;strong&gt;name&lt;/strong&gt;)&lt;/p&gt;

&lt;p&gt;@app.route(â€˜/users/pingâ€™, methods=[â€˜GETâ€™])
def ping_pong():
    return jsonify({
        â€˜messageâ€™:â€™pong!â€™, 
        â€˜statusâ€™:â€™successâ€™
        })
```&lt;/p&gt;

&lt;p&gt;And now letâ€™s add an environment variable to tell the Flask CLI where our app is located:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ export FLASK_APP=/home/brian/Documents/flask/test-flask/users-service/project/app.py 
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;OK, now letâ€™s try to run &lt;code class=&quot;highlighter-rouge&quot;&gt;flask run&lt;/code&gt; and navigate to &lt;code class=&quot;highlighter-rouge&quot;&gt;/users/ping&lt;/code&gt; and see what happens:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ flask run
 * Serving Flask app &quot;app&quot;
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [09/Dec/2017 19:20:14] &quot;GET /users/ping HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Great! We see our &lt;code class=&quot;highlighter-rouge&quot;&gt;pong!&lt;/code&gt; message returned in the browser. Next, letâ€™s configure our settings:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;project/config.py&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
class BaseConfig:
    &quot;&quot;&quot;Base configuration&quot;&quot;&quot;
    DEBUG = False
    TESTING = False
class DevelopmentConfig(BaseConfig):
    &quot;&quot;&quot;Development configuration&quot;&quot;&quot;
    DEBUG = True
class TestingConfig(BaseConfig):
    &quot;&quot;&quot;Testing configuration&quot;&quot;&quot;
    DEBUG = True
    TESTING = True
class ProductionConfig(BaseConfig):
    &quot;&quot;&quot;Production configuration&quot;&quot;&quot;
    DEBUG = False
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;And now we can add the following line right below where we define &lt;code class=&quot;highlighter-rouge&quot;&gt;app = Flask(__name__)&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
app.config.from_object(&#39;project.config.DevelopmentConfig&#39;)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;When we run &lt;code class=&quot;highlighter-rouge&quot;&gt;flask run&lt;/code&gt;, we get a long error message including:&lt;/p&gt;

&lt;p&gt;```terminal
Debugged import:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;â€˜projectâ€™ not found.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Original exception:&lt;/p&gt;

&lt;p&gt;ImportStringError: import_string() failed for â€˜project.configâ€™. Possible reasons are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;missing &lt;strong&gt;init&lt;/strong&gt;.py in a package;&lt;/li&gt;
  &lt;li&gt;package or module path not included in sys.path;&lt;/li&gt;
  &lt;li&gt;duplicated package or module name taking precedence in sys.path;&lt;/li&gt;
  &lt;li&gt;missing module, class, function or variable;
```&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Letâ€™s try to add &lt;code class=&quot;highlighter-rouge&quot;&gt;__init__.py&lt;/code&gt; to our &lt;code class=&quot;highlighter-rouge&quot;&gt;project&lt;/code&gt; folder.&lt;/p&gt;

&lt;p&gt;Once we do this, we are able to run the app successfully, but we donâ€™t see any special message about Debug mode being on:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ flask run
 * Serving Flask app &quot;project.app&quot;
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The documentation mentions that we can turn on Debug mode with:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
export FLASK_DEBUG=1
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We can check the debug mode by printing &lt;code class=&quot;highlighter-rouge&quot;&gt;app.config&lt;/code&gt; in the &lt;code class=&quot;highlighter-rouge&quot;&gt;ping_pong()&lt;/code&gt; function that is returned when we hit &lt;code class=&quot;highlighter-rouge&quot;&gt;/users/ping&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python
@app.route(&#39;/users/ping&#39;, methods=[&#39;GET&#39;])
def ping_pong():
    print(app.config)
    return jsonify({
        &#39;message&#39;:&#39;pong!&#39;, 
        &#39;status&#39;:&#39;success&#39;
        })
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s what we see in the terminal:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
&amp;lt;Config {&#39;DEBUG&#39;: True, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: None, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(31), &#39;USE_X_SENDFILE&#39;: False, &#39;LOGGER_NAME&#39;: &#39;project.app&#39;, &#39;LOGGER_HANDLER_POLICY&#39;: &#39;always&#39;, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: None, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: None, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: datetime.timedelta(0, 43200), &#39;TRAP_BAD_REQUEST_ERRORS&#39;: False, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: True, &#39;JSONIFY_MIMETYPE&#39;: &#39;application/json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None}&amp;gt;
127.0.0.1 - - [09/Dec/2017 19:42:46] &quot;GET /users/ping HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Just to be sure this is working correctly, letâ€™s try another config setting, &lt;code class=&quot;highlighter-rouge&quot;&gt;ProductionConfig&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
&amp;lt;Config {&#39;DEBUG&#39;: False, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: None, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(31), &#39;USE_X_SENDFILE&#39;: False, &#39;LOGGER_NAME&#39;: &#39;project.app&#39;, &#39;LOGGER_HANDLER_POLICY&#39;: &#39;always&#39;, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: None, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: None, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: datetime.timedelta(0, 43200), &#39;TRAP_BAD_REQUEST_ERRORS&#39;: False, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: True, &#39;JSONIFY_MIMETYPE&#39;: &#39;application/json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None}&amp;gt;
127.0.0.1 - - [09/Dec/2017 19:45:29] &quot;GET /users/ping HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;OK, so far so good! I think that &lt;code class=&quot;highlighter-rouge&quot;&gt;FLASK_DEBUG&lt;/code&gt; may give us some additional information in the terminal.&lt;/p&gt;

&lt;p&gt;Letâ€™s run:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
export FLASK_DEBUG=1
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;and run our app in &lt;code class=&quot;highlighter-rouge&quot;&gt;ProductionConfig&lt;/code&gt; mode:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ flask run
 * Serving Flask app &quot;project.app&quot;
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 775-946-486
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;and when we hit &lt;code class=&quot;highlighter-rouge&quot;&gt;/users/ping&lt;/code&gt; we get:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
&amp;lt;Config {&#39;DEBUG&#39;: True, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: None, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(31), &#39;USE_X_SENDFILE&#39;: False, &#39;LOGGER_NAME&#39;: &#39;project.app&#39;, &#39;LOGGER_HANDLER_POLICY&#39;: &#39;always&#39;, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: None, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: None, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: datetime.timedelta(0, 43200), &#39;TRAP_BAD_REQUEST_ERRORS&#39;: False, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: True, &#39;JSONIFY_MIMETYPE&#39;: &#39;application/json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None}&amp;gt;
127.0.0.1 - - [09/Dec/2017 19:51:17] &quot;GET /users/ping HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Here we can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;DEBUG&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt;, which was forced when we set &lt;code class=&quot;highlighter-rouge&quot;&gt;FLASK_DEBUG=1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For clarity, letâ€™s review the directory structure of our project:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ tree project/
project/
â”œâ”€â”€ app.py
â”œâ”€â”€ config.py
â””â”€â”€ __init__.py
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;__init__.py&lt;/code&gt; is just an empty file at this point, but in the testdriven.io tutorial it is the file that contains our app.&lt;/p&gt;

&lt;p&gt;OK, we have a very simple flask app that we can control with the flask cli. Letâ€™s get ready to dockerize this simple project.&lt;/p&gt;

&lt;p&gt;We need a &lt;code class=&quot;highlighter-rouge&quot;&gt;requirements.txt&lt;/code&gt; file. So far we just have flask. We want to place this file on the same level as our &lt;code class=&quot;highlighter-rouge&quot;&gt;project&lt;/code&gt; folder:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;requirements.txt&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
Flask==0.12.1
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;And we can add a &lt;code class=&quot;highlighter-rouge&quot;&gt;.gitignore&lt;/code&gt; file as well at the same level:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;.gitignore&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
__pycache__
env
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;docker&quot;&gt;Docker&lt;/h2&gt;

&lt;p&gt;Here are the versions of docker applications I have installed:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ docker -v &amp;amp;&amp;amp; docker-compose -v &amp;amp;&amp;amp; docker-machine -v
Docker version 17.10.0-ce, build f4ffd2511c
docker-compose version 1.17.1, build unknown
docker-machine version 0.13.0, build HEAD
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Currently I donâ€™t have any docker machines, images or containers. Here is the status of the docker service:&lt;/p&gt;

&lt;p&gt;```terminal
 $ systemctl status docker
â— docker.service - Docker Application Container Engine
   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-12-08 19:13:09 EST; 24h ago
     Docs: https://docs.docker.com
 Main PID: 5486 (dockerd)
    Tasks: 26 (limit: 4915)
   CGroup: /system.slice/docker.service
           â”œâ”€5486 /usr/bin/dockerd -g /home/brian/docker -H fd://
           â””â”€5492 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock â€“metrics-interval=0 â€“start-timeout 2m â€“state-dir /var/run/docker/libcontainerd/containerd â€“shim docker-containerd-shim â€“runtime docker-runc&lt;/p&gt;

&lt;p&gt;Dec 08 19:13:08 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:08.126834430-05:00â€ level=warning msg=â€Your kernel does not support cgroup rt periodâ€
Dec 08 19:13:08 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:08.126850093-05:00â€ level=warning msg=â€Your kernel does not support cgroup rt runtimeâ€
Dec 08 19:13:08 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:08.127216425-05:00â€ level=info msg=â€Loading containers: start.â€
Dec 08 19:13:08 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:08.776371797-05:00â€ level=info msg=â€Default bridge (docker0) is assigned with an IP address 172.17.0.0/16. Daemon option â€“bip can be used to set a preferred IP addressâ€
Dec 08 19:13:09 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:09.013651222-05:00â€ level=info msg=â€Loading containers: done.â€
Dec 08 19:13:09 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:09.041318847-05:00â€ level=warning msg=â€Not using native diff for overlay2, this may cause degraded performance for building images: kernel has CONFIG_OVERLAY_FS_REDIRECT_DIR enabledâ€
Dec 08 19:13:09 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:09.075633462-05:00â€ level=info msg=â€Docker daemonâ€ commit=f4ffd2511c graphdriver(s)=overlay2 version=17.10.0-ce
Dec 08 19:13:09 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:09.076162900-05:00â€ level=info msg=â€Daemon has completed initializationâ€
Dec 08 19:13:09 archthinkpad dockerd[5486]: time=â€2017-12-08T19:13:09.082056339-05:00â€ level=info msg=â€API listen on /var/run/docker.sockâ€
Dec 08 19:13:09 archthinkpad systemd[1]: Started Docker Application Container Engine.
```&lt;/p&gt;

&lt;p&gt;OK, docker seems to be working fine. Now we need to create a Docker host and point the docker client at it. What does this mean? From what I understand, we will be running docker containers not on our local machine but in an instance of &lt;code class=&quot;highlighter-rouge&quot;&gt;virtualbox&lt;/code&gt; on our local machine. To do this, we will use the &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-machine&lt;/code&gt; command:&lt;/p&gt;

&lt;p&gt;```terminal
 $ docker-machine create -d virtualbox testdriven-dev
Running pre-create checksâ€¦
Creating machineâ€¦
(testdriven-dev) Copying /home/brian/.docker/machine/cache/boot2docker.iso to /home/brian/.docker/machine/machines/testdriven-dev/boot2docker.isoâ€¦
(testdriven-dev) Creating VirtualBox VMâ€¦
(testdriven-dev) Creating SSH keyâ€¦
(testdriven-dev) Starting the VMâ€¦
(testdriven-dev) Check network to re-create if neededâ€¦
(testdriven-dev) Waiting for an IPâ€¦
Waiting for machine to be running, this may take a few minutesâ€¦
Detecting operating system of created instanceâ€¦
Waiting for SSH to be availableâ€¦
Detecting the provisionerâ€¦
Provisioning with boot2dockerâ€¦
Copying certs to the local machine directoryâ€¦
Copying certs to the remote machineâ€¦
Setting Docker configuration on the remote daemonâ€¦&lt;/p&gt;

&lt;p&gt;This machine has been allocated an IP address, but Docker Machine could not reach it successfully.&lt;/p&gt;

&lt;p&gt;SSH for the machine should still work, but connecting to exposed ports, such as the Docker daemon port (usually &lt;ip&gt;:2376), may not work properly.&lt;/ip&gt;&lt;/p&gt;

&lt;p&gt;You may need to add the route manually, or use another related workaround.&lt;/p&gt;

&lt;p&gt;This could be due to a VPN, proxy, or host file configuration issue.&lt;/p&gt;

&lt;p&gt;You also might want to clear any VirtualBox host only interfaces you are not using.
Checking connection to Dockerâ€¦
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env testdriven-dev
```&lt;/p&gt;

&lt;p&gt;We see that &lt;code class=&quot;highlighter-rouge&quot;&gt;Docker is up and running!&lt;/code&gt;, but notice this line:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;
This machine has been allocated an IP address, but Docker Machine could not reach it successfully.
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This might be a problem. I think that the &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-machine env &amp;lt;machine-name&amp;gt;&lt;/code&gt; command fixes this:&lt;/p&gt;

&lt;p&gt;When you run this command you get the following:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ docker-machine env testdriven-dev
export DOCKER_TLS_VERIFY=&quot;1&quot;
export DOCKER_HOST=&quot;tcp://192.168.99.100:2376&quot;
export DOCKER_CERT_PATH=&quot;/home/brian/.docker/machine/machines/testdriven-dev&quot;
export DOCKER_MACHINE_NAME=&quot;testdriven-dev&quot;
# Run this command to configure your shell: 
# eval $(docker-machine env testdriven-dev)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The result of this command tells us to run `eval $(docker-machine env testdriven-dev):&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
eval &quot;$(docker-machine env testdriven-dev)&quot;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To clarify, running the above commands puts adds some environment variables:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ env | grep DOCKER
DOCKER_MACHINE_NAME=testdriven-dev
DOCKER_CERT_PATH=/home/brian/.docker/machine/machines/testdriven-dev
DOCKER_TLS_VERIFY=1
DOCKER_HOST=tcp://192.168.99.100:2376
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next we need to add a Dockerfile. We will call it &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile-dev&lt;/code&gt;. Letâ€™s look at &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile-dev&lt;/code&gt; from the tutorial and see how we may need to modify it for the way we set up our project:&lt;/p&gt;

&lt;p&gt;```
FROM python:3.6.3&lt;/p&gt;

&lt;h1 id=&quot;set-working-directory&quot;&gt;set working directory&lt;/h1&gt;
&lt;p&gt;RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app&lt;/p&gt;

&lt;h1 id=&quot;add-requirements&quot;&gt;add requirements&lt;/h1&gt;
&lt;p&gt;ADD ./requirements.txt /usr/src/app/requirements.txt&lt;/p&gt;

&lt;h1 id=&quot;install-requirements&quot;&gt;install requirements&lt;/h1&gt;
&lt;p&gt;RUN pip install -r requirements.txt&lt;/p&gt;

&lt;h1 id=&quot;add-app&quot;&gt;add app&lt;/h1&gt;
&lt;p&gt;ADD . /usr/src/app&lt;/p&gt;

&lt;h1 id=&quot;run-server&quot;&gt;run server&lt;/h1&gt;
&lt;p&gt;CMD python manage.py runserver -h 0.0.0.0
```&lt;/p&gt;

&lt;p&gt;We start by defining a base image with the &lt;code class=&quot;highlighter-rouge&quot;&gt;FROM&lt;/code&gt; line which will give us the correct version of python. We then set folders and the current working directory in docker. Next we install flask add the &lt;code class=&quot;highlighter-rouge&quot;&gt;requirements.txt&lt;/code&gt; file and install flask with the &lt;code class=&quot;highlighter-rouge&quot;&gt;RUN&lt;/code&gt; line. We then add the directory (on our local machine) with &lt;code class=&quot;highlighter-rouge&quot;&gt;ADD . /usr/src/app&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This should all be fine up until the last line where we see a &lt;code class=&quot;highlighter-rouge&quot;&gt;manage.py&lt;/code&gt; file. We never created this file since we wish to use the Flask CLI. We could try replicating the process did locally inside our Dockerfile. We need to add the the &lt;code class=&quot;highlighter-rouge&quot;&gt;FLASK_APP&lt;/code&gt; environment variable, and its value should be the script that has just been added to the docker image. Letâ€™s try:&lt;/p&gt;

&lt;p&gt;```
[â€¦]&lt;/p&gt;

&lt;p&gt;ENV FLASK_APP /usr/src/app/project/app.py&lt;/p&gt;

&lt;p&gt;CMD flask run
```&lt;/p&gt;

&lt;p&gt;Next we need a script for &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose&lt;/code&gt; is a tool for defining and running multi-container Docker applications. Again, letâ€™s look at what was included in the tutorial and then see if we need to make any adjustments:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;docker-compose-dev.yml&lt;/em&gt; (this file goes in the root directory, one level up from where &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile-dev&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;```
version: â€˜3.3â€™&lt;/p&gt;

&lt;p&gt;services:&lt;/p&gt;

&lt;p&gt;users-service:
    container_name: users-service
      build:
        context: ./users-service
        dockerfile: Dockerfile-dev
      volumes:
        - â€˜./users-service:/usr/src/appâ€™
      ports:
        - 5001:5000
```&lt;/p&gt;

&lt;p&gt;OK, this looks good! Letâ€™s give it a try. We can run the following command:&lt;/p&gt;

&lt;p&gt;```terminal
 $ docker-compose -f docker-compose-dev.yml build
Building users-service
85b1f47fba49: Pull complete
ba6bd283713a: Pull complete
817c8cd48a09: Pull complete
47cc0ed96dc3: Pull complete
4a36819a59dc: Pull complete
db9a0221399f: Pull complete
7a511a7689b6: Pull complete
1223757f6914: Pull complete
Digest: sha256:db9d8546f3ff74e96702abe0a78a0e0454df6ea898de8f124feba81deea416d7
Status: Downloaded newer image for python:3.6.3
 â€”&amp;gt; 79e1dc9af1c1
Step 2/8 : RUN mkdir -p /usr/src/app
 â€”&amp;gt; Running in 808f6c0497d3
 â€”&amp;gt; 8873e8e0d526
Removing intermediate container 808f6c0497d3
Step 3/8 : WORKDIR /usr/src/app
 â€”&amp;gt; 76ef8912b4d5
Removing intermediate container a3ca419fe9c1
Step 4/8 : ADD ./requirements.txt /usr/src/app/requirements.txt
 â€”&amp;gt; eb513314527a
Step 5/8 : RUN pip install -r requirements.txt
 â€”&amp;gt; Running in 1a708ec3b565
Collecting Flask==0.12.1 (from -r requirements.txt (line 1))
  Downloading Flask-0.12.1-py2.py3-none-any.whl (82kB)
Collecting Jinja2&amp;gt;=2.4 (from Flask==0.12.1-&amp;gt;-r requirements.txt (line 1))
  Downloading Jinja2-2.10-py2.py3-none-any.whl (126kB)
Collecting click&amp;gt;=2.0 (from Flask==0.12.1-&amp;gt;-r requirements.txt (line 1))
  Downloading click-6.7-py2.py3-none-any.whl (71kB)
Collecting Werkzeug&amp;gt;=0.7 (from Flask==0.12.1-&amp;gt;-r requirements.txt (line 1))
  Downloading Werkzeug-0.13-py2.py3-none-any.whl (311kB)
Collecting itsdangerous&amp;gt;=0.21 (from Flask==0.12.1-&amp;gt;-r requirements.txt (line 1))
  Downloading itsdangerous-0.24.tar.gz (46kB)
Collecting MarkupSafe&amp;gt;=0.23 (from Jinja2&amp;gt;=2.4-&amp;gt;Flask==0.12.1-&amp;gt;-r requirements.txt (line 1))
  Downloading MarkupSafe-1.0.tar.gz
Building wheels for collected packages: itsdangerous, MarkupSafe
  Running setup.py bdist_wheel for itsdangerous: started
  Running setup.py bdist_wheel for itsdangerous: finished with status â€˜doneâ€™
  Stored in directory: /root/.cache/pip/wheels/fc/a8/66/24d655233c757e178d45dea2de22a04c6d92766abfb741129a
  Running setup.py bdist_wheel for MarkupSafe: started
  Running setup.py bdist_wheel for MarkupSafe: finished with status â€˜doneâ€™
  Stored in directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57
Successfully built itsdangerous MarkupSafe
Installing collected packages: MarkupSafe, Jinja2, click, Werkzeug, itsdangerous, Flask
Successfully installed Flask-0.12.1 Jinja2-2.10 MarkupSafe-1.0 Werkzeug-0.13 click-6.7 itsdangerous-0.24
 â€”&amp;gt; d828a0518114
Removing intermediate container 1a708ec3b565
Step 6/8 : ADD . /usr/src/app
 â€”&amp;gt; 8e0efae73a47
Step 7/8 : ENV FLASK_APP /usr/src/app/project/app.py
 â€”&amp;gt; Running in 959581952d05
 â€”&amp;gt; 20aaec61b615
Removing intermediate container 959581952d05
Step 8/8 : CMD flask run
 â€”&amp;gt; Running in 4f2fc701ba14
 â€”&amp;gt; 1d5b59f3cef2
Removing intermediate container 4f2fc701ba14&lt;/p&gt;

&lt;p&gt;Successfully built 1d5b59f3cef2
Successfully tagged testflask_users-service:latest&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;That seemed to work. Next the tutorial says to run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose -f docker-compose-dev.yml up -d&lt;/code&gt;. Iâ€™ll run this without the &lt;code class=&quot;highlighter-rouge&quot;&gt;-d&lt;/code&gt; flag so we can see if there are any errors. Moment of truth!&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;terminal
 $ docker-compose -f docker-compose-dev.yml up
Creating network &quot;testflask_default&quot; with the default driver
Creating users-service ... 
Creating users-service ... done
Attaching to users-service
users-service    | Usage: flask run [OPTIONS]
users-service    | 
users-service    | Error: The file/path provided (/usr/src/app/project/app.py) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
users-service exited with code 2
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;OK, we have an error that seems to have come from our &lt;code class=&quot;highlighter-rouge&quot;&gt;flask run&lt;/code&gt; command.&lt;/p&gt;

&lt;p&gt;To bo continuedâ€¦&lt;/p&gt;
</description>
        <pubDate>Sat, 09 Dec 2017 00:00:00 -0500</pubDate>
        <link>/2017/12/09/setting-up-flask-cli-with-docker.html</link>
        <guid isPermaLink="true">/2017/12/09/setting-up-flask-cli-with-docker.html</guid>
        
        
      </item>
    
  </channel>
</rss>
