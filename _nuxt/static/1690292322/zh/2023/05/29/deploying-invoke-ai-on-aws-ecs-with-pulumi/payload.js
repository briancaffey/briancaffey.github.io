__NUXT_JSONP__("/zh/2023/05/29/deploying-invoke-ai-on-aws-ecs-with-pulumi", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB){return {data:[{article:{slug:"deploying-invoke-ai-on-aws-ecs-with-pulumi",description:W,title:W,date:"2023-05-29",tags:["invokeai","ai",I,S,"pulumi","docker"],draft:X,comments:X,toc:[{id:Y,depth:2,text:Z}],body:{type:"root",children:[{type:b,tag:"p",props:{},children:[{type:a,value:"This article will show how to deploy InvokeAI on AWS with ECS using Pulumi. InvokeAI is a generative AI tool that allows you to generate images."}]},{type:a,value:j},{type:b,tag:_,props:{},children:[{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"InvokeAI supports deploying with docker containers"}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"I wanted to try this but the documentation on how to do this is limited"}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"I have been able to set up IvokeAI on AWS by installing it directly via git, doing pip install and following instructions in their documentation"}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"I wanted to get more hands-on experience with ECS, GPU instances, EFS, DataSync and Pulumi"}]},{type:a,value:j}]},{type:a,value:j},{type:b,tag:"h2",props:{id:Y},children:[{type:b,tag:F,props:{href:"#links",ariaHidden:J,tabIndex:-1},children:[{type:b,tag:c,props:{className:["icon","icon-link"]},children:[]}]},{type:a,value:Z}]},{type:a,value:j},{type:b,tag:_,props:{},children:[{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"Documentation: "},{type:b,tag:F,props:{href:$,rel:[K,L,M],target:N},children:[{type:a,value:$}]}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"Install with docker: "},{type:b,tag:F,props:{href:aa,rel:[K,L,M],target:N},children:[{type:a,value:aa}]}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"EFS Guide: "},{type:b,tag:F,props:{href:ab,rel:[K,L,M],target:N},children:[{type:a,value:ab}]}]},{type:a,value:j},{type:b,tag:A,props:{},children:[{type:a,value:"Pulumi examples: "},{type:b,tag:F,props:{href:ac,rel:[K,L,M],target:N},children:[{type:a,value:ac}]}]},{type:a,value:j}]},{type:a,value:j},{type:b,tag:ad,props:{className:[ae]},children:[{type:b,tag:af,props:{className:[ag,ah]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ak}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:al}]},{type:a,value:" pulumi "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"@pulumi\u002Fpulumi\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ak}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:al}]},{type:a,value:" aws "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"@pulumi\u002Faws\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Create an ECS cluster"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" ecsCluster "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"Cluster"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"my-ecs-cluster\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Get the most recent Ubuntu 20.04 LTS image"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" ubuntuAmi "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:" pulumi"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"output"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"getAmi"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    filters"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"name\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ubuntu\u002Fimages\u002Fhvm-ssd\u002Fubuntu-focal-20.04-amd64-server-*\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"virtualization-type\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"hvm\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    owners"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"099720109477\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Canonical owner ID"}]},{type:a,value:"\n    mostRecent"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:J}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Create a security group for the cluster"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" clusterSecurityGroup "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"SecurityGroup"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"cluster-security-group\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    ingress"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n            fromPort"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n            toPort"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"65535"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n            protocol"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"tcp\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n            cidrBlocks"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"0.0.0.0\u002F0\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Create a launch configuration for the ASG"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" launchConfiguration "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"LaunchConfiguration"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ecs-launch-configuration\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    imageId"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ami-xxxxxxxxxxxx\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    instanceType"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"t2.micro\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    iamInstanceProfile"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"\u003Creplace-with-your-iam-instance-profile\u003E\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    associatePublicIpAddress"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:J}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    securityGroups"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:"clusterSecurityGroup"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    userData"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,aq]},children:[{type:b,tag:c,props:{className:[d,O,k]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"#!\u002Fbin\u002Fbash\necho ECS_CLUSTER="}]},{type:b,tag:c,props:{className:[d,ar]},children:[{type:b,tag:c,props:{className:[d,Q,e]},children:[{type:a,value:as}]},{type:a,value:"ecsCluster"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,Q,e]},children:[{type:a,value:n}]}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:" \u003E\u003E \u002Fetc\u002Fecs\u002Fecs.config"}]},{type:b,tag:c,props:{className:[d,O,k]},children:[{type:a,value:P}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Create an Auto Scaling Group"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" autoScalingGroup "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"autoscaling"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"Group"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ecs-asg\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    desiredCapacity"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"2"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    launchConfiguration"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:" launchConfiguration"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    maxSize"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"5"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    minSize"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"1"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    tags"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" key"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"Name\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" value"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"my-ecs-asg\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" propagateAtLaunch"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Create an ECS capacity provider"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" capacityProvider "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"CapacityProvider"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"my-capacity-provider\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    autoScalingGroupProvider"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n        autoScalingGroupArn"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:" autoScalingGroup"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"arn"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n        managedScaling"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n           "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n            targetCapacity"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"75"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n        managedTerminationProtection"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Add the capacity provider to the ECS cluster"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" clusterCapacityProvider "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"ClusterCapacityProviders"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ecs-cluster-capacity-providers\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    capacityProviders"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:"capacityProvider"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    clusterName"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:B},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:"\u002F\u002F Export ECS cluster name"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"export"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" ecsClusterName "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:j}]}]}]},{type:a,value:j},{type:b,tag:ad,props:{className:[ae]},children:[{type:b,tag:af,props:{className:[ag,ah]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"for"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"let"}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"\u003C"}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"length"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" i"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"++"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    targets"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"push"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"MountTarget"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,aq]},children:[{type:b,tag:c,props:{className:[d,O,k]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"fs-mount-"}]},{type:b,tag:c,props:{className:[d,ar]},children:[{type:b,tag:c,props:{className:[d,Q,e]},children:[{type:a,value:as}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,Q,e]},children:[{type:a,value:n}]}]},{type:b,tag:c,props:{className:[d,O,k]},children:[{type:a,value:P}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n        fileSystemId"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n        subnetId"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n        securityGroups"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"defaultSecurityGroupId"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:x}]},{type:a,value:" ap "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"AccessPoint"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"ap\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    fileSystemId"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    posixUser"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" uid"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" gid"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    rootDirectory"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" path"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"\u002Fwww\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" creationInfo"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" ownerGid"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" ownerUid"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" permissions"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"\"755\""}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" dependsOn"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:i}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:j}]}]}]}]},dir:"\u002F2023\u002F05\u002F29",path:"\u002F2023\u002F05\u002F29\u002Fdeploying-invoke-ai-on-aws-ecs-with-pulumi",extension:".md",createdAt:aB,updatedAt:aB,raw:"\nThis article will show how to deploy InvokeAI on AWS with ECS using Pulumi. InvokeAI is a generative AI tool that allows you to generate images.\n\n- InvokeAI supports deploying with docker containers\n- I wanted to try this but the documentation on how to do this is limited\n- I have been able to set up IvokeAI on AWS by installing it directly via git, doing pip install and following instructions in their documentation\n- I wanted to get more hands-on experience with ECS, GPU instances, EFS, DataSync and Pulumi\n\n## Links\n\n- Documentation: [https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002F](https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002F)\n- Install with docker: [https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002Finstallation\u002F040_INSTALL_DOCKER\u002F](https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002Finstallation\u002F040_INSTALL_DOCKER\u002F)\n- EFS Guide: [https:\u002F\u002Fdocs.aws.amazon.com\u002FAmazonECS\u002Flatest\u002Fdeveloperguide\u002Ftutorial-efs-volumes.html](https:\u002F\u002Fdocs.aws.amazon.com\u002FAmazonECS\u002Flatest\u002Fdeveloperguide\u002Ftutorial-efs-volumes.html)\n- Pulumi examples: [https:\u002F\u002Fgithub.com\u002Fpulumi\u002Fexamples\u002Fblob\u002Fmaster\u002Faws-ts-lambda-efs\u002Findex.ts](https:\u002F\u002Fgithub.com\u002Fpulumi\u002Fexamples\u002Fblob\u002Fmaster\u002Faws-ts-lambda-efs\u002Findex.ts)\n\n\n\n```ts\nimport * as pulumi from \"@pulumi\u002Fpulumi\";\nimport * as aws from \"@pulumi\u002Faws\";\n\n\u002F\u002F Create an ECS cluster\nconst ecsCluster = new aws.ecs.Cluster(\"my-ecs-cluster\");\n\n\u002F\u002F Get the most recent Ubuntu 20.04 LTS image\nconst ubuntuAmi = pulumi.output(aws.ec2.getAmi({\n    filters: [\n        {\n            name: \"name\",\n            values: [\"ubuntu\u002Fimages\u002Fhvm-ssd\u002Fubuntu-focal-20.04-amd64-server-*\"],\n        },\n        {\n            name: \"virtualization-type\",\n            values: [\"hvm\"],\n        },\n    ],\n    owners: [\"099720109477\"], \u002F\u002F Canonical owner ID\n    mostRecent: true,\n}));\n\n\u002F\u002F Create a security group for the cluster\nconst clusterSecurityGroup = new aws.ec2.SecurityGroup(\"cluster-security-group\", {\n    ingress: [\n        {\n            fromPort: 0,\n            toPort: 65535,\n            protocol: \"tcp\",\n            cidrBlocks: [\"0.0.0.0\u002F0\"],\n        },\n    ],\n});\n\n\u002F\u002F Create a launch configuration for the ASG\nconst launchConfiguration = new aws.ec2.LaunchConfiguration(\"ecs-launch-configuration\", {\n    imageId: \"ami-xxxxxxxxxxxx\",\n    instanceType: \"t2.micro\",\n    iamInstanceProfile: \"\u003Creplace-with-your-iam-instance-profile\u003E\",\n    associatePublicIpAddress: true,\n    securityGroups: [clusterSecurityGroup.id],\n    userData: `#!\u002Fbin\u002Fbash\necho ECS_CLUSTER=${ecsCluster.id} \u003E\u003E \u002Fetc\u002Fecs\u002Fecs.config`,\n});\n\n\u002F\u002F Create an Auto Scaling Group\nconst autoScalingGroup = new aws.autoscaling.Group(\"ecs-asg\", {\n    desiredCapacity: 2,\n    launchConfiguration: launchConfiguration.id,\n    maxSize: 5,\n    minSize: 1,\n    tags: [\n        { key: \"Name\", value: \"my-ecs-asg\", propagateAtLaunch: true },\n    ],\n});\n\n\u002F\u002F Create an ECS capacity provider\nconst capacityProvider = new aws.ecs.CapacityProvider(\"my-capacity-provider\", {\n    autoScalingGroupProvider: {\n        autoScalingGroupArn: autoScalingGroup.arn,\n        managedScaling: {\n           : \"ENABLED\",\n            targetCapacity: 75,\n        },\n        managedTerminationProtection: \"ENABLED\",\n    },\n});\n\n\u002F\u002F Add the capacity provider to the ECS cluster\nconst clusterCapacityProvider = new aws.ecs.ClusterCapacityProviders(\"ecs-cluster-capacity-providers\", {\n    capacityProviders: [capacityProvider.name],\n    clusterName: ecsCluster.name,\n});\n\n\u002F\u002F Export ECS cluster name\nexport const ecsClusterName = ecsCluster.name;\n```\n\n```ts\nconst targets = [];\nfor (let i = 0; i \u003C subnetIds.length; i++) {\n    targets.push(new aws.efs.MountTarget(`fs-mount-${i}`, {\n        fileSystemId: filesystem.id,\n        subnetId: subnetIds[i],\n        securityGroups: [vpc.vpc.defaultSecurityGroupId],\n    }));\n}\nconst ap = new aws.efs.AccessPoint(\"ap\", {\n    fileSystemId: filesystem.id,\n    posixUser: { uid: 1000, gid: 1000 },\n    rootDirectory: { path: \"\u002Fwww\", creationInfo: { ownerGid: 1000, ownerUid: 1000, permissions: \"755\" } },\n}, { dependsOn: targets });\n```\n"}}],fetch:{},mutations:[]}}("text","element","span","token","punctuation"," ","operator",",",":","\n","string",".","keyword","}","{",";","(",")","[","]","=","function","number","const","comment","aws","li","\n\n","new","class-name","\n        ","a","\n    ","id","ecs","true","nofollow","noopener","noreferrer","_blank","template-punctuation","`","interpolation-punctuation","1000","efs","ec2","boolean","name","Deploying InvokeAI on AWS ECS with Pulumi",true,"links","Links","ul","https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002F","https:\u002F\u002Finvoke-ai.github.io\u002FInvokeAI\u002Finstallation\u002F040_INSTALL_DOCKER\u002F","https:\u002F\u002Fdocs.aws.amazon.com\u002FAmazonECS\u002Flatest\u002Fdeveloperguide\u002Ftutorial-efs-volumes.html","https:\u002F\u002Fgithub.com\u002Fpulumi\u002Fexamples\u002Fblob\u002Fmaster\u002Faws-ts-lambda-efs\u002Findex.ts","div","nuxt-content-highlight","pre","language-ts","line-numbers","code","import","*","as","from","\n            name","\n            values","0","template-string","interpolation","${","\"ENABLED\""," ecsCluster"," targets "," i "," subnetIds","i"," filesystem","vpc","2023-07-25T13:37:31.188Z")));