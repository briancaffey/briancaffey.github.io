__NUXT_JSONP__("/fr/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$){return {data:[{article:{slug:"python-vue-chinese-llama-2-and-the-three-body-problem",description:null,title:"Python, Vue, Chinese-LLaMA-2 and The Three-Body Problem",date:"2023-11-23",image:"\u002Fimg\u002Fthree-body-problem\u002Fcover.png",tags:["three-body-problem",aB,aC,"ai","chinese","python","nvidia","cuda","gpu","stable-diffusion","langchain","vue","three.js"],external:[{link:"https:\u002F\u002Fnews.ycombinator.com\u002Fitem?id=38393757",site:"hn"},{link:"https:\u002F\u002Fwww.reddit.com\u002Fr\u002Fthreebodyproblem\u002Fcomments\u002F1823l5j\u002Fpython_vue_chinesellama2_and_the_threebody_problem\u002F",site:"reddit"},{link:"https:\u002F\u002Ftwitter.com\u002Fbriancaffey\u002Fstatus\u002F1727710878349332614",site:aD}],comments:aE,toc:[{id:aF,depth:Q,text:aG},{id:aH,depth:Q,text:aI},{id:aJ,depth:ad,text:aK},{id:aL,depth:Q,text:aM},{id:aN,depth:Q,text:aO},{id:aP,depth:ad,text:aQ},{id:aR,depth:Q,text:aS},{id:aT,depth:Q,text:aU},{id:aV,depth:ad,text:aW},{id:aX,depth:ad,text:aY},{id:aZ,depth:Q,text:a_},{id:a$,depth:Q,text:ba}],body:{type:"root",children:[{type:b,tag:"h1",props:{id:"tldr"},children:[{type:b,tag:t,props:{href:"#tldr",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:"tl;dr"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"This articles brings together several of my interest, both old and new:"}]},{type:a,value:f},{type:b,tag:Z,props:{},children:[{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"The Sci-Fi book series 'Three-Body Problem' by Liu Cixun"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese language"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"NLP techniques"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Large Language Models (LLMs)"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Stable Diffusion"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Data visualization and 3D graphics"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Mathematics"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"NVIDIA \u002F CUDA"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"This is a linguistic, artistic and computational experiment with the two big AI algorithms of 2023: large language models (LLMs) and Stable Diffusion. I used the leading open-source LLMs from China‚Äôs tech sector to translate and summarize the text of Chinese author Liu Cixin‚Äôs award-winning science fiction novel: The Three-Body Problem. The book's storyline is based on a simple yet elusive problem from classical physics: predicting the movement of three gravitationally-attracted objects in space. I generated code for simulations and visualizations of this physics problem to present my own solutions to the three-body problem based on parallel computation. I also used Stable Diffusion to portray the imaginitive solutions to the three-body physics problem from one of the book‚Äôs main settings: an immersive virtual-reality game that spans centries of world history."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I also share some of my experiences in China as an exchange student and research manager in the renewable energy technology sector. I wrote this article in English and translated it into Chinese using the same large language models I used to translate the Chinese text of the sci-fi novel into English. Warning: this article contains spoilers for the first book in the trilogy!"}]},{type:a,value:f},{type:b,tag:R,props:{id:aF},children:[{type:b,tag:t,props:{href:"#back-story",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aG}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"A few months ago my company announced that another round of layoffs was to come the following week. I'm on an engineering team that had already been impacted by a few rounds of layoffs in the past year, and I was expecting to be let go. On an impulse I bought a book at the top of my reading list from Amazon: \"Three-Body Problem\". It is an award-winning Sci-Fi trilogy written by Liu Cixin, a Chinese computer engineer who started writing the book as a series of essays that were published in China's \"World of Sci-Fi\" magazine."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"Images of Three Body Problem Book Series",src:"\u002Fimg\u002Fthree-body-problem\u002Fbooks.png"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I started learning Chinese in college, adding a major in Chinese Language to the mathematics major I decided on in my freshman year after taking vector calculus and linear algebra. In my sophmore year I did a semester abroad at Fudan University's "},{type:b,tag:t,props:{href:"https:\u002F\u002Fices.fudan.edu.cn\u002F6628\u002Flist.htm",rel:[E,F,G],target:H},children:[{type:a,value:"International Cultural Exchange School"}]},{type:a,value:". In 2007, living and studying Chinese in Shanghai as a 19 year old American was a really fun time. I was placed in an advanced-level course with a diverse group of students where English was not the lowest common linguistic denominator. We had a demanding cirriculum that emphasized reading, listening and speaking Chinese, but most of the language learning came through extracirricular activities: exploring Shanghai's food scene, bartering with vendors at the fabric markets, late night clubbing, walking around the Bund and the French Concession and chatting with my taxi cab drivers. It is hard to imagine how I did this without an iPhone, but I was able to get pretty far with an old Nokia 3310."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"At the end of one night of particularly heavy drinking, some of my classmates and I dropped in on an wangba (internet cafe) before heading back to the international dorm. Chinese internet cafes in 2007 were an expansive underground dens of computers, monitors, MMORPGs, FPSs, cigarets, and on-demand instant noodles delivered directly to your seat through an app on the desktop. That night our game of choice was Counter-Strike. In one of the lowest points of my gaming career, my classmates and I were crushed by our Chinese counterterrorist opponent."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"Chinese internet cafe",src:"\u002Fimg\u002Fthree-body-problem\u002Fwangba.webp"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"My favorite memory of that semester at Fudan University was travelling on an epic over-night sleeper train from Shanghai to Guangxi province with a school-sponsored class trip to see Guilin. Multiple games of sam-yuk-gu (3-6-9) ran in parallel across the matrix of 3-by-2 sleeper car bunk beds lining the train car like workloads distributed across multiple GPU cores. The rules of 3-6-9 are simple: a group of people go around in a circle counting up from 1. If your number contains a 3, 6 or 9, you clap once for each occurance of the number instead of saying your number. The first person to break the rules takes a drink. Then repeat indefinitely. The next morning we all boarded a boat cruise in a daze to see the Lijiang river's stunning limestone peaks featured on the 20 yuan note:"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"20 yuan note with Guilin rock formations",src:"\u002Fimg\u002Fthree-body-problem\u002Ftwenty_small.gif"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"My second job after college took me back to China where I specialized in the technologies, policies and applications of large scale battery projects as a research manager for China's energy storage industry association. The job exposed me to the power industry and cutting-edge battery projects, and also sharpened my technical Chinese as I was frequently reading, translating in a bi-linguagl environment. It was fun  I didn't realize it at the time, but that job was great preperation for reading Chinese Sci-Fi novels."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"State Grid HQ in Xi Cheng",src:"\u002Fimg\u002Fthree-body-problem\u002Finvokeai\u002Fcastles.png"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"My first introduction to the 'Three-Body Problem' book came from one of my best friends from college. He lived at the inner-most leaf-node of one of Beijing's most labrythnian hutongs next to a family that trained racing pigeons. My friend and I bonded over our study of Chinese language, classical guitar and our experiences in Beijing. I strongly considered his recommendation to check out ‰∏â‰Ωì (Three Body), the Chinese Sci-Fi novel about alien life in a solar system with three stars as he described it, but I never had the chance to read the book."}]},{type:a,value:f},{type:b,tag:_,props:{width:$,height:315,src:"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002F5lj99Uz1d50?si=TwrypbY4vTfeWGRf",title:"YouTube video player",frameBorder:w,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:aE},children:[]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Almost 10 years later I came across across a preview for the Netflix production of \"3 Body Problem\" scheduled to come out in early 2024. With the possibility of loosing my job weighing heavily on me, I picked up the books on Amazon hoping to have something to if I was going to be layed off. Over the weekend I was able to read a few of the chapters on my Kindle. I had not completely forgotten how to speak Chinese, and I could easily look up words and translate entire paragraphs with Google Translate."}]},{type:a,value:f},{type:b,tag:R,props:{id:aH},children:[{type:b,tag:t,props:{href:"#chinese-in-numbers",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aI}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here's a quick primer on the Chinese language from a mathematical perspective. This will be helpful before jumping into using NLP and LLMs with Chinese text later in this article."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"First, how many Chinese characters are there? This question isn't specific enough to have a single answer. A common rule of thumb that I have heard before says that there are over 50,000 characters in total with roughly 10,000 characters in use and about 3,000 characters frequently used in Chinese media and newspapers ("},{type:b,tag:t,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FChinese_language#Vocabulary",rel:[E,F,G],target:H},children:[{type:a,value:"source"}]},{type:a,value:"). "},{type:b,tag:t,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fa\u002F1366113\u002F6084948",rel:[E,F,G],target:H},children:[{type:a,value:"This answer"}]},{type:a,value:" from StackOverflow's legendary #1 ranked user VonC gives a good answer based on the number of Unicode characters in the CJK Unified Ideographs block: 20,992."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here are some numbers and statistics to be better understand the text of the Three-Body Problem Chinese text:"}]},{type:a,value:f},{type:b,tag:Z,props:{},children:[{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"188,380 total charactes in the book"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"2,859 unique characters in the book"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"36 chapters in the book"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"average of 69.78 paragraphs per chapter"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"total of 2,512 paragraphs in the book"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"average of 74.99 characters per paragraph"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:ae,props:{id:aJ},children:[{type:b,tag:t,props:{href:"#character-frequency",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aK}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Let's look at how frequently each character in the book is used. We can also combine this with some data on the overall frequency of Chinese characters. The best measurement I found for overall character frequency is from "},{type:b,tag:t,props:{href:"https:\u002F\u002Flingua.mtsu.edu\u002Fchinese-computing\u002Fstatistics\u002Fchar\u002Flist.php?Which=MO",rel:[E,F,G],target:H},children:[{type:a,value:"Middle Tennessee State University"}]},{type:a,value:". Here's a visualization that shows of all of unique characters in the book. The height of a column represents how frequently a character occurs in the book, and the color represents the relatively frequency of the character in Chinese language overall."}]},{type:a,value:f},{type:b,tag:D,props:{className:["wrap"]},children:[{type:a,value:f},{type:b,tag:_,props:{className:[bb],src:"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Ftjs\u002Fload.html",width:$,height:bc},children:[]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:R,props:{id:aL},children:[{type:b,tag:t,props:{href:"#meta-llms-and-grass-mud-horse",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aM}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"In recent months I have been following the development of big open source AI projects. Two projects in particular are InvokeAI, an image generation tool based on Stable Diffusion, and "},{type:b,tag:t,props:{href:"https:\u002F\u002Fai.meta.com\u002Fllama\u002F",rel:[E,F,G],target:H},children:[{type:a,value:"LLaMA 2"}]},{type:a,value:", the latest generation of Meta's open source LLM. The name LLaMA stands for 'Large Language Model Meta AI', which happens to be the same spelling as the word for the domesticated South American camelid: llama. Before going deeper into LLMs we need a quick Chinese lesson."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"ËçâÊ≥•È©¨ is a non-technical word that referes to animals like Llama or Alpaca. It can be directly translated as \"Grass Mud Horse\" and it is phonetically similar to the most common Chinese profanity: Êìç‰Ω†Â¶à, which literally means \"f*** your mother\". The characters in these two words are nearly synonymous: the sounds of both words are \"cao ni ma\", but the tones are different, which in Chinese changes the meaning completely. The llama is basically a legendary Chinese internet meme subversive in the face of government censorship. ü¶ô was approved as part of Unicode 11.0 in 2018. The extended version of this profanity is ËçâÊ≥•È©¨ÊààÂ£Å (C«éon√≠m«é Gƒìb√¨: Grass Mud Horse Gobi), refering to the geographical origin of this mythical creature: the Gobi Dessert. This term is more explicit as it synonymous with \"f*** your mother's c***\". Coincidentally, the Gobi Desert is a region of Inner Mongolia which borders the mountainous region of Greater Khingan Range (Â§ßÂÖ¥ÂÆâÂ≤≠), the location of Red Coast and Radar Peak in Three-Body Problem where Ye Wenjie makes first contact with the Trisolarians."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I requested access to Meta's LLaMa 2 models as soon as they came out and I was able to get it to run on my NVIDIA RTX 4090 GPU. I also joined a subreddit called "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.reddit.com\u002Fr\u002FLocalLLaMA\u002F",rel:[E,F,G],target:H},children:[{type:b,tag:u,props:{},children:[{type:a,value:"r\u002FLocalLLaMa"}]}]},{type:a,value:" with over seventy thousand members discussing how to run large language models on consumer hardware. Another annoucement that caught my attention in July was the release of "},{type:b,tag:t,props:{href:"https:\u002F\u002Fgithub.com\u002Fymcui\u002FChinese-LLaMA-Alpaca-2",rel:[E,F,G],target:H},children:[{type:a,value:"Chinese LLaMa 2"}]},{type:a,value:", an open-source large language model trained on Chinese and English which does very well against Chinese Language LLM Benchmarks such as the CMMCU: Chinese Massive Multitask Language Understanding."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"image of CMMLU",src:"\u002Fimg\u002Fthree-body-problem\u002Fcmmlu.jpeg"},children:[]}]},{type:a,value:f},{type:b,tag:R,props:{id:aN},children:[{type:b,tag:t,props:{href:"#translation-in-and-of-the-three-body-problem",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aO}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"There are two important plot developments related to language translation in the Three-Body Problem novel, both of which involve book‚Äôs main female protagonist Ye Wenjie. First, copying the translation of Rachel Carson's 'Silent Spring' leads to her being relegated to the Red Coast project. At the Red Coast Ye Wenjie communicates with extraterrestrial life through a universal translation technology developed by the top-secret project."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Ken Liu‚Äôs translation of the Three-Body Problem book from Chinese to English places the events during the Cultural Revolution at the beginning of the book rather than in the middle of the book. According to Liu, this was done in order to avoid attention of government censors, and his original intention was to tell the story in this way, starting with the events of the late 1960's in China."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I tried translating the Chinese text of the Three-Body Problem book using LLMs. I started with the Chinese-LLaMA-2 model and then tried Qwen-7B-Chat, Baichuan-13B-Chat when these models came out. I found that the Qwen-7B-Chat model worked best for my translation tasks. Qwen is short for Qian Wen (ÂçÉÈóÆ, or \"one thousand questions\") and is developed by Alibaba Cloud."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"How do you get an LLM to translate text? Ultimately the quality of the translation returned by the LLM depends on the prompt and other parameters used for inference. I experimented with both chat and completion approaches and tried lots of different kinds of prompts. The models I worked with have a 4K context window (the number of tokens the model can take as input when generating responses), so for translation tasks I had the LLM work on one paragraph at a time. Here's the prompt I used with the Qwen-7B-Chat model:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,aq]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"\"‰Ω†ÊòØ‰∏ÄÂêçÁøªËØë„ÄÇËØ∑Â∞ÜÊØèÊù°Ê∂àÊÅØ‰ªé‰∏≠ÊñáÁøªËØëÊàêËã±Êñá„ÄÇ\"\n(You are a translator. Please translate each message from Chinese to English.)\n"}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I did some basic prompt engineering to get the LLM to translate the books in the Three-Body problem paragraph by paragraph. My computer was able to translate the first book overnight in under 500 minutes. Here are the results of my translation of Three-Body Problem with Qwen-7B-Chat model:"}]},{type:a,value:f},{type:b,tag:_,props:{className:[bb],src:"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Freader\u002F?book=three_body&chapterNumber=1",width:$,height:bc},children:[]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"It was interesting to see the failure modes of translation tasks for the different models. Most of the time the LLM was able to provided accurate translations. Some of the failure modes I observed were:"}]},{type:a,value:f},{type:b,tag:Z,props:{},children:[{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"a few Chinese characters would show up in the English translations"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"a complete Chinese sentence would show up in an otherwise complete translation of a paragraph"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"The LLM refused to translate certain paragraphs that included violent imagery, such as the violent scenes from the Cultural Revolution chapters"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"If the sentence it was asked to translate was a question, the LLM would respond in Chinese to the question rather than providing a translation of the question itself"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:ae,props:{id:aP},children:[{type:b,tag:t,props:{href:"#tokenization",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aQ}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"When you feed a prompt to an LLM, it first puts the prompt through a process called tokenization. Tokenization takes a string of text and breaks it down into tokens (defined by the Large Language Model you are using). The process of tokenization is similar to the tokenization done by spaCy mentioned earlier. These tokens produced by LLM tokenization are numbers. Here's an example of tokenization in action using the Chinese-Llama-2 model:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" json\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" os\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"from"}]},{type:a,value:" llama_cpp "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" LlamaTokenizer\n\nllm "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"\n    model_path"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"\u002Fpath\u002Fto\u002Fmodels\u002Fggml-model-q4_0.bin\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    n_ctx"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"4096"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"\n    n_gpu_layers"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:be}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\ntokenizer "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:" LlamaTokenizer"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aB},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\nTEXT"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"Âú®ÈÇ£‰∏™Â∑≤Ë¢´ÂøòÂç¥ÁöÑÊó•Â≠êÈáåÔºåÂÆÉÁöÑ‰∏ñÁïåÈ¢†Ë¶Ü‰∫Ü„ÄÇÊ≥•ÂúüÈ£ûËµ∞ÔºåÂá∫Áé∞‰∫Ü‰∏ÄÊù°ÂèàÊ∑±ÂèàÂÆΩÁöÑÂ≥°Ë∞∑ÔºåÁÑ∂ÂêéÊ≥•ÂúüÂèàËΩ∞ÈöÜÈöÜÂú∞È£ûÂõûÊù•ÔºåÂ≥°Ë∞∑Ê∂àÂ§±‰∫ÜÔºåÂú®ÂéüÊù•Â≥°Ë∞∑ÁöÑÂ∞ΩÂ§¥Âá∫Áé∞‰∫Ü‰∏ÄÂ∫ßÈªëËâ≤ÁöÑÂ≠§Â≥∞„ÄÇÂÖ∂ÂÆûÔºåÂú®ËøôÁâáÂπøÈòîÁöÑÁñÜÂüü‰∏äÔºåËøôÁßç‰∫ãÂ∏∏Â∏∏ÂèëÁîüÔºåÊ≥•ÂúüÈ£ûËµ∞ÂèàÈ£ûÂõûÔºåÂ≥°Ë∞∑Âá∫Áé∞ÂèàÊ∂àÂ§±ÔºåÁÑ∂ÂêéÊòØÂ≠§Â≥∞Èôç‰∏¥ÔºåÂ•ΩÂÉèÊòØÁªôÊØèÊ¨°ÁÅæÂèòÊâì‰∏ä‰∏Ä‰∏™ÈÜíÁõÆÁöÑÊ†áËÆ∞„ÄÇË§êËöÅÂíåÂá†Áôæ‰∏™ÂêåÊóèÂ∏¶ÁùÄÂπ∏Â≠òÁöÑËöÅÂêéÂêëÂ§™Èò≥ËêΩ‰∏ãÁöÑÊñπÂêëËµ∞‰∫Ü‰∏ÄÊÆµË∑ØÔºåÂª∫Á´ã‰∫ÜÊñ∞ÁöÑÂ∏ùÂõΩ„ÄÇ\""}]},{type:a,value:"\ntokens "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"TEXT"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,aq]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"print(str(tokens[:4]) + \" ...\")\n"}]}]}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"[1, 30505, 32380, 36812] ..."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,aq]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"for token in tokens:\n    text = tokenizer.decode([token])\n    print(text, end=\" \")\n"}]}]}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Âú® ÈÇ£‰∏™ Â∑≤Ë¢´ Âøò Âç¥ ÁöÑÊó•Â≠ê Èáå Ôºå ÂÆÉÁöÑ ‰∏ñÁïå È¢†Ë¶Ü ‰∫Ü „ÄÇ Ê≥• Âúü È£û Ëµ∞ Ôºå Âá∫Áé∞‰∫Ü ‰∏ÄÊù° Âèà Ê∑± Âèà ÂÆΩ ÁöÑ Â≥°Ë∞∑ Ôºå ÁÑ∂Âêé Ê≥• Âúü Âèà ËΩ∞ ÈöÜ ÈöÜ Âú∞ È£û ÂõûÊù• Ôºå Â≥°Ë∞∑ Ê∂àÂ§± ‰∫Ü Ôºå Âú® ÂéüÊù• Â≥°Ë∞∑ ÁöÑ Â∞ΩÂ§¥ Âá∫Áé∞‰∫Ü ‰∏ÄÂ∫ß ÈªëËâ≤ ÁöÑ Â≠§ Â≥∞ „ÄÇ ÂÖ∂ÂÆû Ôºå Âú®Ëøô Áâá ÂπøÈòî ÁöÑ ÁñÜ Âüü ‰∏ä Ôºå ËøôÁßç‰∫ã Â∏∏Â∏∏ ÂèëÁîü Ôºå Ê≥• Âúü È£û Ëµ∞ Âèà È£û Âõû Ôºå Â≥°Ë∞∑ Âá∫Áé∞ Âèà Ê∂àÂ§± Ôºå ÁÑ∂Âêé ÊòØ Â≠§ Â≥∞ Èôç‰∏¥ Ôºå Â•ΩÂÉèÊòØ Áªô ÊØèÊ¨° ÁÅæ Âèò Êâì ‰∏ä ‰∏Ä‰∏™ ÈÜíÁõÆ ÁöÑ Ê†áËÆ∞ „ÄÇ Ë§ê ËöÅ Âíå Âá†Áôæ ‰∏™ Âêå Êóè Â∏¶ÁùÄ Âπ∏ Â≠ò ÁöÑ ËöÅ Âêé Âêë Â§™Èò≥ ËêΩ ‰∏ãÁöÑ ÊñπÂêë Ëµ∞‰∫Ü ‰∏ÄÊÆµ Ë∑Ø Ôºå Âª∫Á´ã‰∫Ü Êñ∞ÁöÑ Â∏ùÂõΩ „ÄÇ"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"english_text "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"This is an example of tokenization using a large language model.\""}]},{type:a,value:"\nenglish_tokens "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"english_text"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"str"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"english_tokens"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:"+"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\" ...\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bh}]},{type:a,value:" token "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bi}]},{type:a,value:" english_tokens"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:"\n    text "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"decode"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:d},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,"string-interpolation"]},children:[{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"f\"'"}]},{type:b,tag:c,props:{className:[d,"interpolation"]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"{"}]},{type:a,value:a},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"}"}]}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"'\""}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" end"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\" \""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"[1, 4013, 338, 385] ..."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"'' 'This' ' is' ' an' ' example' ' of' ' token' 'ization' ' using' ' a' ' large' ' language' ' model' '.'"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here are some key differences between English and Chinese that have implications for how the language is tokenized by large language models:"}]},{type:a,value:f},{type:b,tag:Z,props:{},children:[{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese does not use spaces between words like English does"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese words are typically formed from 2 or more characters"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese verbs are not conjugated and do not have different tenses"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese words don't have singular and plural variants"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese grammar is very simple and is similar to English"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Chinese characters do not have capitization like ASCII characters"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"The token represented by the number 1 encodes a starting token"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:R,props:{id:aR},children:[{type:b,tag:t,props:{href:"#imagining-scenes-from-three-body-problem-with-stable-diffusion",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aS}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here are some images I generated using Stable Diffusion with InvokeAI that depict scenes from the Three-Body Problem book. These scenes portray solutions to the Three-Body Problem that players in the Three-Body game devised. The first is a Confucian system of etiquette for predicting the movement of the three suns. The second is a human-powered computer that Qin Shi Huang used to try to predict the movement of the three suns."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Prompt: Ceremonies and etiquette system related to the sun and multiple celestial++ bodies Confucius artistic style"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:bk,props:{},children:[{type:a,value:f},{type:b,tag:bl,props:{":count":bm,dir:"confucius"},children:[{type:a,value:f}]}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"array of chinese++ warriors++ on a electronics+ circuit+ board qing+ dynasty style art logic puzzle"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:bk,props:{},children:[{type:a,value:f},{type:b,tag:bl,props:{":count":bn,dir:"computer"},children:[{type:a,value:f}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Congrats to the InvokeAI team on the 3.0 release. It has been awesome to use and the current docker compose setup is a huge improvement on the 2.x version."}]},{type:a,value:f},{type:b,tag:R,props:{id:aT},children:[{type:b,tag:t,props:{href:"#n-body-simulations-cuda-and-threejs",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aU}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The nbody problem has no closed-form analytical solution, but it is possible to do a basic simulation of the three-body problem on consumer hardware and open source software, like NVIDIA and CUDA."}]},{type:a,value:f},{type:b,tag:ae,props:{id:aV},children:[{type:b,tag:t,props:{href:"#three-body-cuda-simulation",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aW}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I wrote a simple program with the help of ChatGPT for running nbody problem simulations. The program uses CuPy, a Python library that exposes APIs for doing matrix multiplication to predict the position of three bodies using Euclidian Integration. Here's the script:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,bo]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" numpy "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:at}]},{type:a,value:" np\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" cupy "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:at}]},{type:a,value:" cp\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" time\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:V}]},{type:a,value:" json\n\n"},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# Simulation parameters"}]},{type:a,value:"\nNUM_PARTICLES "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:a,value:"\nDIMENSIONS "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# 3D space"}]},{type:a,value:"\nNUM_STEPS "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:be}]},{type:a,value:"\nDT "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"0.1"}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# Generate initial positions and velocities"}]},{type:a,value:"\nnp_positions "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\nnp_velocities "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\ncp_positions "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"np_velocities"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\nnp_ticks "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\ncp_ticks "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# nbody simulation loop"}]},{type:a,value:"\nstart_time "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bh}]},{type:a,value:" step "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bi}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"range"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"NUM_STEPS"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# this gets pairwise differences"}]},{type:a,value:"\n    diff "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bz},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:a,value:bz},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\n    distances "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# avoid division by zero"}]},{type:a,value:"\n    epsilon "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bC}]},{type:a,value:"\n    inv_distances "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bD}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:bE}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# calculate forces"}]},{type:a,value:"\n    cp_forces "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:bK}]},{type:a,value:"\n    cp_velocities "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:an}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:" cp_forces\n    cp_positions "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:an}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:" cp_velocities\n    cp_ticks "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"append"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"cp_ticks"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"cp_positions"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\nsim_time "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:a,value:" start_time\n"},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"Simulation time:\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" sim_time"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"class"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,"class-name"]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bN},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"def"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,"function"]},children:[{type:a,value:bP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"if"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"isinstance"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"obj"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"ndarray"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:"\n            "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bR}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"tolist"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bR}]},{type:a,value:" json"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n\n\nnp_ticks "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:" cp_ticks"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"get"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# this is data we can work with in python and write to a file"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"with"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"open"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"ticks.json\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,O]},children:[{type:a,value:"\"w\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:at}]},{type:a,value:" f"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:"\n    f"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"write"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bN},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"dumps"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:" cls"},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bM},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"To better understand the matrix math here I walked through a simple example of what each step does:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,bo]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:"# particle coordinates (x,y,z) in 3D space"}]},{type:a,value:"\npositions "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bn}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"7"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bm}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"9"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The first operation creates an array for pairwise distances for each dimension:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"diff "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The rows of zeros correspond to a particle's "},{type:b,tag:u,props:{},children:[{type:a,value:aD}]},{type:a,value:", "},{type:b,tag:u,props:{},children:[{type:a,value:"y"}]},{type:a,value:" and "},{type:b,tag:u,props:{},children:[{type:a,value:"z"}]},{type:a,value:" distances to itself, which are all zero by axioms of Euclidian vector spaces."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The next operation calculates the distance between each particle:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"distances "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bV}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bV}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The diagonal or zeros represents that fact that a particle "},{type:b,tag:u,props:{},children:[{type:a,value:"n"}]},{type:a,value:" has a distance of zero to iself."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The next step calculates inverse distances and uses a small "},{type:b,tag:u,props:{},children:[{type:a,value:"epsilon"}]},{type:a,value:" value to avoid division by 0:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"epsilon "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bC}]},{type:a,value:"\ninv_distances "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bD}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:bE}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"inv_distances"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bY}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bY}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:b_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:b_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The next step is the most elegant part of the simulation and really flexes the GPU's parallel compute capabilities:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:a,value:"cp_forces "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The "},{type:b,tag:u,props:{},children:[{type:a,value:".T"}]},{type:a,value:" operation transposes a matrix, multiplies by the cube of inverse distances, then transposes the matrix again before summing along the first axis. Transposing a matrix basically swaps rows and columns."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The next two steps are also pretty elegant:"}]},{type:a,value:f},{type:b,tag:D,props:{className:[I]},children:[{type:b,tag:J,props:{className:[K,U]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:c,props:{className:[d,N]},children:[{type:a,value:bK}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:an}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:" cp_forces\ncp_positions "},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:an}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,j]},children:[{type:a,value:Y}]},{type:a,value:" cp_velocities\n"}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"In the last step I append the updated positions to an array that holds every \"tick\" (the positions of each particle between each time interval, "},{type:b,tag:u,props:{},children:[{type:a,value:"DT"}]},{type:a,value:" - \"delta time\")"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here's the formula for the mathematical equation used to calculate the force on any given body in an n-body system:"}]},{type:a,value:f},{type:b,tag:_,props:{src:"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Fiframe\u002Fformula.html",width:$,height:110},children:[]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"To test that the simulation was working correctly I used ChatGPT again to construct a 3D scene in Blender with a Python script:"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"Blender Animation",src:"\u002Fimg\u002Fthree-body-problem\u002Fblender.png"},children:[]}]},{type:a,value:f},{type:b,tag:ae,props:{id:aX},children:[{type:b,tag:t,props:{href:"#threejs",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:aY}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Imagine that we are working for a Chinese startup called the Qin Dynasty. The founder, Qin Shi Huang, is a brutal tyrant with an obsessive fear of assassination. Let's put on our product hat for a minute and think about how we can impress him with a clean solution to the three-body problem. A recent attempt involved building a 30,000-person analog computer that was destroyed in tri-solar syzygy. Failing to accurately predict the movement of the suns could mean execution by live-burial, a fiery death or worse. Using CUDA and Blender is a good MVP but doesn't make for the best technical demo since it involves so many different steps: running the simulation in CUDA, exporting data to JSON, loading data into a visualuzation and then finally rendering a video of the simulation. With a popular Javascript library called Three.js we can run an interactive three-body problem simulation in real-time right in the browser. Here's the three-body simulation I also co-authored with ChatGPT-4 using Three.js:"}]},{type:a,value:f},{type:b,tag:_,props:{src:"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Fthree\u002F",width:$,height:350},children:[]},{type:a,value:f},{type:b,tag:R,props:{id:aZ},children:[{type:b,tag:t,props:{href:"#screen-adaptations-the-gaming-industry-and-the-ccp",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:a_}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Dream of the Red Chamber is one of China's Four Great Classical Novels and is often seen as the pinacle of Chinese fiction. It was written in the mid 18th century and first published in 1791. It is a long saga that totals 960,000 characters in length, on similar scale to the length of the Three-Body Problem trilogy. Sun Wen, a Qing dynasty artist, spent 36 years of his life doing a series of 230 paintings depicting scenes from the Dream of the Red Chamber: dream sequences, demons, goddesses, nuns, nobles, beggars, raging fires, landscapes, interiors, wildlife, gardens, temples, funerals, battles, processions, banquets, trials, operas, marriages."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"Sun Wen paintings sample",src:"\u002Fimg\u002Fthree-body-problem\u002Fdorc.png"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Following in this tradition of celebrating great literature, Tencent Video and China Central Television produced a 30-episode adaptation of the Three-Body Problem that was released in Feburary 2023. It is a surprisingly faithful reproduction of the book that is worth checking out. The portrayal of Shi Qiang (Da Shi) was easily my favorite part of the series. I was also impressed by how the Three-Body VR game scenes were done with computer graphics. It got me thinking about how China is represented in some of the worlds most popular video games."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"games",src:"\u002Fstatic\u002Fthree-body\u002Fgame.png"},children:[]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"This is Rocket League, a competitive vehicular soccer game where players, like in the Three-Body game, must master the laws of gravity. The Chinese-themed Forbiden Temple arena shown here is one of many virtual international venues in the game. Epic Games (creator of Fortnite) bought Rocket League in 2019 for an estimated $250 to $300 million."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Like Rocket League, Overwatch is a highly-competitive eSport on a global scale. It features a large roster of 38 players from all over the world. Dr. Mei-Ling Zhou (Âë®ÁæéÁÅµ) is a Chinese climatologist who uses ice both to attack opponents and to defend herself. Mei became controversial in China due to her adoption as a symbolic figure in the 2019 Hong Kong protests."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Three college friends combined their interest in anime, comics and games (ACG) and literature to publish one of the most successful games created by a Chinese company and arguably one of China's most important cultural exports: Genshin Impact. miHoYo, the Shanghai-based company that develops Genshin Impact, grossed $4 billion of revenue globally in the game's first year setting a new record in the gaming industry. Like other companies of its size, miHoYo has a party committee under the Chinese Communist Party that influences the company's operations."}]},{type:a,value:f},{type:b,tag:R,props:{id:a$},children:[{type:b,tag:t,props:{href:"#ai-and-layoffs-in-the-tech-industry",ariaHidden:z,tabIndex:A},children:[{type:b,tag:c,props:{className:[B,C]},children:[]}]},{type:a,value:ba}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I have a positive attitude toward AI and its ability to supercharge the creative work we do, but I also think that replacing humans and AI-related layoffs should should be a part of the conversation. I wasn't impacted by the recent round of layoffs at my company, and I'm grateful to have the opportunity to work with a talented team on interesting problems in the health tech industry. I do have some solid references for folks in DevOps, product and backend and frontend engineering, and I‚Äôm happy to "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fbrian-caffey-06b22a18\u002F",rel:[E,F,G],target:H},children:[{type:a,value:"connect and share via LinkedIn"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Layoffs in both China and the U.S. have been pummled the tech sector over the last two years. New graduates in China are also facing a difficult job market. There are some popular expressions that paint a picture of the job market in China:"}]},{type:a,value:f},{type:b,tag:Z,props:{},children:[{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"Ë∫∫Âπ≥ Lying flat: avoiding relentless work"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"‰πù‰πùÂÖ≠ 996 Work culture: describes working from 9AM to 9PM, 6 days a week, a common work schedule for many Chinese employees"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"ÂÖ®ËÅåÂÑøÂ•≥ Full-time Children: "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.cnn.com\u002F2023\u002F07\u002F26\u002Feconomy\u002Fchina-youth-unemployment-intl-hnk\u002Findex.html",rel:[E,F,G],target:H},children:[{type:a,value:"Young Chinese are getting paid to be ‚Äòfull-time children‚Äô as jobs become harder to find"}]}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"35Â≤ÅËØÖÂíí The curse of 35: "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.marketplace.org\u002Fshows\u002Fmarketplace-tech\u002Fchinas-tech-workers-ageism-the-curse-of-35\u002F",rel:[E,F,G],target:H},children:[{type:a,value:"Ageism in China‚Äôs tech sector has workers fearing the ‚Äúcurse of 35‚Äù"}]},{type:a,value:". Shout out to my fellow Year of the Dragon 35 year olds! üê≤"}]},{type:a,value:f},{type:b,tag:r,props:{},children:[{type:a,value:"ÂêÉËã¶ Eat Bitterness: "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.nytimes.com\u002F2023\u002F05\u002F30\u002Fbusiness\u002Fchina-youth-unemployment.html",rel:[E,F,G],target:H},children:[{type:a,value:"China‚Äôs Young People Can‚Äôt Find Jobs. Xi Jinping Says to ‚ÄòEat Bitterness.‚Äô"}]}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"It is an exciting time for AI. Elon Musk and Kaifu Lee have both recently released open-source large language models: Grok and Yi. Sam Altman was fired as CEO of OpenAI, then came back. Stable Diffusion just released a text to video model. AGI might already be here. In the U.S., we are going into our first presidential election cycle with AI fully turned on. Here's a "},{type:b,tag:t,props:{href:"https:\u002F\u002Fwww.amazon.com\u002FThree-Body-Problem-Cixin-Liu\u002Fdp\u002F0765382032",rel:[E,F,G],target:H},children:[{type:a,value:"link to The Three-Body Problem book on Amazon"}]},{type:a,value:". Thanks for reading and Happy Thanksgiving!"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:b,tag:P,props:{alt:"Happy Thanksgiving",src:"\u002Fimg\u002Fthree-body-problem\u002Fthanksgiving.png"},children:[]}]}]},dir:"\u002F2023\u002F08\u002F27",path:"\u002F2023\u002F08\u002F27\u002Fpython-vue-chinese-llama-2-and-the-three-body-problem",extension:".md",createdAt:b$,updatedAt:b$,raw:"\n# tl;dr\n\nThis articles brings together several of my interest, both old and new:\n\n- The Sci-Fi book series 'Three-Body Problem' by Liu Cixun\n- Chinese language\n- NLP techniques\n- Large Language Models (LLMs)\n- Stable Diffusion\n- Data visualization and 3D graphics\n- Mathematics\n- NVIDIA \u002F CUDA\n\nThis is a linguistic, artistic and computational experiment with the two big AI algorithms of 2023: large language models (LLMs) and Stable Diffusion. I used the leading open-source LLMs from China‚Äôs tech sector to translate and summarize the text of Chinese author Liu Cixin‚Äôs award-winning science fiction novel: The Three-Body Problem. The book's storyline is based on a simple yet elusive problem from classical physics: predicting the movement of three gravitationally-attracted objects in space. I generated code for simulations and visualizations of this physics problem to present my own solutions to the three-body problem based on parallel computation. I also used Stable Diffusion to portray the imaginitive solutions to the three-body physics problem from one of the book‚Äôs main settings: an immersive virtual-reality game that spans centries of world history.\n\nI also share some of my experiences in China as an exchange student and research manager in the renewable energy technology sector. I wrote this article in English and translated it into Chinese using the same large language models I used to translate the Chinese text of the sci-fi novel into English. Warning: this article contains spoilers for the first book in the trilogy!\n\n## Back story\n\nA few months ago my company announced that another round of layoffs was to come the following week. I'm on an engineering team that had already been impacted by a few rounds of layoffs in the past year, and I was expecting to be let go. On an impulse I bought a book at the top of my reading list from Amazon: \"Three-Body Problem\". It is an award-winning Sci-Fi trilogy written by Liu Cixin, a Chinese computer engineer who started writing the book as a series of essays that were published in China's \"World of Sci-Fi\" magazine.\n\n![Images of Three Body Problem Book Series](\u002Fimg\u002Fthree-body-problem\u002Fbooks.png)\n\nI started learning Chinese in college, adding a major in Chinese Language to the mathematics major I decided on in my freshman year after taking vector calculus and linear algebra. In my sophmore year I did a semester abroad at Fudan University's [International Cultural Exchange School](https:\u002F\u002Fices.fudan.edu.cn\u002F6628\u002Flist.htm). In 2007, living and studying Chinese in Shanghai as a 19 year old American was a really fun time. I was placed in an advanced-level course with a diverse group of students where English was not the lowest common linguistic denominator. We had a demanding cirriculum that emphasized reading, listening and speaking Chinese, but most of the language learning came through extracirricular activities: exploring Shanghai's food scene, bartering with vendors at the fabric markets, late night clubbing, walking around the Bund and the French Concession and chatting with my taxi cab drivers. It is hard to imagine how I did this without an iPhone, but I was able to get pretty far with an old Nokia 3310.\n\nAt the end of one night of particularly heavy drinking, some of my classmates and I dropped in on an wangba (internet cafe) before heading back to the international dorm. Chinese internet cafes in 2007 were an expansive underground dens of computers, monitors, MMORPGs, FPSs, cigarets, and on-demand instant noodles delivered directly to your seat through an app on the desktop. That night our game of choice was Counter-Strike. In one of the lowest points of my gaming career, my classmates and I were crushed by our Chinese counterterrorist opponent.\n\n![Chinese internet cafe](\u002Fimg\u002Fthree-body-problem\u002Fwangba.webp)\n\nMy favorite memory of that semester at Fudan University was travelling on an epic over-night sleeper train from Shanghai to Guangxi province with a school-sponsored class trip to see Guilin. Multiple games of sam-yuk-gu (3-6-9) ran in parallel across the matrix of 3-by-2 sleeper car bunk beds lining the train car like workloads distributed across multiple GPU cores. The rules of 3-6-9 are simple: a group of people go around in a circle counting up from 1. If your number contains a 3, 6 or 9, you clap once for each occurance of the number instead of saying your number. The first person to break the rules takes a drink. Then repeat indefinitely. The next morning we all boarded a boat cruise in a daze to see the Lijiang river's stunning limestone peaks featured on the 20 yuan note:\n\n![20 yuan note with Guilin rock formations](\u002Fimg\u002Fthree-body-problem\u002Ftwenty_small.gif)\n\nMy second job after college took me back to China where I specialized in the technologies, policies and applications of large scale battery projects as a research manager for China's energy storage industry association. The job exposed me to the power industry and cutting-edge battery projects, and also sharpened my technical Chinese as I was frequently reading, translating in a bi-linguagl environment. It was fun  I didn't realize it at the time, but that job was great preperation for reading Chinese Sci-Fi novels.\n\n![State Grid HQ in Xi Cheng](\u002Fimg\u002Fthree-body-problem\u002Finvokeai\u002Fcastles.png)\n\nMy first introduction to the 'Three-Body Problem' book came from one of my best friends from college. He lived at the inner-most leaf-node of one of Beijing's most labrythnian hutongs next to a family that trained racing pigeons. My friend and I bonded over our study of Chinese language, classical guitar and our experiences in Beijing. I strongly considered his recommendation to check out ‰∏â‰Ωì (Three Body), the Chinese Sci-Fi novel about alien life in a solar system with three stars as he described it, but I never had the chance to read the book.\n\n\u003Ciframe width=\"100%\" height=\"315\" src=\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002F5lj99Uz1d50?si=TwrypbY4vTfeWGRf\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\n\nAlmost 10 years later I came across across a preview for the Netflix production of \"3 Body Problem\" scheduled to come out in early 2024. With the possibility of loosing my job weighing heavily on me, I picked up the books on Amazon hoping to have something to if I was going to be layed off. Over the weekend I was able to read a few of the chapters on my Kindle. I had not completely forgotten how to speak Chinese, and I could easily look up words and translate entire paragraphs with Google Translate.\n\n## Chinese in numbers\n\nHere's a quick primer on the Chinese language from a mathematical perspective. This will be helpful before jumping into using NLP and LLMs with Chinese text later in this article.\n\nFirst, how many Chinese characters are there? This question isn't specific enough to have a single answer. A common rule of thumb that I have heard before says that there are over 50,000 characters in total with roughly 10,000 characters in use and about 3,000 characters frequently used in Chinese media and newspapers ([source](https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FChinese_language#Vocabulary)). [This answer](https:\u002F\u002Fstackoverflow.com\u002Fa\u002F1366113\u002F6084948) from StackOverflow's legendary #1 ranked user VonC gives a good answer based on the number of Unicode characters in the CJK Unified Ideographs block: 20,992.\n\nHere are some numbers and statistics to be better understand the text of the Three-Body Problem Chinese text:\n\n- 188,380 total charactes in the book\n- 2,859 unique characters in the book\n- 36 chapters in the book\n- average of 69.78 paragraphs per chapter\n- total of 2,512 paragraphs in the book\n- average of 74.99 characters per paragraph\n\n### Character Frequency\n\nLet's look at how frequently each character in the book is used. We can also combine this with some data on the overall frequency of Chinese characters. The best measurement I found for overall character frequency is from [Middle Tennessee State University](https:\u002F\u002Flingua.mtsu.edu\u002Fchinese-computing\u002Fstatistics\u002Fchar\u002Flist.php?Which=MO). Here's a visualization that shows of all of unique characters in the book. The height of a column represents how frequently a character occurs in the book, and the color represents the relatively frequency of the character in Chinese language overall.\n\n\u003Cdiv class='wrap'\u003E\n\u003Ciframe class=\"p-4\" src=\"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Ftjs\u002Fload.html\" width=100% height=550\u003E\u003C\u002Fiframe\u003E\n\u003C\u002Fdiv\u003E\n\n## Meta, LLMs, and Grass Mud Horse\n\nIn recent months I have been following the development of big open source AI projects. Two projects in particular are InvokeAI, an image generation tool based on Stable Diffusion, and [LLaMA 2](https:\u002F\u002Fai.meta.com\u002Fllama\u002F), the latest generation of Meta's open source LLM. The name LLaMA stands for 'Large Language Model Meta AI', which happens to be the same spelling as the word for the domesticated South American camelid: llama. Before going deeper into LLMs we need a quick Chinese lesson.\n\nËçâÊ≥•È©¨ is a non-technical word that referes to animals like Llama or Alpaca. It can be directly translated as \"Grass Mud Horse\" and it is phonetically similar to the most common Chinese profanity: Êìç‰Ω†Â¶à, which literally means \"f*** your mother\". The characters in these two words are nearly synonymous: the sounds of both words are \"cao ni ma\", but the tones are different, which in Chinese changes the meaning completely. The llama is basically a legendary Chinese internet meme subversive in the face of government censorship. ü¶ô was approved as part of Unicode 11.0 in 2018. The extended version of this profanity is ËçâÊ≥•È©¨ÊààÂ£Å (C«éon√≠m«é Gƒìb√¨: Grass Mud Horse Gobi), refering to the geographical origin of this mythical creature: the Gobi Dessert. This term is more explicit as it synonymous with \"f*** your mother's c***\". Coincidentally, the Gobi Desert is a region of Inner Mongolia which borders the mountainous region of Greater Khingan Range (Â§ßÂÖ¥ÂÆâÂ≤≠), the location of Red Coast and Radar Peak in Three-Body Problem where Ye Wenjie makes first contact with the Trisolarians.\n\nI requested access to Meta's LLaMa 2 models as soon as they came out and I was able to get it to run on my NVIDIA RTX 4090 GPU. I also joined a subreddit called [`r\u002FLocalLLaMa`](https:\u002F\u002Fwww.reddit.com\u002Fr\u002FLocalLLaMA\u002F) with over seventy thousand members discussing how to run large language models on consumer hardware. Another annoucement that caught my attention in July was the release of [Chinese LLaMa 2](https:\u002F\u002Fgithub.com\u002Fymcui\u002FChinese-LLaMA-Alpaca-2), an open-source large language model trained on Chinese and English which does very well against Chinese Language LLM Benchmarks such as the CMMCU: Chinese Massive Multitask Language Understanding.\n\n![image of CMMLU](\u002Fimg\u002Fthree-body-problem\u002Fcmmlu.jpeg)\n\n## Translation in and of The Three-Body Problem\n\nThere are two important plot developments related to language translation in the Three-Body Problem novel, both of which involve book‚Äôs main female protagonist Ye Wenjie. First, copying the translation of Rachel Carson's 'Silent Spring' leads to her being relegated to the Red Coast project. At the Red Coast Ye Wenjie communicates with extraterrestrial life through a universal translation technology developed by the top-secret project.\n\nKen Liu‚Äôs translation of the Three-Body Problem book from Chinese to English places the events during the Cultural Revolution at the beginning of the book rather than in the middle of the book. According to Liu, this was done in order to avoid attention of government censors, and his original intention was to tell the story in this way, starting with the events of the late 1960's in China.\n\nI tried translating the Chinese text of the Three-Body Problem book using LLMs. I started with the Chinese-LLaMA-2 model and then tried Qwen-7B-Chat, Baichuan-13B-Chat when these models came out. I found that the Qwen-7B-Chat model worked best for my translation tasks. Qwen is short for Qian Wen (ÂçÉÈóÆ, or \"one thousand questions\") and is developed by Alibaba Cloud.\n\nHow do you get an LLM to translate text? Ultimately the quality of the translation returned by the LLM depends on the prompt and other parameters used for inference. I experimented with both chat and completion approaches and tried lots of different kinds of prompts. The models I worked with have a 4K context window (the number of tokens the model can take as input when generating responses), so for translation tasks I had the LLM work on one paragraph at a time. Here's the prompt I used with the Qwen-7B-Chat model:\n\n```\n\"‰Ω†ÊòØ‰∏ÄÂêçÁøªËØë„ÄÇËØ∑Â∞ÜÊØèÊù°Ê∂àÊÅØ‰ªé‰∏≠ÊñáÁøªËØëÊàêËã±Êñá„ÄÇ\"\n(You are a translator. Please translate each message from Chinese to English.)\n```\n\nI did some basic prompt engineering to get the LLM to translate the books in the Three-Body problem paragraph by paragraph. My computer was able to translate the first book overnight in under 500 minutes. Here are the results of my translation of Three-Body Problem with Qwen-7B-Chat model:\n\n\u003Ciframe class=\"p-4\" src=\"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Freader\u002F?book=three_body&chapterNumber=1\" width=100% height=550\u003E\u003C\u002Fiframe\u003E\n\nIt was interesting to see the failure modes of translation tasks for the different models. Most of the time the LLM was able to provided accurate translations. Some of the failure modes I observed were:\n\n- a few Chinese characters would show up in the English translations\n- a complete Chinese sentence would show up in an otherwise complete translation of a paragraph\n- The LLM refused to translate certain paragraphs that included violent imagery, such as the violent scenes from the Cultural Revolution chapters\n- If the sentence it was asked to translate was a question, the LLM would respond in Chinese to the question rather than providing a translation of the question itself\n\n### Tokenization\n\nWhen you feed a prompt to an LLM, it first puts the prompt through a process called tokenization. Tokenization takes a string of text and breaks it down into tokens (defined by the Large Language Model you are using). The process of tokenization is similar to the tokenization done by spaCy mentioned earlier. These tokens produced by LLM tokenization are numbers. Here's an example of tokenization in action using the Chinese-Llama-2 model:\n\n```python\nimport json\nimport os\nfrom llama_cpp import Llama, LlamaTokenizer\n\nllm = Llama(\n    model_path=\"\u002Fpath\u002Fto\u002Fmodels\u002Fggml-model-q4_0.bin\",\n    n_ctx=4096,\n    n_gpu_layers=30\n)\n\ntokenizer = LlamaTokenizer(llama=llm)\n\nTEXT=\"Âú®ÈÇ£‰∏™Â∑≤Ë¢´ÂøòÂç¥ÁöÑÊó•Â≠êÈáåÔºåÂÆÉÁöÑ‰∏ñÁïåÈ¢†Ë¶Ü‰∫Ü„ÄÇÊ≥•ÂúüÈ£ûËµ∞ÔºåÂá∫Áé∞‰∫Ü‰∏ÄÊù°ÂèàÊ∑±ÂèàÂÆΩÁöÑÂ≥°Ë∞∑ÔºåÁÑ∂ÂêéÊ≥•ÂúüÂèàËΩ∞ÈöÜÈöÜÂú∞È£ûÂõûÊù•ÔºåÂ≥°Ë∞∑Ê∂àÂ§±‰∫ÜÔºåÂú®ÂéüÊù•Â≥°Ë∞∑ÁöÑÂ∞ΩÂ§¥Âá∫Áé∞‰∫Ü‰∏ÄÂ∫ßÈªëËâ≤ÁöÑÂ≠§Â≥∞„ÄÇÂÖ∂ÂÆûÔºåÂú®ËøôÁâáÂπøÈòîÁöÑÁñÜÂüü‰∏äÔºåËøôÁßç‰∫ãÂ∏∏Â∏∏ÂèëÁîüÔºåÊ≥•ÂúüÈ£ûËµ∞ÂèàÈ£ûÂõûÔºåÂ≥°Ë∞∑Âá∫Áé∞ÂèàÊ∂àÂ§±ÔºåÁÑ∂ÂêéÊòØÂ≠§Â≥∞Èôç‰∏¥ÔºåÂ•ΩÂÉèÊòØÁªôÊØèÊ¨°ÁÅæÂèòÊâì‰∏ä‰∏Ä‰∏™ÈÜíÁõÆÁöÑÊ†áËÆ∞„ÄÇË§êËöÅÂíåÂá†Áôæ‰∏™ÂêåÊóèÂ∏¶ÁùÄÂπ∏Â≠òÁöÑËöÅÂêéÂêëÂ§™Èò≥ËêΩ‰∏ãÁöÑÊñπÂêëËµ∞‰∫Ü‰∏ÄÊÆµË∑ØÔºåÂª∫Á´ã‰∫ÜÊñ∞ÁöÑÂ∏ùÂõΩ„ÄÇ\"\ntokens = tokenizer.encode(TEXT)\n```\n\n```\nprint(str(tokens[:4]) + \" ...\")\n```\n\n\u003E [1, 30505, 32380, 36812] ...\n\n```\nfor token in tokens:\n    text = tokenizer.decode([token])\n    print(text, end=\" \")\n```\n\n\u003E  Âú® ÈÇ£‰∏™ Â∑≤Ë¢´ Âøò Âç¥ ÁöÑÊó•Â≠ê Èáå Ôºå ÂÆÉÁöÑ ‰∏ñÁïå È¢†Ë¶Ü ‰∫Ü „ÄÇ Ê≥• Âúü È£û Ëµ∞ Ôºå Âá∫Áé∞‰∫Ü ‰∏ÄÊù° Âèà Ê∑± Âèà ÂÆΩ ÁöÑ Â≥°Ë∞∑ Ôºå ÁÑ∂Âêé Ê≥• Âúü Âèà ËΩ∞ ÈöÜ ÈöÜ Âú∞ È£û ÂõûÊù• Ôºå Â≥°Ë∞∑ Ê∂àÂ§± ‰∫Ü Ôºå Âú® ÂéüÊù• Â≥°Ë∞∑ ÁöÑ Â∞ΩÂ§¥ Âá∫Áé∞‰∫Ü ‰∏ÄÂ∫ß ÈªëËâ≤ ÁöÑ Â≠§ Â≥∞ „ÄÇ ÂÖ∂ÂÆû Ôºå Âú®Ëøô Áâá ÂπøÈòî ÁöÑ ÁñÜ Âüü ‰∏ä Ôºå ËøôÁßç‰∫ã Â∏∏Â∏∏ ÂèëÁîü Ôºå Ê≥• Âúü È£û Ëµ∞ Âèà È£û Âõû Ôºå Â≥°Ë∞∑ Âá∫Áé∞ Âèà Ê∂àÂ§± Ôºå ÁÑ∂Âêé ÊòØ Â≠§ Â≥∞ Èôç‰∏¥ Ôºå Â•ΩÂÉèÊòØ Áªô ÊØèÊ¨° ÁÅæ Âèò Êâì ‰∏ä ‰∏Ä‰∏™ ÈÜíÁõÆ ÁöÑ Ê†áËÆ∞ „ÄÇ Ë§ê ËöÅ Âíå Âá†Áôæ ‰∏™ Âêå Êóè Â∏¶ÁùÄ Âπ∏ Â≠ò ÁöÑ ËöÅ Âêé Âêë Â§™Èò≥ ËêΩ ‰∏ãÁöÑ ÊñπÂêë Ëµ∞‰∫Ü ‰∏ÄÊÆµ Ë∑Ø Ôºå Âª∫Á´ã‰∫Ü Êñ∞ÁöÑ Â∏ùÂõΩ „ÄÇ\n\n```python\nenglish_text = \"This is an example of tokenization using a large language model.\"\nenglish_tokens = tokenizer.encode(english_text)\nprint(str(english_tokens[:4]) + \" ...\")\n\nfor token in english_tokens:\n    text = tokenizer.decode([token])\n    print(f\"'{text}'\", end=\" \")\n```\n\n\u003E [1, 4013, 338, 385] ...\n\n\u003E '' 'This' ' is' ' an' ' example' ' of' ' token' 'ization' ' using' ' a' ' large' ' language' ' model' '.'\n\nHere are some key differences between English and Chinese that have implications for how the language is tokenized by large language models:\n\n- Chinese does not use spaces between words like English does\n- Chinese words are typically formed from 2 or more characters\n- Chinese verbs are not conjugated and do not have different tenses\n- Chinese words don't have singular and plural variants\n- Chinese grammar is very simple and is similar to English\n- Chinese characters do not have capitization like ASCII characters\n- The token represented by the number 1 encodes a starting token\n\n## Imagining scenes from Three-Body Problem with Stable Diffusion\n\nHere are some images I generated using Stable Diffusion with InvokeAI that depict scenes from the Three-Body Problem book. These scenes portray solutions to the Three-Body Problem that players in the Three-Body game devised. The first is a Confucian system of etiquette for predicting the movement of the three suns. The second is a human-powered computer that Qin Shi Huang used to try to predict the movement of the three suns.\n\n\u003E Prompt: Ceremonies and etiquette system related to the sun and multiple celestial++ bodies Confucius artistic style\n\n\u003Cclient-only\u003E\n\u003Ccarousel :count=\"8\" dir=\"confucius\" \u002F\u003E\n\u003C\u002Fclient-only\u003E\n\n\u003E array of chinese++ warriors++ on a electronics+ circuit+ board qing+ dynasty style art logic puzzle\n\n\u003Cclient-only\u003E\n\u003Ccarousel :count=\"5\" dir=\"computer\" \u002F\u003E\n\u003C\u002Fclient-only\u003E\n\nCongrats to the InvokeAI team on the 3.0 release. It has been awesome to use and the current docker compose setup is a huge improvement on the 2.x version.\n\n## n-body simulations, CUDA and Three.js\n\nThe nbody problem has no closed-form analytical solution, but it is possible to do a basic simulation of the three-body problem on consumer hardware and open source software, like NVIDIA and CUDA.\n\n### Three-Body CUDA simulation\n\nI wrote a simple program with the help of ChatGPT for running nbody problem simulations. The program uses CuPy, a Python library that exposes APIs for doing matrix multiplication to predict the position of three bodies using Euclidian Integration. Here's the script:\n\n```py\nimport numpy as np\nimport cupy as cp\nimport time\nimport json\n\n# Simulation parameters\nNUM_PARTICLES = 3\nDIMENSIONS = 3 # 3D space\nNUM_STEPS = 30\nDT = 0.1\n\n# Generate initial positions and velocities\nnp_positions = np.random.randn(NUM_PARTICLES, DIMENSIONS)\nnp_velocities = np.random.randn(NUM_PARTICLES, DIMENSIONS)\n\ncp_positions = cp.array(np_positions)\ncp_velocities = cp.array(np_velocities)\n\nnp_ticks = np.expand_dims(np_positions, axis=0)\ncp_ticks = cp.array(np_ticks)\n\n# nbody simulation loop\nstart_time = time.time()\nfor step in range(NUM_STEPS):\n\n    # this gets pairwise differences\n    diff = cp_positions[:, None, :] - cp_positions[None, :, :]\n    distances = cp.sqrt(cp.sum(diff**2, axis=2))\n\n    # avoid division by zero\n    epsilon = 1e-5\n    inv_distances = 1.0 \u002F cp.maximum(distances, epsilon)\n\n    # calculate forces\n    cp_forces = cp.sum((diff.T * inv_distances**3).T, axis=1)\n\n    # update velocities and positions\n    cp_velocities += DT * cp_forces\n    cp_positions += DT * cp_velocities\n    cp_ticks = cp.append(cp_ticks, cp.expand_dims(cp_positions, 0), 0)\n\nsim_time = time.time() - start_time\nprint(\"Simulation time:\", sim_time)\n\n\nclass NumpyArrayEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, np.ndarray):\n            return obj.tolist()\n        return json.JSONEncoder.default(self, obj)\n\n\nnp_ticks = cp_ticks.get()\n\n\n# this is data we can work with in python and write to a file\nwith open(\"ticks.json\", \"w\") as f:\n    f.write(json.dumps(np_ticks, cls=NumpyArrayEncoder))\n```\n\nTo better understand the matrix math here I walked through a simple example of what each step does:\n\n```py\n# particle coordinates (x,y,z) in 3D space\npositions = cp.array([[1,2.5,3], [4,5,6], [7,8,9]])\n```\n\nThe first operation creates an array for pairwise distances for each dimension:\n\n```python\ndiff = positions[None, :, :] - positions[:, None, :]\nprint(diff)\n\narray([[[ 0. ,  0. ,  0. ],\n        [ 3. ,  2.5,  3. ],\n        [ 6. ,  5.5,  6. ]],\n\n       [[-3. , -2.5, -3. ],\n        [ 0. ,  0. ,  0. ],\n        [ 3. ,  3. ,  3. ]],\n\n       [[-6. , -5.5, -6. ],\n        [-3. , -3. , -3. ],\n        [ 0. ,  0. ,  0. ]]])\n```\n\nThe rows of zeros correspond to a particle's `x`, `y` and `z` distances to itself, which are all zero by axioms of Euclidian vector spaces.\n\nThe next operation calculates the distance between each particle:\n\n```python\ndistances = cp.sqrt(cp.sum(diff**2, axis=2))\nprint(distances)\n\narray([[ 0.        ,  4.9244289 , 10.11187421],\n       [ 4.9244289 ,  0.        ,  5.19615242],\n       [10.11187421,  5.19615242,  0.        ]])\n```\n\nThe diagonal or zeros represents that fact that a particle `n` has a distance of zero to iself.\n\nThe next step calculates inverse distances and uses a small `epsilon` value to avoid division by 0:\n\n```python\nepsilon = 1e-5\ninv_distances = 1.0 \u002F cp.maximum(distances, epsilon)\nprint(inv_distances)\n\narray([[1.00000000e+05, 2.03069233e-01, 9.88936353e-02],\n       [2.03069233e-01, 1.00000000e+05, 1.92450090e-01],\n       [9.88936353e-02, 1.92450090e-01, 1.00000000e+05]])\n```\n\nThe next step is the most elegant part of the simulation and really flexes the GPU's parallel compute capabilities:\n\n```python\ncp_forces = cp.sum((diff.T * inv_distances**3).T, axis=1)\n```\n\nThe `.T` operation transposes a matrix, multiplies by the cube of inverse distances, then transposes the matrix again before summing along the first axis. Transposing a matrix basically swaps rows and columns.\n\nThe next two steps are also pretty elegant:\n\n```python\n# update velocities and positions\ncp_velocities += DT * cp_forces\ncp_positions += DT * cp_velocities\n```\n\nIn the last step I append the updated positions to an array that holds every \"tick\" (the positions of each particle between each time interval, `DT` - \"delta time\")\n\nHere's the formula for the mathematical equation used to calculate the force on any given body in an n-body system:\n\n\u003Ciframe src=\"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Fiframe\u002Fformula.html\" width=100% height=110\u003E\u003C\u002Fiframe\u003E\n\nTo test that the simulation was working correctly I used ChatGPT again to construct a 3D scene in Blender with a Python script:\n\n![Blender Animation](\u002Fimg\u002Fthree-body-problem\u002Fblender.png)\n\n### Three.js\n\nImagine that we are working for a Chinese startup called the Qin Dynasty. The founder, Qin Shi Huang, is a brutal tyrant with an obsessive fear of assassination. Let's put on our product hat for a minute and think about how we can impress him with a clean solution to the three-body problem. A recent attempt involved building a 30,000-person analog computer that was destroyed in tri-solar syzygy. Failing to accurately predict the movement of the suns could mean execution by live-burial, a fiery death or worse. Using CUDA and Blender is a good MVP but doesn't make for the best technical demo since it involves so many different steps: running the simulation in CUDA, exporting data to JSON, loading data into a visualuzation and then finally rendering a video of the simulation. With a popular Javascript library called Three.js we can run an interactive three-body problem simulation in real-time right in the browser. Here's the three-body simulation I also co-authored with ChatGPT-4 using Three.js:\n\n\u003Ciframe src=\"https:\u002F\u002Fbriancaffey.github.io\u002Fthree-body-problem\u002Fthree\u002F\" width=100% height=350\u003E\u003C\u002Fiframe\u003E\n\n## Screen adaptations, the gaming industry and the CCP\n\nDream of the Red Chamber is one of China's Four Great Classical Novels and is often seen as the pinacle of Chinese fiction. It was written in the mid 18th century and first published in 1791. It is a long saga that totals 960,000 characters in length, on similar scale to the length of the Three-Body Problem trilogy. Sun Wen, a Qing dynasty artist, spent 36 years of his life doing a series of 230 paintings depicting scenes from the Dream of the Red Chamber: dream sequences, demons, goddesses, nuns, nobles, beggars, raging fires, landscapes, interiors, wildlife, gardens, temples, funerals, battles, processions, banquets, trials, operas, marriages.\n\n![Sun Wen paintings sample](\u002Fimg\u002Fthree-body-problem\u002Fdorc.png)\n\nFollowing in this tradition of celebrating great literature, Tencent Video and China Central Television produced a 30-episode adaptation of the Three-Body Problem that was released in Feburary 2023. It is a surprisingly faithful reproduction of the book that is worth checking out. The portrayal of Shi Qiang (Da Shi) was easily my favorite part of the series. I was also impressed by how the Three-Body VR game scenes were done with computer graphics. It got me thinking about how China is represented in some of the worlds most popular video games.\n\n![games](\u002Fstatic\u002Fthree-body\u002Fgame.png)\n\nThis is Rocket League, a competitive vehicular soccer game where players, like in the Three-Body game, must master the laws of gravity. The Chinese-themed Forbiden Temple arena shown here is one of many virtual international venues in the game. Epic Games (creator of Fortnite) bought Rocket League in 2019 for an estimated $250 to $300 million.\n\nLike Rocket League, Overwatch is a highly-competitive eSport on a global scale. It features a large roster of 38 players from all over the world. Dr. Mei-Ling Zhou (Âë®ÁæéÁÅµ) is a Chinese climatologist who uses ice both to attack opponents and to defend herself. Mei became controversial in China due to her adoption as a symbolic figure in the 2019 Hong Kong protests.\n\nThree college friends combined their interest in anime, comics and games (ACG) and literature to publish one of the most successful games created by a Chinese company and arguably one of China's most important cultural exports: Genshin Impact. miHoYo, the Shanghai-based company that develops Genshin Impact, grossed $4 billion of revenue globally in the game's first year setting a new record in the gaming industry. Like other companies of its size, miHoYo has a party committee under the Chinese Communist Party that influences the company's operations.\n\n## AI and layoffs in the tech industry\n\nI have a positive attitude toward AI and its ability to supercharge the creative work we do, but I also think that replacing humans and AI-related layoffs should should be a part of the conversation. I wasn't impacted by the recent round of layoffs at my company, and I'm grateful to have the opportunity to work with a talented team on interesting problems in the health tech industry. I do have some solid references for folks in DevOps, product and backend and frontend engineering, and I‚Äôm happy to [connect and share via LinkedIn](https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fbrian-caffey-06b22a18\u002F).\n\nLayoffs in both China and the U.S. have been pummled the tech sector over the last two years. New graduates in China are also facing a difficult job market. There are some popular expressions that paint a picture of the job market in China:\n\n- Ë∫∫Âπ≥ Lying flat: avoiding relentless work\n- ‰πù‰πùÂÖ≠ 996 Work culture: describes working from 9AM to 9PM, 6 days a week, a common work schedule for many Chinese employees\n- ÂÖ®ËÅåÂÑøÂ•≥ Full-time Children: [Young Chinese are getting paid to be ‚Äòfull-time children‚Äô as jobs become harder to find](https:\u002F\u002Fwww.cnn.com\u002F2023\u002F07\u002F26\u002Feconomy\u002Fchina-youth-unemployment-intl-hnk\u002Findex.html)\n- 35Â≤ÅËØÖÂíí The curse of 35: [Ageism in China‚Äôs tech sector has workers fearing the ‚Äúcurse of 35‚Äù](https:\u002F\u002Fwww.marketplace.org\u002Fshows\u002Fmarketplace-tech\u002Fchinas-tech-workers-ageism-the-curse-of-35\u002F). Shout out to my fellow Year of the Dragon 35 year olds! üê≤\n-  ÂêÉËã¶ Eat Bitterness: [China‚Äôs Young People Can‚Äôt Find Jobs. Xi Jinping Says to ‚ÄòEat Bitterness.‚Äô](https:\u002F\u002Fwww.nytimes.com\u002F2023\u002F05\u002F30\u002Fbusiness\u002Fchina-youth-unemployment.html)\n\nIt is an exciting time for AI. Elon Musk and Kaifu Lee have both recently released open-source large language models: Grok and Yi. Sam Altman was fired as CEO of OpenAI, then came back. Stable Diffusion just released a text to video model. AGI might already be here. In the U.S., we are going into our first presidential election cycle with AI fully turned on. Here's a [link to The Three-Body Problem book on Amazon](https:\u002F\u002Fwww.amazon.com\u002FThree-Body-Problem-Cixin-Liu\u002Fdp\u002F0765382032). Thanks for reading and Happy Thanksgiving!\n\n![Happy Thanksgiving](\u002Fimg\u002Fthree-body-problem\u002Fthanksgiving.png)\n"}}],fetch:{},mutations:[]}}("text","element","span","token","punctuation","\n"," ",",","number","operator","p",".","(",")","=","[","]","li","keyword","a","code","  ","0",":","3","true",-1,"icon","icon-link","div","nofollow","noopener","noreferrer","_blank","nuxt-content-highlight","pre","line-numbers"," cp","-","comment","string","img",2,"h2","builtin","\n        ","language-python","import","blockquote","print","*","ul","iframe","100%"," axis","diff","6",3,"h3"," np","array","\n\n    ","boolean","None","sum","**","2","+="," DT ","\n       ","language-text"," tokenizer","\n\n","as","distances","1"," obj","2.5","\n\narray","        ","1.00000000e+05","llama","llm","x",true,"back-story","Back story","chinese-in-numbers","Chinese in numbers","character-frequency","Character Frequency","meta-llms-and-grass-mud-horse","Meta, LLMs, and Grass Mud Horse","translation-in-and-of-the-three-body-problem","Translation in and of The Three-Body Problem","tokenization","Tokenization","imagining-scenes-from-three-body-problem-with-stable-diffusion","Imagining scenes from Three-Body Problem with Stable Diffusion","n-body-simulations-cuda-and-threejs","n-body simulations, CUDA and Three.js","three-body-cuda-simulation","Three-Body CUDA simulation","threejs","Three.js","screen-adaptations-the-gaming-industry-and-the-ccp","Screen adaptations, the gaming industry and the CCP","ai-and-layoffs-in-the-tech-industry","AI and layoffs in the tech industry","p-4",550," Llama","30","encode","4","for","in","\n    ","client-only","carousel","8","5","language-py","random","randn","NUM_PARTICLES"," DIMENSIONS","np_positions","\ncp_velocities ","expand_dims","np_ticks"," time","time"," cp_positions","sqrt","cp","1e-5","1.0","\u002F","maximum"," epsilon","T "," inv_distances","T","# update velocities and positions","\n\n\n","NumpyArrayEncoder","json","JSONEncoder","default","self","return"," positions","5.5","\n\n       ","4.9244289","10.11187421","5.19615242","2.03069233e-01","9.88936353e-02","1.92450090e-01","2024-02-17T22:35:34.319Z")));