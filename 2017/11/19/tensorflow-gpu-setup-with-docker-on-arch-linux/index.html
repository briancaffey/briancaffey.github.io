<!DOCTYPE html><html  lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Installing the GPU version of Tensorflow with Docker on Arch Linux</title><style>html{font-family:Montserrat,Arial,Sans Serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{border:1px solid #3b8070;border-radius:4px;color:#3b8070;display:inline-block;padding:10px 30px;text-decoration:none}.button--green:hover{background-color:#3b8070;color:#fff}.button--grey{border:1px solid #35495e;border-radius:4px;color:#35495e;display:inline-block;margin-left:15px;padding:10px 30px;text-decoration:none}.button--grey:hover{background-color:#35495e;color:#fff}</style><style>span.emoji-mart-emoji[data-v-05905815]{padding:0}.selected[data-v-05905815]{text-shadow:.25px 0 0 #000}.picker[data-v-05905815]{margin-left:auto;margin-right:auto;position:absolute;top:10px;transform:translate(50%,50%)}.top[data-v-05905815]{background-color:var(--color-primary);height:3px;width:100%}</style><style>.selected[data-v-1edc4b99]{text-shadow:.9px 0 0}</style><style>span.emoji-mart-emoji[data-v-de9cb334]{padding:0;transition:transform .2s}span.emoji-mart-emoji[data-v-de9cb334]:hover{transform:scale(1.3)}.centered[data-v-de9cb334]{left:50vw;margin-left:auto;margin-right:auto;position:absolute;right:50vw}</style><style>span.emoji-mart-emoji[data-v-f26190e6]{padding:0;transition:transform .2s}span.emoji-mart-emoji[data-v-f26190e6]:hover{transform:scale(1.3)}.picker[data-v-f26190e6]{left:0;margin-left:auto;margin-right:auto;position:absolute;right:0;z-index:10000000000}.localepicker[data-v-f26190e6]{background-color:var(--bg)}.localeText[data-v-f26190e6]{color:var(--color-primary)}</style><style>.tag[data-v-09161b57]{background-color:var(--color-tag);transition:transform .2s}.tag[data-v-09161b57]:hover{transform:scale(1.05)}</style><style>pre code .line{display:block}</style><link rel="stylesheet" href="/_nuxt/entry.C_qR6n1r.css" crossorigin><link rel="stylesheet" href="/_nuxt/app.MFRQdpI0.css" crossorigin><link rel="preload" as="fetch" crossorigin="anonymous" href="/2017/11/19/tensorflow-gpu-setup-with-docker-on-arch-linux/_payload.json?20ba086c-11db-4b8f-94df-37732bc03fbf"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DTOJyF60.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/gVxYxcS_.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/frsG0wpz.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/yzSkLFeN.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/COAx7XzY.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BJBLwbpI.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/XBFQQbJV.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DtHt2UUL.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Qp6U59fi.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DnrkkvNu.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/YodgojWX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cxjqv_Ul.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/JB-1fz56.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CMRTWK2q.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BVBxd0nE.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bm7EKwoT.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bt9I_Efx.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CzazSYNa.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/20ba086c-11db-4b8f-94df-37732bc03fbf.json"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BAz4hE9E.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/C6M3awII.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/l4GCCFy-.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Ct1sy6hk.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/OBo_gbKo.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/B2C1PNz9.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Bt1fpBmg.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/D3ihcdeA.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DFbNQjaE.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BJdiGWz8.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DmShVml6.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DZ6dNqb9.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Df7t3zvh.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/CQs7lR2Q.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/C5Po-Rxp.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/B75Uq4DY.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DJ54Mi4c.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Bdhy8oLr.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/eCyQPqzC.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BKXkvZfM.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BTcBYm-t.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BWTGlsIW.js"><meta name="description" content="Brian Caffey's personal website"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="robots" content="all"><meta property="twitter:creator" content="@briancaffey"><meta property="twitter:site" content="@briancaffey"><meta property="og:title" content="Installing the GPU version of Tensorflow with Docker on Arch Linux"><meta property="og:description" content="A walkthrough of Tensorflow setup and usage on Arch Linux with docker"><meta property="og:image" content="https://briancaffey.github.io/static/trump.png"><meta property="twitter:image" content="https://briancaffey.github.io/static/trump.png"><meta property="twitter:card" content="summary_large_image"><script type="module" src="/_nuxt/DTOJyF60.js" crossorigin></script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"system";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"-mode",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"-mode",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"light"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt"><div><div><div data-v-05905815><div class="mx-auto flex py-2 px-2 sm:px-4 items-center max-w-6xl justify-center" data-v-05905815><div class="justify-left flex-grow flex-cols-4" data-v-05905815><a href="/" class="text-xl" data-v-05905815><span class="hidden sm:inline text-2xl" data-v-05905815>Brian Caffey</span><span class="inline sm:hidden" data-v-05905815>JBC</span></a></div><div class="flex-grow relative" data-v-05905815><nav z-index="10000" data-v-05905815 data-v-1edc4b99><div data-v-1edc4b99><ul class="items-right float-right hidden md:flex" data-v-1edc4b99><li class="px-4 text-lg" data-v-1edc4b99><a href="/blog/1" class="" data-v-1edc4b99>Blog</a></li><li class="px-4 text-lg" data-v-1edc4b99><a href="/contact" class="" data-v-1edc4b99>Contact</a></li></ul><div class="flex justify-end md:hidden z-1000" data-v-1edc4b99><button class="flex items-center px-3 py-2 border rounded menu-icon" data-v-1edc4b99><svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-1edc4b99><title data-v-1edc4b99>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" data-v-1edc4b99></path></svg></button></div><!----></div></nav></div></div><div class="picker" data-v-05905815><div class="centered" data-v-05905815 data-v-de9cb334><div class="grid items-center justify-center" data-v-de9cb334><ul class="flex px-4" data-v-de9cb334><!--[--><li class="md:px-1 px-1 cursor-pointer" data-v-de9cb334><span aria-label="üñ•Ô∏è, desktop_computer" class="emoji-mart-emoji" data-v-de9cb334><span class="emoji-set-apple emoji-type-image" style="background-position:51.67% 95%;width:32px;height:32px;"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-de9cb334><span aria-label="üåû, sun_with_face" class="emoji-mart-emoji" data-v-de9cb334><span class="emoji-set-apple emoji-type-image" style="background-position:8.33% 48.33%;width:32px;height:32px;"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-de9cb334><span aria-label="üåö, new_moon_with_face" class="emoji-mart-emoji" data-v-de9cb334><span class="emoji-set-apple emoji-type-image" style="background-position:8.33% 41.67%;width:32px;height:32px;"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-de9cb334><span aria-label="‚òï, coffee" class="emoji-mart-emoji" data-v-de9cb334><span class="emoji-set-apple emoji-type-image" style="background-position:95% 30%;width:32px;height:32px;"></span></span></li><!--]--><li class="md:px-1 px-1 cursor-pointer" data-v-de9cb334><div data-v-de9cb334 data-v-f26190e6><ul data-v-f26190e6><li class="md:px-1 px-1 cursor-pointer" data-v-f26190e6><span aria-label="üá∫üá∏, us, flag-us" class="emoji-mart-emoji" data-v-f26190e6><span class="emoji-set-apple emoji-type-image" style="background-position:6.67% 45%;width:32px;height:32px;"></span></span></li></ul><div class="rounded-md z-10 picker" data-v-f26190e6><!----></div></div></li></ul></div></div></div></div><!--[--><article><img onerror="this.setAttribute(&#39;data-error&#39;, 1)" alt="A walkthrough of Tensorflow setup and usage on Arch Linux with docker" data-nuxt-img srcset="/_ipx/f_webp/static/trump.png 1x, /_ipx/f_webp/static/trump.png 2x" class="pt-2 w-full object-cover" style="height:32rem;" src="/_ipx/f_webp/static/trump.png"><div class="mx-auto max-w-5xl px-2 sm:px-4 md:px-4 lg:px-16 mt-2"><h1 class="prose text-4xl leading-9 py-4 font-bold">Installing the GPU version of Tensorflow with Docker on Arch Linux</h1><div class="flex flex-wrap -ml-1 py-2"><!--[--><a href="/blog/tags/arch-linux/" class="" data-v-09161b57><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-09161b57>arch-linux üè∑Ô∏è <!----></div></a><a href="/blog/tags/tensorflow/" class="" data-v-09161b57><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-09161b57>tensorflow üè∑Ô∏è <!----></div></a><a href="/blog/tags/docker/" class="" data-v-09161b57><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-09161b57>docker üè∑Ô∏è <!----></div></a><a href="/blog/tags/nvidia/" class="" data-v-09161b57><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-09161b57>nvidia üè∑Ô∏è <!----></div></a><a href="/blog/tags/python/" class="" data-v-09161b57><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mb-1 uppercase cursor-pointer tag" data-v-09161b57>python üè∑Ô∏è <!----></div></a><!--]--></div><!----><p class="blog-date text-gray-500 mb-4">Last updated November 19, 2017</p><!----><div class="markdown"><p><!--[-->I&#39;ve tried installing the GPU version of Tensorflow a few times before and failed. There seems to be lots of confusion about the build process, of which there are many. Also, over the last few years there have been many new versions of the software needed to support the GPU version of Tensorflow as well as the first official release of Tensorflow itself (which is now on version 1.4), such as CUDA and cudnn, and different version of python. This is one more attempt at installing the GPU version of Tensor Flow on my Desktop PC that is currently dual booting with Arch Linux and Windows 10. I&#39;ve decided to try going the docker route because it should eliminate some of the headache of missing depedencies. Here are the specs for my computer:<!--]--></p><ul><!--[--><li><!--[-->i7-6700K<!--]--></li><li><!--[-->NVIDIA GTX 1080<!--]--></li><li><!--[-->Asus Hero VIII motherboard<!--]--></li><li><!--[-->Arch Linux on a 128 GB SSD (Windows 10 is installed on a separate SSD)<!--]--></li><!--]--></ul><h2 id="installing-cuda-and-cudnn"><a href="#installing-cuda-and-cudnn"><!--[-->Installing CUDA and cudnn<!--]--></a></h2><p><!--[-->We don&#39;t need to install these when installing Tensorflow with Docker. Read to the bottom for more info.<!--]--></p><h2 id="installing-docker"><a href="#installing-docker"><!--[-->Installing Docker<!--]--></a></h2><p><!--[-->To install docker on our machine, let&#39;s start with the <a href="https://wiki.archlinux.org/index.php/Docker" rel="nofollow"><!--[-->Arch Wiki article on docker<!--]--></a>.<!--]--></p><p><!--[-->We need to add the Loopback module to the Linux Kernel, so we run:<!--]--></p><pre class="language-text"><!--[--><code># tee /etc/modules-load.d/loop.conf &lt;&lt;&lt; &quot;loop&quot;
# modprobe loop
$ reboot
</code><!--]--></pre><p><!--[-->Ater rebooting we can install docker:<!--]--></p><pre class="language-text"><!--[--><code>yaourt -S docker
</code><!--]--></pre><p><!--[-->Now we want to add ourself to the docker group with the following command:<!--]--></p><pre class="language-text"><!--[--><code>$ sudo gpasswd -a brian docker
[sudo] password for brian:
Adding user brian to group docker
</code><!--]--></pre><p><!--[-->If you run <code><!--[-->groups<!--]--></code>, you won&#39;t see docker listed in the groups you (brian) belong to. Run <code><!--[-->newgrp docker<!--]--></code> and then re-run docker and you should see <code><!--[-->docker<!--]--></code> listed with any other groups you belong to:<!--]--></p><pre class="language-text"><!--[--><code>[brian@a1arch ~]$ groups
wheel storage power users
[brian@a1arch ~]$ newgrp docker
                   -`                    brian@a1arch
                  .o+`                   ------------
                 `ooo/                   OS: Arch Linux x86_64
                `+oooo:                  Kernel: 4.12.8-2-ARCH
               `+oooooo:                 Uptime: 6 mins
               -+oooooo+:                Packages: 1127
             `/:-:++oooo+:               Shell: bash 4.4.12
            `/++++/+++++++:              Resolution: 1920x1080
           `/++++++++++++++:             WM: i3
          `/+++ooooooooooooo/`           Theme: Adwaita [GTK2]
         ./ooosssso++osssssso+`          Icons: Adwaita [GTK2]
        .oossssso-````/ossssss+`         Terminal: urxvt
       -osssssso.      :ssssssso.        Terminal Font: Inconsolata-12
      :osssssss/        osssso+++.       CPU: Intel i7-6700K (8) @ 4.200GHz
     /ossssssss/        +ssssooo/-       GPU: NVIDIA GeForce GTX 1080
   `/ossssso+/:-        -:/+osssso+-     Memory: 3289MiB / 15975MiB
  `+sso+:-`                 `.-/+oso:
 `++:.                           `-/+/
 .`                                 `/

[brian@a1arch ~]$ groups
docker wheel storage power users
</code><!--]--></pre><p><!--[-->Doing this prevents us from having to write sudo each time we run docker.<!--]--></p><p><!--[-->Next we need to start the docker daemon.<!--]--></p><pre class="language-text"><!--[--><code>$ systemctl start docker
==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ====
Authentication is required to start &#39;docker.service&#39;.
Authenticating as: brian
Password:
==== AUTHENTICATION COMPLETE ====
$
</code><!--]--></pre><h3 id="side-note"><a href="#side-note"><!--[-->Side note<!--]--></a></h3><p><!--[-->There seems to be an <a href="https://github.com/moby/moby/issues/23289" rel="nofollow"><!--[-->Arch Linux-specific bug<!--]--></a> which prevents us from enabling docker (and nvidia-docker which we will get next). There is a solution to downgrade to an older version of docker, or you can just start the docker service and the nvidia-docker service when you want to use them. I have found it faster to first start nvidia-docker and then start docker services.<!--]--></p><p><!--[-->So far so good. Next let&#39;s look at the Tensorflow documentation for installing Tensorflow with docker.<!--]--></p><p><!--[-->We need to install <code><!--[-->nvidia-docker<!--]--></code>:<!--]--></p><pre class="language-text"><!--[--><code>$ yaourt -S nvidia-docker
[...]
[sudo] password for brian:
loading packages...
resolving dependencies...
looking for conflicting packages...

Packages (1) nvidia-docker-1.0.1-1

Total Installed Size:  13.34 MiB

:: Proceed with installation? [Y/n]
(1/1) checking keys in keyring                                 [##################################] 100%
(1/1) checking package integrity                               [##################################] 100%
(1/1) loading package files                                    [##################################] 100%
(1/1) checking for file conflicts                              [##################################] 100%
(1/1) checking available disk space                            [##################################] 100%
:: Processing package changes...
(1/1) installing nvidia-docker                                 [##################################] 100%
=&gt; Prior to running &#39;CUDA&#39;-containers, ensure that the nvidia-docker-plugin
   is loaded. -&gt; https://github.com/NVIDIA/nvidia-docker#other-distributions

*) manually; sudo -b nohup nvidia-docker-plugin &gt; /tmp/nvidia-docker.log

*) automatically at startup; systemctl enable nvidia-docker.service
Optional dependencies for nvidia-docker
    cuda [installed]
    nvidia [installed]
    opencl-nvidia [installed]
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
</code><!--]--></pre><p><!--[-->Next it says: Launch a Docker container that contains one of the TensorFlow binary images. Those images are available <a href="https://hub.docker.com/r/tensorflow/tensorflow/tags/" rel="nofollow"><!--[-->here<!--]--></a>.<!--]--></p><p><!--[-->Next I pulled the container with the <code><!--[-->gpu-latest<!--]--></code> tag and it started to download the container:<!--]--></p><pre class="language-text"><!--[--><code>$ docker pull tensorflow/tensorflow:gpu-latest
[sudo] password for brian:
latest-gpu: Pulling from tensorflow/tensorflow
ae79f2514705: Pull complete
c59d01a7e4ca: Pull complete
41ba73a9054d: Pull complete
f1bbfd495cc1: Pull complete
0c346f7223e2: Pull complete
5dcd01667896: Pull complete
ca677f607487: Downloading  180.7MB/453MB
b4637619a887: Download complete
8c644ff287da: Downloading    224MB/465.6MB
119c5f576e79: Download complete
009f82e71a7c: Download complete
dbc0fb5872c7: Downloading  17.83MB/66.54MB
5ef01389c5b2: Waiting
04f824004b76: Waiting
5861b82f52e5: Waiting
a495a3b4e6e1: Waiting
3a0a25b1bbaf: Pulling fs layer
b76a0afeb1e1: Waiting
</code><!--]--></pre><p><!--[-->It finished after several minutes:<!--]--></p><pre class="language-text"><!--[--><code>ca677f607487: Pull complete
b4637619a887: Pull complete
8c644ff287da: Pull complete
119c5f576e79: Pull complete
009f82e71a7c: Pull complete
dbc0fb5872c7: Pull complete
5ef01389c5b2: Pull complete
04f824004b76: Pull complete
5861b82f52e5: Pull complete
a495a3b4e6e1: Pull complete
3a0a25b1bbaf: Pull complete
b76a0afeb1e1: Pull complete
Digest: sha256:90e27448121b321c5ec66069fb2c718301df2ddaf25ba916b6f53719141572b0
Status: Downloaded newer image for tensorflow/tensorflow:latest-gpu
$
</code><!--]--></pre><p><!--[-->Let&#39;s verify that it has the image:<!--]--></p><pre class="language-text"><!--[--><code>$ docker images
REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE
tensorflow/tensorflow   latest-gpu          2f243a16ff63        13 days ago         3.36GB
</code><!--]--></pre><p><!--[-->Next let&#39;s start the <code><!--[-->nvidia-docker<!--]--></code> service:<!--]--></p><pre class="language-text"><!--[--><code>$ systemctl start nvidia-docker
==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ====
Authentication is required to start &#39;nvidia-docker.service&#39;.
Authenticating as: brian
Password:
==== AUTHENTICATION COMPLETE ====
$
</code><!--]--></pre><p><!--[-->OK, we should be ready to launch the image:<!--]--></p><pre class="language-text"><!--[--><code>$ nvidia-docker run -it tensorflow/tensorflow:latest-gpu bash
root@761a62c1cff1:/notebooks#
</code><!--]--></pre><p><!--[-->This is looking good. Let&#39;s try to start python:<!--]--></p><pre class="language-text"><!--[--><code>root@761a62c1cff1:/notebooks# python
Python 2.7.12 (default, Nov 19 2016, 06:48:10)
[GCC 5.4.0 20160609] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import tensorflow as tf
&gt;&gt;&gt;
</code><!--]--></pre><p><!--[-->That works! Let&#39;s try out the classic MNIST hand-written digit classification problem that comes packaged as a notebook with the container image:<!--]--></p><pre class="language-text"><!--[--><code>$ nvidia-docker run -it -p 8888:8888 tensorflow/tensorflow:latest-gpu
[sudo] password for brian:
[I 21:54:26.671 NotebookApp] Writing notebook server cookie secret to /root/.local/share/jupyter/runtime/notebook_cookie_secret
[W 21:54:26.689 NotebookApp] WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.
[I 21:54:26.693 NotebookApp] Serving notebooks from local directory: /notebooks
[I 21:54:26.693 NotebookApp] 0 active kernels
[I 21:54:26.693 NotebookApp] The Jupyter Notebook is running at:
[I 21:54:26.693 NotebookApp] http://[all ip addresses on your system]:8888/?token=cda89aff96a3d4a9741cc755aac07f65f3aa372f60a198bd
[I 21:54:26.693 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[C 21:54:26.693 NotebookApp]

    Copy/paste this URL into your browser when you connect for the first time,
    to login with a token:
        http://localhost:8888/?token=cda89aff96a3d4a9741cc755aac07f65f3aa372f60a198bd
[I 21:54:34.489 NotebookApp] 302 GET /?token=cda89aff96a3d4a9741cc755aac07f65f3aa372f60a198bd (172.17.0.1) 0.32ms
[I 21:54:59.019 NotebookApp] Writing notebook-signing key to /root/.local/share/jupyter/notebook_secret
[W 21:54:59.023 NotebookApp] Notebook 3_mnist_from_scratch.ipynb is not trusted
[W 21:54:59.049 NotebookApp] 404 GET /nbextensions/widgets/notebook/js/extension.js?v=20171119215426 (172.17.0.1) 4.38ms referer=http://localhost:8888/notebooks/3_mnist_from_scratch.ipynb
[I 21:54:59.813 NotebookApp] Kernel started: 00027a3e-59ae-47ce-90a5-752a9d1fe075
[I 21:55:00.199 NotebookApp] Adapting to protocol v5.1 for kernel 00027a3e-59ae-47ce-90a5-752a9d1fe075
[I 21:56:59.815 NotebookApp] Saving file at /3_mnist_from_scratch.ipynb
[W 21:56:59.816 NotebookApp] Notebook 3_mnist_from_scratch.ipynb is not trusted
2017-11-19 21:57:03.988627: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA
2017-11-19 21:57:04.070873: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:892] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2017-11-19 21:57:04.071129: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1030] Found device 0 with properties:
name: GeForce GTX 1080 major: 6 minor: 1 memoryClockRate(GHz): 1.7335
pciBusID: 0000:01:00.0
totalMemory: 7.92GiB freeMemory: 7.44GiB
2017-11-19 21:57:04.071143: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1120] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: GeForce GTX 1080, pci bus id: 0000:01:00.0, compute capability: 6.1)
</code><!--]--></pre><p><!--[-->I was only able to get the entire notebook to run after making a few small configuration tweaks to the tensorflow Interactive Session to fix some memory issues:<!--]--></p><pre class="language-python shiki shiki-themes github-light github-dark monokai" style=""><!--[--><code><span class="line" line="1"><span class="sMOD_">gpu_options </span><span class="sC2Qs">=</span><span class="sMOD_"> tf.GPUOptions(</span><span class="sTHNf">per_process_gpu_memory_fraction</span><span class="sC2Qs">=</span><span class="s7F3e">0.75</span><span class="sMOD_">)
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span class="sMOD_">s </span><span class="sC2Qs">=</span><span class="sMOD_"> tf.InteractiveSession(</span><span class="sTHNf">config</span><span class="sC2Qs">=</span><span class="sMOD_">tf.ConfigProto(</span><span class="sTHNf">gpu_options</span><span class="sC2Qs">=</span><span class="sMOD_">gpu_options))
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span class="s8-w5"># Use our newly created session as the default for
</span></span><span class="line" line="6"><span class="s8-w5"># subsequent operations.
</span></span><span class="line" line="7"><span class="sMOD_">s.as_default()
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8-w5"># Initialize all the variables we defined above.
</span></span><span class="line" line="10"><span class="sMOD_">tf.global_variables_initializer().run()
</span></span></code><!--]--></pre><p><!--[-->Without setting <code><!--[-->gpu_options<!--]--></code>, Tensorflow allocates 95% of available GPU memory (according to <a href="https://stackoverflow.com/questions/34514324/error-using-tensorflow-with-gpu" rel="nofollow"><!--[-->this SO question<!--]--></a>).<!--]--></p><p><!--[-->Setting it to <code><!--[-->0.333<!--]--></code> was too low and didn&#39;t allow for training to complete, but setting it to <code><!--[-->0.75<!--]--></code> seemed to work just fine.<!--]--></p><p><!--[-->You can monitor GPU memory usage on NVIDIA cards with the following command:<!--]--></p><pre class="language-text"><!--[--><code>$ nvidia-smi
Sun Nov 19 17:03:03 2017
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 384.59                 Driver Version: 384.59                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  GeForce GTX 1080    Off  | 00000000:01:00.0  On |                  N/A |
| 27%   32C    P8    10W / 180W |   6707MiB /  8105MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID  Type  Process name                               Usage      |
|=============================================================================|
|    0       350    C   /usr/bin/python                               6365MiB |
|    0       554    G   /usr/lib/xorg-server/Xorg                       19MiB |
|    0       588    G   /usr/bin/gnome-shell                            28MiB |
|    0       853    G   /usr/lib/xorg-server/Xorg                      186MiB |
|    0       873    G   compton                                          2MiB |
|    0      1114    G   ...el-token=A50C2F183DB4F79482A2D8768ED1B285    64MiB |
|    0      2190    G   ...el-token=1AC796A35DBDCDBE07AEC2FC1E8026C4    35MiB |
+-----------------------------------------------------------------------------+
</code><!--]--></pre><p><!--[-->I think this was a success! I&#39;m fairly certain that we were leveraging the GPU to run the MNIST hand-written digit notebook. I didn&#39;t see messages that CUDNN loaded, but I can find versions of both CUDNN and CUDA in the docker image:<!--]--></p><pre class="language-text"><!--[--><code>root@80f65a971e9a:/# ls /usr/include/x86_64-linux-gnu/
a.out.h  bits  cudnn_v6.h      fpu_control.h  gnu        python2.7
asm      c++   expat_config.h  freetype2      ieee754.h  sys
</code><!--]--></pre><pre class="language-text"><!--[--><code>root@80f65a971e9a:/# nvcc --version
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2016 NVIDIA Corporation
Built on Tue_Jan_10_13:22:03_CST_2017
Cuda compilation tools, release 8.0, V8.0.61
</code><!--]--></pre><p><!--[-->In previous attempts I had to register for an NVIDIA developer account and install these packages, but they seem to be packaged with the container.<!--]--></p><p><!--[-->Finally, we can check the installed python packages:<!--]--></p><pre class="language-text"><!--[--><code>root@80f65a971e9a:~# pip freeze | grep tensorflow
tensorflow-gpu==1.4.0
tensorflow-tensorboard==0.4.0rc2
root@80f65a971e9a:~#
</code><!--]--></pre><p><!--[-->This looks good, but I&#39;m still not 100% sure that everything was done properly. I would like to learn more about Tensorflow and also play around with some examples using Tensorboard. Let me know if you have any questions or comments about this setup, I&#39;m still learning! Thanks for reading.<!--]--></p><p><!--[-->Just for fun, here&#39;s a DeepDream rendering of a famous Donald Trump picture using Google&#39;s pre-trained <a href="https://github.com/google/inception" rel="nofollow"><!--[-->Inception model<!--]--></a>:<!--]--></p><p><!--[--><img onerror="this.setAttribute(&#39;data-error&#39;, 1)" alt="png" data-nuxt-img srcset="/_ipx/_/static/trump.png 1x, /_ipx/_/static/trump.png 2x" src="/_ipx/_/static/trump.png"><!--]--></p><p><!--[-->For comparison, here is the original image:<!--]--></p><p><!--[--><img onerror="this.setAttribute(&#39;data-error&#39;, 1)" alt="png" data-nuxt-img srcset="/_ipx/_/static/trump_original.jpg 1x, /_ipx/_/static/trump_original.jpg 2x" src="/_ipx/_/static/trump_original.jpg"><!--]--></p><style>html pre.shiki code .sMOD_, html code.shiki .sMOD_{--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2}html pre.shiki code .sC2Qs, html code.shiki .sC2Qs{--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672}html pre.shiki code .sTHNf, html code.shiki .sTHNf{--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic}html pre.shiki code .s7F3e, html code.shiki .s7F3e{--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF}html pre.shiki code .s8-w5, html code.shiki .s8-w5{--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}</style></div><div class="text-center pb-4 pt-8"><button class="mc-btn rounded py-1 px-2"> Show Disqus Comments üí¨ </button></div><!----><h1></h1></div></article><!--]--><div class="mx-auto max-w-6xl p-4 lg:px-16 text-center"><hr class="mt-4"><div class="align-center py-4"><div class="pb-4">Join my mailing list to get updated whenever I publish a new article.</div><div class="flex align-center justify-center"><div id="mc_embed_signup" class="w-full md:w-1/2 flex-shrink justify-center"><form id="mc-embedded-subscribe-form" action="https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6&amp;id=9937fe4fc5" method="post" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div id="mc_embed_signup_scroll" class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input id="mce-EMAIL" type="email" value="" name="EMAIL" placeholder="Enter your email address" class="rounded mc text-center" autocomplete="on"><div style="position:absolute;left:-5000px;" aria-hidden="true"><input type="text" name="b_43a795784ca963e25903a0da6_9937fe4fc5" tabindex="-1" value=""></div><div class="text-right" style="width:100%;"><input id="mc-embedded-subscribe" type="submit" value="Subscribe" name="subscribe" class="mc-btn rounded px-2 py-1 w-full"></div></div></form></div></div></div><hr><div class="py-4">Thanks for checking out my site!</div><div class="pb-4"> ¬© 2025 Brian Caffey </div></div></div></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/2017/11/19/tensorflow-gpu-setup-with-docker-on-arch-linux/_payload.json?20ba086c-11db-4b8f-94df-37732bc03fbf">[{"state":1,"once":18,"_errors":19,"serverRendered":5,"path":21,"pinia":22,"prerenderedAt":23},["Reactive",2],{"$scolor-mode":3,"$si18n:cached-locale-configs":7,"$si18n:resolved-locale":8,"$ssite-config":9},{"preference":4,"value":4,"unknown":5,"forced":6},"system",true,false,{},"",{"_priority":10,"currentLocale":14,"defaultLocale":14,"env":15,"name":16,"url":17},{"name":11,"env":12,"url":11,"defaultLocale":13,"currentLocale":13},-3,-15,-2,"en-US","production","briancaffey.github.io","https://briancaffey.github.io",["Set"],["ShallowReactive",20],{"tensorflow-gpu-setup-with-docker-on-arch-linux":-1},"/2017/11/19/tensorflow-gpu-setup-with-docker-on-arch-linux",{},1753140967580]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{url:"https://briancaffey.github.io",content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},gtag:{enabled:true,initMode:"auto",id:"G-S8TVBBMW66",initCommands:[],config:{},tags:[],loadingStrategy:"defer",url:"https://www.googletagmanager.com/gtag/js"},i18n:{baseUrl:"",defaultLocale:"en",rootRedirect:"",redirectStatusCode:302,skipSettingLocaleOnNavigate:false,locales:[{code:"en",emoji:"flag-us",iso:"en-US",name:"English",flag:"üá∫üá∏",language:"en-US",_hreflang:"en-US",_sitemap:"en-US"},{code:"fr",emoji:"flag-fr",iso:"fr-FR",name:"Fran√ßais",flag:"üá´üá∑",language:"fr-FR",_hreflang:"fr-FR",_sitemap:"fr-FR"},{code:"zh",emoji:"flag-cn",iso:"zh-ZH",name:"ÁÆÄ‰Ωì‰∏≠Êñá",flag:"üá®üá≥",language:"zh-ZH",_hreflang:"zh-ZH",_sitemap:"zh-ZH"},{code:"ru",emoji:"flag-ru",iso:"ru-RU",name:"–†—É—Å—Å–∫–∏–π",flag:"üá∑üá∫",language:"ru-RU",_hreflang:"ru-RU",_sitemap:"ru-RU"},{code:"ja",emoji:"flag-jp",iso:"ja-JP",name:"Êó•Êú¨Ë™û",flag:"üáØüáµ",language:"ja-JP",_hreflang:"ja-JP",_sitemap:"ja-JP"},{code:"in",emoji:"flag-in",iso:"hi-IN",name:"‡§π‡§ø‡§Ç‡§¶‡•Ä",flag:"üáÆüá≥",language:"hi-IN",_hreflang:"hi-IN",_sitemap:"hi-IN"}],detectBrowserLanguage:{alwaysRedirect:false,cookieCrossOrigin:false,cookieDomain:"",cookieKey:"i18n_redirected",cookieSecure:false,fallbackLocale:"",redirectOn:"root",useCookie:true},experimental:{localeDetector:"",typedPages:true,typedOptionsAndMessages:false,alternateLinkCanonicalQueries:true,devCache:false,cacheLifetime:"",stripMessagesPayload:false,preload:false,strictSeo:false,nitroContextDetection:true},domainLocales:{en:{domain:""},fr:{domain:""},zh:{domain:""},ru:{domain:""},ja:{domain:""},in:{domain:""}}}},app:{baseURL:"/",buildId:"20ba086c-11db-4b8f-94df-37732bc03fbf",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>