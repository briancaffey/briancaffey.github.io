<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Using Stripe for recurring monthly SaaS subscriptions in a Django + Vue application</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Brian Caffey's personal website"><meta data-n-head="ssr" name="robots" content="all"><meta data-n-head="ssr" property="og:title" content="Using Stripe for recurring monthly SaaS subscriptions in a Django + Vue application"><meta data-n-head="ssr" property="og:description" content="This article shares my experience learning and implementing the Stripe API for recurring monthly SaaS subscription payments in an application using Django and Vue.js"><meta data-n-head="ssr" property="og:image" content="https://briancaffey.github.io/static/django_vue_stripe.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/0d5e9fc.js" as="script"><link rel="preload" href="/_nuxt/35383e5.js" as="script"><link rel="preload" href="/_nuxt/e161084.js" as="script"><link rel="preload" href="/_nuxt/223edee.js" as="script"><link rel="preload" href="/_nuxt/64fe595.js" as="script"><style data-vue-ssr-id="38dfa7e4:0 f52d43e0:0 517a8dd7:0 fa7ff0ca:0 56b15182:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-red-300{--bg-opacity:1;background-color:#feb2b2;background-color:rgba(254,178,178,var(--bg-opacity))}.border-white{--border-opacity:1;border-color:#fff;border-color:rgba(255,255,255,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t{border-top-left-radius:.25rem;border-top-right-radius:.25rem}.border{border-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.flex-1{flex:1 1 0%}.font-bold{font-weight:700}.h-3{height:.75rem}.h-4{height:1rem}.h-12{height:3rem}.h-32{height:8rem}.h-64{height:16rem}.text-sm{font-size:.875rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.m-2{margin:.5rem}.m-4{margin:1rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.-ml-1{margin-left:-.25rem}.-ml-3{margin-left:-.75rem}.-ml-20{margin-left:-5rem}.max-w-5xl{max-width:64rem}.max-w-6xl{max-width:72rem}.object-cover{-o-object-fit:cover;object-fit:cover}.p-3{padding:.75rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.py-32{padding-top:8rem;padding-bottom:8rem}.pt-4{padding-top:1rem}.pr-4{padding-right:1rem}.pb-4{padding-bottom:1rem}.pt-8{padding-top:2rem}.pb-8{padding-bottom:2rem}.pt-16{padding-top:4rem}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.resize{resize:both}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-black{--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.text-gray-500{--text-opacity:1;color:#a0aec0;color:rgba(160,174,192,var(--text-opacity))}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-red-400{--text-opacity:1;color:#fc8181;color:rgba(252,129,129,var(--text-opacity))}.text-red-600{--text-opacity:1;color:#e53e3e;color:rgba(229,62,62,var(--text-opacity))}.uppercase{text-transform:uppercase}.visible{visibility:visible}.w-3{width:.75rem}.w-4{width:1rem}.w-12{width:3rem}.w-32{width:8rem}.w-full{width:100%}.z-10{z-index:10}.gap-4{grid-gap:1rem;gap:1rem}.gap-6{grid-gap:1.5rem;gap:1.5rem}.gap-8{grid-gap:2rem;gap:2rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition-all{transition-property:all}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform}.duration-150{transition-duration:.15s}.delay-150{transition-delay:.15s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:640px){.sm\:inline{display:inline}.sm\:hidden{display:none}.sm\:p-16{padding:4rem}.sm\:px-4{padding-left:1rem;padding-right:1rem}.sm\:w-2\/3{width:66.666667%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:768px){.md\:flex{display:flex}.md\:hidden{display:none}.md\:px-4{padding-left:1rem;padding-right:1rem}.md\:w-1\/2{width:50%}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (min-width:1024px){.lg\:px-16{padding-left:4rem;padding-right:4rem}.lg\:px-32{padding-left:8rem;padding-right:8rem}.lg\:pl-64{padding-left:16rem}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:1280px){.xl\:pb-16{padding-bottom:4rem}}:root{--color:#243746;--color-primary:#158876;--color-secondary:#0e2233;--bg:#f3f5f4;--bg-secondary:#fff;--bg-code:#ddd;--border-color:#ddd}.dark-mode{--color:#ebf4f1;--color-primary:#41b38a;--color-secondary:#fdf9f3;--bg:#091a28;--bg-secondary:#071521;--bg-code:#ddd;--border-color:#0d2538}.sepia-mode{--color:#433422;--color-primary:#504231;--color-secondary:#504231;--bg:#f1e7d0;--bg-code:#ddd;--bg-secondary:#eae0c9;--border-color:#ded0bf}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;background-color:#f3f5f4;background-color:var(--bg);color:#243746;color:var(--color);transition:background-color .3s}a{color:#158876;color:var(--color-primary)}.py-05{padding-top:.125rem;padding-bottom:.125rem}.markdown{--text-opacity:1;color:#1a202c;color:rgba(26,32,44,var(--text-opacity));line-height:1.5;color:#0e2233;color:var(--color-secondary)}.markdown .token.operator{background:0 0}.markdown>*+*{margin-top:0;margin-bottom:1rem}.markdown li+li{margin-top:.25rem}.markdown li>p+p{margin-top:1.5rem;color:#158876;color:var(--color-primary)}.markdown img{margin:auto}.markdown a,.markdown strong{font-weight:600}.markdown strong a{font-weight:700}.markdown h1{font-size:2.25rem}.markdown h1,.markdown h2{border-color:#158876;border-color:var(--color-primary);line-height:1.25;border-bottom-width:1px;font-weight:600;margin-bottom:1rem;margin-top:1.5rem;padding-bottom:.5rem}.markdown h2{font-size:1.5rem}.markdown h3{line-height:1.375;font-size:1.125rem}.markdown h3,.markdown h4{border-color:#158876;border-color:var(--color-primary);font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown h4{line-height:1;font-size:1rem}.markdown h5{border-color:#158876;border-color:var(--color-primary)}.markdown h5,.markdown h6{line-height:1.25;font-size:.875rem;font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown blockquote,.markdown h6{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.markdown blockquote{font-size:1rem;border-left-width:4px;--border-opacity:1;border-color:#e2e8f0;border-color:rgba(226,232,240,var(--border-opacity));padding-left:1rem;padding-right:1rem;border-color:#158876;border-color:var(--color-primary)}.markdown code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.875rem;display:inline;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity));padding:.125rem .25rem;background-color:#ddd;background-color:var(--bg-code);color:#000}.markdown code,.markdown pre{--bg-opacity:1;border-radius:.25rem}.markdown pre{background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity));padding:1rem}.markdown pre code{display:block;background-color:transparent;padding:0;overflow:visible;border-radius:0;color:#000}.markdown p{margin-bottom:10px}code[class*=language-],pre[class*=language-]{background:#ddd!important;background:var(--bg-code)!important;text-shadow:none!important}.markdown ul{list-style-type:disc}.markdown ol,.markdown ul{font-size:1rem;padding-left:2rem}.markdown ol{list-style-type:decimal}.markdown kbd{font-size:.75rem;display:inline-block;border-radius:.25rem;border-width:1px;padding:.125rem .25rem;vertical-align:middle;font-weight:400;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.markdown table,td,th{font-size:1rem;border:1px solid #243746;border-color:var(--color)}.markdown table{overflow-x:scroll}.markdown td,.markdown th{border-width:1px;padding:.25rem .75rem}.markdown .highlight pre{--bg-opacity:1!important;background-color:#f7fafc!important;background-color:rgba(247,250,252,var(--bg-opacity))!important}.article-card{box-shadow:0 5px 10px 1px #0e2233;box-shadow:0 5px 10px 1px var(--color-secondary);height:100%}.article-card:hover{box-shadow:0 5px 15px 5px #0e2233;box-shadow:0 5px 15px 5px var(--color-secondary)}.blog-card-description,.blog-date{color:#0e2233;color:var(--color-secondary)}.blog-date{font-style:italic}hr{background-color:#243746;background-color:var(--color);border:none;height:1px}.menu-icon{background-color:#ddd;background-color:var(--border-color)}.menu-icon,.mobile-menu{color:#243746;color:var(--color)}.mobile-menu{background-color:#fff;background-color:var(--bg-secondary)}.btn{border-radius:1;border-color:#158876;border-color:var(--color-primary)}.btn:hover{background-color:#fff;background-color:var(--bg-secondary)}.hero{border-color:#158876;border-color:var(--color-primary)}.markdown{word-wrap:break-word}.markdown h2:before,.markdown h3:before{display:block;content:" ";margin-top:-85px;height:85px;visibility:hidden;pointer-events:none}.markdown h2>a,.markdown h3>a{margin-left:1.25rem}.markdown h2>a:before,.markdown h3>a:before{content:"#";font-weight:400;font-size:1.25rem;line-height:2rem;margin-left:-1.25rem;padding-right:.5rem;position:absolute;opacity:1}@media (min-width:1024px){.markdown h2>a,.markdown h3>a{margin-left:0}.markdown h2>a:before,.markdown h3>a:before{opacity:0}}.markdown h2:hover>a:before,.markdown h3:hover>a:before{opacity:1}& pre[class*=language-]{--bg-opacity:1;background-color:#2d3748;background-color:rgba(45,55,72,var(--bg-opacity));position:static}.mc{background-color:#f3f5f4;background-color:var(--bg);border-color:#158876;border-color:var(--color-primary);border-width:1px;color:#158876;color:var(--color-primary);justify-content:center;padding:5px 10px;border-radius:5px;width:100%}.mc-btn{color:#fff;color:var(--bg-secondary);background-color:#0e2233;background-color:var(--color-secondary);cursor:pointer}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}</style><link rel="preload" href="/_nuxt/static/1612150218/fr/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application/state.js" as="script"><link rel="preload" href="/_nuxt/static/1612150218/fr/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1612150218/manifest.js" as="script">
  </head>
  <body>
    <script data-n-head="ssr" data-hid="nuxt-color-mode-script" data-pbody="true">!function (){"use strict";var e=window,s=document,t=s.documentElement,n=["dark","light"],o=function(e){for(var t=e+"=",n=s.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null}("nuxt-color-mode")||"system",a="system"===o?c():o;function i(e){var s=""+e+"-mode";t.classList?t.classList.add(s):t.className+=" "+s}function r(s){return e.matchMedia("(prefers-color-scheme"+s+")")}function c(){if(e.matchMedia&&"not all"!==r("").media)for(var s of n)if(r(":"+s).matches)return s;return"light"}i(a),e["__NUXT_COLOR_MODE__"]={preference:o,value:a,getColorScheme:c,addClass:i,removeClass:function(e){var s=""+e+"-mode";t.classList?t.classList.remove(s):t.className=t.className.replace(new RegExp(s,"g"),"")}}}();
</script><div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="mx-auto grid grid-cols-3 py-2 px-2 sm:px-4 items-center max-w-6xl" data-v-b364ef96><div class="justify-left" data-v-b364ef96><a href="/fr" class="text-xl nuxt-link-active" data-v-b364ef96><span class="hidden sm:inline" data-v-b364ef96>Brian Caffey</span><span class="inline sm:hidden" data-v-b364ef96>JBC</span></a></div> <div class="justify-center flex" data-v-b364ef96><div class="grid items-center justify-center" data-v-b364ef96><ul class="flex px-4"><li class="md:px-4 px-1 cursor-pointer">
      üñ•Ô∏è
    </li><li class="md:px-4 px-1 cursor-pointer">
      üåû
    </li><li class="md:px-4 px-1 cursor-pointer">
      üåö
    </li><li class="md:px-4 px-1 cursor-pointer">
      ‚òï
    </li></ul></div></div> <div class="flex justify-end relative" data-v-b364ef96><div class="grid items-center justify-center" data-v-b364ef96><ul><li class="md:px-4 px-1 cursor-pointer">
      üá´üá∑
    </li></ul> <div class="relative rounded-md -ml-3"><div class="absolute left-0 bg-white shadow-md rounded px-4 py-2 w-32 text mt-4 -ml-20" style="display:none"><a href="/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application">üá∫üá∏ English</a><a href="/fr/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application" aria-current="page" class="nuxt-link-exact-active nuxt-link-active">üá´üá∑ Fran√ßais</a><a href="/zh/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application">üá®üá≥ ÁÆÄ‰Ωì‰∏≠Êñá</a><a href="/ru/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application">üá∑üá∫ –†—É—Å—Å–∫–∏–π</a><a href="/jp/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application">üáØüáµ Êó•Êú¨Ë™û</a></div></div></div> ¬†
    <nav data-v-ec6a03a4 data-v-b364ef96><ul class="items-right justify-end hidden md:flex" data-v-ec6a03a4><li class="px-4" data-v-ec6a03a4><a href="/fr/blog" data-v-ec6a03a4>Blog</a></li> <li class="px-4" data-v-ec6a03a4><a href="/fr/projects" data-v-ec6a03a4>Projets</a></li> <li class="px-4" data-v-ec6a03a4><a href="/fr/contact" data-v-ec6a03a4>Contact</a></li></ul> <div class="flex justify-end md:hidden z-1000" data-v-ec6a03a4><button class="flex items-center px-3 py-2 border rounded menu-icon" data-v-ec6a03a4><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="fill-current h-3 w-3" data-v-ec6a03a4><title data-v-ec6a03a4>Menu</title> <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" data-v-ec6a03a4></path></svg></button></div> <!----></nav></div></div> <article><img src="/static/django_vue_stripe.png" class="h-64 w-full object-cover"> <div class="mx-auto max-w-5xl px-2 sm:px-4 md:px-4 lg:px-16 mt-2"><h1 class="prose text-3xl leading-9">Using Stripe for recurring monthly SaaS subscriptions in a Django + Vue application</h1> <div class="flex flex-wrap -ml-1 py-2" data-v-1f8089c5><a href="/fr/blog/tags/django" data-v-2b5535c8 data-v-1f8089c5><div class="px-2 text-sm shadow rounded-lg bg-white mx-1 mt-1 uppercase cursor-pointer" data-v-2b5535c8>
    django üè∑Ô∏è
    <!----></div></a><a href="/fr/blog/tags/vue" data-v-2b5535c8 data-v-1f8089c5><div class="px-2 text-sm shadow rounded-lg bg-white mx-1 mt-1 uppercase cursor-pointer" data-v-2b5535c8>
    vue üè∑Ô∏è
    <!----></div></a><a href="/fr/blog/tags/drf" data-v-2b5535c8 data-v-1f8089c5><div class="px-2 text-sm shadow rounded-lg bg-white mx-1 mt-1 uppercase cursor-pointer" data-v-2b5535c8>
    drf üè∑Ô∏è
    <!----></div></a><a href="/fr/blog/tags/stripe" data-v-2b5535c8 data-v-1f8089c5><div class="px-2 text-sm shadow rounded-lg bg-white mx-1 mt-1 uppercase cursor-pointer" data-v-2b5535c8>
    stripe üè∑Ô∏è
    <!----></div></a></div> <!----> <p class="blog-date text-gray-500 mb-4">
      derni√®re mise √† jour le
      1 janvier 2021
    </p> <!----> <div class="markdown nuxt-content"><h1 id="using-stripe-for-recurring-monthly-payments-to-a-paid-saas-subscription-in-a-django--vuejs-application"><a href="#using-stripe-for-recurring-monthly-payments-to-a-paid-saas-subscription-in-a-django--vuejs-application" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Using Stripe for recurring monthly payments to a paid SaaS subscription in a Django + Vue.js application</h1>
<p>This diagram shows the flow of data for the lifecycle of a paid customer subscription in a Django application with a Vue.js client. There are four stages:</p>
<p>I. Account setup, configuration, model and object creation
II. Logic and data flow for starting a customer's premium monthly subscription
III. Automatic subscription renewal
IV. Cancelling a premium subscription</p>
<h2 id="context"><a href="#context" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Context</h2>
<p>This is my first attempt at using Stripe, or any other online payment service API. Most of what I have diagramed here comes from this article from the Stripe documentation: <a href="https://stripe.com/docs/billing/subscriptions/fixed-price" rel="nofollow noopener noreferrer" target="_blank">https://stripe.com/docs/billing/subscriptions/fixed-price</a>. Knowing almost nothing about what is needed to create a SaaS subscription, I found this article very helpful. It was a lot to read at once, but each call to to the Stripe API is very clear and straightforward.</p>
<p>I made some modifications and additions to this walk-through for my use case, which is an API service called Open SEC Data, an open source project that I'm working on (<a href="https://gitlab.com/briancaffey/sec-filings-app" rel="nofollow noopener noreferrer" target="_blank">https://gitlab.com/briancaffey/sec-filings-app</a>).</p>
<h2 id="diagram"><a href="#diagram" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Diagram</h2>
<p>Here's a read-only link to the diagram: <a href="https://drive.google.com/file/d/1oH2b0W-c-dI5oXzc_jvCGvXx9sJagr4a/view?usp=sharing" rel="nofollow noopener noreferrer" target="_blank">https://drive.google.com/file/d/1oH2b0W-c-dI5oXzc_jvCGvXx9sJagr4a/view?usp=sharing</a>. This diagram is made with <a href="https://www.diagrams.net/" rel="nofollow noopener noreferrer" target="_blank">https://www.diagrams.net/</a>.</p>
<p><img alt="png" src="/static/django_vue_stripe_diagram.png"></p>
<h2 id="legend"><a href="#legend" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Legend</h2>
<p>Here's a detailed description of each part of the diagram, starting with the first section.</p>
<h3 id="i-account-setup-configuration-model-and-object-creation"><a href="#i-account-setup-configuration-model-and-object-creation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>I. Account setup, configuration, model and object creation</h3>
<ol>
<li>
<p>Setup a Stripe account. For local development, make sure you turn on <code>View test data</code>. On your local machine, install the stripe CLI and authenticate with your Stripe account</p>
</li>
<li>
<p>Create a Product in Stripe (mine is called <code>Open SEC Data Premium Subscription</code>)</p>
</li>
<li>
<p>Create a Price in Stripe that references the Product.</p>
<p>Instead of creating these objects in the Stripe Dashboard, you can also create them with the Stripe CLI or the Python SDK. I created a Django management command called <code>create_stripe_data</code> that will create a Product and related Price in Stripe. We will need the id of the Price, it looks like this: <code>price_1Hx0goL67dRDwyuDh9yEWsBo</code>.</p>
</li>
<li>
<p>Add the Price ID as an environment variable <code>SUBSCRIPTION_PRICE_ID</code> to the backend. This will be used later when we make API calls to Stripe from inside of Django views.</p>
</li>
<li>
<p>For production environments, you will need to a register a Stripe webhook. This is an endpoint in Django that Stripe will POST to in order to inform the Django application of events that have happened in Stripe.</p>
<p>For local development we need to run <code>stripe listen --forward-to localhost/api/stripe-webhooks/</code> in order to forward webhook events to the local Django application. This works really well for local development.</p>
</li>
<li>
<p>In both local and production environments we need to add an environment variables to the Django application that will be used to validate the webhook event.</p>
</li>
<li>
<p>You will need to create a <code>Subscription</code> model or similar in your Django models. This model should be related to your user model in some way. At a minimum it should have the <code>subscription_id</code> (the ID of the Stripe Subscription) and <code>current_period_end</code> (also from the Stripe Subscription object). We will use this model in the next sections.</p>
</li>
<li>
<p><code>/api/stripe-webhooks/</code> is the endpoint in the Django application that Stripe will send POST requests to in order to inform the Django application of events that happen in Stripe. The URL can be called anything you want, as long as you register it with that URL. In local development, you need to specify this URL in the <code>stipe listen</code> command (for example, <code>stripe listen forward-to localhost/api/stripe-webhooks/</code>).</p>
</li>
<li>
<p><code>STRIPE_SECRET_KEY</code> is the name of the secret API key that should only be accessible by the backend. In local development, this key looks like <code>sk_test_Abc123</code>. In production, this key will look like <code>sk_Abc123</code>.</p>
</li>
<li>
<p><code>stripe</code> is the name of the PyPI package that we need to add to <code>requirements.txt</code> (<code>requirements/base.txt</code>).</p>
</li>
<li>
<p><code>STRIPE_PUBLISHABLE_KEY</code> is the value of the Stripe API key that can be made public and is used in the Vue application to instantiate Stripe.</p>
</li>
<li>
<p>The Stripe library is included in <code>index.html</code> via CDN so that it is accessible anywhere in the Vue application. Stripe object is instantiated in the Vue application with:</p>
<blockquote>
<p><code>let stripe = Stripe(process.env.STRIPE_PUBLISHABLE_KEY)</code></p>
</blockquote>
</li>
</ol>
<h3 id="ii-logic-and-data-flow-for-starting-a-customers-premium-monthly-subscription"><a href="#ii-logic-and-data-flow-for-starting-a-customers-premium-monthly-subscription" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>II. Logic and data flow for starting a customer's premium monthly subscription</h3>
<p>With everything setup and configured properly in Stripe, the backend Django application and the frontend Vue application, customers can now start paying for monthly subscriptions. In my application, a user can sign up for an account first without having a premium subscription. In other scenarios, having an active account may require a premium subscription.</p>
<ol start="13">
<li>
<p>When a logged-in user visits their <code>/account</code> page, they will see the status of their account: Basic (free) or Premium (paid subscription). Users on a Basic plan will see the option to upgrade to Premium. They will be redirected to a <code>/premium</code> page where they will be presented with a credit card form. This credit card form is generated by <a href="https://stripe.com/payments/elements" rel="nofollow noopener noreferrer" target="_blank">Stripe Elements</a>. The user fills out their credit card, expiration date, card security code and billing ZIP code and then clicks <code>Purchase</code>.</p>
</li>
<li>
<p>Clicking on <code>Purchase</code> calls a method <code>purchase</code> that calls <code>stripe.CreatePaymentMethod</code>. The <code>paymentMethodId</code> token returned from <code>stripe.CreatePaymentMethod</code> is then passed to the method called <code>createSubscription</code>.</p>
</li>
<li>
<p>Stripe creates this object and returns a response that contains a <code>paymentMethodId</code> token.</p>
</li>
<li>
<p><code>createSubscription</code> sends a POST request to <code>/api/stripe/create-subscription/</code> in the Django application with the <code>paymentMethodId</code> that we generated in the previous step.</p>
</li>
<li>
<p><code>/api/stripe/create-subscription/</code> calls a view called <code>create_subscription</code> which makes a number of API calls to Stripe and then finally saves some data in the application's Postgres database.</p>
</li>
<li>
<p>The first API call creates the Customer object in Stripe if it does not exist. <code>email=request.user.email</code> is used in the API call to associate the Stripe customer with the user's email.</p>
</li>
<li>
<p>Next the payment method is attached to Stripe Customer model.</p>
</li>
<li>
<p>Next the Stripe payment method is set as the default payment method for Stripe customer for future billing.</p>
</li>
<li>
<p>The Stripe subscription model is created with the customer ID that was created in the earlier and the price ID corresponding to the premium subscription (added in the setup stage).</p>
</li>
<li>
<p>Once these Stripe API calls have finished, a new Subscription is saved in the Postgres database. <code>stripe_subscription_id</code>, <code>stripe_customer_id</code> and <code>valid_through</code> (DateTimeField that keeps track of the date through which the user's subscription has been paid for) are saved to the <code>Subscription</code> model and then the subscription model is saved to the user model's <code>subscription</code> field.</p>
</li>
<li>
<p>When the <code>createSubscription</code> method's POST requests returns successfully, the user's account is fetched again from <code>/api/account/</code></p>
</li>
<li>
<p>The browser makes a request to <code>/api/account/</code>.</p>
</li>
<li>
<p><code>/api/account/</code> returns information on the user and their subscription.</p>
</li>
<li>
<p>Data from <code>/api/account/</code> is updated in Vuex <code>user</code> store.</p>
</li>
<li>
<p>The user is now able to make requests to resources for premium features.</p>
</li>
<li>
<p>In this application, one such example is the ability to request an API key for making for making API calls.</p>
</li>
<li>
<p>A user makes a request to an API endpoint for a premium feature.</p>
</li>
<li>
<p>When determining permissions for resources that should only be accessible to customers with valid subscriptions, we need to compare <code>request.user.subscription.valid_through</code> to <code>timezone.now()</code> and make sure that <code>valid_through</code> is greater than <code>timezone.now()</code>.</p>
</li>
<li>
<p>Requests for protected resources are successfully returned to the browser.</p>
</li>
</ol>
<h3 id="iii-automatic-subscription-renewal"><a href="#iii-automatic-subscription-renewal" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>III. Automatic subscription renewal</h3>
<p>The customer's credit card is charged once each month that they are subscribed to the service. This action happens in Stripe. This section assumes that the customer's primary payment method is still valid (it has not been canceled expired or not able to be charged for some other reason).</p>
<ol start="32">
<li>
<p>The customer's card is charged in Stripe and an event is sent to the Django backend via a webhook that we registered in the setup stage.</p>
</li>
<li>
<p>The webhook view checks <code>event.type</code> and if the event is of type <code>invoice.paid</code> we extend the user's subscription by one month.</p>
</li>
<li>
<p>To extend the user's subscription, we modify the <code>DateTimeField</code> field on the <code>Subscription</code> that tracks the <code>current_period_end</code> which is included in the webhook data object. The model field in my code is called <code>valid_through</code>.</p>
</li>
</ol>
<h3 id="iv-cancelling-a-premium-subscription"><a href="#iv-cancelling-a-premium-subscription" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>IV. Cancelling a premium subscription</h3>
<ol start="35">
<li>
<p>When a user decides to cancel their payed subscription service, they click on the <code>Cancel My Subscription</code> button.</p>
</li>
<li>
<p>This makes a POST request to <code>/api/stripe/cancel-subscription</code> which calls the <code>cancel_subscription</code> view. This view calls <code>stripe.Subscription.delete(subscriptionId)</code>, where the <code>subscriptionId</code> is retrieved from <code>request.user.subscription</code> (the <code>Subscription</code> model created in the setup section).</p>
</li>
<li>
<p>The subscription is deleted in Stripe through the <code>stripe.Subscription.delete</code> API call.</p>
</li>
<li>
<p>The user's subscription is deleted from the user model with <code>request.user.subscription.delete()</code>.</p>
</li>
<li>
<p>The frontend responds to the deleted subscription by fetching <code>/api/account/</code> again, refresh, or redirecting and the user no longer has access to their premium subscription.</p>
</li>
</ol></div> <div class="text-center pb-4 pt-8"><button class="mc-btn rounded py-1 px-2">
        Show Disqus Comments üí¨
      </button></div> <!----> <h1></h1></div></article> <div class="mx-auto max-w-6xl p-4 lg:px-16 text-center" data-v-9723a4c2><hr class="mt-4" data-v-9723a4c2> <div class="mx-auto py-4" data-v-9723a4c2><div class="pb-4" data-v-9723a4c2>
      Abonnez-vous √† mon newsletter
    </div> <div class="mx-auto" data-v-c067421e data-v-9723a4c2><div id="mc_embed_signup" class="mx-auto w-full md:w-1/2" data-v-c067421e><form id="mc-embedded-subscribe-form" action="https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6&id=9937fe4fc5" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="validate" data-v-c067421e><div id="mc_embed_signup_scroll" class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center" data-v-c067421e><input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Adresse e-mail" class="rounded mc text-center" data-v-c067421e> <div aria-hidden="true" style="position:absolute;left:-5000px" data-v-c067421e><input name="b_43a795784ca963e25903a0da6_9937fe4fc5" tabindex="-1" data-v-c067421e></div> <div data-v-c067421e><input id="mc-embedded-subscribe" type="submit" name="subscribe" value="S'inscrire" class="mc-btn rounded px-2 py-1 w-full" data-v-c067421e></div></div></form></div></div></div> <hr data-v-9723a4c2> <div class="py-4" data-v-9723a4c2>Merci d'avoir visiter mon site !</div> <div class="pb-4" data-v-9723a4c2>¬© 2020 Brian Caffey</div></div></div></div></div><script defer src="/_nuxt/static/1612150218/fr/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application/state.js"></script><script src="/_nuxt/0d5e9fc.js" defer></script><script src="/_nuxt/64fe595.js" defer></script><script src="/_nuxt/35383e5.js" defer></script><script src="/_nuxt/e161084.js" defer></script><script src="/_nuxt/223edee.js" defer></script>
  </body>
</html>
