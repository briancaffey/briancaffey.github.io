[{"_path":"/2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django","_dir":"07","_draft":false,"_partial":false,"_locale":"","title":"Authenticating requests with JWT tokens stored in HTTPOnly cookies in Django","description":"This article describes how you can use JWT tokens in Django applications with decoupled frontend JavaScript applications running the browser in secure way using HttpOnly cookies.","date":"2021-08-01","image":"/static/djjwt/dj_jwt.png","tags":["django","vue","jwt","authentication"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"tldr"},"children":[{"type":"text","value":"tl;dr"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to use JWTs to securely authenticate requests to Django REST Framework applications in a decoupled frontend JavaScript application, you can do the following: store the access token in memory and store the refresh token  in an HttpOnly cookie. The refresh token is used to request new access tokens on an regular interval."}]},{"type":"element","tag":"h2","props":{"id":"some-context"},"children":[{"type":"text","value":"Some context"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Django is a web framework based on the Model, Template, View (MTV) paradigm. Django is increasingly used as an API server that is coupled with a Javascript or native frontend application."}]},{"type":"element","tag":"h2","props":{"id":"jwt-auth-with-httponly-cookies"},"children":[{"type":"text","value":"JWT Auth with HttpOnly Cookies"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following this guide:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://hasura.io/blog/best-practices-of-using-jwt-with-graphql/#jwt_security","rel":["nofollow"]},"children":[{"type":"text","value":"https://hasura.io/blog/best-practices-of-using-jwt-with-graphql/#jwt_security"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can reimplement our JWT authentication setup to be more secure."}]},{"type":"element","tag":"h3","props":{"id":"drf-simple-jwt-modifications"},"children":[{"type":"text","value":"DRF Simple JWT modifications"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We need to change the default behavior of the views from DRF simple JWT as described in this issue:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/jazzband/djangorestframework-simplejwt/issues/71","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/jazzband/djangorestframework-simplejwt/issues/71"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"png","src":"/static/jwt-authentication.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This diagram shows how authentication data moves between the Django backend and the Vue.js frontend running in the browser."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"This article should now be complete complete"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"tldr","depth":2,"text":"tl;dr"},{"id":"some-context","depth":2,"text":"Some context"},{"id":"jwt-auth-with-httponly-cookies","depth":2,"text":"JWT Auth with HttpOnly Cookies","children":[{"id":"drf-simple-jwt-modifications","depth":3,"text":"DRF Simple JWT modifications"}]}]}},"_type":"markdown","_id":"content:2021:08:07:authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django.md","_source":"content","_file":"2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django.md","_stem":"2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django","_extension":"md"},{"_path":"/2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt","_dir":"01","_draft":false,"_partial":false,"_locale":"","title":"Session Authentication with Django, Django REST Framework and Nuxt","description":"This article shows how to use session authentication with Django + Nuxt.js applications","date":"2021-01-01T00:00:00.000Z","image":"/static/django_nuxt_auth_og.png","tags":["django","vue","nuxt","drf","authentication"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will be a continuation of the discussion about how data flows in Django + Nuxt applications, looking specifically at session authentication."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's a GitLab repo that where you can find the source code and other diagrams related to this project:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://gitlab.com/briancaffey/django-nuxt-starter","rel":["nofollow"]},"children":[{"type":"text","value":"https://gitlab.com/briancaffey/django-nuxt-starter"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This diagram focuses on the interactions between:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I. The browser"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"II. The Nuxt server (Node process)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"III. The Django backend API server (gunicorn process)"}]},{"type":"element","tag":"h2","props":{"id":"context"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For illustration purposes, I'm using a simple CRUD application that has two models: Users and (blog) Posts. Users can log in with email and password credentials and create, read, update and delete blog posts (CRUD). Currently I'm only doing the R (read) of CRUD: listing and viewing blog posts. Creating, updating and delete will be added later. For now, users must be logged in to see posts."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm still learning a lot about Nuxt and how it can be used with Django and Django REST Framework. This project is an effort at documenting my learning process, learning in public and learning from mistakes, so any feedback or guidance on what I have written here would be highly appreciated!"}]},{"type":"element","tag":"h2","props":{"id":"why-nuxt"},"children":[{"type":"text","value":"Why Nuxt?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using Nuxt (with Server Side Rendering, or SSR) is one of many ways to use Vue.js with Django. Vue is a progressive framework, which means that it can be gradually adopted into a project--you don't have to go all-in on the framework or rewrite the application from scratch to fit with how Vue works."}]},{"type":"element","tag":"h3","props":{"id":"different-ways-to-use-vue-with-django"},"children":[{"type":"text","value":"Different ways to use Vue with Django"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In terms of Django, here are some ways that you can use Vue:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vue as a jQuery replacement for adding basic interactivity in views served by Django templates"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Build a static Vue application and serve it as a set of static assets in a Django project alongside routes that are served by other normal Django templates views."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Build a Vue SPA which consumes a Django API (usually built with Django REST Framework or similar), and serve it over a content delivery network (CDN)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use Vue to build an Electron desktop app that uses Django as an API"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In these scenarios, Vue is served as either static assets (such as in the case of serving a SPA over a CDN), or Vue code is included in an HTML response from a server (where the view library, not your application, is served over a CDN), similar to how jQuery is used."}]},{"type":"element","tag":"h3","props":{"id":"different-ways-to-use-nuxt"},"children":[{"type":"text","value":"Different ways to use Nuxt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt is a Framework that can be used in a few different ways, I'll briefly discus three ways in which Nuxt can be used. Common to all three of these ways of using Nuxt is the directory structure. No matter how you use Nuxt, it provides a great way to organize Vue code."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Static mode: this mode allows you to write Vue code which is built into a static HTML, and then that HTML is deployed to a CDN or webserver like NGINX. The developer (or CI/CD process) runs a command to generate HTML files for each page in the application, and these pages are served as-is when accessed by a user. I recently migrated my personal blog from Jekyll to Nuxt with full-static mode. Check it out at ("},{"type":"element","tag":"a","props":{"href":"https://briancaffey.github.io","rel":["nofollow"]},"children":[{"type":"text","value":"briancaffey.github.io"}]},{"type":"text","value":")."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SPA mode: This is similar to what you might use if you started a Vue project with Vue CLI. The project is also generated as in Static Mode, but what is generated is primarily Javascript code that is executed on the browser."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SSR mode: Server Side Rendering is the mode that I'll be focusing on here. Unlike the other ways of using Vue that have already been discussed, this mode involves a Node.js server that will handle our requests. For example, a web request for "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" is sent to our Nuxt Server (a Node.js server process) and Node.js is responsible for returning HTML that contains all of the blog Posts that we want to show (or a paginated selection of all blog posts, which is how my example blog app is built). So the Nuxt app has to make a request to our Django API server before returning fully rendered HTML page for the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" page. The user then gets the page from Nuxt, reads all of the blog posts and then decides to check out the blog posts on the second page of posts. When the user clicks on page 2, we request the second page of data from our Django API directly, not from Nuxt. The user then sees a short loading animation followed by the second page of blog posts that are loaded in using AJAX (usually with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fetch"}]},{"type":"text","value":" or axios)."}]}]},{"type":"element","tag":"h3","props":{"id":"nuxt-benefits"},"children":[{"type":"text","value":"Nuxt Benefits"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main reason for using Nuxt is to render the first page loads on the server, returning a complete HTML response that can be beneficial for SEO, social sharing, and other scenarios where you need control over how a website's pages are delivered (specifically, the initial request made to the server)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This type of control is not possible for applications that serve Vue over CDN since they can only request backend API data once the JS client has been requested from a CDN."}]},{"type":"element","tag":"h3","props":{"id":"nuxt-downsides-and-tradeoffs"},"children":[{"type":"text","value":"Nuxt Downsides and Tradeoffs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using Nuxt for SSR introduces quite a bit of complexity in both the application deployment and our Vue code. The backend API won't have to change at all when moving to Nuxt from a static Vue SPA."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Django alone is capable of returning fully generated, SEO-optimized HTML for each request, but applications built with Vue and Django templates may be difficult to work on as the project grows larger and larger. The Django/DRF + Nuxt approach may be more appropriate for projects with dedicated backend and frontend teams."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One other potential downside is added latency because of the \"double request\". If the Nuxt server and the Django server are on the same machine, then this latency will probably be a non-issue."}]},{"type":"element","tag":"h2","props":{"id":"diagram"},"children":[{"type":"text","value":"Diagram"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Nuxt Django Auth","src":"/static/django_nuxt_auth.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This diagram looks at session authentication with a focus on the browser, the Nuxt server and the Django server. It looks at two simple user stories, ordered from top to bottom in the diagram."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I. An existing application user visits the site in a new browser, navigates to the Login page, logs in with credentials and then visits a protected page: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":".\nII. The user closes the browser and then comes back directly to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" page."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These two user stories sound simple, but they touch on a lot of the features of Nuxt that make it powerful, and complicated at first (for Vue users). These include:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"asyncData"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtServerInit"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vuex on the client and server"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Custom plugin for axios"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some important parts of Nuxt that this diagram does not (yet) touch on are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Nuxt auth module (I don't know if this is relevant for my use case)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Nuxt fetch property (different from the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fetch"}]},{"type":"text","value":" web API)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Nuxt middleware (I'm also not sure if this would be helpful for anything I am doing in this example project)"}]}]},{"type":"element","tag":"h3","props":{"id":"user-story-i-a-user-tries-to-open-posts-is-redirected-to-login-logs-in-then-navigate-to-posts-and-sees-blog-posts"},"children":[{"type":"text","value":"User story I.: A user tries to open "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":", is redirected to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/login"}]},{"type":"text","value":", logs in, then navigate to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" and sees blog posts"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"User navigates to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"http://domain.com/"}]},{"type":"text","value":". This request is handled by the Nuxt server."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtServerInit"}]},{"type":"text","value":" action is called ("},{"type":"element","tag":"a","props":{"href":"https://nuxtjs.org/docs/2.x/directory-structure/store#the-nuxtserverinit-action","rel":["nofollow"]},"children":[{"type":"text","value":"read more on nuxtServerInit"}]},{"type":"text","value":"). This is a special Vuex action that, if defined in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"store/index.js"}]},{"type":"text","value":", will be called once per request to the Nuxt Server (when a page is initially visited or refreshed in the browser)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtServerInit"}]},{"type":"text","value":" dispatches a Vuex action in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" module called "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":". This action makes an GET request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":" in the Django application."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"An API call to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":" is made to the Django backend directly from the Nuxt container over the docker network ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"backend:8000"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the request is made by an anonymous user (no user is logged in), a 403 response is returned to the Nuxt server and no account data is set in the Vuex store (on the server)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Since the user is currently not logged in, the request returns a 403 response."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authMiddleware"}]},{"type":"text","value":" (on the Nuxt server) redirects the user to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/login"}]},{"type":"text","value":" based on the value of "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated"}]},{"type":"text","value":" in the Vuex store. The Original request for "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" returns a fully-rendered "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/login/"}]},{"type":"text","value":" page instead."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"User is now on the Login page"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"created"}]},{"type":"text","value":" hook for the Login page makes a GET request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login-set-cookie/"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"10, 11. This endpoint calls a simple view that is decorated with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@ensure_csrf_token"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ol","props":{"start":12},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When the response returns to the browser, the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"csrftoken"}]},{"type":"text","value":" is set in the browser."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The $apiCall function is defined in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"plugins/axios.js"}]},{"type":"text","value":", and it adds the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"csrftoken"}]},{"type":"text","value":" cookie to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"X-CSRFToken"}]},{"type":"text","value":" header of API requests. This is important for POST request where the CSRF token is required. When the user fills out their email and password in the login form, the $apiCall function is called with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" and the email/password as credentials."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The email and password are sent as data in the POST request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"15, 16. The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" URL calls the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login_view"}]},{"type":"text","value":" which makes use of two functions from "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"django.contrib.auth"}]},{"type":"text","value":": "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticate"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login"}]},{"type":"text","value":". "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticate"}]},{"type":"text","value":" gets a user from the provided email/password, and the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login"}]},{"type":"text","value":" function sets an HttpOnly "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" session cookie on the response."}]},{"type":"element","tag":"ol","props":{"start":17},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The HttpOnly "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" cookie is automatically set on the browser when the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" request returns successfully."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When this "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" request returns successfully, a value in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" Vuex module is set to keep track of the current user's logged in state."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Next, a GET request is made to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"20, 21. Since the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" cookie is set and sent along with the request automatically, this request will succeed."}]},{"type":"element","tag":"ol","props":{"start":22},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":" request returns, the user's account information is saved to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" Vuex module. At this point, the client may redirect automatically to the home page, or user account page, dashboard, etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Now logged in, the user navigates (again via Vue router) to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":", a page that shows a paginated view of all blog posts."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This page has an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"asyncData"}]},{"type":"text","value":" method which is called when the page component is created and it dispatches a Vuex action "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"posts/fetchData"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This Vuex action makes a GET request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/posts/"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"26, 27. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/posts/"}]},{"type":"text","value":" uses a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ModelViewSet"}]},{"type":"text","value":" and returns a paginated list of blog posts"}]},{"type":"element","tag":"ol","props":{"start":28},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/posts/"}]},{"type":"text","value":" request returns successfully, the blog post data is saved to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"blog"}]},{"type":"text","value":" Vuex module."}]}]},{"type":"element","tag":"h3","props":{"id":"user-story-ii-logged-in-user-opens-new-browser-window-and-revisits-posts"},"children":[{"type":"text","value":"User story II.: Logged in user opens new browser window and revisits "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]}]},{"type":"element","tag":"ol","props":{"start":29},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The user closes their browser and then opens a new browser window and navigates to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtServerInit"}]},{"type":"text","value":" is called as usual,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"user/fetchData"}]},{"type":"text","value":" action is called. This action makes a GET request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":" request returns successfully. The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" cookie is passed along from the browser to the API request that is made from the Nuxt server to the backend API ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/account/"}]},{"type":"text","value":").  User account data is then set on the Vuex "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" module."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"asyncData"}]},{"type":"text","value":" method for the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" pages is called."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"asyncData"}]},{"type":"text","value":" dispatches a Vuex action "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"posts/fetchData"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"posts/fetchData"}]},{"type":"text","value":" makes an API request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/posts/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/posts/"}]},{"type":"text","value":" request is handled by a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ModelViewSet"}]},{"type":"text","value":" for the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Post"}]},{"type":"text","value":" model that gets blog posts and then sets them to the Vuex store (on the server) when the request returns a response (to the Nuxt server)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Once the async data fetching is compete ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtServerInit"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"asyncData"}]},{"type":"text","value":" for the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/posts"}]},{"type":"text","value":" page), the page HTML is rendered using the Vuex store data stored on the server. The Vuex data is sent back with the rendered HTML (I think this is how it works)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Finally, the user sees the list of blog posts. The page is loaded \"at once\"; there is no waiting for data to load after loading the page initially."}]}]},{"type":"element","tag":"h2","props":{"id":"discussion"},"children":[{"type":"text","value":"Discussion"}]},{"type":"element","tag":"h3","props":{"id":"complexity"},"children":[{"type":"text","value":"Complexity"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Is this authentication process overly complicated? When I make these diagrams, I try to make simple concept as detailed as possible, but there are a lot of distinct actions being taken in many different parts of the application and getting them all into one diagram was tricky."}]},{"type":"element","tag":"h3","props":{"id":"httponly-session-cookies"},"children":[{"type":"text","value":"HttpOnly Session Cookies"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Session authentication is the officially recommended way to do authentication with Django REST Framework for clients that run in the browser. However, there seem to be lots of people using JWT with DRF and Javascript clients that run in the browser. The main argument against doing this is that the JWT must be stored in a Javascript-accessible store (localStorage or Cookies) so it can be passed with each request. Many people are also interested in trying to store JWT for authentication in HttpOnly cookies to harden client-side security. I'm very curious to know if anyone is actually doing this, and what the implementation looks like. While "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"djangorestframework_simplejwt"}]},{"type":"text","value":" doesn't support HttpOnly, there seems to be lots of interest in doing this. I think it might be possible with a special middleware, so let me know if anyone is interested in proof-of-concept/diagram for that."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some use cases for JWT and other token authentication methods with DRF might include native mobile apps or Desktop apps. For most cases, I think session authentication with Django's built in session cookies for DRF authentication is the best option. JWTs also have no clear solution for logging out, which may be important for some security considerations. The concept of stateless authentication is interesting, but for most use cases I would argue that it is not worth doing. Let me know if anyone has thoughts on this, I'm curious to see what everyone thinks."}]},{"type":"element","tag":"h3","props":{"id":"next-steps"},"children":[{"type":"text","value":"Next Steps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"My next steps for this project/repo are to deploy this to a production environment as soon as I have time to do so. My local setup has been working well, and I think it should work well for a simple DigitalOcean docker swarm deployment like I have done with other Django + Vue projects."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I also want to add the create, update and delete functionality for posts, improve error handling with API calls, add form validation, and maybe write some tests with Jest."}]},{"type":"element","tag":"h2","props":{"id":"questions"},"children":[{"type":"text","value":"Questions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here are some questions and areas that I still need to investigate."}]},{"type":"element","tag":"h3","props":{"id":"nuxt-composition-api"},"children":[{"type":"text","value":"Nuxt Composition API"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I have seen that there is a Composition API module for Nuxt. I have only just now started looking at Composition API examples and documentation for \"vanilla\" Vue, but I have heard that the Nuxt Composition API module has some additional features specifically for use with Nuxt, so I'm curious to learn what these are."}]},{"type":"element","tag":"h3","props":{"id":"nuxt-v3-and-vue-3"},"children":[{"type":"text","value":"Nuxt v3 and Vue 3"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt looks like it has plans to support Vue 3, so I am interested to learn more about Vue 3 as it is adopted by Vue frameworks such as Nuxt and Quasar."}]},{"type":"element","tag":"h3","props":{"id":"nuxts-fetch-method-server-middleware-nuxt-auth-module"},"children":[{"type":"text","value":"Nuxt's fetch method, server middleware, Nuxt auth module"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I think I am using server middleware correctly, it can be improved by redirecting to the initial requested route after successful login. I'm not sure if I should use the Nuxt auth module in this application, I have read that it doesn't support HttpOnly cookie use cases, but I could be wrong."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"context","depth":2,"text":"Context"},{"id":"why-nuxt","depth":2,"text":"Why Nuxt?","children":[{"id":"different-ways-to-use-vue-with-django","depth":3,"text":"Different ways to use Vue with Django"},{"id":"different-ways-to-use-nuxt","depth":3,"text":"Different ways to use Nuxt"},{"id":"nuxt-benefits","depth":3,"text":"Nuxt Benefits"},{"id":"nuxt-downsides-and-tradeoffs","depth":3,"text":"Nuxt Downsides and Tradeoffs"}]},{"id":"diagram","depth":2,"text":"Diagram","children":[{"id":"user-story-i-a-user-tries-to-open-posts-is-redirected-to-login-logs-in-then-navigate-to-posts-and-sees-blog-posts","depth":3,"text":"User story I.: A user tries to open /posts, is redirected to /login, logs in, then navigate to /posts and sees blog posts"},{"id":"user-story-ii-logged-in-user-opens-new-browser-window-and-revisits-posts","depth":3,"text":"User story II.: Logged in user opens new browser window and revisits /posts"}]},{"id":"discussion","depth":2,"text":"Discussion","children":[{"id":"complexity","depth":3,"text":"Complexity"},{"id":"httponly-session-cookies","depth":3,"text":"HttpOnly Session Cookies"},{"id":"next-steps","depth":3,"text":"Next Steps"}]},{"id":"questions","depth":2,"text":"Questions","children":[{"id":"nuxt-composition-api","depth":3,"text":"Nuxt Composition API"},{"id":"nuxt-v3-and-vue-3","depth":3,"text":"Nuxt v3 and Vue 3"},{"id":"nuxts-fetch-method-server-middleware-nuxt-auth-module","depth":3,"text":"Nuxt's fetch method, server middleware, Nuxt auth module"}]}]}},"_type":"markdown","_id":"content:2021:01:01:session-authentication-with-django-django-rest-framework-and-nuxt.md","_source":"content","_file":"2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt.md","_stem":"2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt","_extension":"md"},{"_path":"/2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies","_dir":"27","_draft":false,"_partial":false,"_locale":"","title":"How to authenticate Django REST Framework API calls from a (Vue) JS client using Session Authentication and HttpOnly cookies","description":"This article will describe an authentication strategy using Django REST Framework with a Javascript frontend application. I'll be demonstrating this with Vue.js (Qusar Framework, using Vue 2), but the concepts should transfer to any other Javascript framework.","layout":"post","date":"2020-11-27T00:00:00.000Z","comments":true,"image":"/static/padlocks.jpg","tags":["django","vue","authentication","api"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This article will describe an authentication strategy using Django REST Framework with a Javascript frontend application. I'll be demonstrating this with Vue.js (Qusar Framework, using Vue 2), but the concepts should transfer to any other Javascript framework."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's a GitLab repository for a project that I will be referencing throughout this article: "},{"type":"element","tag":"a","props":{"href":"https://gitlab.com/verbose-equals-true/django-postgres-vue-gitlab-ecs","rel":["nofollow"]},"children":[{"type":"text","value":"https://gitlab.com/verbose-equals-true/django-postgres-vue-gitlab-ecs"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When I first started learning about how to do authentication from a Vue client, I found "},{"type":"element","tag":"a","props":{"href":"https://blog.sqreen.com/authentication-best-practices-vue/","rel":["nofollow"]},"children":[{"type":"text","value":"this article from Sqreen"}]},{"type":"text","value":" which describes how to use JWT to authenticate a Vue application. The example uses a mocked backend, but it is a good proxy for what you would have if you were to use a library like "},{"type":"element","tag":"a","props":{"href":"https://github.com/SimpleJWT/django-rest-framework-simplejwt","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"django-rest-framework-simplejwt"}]}]},{"type":"text","value":", which I have previously used with success in Django projects."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JWT is an option for doing authentication with DRF "},{"type":"element","tag":"a","props":{"href":"https://www.django-rest-framework.org/api-guide/authentication/#json-web-token-authentication","rel":["nofollow"]},"children":[{"type":"text","value":"listed in the authentication documentation"}]},{"type":"text","value":", but the documentation doesn't recommend when or how to use JWT authentication."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Session authentication is mentioned as well:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This authentication scheme uses Django's default session backend for authentication. Session authentication is appropriate for AJAX clients that are running in the same session context as your website."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In my project, both in local development and in production environments, I serve the API and the Javascript clients on the same domain. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/*"}]},{"type":"text","value":" requests go to the API, and all other request paths route to the frontend client. In other scenarios such as using "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"https://mysite.com"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"https://api.mysite.com"}]},{"type":"text","value":" for hosting a frontend and API an different subdomains, there would need to be additional considerations for CORS, but since I have the frontend and the backend being served on the same domain (and same subdomain), this isn't a concern. You might need to watch out for this if your requirements are different."}]},{"type":"element","tag":"h2","props":{"id":"the-authentication-flow"},"children":[{"type":"text","value":"The authentication flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now let's describe the login process at a high level."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A user navigates to your site. There is currently nothing in the browser's "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"localStorage"}]},{"type":"text","value":" or cookies related to authentication."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The user navigates to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Login"}]},{"type":"text","value":" page at "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/login"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Loading this Vue component makes a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GET"}]},{"type":"text","value":" request to a special endpoint in our Django backend "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login-set-cookie/"}]},{"type":"text","value":". This request returns a simple JSON message: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"\"CSRF cookie set\""}]},{"type":"text","value":", and as the message says, the response sets a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"csrf"}]},{"type":"text","value":" cookie on our browser."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Once the CSRF cookie is set by the response from "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login-set-cookie/"}]},{"type":"text","value":", the user is presented with a login form and enters account credentials (email and password in my example, where email is the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"USERNAME_FIELD"}]},{"type":"text","value":" on my custom user model). Clicking \"Login\" dispatches a Vuex action that uses Axios to send a send a request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" with the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"csrf"}]},{"type":"text","value":" cookie set in a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"X-CSRFToken"}]},{"type":"text","value":" header."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" is handled by the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login_view"}]},{"type":"text","value":" view which uses two important functions from "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"django.contrib.auth"}]},{"type":"text","value":": "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticate"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login"}]},{"type":"text","value":". "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticate"}]},{"type":"text","value":" gets the user from the provided credentials, and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login"}]},{"type":"text","value":" sets a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" HttpOnly cookie on the response."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When the response from "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/login/"}]},{"type":"text","value":" comes back, two things happen: first the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" HttpOnly cookie is set on our browser. Second, we set a value in both Vuex and localStorage named "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated"}]},{"type":"text","value":" to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"success"}]},{"type":"text","value":". We are not storing any sensitive information in this value. Instead, we are using this value to signal to the rest of our Vue application that the user has authenticated. Storing this in Vuex allows us to use global Vuex "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"getters"}]},{"type":"text","value":" so that we can change component state and other logic where authentication is concerned, such as route guards (for Vue router). We store it in localStorage so that when a new browser tab is opened, we can set the value of "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated"}]},{"type":"text","value":" in Vuex based on the value in localStorage. ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated: localStorage.getItem(\"authenticated\") || \"\","}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Since the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" cookie is HttpOnly, we can't use Javascript to interact with it, so when we want to logout the user we can't just delete the cookie. To logout the user, we make a request to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/logout/"}]},{"type":"text","value":" when the user clicks on the logout button. The view for this endpoint does "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"logout(request)"}]},{"type":"text","value":". This returns a response with a new value for the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" cookie: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Set-Cookie: sessionid=\"\"; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/; SameSite=Lax"}]},{"type":"text","value":". Since the cookie's expiration is in the past, it is removed entirely. We also remove the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated"}]},{"type":"text","value":" localStorage item and set the Vuex store value of "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"authenticated"}]},{"type":"text","value":" to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"''"}]},{"type":"text","value":" (which is falsey). This lets the Vue application know that user has been logged out. One consideration for this is that your user can't logout while offline."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This repo also implements social authentication with the fantastic Python Social Auth library. I used Facebook, Google and GitHub, but there are lots of other providers you can choose from depending on what you need. This is a lengthy topic, and I recommend that you read "},{"type":"element","tag":"a","props":{"href":"https://www.toptal.com/django/integrate-oauth-2-into-django-drf-back-end","rel":["nofollow"]},"children":[{"type":"text","value":"How to Integrate OAuth 2 Into Your Django/DRF Back-end Without Going Insane"}]},{"type":"text","value":" on which I have based my implementation. Here's the short story of how this works. First, a user clicks on one of the social sign-in links. These links are the same for sign-in and sign-up."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The link has a few parts, here's an example: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"https://github.com/login/oauth/authorize?client_id=r66bdfgsfsbferfef4&redirect_uri=http:%2F%2Flocalhost%2Fauth%2Fgithub%2Fcallback&login=&scope=user:email&state=ewori4t95k3vdzem"}]},{"type":"text","value":". The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"client_id"}]},{"type":"text","value":" is the app we created to allow our users to sign in. When you create this app, you specify the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"redirect_uri"}]},{"type":"text","value":" in the configuration, and you reference that here as well. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"scope"}]},{"type":"text","value":" specifies scope of access we are requesting from the user's social account. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"state"}]},{"type":"text","value":" is used for security."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When you click on the link above, you are redirected to GitHub and asked if you want to grant my GitHub application access to your account's associated email address. Clicking on \"Authorize\" then redirects you back to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"redirect_uri"}]},{"type":"text","value":": "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"http://localhost/auth/github/callback?code=veroi3409e203ej&state=ewori4t95k3vdzem"}]},{"type":"text","value":". Notice the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" parameter."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When you navigate to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/auth/github/callback"}]},{"type":"text","value":" on the Vue application, you see a message: \"Logging in with GitHub...\". On this page's "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mounted"}]},{"type":"text","value":" method we call "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"handleOauthCallback"}]},{"type":"text","value":" which makes a request to our Django application: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/social/github/?code=veroi3409e203ej"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This API endpoint uses the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"exchange_token"}]},{"type":"text","value":" view which is where Python Social Auth starts to do the heavy lifting. First, we need to make an API request to GitHub ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"https://github.com/login/oauth/access_token"}]},{"type":"text","value":") with the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" as a URL parameter, then we pass the access code that this API call returns into Python Social Auth's "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"do_auth"}]},{"type":"text","value":" function to get our Django user. Finally, similar to the email/password login approach described above, we call "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"login(request, user)"}]},{"type":"text","value":" and return a simple JSON response: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"{\"detail\": \"success\"}"}]},{"type":"text","value":". This will set the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sessionid"}]},{"type":"text","value":" automatically when the response returns, and we can dispatch the same Vuex action "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"AUTH_SUCCESS"}]},{"type":"text","value":" to tell Vuex that a user has been logged in."}]}]},{"type":"element","tag":"h2","props":{"id":"discussion"},"children":[{"type":"text","value":"Discussion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using the default Django session authentication mechanism has some nice advantages. It allows us to easily navigate between our Javascript SPA which uses Django REST Framework, regular Django admin views that you may also be using, as well as the Django admin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using DRF's token authentication is still possible if you choose to use Session authentication for your JS frontend. For example, you may wish to allow users to make authenticated API requests to your public API using DRF Token Authentication."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JWT is a really interesting concept and important to know about, but it doesn't seem like a practical solution for any of my use cases with Django APIs or frontends. You also can't really \"logout\" a user if you are using this solution for authentication."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What I have described here is pretty simple scenario. It assumes that there is only one type of user and that there are no additional steps needed to make your account \"active\". Doing this would require additional logic on the Vue/Vuex side as well as the backend logic, including the User model. I also don't make use of any data from the social providers except for the user's email address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Another thing to be aware of with this scenario is that a user can register with social authentication first, and then reset their password and login with email (I haven't implemented this client-side on this project yet). Or, you can login with an email account that was created through the Django admin and then login with a social account tied to that email. There are a lot of options for each backend in Python social auth, making it a very flexible library for handling social authentication."}]},{"type":"element","tag":"h2","props":{"id":"next-steps"},"children":[{"type":"text","value":"Next Steps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is a lot more work to do on this example project regarding authentication, but I hope it can help point some people in the right direction. Here are some areas that I would like to work on next:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Error handling for a bad authentication attempt"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A signup form with email confirmation, handling cases where the user trying to signup may already have signed in with social authentication"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Password reset with email"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Making use of Python Social Auth settings and options, including pipelines."}]}]},{"type":"element","tag":"h2","props":{"id":"resources"},"children":[{"type":"text","value":"Resources"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.toptal.com/django/integrate-oauth-2-into-django-drf-back-end","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.toptal.com/django/integrate-oauth-2-into-django-drf-back-end"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://yoongkang.com/blog/cookie-based-authentication-spa-django/","rel":["nofollow"]},"children":[{"type":"text","value":"https://yoongkang.com/blog/cookie-based-authentication-spa-django/"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/encode/django-rest-framework/issues/7273","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/encode/django-rest-framework/issues/7273"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/SimpleJWT/django-rest-framework-simplejwt/issues/71","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/SimpleJWT/django-rest-framework-simplejwt/issues/71"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/","rel":["nofollow"]},"children":[{"type":"text","value":"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-authentication-flow","depth":2,"text":"The authentication flow"},{"id":"discussion","depth":2,"text":"Discussion"},{"id":"next-steps","depth":2,"text":"Next Steps"},{"id":"resources","depth":2,"text":"Resources"}]}},"_type":"markdown","_id":"content:2020:11:27:how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies.md","_source":"content","_file":"2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies.md","_stem":"2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies","_extension":"md"}]