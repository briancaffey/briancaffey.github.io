[{"data":1,"prerenderedAt":10229},["ShallowReactive",2],{"/blog/tags/gaming/":3},[4,2510],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"date":11,"image":12,"tags":13,"external":24,"comments":34,"body":35,"_type":2504,"_id":2505,"_source":2506,"_file":2507,"_stem":2508,"_extension":2509},"/2024/02/17/rocket-league-botchat-nvidia-generative-ai-on-rtx-pcs-developer-contest","17",false,"","Rocket League BotChat powered by TensorRT-LLM: My submission for NVIDIA's Generative AI on RTX PCs Developer Contest","This article discusses my entry for NVIDIA's Generative AI on RTX PCs Developer Contest: Rocket Leauge BotChat","2024-02-17","/static/rlbc/cover.png",[14,15,16,17,18,19,20,21,22,23],"nvidia","rtx","gpu","tensorrt-llm","ai","llm","llama","rocket-league","gaming","windows",[25,28,31],{"link":26,"site":27},"https://twitter.com/briancaffey/status/1760529251072118901","x",{"link":29,"site":30},"https://www.reddit.com/r/RocketLeague/comments/1au0po3/rocket_league_botchat_an_llmpowered_bakkesmod/","reddit",{"link":32,"site":33},"https://dev.to/briancaffey/rocket-league-botchat-powered-by-tensorrt-llm-my-submission-for-nvidias-generative-ai-on-rtx-pcs-developer-contest-2oao","dev",true,{"type":36,"children":37,"toc":2481},"root",[38,47,53,58,163,169,184,190,195,203,208,213,218,223,232,238,243,251,259,264,272,277,282,287,292,300,306,311,423,444,457,492,497,510,539,544,557,562,703,724,732,753,802,807,842,848,853,861,930,937,949,1247,1253,1258,1390,1403,1408,1416,1428,1433,1438,1446,1452,1464,1470,1483,1644,1650,1663,1862,1868,1873,1939,1952,1985,1998,2004,2009,2017,2023,2028,2193,2214,2220,2225,2230,2235,2241,2312,2315,2320,2328,2380,2388,2396,2404,2413,2419,2431,2436,2441,2454,2460,2465,2470,2475],{"type":39,"tag":40,"props":41,"children":43},"element","h2",{"id":42},"tldr",[44],{"type":45,"value":46},"text","tl;dr",{"type":39,"tag":48,"props":49,"children":50},"p",{},[51],{"type":45,"value":52},"This article is about my submission to NVIDIA's Generative AI on RTX PCs Developer Contest: Rocket League BotChat. Rocket League BotChat is a BakkesMod plugin for Rocket League that allows bots to send chat messages based on in-game events. It is designed to be used with a local LLM service optimized and accelerated with NVIDIA's TensorRT-LLM library.",{"type":39,"tag":48,"props":54,"children":55},{},[56],{"type":45,"value":57},"Here's my project submission post on ùïè:",{"type":39,"tag":59,"props":60,"children":65},"blockquote",{"className":61,"dataTheme":64},[62,63],"twitter-tweet","tw-align-center","dark",[66,155,157],{"type":39,"tag":48,"props":67,"children":70},{"lang":68,"dir":69},"en","ltr",[71,73,77,79,82,84,91,93,99,100,106,107,113,114,120,121,127,128,134,135,141,142,148,149],{"type":45,"value":72},"Rocket League BotChat - powered by TensorRT-LLM",{"type":39,"tag":74,"props":75,"children":76},"br",{},[],{"type":45,"value":78},"‚öΩÔ∏èüöó‚ö°Ô∏èü§ñüí¨",{"type":39,"tag":74,"props":80,"children":81},{},[],{"type":45,"value":83},"My submission for NVIDIA's Gen AI on RTX PCs Developer Contest!",{"type":39,"tag":85,"props":86,"children":88},"a",{"href":87},"https://twitter.com/hashtag/GenAIonRTX?src=hash&ref_src=twsrc%5Etfw",[89],{"type":45,"value":90},"#GenAIonRTX",{"type":45,"value":92}," ",{"type":39,"tag":85,"props":94,"children":96},{"href":95},"https://twitter.com/hashtag/DevContest?src=hash&ref_src=twsrc%5Etfw",[97],{"type":45,"value":98},"#DevContest",{"type":45,"value":92},{"type":39,"tag":85,"props":101,"children":103},{"href":102},"https://twitter.com/hashtag/GTC24?src=hash&ref_src=twsrc%5Etfw",[104],{"type":45,"value":105},"#GTC24",{"type":45,"value":92},{"type":39,"tag":85,"props":108,"children":110},{"href":109},"https://twitter.com/NVIDIAAIDev?ref_src=twsrc%5Etfw",[111],{"type":45,"value":112},"@NVIDIAAIDev",{"type":45,"value":92},{"type":39,"tag":85,"props":115,"children":117},{"href":116},"https://twitter.com/hashtag/RocketLeague?src=hash&ref_src=twsrc%5Etfw",[118],{"type":45,"value":119},"#RocketLeague",{"type":45,"value":92},{"type":39,"tag":85,"props":122,"children":124},{"href":123},"https://twitter.com/hashtag/LLM?src=hash&ref_src=twsrc%5Etfw",[125],{"type":45,"value":126},"#LLM",{"type":45,"value":92},{"type":39,"tag":85,"props":129,"children":131},{"href":130},"https://twitter.com/hashtag/Llama?src=hash&ref_src=twsrc%5Etfw",[132],{"type":45,"value":133},"#Llama",{"type":45,"value":92},{"type":39,"tag":85,"props":136,"children":138},{"href":137},"https://twitter.com/hashtag/AI?src=hash&ref_src=twsrc%5Etfw",[139],{"type":45,"value":140},"#AI",{"type":45,"value":92},{"type":39,"tag":85,"props":143,"children":145},{"href":144},"https://twitter.com/hashtag/Windows11?src=hash&ref_src=twsrc%5Etfw",[146],{"type":45,"value":147},"#Windows11",{"type":45,"value":92},{"type":39,"tag":85,"props":150,"children":152},{"href":151},"https://t.co/4H8u3KpQ6G",[153],{"type":45,"value":154},"pic.twitter.com/4H8u3KpQ6G",{"type":45,"value":156},"‚Äî Brian Caffey (@briancaffey) ",{"type":39,"tag":85,"props":158,"children":160},{"href":159},"https://twitter.com/briancaffey/status/1760529251072118901?ref_src=twsrc%5Etfw",[161],{"type":45,"value":162},"February 22, 2024",{"type":39,"tag":164,"props":165,"children":168},"script",{"async":34,"src":166,"charSet":167},"https://platform.twitter.com/widgets.js","utf-8",[],{"type":39,"tag":48,"props":170,"children":171},{},[172,174,182],{"type":45,"value":173},"Here's a link to the ",{"type":39,"tag":85,"props":175,"children":179},{"href":176,"rel":177},"https://github.com/briancaffey/RocketLeagueBotChat",[178],"nofollow",[180],{"type":45,"value":181},"Rocket League BotChat GitHub repository",{"type":45,"value":183},".",{"type":39,"tag":40,"props":185,"children":187},{"id":186},"nvidias-gen-ai-developer-contest",[188],{"type":45,"value":189},"NVIDIA's Gen AI Developer Contest",{"type":39,"tag":48,"props":191,"children":192},{},[193],{"type":45,"value":194},"The following email caught my attention last month:",{"type":39,"tag":59,"props":196,"children":197},{},[198],{"type":39,"tag":48,"props":199,"children":200},{},[201],{"type":45,"value":202},"Generative AI on RTX PCs Developer Contest: Build your next innovative Gen AI project using NVIDIA TensorRT or TensorRT-LLM on Windows PC with NVIDIA RTX systems",{"type":39,"tag":48,"props":204,"children":205},{},[206],{"type":45,"value":207},"The part about ‚Äúon Windows PC‚Äù made me think: why would a developer contest focus on a particular operating system? I use all three of the major operating systems: macOS, Ubuntu and Windows 11, but most of the development work I do is on macOS and Ubuntu. I discovered WSL (Windows Subsystem for Linux) a few years ago and really enjoy using that for development as well, but I had never considered doing development work on Windows outside of WSL. I had also never used any of the Windows-specific development frameworks like .NET or Visual Studio.",{"type":39,"tag":48,"props":209,"children":210},{},[211],{"type":45,"value":212},"My experience with Windows goes back to 2016 when I built my fist PC with an NVIDIA GeForce GTX 1080 graphics card. When I built another personal computer last year in 2023, getting the NVIDIA GeForce RTX 4090 graphics card was a big step up. I bought two NVMe drives in order to dual boot into both Windows and Ubuntu operating systems. Switching between the operating systems requires turning off the computer, going into the BIOS settings and changing the boot order and restarting the computer.",{"type":39,"tag":48,"props":214,"children":215},{},[216],{"type":45,"value":217},"Last year I started learning more about AI image generation using Stable Diffusion with programs like Automatic1111, InvokeAI and ComfyUI. I set up everything on my PC's Ubuntu operating system, and frequently had to switch between using Ubuntu for working with stable diffusion and Windows for gaming and other Windows-specific software. The friction of having to constantly switch operating systems pushed me to move my stable diffusion software workflows to Windows. All of my models and images are stored to external drives, so moving things over to Windows was pretty easy.",{"type":39,"tag":48,"props":219,"children":220},{},[221],{"type":45,"value":222},"I learned PowerShell and got more familiar with how Windows works as a development machine. Environment variables and system variables are one example of how Windows does things differently compared ot Linux-based operating systems. And just like that, I became a Windows developer! This experience got me interested in coming up with an idea for the NVIDIA Generative AI on NVIDIA RTX PCs Developer Contest.",{"type":39,"tag":48,"props":224,"children":225},{},[226],{"type":39,"tag":227,"props":228,"children":231},"img",{"alt":229,"src":230},"Windows winfetch screenshot","/static/rlbc/winfetch.png",[],{"type":39,"tag":40,"props":233,"children":235},{"id":234},"coming-up-with-an-idea",[236],{"type":45,"value":237},"Coming up with an Idea",{"type":39,"tag":48,"props":239,"children":240},{},[241],{"type":45,"value":242},"The contest description and some related NVIDIA articles about the contest helped me with brainstorming:",{"type":39,"tag":59,"props":244,"children":245},{},[246],{"type":39,"tag":48,"props":247,"children":248},{},[249],{"type":45,"value":250},"Whether it‚Äôs a RAG-based chatbot, a plug-in for an existing application, or a code generation tool, the possibilities are endless.",{"type":39,"tag":59,"props":252,"children":253},{},[254],{"type":39,"tag":48,"props":255,"children":256},{},[257],{"type":45,"value":258},"Many use cases would benefit from running LLMs locally on Windows PCs, including gaming, creativity, productivity, and developer experiences.",{"type":39,"tag":48,"props":260,"children":261},{},[262],{"type":45,"value":263},"This contest is focused on NVIDIA's consumer hardware line: GeForce RTX. It has a diverse set of use cases including gaming, crypto mining, VR, simulation software, creative tools and new AI techniques including image generation and LLM (Large Language Model) inference.",{"type":39,"tag":48,"props":265,"children":266},{},[267],{"type":39,"tag":227,"props":268,"children":271},{"alt":269,"src":270},"A stacked bar chart showing the composition of Nvidia's revenue each quarter going back to fiscal 2019.","https://g.foolcdn.com/image/?url=https%3A%2F%2Fg.foolcdn.com%2Feditorial%2Fimages%2F764886%2Fnvda_revenue_bar.png&op=resize&w=700",[],{"type":39,"tag":48,"props":273,"children":274},{},[275],{"type":45,"value":276},"Gaming seemed like an interesting avenue for me to explore. PC gaming is still an industry that is developed primarily for Windows operating systems, and the gaming industry has been the largest revenue driver of NVIDIA in recent years, only recently surpassed by the data center segment. GPUs are needed to render graphics of enormous open-world environments. Some story-driven games include huge amounts of dialogue that can be considered as huge literary works in their own right. Red Dead Redemption and Genshin Impact are two massively popular games of this type. There might be an interesting project idea that could use LLMs and RAG (retrieval augmented generation), but I don't play these types of games and it didn't seem practical for a project that would be built in just over a month. I thought about trying to build something for a simpler game that I already know.",{"type":39,"tag":48,"props":278,"children":279},{},[280],{"type":45,"value":281},"Rocket League is a vehicular soccer game that is played on both game consoles and on PCs. It is an eSports with a very high skill ceiling and a massive player base (85 million active players in the last 30 days). I started playing it during the pandemic with some of my friends and all got hooked. We also came to learn that Rocket League's in-game is varies from entertaining, annoying, toxic and in some cases, sportsmanlike.",{"type":39,"tag":48,"props":283,"children":284},{},[285],{"type":45,"value":286},"One other thing I learned about Rocket League is that it has an active modding community. Developers create plugins for the game for all different purposes, such as coaching, practice drills, capturing replays, tracking player statistics, etc. Most Rocket League Mods are written in a popular framework called Bakkesmod (developed Andreas \"bakkes\" Bakke, a Norwegian software engineer). Rocket League's in-game chat inspired the idea for my submission to NVIDIA's Generative AI Developer Contest: Rocket League BotChat. The idea for my project is to build a plugin with Bakkesmod that allows Rocket League bots to send chat messages based on game events using an LLM accelerated and optimized by TensorRT-LLM (more on TensorRT-LLM soon!)",{"type":39,"tag":48,"props":288,"children":289},{},[290],{"type":45,"value":291},"Bots are built into the Rocket League game and you can play with or against them in offline matches. However, the built-in bots are not very good. Another 3rd-party project called RLBot allows players to play against community-developed AI bots that are developed with machine learning frameworks like TensorFlow and PyTorch. These bots are very good, but they are not infallible. My contest project idea was now clear: develop a plugin for Rocket League capable of sending messages from bot players. This idea seemed to check the boxes for the large language model category of NVIDIA's developer contest: develop a project in a Windows environment for a Windows-specific program, and use an LLM powered by TensorRT-LLM.",{"type":39,"tag":48,"props":293,"children":294},{},[295],{"type":39,"tag":227,"props":296,"children":299},{"alt":297,"src":298},"RLBot Ascii Art","/static/rlbc/bot.png",[],{"type":39,"tag":40,"props":301,"children":303},{"id":302},"putting-together-the-puzzle-pieces",[304],{"type":45,"value":305},"Putting together the puzzle pieces",{"type":39,"tag":48,"props":307,"children":308},{},[309],{"type":45,"value":310},"With this idea in mind, I looked into the project's feasibility. I really had no idea if this would work. I looked through the Bakkesmod documentation and found some helpful resources that gave me confidence that I could pull something together for at least a proof-of-concept.",{"type":39,"tag":312,"props":313,"children":314},"ul",{},[315,363,382,393],{"type":39,"tag":316,"props":317,"children":318},"li",{},[319,321,327],{"type":45,"value":320},"The Bakkesmod Plugin Wiki ",{"type":39,"tag":85,"props":322,"children":325},{"href":323,"rel":324},"https://wiki.bakkesplugins.com/",[178],[326],{"type":45,"value":323},{"type":39,"tag":312,"props":328,"children":329},{},[330,347],{"type":39,"tag":316,"props":331,"children":332},{},[333,345],{"type":39,"tag":85,"props":334,"children":337},{"href":335,"rel":336},"https://wiki.bakkesplugins.com/code_snippets/using_http_wrapper/",[178],[338],{"type":39,"tag":339,"props":340,"children":342},"code",{"className":341},[],[343],{"type":45,"value":344},"HttpWrapper",{"type":45,"value":346}," for sending HTTP requests from Bakkesmod",{"type":39,"tag":316,"props":348,"children":349},{},[350,361],{"type":39,"tag":85,"props":351,"children":354},{"href":352,"rel":353},"https://wiki.bakkesplugins.com/functions/stat_events/",[178],[355],{"type":39,"tag":339,"props":356,"children":358},{"className":357},[],[359],{"type":45,"value":360},"StatEvents",{"type":45,"value":362}," that allow for running custom code when specific event functions are triggered in the game (such as scoring a goal, or making a save).",{"type":39,"tag":316,"props":364,"children":365},{},[366,368,374],{"type":45,"value":367},"The Bakkesmod plugin template: ",{"type":39,"tag":85,"props":369,"children":372},{"href":370,"rel":371},"https://github.com/Martinii89/BakkesmodPluginTemplate",[178],[373],{"type":45,"value":370},{"type":39,"tag":312,"props":375,"children":376},{},[377],{"type":39,"tag":316,"props":378,"children":379},{},[380],{"type":45,"value":381},"This provides a great starting-off point for developing Bakkesmod plugins. Plugins for Bakkesmod are written in C++ and this repo provides an organized file structure that allows your to get started quickly",{"type":39,"tag":316,"props":383,"children":384},{},[385,387],{"type":45,"value":386},"Plugin Tutorial: ",{"type":39,"tag":85,"props":388,"children":391},{"href":389,"rel":390},"https://wiki.bakkesplugins.com/plugin_tutorial/getting_started/",[178],[392],{"type":45,"value":389},{"type":39,"tag":316,"props":394,"children":395},{},[396,398],{"type":45,"value":397},"Open-source chat-related Bakkesmod plugins on GitHub\n",{"type":39,"tag":312,"props":399,"children":400},{},[401,412],{"type":39,"tag":316,"props":402,"children":403},{},[404,406],{"type":45,"value":405},"BetterChat: ",{"type":39,"tag":85,"props":407,"children":410},{"href":408,"rel":409},"https://github.com/JulienML/BetterChat",[178],[411],{"type":45,"value":408},{"type":39,"tag":316,"props":413,"children":414},{},[415,417],{"type":45,"value":416},"Translate: ",{"type":39,"tag":85,"props":418,"children":421},{"href":419,"rel":420},"https://github.com/0xleft/trnslt",[178],[422],{"type":45,"value":419},{"type":39,"tag":48,"props":424,"children":425},{},[426,428,434,436,442],{"type":45,"value":427},"Starting with the Plugin Template, I wrote a simple console command that when triggered sends an HTTP request to ",{"type":39,"tag":339,"props":429,"children":431},{"className":430},[],[432],{"type":45,"value":433},"localhost:8000/hello",{"type":45,"value":435},". I set up a Hello World Flask app running on ",{"type":39,"tag":339,"props":437,"children":439},{"className":438},[],[440],{"type":45,"value":441},"localhost:8000",{"type":45,"value":443}," and I was able to get a response from my Hello World server! There didn't seem to be any network or permission errors that would prevent my game code from communicating with other applications on my PC.",{"type":39,"tag":48,"props":445,"children":446},{},[447,449,455],{"type":45,"value":448},"Next I started looking into how to build and run optimized LLMs with NVIDIA's TensorRT-LLM library, the software that this contest is promoting. The contest announcement included an interesting building block that I thought could be very useful: an example repo showing how to run ",{"type":39,"tag":339,"props":450,"children":452},{"className":451},[],[453],{"type":45,"value":454},"CodeLlama-13b-instruct-hf",{"type":45,"value":456}," optimized by TensorRT-LLM to provide inference for a VSCode extension called Continue (Continue.dev).",{"type":39,"tag":312,"props":458,"children":459},{},[460,470,482,487],{"type":39,"tag":316,"props":461,"children":462},{},[463,468],{"type":39,"tag":339,"props":464,"children":466},{"className":465},[],[467],{"type":45,"value":454},{"type":45,"value":469}," is an open source model from Meta that is trained on code and can help with code generation tasks",{"type":39,"tag":316,"props":471,"children":472},{},[473,475,480],{"type":45,"value":474},"TensorRT-LLM is a Python library that accelerates and optimizes inference performance of large language models. It takes a Large Language Model like ",{"type":39,"tag":339,"props":476,"children":478},{"className":477},[],[479],{"type":45,"value":454},{"type":45,"value":481}," and generates an engine that can be used for doing inference",{"type":39,"tag":316,"props":483,"children":484},{},[485],{"type":45,"value":486},"VSCode is an open source code editor developed by Microsoft with an large number of community plugins",{"type":39,"tag":316,"props":488,"children":489},{},[490],{"type":45,"value":491},"Continue.dev is a startup backed by Y Combinator that is developing an open-source autopilot (code assistant) for VSCode and JetBrains that works with local LLMs or paid services like ChatGPT",{"type":39,"tag":48,"props":493,"children":494},{},[495],{"type":45,"value":496},"To get the coding assistant project working I needed to build the TensorRT-LLM engine. Building TensorRT-LLM engines on Windows can be done in one of two ways:",{"type":39,"tag":312,"props":498,"children":499},{},[500,505],{"type":39,"tag":316,"props":501,"children":502},{},[503],{"type":45,"value":504},"using a \"bare-metal\" virtual environment on Windows (with PowerShell)",{"type":39,"tag":316,"props":506,"children":507},{},[508],{"type":45,"value":509},"using WSL",{"type":39,"tag":48,"props":511,"children":512},{},[513,515,521,523,529,531,537],{"type":45,"value":514},"At the time of writing, building a TensorRT-LLM engine on Windows can only be done with version ",{"type":39,"tag":339,"props":516,"children":518},{"className":517},[],[519],{"type":45,"value":520},"v0.6.1",{"type":45,"value":522}," of the TensorRT-LLM repo and version ",{"type":39,"tag":339,"props":524,"children":526},{"className":525},[],[527],{"type":45,"value":528},"v0.7.1",{"type":45,"value":530}," of the ",{"type":39,"tag":339,"props":532,"children":534},{"className":533},[],[535],{"type":45,"value":536},"tensorrt_llm",{"type":45,"value":538}," Python package.",{"type":39,"tag":48,"props":540,"children":541},{},[542],{"type":45,"value":543},"With WSL you can use the up-to-date versions of the TensorRT-LLM repo (main branch). The engines produced by Windows and WSL (Ubuntu) are not interchangeable and you will get errors if you try to use an engine created with one operating system on another operating system.",{"type":39,"tag":48,"props":545,"children":546},{},[547,549,555],{"type":45,"value":548},"Once the engines are built you can use them to run the example from the ",{"type":39,"tag":339,"props":550,"children":552},{"className":551},[],[553],{"type":45,"value":554},"trt-llm-as-openai-windows",{"type":45,"value":556}," repo.",{"type":39,"tag":48,"props":558,"children":559},{},[560],{"type":45,"value":561},"The example repo exposes an OpenAI-compatible API locally that can do chat completions. You then need to configure the Continue.dev extension to use the local LLM service:",{"type":39,"tag":563,"props":564,"children":568},"pre",{"code":565,"language":566,"meta":8,"className":567,"style":8},"{\n  \"title\": \"CodeLlama-13b-instruct-hf\",\n  \"apiBase\": \"http://192.168.5.96:5000/\",\n  \"provider\": \"openai\",\n  \"apiKey\": \"None\",\n  \"model\": \"gpt-4\"\n}\n","json","language-json shiki shiki-themes github-light github-dark monokai",[569],{"type":39,"tag":339,"props":570,"children":571},{"__ignoreMap":8},[572,584,610,632,654,676,694],{"type":39,"tag":573,"props":574,"children":577},"span",{"class":575,"line":576},"line",1,[578],{"type":39,"tag":573,"props":579,"children":581},{"style":580},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[582],{"type":45,"value":583},"{\n",{"type":39,"tag":573,"props":585,"children":587},{"class":575,"line":586},2,[588,594,599,605],{"type":39,"tag":573,"props":589,"children":591},{"style":590},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[592],{"type":45,"value":593},"  \"title\"",{"type":39,"tag":573,"props":595,"children":596},{"style":580},[597],{"type":45,"value":598},": ",{"type":39,"tag":573,"props":600,"children":602},{"style":601},"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#CFCFC2",[603],{"type":45,"value":604},"\"CodeLlama-13b-instruct-hf\"",{"type":39,"tag":573,"props":606,"children":607},{"style":580},[608],{"type":45,"value":609},",\n",{"type":39,"tag":573,"props":611,"children":613},{"class":575,"line":612},3,[614,619,623,628],{"type":39,"tag":573,"props":615,"children":616},{"style":590},[617],{"type":45,"value":618},"  \"apiBase\"",{"type":39,"tag":573,"props":620,"children":621},{"style":580},[622],{"type":45,"value":598},{"type":39,"tag":573,"props":624,"children":625},{"style":601},[626],{"type":45,"value":627},"\"http://192.168.5.96:5000/\"",{"type":39,"tag":573,"props":629,"children":630},{"style":580},[631],{"type":45,"value":609},{"type":39,"tag":573,"props":633,"children":635},{"class":575,"line":634},4,[636,641,645,650],{"type":39,"tag":573,"props":637,"children":638},{"style":590},[639],{"type":45,"value":640},"  \"provider\"",{"type":39,"tag":573,"props":642,"children":643},{"style":580},[644],{"type":45,"value":598},{"type":39,"tag":573,"props":646,"children":647},{"style":601},[648],{"type":45,"value":649},"\"openai\"",{"type":39,"tag":573,"props":651,"children":652},{"style":580},[653],{"type":45,"value":609},{"type":39,"tag":573,"props":655,"children":657},{"class":575,"line":656},5,[658,663,667,672],{"type":39,"tag":573,"props":659,"children":660},{"style":590},[661],{"type":45,"value":662},"  \"apiKey\"",{"type":39,"tag":573,"props":664,"children":665},{"style":580},[666],{"type":45,"value":598},{"type":39,"tag":573,"props":668,"children":669},{"style":601},[670],{"type":45,"value":671},"\"None\"",{"type":39,"tag":573,"props":673,"children":674},{"style":580},[675],{"type":45,"value":609},{"type":39,"tag":573,"props":677,"children":679},{"class":575,"line":678},6,[680,685,689],{"type":39,"tag":573,"props":681,"children":682},{"style":590},[683],{"type":45,"value":684},"  \"model\"",{"type":39,"tag":573,"props":686,"children":687},{"style":580},[688],{"type":45,"value":598},{"type":39,"tag":573,"props":690,"children":691},{"style":601},[692],{"type":45,"value":693},"\"gpt-4\"\n",{"type":39,"tag":573,"props":695,"children":697},{"class":575,"line":696},7,[698],{"type":39,"tag":573,"props":699,"children":700},{"style":580},[701],{"type":45,"value":702},"}\n",{"type":39,"tag":48,"props":704,"children":705},{},[706,708,713,715,722],{"type":45,"value":707},"The Continue.dev extension using ",{"type":39,"tag":339,"props":709,"children":711},{"className":710},[],[712],{"type":45,"value":454},{"type":45,"value":714}," accelerated and optimized by TensorRT-LLM is very fast. According to ",{"type":39,"tag":85,"props":716,"children":719},{"href":717,"rel":718},"https://blog.continue.dev/programming-languages/",[178],[720],{"type":45,"value":721},"this post on Continue.dev's blog",{"type":45,"value":723},", C++ is a \"first tier\" language:",{"type":39,"tag":59,"props":725,"children":726},{},[727],{"type":39,"tag":48,"props":728,"children":729},{},[730],{"type":45,"value":731},"C++ has one of the largest presences on GitHub and Stack Overflow. This shows up in its representation in public LLM datasets, where it is one of the languages with the most data. Its performance is near the top of the MultiPL-E, BabelCode / TP3, MBXP / Multilingual HumanEval, and HumanEval-X benchmarks. However, given that C++ is often used when code performance and exact algorithm implementation is very important, many developers don‚Äôt believe that LLMs are as helpful for C++ as some of the other languages in this tier.",{"type":39,"tag":48,"props":733,"children":734},{},[735,737,743,745,751],{"type":45,"value":736},"Most of the time I'm working with either Python and TypeScript. I've read about C++ but haven't used it for anything before doing this project. I primarily used Microsoft Visual Studio to build the plugin, but VSCode with the Continue.dev autopilot extension was helpful for tackling smaller problems in a REPL-like environment. For example, I used Continue.dev in VSCode to figure out how to handle JSON. Coming from Python and JavaScript languages, I found the ",{"type":39,"tag":339,"props":738,"children":740},{"className":739},[],[741],{"type":45,"value":742},"nlohmann/json",{"type":45,"value":744}," JSON library syntax to be somewhat different. For example, here is how to add a message to ",{"type":39,"tag":339,"props":746,"children":748},{"className":747},[],[749],{"type":45,"value":750},"messages",{"type":45,"value":752}," in the body of an OpenAI API request:",{"type":39,"tag":563,"props":754,"children":758},{"code":755,"language":756,"meta":8,"className":757,"style":8},"messages.push_back({ {\"role\", role}, {\"content\", content } });\n","cpp","language-cpp shiki shiki-themes github-light github-dark monokai",[759],{"type":39,"tag":339,"props":760,"children":761},{"__ignoreMap":8},[762],{"type":39,"tag":573,"props":763,"children":764},{"class":575,"line":576},[765,770,776,781,787,792,797],{"type":39,"tag":573,"props":766,"children":767},{"style":580},[768],{"type":45,"value":769},"messages.",{"type":39,"tag":573,"props":771,"children":773},{"style":772},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[774],{"type":45,"value":775},"push_back",{"type":39,"tag":573,"props":777,"children":778},{"style":580},[779],{"type":45,"value":780},"({ {",{"type":39,"tag":573,"props":782,"children":784},{"style":783},"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[785],{"type":45,"value":786},"\"role\"",{"type":39,"tag":573,"props":788,"children":789},{"style":580},[790],{"type":45,"value":791},", role}, {",{"type":39,"tag":573,"props":793,"children":794},{"style":783},[795],{"type":45,"value":796},"\"content\"",{"type":39,"tag":573,"props":798,"children":799},{"style":580},[800],{"type":45,"value":801},", content } });\n",{"type":39,"tag":48,"props":803,"children":804},{},[805],{"type":45,"value":806},"In Python the code for appending a message to a list of messages would be written differently:",{"type":39,"tag":563,"props":808,"children":812},{"code":809,"language":810,"meta":8,"className":811,"style":8},"messages.append({\"role\": role, \"content\": content})\n","python","language-python shiki shiki-themes github-light github-dark monokai",[813],{"type":39,"tag":339,"props":814,"children":815},{"__ignoreMap":8},[816],{"type":39,"tag":573,"props":817,"children":818},{"class":575,"line":576},[819,824,828,833,837],{"type":39,"tag":573,"props":820,"children":821},{"style":580},[822],{"type":45,"value":823},"messages.append({",{"type":39,"tag":573,"props":825,"children":826},{"style":783},[827],{"type":45,"value":786},{"type":39,"tag":573,"props":829,"children":830},{"style":580},[831],{"type":45,"value":832},": role, ",{"type":39,"tag":573,"props":834,"children":835},{"style":783},[836],{"type":45,"value":796},{"type":39,"tag":573,"props":838,"children":839},{"style":580},[840],{"type":45,"value":841},": content})\n",{"type":39,"tag":40,"props":843,"children":845},{"id":844},"development-environment",[846],{"type":45,"value":847},"Development environment",{"type":39,"tag":48,"props":849,"children":850},{},[851],{"type":45,"value":852},"While working on different projects using web technologies and frameworks in the Python and JavaScript ecosystems, I developed an appreciation for well-structured development environments that are easy to use. Development environment refers to the tools and processes by which a developer can make a change to source code and see these changes reflected in some version of the application running on a local environment. The local environment (the developer's computer) should be a close proxy for the production environment where the code will ultimately deployed to for end users. For this project the local development environment is our PC itself, which simplifies things. A development environment should support hot-reloading so incremental changes can be run to test functionality, offering a tight feedback loop. I really like the development environment for this project. Here's a screenshot that shows the different parts of the development environment I used for working on Rocket League BotChat:",{"type":39,"tag":48,"props":854,"children":855},{},[856],{"type":39,"tag":227,"props":857,"children":860},{"alt":858,"src":859},"Screenshot of Rocket League BotChat development environment","/static/rlbc/devenv2.png",[],{"type":39,"tag":312,"props":862,"children":863},{},[864,877,905,918],{"type":39,"tag":316,"props":865,"children":866},{},[867,869,875],{"type":45,"value":868},"Rocket League (running with the ",{"type":39,"tag":339,"props":870,"children":872},{"className":871},[],[873],{"type":45,"value":874},"-dev",{"type":45,"value":876}," flag turned on). The console is helpful for viewing log messages and the plugin settings panel can be used to view and change plugin configuration values. The BakkesMod plugin also needs to be running in order to inject plugin code into the game engine",{"type":39,"tag":316,"props":878,"children":879},{},[880,882,888,890,896,897,903],{"type":45,"value":881},"Visual Studio for working on the plugin code. ",{"type":39,"tag":339,"props":883,"children":885},{"className":884},[],[886],{"type":45,"value":887},"Control",{"type":45,"value":889},"+",{"type":39,"tag":339,"props":891,"children":893},{"className":892},[],[894],{"type":45,"value":895},"Shift",{"type":45,"value":889},{"type":39,"tag":339,"props":898,"children":900},{"className":899},[],[901],{"type":45,"value":902},"B",{"type":45,"value":904}," rebuilds the code and automatically reloads the plugin in the game",{"type":39,"tag":316,"props":906,"children":907},{},[908,910,916],{"type":45,"value":909},"OpenAI-compatible LLM server powered by TensorRT-LLM (using ",{"type":39,"tag":339,"props":911,"children":913},{"className":912},[],[914],{"type":45,"value":915},"Llama-2-13b-chat-hf",{"type":45,"value":917}," with AWQ INT4 quantization) running in a docker container on Ubuntu in WSL",{"type":39,"tag":316,"props":919,"children":920},{},[921,923,928],{"type":45,"value":922},"VSCode for debugging C++ code with Continue.dev extension powered by TensorRT-LLM (using ",{"type":39,"tag":339,"props":924,"children":926},{"className":925},[],[927],{"type":45,"value":454},{"type":45,"value":929}," with AWQ INT4 quantization) running in a virtual environment on Windows",{"type":39,"tag":931,"props":932,"children":934},"h3",{"id":933},"building-the-tensorrt-llm-engines",[935],{"type":45,"value":936},"Building the TensorRT-LLM engines",{"type":39,"tag":48,"props":938,"children":939},{},[940,942,947],{"type":45,"value":941},"I was able to build and run the TensorRT LLM engines for my game plugin's inference and the Continue.dev extension's inference both in Python virtual environments on Windows and on Ubuntu in WSL. For building the ",{"type":39,"tag":339,"props":943,"children":945},{"className":944},[],[946],{"type":45,"value":915},{"type":45,"value":948}," model with INT4 AWQ quantization on Windows 11 I used this command:",{"type":39,"tag":563,"props":950,"children":954},{"code":951,"language":952,"meta":8,"className":953,"style":8},"(.venv) PS C:\\Users\\My PC\\GitHub\\TensorRT-LLM\\examples\\llama> python build.py --model_dir D:\\llama\\Llama-2-13b-chat-hf\\ --quant_ckpt_path D:\\llama\\Llama-2-13b-chat-hf\\llama_tp1_rank0.npz --dtype float16 --use_gpt_attention_plugin float16 --use_gemm_plugin float16 --use_weight_only --weight_only_precision int4_awq --per_group --enable_context_fmha --max_batch_size 1 --max_input_len 3500 --max_output_len 1024 --output_dir D:\\llama\\Llama-2-13b-chat-hf\\single-gpu\\ --vocab_size 32064\n","powershell","language-powershell shiki shiki-themes github-light github-dark monokai",[955],{"type":39,"tag":339,"props":956,"children":957},{"__ignoreMap":8},[958],{"type":39,"tag":573,"props":959,"children":960},{"class":575,"line":576},[961,966,972,977,982,987,992,997,1001,1007,1011,1016,1020,1025,1029,1034,1038,1043,1047,1051,1055,1059,1063,1067,1071,1076,1080,1085,1089,1094,1098,1103,1107,1112,1116,1121,1125,1130,1134,1139,1143,1148,1153,1158,1163,1168,1172,1177,1182,1186,1191,1195,1199,1203,1207,1211,1215,1219,1224,1228,1233,1237,1242],{"type":39,"tag":573,"props":962,"children":963},{"style":580},[964],{"type":45,"value":965},"(.venv) PS C:\\Users\\My PC\\GitHub\\TensorRT",{"type":39,"tag":573,"props":967,"children":969},{"style":968},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[970],{"type":45,"value":971},"-",{"type":39,"tag":573,"props":973,"children":974},{"style":580},[975],{"type":45,"value":976},"LLM\\examples\\llama",{"type":39,"tag":573,"props":978,"children":979},{"style":968},[980],{"type":45,"value":981},">",{"type":39,"tag":573,"props":983,"children":984},{"style":580},[985],{"type":45,"value":986}," python build.py ",{"type":39,"tag":573,"props":988,"children":989},{"style":968},[990],{"type":45,"value":991},"--",{"type":39,"tag":573,"props":993,"children":994},{"style":580},[995],{"type":45,"value":996},"model_dir D:\\llama\\Llama",{"type":39,"tag":573,"props":998,"children":999},{"style":968},[1000],{"type":45,"value":971},{"type":39,"tag":573,"props":1002,"children":1004},{"style":1003},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1005],{"type":45,"value":1006},"2",{"type":39,"tag":573,"props":1008,"children":1009},{"style":968},[1010],{"type":45,"value":971},{"type":39,"tag":573,"props":1012,"children":1013},{"style":580},[1014],{"type":45,"value":1015},"13b",{"type":39,"tag":573,"props":1017,"children":1018},{"style":968},[1019],{"type":45,"value":971},{"type":39,"tag":573,"props":1021,"children":1022},{"style":580},[1023],{"type":45,"value":1024},"chat",{"type":39,"tag":573,"props":1026,"children":1027},{"style":968},[1028],{"type":45,"value":971},{"type":39,"tag":573,"props":1030,"children":1031},{"style":580},[1032],{"type":45,"value":1033},"hf\\ ",{"type":39,"tag":573,"props":1035,"children":1036},{"style":968},[1037],{"type":45,"value":991},{"type":39,"tag":573,"props":1039,"children":1040},{"style":580},[1041],{"type":45,"value":1042},"quant_ckpt_path D:\\llama\\Llama",{"type":39,"tag":573,"props":1044,"children":1045},{"style":968},[1046],{"type":45,"value":971},{"type":39,"tag":573,"props":1048,"children":1049},{"style":1003},[1050],{"type":45,"value":1006},{"type":39,"tag":573,"props":1052,"children":1053},{"style":968},[1054],{"type":45,"value":971},{"type":39,"tag":573,"props":1056,"children":1057},{"style":580},[1058],{"type":45,"value":1015},{"type":39,"tag":573,"props":1060,"children":1061},{"style":968},[1062],{"type":45,"value":971},{"type":39,"tag":573,"props":1064,"children":1065},{"style":580},[1066],{"type":45,"value":1024},{"type":39,"tag":573,"props":1068,"children":1069},{"style":968},[1070],{"type":45,"value":971},{"type":39,"tag":573,"props":1072,"children":1073},{"style":580},[1074],{"type":45,"value":1075},"hf\\llama_tp1_rank0.npz ",{"type":39,"tag":573,"props":1077,"children":1078},{"style":968},[1079],{"type":45,"value":991},{"type":39,"tag":573,"props":1081,"children":1082},{"style":580},[1083],{"type":45,"value":1084},"dtype float16 ",{"type":39,"tag":573,"props":1086,"children":1087},{"style":968},[1088],{"type":45,"value":991},{"type":39,"tag":573,"props":1090,"children":1091},{"style":580},[1092],{"type":45,"value":1093},"use_gpt_attention_plugin float16 ",{"type":39,"tag":573,"props":1095,"children":1096},{"style":968},[1097],{"type":45,"value":991},{"type":39,"tag":573,"props":1099,"children":1100},{"style":580},[1101],{"type":45,"value":1102},"use_gemm_plugin float16 ",{"type":39,"tag":573,"props":1104,"children":1105},{"style":968},[1106],{"type":45,"value":991},{"type":39,"tag":573,"props":1108,"children":1109},{"style":580},[1110],{"type":45,"value":1111},"use_weight_only ",{"type":39,"tag":573,"props":1113,"children":1114},{"style":968},[1115],{"type":45,"value":991},{"type":39,"tag":573,"props":1117,"children":1118},{"style":580},[1119],{"type":45,"value":1120},"weight_only_precision int4_awq ",{"type":39,"tag":573,"props":1122,"children":1123},{"style":968},[1124],{"type":45,"value":991},{"type":39,"tag":573,"props":1126,"children":1127},{"style":580},[1128],{"type":45,"value":1129},"per_group ",{"type":39,"tag":573,"props":1131,"children":1132},{"style":968},[1133],{"type":45,"value":991},{"type":39,"tag":573,"props":1135,"children":1136},{"style":580},[1137],{"type":45,"value":1138},"enable_context_fmha ",{"type":39,"tag":573,"props":1140,"children":1141},{"style":968},[1142],{"type":45,"value":991},{"type":39,"tag":573,"props":1144,"children":1145},{"style":580},[1146],{"type":45,"value":1147},"max_batch_size ",{"type":39,"tag":573,"props":1149,"children":1150},{"style":1003},[1151],{"type":45,"value":1152},"1",{"type":39,"tag":573,"props":1154,"children":1155},{"style":968},[1156],{"type":45,"value":1157}," --",{"type":39,"tag":573,"props":1159,"children":1160},{"style":580},[1161],{"type":45,"value":1162},"max_input_len ",{"type":39,"tag":573,"props":1164,"children":1165},{"style":1003},[1166],{"type":45,"value":1167},"3500",{"type":39,"tag":573,"props":1169,"children":1170},{"style":968},[1171],{"type":45,"value":1157},{"type":39,"tag":573,"props":1173,"children":1174},{"style":580},[1175],{"type":45,"value":1176},"max_output_len ",{"type":39,"tag":573,"props":1178,"children":1179},{"style":1003},[1180],{"type":45,"value":1181},"1024",{"type":39,"tag":573,"props":1183,"children":1184},{"style":968},[1185],{"type":45,"value":1157},{"type":39,"tag":573,"props":1187,"children":1188},{"style":580},[1189],{"type":45,"value":1190},"output_dir D:\\llama\\Llama",{"type":39,"tag":573,"props":1192,"children":1193},{"style":968},[1194],{"type":45,"value":971},{"type":39,"tag":573,"props":1196,"children":1197},{"style":1003},[1198],{"type":45,"value":1006},{"type":39,"tag":573,"props":1200,"children":1201},{"style":968},[1202],{"type":45,"value":971},{"type":39,"tag":573,"props":1204,"children":1205},{"style":580},[1206],{"type":45,"value":1015},{"type":39,"tag":573,"props":1208,"children":1209},{"style":968},[1210],{"type":45,"value":971},{"type":39,"tag":573,"props":1212,"children":1213},{"style":580},[1214],{"type":45,"value":1024},{"type":39,"tag":573,"props":1216,"children":1217},{"style":968},[1218],{"type":45,"value":971},{"type":39,"tag":573,"props":1220,"children":1221},{"style":580},[1222],{"type":45,"value":1223},"hf\\single",{"type":39,"tag":573,"props":1225,"children":1226},{"style":968},[1227],{"type":45,"value":971},{"type":39,"tag":573,"props":1229,"children":1230},{"style":580},[1231],{"type":45,"value":1232},"gpu\\ ",{"type":39,"tag":573,"props":1234,"children":1235},{"style":968},[1236],{"type":45,"value":991},{"type":39,"tag":573,"props":1238,"children":1239},{"style":580},[1240],{"type":45,"value":1241},"vocab_size ",{"type":39,"tag":573,"props":1243,"children":1244},{"style":1003},[1245],{"type":45,"value":1246},"32064\n",{"type":39,"tag":931,"props":1248,"children":1250},{"id":1249},"running-the-tensorrt-llm-engines",[1251],{"type":45,"value":1252},"Running the TensorRT-LLM engines",{"type":39,"tag":48,"props":1254,"children":1255},{},[1256],{"type":45,"value":1257},"Using Windows PowerShell to start the CodeLlama server for Continue.dev:",{"type":39,"tag":563,"props":1259,"children":1261},{"code":1260,"language":952,"meta":8,"className":953,"style":8},"(.venv) PS C:\\Users\\My PC\\GitHub\\trt-llm-as-openai-windows> python .\\app.py --trt_engine_path \"D:\\llama\\CodeLlama-13b-Instruct-hf\\trt_engines\\1-gpu\\\" --trt_engine_name llama_float16_tp1_rank0.engine --tokenizer_dir_path \"D:\\llama\\CodeLlama-13b-Instruct-hf\\\" --port 5000 --host 0.0.0.0\n",[1262],{"type":39,"tag":339,"props":1263,"children":1264},{"__ignoreMap":8},[1265],{"type":39,"tag":573,"props":1266,"children":1267},{"class":575,"line":576},[1268,1273,1277,1281,1285,1290,1294,1299,1303,1307,1311,1316,1320,1325,1330,1334,1339,1343,1348,1353,1357,1362,1367,1371,1376,1381,1385],{"type":39,"tag":573,"props":1269,"children":1270},{"style":580},[1271],{"type":45,"value":1272},"(.venv) PS C:\\Users\\My PC\\GitHub\\trt",{"type":39,"tag":573,"props":1274,"children":1275},{"style":968},[1276],{"type":45,"value":971},{"type":39,"tag":573,"props":1278,"children":1279},{"style":580},[1280],{"type":45,"value":19},{"type":39,"tag":573,"props":1282,"children":1283},{"style":968},[1284],{"type":45,"value":971},{"type":39,"tag":573,"props":1286,"children":1287},{"style":580},[1288],{"type":45,"value":1289},"as",{"type":39,"tag":573,"props":1291,"children":1292},{"style":968},[1293],{"type":45,"value":971},{"type":39,"tag":573,"props":1295,"children":1296},{"style":580},[1297],{"type":45,"value":1298},"openai",{"type":39,"tag":573,"props":1300,"children":1301},{"style":968},[1302],{"type":45,"value":971},{"type":39,"tag":573,"props":1304,"children":1305},{"style":580},[1306],{"type":45,"value":23},{"type":39,"tag":573,"props":1308,"children":1309},{"style":968},[1310],{"type":45,"value":981},{"type":39,"tag":573,"props":1312,"children":1313},{"style":580},[1314],{"type":45,"value":1315}," python .\\app.py ",{"type":39,"tag":573,"props":1317,"children":1318},{"style":968},[1319],{"type":45,"value":991},{"type":39,"tag":573,"props":1321,"children":1322},{"style":580},[1323],{"type":45,"value":1324},"trt_engine_path ",{"type":39,"tag":573,"props":1326,"children":1327},{"style":783},[1328],{"type":45,"value":1329},"\"D:\\llama\\CodeLlama-13b-Instruct-hf\\trt_engines\\1-gpu\\\"",{"type":39,"tag":573,"props":1331,"children":1332},{"style":968},[1333],{"type":45,"value":1157},{"type":39,"tag":573,"props":1335,"children":1336},{"style":580},[1337],{"type":45,"value":1338},"trt_engine_name llama_float16_tp1_rank0.engine ",{"type":39,"tag":573,"props":1340,"children":1341},{"style":968},[1342],{"type":45,"value":991},{"type":39,"tag":573,"props":1344,"children":1345},{"style":580},[1346],{"type":45,"value":1347},"tokenizer_dir_path ",{"type":39,"tag":573,"props":1349,"children":1350},{"style":783},[1351],{"type":45,"value":1352},"\"D:\\llama\\CodeLlama-13b-Instruct-hf\\\"",{"type":39,"tag":573,"props":1354,"children":1355},{"style":968},[1356],{"type":45,"value":1157},{"type":39,"tag":573,"props":1358,"children":1359},{"style":580},[1360],{"type":45,"value":1361},"port ",{"type":39,"tag":573,"props":1363,"children":1364},{"style":1003},[1365],{"type":45,"value":1366},"5000",{"type":39,"tag":573,"props":1368,"children":1369},{"style":968},[1370],{"type":45,"value":1157},{"type":39,"tag":573,"props":1372,"children":1373},{"style":580},[1374],{"type":45,"value":1375},"host ",{"type":39,"tag":573,"props":1377,"children":1378},{"style":1003},[1379],{"type":45,"value":1380},"0.0",{"type":39,"tag":573,"props":1382,"children":1383},{"style":580},[1384],{"type":45,"value":183},{"type":39,"tag":573,"props":1386,"children":1387},{"style":1003},[1388],{"type":45,"value":1389},"0.0\n",{"type":39,"tag":48,"props":1391,"children":1392},{},[1393,1395,1401],{"type":45,"value":1394},"Tip: Adding ",{"type":39,"tag":339,"props":1396,"children":1398},{"className":1397},[],[1399],{"type":45,"value":1400},"--host 0.0.0.0",{"type":45,"value":1402}," isn't required here, but it allows me to use the CodeLlama/TensorRT-LLM server with VSCode any computer on my local network using my PC's local IP address in the Continue.dev configuration.",{"type":39,"tag":48,"props":1404,"children":1405},{},[1406],{"type":45,"value":1407},"Using docker in WSL to start the Llama-2-13b-chat-hf LLM server:",{"type":39,"tag":563,"props":1409,"children":1411},{"code":1410},"root@0a5b5b75f079:/code/git/TensorRT-LLM/examples/server/flask# python3 app.py --trt_engine_path /llama/Llama-2-13b-chat-hf/trt_engines/1-gpu/ --trt_engine_name  llama_float16_t_rank0.engine --tokenizer_dir_path /llama/Llama-2-13b-chat-hf/ --port 5001 --host 0.0.0.0\n",[1412],{"type":39,"tag":339,"props":1413,"children":1414},{"__ignoreMap":8},[1415],{"type":45,"value":1410},{"type":39,"tag":48,"props":1417,"children":1418},{},[1419,1421,1426],{"type":45,"value":1420},"Note: Here I also add ",{"type":39,"tag":339,"props":1422,"children":1424},{"className":1423},[],[1425],{"type":45,"value":1400},{"type":45,"value":1427},", but this is required in order for the service in the docker container to be reached from WSL by the game running on Windows.",{"type":39,"tag":48,"props":1429,"children":1430},{},[1431],{"type":45,"value":1432},"BakkesMod includes a console window that came in handy for debugging errors during development.",{"type":39,"tag":48,"props":1434,"children":1435},{},[1436],{"type":45,"value":1437},"At the beginning of this developer contest on January 9, NVIDIA announced Chat with RTX. This is a demo program for Windows that automates a lots of the processes needed to set up a TensorRT-LLM-powered LLM running on your PC. Keep an eye on this project as it may become the best way to install and manage large language models on Windows PCs.",{"type":39,"tag":48,"props":1439,"children":1440},{},[1441],{"type":39,"tag":227,"props":1442,"children":1445},{"alt":1443,"src":1444},"Chat with RTX image","/static/rlbc/chat_with_rtx.jpeg",[],{"type":39,"tag":40,"props":1447,"children":1449},{"id":1448},"how-it-works",[1450],{"type":45,"value":1451},"How it works",{"type":39,"tag":48,"props":1453,"children":1454},{},[1455,1457,1462],{"type":45,"value":1456},"Here's a quick look at key parts of the plugin source code (",{"type":39,"tag":85,"props":1458,"children":1460},{"href":176,"rel":1459},[178],[1461],{"type":45,"value":176},{"type":45,"value":1463},").",{"type":39,"tag":931,"props":1465,"children":1467},{"id":1466},"hooking-events",[1468],{"type":45,"value":1469},"Hooking events",{"type":39,"tag":48,"props":1471,"children":1472},{},[1473,1475,1481],{"type":45,"value":1474},"Hooking events is the core of how this plugin works. ",{"type":39,"tag":339,"props":1476,"children":1478},{"className":1477},[],[1479],{"type":45,"value":1480},"StatTickerMessage",{"type":45,"value":1482}," events cover most of the events that are triggered in Rocket League, such as scoring a goal, making a save or demolishing a car.",{"type":39,"tag":563,"props":1484,"children":1486},{"code":1485,"language":756,"meta":8,"className":757,"style":8},"    // Hooks different types of events that are handled in onStatTickerMessage\n    // See https://wiki.bakkesplugins.com/functions/stat_events/\n    gameWrapper->HookEventWithCallerPost\u003CServerWrapper>(\"Function TAGame.GFxHUD_TA.HandleStatTickerMessage\",\n        [this](ServerWrapper caller, void* params, std::string eventname) {\n            onStatTickerMessage(params);\n        });\n",[1487],{"type":39,"tag":339,"props":1488,"children":1489},{"__ignoreMap":8},[1490,1499,1507,1543,1623,1636],{"type":39,"tag":573,"props":1491,"children":1492},{"class":575,"line":576},[1493],{"type":39,"tag":573,"props":1494,"children":1496},{"style":1495},"--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F",[1497],{"type":45,"value":1498},"    // Hooks different types of events that are handled in onStatTickerMessage\n",{"type":39,"tag":573,"props":1500,"children":1501},{"class":575,"line":586},[1502],{"type":39,"tag":573,"props":1503,"children":1504},{"style":1495},[1505],{"type":45,"value":1506},"    // See https://wiki.bakkesplugins.com/functions/stat_events/\n",{"type":39,"tag":573,"props":1508,"children":1509},{"class":575,"line":612},[1510,1515,1520,1525,1529,1534,1539],{"type":39,"tag":573,"props":1511,"children":1512},{"style":580},[1513],{"type":45,"value":1514},"    gameWrapper->HookEventWithCallerPost",{"type":39,"tag":573,"props":1516,"children":1517},{"style":968},[1518],{"type":45,"value":1519},"\u003C",{"type":39,"tag":573,"props":1521,"children":1522},{"style":580},[1523],{"type":45,"value":1524},"ServerWrapper",{"type":39,"tag":573,"props":1526,"children":1527},{"style":968},[1528],{"type":45,"value":981},{"type":39,"tag":573,"props":1530,"children":1531},{"style":580},[1532],{"type":45,"value":1533},"(",{"type":39,"tag":573,"props":1535,"children":1536},{"style":783},[1537],{"type":45,"value":1538},"\"Function TAGame.GFxHUD_TA.HandleStatTickerMessage\"",{"type":39,"tag":573,"props":1540,"children":1541},{"style":580},[1542],{"type":45,"value":609},{"type":39,"tag":573,"props":1544,"children":1545},{"class":575,"line":634},[1546,1551,1557,1562,1567,1573,1578,1584,1589,1594,1598,1603,1608,1613,1618],{"type":39,"tag":573,"props":1547,"children":1548},{"style":580},[1549],{"type":45,"value":1550},"        [",{"type":39,"tag":573,"props":1552,"children":1554},{"style":1553},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1555],{"type":45,"value":1556},"this",{"type":39,"tag":573,"props":1558,"children":1559},{"style":580},[1560],{"type":45,"value":1561},"](",{"type":39,"tag":573,"props":1563,"children":1565},{"style":1564},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[1566],{"type":45,"value":1524},{"type":39,"tag":573,"props":1568,"children":1570},{"style":1569},"--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1571],{"type":45,"value":1572}," caller",{"type":39,"tag":573,"props":1574,"children":1575},{"style":580},[1576],{"type":45,"value":1577},", ",{"type":39,"tag":573,"props":1579,"children":1581},{"style":1580},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1582],{"type":45,"value":1583},"void",{"type":39,"tag":573,"props":1585,"children":1586},{"style":968},[1587],{"type":45,"value":1588},"*",{"type":39,"tag":573,"props":1590,"children":1591},{"style":1569},[1592],{"type":45,"value":1593}," params",{"type":39,"tag":573,"props":1595,"children":1596},{"style":580},[1597],{"type":45,"value":1577},{"type":39,"tag":573,"props":1599,"children":1600},{"style":1564},[1601],{"type":45,"value":1602},"std",{"type":39,"tag":573,"props":1604,"children":1605},{"style":580},[1606],{"type":45,"value":1607},"::",{"type":39,"tag":573,"props":1609,"children":1610},{"style":1564},[1611],{"type":45,"value":1612},"string",{"type":39,"tag":573,"props":1614,"children":1615},{"style":1569},[1616],{"type":45,"value":1617}," eventname",{"type":39,"tag":573,"props":1619,"children":1620},{"style":580},[1621],{"type":45,"value":1622},") {\n",{"type":39,"tag":573,"props":1624,"children":1625},{"class":575,"line":656},[1626,1631],{"type":39,"tag":573,"props":1627,"children":1628},{"style":772},[1629],{"type":45,"value":1630},"            onStatTickerMessage",{"type":39,"tag":573,"props":1632,"children":1633},{"style":580},[1634],{"type":45,"value":1635},"(params);\n",{"type":39,"tag":573,"props":1637,"children":1638},{"class":575,"line":678},[1639],{"type":39,"tag":573,"props":1640,"children":1641},{"style":580},[1642],{"type":45,"value":1643},"        });\n",{"type":39,"tag":931,"props":1645,"children":1647},{"id":1646},"handling-events-and-building-the-prompt",[1648],{"type":45,"value":1649},"Handling events and building the prompt",{"type":39,"tag":48,"props":1651,"children":1652},{},[1653,1655,1661],{"type":45,"value":1654},"We can unpack values from the event to determine the player to which the event should be attributed. The code then translates the game event and related data into an English sentence. This is appended to a vector of message objects with the ",{"type":39,"tag":339,"props":1656,"children":1658},{"className":1657},[],[1659],{"type":45,"value":1660},"appendToPrompt",{"type":45,"value":1662}," method.",{"type":39,"tag":563,"props":1664,"children":1666},{"code":1665,"language":756,"meta":8,"className":757,"style":8},"    // handle different events like scoring a goal or making a save\n    if (statEvent.GetEventName() == \"Goal\") {\n\n        // was the goal scored by the human player or the bot?\n        if (playerPRI.memory_address == receiver.memory_address) {\n            appendToPrompt(\"Your human opponent just scored a goal against you! \" + score_sentence, \"user\");\n        }\n        else {\n            appendToPrompt(\"You just scored a goal against the human player! \" + score_sentence, \"user\");\n        }\n    }\n",[1667],{"type":39,"tag":339,"props":1668,"children":1669},{"__ignoreMap":8},[1670,1678,1715,1723,1731,1753,1790,1798,1812,1845,1853],{"type":39,"tag":573,"props":1671,"children":1672},{"class":575,"line":576},[1673],{"type":39,"tag":573,"props":1674,"children":1675},{"style":1495},[1676],{"type":45,"value":1677},"    // handle different events like scoring a goal or making a save\n",{"type":39,"tag":573,"props":1679,"children":1680},{"class":575,"line":586},[1681,1686,1691,1696,1701,1706,1711],{"type":39,"tag":573,"props":1682,"children":1683},{"style":968},[1684],{"type":45,"value":1685},"    if",{"type":39,"tag":573,"props":1687,"children":1688},{"style":580},[1689],{"type":45,"value":1690}," (statEvent.",{"type":39,"tag":573,"props":1692,"children":1693},{"style":772},[1694],{"type":45,"value":1695},"GetEventName",{"type":39,"tag":573,"props":1697,"children":1698},{"style":580},[1699],{"type":45,"value":1700},"() ",{"type":39,"tag":573,"props":1702,"children":1703},{"style":968},[1704],{"type":45,"value":1705},"==",{"type":39,"tag":573,"props":1707,"children":1708},{"style":783},[1709],{"type":45,"value":1710}," \"Goal\"",{"type":39,"tag":573,"props":1712,"children":1713},{"style":580},[1714],{"type":45,"value":1622},{"type":39,"tag":573,"props":1716,"children":1717},{"class":575,"line":612},[1718],{"type":39,"tag":573,"props":1719,"children":1720},{"emptyLinePlaceholder":34},[1721],{"type":45,"value":1722},"\n",{"type":39,"tag":573,"props":1724,"children":1725},{"class":575,"line":634},[1726],{"type":39,"tag":573,"props":1727,"children":1728},{"style":1495},[1729],{"type":45,"value":1730},"        // was the goal scored by the human player or the bot?\n",{"type":39,"tag":573,"props":1732,"children":1733},{"class":575,"line":656},[1734,1739,1744,1748],{"type":39,"tag":573,"props":1735,"children":1736},{"style":968},[1737],{"type":45,"value":1738},"        if",{"type":39,"tag":573,"props":1740,"children":1741},{"style":580},[1742],{"type":45,"value":1743}," (playerPRI.memory_address ",{"type":39,"tag":573,"props":1745,"children":1746},{"style":968},[1747],{"type":45,"value":1705},{"type":39,"tag":573,"props":1749,"children":1750},{"style":580},[1751],{"type":45,"value":1752}," receiver.memory_address) {\n",{"type":39,"tag":573,"props":1754,"children":1755},{"class":575,"line":678},[1756,1761,1765,1770,1775,1780,1785],{"type":39,"tag":573,"props":1757,"children":1758},{"style":772},[1759],{"type":45,"value":1760},"            appendToPrompt",{"type":39,"tag":573,"props":1762,"children":1763},{"style":580},[1764],{"type":45,"value":1533},{"type":39,"tag":573,"props":1766,"children":1767},{"style":783},[1768],{"type":45,"value":1769},"\"Your human opponent just scored a goal against you! \"",{"type":39,"tag":573,"props":1771,"children":1772},{"style":968},[1773],{"type":45,"value":1774}," +",{"type":39,"tag":573,"props":1776,"children":1777},{"style":580},[1778],{"type":45,"value":1779}," score_sentence, ",{"type":39,"tag":573,"props":1781,"children":1782},{"style":783},[1783],{"type":45,"value":1784},"\"user\"",{"type":39,"tag":573,"props":1786,"children":1787},{"style":580},[1788],{"type":45,"value":1789},");\n",{"type":39,"tag":573,"props":1791,"children":1792},{"class":575,"line":696},[1793],{"type":39,"tag":573,"props":1794,"children":1795},{"style":580},[1796],{"type":45,"value":1797},"        }\n",{"type":39,"tag":573,"props":1799,"children":1801},{"class":575,"line":1800},8,[1802,1807],{"type":39,"tag":573,"props":1803,"children":1804},{"style":968},[1805],{"type":45,"value":1806},"        else",{"type":39,"tag":573,"props":1808,"children":1809},{"style":580},[1810],{"type":45,"value":1811}," {\n",{"type":39,"tag":573,"props":1813,"children":1815},{"class":575,"line":1814},9,[1816,1820,1824,1829,1833,1837,1841],{"type":39,"tag":573,"props":1817,"children":1818},{"style":772},[1819],{"type":45,"value":1760},{"type":39,"tag":573,"props":1821,"children":1822},{"style":580},[1823],{"type":45,"value":1533},{"type":39,"tag":573,"props":1825,"children":1826},{"style":783},[1827],{"type":45,"value":1828},"\"You just scored a goal against the human player! \"",{"type":39,"tag":573,"props":1830,"children":1831},{"style":968},[1832],{"type":45,"value":1774},{"type":39,"tag":573,"props":1834,"children":1835},{"style":580},[1836],{"type":45,"value":1779},{"type":39,"tag":573,"props":1838,"children":1839},{"style":783},[1840],{"type":45,"value":1784},{"type":39,"tag":573,"props":1842,"children":1843},{"style":580},[1844],{"type":45,"value":1789},{"type":39,"tag":573,"props":1846,"children":1848},{"class":575,"line":1847},10,[1849],{"type":39,"tag":573,"props":1850,"children":1851},{"style":580},[1852],{"type":45,"value":1797},{"type":39,"tag":573,"props":1854,"children":1856},{"class":575,"line":1855},11,[1857],{"type":39,"tag":573,"props":1858,"children":1859},{"style":580},[1860],{"type":45,"value":1861},"    }\n",{"type":39,"tag":931,"props":1863,"children":1865},{"id":1864},"making-requests-and-handling-responses",[1866],{"type":45,"value":1867},"Making requests and handling responses",{"type":39,"tag":48,"props":1869,"children":1870},{},[1871],{"type":45,"value":1872},"The last main part of the code is making a request to the LLM server with the prompt that we have formed above based on game messages. This code should look familiar to anyone who has worked with OpenAI's API.",{"type":39,"tag":563,"props":1874,"children":1876},{"code":1875,"language":756,"meta":8,"className":757,"style":8},"std::string message = response_json[\"choices\"][0][\"message\"][\"content\"];\n",[1877],{"type":39,"tag":339,"props":1878,"children":1879},{"__ignoreMap":8},[1880],{"type":39,"tag":573,"props":1881,"children":1882},{"class":575,"line":576},[1883,1887,1892,1897,1902,1907,1912,1917,1921,1926,1930,1934],{"type":39,"tag":573,"props":1884,"children":1885},{"style":1564},[1886],{"type":45,"value":1602},{"type":39,"tag":573,"props":1888,"children":1889},{"style":580},[1890],{"type":45,"value":1891},"::string message ",{"type":39,"tag":573,"props":1893,"children":1894},{"style":968},[1895],{"type":45,"value":1896},"=",{"type":39,"tag":573,"props":1898,"children":1899},{"style":580},[1900],{"type":45,"value":1901}," response_json[",{"type":39,"tag":573,"props":1903,"children":1904},{"style":783},[1905],{"type":45,"value":1906},"\"choices\"",{"type":39,"tag":573,"props":1908,"children":1909},{"style":580},[1910],{"type":45,"value":1911},"][",{"type":39,"tag":573,"props":1913,"children":1914},{"style":1003},[1915],{"type":45,"value":1916},"0",{"type":39,"tag":573,"props":1918,"children":1919},{"style":580},[1920],{"type":45,"value":1911},{"type":39,"tag":573,"props":1922,"children":1923},{"style":783},[1924],{"type":45,"value":1925},"\"message\"",{"type":39,"tag":573,"props":1927,"children":1928},{"style":580},[1929],{"type":45,"value":1911},{"type":39,"tag":573,"props":1931,"children":1932},{"style":783},[1933],{"type":45,"value":796},{"type":39,"tag":573,"props":1935,"children":1936},{"style":580},[1937],{"type":45,"value":1938},"];\n",{"type":39,"tag":48,"props":1940,"children":1941},{},[1942,1944,1950],{"type":45,"value":1943},"The ",{"type":39,"tag":339,"props":1945,"children":1947},{"className":1946},[],[1948],{"type":45,"value":1949},"LogToChatbox",{"type":45,"value":1951}," method is used to send a message to the in-game chat box with the name of the bot that is sending the message. Since messages could possibly be longer than the limit of 120 characters, I send messages to the chatbox in chunks of 120 characters at a time.",{"type":39,"tag":563,"props":1953,"children":1955},{"code":1954,"language":756,"meta":8,"className":757,"style":8},"gameWrapper->LogToChatbox(messages[i], this->bot_name);\n",[1956],{"type":39,"tag":339,"props":1957,"children":1958},{"__ignoreMap":8},[1959],{"type":39,"tag":573,"props":1960,"children":1961},{"class":575,"line":576},[1962,1967,1971,1976,1980],{"type":39,"tag":573,"props":1963,"children":1964},{"style":580},[1965],{"type":45,"value":1966},"gameWrapper->",{"type":39,"tag":573,"props":1968,"children":1969},{"style":772},[1970],{"type":45,"value":1949},{"type":39,"tag":573,"props":1972,"children":1973},{"style":580},[1974],{"type":45,"value":1975},"(messages[i], ",{"type":39,"tag":573,"props":1977,"children":1978},{"style":1553},[1979],{"type":45,"value":1556},{"type":39,"tag":573,"props":1981,"children":1982},{"style":580},[1983],{"type":45,"value":1984},"->bot_name);\n",{"type":39,"tag":48,"props":1986,"children":1987},{},[1988,1990,1996],{"type":45,"value":1989},"That's it! The code isn't that complicated. I had to sanitize the message so that it would not include emoji or the stop character that the LLM server would include in messages (",{"type":39,"tag":339,"props":1991,"children":1993},{"className":1992},[],[1994],{"type":45,"value":1995},"\u003C/s>",{"type":45,"value":1997},"). Oddly, I had a hard time getting the LLM to not use emoji even when I instructed it to not use emoji in the system prompt.",{"type":39,"tag":40,"props":1999,"children":2001},{"id":2000},"rocket-league-botchat-ui",[2002],{"type":45,"value":2003},"Rocket League BotChat UI",{"type":39,"tag":48,"props":2005,"children":2006},{},[2007],{"type":45,"value":2008},"Most BakkesMod plugins for RocketLeague UIs that allow for controlling settings. Here's what the UI for Rocket League BotChat looks like:",{"type":39,"tag":48,"props":2010,"children":2011},{},[2012],{"type":39,"tag":227,"props":2013,"children":2016},{"alt":2014,"src":2015},"Rocket League BotChat Plugin UI","/static/rlbc/rlbcui.png",[],{"type":39,"tag":931,"props":2018,"children":2020},{"id":2019},"system-prompt",[2021],{"type":45,"value":2022},"System prompt",{"type":39,"tag":48,"props":2024,"children":2025},{},[2026],{"type":45,"value":2027},"The system prompt instructs the bot on how it shoud reply. This is an important part of the prompt engineering for this project, and I used Postman to experiment with lots of different types of instructions. Here's the default prompt that I used:",{"type":39,"tag":563,"props":2029,"children":2031},{"code":2030,"language":756,"meta":8,"className":757,"style":8},"    std::string ai_player = \"You are an elite AI player in the car soccer game Rocket League. \";\n    std::string one_v_one = \"You are playing a 1v1 match against a human player. \";\n    std::string instructions = \"You will send short chat messages to your human opponent in response to what happens in the game. \";\n    std::string details = \"Respond to the human player with brief messages no more than 12 words long.\";\n    // initial system prompt\n    std::string initial_system_prompt = ai_player + one_v_one + instructions + details;\n",[2032],{"type":39,"tag":339,"props":2033,"children":2034},{"__ignoreMap":8},[2035,2062,2087,2112,2137,2145],{"type":39,"tag":573,"props":2036,"children":2037},{"class":575,"line":576},[2038,2043,2048,2052,2057],{"type":39,"tag":573,"props":2039,"children":2040},{"style":1564},[2041],{"type":45,"value":2042},"    std",{"type":39,"tag":573,"props":2044,"children":2045},{"style":580},[2046],{"type":45,"value":2047},"::string ai_player ",{"type":39,"tag":573,"props":2049,"children":2050},{"style":968},[2051],{"type":45,"value":1896},{"type":39,"tag":573,"props":2053,"children":2054},{"style":783},[2055],{"type":45,"value":2056}," \"You are an elite AI player in the car soccer game Rocket League. \"",{"type":39,"tag":573,"props":2058,"children":2059},{"style":580},[2060],{"type":45,"value":2061},";\n",{"type":39,"tag":573,"props":2063,"children":2064},{"class":575,"line":586},[2065,2069,2074,2078,2083],{"type":39,"tag":573,"props":2066,"children":2067},{"style":1564},[2068],{"type":45,"value":2042},{"type":39,"tag":573,"props":2070,"children":2071},{"style":580},[2072],{"type":45,"value":2073},"::string one_v_one ",{"type":39,"tag":573,"props":2075,"children":2076},{"style":968},[2077],{"type":45,"value":1896},{"type":39,"tag":573,"props":2079,"children":2080},{"style":783},[2081],{"type":45,"value":2082}," \"You are playing a 1v1 match against a human player. \"",{"type":39,"tag":573,"props":2084,"children":2085},{"style":580},[2086],{"type":45,"value":2061},{"type":39,"tag":573,"props":2088,"children":2089},{"class":575,"line":612},[2090,2094,2099,2103,2108],{"type":39,"tag":573,"props":2091,"children":2092},{"style":1564},[2093],{"type":45,"value":2042},{"type":39,"tag":573,"props":2095,"children":2096},{"style":580},[2097],{"type":45,"value":2098},"::string instructions ",{"type":39,"tag":573,"props":2100,"children":2101},{"style":968},[2102],{"type":45,"value":1896},{"type":39,"tag":573,"props":2104,"children":2105},{"style":783},[2106],{"type":45,"value":2107}," \"You will send short chat messages to your human opponent in response to what happens in the game. \"",{"type":39,"tag":573,"props":2109,"children":2110},{"style":580},[2111],{"type":45,"value":2061},{"type":39,"tag":573,"props":2113,"children":2114},{"class":575,"line":634},[2115,2119,2124,2128,2133],{"type":39,"tag":573,"props":2116,"children":2117},{"style":1564},[2118],{"type":45,"value":2042},{"type":39,"tag":573,"props":2120,"children":2121},{"style":580},[2122],{"type":45,"value":2123},"::string details ",{"type":39,"tag":573,"props":2125,"children":2126},{"style":968},[2127],{"type":45,"value":1896},{"type":39,"tag":573,"props":2129,"children":2130},{"style":783},[2131],{"type":45,"value":2132}," \"Respond to the human player with brief messages no more than 12 words long.\"",{"type":39,"tag":573,"props":2134,"children":2135},{"style":580},[2136],{"type":45,"value":2061},{"type":39,"tag":573,"props":2138,"children":2139},{"class":575,"line":656},[2140],{"type":39,"tag":573,"props":2141,"children":2142},{"style":1495},[2143],{"type":45,"value":2144},"    // initial system prompt\n",{"type":39,"tag":573,"props":2146,"children":2147},{"class":575,"line":678},[2148,2152,2157,2161,2166,2170,2175,2179,2184,2188],{"type":39,"tag":573,"props":2149,"children":2150},{"style":1564},[2151],{"type":45,"value":2042},{"type":39,"tag":573,"props":2153,"children":2154},{"style":580},[2155],{"type":45,"value":2156},"::string initial_system_prompt ",{"type":39,"tag":573,"props":2158,"children":2159},{"style":968},[2160],{"type":45,"value":1896},{"type":39,"tag":573,"props":2162,"children":2163},{"style":580},[2164],{"type":45,"value":2165}," ai_player ",{"type":39,"tag":573,"props":2167,"children":2168},{"style":968},[2169],{"type":45,"value":889},{"type":39,"tag":573,"props":2171,"children":2172},{"style":580},[2173],{"type":45,"value":2174}," one_v_one ",{"type":39,"tag":573,"props":2176,"children":2177},{"style":968},[2178],{"type":45,"value":889},{"type":39,"tag":573,"props":2180,"children":2181},{"style":580},[2182],{"type":45,"value":2183}," instructions ",{"type":39,"tag":573,"props":2185,"children":2186},{"style":968},[2187],{"type":45,"value":889},{"type":39,"tag":573,"props":2189,"children":2190},{"style":580},[2191],{"type":45,"value":2192}," details;\n",{"type":39,"tag":48,"props":2194,"children":2195},{},[2196,2198,2204,2206,2212],{"type":45,"value":2197},"The last part about ",{"type":39,"tag":339,"props":2199,"children":2201},{"className":2200},[],[2202],{"type":45,"value":2203},"no more than 12 words long",{"type":45,"value":2205}," was the most effective way of controlling the length responses from the LLM. I tried changing the ",{"type":39,"tag":339,"props":2207,"children":2209},{"className":2208},[],[2210],{"type":45,"value":2211},"max_output_len",{"type":45,"value":2213}," when building the TensorRT engine, but this degraded the quality of the responses. The system prompt can be changed by the user. Changing the system prompt was a lot of fun to expirment with!",{"type":39,"tag":931,"props":2215,"children":2217},{"id":2216},"temperature-and-seed",[2218],{"type":45,"value":2219},"Temperature and Seed",{"type":39,"tag":48,"props":2221,"children":2222},{},[2223],{"type":45,"value":2224},"These values are included in the body of the request to the LLM, but I didn't have much luck with these. Early on I had issues with getting sufficient variation in the responses from the LLM, so I tried using random values for seed and temperature, but this didn't really work.",{"type":39,"tag":931,"props":2226,"children":2227},{"id":750},[2228],{"type":45,"value":2229},"Messages",{"type":39,"tag":48,"props":2231,"children":2232},{},[2233],{"type":45,"value":2234},"This section of the UI displays the messages that are used in requests to the LLM. In order keep the prompt within the context window limit, I only used the most recent six messages sent from the \"user\" (which are messages about game events) and the \"assistant\" (which are LLM responses from the bot). Whenever the user changes the system prompt, the messages vector is reset to only include the new system prompt.",{"type":39,"tag":40,"props":2236,"children":2238},{"id":2237},"demo-video-for-contest-submission",[2239],{"type":45,"value":2240},"Demo Video for Contest Submission",{"type":39,"tag":59,"props":2242,"children":2245},{"className":2243,"dataMediaMaxWidth":2244},[62,63],"560",[2246,2307,2308],{"type":39,"tag":48,"props":2247,"children":2248},{"lang":68,"dir":69},[2249,2250,2253,2254,2257,2258,2262,2263,2267,2268,2272,2273,2277,2278,2282,2283,2287,2288,2292,2293,2297,2298,2302,2303],{"type":45,"value":72},{"type":39,"tag":74,"props":2251,"children":2252},{},[],{"type":45,"value":78},{"type":39,"tag":74,"props":2255,"children":2256},{},[],{"type":45,"value":83},{"type":39,"tag":85,"props":2259,"children":2260},{"href":87},[2261],{"type":45,"value":90},{"type":45,"value":92},{"type":39,"tag":85,"props":2264,"children":2265},{"href":95},[2266],{"type":45,"value":98},{"type":45,"value":92},{"type":39,"tag":85,"props":2269,"children":2270},{"href":102},[2271],{"type":45,"value":105},{"type":45,"value":92},{"type":39,"tag":85,"props":2274,"children":2275},{"href":109},[2276],{"type":45,"value":112},{"type":45,"value":92},{"type":39,"tag":85,"props":2279,"children":2280},{"href":116},[2281],{"type":45,"value":119},{"type":45,"value":92},{"type":39,"tag":85,"props":2284,"children":2285},{"href":123},[2286],{"type":45,"value":126},{"type":45,"value":92},{"type":39,"tag":85,"props":2289,"children":2290},{"href":130},[2291],{"type":45,"value":133},{"type":45,"value":92},{"type":39,"tag":85,"props":2294,"children":2295},{"href":137},[2296],{"type":45,"value":140},{"type":45,"value":92},{"type":39,"tag":85,"props":2299,"children":2300},{"href":144},[2301],{"type":45,"value":147},{"type":45,"value":92},{"type":39,"tag":85,"props":2304,"children":2305},{"href":151},[2306],{"type":45,"value":154},{"type":45,"value":156},{"type":39,"tag":85,"props":2309,"children":2310},{"href":159},[2311],{"type":45,"value":162},{"type":39,"tag":164,"props":2313,"children":2314},{"async":34,"src":166,"charSet":167},[],{"type":39,"tag":48,"props":2316,"children":2317},{},[2318],{"type":45,"value":2319},"I used Blender's sequence editor to create a demo video for my contest submission. I don't edit a lot of videos, but it is a fun process and I learned a lot about Blender and non-linear video editing in the process. Here's how I approached creating the demo video for my project.",{"type":39,"tag":48,"props":2321,"children":2322},{},[2323],{"type":39,"tag":227,"props":2324,"children":2327},{"alt":2325,"src":2326},"Blender video sequence editor UI used to create my project video","/static/rlbc/blender.png",[],{"type":39,"tag":312,"props":2329,"children":2330},{},[2331,2336,2348,2370,2375],{"type":39,"tag":316,"props":2332,"children":2333},{},[2334],{"type":45,"value":2335},"Structure the video in three main parts: introduction to my project and the contest, description of how it works, demo of my project in action",{"type":39,"tag":316,"props":2337,"children":2338},{},[2339,2341],{"type":45,"value":2340},"Find an upbeat song from playlists included in Rocket League with no vocals to use as background music. I used ",{"type":39,"tag":85,"props":2342,"children":2345},{"href":2343,"rel":2344},"https://open.spotify.com/track/68ahXxPJrxcEvQFjRmC2ja?si=2147d6d652064d51",[178],[2346],{"type":45,"value":2347},"\"Dads in Space\" by Steven Walking",{"type":39,"tag":316,"props":2349,"children":2350},{},[2351,2353,2359,2361,2368],{"type":45,"value":2352},"Get stock Rocket League footage from YouTube with ",{"type":39,"tag":339,"props":2354,"children":2356},{"className":2355},[],[2357],{"type":45,"value":2358},"youtube-dl",{"type":45,"value":2360}," (this is an amazing tool!). I mostly used footage from the ",{"type":39,"tag":85,"props":2362,"children":2365},{"href":2363,"rel":2364},"https://www.youtube.com/watch?v=e1tqWldCYOI&pp=ygUQcmxjcyB3aW50ZXIgMjAyMw%3D%3D",[178],[2366],{"type":45,"value":2367},"RLCS 2023 Winter Major Trailer",{"type":45,"value":2369},". This video was uploaded at 24 fps, and my Blender Video project frame rate was set to 29.97, so I used ffmpeg to convert this video from 24 fps to 29.97 fps.",{"type":39,"tag":316,"props":2371,"children":2372},{},[2373],{"type":45,"value":2374},"Record myself playing Rocket League with my plugin enabled using NVIDIA Share. Miraculously, I was able to score against the Nexto bot!",{"type":39,"tag":316,"props":2376,"children":2377},{},[2378],{"type":45,"value":2379},"Use ComfyUI to animate some of the images used in the contest description and use these in my video",{"type":39,"tag":48,"props":2381,"children":2382},{},[2383],{"type":39,"tag":227,"props":2384,"children":2387},{"alt":2385,"src":2386},"ComfyUI workflow for animating images using img2vid model","/static/rlbc/comfyui.png",[],{"type":39,"tag":312,"props":2389,"children":2390},{},[2391],{"type":39,"tag":316,"props":2392,"children":2393},{},[2394],{"type":45,"value":2395},"Use ElevenLabs to narrate a simple voice over script that describes the video content. This tuned out a lot better than I expected. I paid $1 for the ElevenLabs creator plan and got lots of tokens to experiment with different settings for voice generation using a clone of my voice.",{"type":39,"tag":48,"props":2397,"children":2398},{},[2399],{"type":39,"tag":227,"props":2400,"children":2403},{"alt":2401,"src":2402},"Eleven Labs Voice Generation Web UI","/static/rlbc/elevenlabs.png",[],{"type":39,"tag":48,"props":2405,"children":2406},{},[2407],{"type":39,"tag":85,"props":2408,"children":2410},{"href":2409},"#",[2411],{"type":45,"value":2412},"Embed twitter video here",{"type":39,"tag":40,"props":2414,"children":2416},{"id":2415},"shortcomings-of-my-project",[2417],{"type":45,"value":2418},"Shortcomings of my project",{"type":39,"tag":48,"props":2420,"children":2421},{},[2422,2424,2429],{"type":45,"value":2423},"This plugin is a proof of concept and it has some shortcomings. One issue is that some events that my plugin listens to can happen in rapid succession. This results in \"user\" and \"assistant\" prompts getting out of order which breaks assertions on the ",{"type":39,"tag":339,"props":2425,"children":2427},{"className":2426},[],[2428],{"type":45,"value":554},{"type":45,"value":2430}," repo. It would make more sense to have the bot send messages not immediately after the events are triggered, but on a different type of schedule that allows for multiple events to happen before sending the prompt to the LLM.",{"type":39,"tag":48,"props":2432,"children":2433},{},[2434],{"type":45,"value":2435},"There are lots of events that are triggered that would be interesting things for the bot to react to, but I decided not to prompt on every event since the above situation would be triggered frequently. For example, suppose I listen for events like taking a shot on goal and scoring a goal. If the goal is scored immediately after the shot is taken, then the second prompt is sent before the response for the first prompt comes back. For this reason I decided to simply not listen to events like \"shot on goal\" to avoid prompt messages getting out of order. This could also be addressed with more code logic.",{"type":39,"tag":48,"props":2437,"children":2438},{},[2439],{"type":45,"value":2440},"Prompt engineering is something that can always be improved. It is hard to measure and testing it is subjective. I am pleased with the results I was able to capture for the demo video, but the quality of the LLM responses can very depending on what happens during gameplay. One idea I had to address this would be to provide multiple English translations for any given event, and then select one at random. This might help improve the variety of responses, for example.",{"type":39,"tag":48,"props":2442,"children":2443},{},[2444,2446,2452],{"type":45,"value":2445},"I faced some limitations that are built in to the game iteself. For example, it is not possible for a player to send messages to the in-game chat in offline matches, which makes sense! I built a backdoor for doing this through the BakkesMod developer console, so you can send messages to the bot by typing something like ",{"type":39,"tag":339,"props":2447,"children":2449},{"className":2448},[],[2450],{"type":45,"value":2451},"SendMessage Good shot, bot!",{"type":45,"value":2453},", for example.",{"type":39,"tag":40,"props":2455,"children":2457},{"id":2456},"whats-next",[2458],{"type":45,"value":2459},"What's next?",{"type":39,"tag":48,"props":2461,"children":2462},{},[2463],{"type":45,"value":2464},"Participating in this contest was a great opportunity to learn more about LLMs and how to use them to extend programs in a Windows environment. It was also a lot of fun to build something by putting together new tools like TensorRT-LLM. Seeing the bot send me chat messages was very satisfying when I first got it to work! Overall it is a pretty simple implementation, but this idea could be extended to produce useful application. I could imagine a \"Rocket League Coach\" plugin that expands on this idea to give helpful feedback based on higher-level data, statistical trends, training goals, etc.",{"type":39,"tag":48,"props":2466,"children":2467},{},[2468],{"type":45,"value":2469},"I think the gaming industry's adoption of LLMs for new games will be BIG, and it will present a huge opportunity for LLM optimization and acceleration software like TensorRT-LLM that I was able to use in my Rocket League BotChat. This is not to discredit the work of writers which play an important role in game development. I'm excited to see what other developers have built for this contest, especially submissions that are building mods for games using TensorRT-LLM.",{"type":39,"tag":48,"props":2471,"children":2472},{},[2473],{"type":45,"value":2474},"Thanks NVIDIA and the TensorRT and TensorRT-LLM teams for organizing this contest! Keep on building!!",{"type":39,"tag":2476,"props":2477,"children":2478},"style",{},[2479],{"type":45,"value":2480},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":8,"searchDepth":586,"depth":586,"links":2482},[2483,2484,2485,2486,2487,2491,2496,2501,2502,2503],{"id":42,"depth":586,"text":46},{"id":186,"depth":586,"text":189},{"id":234,"depth":586,"text":237},{"id":302,"depth":586,"text":305},{"id":844,"depth":586,"text":847,"children":2488},[2489,2490],{"id":933,"depth":612,"text":936},{"id":1249,"depth":612,"text":1252},{"id":1448,"depth":586,"text":1451,"children":2492},[2493,2494,2495],{"id":1466,"depth":612,"text":1469},{"id":1646,"depth":612,"text":1649},{"id":1864,"depth":612,"text":1867},{"id":2000,"depth":586,"text":2003,"children":2497},[2498,2499,2500],{"id":2019,"depth":612,"text":2022},{"id":2216,"depth":612,"text":2219},{"id":750,"depth":612,"text":2229},{"id":2237,"depth":586,"text":2240},{"id":2415,"depth":586,"text":2418},{"id":2456,"depth":586,"text":2459},"markdown","content:2024:02:17:rocket-league-botchat-nvidia-generative-ai-on-rtx-pcs-developer-contest.md","content","2024/02/17/rocket-league-botchat-nvidia-generative-ai-on-rtx-pcs-developer-contest.md","2024/02/17/rocket-league-botchat-nvidia-generative-ai-on-rtx-pcs-developer-contest","md",{"_path":2511,"_dir":2512,"_draft":7,"_partial":7,"_locale":8,"title":2513,"description":2514,"date":2515,"image":2516,"tags":2517,"body":2522,"_type":2504,"_id":10226,"_source":2506,"_file":10227,"_stem":10228,"_extension":2509},"/2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions","18","On-demand, serverless Valheim server setup with AWS CDK, Discord Interactions and GitLab CI","This is a detailed guide showing how to setup a dedicated Valheim server using serverless technologies on AWS","2021-03-18","/static/valheim/hall.png",[2518,22,810,2519,2520,2521],"valheim","flask","serverless","discord",{"type":36,"children":2523,"toc":10204},[2524,2538,2543,2548,2553,2565,2586,2600,2612,2630,2636,2664,2700,2777,2782,2790,2795,2801,2814,2850,2858,2863,2891,2899,2905,2926,2934,2947,2966,2974,3006,3012,3024,3790,3802,3810,3815,3823,3828,3836,3856,3861,3869,3896,3902,3922,4483,4503,4509,4522,4530,4543,4551,4557,4570,4686,4713,5444,5456,5464,5477,5485,5491,5504,5729,5757,5762,5770,5783,5858,5878,5884,5896,6243,6248,6256,6261,6266,6272,6315,6323,6334,6342,6377,6388,8129,8165,8171,8197,9099,9111,9116,9134,9140,9145,9349,9398,9403,9409,9414,9422,9447,9455,9469,9923,9928,9941,9960,9966,9971,9977,10146,10152,10157,10195,10200],{"type":39,"tag":59,"props":2525,"children":2526},{},[2527],{"type":39,"tag":48,"props":2528,"children":2529},{},[2530,2532],{"type":45,"value":2531},"Here's a link to the GitLab repo I'll be referencing in this article: ",{"type":39,"tag":85,"props":2533,"children":2536},{"href":2534,"rel":2535},"https://gitlab.com/briancaffey/valheim-cdk-discord-interactions",[178],[2537],{"type":45,"value":2534},{"type":39,"tag":48,"props":2539,"children":2540},{},[2541],{"type":45,"value":2542},"This is an in-depth technical article about running an on-demand, dedicated server for Valheim using Amazon Web Services controlled with Discord Slash Commands, a new part their Interactions API that is currently in beta. Valheim is an open-world online multiplayer survival game loosely based on Norse mythology that has blown up recently.",{"type":39,"tag":48,"props":2544,"children":2545},{},[2546],{"type":45,"value":2547},"My main goal with this project was to find an inexpensive way of running a server given how my friends and I play the game, which is typically a few times a week in the evenings. Some combination of 4 of us will start playing, and we drop in and out between walking dogs, cooking, etc. When playing, we all jump on a dedicated voice channel on our group's Discord.",{"type":39,"tag":48,"props":2549,"children":2550},{},[2551],{"type":45,"value":2552},"Before setting up a dedicated server, our game's world state was stored on files that lived on one of our computers, and that computer needed to be running the game server in order for anyone to connect. Sending files around would be possible, but would quickly become tedious. There are lots of services that offer dedicated servers for Valheim, as well as many technical guides and channels on the official Valheim Discord server to support the use of dedicated servers. I wanted to see if I could set up a server myself on AWS using CDK, or Cloud Development Kit. CDK is an Infrastructure as Code (IaC) tool that allows you to define, deploy and update AWS infrastructure with popular programming languages such as Python, Typescript, Java, etc.",{"type":39,"tag":40,"props":2554,"children":2556},{"id":2555},"cdk-valheim-construct-on-github",[2557,2563],{"type":39,"tag":339,"props":2558,"children":2560},{"className":2559},[],[2561],{"type":45,"value":2562},"cdk-valheim",{"type":45,"value":2564}," construct on GitHub",{"type":39,"tag":48,"props":2566,"children":2567},{},[2568,2570,2576,2578,2584],{"type":45,"value":2569},"The best part of CDK is that it enables the creation high-level, reusable constructs that can be published to software registries like npm and PyPI. Developers can import and use these constructs in their own CDK code. A quick google search for \"cdk valheim\" turned up a few results. ",{"type":39,"tag":85,"props":2571,"children":2574},{"href":2572,"rel":2573},"https://github.com/gotodeploy/cdk-valheim",[178],[2575],{"type":45,"value":2562},{"type":45,"value":2577}," seems like the best option for what I was looking for. This project uses ECS, a container orchestration tool from AWS that I have experience using with web applications and EFS for persistent file storage. Although it is written in Typescript, I can still use the construct in my preferred programming language (Python) without any extra effort or configuration. This is thanks to the jsii. From ",{"type":39,"tag":85,"props":2579,"children":2582},{"href":2580,"rel":2581},"https://github.com/aws/jsii",[178],[2583],{"type":45,"value":2580},{"type":45,"value":2585},":",{"type":39,"tag":59,"props":2587,"children":2588},{},[2589],{"type":39,"tag":48,"props":2590,"children":2591},{},[2592,2598],{"type":39,"tag":339,"props":2593,"children":2595},{"className":2594},[],[2596],{"type":45,"value":2597},"jsii",{"type":45,"value":2599}," allows code in any language to naturally interact with JavaScript classes. It is the technology that enables the AWS Cloud Development Kit to deliver polyglot libraries from a single codebase!",{"type":39,"tag":48,"props":2601,"children":2602},{},[2603,2605,2610],{"type":45,"value":2604},"Here's an overview of the ",{"type":39,"tag":339,"props":2606,"children":2608},{"className":2607},[],[2609],{"type":45,"value":2562},{"type":45,"value":2611}," construct:",{"type":39,"tag":312,"props":2613,"children":2614},{},[2615,2620,2625],{"type":39,"tag":316,"props":2616,"children":2617},{},[2618],{"type":45,"value":2619},"Scheduled scaling of an ECS service using AWS Fargate (a serverless compute engine for containers)",{"type":39,"tag":316,"props":2621,"children":2622},{},[2623],{"type":45,"value":2624},"Elastic File System (EFS) file system mounted into the Fargate Task container of our ECS service",{"type":39,"tag":316,"props":2626,"children":2627},{},[2628],{"type":45,"value":2629},"Optional automated backups of the EFS file system using AWS Backup",{"type":39,"tag":40,"props":2631,"children":2633},{"id":2632},"discord-interactions-and-slash-commands",[2634],{"type":45,"value":2635},"Discord Interactions and Slash Commands",{"type":39,"tag":48,"props":2637,"children":2638},{},[2639,2641,2647,2649,2655,2657,2663],{"type":45,"value":2640},"Scheduled ECS scaling is nice, but we don't always know when we will be able to play together, so it is not the best way to minimize infrastructure costs. My plan was to set the ECS service to an initial task count of zero and then let any of us set the number of tasks to either zero or one through a Discord Slash Command. A Slash Command allows you to interact with a discord bot by typing ",{"type":39,"tag":339,"props":2642,"children":2644},{"className":2643},[],[2645],{"type":45,"value":2646},"/",{"type":45,"value":2648}," and then tabbing through to the option we want, such as ",{"type":39,"tag":339,"props":2650,"children":2652},{"className":2651},[],[2653],{"type":45,"value":2654},"/valheim server start",{"type":45,"value":2656}," or ",{"type":39,"tag":339,"props":2658,"children":2660},{"className":2659},[],[2661],{"type":45,"value":2662},"/valheim server status",{"type":45,"value":183},{"type":39,"tag":48,"props":2665,"children":2666},{},[2667,2669,2675,2677,2683,2684,2690,2692,2698],{"type":45,"value":2668},"Invoking a Slash Command from Discord sends a ",{"type":39,"tag":339,"props":2670,"children":2672},{"className":2671},[],[2673],{"type":45,"value":2674},"POST",{"type":45,"value":2676}," request from Discord to a webhook URL that we have to provide. To handle the webhook, one simple and inexpensive approach is to use API Gateway and a Lambda function that serves a Flask app. The Flask app can then use boto3 (which is included in the Lambda execution environment) to call ",{"type":39,"tag":339,"props":2678,"children":2680},{"className":2679},[],[2681],{"type":45,"value":2682},"update_service",{"type":45,"value":2656},{"type":39,"tag":339,"props":2685,"children":2687},{"className":2686},[],[2688],{"type":45,"value":2689},"describe_services",{"type":45,"value":2691}," to scaled the ECS task's ",{"type":39,"tag":339,"props":2693,"children":2695},{"className":2694},[],[2696],{"type":45,"value":2697},"desiredCount",{"type":45,"value":2699}," based on the slash command options and sub options.",{"type":39,"tag":48,"props":2701,"children":2702},{},[2703,2705,2710,2712,2718,2720,2726,2727,2733,2735,2741,2743,2749,2750,2756,2758,2763,2765,2770,2771,2776],{"type":45,"value":2704},"The function that handles the webhook ",{"type":39,"tag":339,"props":2706,"children":2708},{"className":2707},[],[2709],{"type":45,"value":2674},{"type":45,"value":2711}," request when the sub-command is ",{"type":39,"tag":339,"props":2713,"children":2715},{"className":2714},[],[2716],{"type":45,"value":2717},"status",{"type":45,"value":2719}," queries AWS for the number of ECS tasks in our service that are ",{"type":39,"tag":339,"props":2721,"children":2723},{"className":2722},[],[2724],{"type":45,"value":2725},"desired",{"type":45,"value":1577},{"type":39,"tag":339,"props":2728,"children":2730},{"className":2729},[],[2731],{"type":45,"value":2732},"running",{"type":45,"value":2734}," and ",{"type":39,"tag":339,"props":2736,"children":2738},{"className":2737},[],[2739],{"type":45,"value":2740},"pending",{"type":45,"value":2742}," and then sends back a message that will be displayed to the user who sent the command. When the sub-command is ",{"type":39,"tag":339,"props":2744,"children":2746},{"className":2745},[],[2747],{"type":45,"value":2748},"start",{"type":45,"value":2656},{"type":39,"tag":339,"props":2751,"children":2753},{"className":2752},[],[2754],{"type":45,"value":2755},"stop",{"type":45,"value":2757},", the ",{"type":39,"tag":339,"props":2759,"children":2761},{"className":2760},[],[2762],{"type":45,"value":2697},{"type":45,"value":2764}," is either set to ",{"type":39,"tag":339,"props":2766,"children":2768},{"className":2767},[],[2769],{"type":45,"value":1152},{"type":45,"value":2656},{"type":39,"tag":339,"props":2772,"children":2774},{"className":2773},[],[2775],{"type":45,"value":1916},{"type":45,"value":183},{"type":39,"tag":48,"props":2778,"children":2779},{},[2780],{"type":45,"value":2781},"Here's an overview of the server setup and how Discord Slash Commands can be used to control the server:",{"type":39,"tag":48,"props":2783,"children":2784},{},[2785],{"type":39,"tag":227,"props":2786,"children":2789},{"alt":2787,"src":2788},"png","/static/valheim/diagram.png",[],{"type":39,"tag":48,"props":2791,"children":2792},{},[2793],{"type":45,"value":2794},"I'll cover each of the steps labelled in this diagram at the end of the article. The rest of the article will provide detailed instructions for how to set everything up. I won't be going over AWS account setup or Discord server setup.",{"type":39,"tag":40,"props":2796,"children":2798},{"id":2797},"how-to-set-up-the-discord-developer-application-and-interaction",[2799],{"type":45,"value":2800},"How to set up the Discord developer application and Interaction",{"type":39,"tag":48,"props":2802,"children":2803},{},[2804,2806,2812],{"type":45,"value":2805},"First, you need to be the admin of a Discord server. Once you create the server, go to ",{"type":39,"tag":339,"props":2807,"children":2809},{"className":2808},[],[2810],{"type":45,"value":2811},"Server Settings > Widget",{"type":45,"value":2813}," and take note of the Server ID. This is also known as the Guild ID.",{"type":39,"tag":48,"props":2815,"children":2816},{},[2817,2819,2825,2827,2833,2835,2841,2843,2849],{"type":45,"value":2818},"Then go to ",{"type":39,"tag":85,"props":2820,"children":2823},{"href":2821,"rel":2822},"https://discord.com/developers/applications",[178],[2824],{"type":45,"value":2821},{"type":45,"value":2826}," and create an application. Under ",{"type":39,"tag":339,"props":2828,"children":2830},{"className":2829},[],[2831],{"type":45,"value":2832},"General Information",{"type":45,"value":2834},", make note of the public key (the application ID). Put these values in a file that will be ",{"type":39,"tag":339,"props":2836,"children":2838},{"className":2837},[],[2839],{"type":45,"value":2840},".gitignored",{"type":45,"value":2842}," called ",{"type":39,"tag":339,"props":2844,"children":2846},{"className":2845},[],[2847],{"type":45,"value":2848},".env",{"type":45,"value":2585},{"type":39,"tag":563,"props":2851,"children":2853},{"code":2852},"export GUILD_ID=123456789\nexport APPLICATION_ID=abc123\n",[2854],{"type":39,"tag":339,"props":2855,"children":2856},{"__ignoreMap":8},[2857],{"type":45,"value":2852},{"type":39,"tag":48,"props":2859,"children":2860},{},[2861],{"type":45,"value":2862},"We will use this file later when registering the Interaction.",{"type":39,"tag":48,"props":2864,"children":2865},{},[2866,2868,2874,2876,2882,2883,2889],{"type":45,"value":2867},"Next go to the ",{"type":39,"tag":339,"props":2869,"children":2871},{"className":2870},[],[2872],{"type":45,"value":2873},"OAuth2",{"type":45,"value":2875}," tab and select the ",{"type":39,"tag":339,"props":2877,"children":2879},{"className":2878},[],[2880],{"type":45,"value":2881},"bot",{"type":45,"value":2734},{"type":39,"tag":339,"props":2884,"children":2886},{"className":2885},[],[2887],{"type":45,"value":2888},"applications.commands",{"type":45,"value":2890}," permissions. This will generated an OAuth2 authorization link. Copy the link and open it in a browser. We will see an error:",{"type":39,"tag":563,"props":2892,"children":2894},{"code":2893},"OAuth2 application does not have a bot\n",[2895],{"type":39,"tag":339,"props":2896,"children":2897},{"__ignoreMap":8},[2898],{"type":45,"value":2893},{"type":39,"tag":931,"props":2900,"children":2902},{"id":2901},"configure-a-bot-for-our-discord-application",[2903],{"type":45,"value":2904},"Configure a bot for our Discord application",{"type":39,"tag":48,"props":2906,"children":2907},{},[2908,2910,2916,2918,2924],{"type":45,"value":2909},"Next, got to the ",{"type":39,"tag":339,"props":2911,"children":2913},{"className":2912},[],[2914],{"type":45,"value":2915},"Bot",{"type":45,"value":2917}," tab and click the ",{"type":39,"tag":339,"props":2919,"children":2921},{"className":2920},[],[2922],{"type":45,"value":2923},"Add Bot",{"type":45,"value":2925}," button.",{"type":39,"tag":59,"props":2927,"children":2928},{},[2929],{"type":39,"tag":48,"props":2930,"children":2931},{},[2932],{"type":45,"value":2933},"Adding a bot user gives your app visible life in Discord. However, this action is irrevocable! Choose wisely.",{"type":39,"tag":48,"props":2935,"children":2936},{},[2937,2939,2945],{"type":45,"value":2938},"Turn off the ",{"type":39,"tag":339,"props":2940,"children":2942},{"className":2941},[],[2943],{"type":45,"value":2944},"Public Bot",{"type":45,"value":2946}," option and save changes.",{"type":39,"tag":48,"props":2948,"children":2949},{},[2950,2952,2958,2960,2965],{"type":45,"value":2951},"Get the bot token by clicking on ",{"type":39,"tag":339,"props":2953,"children":2955},{"className":2954},[],[2956],{"type":45,"value":2957},"Click to Reveal Token",{"type":45,"value":2959},", and add this to ",{"type":39,"tag":339,"props":2961,"children":2963},{"className":2962},[],[2964],{"type":45,"value":2848},{"type":45,"value":2585},{"type":39,"tag":563,"props":2967,"children":2969},{"code":2968},"export BOT_TOKEN=abc.xyz.123\n",[2970],{"type":39,"tag":339,"props":2971,"children":2972},{"__ignoreMap":8},[2973],{"type":45,"value":2968},{"type":39,"tag":48,"props":2975,"children":2976},{},[2977,2979,2984,2985,2990,2991,2996,2998,3004],{"type":45,"value":2978},"Now go back to the ",{"type":39,"tag":339,"props":2980,"children":2982},{"className":2981},[],[2983],{"type":45,"value":2873},{"type":45,"value":2875},{"type":39,"tag":339,"props":2986,"children":2988},{"className":2987},[],[2989],{"type":45,"value":2881},{"type":45,"value":2734},{"type":39,"tag":339,"props":2992,"children":2994},{"className":2993},[],[2995],{"type":45,"value":2888},{"type":45,"value":2997}," permissions again, copy the link and open it. Select the server that you want to add this application to. You should see a captcha, and then a message that says ",{"type":39,"tag":339,"props":2999,"children":3001},{"className":3000},[],[3002],{"type":45,"value":3003},"Authorized",{"type":45,"value":3005},". You should also see a message from your discord server that the bot has joined the server.",{"type":39,"tag":931,"props":3007,"children":3009},{"id":3008},"create-the-interaction",[3010],{"type":45,"value":3011},"Create the Interaction",{"type":39,"tag":48,"props":3013,"children":3014},{},[3015,3017,3022],{"type":45,"value":3016},"Now we will set up the Interaction. Currently the only way to set up the interaction is through an HTTP ",{"type":39,"tag":339,"props":3018,"children":3020},{"className":3019},[],[3021],{"type":45,"value":2674},{"type":45,"value":3023}," request. This Python script sets up our Interaction:",{"type":39,"tag":563,"props":3025,"children":3029},{"code":3026,"language":3027,"meta":8,"className":3028,"style":8},"\"\"\"\nhttps://discord.com/developers/docs/interactions/slash-commands#registering-a-command\n\"\"\"\n\nimport os\n\nimport requests\n\nAPPLICATION_ID = os.environ.get(\"APPLICATION_ID\")\nGUILD_ID = os.environ.get(\"GUILD_ID\")\nBOT_TOKEN = os.environ.get(\"BOT_TOKEN\")\n\nurl = f\"https://discord.com/api/v8/applications/{APPLICATION_ID}/guilds/{GUILD_ID}/commands\"\n\njson = {\n    \"name\": \"vh\",\n    \"description\": \"Start, stop or get the status of the Valheim server\",\n    \"options\": [\n        {\n            \"name\": \"valheim_server_controls\",\n            \"description\": \"What do you want to do?\",\n            \"type\": 3,\n            \"required\": True,\n            \"choices\": [\n                {\n                    \"name\": \"status\",\n                    \"value\": \"status\"\n                },\n                {\n                    \"name\": \"start\",\n                    \"value\": \"start\"\n                },\n                {\n                    \"name\": \"stop\",\n                    \"value\": \"stop\"\n                }\n            ]\n        },\n    ]\n}\n\nheaders = {\n    \"Authorization\": f\"Bot {BOT_TOKEN}\"\n}\n\nif __name__ == \"__main__\":\n    r = requests.post(url, headers=headers, json=json)\n    print(r.content)\n","py","language-py shiki shiki-themes github-light github-dark monokai",[3030],{"type":39,"tag":339,"props":3031,"children":3032},{"__ignoreMap":8},[3033,3041,3049,3056,3063,3076,3083,3095,3102,3130,3155,3180,3188,3231,3239,3256,3278,3300,3314,3323,3345,3367,3389,3411,3424,3433,3455,3473,3482,3490,3511,3528,3536,3544,3565,3582,3591,3600,3609,3618,3626,3634,3651,3684,3692,3700,3730,3775],{"type":39,"tag":573,"props":3034,"children":3035},{"class":575,"line":576},[3036],{"type":39,"tag":573,"props":3037,"children":3038},{"style":783},[3039],{"type":45,"value":3040},"\"\"\"\n",{"type":39,"tag":573,"props":3042,"children":3043},{"class":575,"line":586},[3044],{"type":39,"tag":573,"props":3045,"children":3046},{"style":783},[3047],{"type":45,"value":3048},"https://discord.com/developers/docs/interactions/slash-commands#registering-a-command\n",{"type":39,"tag":573,"props":3050,"children":3051},{"class":575,"line":612},[3052],{"type":39,"tag":573,"props":3053,"children":3054},{"style":783},[3055],{"type":45,"value":3040},{"type":39,"tag":573,"props":3057,"children":3058},{"class":575,"line":634},[3059],{"type":39,"tag":573,"props":3060,"children":3061},{"emptyLinePlaceholder":34},[3062],{"type":45,"value":1722},{"type":39,"tag":573,"props":3064,"children":3065},{"class":575,"line":656},[3066,3071],{"type":39,"tag":573,"props":3067,"children":3068},{"style":968},[3069],{"type":45,"value":3070},"import",{"type":39,"tag":573,"props":3072,"children":3073},{"style":580},[3074],{"type":45,"value":3075}," os\n",{"type":39,"tag":573,"props":3077,"children":3078},{"class":575,"line":678},[3079],{"type":39,"tag":573,"props":3080,"children":3081},{"emptyLinePlaceholder":34},[3082],{"type":45,"value":1722},{"type":39,"tag":573,"props":3084,"children":3085},{"class":575,"line":696},[3086,3090],{"type":39,"tag":573,"props":3087,"children":3088},{"style":968},[3089],{"type":45,"value":3070},{"type":39,"tag":573,"props":3091,"children":3092},{"style":580},[3093],{"type":45,"value":3094}," requests\n",{"type":39,"tag":573,"props":3096,"children":3097},{"class":575,"line":1800},[3098],{"type":39,"tag":573,"props":3099,"children":3100},{"emptyLinePlaceholder":34},[3101],{"type":45,"value":1722},{"type":39,"tag":573,"props":3103,"children":3104},{"class":575,"line":1814},[3105,3110,3115,3120,3125],{"type":39,"tag":573,"props":3106,"children":3107},{"style":1003},[3108],{"type":45,"value":3109},"APPLICATION_ID",{"type":39,"tag":573,"props":3111,"children":3112},{"style":968},[3113],{"type":45,"value":3114}," =",{"type":39,"tag":573,"props":3116,"children":3117},{"style":580},[3118],{"type":45,"value":3119}," os.environ.get(",{"type":39,"tag":573,"props":3121,"children":3122},{"style":783},[3123],{"type":45,"value":3124},"\"APPLICATION_ID\"",{"type":39,"tag":573,"props":3126,"children":3127},{"style":580},[3128],{"type":45,"value":3129},")\n",{"type":39,"tag":573,"props":3131,"children":3132},{"class":575,"line":1847},[3133,3138,3142,3146,3151],{"type":39,"tag":573,"props":3134,"children":3135},{"style":1003},[3136],{"type":45,"value":3137},"GUILD_ID",{"type":39,"tag":573,"props":3139,"children":3140},{"style":968},[3141],{"type":45,"value":3114},{"type":39,"tag":573,"props":3143,"children":3144},{"style":580},[3145],{"type":45,"value":3119},{"type":39,"tag":573,"props":3147,"children":3148},{"style":783},[3149],{"type":45,"value":3150},"\"GUILD_ID\"",{"type":39,"tag":573,"props":3152,"children":3153},{"style":580},[3154],{"type":45,"value":3129},{"type":39,"tag":573,"props":3156,"children":3157},{"class":575,"line":1855},[3158,3163,3167,3171,3176],{"type":39,"tag":573,"props":3159,"children":3160},{"style":1003},[3161],{"type":45,"value":3162},"BOT_TOKEN",{"type":39,"tag":573,"props":3164,"children":3165},{"style":968},[3166],{"type":45,"value":3114},{"type":39,"tag":573,"props":3168,"children":3169},{"style":580},[3170],{"type":45,"value":3119},{"type":39,"tag":573,"props":3172,"children":3173},{"style":783},[3174],{"type":45,"value":3175},"\"BOT_TOKEN\"",{"type":39,"tag":573,"props":3177,"children":3178},{"style":580},[3179],{"type":45,"value":3129},{"type":39,"tag":573,"props":3181,"children":3183},{"class":575,"line":3182},12,[3184],{"type":39,"tag":573,"props":3185,"children":3186},{"emptyLinePlaceholder":34},[3187],{"type":45,"value":1722},{"type":39,"tag":573,"props":3189,"children":3191},{"class":575,"line":3190},13,[3192,3197,3201,3206,3211,3216,3221,3226],{"type":39,"tag":573,"props":3193,"children":3194},{"style":580},[3195],{"type":45,"value":3196},"url ",{"type":39,"tag":573,"props":3198,"children":3199},{"style":968},[3200],{"type":45,"value":1896},{"type":39,"tag":573,"props":3202,"children":3203},{"style":1580},[3204],{"type":45,"value":3205}," f",{"type":39,"tag":573,"props":3207,"children":3208},{"style":783},[3209],{"type":45,"value":3210},"\"https://discord.com/api/v8/applications/",{"type":39,"tag":573,"props":3212,"children":3213},{"style":1003},[3214],{"type":45,"value":3215},"{APPLICATION_ID}",{"type":39,"tag":573,"props":3217,"children":3218},{"style":783},[3219],{"type":45,"value":3220},"/guilds/",{"type":39,"tag":573,"props":3222,"children":3223},{"style":1003},[3224],{"type":45,"value":3225},"{GUILD_ID}",{"type":39,"tag":573,"props":3227,"children":3228},{"style":783},[3229],{"type":45,"value":3230},"/commands\"\n",{"type":39,"tag":573,"props":3232,"children":3234},{"class":575,"line":3233},14,[3235],{"type":39,"tag":573,"props":3236,"children":3237},{"emptyLinePlaceholder":34},[3238],{"type":45,"value":1722},{"type":39,"tag":573,"props":3240,"children":3242},{"class":575,"line":3241},15,[3243,3248,3252],{"type":39,"tag":573,"props":3244,"children":3245},{"style":580},[3246],{"type":45,"value":3247},"json ",{"type":39,"tag":573,"props":3249,"children":3250},{"style":968},[3251],{"type":45,"value":1896},{"type":39,"tag":573,"props":3253,"children":3254},{"style":580},[3255],{"type":45,"value":1811},{"type":39,"tag":573,"props":3257,"children":3259},{"class":575,"line":3258},16,[3260,3265,3269,3274],{"type":39,"tag":573,"props":3261,"children":3262},{"style":783},[3263],{"type":45,"value":3264},"    \"name\"",{"type":39,"tag":573,"props":3266,"children":3267},{"style":580},[3268],{"type":45,"value":598},{"type":39,"tag":573,"props":3270,"children":3271},{"style":783},[3272],{"type":45,"value":3273},"\"vh\"",{"type":39,"tag":573,"props":3275,"children":3276},{"style":580},[3277],{"type":45,"value":609},{"type":39,"tag":573,"props":3279,"children":3281},{"class":575,"line":3280},17,[3282,3287,3291,3296],{"type":39,"tag":573,"props":3283,"children":3284},{"style":783},[3285],{"type":45,"value":3286},"    \"description\"",{"type":39,"tag":573,"props":3288,"children":3289},{"style":580},[3290],{"type":45,"value":598},{"type":39,"tag":573,"props":3292,"children":3293},{"style":783},[3294],{"type":45,"value":3295},"\"Start, stop or get the status of the Valheim server\"",{"type":39,"tag":573,"props":3297,"children":3298},{"style":580},[3299],{"type":45,"value":609},{"type":39,"tag":573,"props":3301,"children":3303},{"class":575,"line":3302},18,[3304,3309],{"type":39,"tag":573,"props":3305,"children":3306},{"style":783},[3307],{"type":45,"value":3308},"    \"options\"",{"type":39,"tag":573,"props":3310,"children":3311},{"style":580},[3312],{"type":45,"value":3313},": [\n",{"type":39,"tag":573,"props":3315,"children":3317},{"class":575,"line":3316},19,[3318],{"type":39,"tag":573,"props":3319,"children":3320},{"style":580},[3321],{"type":45,"value":3322},"        {\n",{"type":39,"tag":573,"props":3324,"children":3326},{"class":575,"line":3325},20,[3327,3332,3336,3341],{"type":39,"tag":573,"props":3328,"children":3329},{"style":783},[3330],{"type":45,"value":3331},"            \"name\"",{"type":39,"tag":573,"props":3333,"children":3334},{"style":580},[3335],{"type":45,"value":598},{"type":39,"tag":573,"props":3337,"children":3338},{"style":783},[3339],{"type":45,"value":3340},"\"valheim_server_controls\"",{"type":39,"tag":573,"props":3342,"children":3343},{"style":580},[3344],{"type":45,"value":609},{"type":39,"tag":573,"props":3346,"children":3348},{"class":575,"line":3347},21,[3349,3354,3358,3363],{"type":39,"tag":573,"props":3350,"children":3351},{"style":783},[3352],{"type":45,"value":3353},"            \"description\"",{"type":39,"tag":573,"props":3355,"children":3356},{"style":580},[3357],{"type":45,"value":598},{"type":39,"tag":573,"props":3359,"children":3360},{"style":783},[3361],{"type":45,"value":3362},"\"What do you want to do?\"",{"type":39,"tag":573,"props":3364,"children":3365},{"style":580},[3366],{"type":45,"value":609},{"type":39,"tag":573,"props":3368,"children":3370},{"class":575,"line":3369},22,[3371,3376,3380,3385],{"type":39,"tag":573,"props":3372,"children":3373},{"style":783},[3374],{"type":45,"value":3375},"            \"type\"",{"type":39,"tag":573,"props":3377,"children":3378},{"style":580},[3379],{"type":45,"value":598},{"type":39,"tag":573,"props":3381,"children":3382},{"style":1003},[3383],{"type":45,"value":3384},"3",{"type":39,"tag":573,"props":3386,"children":3387},{"style":580},[3388],{"type":45,"value":609},{"type":39,"tag":573,"props":3390,"children":3392},{"class":575,"line":3391},23,[3393,3398,3402,3407],{"type":39,"tag":573,"props":3394,"children":3395},{"style":783},[3396],{"type":45,"value":3397},"            \"required\"",{"type":39,"tag":573,"props":3399,"children":3400},{"style":580},[3401],{"type":45,"value":598},{"type":39,"tag":573,"props":3403,"children":3404},{"style":1003},[3405],{"type":45,"value":3406},"True",{"type":39,"tag":573,"props":3408,"children":3409},{"style":580},[3410],{"type":45,"value":609},{"type":39,"tag":573,"props":3412,"children":3414},{"class":575,"line":3413},24,[3415,3420],{"type":39,"tag":573,"props":3416,"children":3417},{"style":783},[3418],{"type":45,"value":3419},"            \"choices\"",{"type":39,"tag":573,"props":3421,"children":3422},{"style":580},[3423],{"type":45,"value":3313},{"type":39,"tag":573,"props":3425,"children":3427},{"class":575,"line":3426},25,[3428],{"type":39,"tag":573,"props":3429,"children":3430},{"style":580},[3431],{"type":45,"value":3432},"                {\n",{"type":39,"tag":573,"props":3434,"children":3436},{"class":575,"line":3435},26,[3437,3442,3446,3451],{"type":39,"tag":573,"props":3438,"children":3439},{"style":783},[3440],{"type":45,"value":3441},"                    \"name\"",{"type":39,"tag":573,"props":3443,"children":3444},{"style":580},[3445],{"type":45,"value":598},{"type":39,"tag":573,"props":3447,"children":3448},{"style":783},[3449],{"type":45,"value":3450},"\"status\"",{"type":39,"tag":573,"props":3452,"children":3453},{"style":580},[3454],{"type":45,"value":609},{"type":39,"tag":573,"props":3456,"children":3458},{"class":575,"line":3457},27,[3459,3464,3468],{"type":39,"tag":573,"props":3460,"children":3461},{"style":783},[3462],{"type":45,"value":3463},"                    \"value\"",{"type":39,"tag":573,"props":3465,"children":3466},{"style":580},[3467],{"type":45,"value":598},{"type":39,"tag":573,"props":3469,"children":3470},{"style":783},[3471],{"type":45,"value":3472},"\"status\"\n",{"type":39,"tag":573,"props":3474,"children":3476},{"class":575,"line":3475},28,[3477],{"type":39,"tag":573,"props":3478,"children":3479},{"style":580},[3480],{"type":45,"value":3481},"                },\n",{"type":39,"tag":573,"props":3483,"children":3485},{"class":575,"line":3484},29,[3486],{"type":39,"tag":573,"props":3487,"children":3488},{"style":580},[3489],{"type":45,"value":3432},{"type":39,"tag":573,"props":3491,"children":3493},{"class":575,"line":3492},30,[3494,3498,3502,3507],{"type":39,"tag":573,"props":3495,"children":3496},{"style":783},[3497],{"type":45,"value":3441},{"type":39,"tag":573,"props":3499,"children":3500},{"style":580},[3501],{"type":45,"value":598},{"type":39,"tag":573,"props":3503,"children":3504},{"style":783},[3505],{"type":45,"value":3506},"\"start\"",{"type":39,"tag":573,"props":3508,"children":3509},{"style":580},[3510],{"type":45,"value":609},{"type":39,"tag":573,"props":3512,"children":3514},{"class":575,"line":3513},31,[3515,3519,3523],{"type":39,"tag":573,"props":3516,"children":3517},{"style":783},[3518],{"type":45,"value":3463},{"type":39,"tag":573,"props":3520,"children":3521},{"style":580},[3522],{"type":45,"value":598},{"type":39,"tag":573,"props":3524,"children":3525},{"style":783},[3526],{"type":45,"value":3527},"\"start\"\n",{"type":39,"tag":573,"props":3529,"children":3531},{"class":575,"line":3530},32,[3532],{"type":39,"tag":573,"props":3533,"children":3534},{"style":580},[3535],{"type":45,"value":3481},{"type":39,"tag":573,"props":3537,"children":3539},{"class":575,"line":3538},33,[3540],{"type":39,"tag":573,"props":3541,"children":3542},{"style":580},[3543],{"type":45,"value":3432},{"type":39,"tag":573,"props":3545,"children":3547},{"class":575,"line":3546},34,[3548,3552,3556,3561],{"type":39,"tag":573,"props":3549,"children":3550},{"style":783},[3551],{"type":45,"value":3441},{"type":39,"tag":573,"props":3553,"children":3554},{"style":580},[3555],{"type":45,"value":598},{"type":39,"tag":573,"props":3557,"children":3558},{"style":783},[3559],{"type":45,"value":3560},"\"stop\"",{"type":39,"tag":573,"props":3562,"children":3563},{"style":580},[3564],{"type":45,"value":609},{"type":39,"tag":573,"props":3566,"children":3568},{"class":575,"line":3567},35,[3569,3573,3577],{"type":39,"tag":573,"props":3570,"children":3571},{"style":783},[3572],{"type":45,"value":3463},{"type":39,"tag":573,"props":3574,"children":3575},{"style":580},[3576],{"type":45,"value":598},{"type":39,"tag":573,"props":3578,"children":3579},{"style":783},[3580],{"type":45,"value":3581},"\"stop\"\n",{"type":39,"tag":573,"props":3583,"children":3585},{"class":575,"line":3584},36,[3586],{"type":39,"tag":573,"props":3587,"children":3588},{"style":580},[3589],{"type":45,"value":3590},"                }\n",{"type":39,"tag":573,"props":3592,"children":3594},{"class":575,"line":3593},37,[3595],{"type":39,"tag":573,"props":3596,"children":3597},{"style":580},[3598],{"type":45,"value":3599},"            ]\n",{"type":39,"tag":573,"props":3601,"children":3603},{"class":575,"line":3602},38,[3604],{"type":39,"tag":573,"props":3605,"children":3606},{"style":580},[3607],{"type":45,"value":3608},"        },\n",{"type":39,"tag":573,"props":3610,"children":3612},{"class":575,"line":3611},39,[3613],{"type":39,"tag":573,"props":3614,"children":3615},{"style":580},[3616],{"type":45,"value":3617},"    ]\n",{"type":39,"tag":573,"props":3619,"children":3621},{"class":575,"line":3620},40,[3622],{"type":39,"tag":573,"props":3623,"children":3624},{"style":580},[3625],{"type":45,"value":702},{"type":39,"tag":573,"props":3627,"children":3629},{"class":575,"line":3628},41,[3630],{"type":39,"tag":573,"props":3631,"children":3632},{"emptyLinePlaceholder":34},[3633],{"type":45,"value":1722},{"type":39,"tag":573,"props":3635,"children":3637},{"class":575,"line":3636},42,[3638,3643,3647],{"type":39,"tag":573,"props":3639,"children":3640},{"style":580},[3641],{"type":45,"value":3642},"headers ",{"type":39,"tag":573,"props":3644,"children":3645},{"style":968},[3646],{"type":45,"value":1896},{"type":39,"tag":573,"props":3648,"children":3649},{"style":580},[3650],{"type":45,"value":1811},{"type":39,"tag":573,"props":3652,"children":3654},{"class":575,"line":3653},43,[3655,3660,3664,3669,3674,3679],{"type":39,"tag":573,"props":3656,"children":3657},{"style":783},[3658],{"type":45,"value":3659},"    \"Authorization\"",{"type":39,"tag":573,"props":3661,"children":3662},{"style":580},[3663],{"type":45,"value":598},{"type":39,"tag":573,"props":3665,"children":3666},{"style":1580},[3667],{"type":45,"value":3668},"f",{"type":39,"tag":573,"props":3670,"children":3671},{"style":783},[3672],{"type":45,"value":3673},"\"Bot ",{"type":39,"tag":573,"props":3675,"children":3676},{"style":1003},[3677],{"type":45,"value":3678},"{BOT_TOKEN}",{"type":39,"tag":573,"props":3680,"children":3681},{"style":783},[3682],{"type":45,"value":3683},"\"\n",{"type":39,"tag":573,"props":3685,"children":3687},{"class":575,"line":3686},44,[3688],{"type":39,"tag":573,"props":3689,"children":3690},{"style":580},[3691],{"type":45,"value":702},{"type":39,"tag":573,"props":3693,"children":3695},{"class":575,"line":3694},45,[3696],{"type":39,"tag":573,"props":3697,"children":3698},{"emptyLinePlaceholder":34},[3699],{"type":45,"value":1722},{"type":39,"tag":573,"props":3701,"children":3703},{"class":575,"line":3702},46,[3704,3709,3715,3720,3725],{"type":39,"tag":573,"props":3705,"children":3706},{"style":968},[3707],{"type":45,"value":3708},"if",{"type":39,"tag":573,"props":3710,"children":3712},{"style":3711},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[3713],{"type":45,"value":3714}," __name__",{"type":39,"tag":573,"props":3716,"children":3717},{"style":968},[3718],{"type":45,"value":3719}," ==",{"type":39,"tag":573,"props":3721,"children":3722},{"style":783},[3723],{"type":45,"value":3724}," \"__main__\"",{"type":39,"tag":573,"props":3726,"children":3727},{"style":580},[3728],{"type":45,"value":3729},":\n",{"type":39,"tag":573,"props":3731,"children":3733},{"class":575,"line":3732},47,[3734,3739,3743,3748,3753,3757,3762,3766,3770],{"type":39,"tag":573,"props":3735,"children":3736},{"style":580},[3737],{"type":45,"value":3738},"    r ",{"type":39,"tag":573,"props":3740,"children":3741},{"style":968},[3742],{"type":45,"value":1896},{"type":39,"tag":573,"props":3744,"children":3745},{"style":580},[3746],{"type":45,"value":3747}," requests.post(url, ",{"type":39,"tag":573,"props":3749,"children":3750},{"style":1569},[3751],{"type":45,"value":3752},"headers",{"type":39,"tag":573,"props":3754,"children":3755},{"style":968},[3756],{"type":45,"value":1896},{"type":39,"tag":573,"props":3758,"children":3759},{"style":580},[3760],{"type":45,"value":3761},"headers, ",{"type":39,"tag":573,"props":3763,"children":3764},{"style":1569},[3765],{"type":45,"value":566},{"type":39,"tag":573,"props":3767,"children":3768},{"style":968},[3769],{"type":45,"value":1896},{"type":39,"tag":573,"props":3771,"children":3772},{"style":580},[3773],{"type":45,"value":3774},"json)\n",{"type":39,"tag":573,"props":3776,"children":3778},{"class":575,"line":3777},48,[3779,3785],{"type":39,"tag":573,"props":3780,"children":3782},{"style":3781},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF",[3783],{"type":45,"value":3784},"    print",{"type":39,"tag":573,"props":3786,"children":3787},{"style":580},[3788],{"type":45,"value":3789},"(r.content)\n",{"type":39,"tag":48,"props":3791,"children":3792},{},[3793,3795,3800],{"type":45,"value":3794},"Before running this command, source the ",{"type":39,"tag":339,"props":3796,"children":3798},{"className":3797},[],[3799],{"type":45,"value":2848},{"type":45,"value":3801}," file:",{"type":39,"tag":563,"props":3803,"children":3805},{"code":3804},"source .env\n",[3806],{"type":39,"tag":339,"props":3807,"children":3808},{"__ignoreMap":8},[3809],{"type":45,"value":3804},{"type":39,"tag":48,"props":3811,"children":3812},{},[3813],{"type":45,"value":3814},"Then run the script:",{"type":39,"tag":563,"props":3816,"children":3818},{"code":3817},"python3 register_bot.py\n",[3819],{"type":39,"tag":339,"props":3820,"children":3821},{"__ignoreMap":8},[3822],{"type":45,"value":3817},{"type":39,"tag":48,"props":3824,"children":3825},{},[3826],{"type":45,"value":3827},"You should see this response:",{"type":39,"tag":563,"props":3829,"children":3831},{"code":3830},"b'{\"id\": \"XXXXXXXXXXXXXX\", \"application_id\": \"XXXXXXXXXXXXXX\", \"name\": \"vh\", \"description\": \"Start, stop or get the status of the Valheim server\", \"version\": \"XXXXXXXXXXXXXX\", \"default_permission\": true, \"guild_id\": \"XXXXXXXXXXXXXX\", \"options\": [{\"type\": 3, \"name\": \"valheim_server_controls\", \"description\": \"What do you want to do?\", \"required\": true, \"choices\": [{\"name\": \"status\", \"value\": \"status\"}, {\"name\": \"start\", \"value\": \"start\"}, {\"name\": \"stop\", \"value\": \"stop\"}]}]}'\n",[3832],{"type":39,"tag":339,"props":3833,"children":3834},{"__ignoreMap":8},[3835],{"type":45,"value":3830},{"type":39,"tag":48,"props":3837,"children":3838},{},[3839,3841,3846,3848,3854],{"type":45,"value":3840},"Now, when you type ",{"type":39,"tag":339,"props":3842,"children":3844},{"className":3843},[],[3845],{"type":45,"value":2646},{"type":45,"value":3847}," in any channel on the Discord server that you authenticated the bot, you should see the ",{"type":39,"tag":339,"props":3849,"children":3851},{"className":3850},[],[3852],{"type":45,"value":3853},"vh",{"type":45,"value":3855}," command at the top of the list of autocomplete options.",{"type":39,"tag":48,"props":3857,"children":3858},{},[3859],{"type":45,"value":3860},"If we run any of these commands, we should see a response saying:",{"type":39,"tag":563,"props":3862,"children":3864},{"code":3863},"This interaction failed\n",[3865],{"type":39,"tag":339,"props":3866,"children":3867},{"__ignoreMap":8},[3868],{"type":45,"value":3863},{"type":39,"tag":48,"props":3870,"children":3871},{},[3872,3874,3880,3882,3887,3889,3895],{"type":45,"value":3873},"This is because we have not configured an ",{"type":39,"tag":339,"props":3875,"children":3877},{"className":3876},[],[3878],{"type":45,"value":3879},"Interactions Endpoint URL",{"type":45,"value":3881}," under the ",{"type":39,"tag":339,"props":3883,"children":3885},{"className":3884},[],[3886],{"type":45,"value":2832},{"type":45,"value":3888}," section of our Discord Application's admin page (",{"type":39,"tag":85,"props":3890,"children":3893},{"href":3891,"rel":3892},"https://discord.com/developers/applications/",[178],[3894],{"type":45,"value":3891},{"type":45,"value":1463},{"type":39,"tag":40,"props":3897,"children":3899},{"id":3898},"setting-up-the-interactions-endpoint-url-for-our-slash-command",[3900],{"type":45,"value":3901},"Setting up the Interactions Endpoint URL for our Slash Command",{"type":39,"tag":48,"props":3903,"children":3904},{},[3905,3907,3912,3914,3921],{"type":45,"value":3906},"In order for our Slash Command to do anything, we need to set up URL that Discord will ",{"type":39,"tag":339,"props":3908,"children":3910},{"className":3909},[],[3911],{"type":45,"value":2674},{"type":45,"value":3913}," the Interaction event data to, including information such as who sent the Interaction, what channel it was sent on, what options were used, etc. You can see an example of the event payload ",{"type":39,"tag":85,"props":3915,"children":3918},{"href":3916,"rel":3917},"https://discord.com/developers/docs/interactions/slash-commands#receiving-an-interaction",[178],[3919],{"type":45,"value":3920},"here on the Discord developer documentation",{"type":45,"value":2585},{"type":39,"tag":563,"props":3923,"children":3925},{"code":3924,"language":566,"meta":8,"className":567,"style":8},"{\n    \"type\": 2,\n    \"token\": \"A_UNIQUE_TOKEN\",\n    \"member\": {\n        \"user\": {\n            \"id\": 53908232506183680,\n            \"username\": \"Mason\",\n            \"avatar\": \"a_d5efa99b3eeaa7dd43acca82f5692432\",\n            \"discriminator\": \"1337\",\n            \"public_flags\": 131141\n        },\n        \"roles\": [\"539082325061836999\"],\n        \"premium_since\": null,\n        \"permissions\": \"2147483647\",\n        \"pending\": false,\n        \"nick\": null,\n        \"mute\": false,\n        \"joined_at\": \"2017-03-13T19:19:14.040000+00:00\",\n        \"is_pending\": false,\n        \"deaf\": false\n    },\n    \"id\": \"786008729715212338\",\n    \"guild_id\": \"290926798626357999\",\n    \"data\": {\n        \"options\": [{\n            \"name\": \"cardname\",\n            \"value\": \"The Gitrog Monster\"\n        }],\n        \"name\": \"cardsearch\",\n        \"id\": \"771825006014889984\"\n    },\n    \"channel_id\": \"645027906669510667\"\n}\n",[3926],{"type":39,"tag":339,"props":3927,"children":3928},{"__ignoreMap":8},[3929,3936,3956,3977,3990,4002,4023,4044,4065,4086,4103,4110,4133,4154,4175,4196,4216,4236,4257,4277,4294,4302,4323,4344,4356,4369,4389,4406,4414,4435,4452,4459,4476],{"type":39,"tag":573,"props":3930,"children":3931},{"class":575,"line":576},[3932],{"type":39,"tag":573,"props":3933,"children":3934},{"style":580},[3935],{"type":45,"value":583},{"type":39,"tag":573,"props":3937,"children":3938},{"class":575,"line":586},[3939,3944,3948,3952],{"type":39,"tag":573,"props":3940,"children":3941},{"style":590},[3942],{"type":45,"value":3943},"    \"type\"",{"type":39,"tag":573,"props":3945,"children":3946},{"style":580},[3947],{"type":45,"value":598},{"type":39,"tag":573,"props":3949,"children":3950},{"style":1003},[3951],{"type":45,"value":1006},{"type":39,"tag":573,"props":3953,"children":3954},{"style":580},[3955],{"type":45,"value":609},{"type":39,"tag":573,"props":3957,"children":3958},{"class":575,"line":612},[3959,3964,3968,3973],{"type":39,"tag":573,"props":3960,"children":3961},{"style":590},[3962],{"type":45,"value":3963},"    \"token\"",{"type":39,"tag":573,"props":3965,"children":3966},{"style":580},[3967],{"type":45,"value":598},{"type":39,"tag":573,"props":3969,"children":3970},{"style":601},[3971],{"type":45,"value":3972},"\"A_UNIQUE_TOKEN\"",{"type":39,"tag":573,"props":3974,"children":3975},{"style":580},[3976],{"type":45,"value":609},{"type":39,"tag":573,"props":3978,"children":3979},{"class":575,"line":634},[3980,3985],{"type":39,"tag":573,"props":3981,"children":3982},{"style":590},[3983],{"type":45,"value":3984},"    \"member\"",{"type":39,"tag":573,"props":3986,"children":3987},{"style":580},[3988],{"type":45,"value":3989},": {\n",{"type":39,"tag":573,"props":3991,"children":3992},{"class":575,"line":656},[3993,3998],{"type":39,"tag":573,"props":3994,"children":3995},{"style":590},[3996],{"type":45,"value":3997},"        \"user\"",{"type":39,"tag":573,"props":3999,"children":4000},{"style":580},[4001],{"type":45,"value":3989},{"type":39,"tag":573,"props":4003,"children":4004},{"class":575,"line":678},[4005,4010,4014,4019],{"type":39,"tag":573,"props":4006,"children":4007},{"style":590},[4008],{"type":45,"value":4009},"            \"id\"",{"type":39,"tag":573,"props":4011,"children":4012},{"style":580},[4013],{"type":45,"value":598},{"type":39,"tag":573,"props":4015,"children":4016},{"style":1003},[4017],{"type":45,"value":4018},"53908232506183680",{"type":39,"tag":573,"props":4020,"children":4021},{"style":580},[4022],{"type":45,"value":609},{"type":39,"tag":573,"props":4024,"children":4025},{"class":575,"line":696},[4026,4031,4035,4040],{"type":39,"tag":573,"props":4027,"children":4028},{"style":590},[4029],{"type":45,"value":4030},"            \"username\"",{"type":39,"tag":573,"props":4032,"children":4033},{"style":580},[4034],{"type":45,"value":598},{"type":39,"tag":573,"props":4036,"children":4037},{"style":601},[4038],{"type":45,"value":4039},"\"Mason\"",{"type":39,"tag":573,"props":4041,"children":4042},{"style":580},[4043],{"type":45,"value":609},{"type":39,"tag":573,"props":4045,"children":4046},{"class":575,"line":1800},[4047,4052,4056,4061],{"type":39,"tag":573,"props":4048,"children":4049},{"style":590},[4050],{"type":45,"value":4051},"            \"avatar\"",{"type":39,"tag":573,"props":4053,"children":4054},{"style":580},[4055],{"type":45,"value":598},{"type":39,"tag":573,"props":4057,"children":4058},{"style":601},[4059],{"type":45,"value":4060},"\"a_d5efa99b3eeaa7dd43acca82f5692432\"",{"type":39,"tag":573,"props":4062,"children":4063},{"style":580},[4064],{"type":45,"value":609},{"type":39,"tag":573,"props":4066,"children":4067},{"class":575,"line":1814},[4068,4073,4077,4082],{"type":39,"tag":573,"props":4069,"children":4070},{"style":590},[4071],{"type":45,"value":4072},"            \"discriminator\"",{"type":39,"tag":573,"props":4074,"children":4075},{"style":580},[4076],{"type":45,"value":598},{"type":39,"tag":573,"props":4078,"children":4079},{"style":601},[4080],{"type":45,"value":4081},"\"1337\"",{"type":39,"tag":573,"props":4083,"children":4084},{"style":580},[4085],{"type":45,"value":609},{"type":39,"tag":573,"props":4087,"children":4088},{"class":575,"line":1847},[4089,4094,4098],{"type":39,"tag":573,"props":4090,"children":4091},{"style":590},[4092],{"type":45,"value":4093},"            \"public_flags\"",{"type":39,"tag":573,"props":4095,"children":4096},{"style":580},[4097],{"type":45,"value":598},{"type":39,"tag":573,"props":4099,"children":4100},{"style":1003},[4101],{"type":45,"value":4102},"131141\n",{"type":39,"tag":573,"props":4104,"children":4105},{"class":575,"line":1855},[4106],{"type":39,"tag":573,"props":4107,"children":4108},{"style":580},[4109],{"type":45,"value":3608},{"type":39,"tag":573,"props":4111,"children":4112},{"class":575,"line":3182},[4113,4118,4123,4128],{"type":39,"tag":573,"props":4114,"children":4115},{"style":590},[4116],{"type":45,"value":4117},"        \"roles\"",{"type":39,"tag":573,"props":4119,"children":4120},{"style":580},[4121],{"type":45,"value":4122},": [",{"type":39,"tag":573,"props":4124,"children":4125},{"style":601},[4126],{"type":45,"value":4127},"\"539082325061836999\"",{"type":39,"tag":573,"props":4129,"children":4130},{"style":580},[4131],{"type":45,"value":4132},"],\n",{"type":39,"tag":573,"props":4134,"children":4135},{"class":575,"line":3190},[4136,4141,4145,4150],{"type":39,"tag":573,"props":4137,"children":4138},{"style":590},[4139],{"type":45,"value":4140},"        \"premium_since\"",{"type":39,"tag":573,"props":4142,"children":4143},{"style":580},[4144],{"type":45,"value":598},{"type":39,"tag":573,"props":4146,"children":4147},{"style":1003},[4148],{"type":45,"value":4149},"null",{"type":39,"tag":573,"props":4151,"children":4152},{"style":580},[4153],{"type":45,"value":609},{"type":39,"tag":573,"props":4155,"children":4156},{"class":575,"line":3233},[4157,4162,4166,4171],{"type":39,"tag":573,"props":4158,"children":4159},{"style":590},[4160],{"type":45,"value":4161},"        \"permissions\"",{"type":39,"tag":573,"props":4163,"children":4164},{"style":580},[4165],{"type":45,"value":598},{"type":39,"tag":573,"props":4167,"children":4168},{"style":601},[4169],{"type":45,"value":4170},"\"2147483647\"",{"type":39,"tag":573,"props":4172,"children":4173},{"style":580},[4174],{"type":45,"value":609},{"type":39,"tag":573,"props":4176,"children":4177},{"class":575,"line":3241},[4178,4183,4187,4192],{"type":39,"tag":573,"props":4179,"children":4180},{"style":590},[4181],{"type":45,"value":4182},"        \"pending\"",{"type":39,"tag":573,"props":4184,"children":4185},{"style":580},[4186],{"type":45,"value":598},{"type":39,"tag":573,"props":4188,"children":4189},{"style":1003},[4190],{"type":45,"value":4191},"false",{"type":39,"tag":573,"props":4193,"children":4194},{"style":580},[4195],{"type":45,"value":609},{"type":39,"tag":573,"props":4197,"children":4198},{"class":575,"line":3258},[4199,4204,4208,4212],{"type":39,"tag":573,"props":4200,"children":4201},{"style":590},[4202],{"type":45,"value":4203},"        \"nick\"",{"type":39,"tag":573,"props":4205,"children":4206},{"style":580},[4207],{"type":45,"value":598},{"type":39,"tag":573,"props":4209,"children":4210},{"style":1003},[4211],{"type":45,"value":4149},{"type":39,"tag":573,"props":4213,"children":4214},{"style":580},[4215],{"type":45,"value":609},{"type":39,"tag":573,"props":4217,"children":4218},{"class":575,"line":3280},[4219,4224,4228,4232],{"type":39,"tag":573,"props":4220,"children":4221},{"style":590},[4222],{"type":45,"value":4223},"        \"mute\"",{"type":39,"tag":573,"props":4225,"children":4226},{"style":580},[4227],{"type":45,"value":598},{"type":39,"tag":573,"props":4229,"children":4230},{"style":1003},[4231],{"type":45,"value":4191},{"type":39,"tag":573,"props":4233,"children":4234},{"style":580},[4235],{"type":45,"value":609},{"type":39,"tag":573,"props":4237,"children":4238},{"class":575,"line":3302},[4239,4244,4248,4253],{"type":39,"tag":573,"props":4240,"children":4241},{"style":590},[4242],{"type":45,"value":4243},"        \"joined_at\"",{"type":39,"tag":573,"props":4245,"children":4246},{"style":580},[4247],{"type":45,"value":598},{"type":39,"tag":573,"props":4249,"children":4250},{"style":601},[4251],{"type":45,"value":4252},"\"2017-03-13T19:19:14.040000+00:00\"",{"type":39,"tag":573,"props":4254,"children":4255},{"style":580},[4256],{"type":45,"value":609},{"type":39,"tag":573,"props":4258,"children":4259},{"class":575,"line":3316},[4260,4265,4269,4273],{"type":39,"tag":573,"props":4261,"children":4262},{"style":590},[4263],{"type":45,"value":4264},"        \"is_pending\"",{"type":39,"tag":573,"props":4266,"children":4267},{"style":580},[4268],{"type":45,"value":598},{"type":39,"tag":573,"props":4270,"children":4271},{"style":1003},[4272],{"type":45,"value":4191},{"type":39,"tag":573,"props":4274,"children":4275},{"style":580},[4276],{"type":45,"value":609},{"type":39,"tag":573,"props":4278,"children":4279},{"class":575,"line":3325},[4280,4285,4289],{"type":39,"tag":573,"props":4281,"children":4282},{"style":590},[4283],{"type":45,"value":4284},"        \"deaf\"",{"type":39,"tag":573,"props":4286,"children":4287},{"style":580},[4288],{"type":45,"value":598},{"type":39,"tag":573,"props":4290,"children":4291},{"style":1003},[4292],{"type":45,"value":4293},"false\n",{"type":39,"tag":573,"props":4295,"children":4296},{"class":575,"line":3347},[4297],{"type":39,"tag":573,"props":4298,"children":4299},{"style":580},[4300],{"type":45,"value":4301},"    },\n",{"type":39,"tag":573,"props":4303,"children":4304},{"class":575,"line":3369},[4305,4310,4314,4319],{"type":39,"tag":573,"props":4306,"children":4307},{"style":590},[4308],{"type":45,"value":4309},"    \"id\"",{"type":39,"tag":573,"props":4311,"children":4312},{"style":580},[4313],{"type":45,"value":598},{"type":39,"tag":573,"props":4315,"children":4316},{"style":601},[4317],{"type":45,"value":4318},"\"786008729715212338\"",{"type":39,"tag":573,"props":4320,"children":4321},{"style":580},[4322],{"type":45,"value":609},{"type":39,"tag":573,"props":4324,"children":4325},{"class":575,"line":3391},[4326,4331,4335,4340],{"type":39,"tag":573,"props":4327,"children":4328},{"style":590},[4329],{"type":45,"value":4330},"    \"guild_id\"",{"type":39,"tag":573,"props":4332,"children":4333},{"style":580},[4334],{"type":45,"value":598},{"type":39,"tag":573,"props":4336,"children":4337},{"style":601},[4338],{"type":45,"value":4339},"\"290926798626357999\"",{"type":39,"tag":573,"props":4341,"children":4342},{"style":580},[4343],{"type":45,"value":609},{"type":39,"tag":573,"props":4345,"children":4346},{"class":575,"line":3413},[4347,4352],{"type":39,"tag":573,"props":4348,"children":4349},{"style":590},[4350],{"type":45,"value":4351},"    \"data\"",{"type":39,"tag":573,"props":4353,"children":4354},{"style":580},[4355],{"type":45,"value":3989},{"type":39,"tag":573,"props":4357,"children":4358},{"class":575,"line":3426},[4359,4364],{"type":39,"tag":573,"props":4360,"children":4361},{"style":590},[4362],{"type":45,"value":4363},"        \"options\"",{"type":39,"tag":573,"props":4365,"children":4366},{"style":580},[4367],{"type":45,"value":4368},": [{\n",{"type":39,"tag":573,"props":4370,"children":4371},{"class":575,"line":3435},[4372,4376,4380,4385],{"type":39,"tag":573,"props":4373,"children":4374},{"style":590},[4375],{"type":45,"value":3331},{"type":39,"tag":573,"props":4377,"children":4378},{"style":580},[4379],{"type":45,"value":598},{"type":39,"tag":573,"props":4381,"children":4382},{"style":601},[4383],{"type":45,"value":4384},"\"cardname\"",{"type":39,"tag":573,"props":4386,"children":4387},{"style":580},[4388],{"type":45,"value":609},{"type":39,"tag":573,"props":4390,"children":4391},{"class":575,"line":3457},[4392,4397,4401],{"type":39,"tag":573,"props":4393,"children":4394},{"style":590},[4395],{"type":45,"value":4396},"            \"value\"",{"type":39,"tag":573,"props":4398,"children":4399},{"style":580},[4400],{"type":45,"value":598},{"type":39,"tag":573,"props":4402,"children":4403},{"style":601},[4404],{"type":45,"value":4405},"\"The Gitrog Monster\"\n",{"type":39,"tag":573,"props":4407,"children":4408},{"class":575,"line":3475},[4409],{"type":39,"tag":573,"props":4410,"children":4411},{"style":580},[4412],{"type":45,"value":4413},"        }],\n",{"type":39,"tag":573,"props":4415,"children":4416},{"class":575,"line":3484},[4417,4422,4426,4431],{"type":39,"tag":573,"props":4418,"children":4419},{"style":590},[4420],{"type":45,"value":4421},"        \"name\"",{"type":39,"tag":573,"props":4423,"children":4424},{"style":580},[4425],{"type":45,"value":598},{"type":39,"tag":573,"props":4427,"children":4428},{"style":601},[4429],{"type":45,"value":4430},"\"cardsearch\"",{"type":39,"tag":573,"props":4432,"children":4433},{"style":580},[4434],{"type":45,"value":609},{"type":39,"tag":573,"props":4436,"children":4437},{"class":575,"line":3492},[4438,4443,4447],{"type":39,"tag":573,"props":4439,"children":4440},{"style":590},[4441],{"type":45,"value":4442},"        \"id\"",{"type":39,"tag":573,"props":4444,"children":4445},{"style":580},[4446],{"type":45,"value":598},{"type":39,"tag":573,"props":4448,"children":4449},{"style":601},[4450],{"type":45,"value":4451},"\"771825006014889984\"\n",{"type":39,"tag":573,"props":4453,"children":4454},{"class":575,"line":3513},[4455],{"type":39,"tag":573,"props":4456,"children":4457},{"style":580},[4458],{"type":45,"value":4301},{"type":39,"tag":573,"props":4460,"children":4461},{"class":575,"line":3530},[4462,4467,4471],{"type":39,"tag":573,"props":4463,"children":4464},{"style":590},[4465],{"type":45,"value":4466},"    \"channel_id\"",{"type":39,"tag":573,"props":4468,"children":4469},{"style":580},[4470],{"type":45,"value":598},{"type":39,"tag":573,"props":4472,"children":4473},{"style":601},[4474],{"type":45,"value":4475},"\"645027906669510667\"\n",{"type":39,"tag":573,"props":4477,"children":4478},{"class":575,"line":3538},[4479],{"type":39,"tag":573,"props":4480,"children":4481},{"style":580},[4482],{"type":45,"value":702},{"type":39,"tag":48,"props":4484,"children":4485},{},[4486,4488,4493,4495,4501],{"type":45,"value":4487},"This ",{"type":39,"tag":339,"props":4489,"children":4491},{"className":4490},[],[4492],{"type":45,"value":2674},{"type":45,"value":4494}," request also includes some special headers used for security that we will need to do validation with our handling function. This part can be handled with a decorator provided by the ",{"type":39,"tag":339,"props":4496,"children":4498},{"className":4497},[],[4499],{"type":45,"value":4500},"discord-interactions",{"type":45,"value":4502}," package on PyPI, but we will need to add some additional configuration to our API Gateway endpoint since these headers will not be passed through the lambda by default.",{"type":39,"tag":40,"props":4504,"children":4506},{"id":4505},"setting-up-aws-infrastructure-with-cdk",[4507],{"type":45,"value":4508},"Setting up AWS infrastructure with CDK",{"type":39,"tag":48,"props":4510,"children":4511},{},[4512,4514,4520],{"type":45,"value":4513},"Let's start a CDK project in a blank repository that will define our infrastructure, Lambda functions and CI/CD pipeline with GitLab CI. Make sure that you have the ",{"type":39,"tag":339,"props":4515,"children":4517},{"className":4516},[],[4518],{"type":45,"value":4519},"aws-cdk",{"type":45,"value":4521}," CLI installed globally:",{"type":39,"tag":563,"props":4523,"children":4525},{"code":4524},"npm i -g aws-cdk\n",[4526],{"type":39,"tag":339,"props":4527,"children":4528},{"__ignoreMap":8},[4529],{"type":45,"value":4524},{"type":39,"tag":48,"props":4531,"children":4532},{},[4533,4535,4541],{"type":45,"value":4534},"Then start a CDK project in a subdirectory called ",{"type":39,"tag":339,"props":4536,"children":4538},{"className":4537},[],[4539],{"type":45,"value":4540},"cdk",{"type":45,"value":4542}," with:",{"type":39,"tag":563,"props":4544,"children":4546},{"code":4545},"mkdir cdk && cd cdk && cdk init app --language=python\n",[4547],{"type":39,"tag":339,"props":4548,"children":4549},{"__ignoreMap":8},[4550],{"type":45,"value":4545},{"type":39,"tag":931,"props":4552,"children":4554},{"id":4553},"add-cdk-project-dependencies",[4555],{"type":45,"value":4556},"Add CDK project dependencies",{"type":39,"tag":48,"props":4558,"children":4559},{},[4560,4562,4568],{"type":45,"value":4561},"The next step is to add all of the dependencies to our CDK project that we will use in this project. In ",{"type":39,"tag":339,"props":4563,"children":4565},{"className":4564},[],[4566],{"type":45,"value":4567},"setup.py",{"type":45,"value":4569}," add the following:",{"type":39,"tag":563,"props":4571,"children":4573},{"code":4572,"language":3027,"meta":8,"className":3028,"style":8},"    install_requires=[\n        \"aws-cdk.core==1.92.0\",\n        \"aws-cdk.aws_applicationautoscaling==1.92.0\",\n        \"aws-cdk.aws_datasync==1.92.0\",\n        \"aws-cdk.aws_lambda==1.92.0\",\n        \"aws-cdk.aws_s3==1.92.0\",\n        \"aws-cdk.aws_apigateway==1.92.0\",\n        \"cdk-valheim==0.0.16\",\n    ],\n",[4574],{"type":39,"tag":339,"props":4575,"children":4576},{"__ignoreMap":8},[4577,4594,4606,4618,4630,4642,4654,4666,4678],{"type":39,"tag":573,"props":4578,"children":4579},{"class":575,"line":576},[4580,4585,4589],{"type":39,"tag":573,"props":4581,"children":4582},{"style":580},[4583],{"type":45,"value":4584},"    install_requires",{"type":39,"tag":573,"props":4586,"children":4587},{"style":968},[4588],{"type":45,"value":1896},{"type":39,"tag":573,"props":4590,"children":4591},{"style":580},[4592],{"type":45,"value":4593},"[\n",{"type":39,"tag":573,"props":4595,"children":4596},{"class":575,"line":586},[4597,4602],{"type":39,"tag":573,"props":4598,"children":4599},{"style":783},[4600],{"type":45,"value":4601},"        \"aws-cdk.core==1.92.0\"",{"type":39,"tag":573,"props":4603,"children":4604},{"style":580},[4605],{"type":45,"value":609},{"type":39,"tag":573,"props":4607,"children":4608},{"class":575,"line":612},[4609,4614],{"type":39,"tag":573,"props":4610,"children":4611},{"style":783},[4612],{"type":45,"value":4613},"        \"aws-cdk.aws_applicationautoscaling==1.92.0\"",{"type":39,"tag":573,"props":4615,"children":4616},{"style":580},[4617],{"type":45,"value":609},{"type":39,"tag":573,"props":4619,"children":4620},{"class":575,"line":634},[4621,4626],{"type":39,"tag":573,"props":4622,"children":4623},{"style":783},[4624],{"type":45,"value":4625},"        \"aws-cdk.aws_datasync==1.92.0\"",{"type":39,"tag":573,"props":4627,"children":4628},{"style":580},[4629],{"type":45,"value":609},{"type":39,"tag":573,"props":4631,"children":4632},{"class":575,"line":656},[4633,4638],{"type":39,"tag":573,"props":4634,"children":4635},{"style":783},[4636],{"type":45,"value":4637},"        \"aws-cdk.aws_lambda==1.92.0\"",{"type":39,"tag":573,"props":4639,"children":4640},{"style":580},[4641],{"type":45,"value":609},{"type":39,"tag":573,"props":4643,"children":4644},{"class":575,"line":678},[4645,4650],{"type":39,"tag":573,"props":4646,"children":4647},{"style":783},[4648],{"type":45,"value":4649},"        \"aws-cdk.aws_s3==1.92.0\"",{"type":39,"tag":573,"props":4651,"children":4652},{"style":580},[4653],{"type":45,"value":609},{"type":39,"tag":573,"props":4655,"children":4656},{"class":575,"line":696},[4657,4662],{"type":39,"tag":573,"props":4658,"children":4659},{"style":783},[4660],{"type":45,"value":4661},"        \"aws-cdk.aws_apigateway==1.92.0\"",{"type":39,"tag":573,"props":4663,"children":4664},{"style":580},[4665],{"type":45,"value":609},{"type":39,"tag":573,"props":4667,"children":4668},{"class":575,"line":1800},[4669,4674],{"type":39,"tag":573,"props":4670,"children":4671},{"style":783},[4672],{"type":45,"value":4673},"        \"cdk-valheim==0.0.16\"",{"type":39,"tag":573,"props":4675,"children":4676},{"style":580},[4677],{"type":45,"value":609},{"type":39,"tag":573,"props":4679,"children":4680},{"class":575,"line":1814},[4681],{"type":39,"tag":573,"props":4682,"children":4683},{"style":580},[4684],{"type":45,"value":4685},"    ],\n",{"type":39,"tag":48,"props":4687,"children":4688},{},[4689,4691,4697,4699,4705,4707,4712],{"type":45,"value":4690},"Next we can add the CDK construct for ",{"type":39,"tag":339,"props":4692,"children":4694},{"className":4693},[],[4695],{"type":45,"value":4696},"ValheimWorld",{"type":45,"value":4698}," in the ",{"type":39,"tag":339,"props":4700,"children":4702},{"className":4701},[],[4703],{"type":45,"value":4704},"cdk_stack.py",{"type":45,"value":4706}," file that was generated in our project as well as the imports for the packages we included in ",{"type":39,"tag":339,"props":4708,"children":4710},{"className":4709},[],[4711],{"type":45,"value":4567},{"type":45,"value":2585},{"type":39,"tag":563,"props":4714,"children":4716},{"code":4715,"language":3027,"meta":8,"className":3028,"style":8},"from aws_cdk import core as cdk\n\nfrom aws_cdk import (\n    core,\n    aws_datasync as datasync,\n    aws_iam as iam,\n    aws_lambda as _lambda,\n    aws_apigateway as apigw,\n    aws_applicationautoscaling as appScaling,\n    aws_s3 as s3,\n)\nfrom cdk_valheim import ValheimWorld, ValheimWorldScalingSchedule\n\n\nclass CdkStack(cdk.Stack):\n\n    def __init__(self, scope: cdk.Construct, construct_id: str, **kwargs) -> None:\n        super().__init__(scope, construct_id, **kwargs)\n        # The code that defines your stack goes here\n        self.valheim_world = ValheimWorld(\n            self,\n            'ValheimWorld',\n            cpu=2048,\n            memory_limit_mib=4096,\n            schedules=[ValheimWorldScalingSchedule(\n                start=appScaling.CronOptions(hour='12', week_day='1-5'),\n                stop=appScaling.CronOptions(hour='1', week_day='1-5'),\n            )],\n            environment={\n                \"SERVER_NAME\": os.environ.get(\"SERVER_NAME\", \"CDK Valheim\"),\n                \"WORLD_NAME\": os.environ.get(\"WORLD_NAME\", \"Amazon\"),\n                \"SERVER_PASS\": os.environ.get(\"SERVER_PASS\", \"fargate\"),\n                \"BACKUPS\": 'false',\n            })\n",[4717],{"type":39,"tag":339,"props":4718,"children":4719},{"__ignoreMap":8},[4720,4751,4758,4778,4786,4803,4820,4837,4854,4871,4888,4895,4916,4923,4930,4966,4973,5052,5084,5092,5114,5126,5138,5159,5180,5197,5251,5300,5308,5324,5355,5385,5415,5436],{"type":39,"tag":573,"props":4721,"children":4722},{"class":575,"line":576},[4723,4728,4733,4737,4742,4746],{"type":39,"tag":573,"props":4724,"children":4725},{"style":968},[4726],{"type":45,"value":4727},"from",{"type":39,"tag":573,"props":4729,"children":4730},{"style":580},[4731],{"type":45,"value":4732}," aws_cdk ",{"type":39,"tag":573,"props":4734,"children":4735},{"style":968},[4736],{"type":45,"value":3070},{"type":39,"tag":573,"props":4738,"children":4739},{"style":580},[4740],{"type":45,"value":4741}," core ",{"type":39,"tag":573,"props":4743,"children":4744},{"style":968},[4745],{"type":45,"value":1289},{"type":39,"tag":573,"props":4747,"children":4748},{"style":580},[4749],{"type":45,"value":4750}," cdk\n",{"type":39,"tag":573,"props":4752,"children":4753},{"class":575,"line":586},[4754],{"type":39,"tag":573,"props":4755,"children":4756},{"emptyLinePlaceholder":34},[4757],{"type":45,"value":1722},{"type":39,"tag":573,"props":4759,"children":4760},{"class":575,"line":612},[4761,4765,4769,4773],{"type":39,"tag":573,"props":4762,"children":4763},{"style":968},[4764],{"type":45,"value":4727},{"type":39,"tag":573,"props":4766,"children":4767},{"style":580},[4768],{"type":45,"value":4732},{"type":39,"tag":573,"props":4770,"children":4771},{"style":968},[4772],{"type":45,"value":3070},{"type":39,"tag":573,"props":4774,"children":4775},{"style":580},[4776],{"type":45,"value":4777}," (\n",{"type":39,"tag":573,"props":4779,"children":4780},{"class":575,"line":634},[4781],{"type":39,"tag":573,"props":4782,"children":4783},{"style":580},[4784],{"type":45,"value":4785},"    core,\n",{"type":39,"tag":573,"props":4787,"children":4788},{"class":575,"line":656},[4789,4794,4798],{"type":39,"tag":573,"props":4790,"children":4791},{"style":580},[4792],{"type":45,"value":4793},"    aws_datasync ",{"type":39,"tag":573,"props":4795,"children":4796},{"style":968},[4797],{"type":45,"value":1289},{"type":39,"tag":573,"props":4799,"children":4800},{"style":580},[4801],{"type":45,"value":4802}," datasync,\n",{"type":39,"tag":573,"props":4804,"children":4805},{"class":575,"line":678},[4806,4811,4815],{"type":39,"tag":573,"props":4807,"children":4808},{"style":580},[4809],{"type":45,"value":4810},"    aws_iam ",{"type":39,"tag":573,"props":4812,"children":4813},{"style":968},[4814],{"type":45,"value":1289},{"type":39,"tag":573,"props":4816,"children":4817},{"style":580},[4818],{"type":45,"value":4819}," iam,\n",{"type":39,"tag":573,"props":4821,"children":4822},{"class":575,"line":696},[4823,4828,4832],{"type":39,"tag":573,"props":4824,"children":4825},{"style":580},[4826],{"type":45,"value":4827},"    aws_lambda ",{"type":39,"tag":573,"props":4829,"children":4830},{"style":968},[4831],{"type":45,"value":1289},{"type":39,"tag":573,"props":4833,"children":4834},{"style":580},[4835],{"type":45,"value":4836}," _lambda,\n",{"type":39,"tag":573,"props":4838,"children":4839},{"class":575,"line":1800},[4840,4845,4849],{"type":39,"tag":573,"props":4841,"children":4842},{"style":580},[4843],{"type":45,"value":4844},"    aws_apigateway ",{"type":39,"tag":573,"props":4846,"children":4847},{"style":968},[4848],{"type":45,"value":1289},{"type":39,"tag":573,"props":4850,"children":4851},{"style":580},[4852],{"type":45,"value":4853}," apigw,\n",{"type":39,"tag":573,"props":4855,"children":4856},{"class":575,"line":1814},[4857,4862,4866],{"type":39,"tag":573,"props":4858,"children":4859},{"style":580},[4860],{"type":45,"value":4861},"    aws_applicationautoscaling ",{"type":39,"tag":573,"props":4863,"children":4864},{"style":968},[4865],{"type":45,"value":1289},{"type":39,"tag":573,"props":4867,"children":4868},{"style":580},[4869],{"type":45,"value":4870}," appScaling,\n",{"type":39,"tag":573,"props":4872,"children":4873},{"class":575,"line":1847},[4874,4879,4883],{"type":39,"tag":573,"props":4875,"children":4876},{"style":580},[4877],{"type":45,"value":4878},"    aws_s3 ",{"type":39,"tag":573,"props":4880,"children":4881},{"style":968},[4882],{"type":45,"value":1289},{"type":39,"tag":573,"props":4884,"children":4885},{"style":580},[4886],{"type":45,"value":4887}," s3,\n",{"type":39,"tag":573,"props":4889,"children":4890},{"class":575,"line":1855},[4891],{"type":39,"tag":573,"props":4892,"children":4893},{"style":580},[4894],{"type":45,"value":3129},{"type":39,"tag":573,"props":4896,"children":4897},{"class":575,"line":3182},[4898,4902,4907,4911],{"type":39,"tag":573,"props":4899,"children":4900},{"style":968},[4901],{"type":45,"value":4727},{"type":39,"tag":573,"props":4903,"children":4904},{"style":580},[4905],{"type":45,"value":4906}," cdk_valheim ",{"type":39,"tag":573,"props":4908,"children":4909},{"style":968},[4910],{"type":45,"value":3070},{"type":39,"tag":573,"props":4912,"children":4913},{"style":580},[4914],{"type":45,"value":4915}," ValheimWorld, ValheimWorldScalingSchedule\n",{"type":39,"tag":573,"props":4917,"children":4918},{"class":575,"line":3190},[4919],{"type":39,"tag":573,"props":4920,"children":4921},{"emptyLinePlaceholder":34},[4922],{"type":45,"value":1722},{"type":39,"tag":573,"props":4924,"children":4925},{"class":575,"line":3233},[4926],{"type":39,"tag":573,"props":4927,"children":4928},{"emptyLinePlaceholder":34},[4929],{"type":45,"value":1722},{"type":39,"tag":573,"props":4931,"children":4932},{"class":575,"line":3241},[4933,4938,4943,4947,4952,4956,4961],{"type":39,"tag":573,"props":4934,"children":4935},{"style":1580},[4936],{"type":45,"value":4937},"class",{"type":39,"tag":573,"props":4939,"children":4940},{"style":1564},[4941],{"type":45,"value":4942}," CdkStack",{"type":39,"tag":573,"props":4944,"children":4945},{"style":580},[4946],{"type":45,"value":1533},{"type":39,"tag":573,"props":4948,"children":4950},{"style":4949},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[4951],{"type":45,"value":4540},{"type":39,"tag":573,"props":4953,"children":4954},{"style":580},[4955],{"type":45,"value":183},{"type":39,"tag":573,"props":4957,"children":4958},{"style":4949},[4959],{"type":45,"value":4960},"Stack",{"type":39,"tag":573,"props":4962,"children":4963},{"style":580},[4964],{"type":45,"value":4965},"):\n",{"type":39,"tag":573,"props":4967,"children":4968},{"class":575,"line":3258},[4969],{"type":39,"tag":573,"props":4970,"children":4971},{"emptyLinePlaceholder":34},[4972],{"type":45,"value":1722},{"type":39,"tag":573,"props":4974,"children":4975},{"class":575,"line":3280},[4976,4981,4986,4990,4996,5000,5005,5010,5015,5019,5024,5028,5033,5038,5043,5048],{"type":39,"tag":573,"props":4977,"children":4978},{"style":1580},[4979],{"type":45,"value":4980},"    def",{"type":39,"tag":573,"props":4982,"children":4983},{"style":3781},[4984],{"type":45,"value":4985}," __init__",{"type":39,"tag":573,"props":4987,"children":4988},{"style":580},[4989],{"type":45,"value":1533},{"type":39,"tag":573,"props":4991,"children":4993},{"style":4992},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[4994],{"type":45,"value":4995},"self",{"type":39,"tag":573,"props":4997,"children":4998},{"style":580},[4999],{"type":45,"value":1577},{"type":39,"tag":573,"props":5001,"children":5002},{"style":4992},[5003],{"type":45,"value":5004},"scope",{"type":39,"tag":573,"props":5006,"children":5007},{"style":580},[5008],{"type":45,"value":5009},": cdk.Construct, ",{"type":39,"tag":573,"props":5011,"children":5012},{"style":4992},[5013],{"type":45,"value":5014},"construct_id",{"type":39,"tag":573,"props":5016,"children":5017},{"style":580},[5018],{"type":45,"value":598},{"type":39,"tag":573,"props":5020,"children":5021},{"style":590},[5022],{"type":45,"value":5023},"str",{"type":39,"tag":573,"props":5025,"children":5026},{"style":580},[5027],{"type":45,"value":1577},{"type":39,"tag":573,"props":5029,"children":5030},{"style":968},[5031],{"type":45,"value":5032},"**",{"type":39,"tag":573,"props":5034,"children":5035},{"style":4992},[5036],{"type":45,"value":5037},"kwargs",{"type":39,"tag":573,"props":5039,"children":5040},{"style":580},[5041],{"type":45,"value":5042},") -> ",{"type":39,"tag":573,"props":5044,"children":5045},{"style":1003},[5046],{"type":45,"value":5047},"None",{"type":39,"tag":573,"props":5049,"children":5050},{"style":580},[5051],{"type":45,"value":3729},{"type":39,"tag":573,"props":5053,"children":5054},{"class":575,"line":3302},[5055,5060,5065,5070,5075,5079],{"type":39,"tag":573,"props":5056,"children":5057},{"style":590},[5058],{"type":45,"value":5059},"        super",{"type":39,"tag":573,"props":5061,"children":5062},{"style":580},[5063],{"type":45,"value":5064},"().",{"type":39,"tag":573,"props":5066,"children":5067},{"style":3781},[5068],{"type":45,"value":5069},"__init__",{"type":39,"tag":573,"props":5071,"children":5072},{"style":580},[5073],{"type":45,"value":5074},"(scope, construct_id, ",{"type":39,"tag":573,"props":5076,"children":5077},{"style":968},[5078],{"type":45,"value":5032},{"type":39,"tag":573,"props":5080,"children":5081},{"style":580},[5082],{"type":45,"value":5083},"kwargs)\n",{"type":39,"tag":573,"props":5085,"children":5086},{"class":575,"line":3316},[5087],{"type":39,"tag":573,"props":5088,"children":5089},{"style":1495},[5090],{"type":45,"value":5091},"        # The code that defines your stack goes here\n",{"type":39,"tag":573,"props":5093,"children":5094},{"class":575,"line":3325},[5095,5100,5105,5109],{"type":39,"tag":573,"props":5096,"children":5097},{"style":1553},[5098],{"type":45,"value":5099},"        self",{"type":39,"tag":573,"props":5101,"children":5102},{"style":580},[5103],{"type":45,"value":5104},".valheim_world ",{"type":39,"tag":573,"props":5106,"children":5107},{"style":968},[5108],{"type":45,"value":1896},{"type":39,"tag":573,"props":5110,"children":5111},{"style":580},[5112],{"type":45,"value":5113}," ValheimWorld(\n",{"type":39,"tag":573,"props":5115,"children":5116},{"class":575,"line":3347},[5117,5122],{"type":39,"tag":573,"props":5118,"children":5119},{"style":1553},[5120],{"type":45,"value":5121},"            self",{"type":39,"tag":573,"props":5123,"children":5124},{"style":580},[5125],{"type":45,"value":609},{"type":39,"tag":573,"props":5127,"children":5128},{"class":575,"line":3369},[5129,5134],{"type":39,"tag":573,"props":5130,"children":5131},{"style":783},[5132],{"type":45,"value":5133},"            'ValheimWorld'",{"type":39,"tag":573,"props":5135,"children":5136},{"style":580},[5137],{"type":45,"value":609},{"type":39,"tag":573,"props":5139,"children":5140},{"class":575,"line":3391},[5141,5146,5150,5155],{"type":39,"tag":573,"props":5142,"children":5143},{"style":1569},[5144],{"type":45,"value":5145},"            cpu",{"type":39,"tag":573,"props":5147,"children":5148},{"style":968},[5149],{"type":45,"value":1896},{"type":39,"tag":573,"props":5151,"children":5152},{"style":1003},[5153],{"type":45,"value":5154},"2048",{"type":39,"tag":573,"props":5156,"children":5157},{"style":580},[5158],{"type":45,"value":609},{"type":39,"tag":573,"props":5160,"children":5161},{"class":575,"line":3413},[5162,5167,5171,5176],{"type":39,"tag":573,"props":5163,"children":5164},{"style":1569},[5165],{"type":45,"value":5166},"            memory_limit_mib",{"type":39,"tag":573,"props":5168,"children":5169},{"style":968},[5170],{"type":45,"value":1896},{"type":39,"tag":573,"props":5172,"children":5173},{"style":1003},[5174],{"type":45,"value":5175},"4096",{"type":39,"tag":573,"props":5177,"children":5178},{"style":580},[5179],{"type":45,"value":609},{"type":39,"tag":573,"props":5181,"children":5182},{"class":575,"line":3426},[5183,5188,5192],{"type":39,"tag":573,"props":5184,"children":5185},{"style":1569},[5186],{"type":45,"value":5187},"            schedules",{"type":39,"tag":573,"props":5189,"children":5190},{"style":968},[5191],{"type":45,"value":1896},{"type":39,"tag":573,"props":5193,"children":5194},{"style":580},[5195],{"type":45,"value":5196},"[ValheimWorldScalingSchedule(\n",{"type":39,"tag":573,"props":5198,"children":5199},{"class":575,"line":3435},[5200,5205,5209,5214,5219,5223,5228,5232,5237,5241,5246],{"type":39,"tag":573,"props":5201,"children":5202},{"style":1569},[5203],{"type":45,"value":5204},"                start",{"type":39,"tag":573,"props":5206,"children":5207},{"style":968},[5208],{"type":45,"value":1896},{"type":39,"tag":573,"props":5210,"children":5211},{"style":580},[5212],{"type":45,"value":5213},"appScaling.CronOptions(",{"type":39,"tag":573,"props":5215,"children":5216},{"style":1569},[5217],{"type":45,"value":5218},"hour",{"type":39,"tag":573,"props":5220,"children":5221},{"style":968},[5222],{"type":45,"value":1896},{"type":39,"tag":573,"props":5224,"children":5225},{"style":783},[5226],{"type":45,"value":5227},"'12'",{"type":39,"tag":573,"props":5229,"children":5230},{"style":580},[5231],{"type":45,"value":1577},{"type":39,"tag":573,"props":5233,"children":5234},{"style":1569},[5235],{"type":45,"value":5236},"week_day",{"type":39,"tag":573,"props":5238,"children":5239},{"style":968},[5240],{"type":45,"value":1896},{"type":39,"tag":573,"props":5242,"children":5243},{"style":783},[5244],{"type":45,"value":5245},"'1-5'",{"type":39,"tag":573,"props":5247,"children":5248},{"style":580},[5249],{"type":45,"value":5250},"),\n",{"type":39,"tag":573,"props":5252,"children":5253},{"class":575,"line":3457},[5254,5259,5263,5267,5271,5275,5280,5284,5288,5292,5296],{"type":39,"tag":573,"props":5255,"children":5256},{"style":1569},[5257],{"type":45,"value":5258},"                stop",{"type":39,"tag":573,"props":5260,"children":5261},{"style":968},[5262],{"type":45,"value":1896},{"type":39,"tag":573,"props":5264,"children":5265},{"style":580},[5266],{"type":45,"value":5213},{"type":39,"tag":573,"props":5268,"children":5269},{"style":1569},[5270],{"type":45,"value":5218},{"type":39,"tag":573,"props":5272,"children":5273},{"style":968},[5274],{"type":45,"value":1896},{"type":39,"tag":573,"props":5276,"children":5277},{"style":783},[5278],{"type":45,"value":5279},"'1'",{"type":39,"tag":573,"props":5281,"children":5282},{"style":580},[5283],{"type":45,"value":1577},{"type":39,"tag":573,"props":5285,"children":5286},{"style":1569},[5287],{"type":45,"value":5236},{"type":39,"tag":573,"props":5289,"children":5290},{"style":968},[5291],{"type":45,"value":1896},{"type":39,"tag":573,"props":5293,"children":5294},{"style":783},[5295],{"type":45,"value":5245},{"type":39,"tag":573,"props":5297,"children":5298},{"style":580},[5299],{"type":45,"value":5250},{"type":39,"tag":573,"props":5301,"children":5302},{"class":575,"line":3475},[5303],{"type":39,"tag":573,"props":5304,"children":5305},{"style":580},[5306],{"type":45,"value":5307},"            )],\n",{"type":39,"tag":573,"props":5309,"children":5310},{"class":575,"line":3484},[5311,5316,5320],{"type":39,"tag":573,"props":5312,"children":5313},{"style":1569},[5314],{"type":45,"value":5315},"            environment",{"type":39,"tag":573,"props":5317,"children":5318},{"style":968},[5319],{"type":45,"value":1896},{"type":39,"tag":573,"props":5321,"children":5322},{"style":580},[5323],{"type":45,"value":583},{"type":39,"tag":573,"props":5325,"children":5326},{"class":575,"line":3492},[5327,5332,5337,5342,5346,5351],{"type":39,"tag":573,"props":5328,"children":5329},{"style":783},[5330],{"type":45,"value":5331},"                \"SERVER_NAME\"",{"type":39,"tag":573,"props":5333,"children":5334},{"style":580},[5335],{"type":45,"value":5336},": os.environ.get(",{"type":39,"tag":573,"props":5338,"children":5339},{"style":783},[5340],{"type":45,"value":5341},"\"SERVER_NAME\"",{"type":39,"tag":573,"props":5343,"children":5344},{"style":580},[5345],{"type":45,"value":1577},{"type":39,"tag":573,"props":5347,"children":5348},{"style":783},[5349],{"type":45,"value":5350},"\"CDK Valheim\"",{"type":39,"tag":573,"props":5352,"children":5353},{"style":580},[5354],{"type":45,"value":5250},{"type":39,"tag":573,"props":5356,"children":5357},{"class":575,"line":3513},[5358,5363,5367,5372,5376,5381],{"type":39,"tag":573,"props":5359,"children":5360},{"style":783},[5361],{"type":45,"value":5362},"                \"WORLD_NAME\"",{"type":39,"tag":573,"props":5364,"children":5365},{"style":580},[5366],{"type":45,"value":5336},{"type":39,"tag":573,"props":5368,"children":5369},{"style":783},[5370],{"type":45,"value":5371},"\"WORLD_NAME\"",{"type":39,"tag":573,"props":5373,"children":5374},{"style":580},[5375],{"type":45,"value":1577},{"type":39,"tag":573,"props":5377,"children":5378},{"style":783},[5379],{"type":45,"value":5380},"\"Amazon\"",{"type":39,"tag":573,"props":5382,"children":5383},{"style":580},[5384],{"type":45,"value":5250},{"type":39,"tag":573,"props":5386,"children":5387},{"class":575,"line":3530},[5388,5393,5397,5402,5406,5411],{"type":39,"tag":573,"props":5389,"children":5390},{"style":783},[5391],{"type":45,"value":5392},"                \"SERVER_PASS\"",{"type":39,"tag":573,"props":5394,"children":5395},{"style":580},[5396],{"type":45,"value":5336},{"type":39,"tag":573,"props":5398,"children":5399},{"style":783},[5400],{"type":45,"value":5401},"\"SERVER_PASS\"",{"type":39,"tag":573,"props":5403,"children":5404},{"style":580},[5405],{"type":45,"value":1577},{"type":39,"tag":573,"props":5407,"children":5408},{"style":783},[5409],{"type":45,"value":5410},"\"fargate\"",{"type":39,"tag":573,"props":5412,"children":5413},{"style":580},[5414],{"type":45,"value":5250},{"type":39,"tag":573,"props":5416,"children":5417},{"class":575,"line":3538},[5418,5423,5427,5432],{"type":39,"tag":573,"props":5419,"children":5420},{"style":783},[5421],{"type":45,"value":5422},"                \"BACKUPS\"",{"type":39,"tag":573,"props":5424,"children":5425},{"style":580},[5426],{"type":45,"value":598},{"type":39,"tag":573,"props":5428,"children":5429},{"style":783},[5430],{"type":45,"value":5431},"'false'",{"type":39,"tag":573,"props":5433,"children":5434},{"style":580},[5435],{"type":45,"value":609},{"type":39,"tag":573,"props":5437,"children":5438},{"class":575,"line":3546},[5439],{"type":39,"tag":573,"props":5440,"children":5441},{"style":580},[5442],{"type":45,"value":5443},"            })\n",{"type":39,"tag":48,"props":5445,"children":5446},{},[5447,5449,5454],{"type":45,"value":5448},"We are almost ready to deploy a basic version of our Valheim server using the ",{"type":39,"tag":339,"props":5450,"children":5452},{"className":5451},[],[5453],{"type":45,"value":2562},{"type":45,"value":5455}," construct. If we were to run the following command:",{"type":39,"tag":563,"props":5457,"children":5459},{"code":5458},"cdk deploy --app cdk/app.py --require-approval never\n",[5460],{"type":39,"tag":339,"props":5461,"children":5462},{"__ignoreMap":8},[5463],{"type":45,"value":5458},{"type":39,"tag":48,"props":5465,"children":5466},{},[5467,5469,5475],{"type":45,"value":5468},"from the root of our project, it should work. This assumes that we have default credentials configured in ",{"type":39,"tag":339,"props":5470,"children":5472},{"className":5471},[],[5473],{"type":45,"value":5474},"~/.aws/credentials",{"type":45,"value":5476}," and that we have also bootstrapped our AWS account with the resources it needs for CDK to work:",{"type":39,"tag":563,"props":5478,"children":5480},{"code":5479},"cdk bootstrap --app cdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n",[5481],{"type":39,"tag":339,"props":5482,"children":5483},{"__ignoreMap":8},[5484],{"type":45,"value":5479},{"type":39,"tag":931,"props":5486,"children":5488},{"id":5487},"setup-gitlab-ci-job-for-automated-deployments",[5489],{"type":45,"value":5490},"Setup GitLab CI job for automated deployments",{"type":39,"tag":48,"props":5492,"children":5493},{},[5494,5496,5502],{"type":45,"value":5495},"Instead of deploying from the command line, it would be better to run the deployment from a CI/CD pipeline. Add a ",{"type":39,"tag":339,"props":5497,"children":5499},{"className":5498},[],[5500],{"type":45,"value":5501},".gitlab-ci.yml",{"type":45,"value":5503}," file to the root of your project and populate it with the following YAML:",{"type":39,"tag":563,"props":5505,"children":5509},{"code":5506,"language":5507,"meta":8,"className":5508,"style":8},"stages:\n  - deploy\n\nimage: python:3.8\n\ncdk_deploy:\n  stage: deploy\n  rules:\n    - if: \"$CI_COMMIT_TAG\"\n      when: always\n  before_script:\n    - apt-get -qq update && apt-get -y install nodejs npm\n    - npm i -g aws-cdk\n    - pip3 install -e cdk\n  script:\n    - cdk bootstrap --app cdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n    - cdk deploy --app cdk/app.py --require-approval never\n","yaml","language-yaml shiki shiki-themes github-light github-dark monokai",[5510],{"type":39,"tag":339,"props":5511,"children":5512},{"__ignoreMap":8},[5513,5526,5539,5546,5563,5570,5582,5598,5610,5631,5648,5660,5672,5683,5695,5707,5718],{"type":39,"tag":573,"props":5514,"children":5515},{"class":575,"line":576},[5516,5522],{"type":39,"tag":573,"props":5517,"children":5519},{"style":5518},"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[5520],{"type":45,"value":5521},"stages",{"type":39,"tag":573,"props":5523,"children":5524},{"style":580},[5525],{"type":45,"value":3729},{"type":39,"tag":573,"props":5527,"children":5528},{"class":575,"line":586},[5529,5534],{"type":39,"tag":573,"props":5530,"children":5531},{"style":580},[5532],{"type":45,"value":5533},"  - ",{"type":39,"tag":573,"props":5535,"children":5536},{"style":783},[5537],{"type":45,"value":5538},"deploy\n",{"type":39,"tag":573,"props":5540,"children":5541},{"class":575,"line":612},[5542],{"type":39,"tag":573,"props":5543,"children":5544},{"emptyLinePlaceholder":34},[5545],{"type":45,"value":1722},{"type":39,"tag":573,"props":5547,"children":5548},{"class":575,"line":634},[5549,5554,5558],{"type":39,"tag":573,"props":5550,"children":5551},{"style":5518},[5552],{"type":45,"value":5553},"image",{"type":39,"tag":573,"props":5555,"children":5556},{"style":580},[5557],{"type":45,"value":598},{"type":39,"tag":573,"props":5559,"children":5560},{"style":783},[5561],{"type":45,"value":5562},"python:3.8\n",{"type":39,"tag":573,"props":5564,"children":5565},{"class":575,"line":656},[5566],{"type":39,"tag":573,"props":5567,"children":5568},{"emptyLinePlaceholder":34},[5569],{"type":45,"value":1722},{"type":39,"tag":573,"props":5571,"children":5572},{"class":575,"line":678},[5573,5578],{"type":39,"tag":573,"props":5574,"children":5575},{"style":5518},[5576],{"type":45,"value":5577},"cdk_deploy",{"type":39,"tag":573,"props":5579,"children":5580},{"style":580},[5581],{"type":45,"value":3729},{"type":39,"tag":573,"props":5583,"children":5584},{"class":575,"line":696},[5585,5590,5594],{"type":39,"tag":573,"props":5586,"children":5587},{"style":5518},[5588],{"type":45,"value":5589},"  stage",{"type":39,"tag":573,"props":5591,"children":5592},{"style":580},[5593],{"type":45,"value":598},{"type":39,"tag":573,"props":5595,"children":5596},{"style":783},[5597],{"type":45,"value":5538},{"type":39,"tag":573,"props":5599,"children":5600},{"class":575,"line":1800},[5601,5606],{"type":39,"tag":573,"props":5602,"children":5603},{"style":5518},[5604],{"type":45,"value":5605},"  rules",{"type":39,"tag":573,"props":5607,"children":5608},{"style":580},[5609],{"type":45,"value":3729},{"type":39,"tag":573,"props":5611,"children":5612},{"class":575,"line":1814},[5613,5618,5622,5626],{"type":39,"tag":573,"props":5614,"children":5615},{"style":580},[5616],{"type":45,"value":5617},"    - ",{"type":39,"tag":573,"props":5619,"children":5620},{"style":5518},[5621],{"type":45,"value":3708},{"type":39,"tag":573,"props":5623,"children":5624},{"style":580},[5625],{"type":45,"value":598},{"type":39,"tag":573,"props":5627,"children":5628},{"style":783},[5629],{"type":45,"value":5630},"\"$CI_COMMIT_TAG\"\n",{"type":39,"tag":573,"props":5632,"children":5633},{"class":575,"line":1847},[5634,5639,5643],{"type":39,"tag":573,"props":5635,"children":5636},{"style":5518},[5637],{"type":45,"value":5638},"      when",{"type":39,"tag":573,"props":5640,"children":5641},{"style":580},[5642],{"type":45,"value":598},{"type":39,"tag":573,"props":5644,"children":5645},{"style":783},[5646],{"type":45,"value":5647},"always\n",{"type":39,"tag":573,"props":5649,"children":5650},{"class":575,"line":1855},[5651,5656],{"type":39,"tag":573,"props":5652,"children":5653},{"style":5518},[5654],{"type":45,"value":5655},"  before_script",{"type":39,"tag":573,"props":5657,"children":5658},{"style":580},[5659],{"type":45,"value":3729},{"type":39,"tag":573,"props":5661,"children":5662},{"class":575,"line":3182},[5663,5667],{"type":39,"tag":573,"props":5664,"children":5665},{"style":580},[5666],{"type":45,"value":5617},{"type":39,"tag":573,"props":5668,"children":5669},{"style":783},[5670],{"type":45,"value":5671},"apt-get -qq update && apt-get -y install nodejs npm\n",{"type":39,"tag":573,"props":5673,"children":5674},{"class":575,"line":3190},[5675,5679],{"type":39,"tag":573,"props":5676,"children":5677},{"style":580},[5678],{"type":45,"value":5617},{"type":39,"tag":573,"props":5680,"children":5681},{"style":783},[5682],{"type":45,"value":4524},{"type":39,"tag":573,"props":5684,"children":5685},{"class":575,"line":3233},[5686,5690],{"type":39,"tag":573,"props":5687,"children":5688},{"style":580},[5689],{"type":45,"value":5617},{"type":39,"tag":573,"props":5691,"children":5692},{"style":783},[5693],{"type":45,"value":5694},"pip3 install -e cdk\n",{"type":39,"tag":573,"props":5696,"children":5697},{"class":575,"line":3241},[5698,5703],{"type":39,"tag":573,"props":5699,"children":5700},{"style":5518},[5701],{"type":45,"value":5702},"  script",{"type":39,"tag":573,"props":5704,"children":5705},{"style":580},[5706],{"type":45,"value":3729},{"type":39,"tag":573,"props":5708,"children":5709},{"class":575,"line":3258},[5710,5714],{"type":39,"tag":573,"props":5711,"children":5712},{"style":580},[5713],{"type":45,"value":5617},{"type":39,"tag":573,"props":5715,"children":5716},{"style":783},[5717],{"type":45,"value":5479},{"type":39,"tag":573,"props":5719,"children":5720},{"class":575,"line":3280},[5721,5725],{"type":39,"tag":573,"props":5722,"children":5723},{"style":580},[5724],{"type":45,"value":5617},{"type":39,"tag":573,"props":5726,"children":5727},{"style":783},[5728],{"type":45,"value":5458},{"type":39,"tag":48,"props":5730,"children":5731},{},[5732,5734,5740,5742,5748,5750,5756],{"type":45,"value":5733},"Before we initialize a git repository in the root directory of our project, remove the ",{"type":39,"tag":339,"props":5735,"children":5737},{"className":5736},[],[5738],{"type":45,"value":5739},".git",{"type":45,"value":5741}," repo that CDK created when we initialized the project with ",{"type":39,"tag":339,"props":5743,"children":5745},{"className":5744},[],[5746],{"type":45,"value":5747},"rf -rf cdk/.git",{"type":45,"value":5749},". Now initialized a project in the root directory with ",{"type":39,"tag":339,"props":5751,"children":5753},{"className":5752},[],[5754],{"type":45,"value":5755},"git init",{"type":45,"value":183},{"type":39,"tag":48,"props":5758,"children":5759},{},[5760],{"type":45,"value":5761},"Next, create a GitLab repository and add the remote to this project with:",{"type":39,"tag":563,"props":5763,"children":5765},{"code":5764},"git remote add origin git@gitlab.com:gitlab-username/project-name.git\n",[5766],{"type":39,"tag":339,"props":5767,"children":5768},{"__ignoreMap":8},[5769],{"type":45,"value":5764},{"type":39,"tag":48,"props":5771,"children":5772},{},[5773,5775,5781],{"type":45,"value":5774},"In the GitLab project's ",{"type":39,"tag":339,"props":5776,"children":5778},{"className":5777},[],[5779],{"type":45,"value":5780},"Settings > CI/CD > Variables",{"type":45,"value":5782}," section, add the following environment variables as protected variables:",{"type":39,"tag":312,"props":5784,"children":5785},{},[5786,5795,5804,5813,5822,5831,5840,5849],{"type":39,"tag":316,"props":5787,"children":5788},{},[5789],{"type":39,"tag":339,"props":5790,"children":5792},{"className":5791},[],[5793],{"type":45,"value":5794},"AWS_ACCESS_KEY_ID",{"type":39,"tag":316,"props":5796,"children":5797},{},[5798],{"type":39,"tag":339,"props":5799,"children":5801},{"className":5800},[],[5802],{"type":45,"value":5803},"AWS_SECRET_ACCESS_KEY",{"type":39,"tag":316,"props":5805,"children":5806},{},[5807],{"type":39,"tag":339,"props":5808,"children":5810},{"className":5809},[],[5811],{"type":45,"value":5812},"AWS_DEFAULT_REGION",{"type":39,"tag":316,"props":5814,"children":5815},{},[5816],{"type":39,"tag":339,"props":5817,"children":5819},{"className":5818},[],[5820],{"type":45,"value":5821},"AWS_ACCOUNT_ID",{"type":39,"tag":316,"props":5823,"children":5824},{},[5825],{"type":39,"tag":339,"props":5826,"children":5828},{"className":5827},[],[5829],{"type":45,"value":5830},"APPLICATION_PUBLIC_KEY",{"type":39,"tag":316,"props":5832,"children":5833},{},[5834],{"type":39,"tag":339,"props":5835,"children":5837},{"className":5836},[],[5838],{"type":45,"value":5839},"SERVER_PASS",{"type":39,"tag":316,"props":5841,"children":5842},{},[5843],{"type":39,"tag":339,"props":5844,"children":5846},{"className":5845},[],[5847],{"type":45,"value":5848},"SERVER_NAME",{"type":39,"tag":316,"props":5850,"children":5851},{},[5852],{"type":39,"tag":339,"props":5853,"children":5855},{"className":5854},[],[5856],{"type":45,"value":5857},"WORLD_NAME",{"type":39,"tag":48,"props":5859,"children":5860},{},[5861,5863,5869,5871,5876],{"type":45,"value":5862},"Now under ",{"type":39,"tag":339,"props":5864,"children":5866},{"className":5865},[],[5867],{"type":45,"value":5868},"Settings > Repository > Protected Tags",{"type":45,"value":5870},", add a wildcard (",{"type":39,"tag":339,"props":5872,"children":5874},{"className":5873},[],[5875],{"type":45,"value":1588},{"type":45,"value":5877},") so that all tags are protected and only maintainers can push tags. This allows us to use the protected environment variables only when a trusted maintainer pushes a tag to the repository.",{"type":39,"tag":931,"props":5879,"children":5881},{"id":5880},"edit-the-name-of-the-stack-and-add-region-and-account-info",[5882],{"type":45,"value":5883},"Edit the name of the stack and add region and account info",{"type":39,"tag":48,"props":5885,"children":5886},{},[5887,5889,5895],{"type":45,"value":5888},"We are almost ready to create a tag and push to GitLab, but before we do that let's change the name of the CloudFormation stack that CDK will create in ",{"type":39,"tag":339,"props":5890,"children":5892},{"className":5891},[],[5893],{"type":45,"value":5894},"cdk/app.py",{"type":45,"value":2585},{"type":39,"tag":563,"props":5897,"children":5899},{"code":5898,"language":3027,"meta":8,"className":3028,"style":8},"#!/usr/bin/env python3\n\nimport os\n\nfrom aws_cdk import core as cdk\n\n# For consistency with TypeScript code, `cdk` is the preferred import name for\n# the CDK's core module.  The following line also imports it as `core` for use\n# with examples from the CDK Developer's Guide, which are in the process of\n# being updated to use `cdk`.  You may delete this import if you don't need it.\nfrom aws_cdk import core\n\nfrom cdk.cdk_stack import CdkStack\n\naws_region = os.environ.get(\"AWS_DEFAULT_REGION\", \"us-east-1\")\naws_account = os.environ.get(\"AWS_ACCOUNT_ID\", \"\")\n\n\napp = cdk.App()\nCdkStack(\n    app,\n    \"valheim-server-stack\",\n    env={\"region\": aws_region, \"account\": aws_account}\n)\n\napp.synth()\n",[5900],{"type":39,"tag":339,"props":5901,"children":5902},{"__ignoreMap":8},[5903,5911,5918,5929,5936,5963,5970,5978,5986,5994,6002,6022,6029,6050,6057,6091,6125,6132,6139,6156,6164,6172,6184,6221,6228,6235],{"type":39,"tag":573,"props":5904,"children":5905},{"class":575,"line":576},[5906],{"type":39,"tag":573,"props":5907,"children":5908},{"style":1495},[5909],{"type":45,"value":5910},"#!/usr/bin/env python3\n",{"type":39,"tag":573,"props":5912,"children":5913},{"class":575,"line":586},[5914],{"type":39,"tag":573,"props":5915,"children":5916},{"emptyLinePlaceholder":34},[5917],{"type":45,"value":1722},{"type":39,"tag":573,"props":5919,"children":5920},{"class":575,"line":612},[5921,5925],{"type":39,"tag":573,"props":5922,"children":5923},{"style":968},[5924],{"type":45,"value":3070},{"type":39,"tag":573,"props":5926,"children":5927},{"style":580},[5928],{"type":45,"value":3075},{"type":39,"tag":573,"props":5930,"children":5931},{"class":575,"line":634},[5932],{"type":39,"tag":573,"props":5933,"children":5934},{"emptyLinePlaceholder":34},[5935],{"type":45,"value":1722},{"type":39,"tag":573,"props":5937,"children":5938},{"class":575,"line":656},[5939,5943,5947,5951,5955,5959],{"type":39,"tag":573,"props":5940,"children":5941},{"style":968},[5942],{"type":45,"value":4727},{"type":39,"tag":573,"props":5944,"children":5945},{"style":580},[5946],{"type":45,"value":4732},{"type":39,"tag":573,"props":5948,"children":5949},{"style":968},[5950],{"type":45,"value":3070},{"type":39,"tag":573,"props":5952,"children":5953},{"style":580},[5954],{"type":45,"value":4741},{"type":39,"tag":573,"props":5956,"children":5957},{"style":968},[5958],{"type":45,"value":1289},{"type":39,"tag":573,"props":5960,"children":5961},{"style":580},[5962],{"type":45,"value":4750},{"type":39,"tag":573,"props":5964,"children":5965},{"class":575,"line":678},[5966],{"type":39,"tag":573,"props":5967,"children":5968},{"emptyLinePlaceholder":34},[5969],{"type":45,"value":1722},{"type":39,"tag":573,"props":5971,"children":5972},{"class":575,"line":696},[5973],{"type":39,"tag":573,"props":5974,"children":5975},{"style":1495},[5976],{"type":45,"value":5977},"# For consistency with TypeScript code, `cdk` is the preferred import name for\n",{"type":39,"tag":573,"props":5979,"children":5980},{"class":575,"line":1800},[5981],{"type":39,"tag":573,"props":5982,"children":5983},{"style":1495},[5984],{"type":45,"value":5985},"# the CDK's core module.  The following line also imports it as `core` for use\n",{"type":39,"tag":573,"props":5987,"children":5988},{"class":575,"line":1814},[5989],{"type":39,"tag":573,"props":5990,"children":5991},{"style":1495},[5992],{"type":45,"value":5993},"# with examples from the CDK Developer's Guide, which are in the process of\n",{"type":39,"tag":573,"props":5995,"children":5996},{"class":575,"line":1847},[5997],{"type":39,"tag":573,"props":5998,"children":5999},{"style":1495},[6000],{"type":45,"value":6001},"# being updated to use `cdk`.  You may delete this import if you don't need it.\n",{"type":39,"tag":573,"props":6003,"children":6004},{"class":575,"line":1855},[6005,6009,6013,6017],{"type":39,"tag":573,"props":6006,"children":6007},{"style":968},[6008],{"type":45,"value":4727},{"type":39,"tag":573,"props":6010,"children":6011},{"style":580},[6012],{"type":45,"value":4732},{"type":39,"tag":573,"props":6014,"children":6015},{"style":968},[6016],{"type":45,"value":3070},{"type":39,"tag":573,"props":6018,"children":6019},{"style":580},[6020],{"type":45,"value":6021}," core\n",{"type":39,"tag":573,"props":6023,"children":6024},{"class":575,"line":3182},[6025],{"type":39,"tag":573,"props":6026,"children":6027},{"emptyLinePlaceholder":34},[6028],{"type":45,"value":1722},{"type":39,"tag":573,"props":6030,"children":6031},{"class":575,"line":3190},[6032,6036,6041,6045],{"type":39,"tag":573,"props":6033,"children":6034},{"style":968},[6035],{"type":45,"value":4727},{"type":39,"tag":573,"props":6037,"children":6038},{"style":580},[6039],{"type":45,"value":6040}," cdk.cdk_stack ",{"type":39,"tag":573,"props":6042,"children":6043},{"style":968},[6044],{"type":45,"value":3070},{"type":39,"tag":573,"props":6046,"children":6047},{"style":580},[6048],{"type":45,"value":6049}," CdkStack\n",{"type":39,"tag":573,"props":6051,"children":6052},{"class":575,"line":3233},[6053],{"type":39,"tag":573,"props":6054,"children":6055},{"emptyLinePlaceholder":34},[6056],{"type":45,"value":1722},{"type":39,"tag":573,"props":6058,"children":6059},{"class":575,"line":3241},[6060,6065,6069,6073,6078,6082,6087],{"type":39,"tag":573,"props":6061,"children":6062},{"style":580},[6063],{"type":45,"value":6064},"aws_region ",{"type":39,"tag":573,"props":6066,"children":6067},{"style":968},[6068],{"type":45,"value":1896},{"type":39,"tag":573,"props":6070,"children":6071},{"style":580},[6072],{"type":45,"value":3119},{"type":39,"tag":573,"props":6074,"children":6075},{"style":783},[6076],{"type":45,"value":6077},"\"AWS_DEFAULT_REGION\"",{"type":39,"tag":573,"props":6079,"children":6080},{"style":580},[6081],{"type":45,"value":1577},{"type":39,"tag":573,"props":6083,"children":6084},{"style":783},[6085],{"type":45,"value":6086},"\"us-east-1\"",{"type":39,"tag":573,"props":6088,"children":6089},{"style":580},[6090],{"type":45,"value":3129},{"type":39,"tag":573,"props":6092,"children":6093},{"class":575,"line":3258},[6094,6099,6103,6107,6112,6116,6121],{"type":39,"tag":573,"props":6095,"children":6096},{"style":580},[6097],{"type":45,"value":6098},"aws_account ",{"type":39,"tag":573,"props":6100,"children":6101},{"style":968},[6102],{"type":45,"value":1896},{"type":39,"tag":573,"props":6104,"children":6105},{"style":580},[6106],{"type":45,"value":3119},{"type":39,"tag":573,"props":6108,"children":6109},{"style":783},[6110],{"type":45,"value":6111},"\"AWS_ACCOUNT_ID\"",{"type":39,"tag":573,"props":6113,"children":6114},{"style":580},[6115],{"type":45,"value":1577},{"type":39,"tag":573,"props":6117,"children":6118},{"style":783},[6119],{"type":45,"value":6120},"\"\"",{"type":39,"tag":573,"props":6122,"children":6123},{"style":580},[6124],{"type":45,"value":3129},{"type":39,"tag":573,"props":6126,"children":6127},{"class":575,"line":3280},[6128],{"type":39,"tag":573,"props":6129,"children":6130},{"emptyLinePlaceholder":34},[6131],{"type":45,"value":1722},{"type":39,"tag":573,"props":6133,"children":6134},{"class":575,"line":3302},[6135],{"type":39,"tag":573,"props":6136,"children":6137},{"emptyLinePlaceholder":34},[6138],{"type":45,"value":1722},{"type":39,"tag":573,"props":6140,"children":6141},{"class":575,"line":3316},[6142,6147,6151],{"type":39,"tag":573,"props":6143,"children":6144},{"style":580},[6145],{"type":45,"value":6146},"app ",{"type":39,"tag":573,"props":6148,"children":6149},{"style":968},[6150],{"type":45,"value":1896},{"type":39,"tag":573,"props":6152,"children":6153},{"style":580},[6154],{"type":45,"value":6155}," cdk.App()\n",{"type":39,"tag":573,"props":6157,"children":6158},{"class":575,"line":3325},[6159],{"type":39,"tag":573,"props":6160,"children":6161},{"style":580},[6162],{"type":45,"value":6163},"CdkStack(\n",{"type":39,"tag":573,"props":6165,"children":6166},{"class":575,"line":3347},[6167],{"type":39,"tag":573,"props":6168,"children":6169},{"style":580},[6170],{"type":45,"value":6171},"    app,\n",{"type":39,"tag":573,"props":6173,"children":6174},{"class":575,"line":3369},[6175,6180],{"type":39,"tag":573,"props":6176,"children":6177},{"style":783},[6178],{"type":45,"value":6179},"    \"valheim-server-stack\"",{"type":39,"tag":573,"props":6181,"children":6182},{"style":580},[6183],{"type":45,"value":609},{"type":39,"tag":573,"props":6185,"children":6186},{"class":575,"line":3391},[6187,6192,6196,6201,6206,6211,6216],{"type":39,"tag":573,"props":6188,"children":6189},{"style":1569},[6190],{"type":45,"value":6191},"    env",{"type":39,"tag":573,"props":6193,"children":6194},{"style":968},[6195],{"type":45,"value":1896},{"type":39,"tag":573,"props":6197,"children":6198},{"style":580},[6199],{"type":45,"value":6200},"{",{"type":39,"tag":573,"props":6202,"children":6203},{"style":783},[6204],{"type":45,"value":6205},"\"region\"",{"type":39,"tag":573,"props":6207,"children":6208},{"style":580},[6209],{"type":45,"value":6210},": aws_region, ",{"type":39,"tag":573,"props":6212,"children":6213},{"style":783},[6214],{"type":45,"value":6215},"\"account\"",{"type":39,"tag":573,"props":6217,"children":6218},{"style":580},[6219],{"type":45,"value":6220},": aws_account}\n",{"type":39,"tag":573,"props":6222,"children":6223},{"class":575,"line":3413},[6224],{"type":39,"tag":573,"props":6225,"children":6226},{"style":580},[6227],{"type":45,"value":3129},{"type":39,"tag":573,"props":6229,"children":6230},{"class":575,"line":3426},[6231],{"type":39,"tag":573,"props":6232,"children":6233},{"emptyLinePlaceholder":34},[6234],{"type":45,"value":1722},{"type":39,"tag":573,"props":6236,"children":6237},{"class":575,"line":3435},[6238],{"type":39,"tag":573,"props":6239,"children":6240},{"style":580},[6241],{"type":45,"value":6242},"app.synth()\n",{"type":39,"tag":48,"props":6244,"children":6245},{},[6246],{"type":45,"value":6247},"Now commit changes, create a tag and push it to GitLab:",{"type":39,"tag":563,"props":6249,"children":6251},{"code":6250},"git add .\ngit commit -m \"initial commit\"\ngit tag v0.0.1\ngit push origin v0.0.1\n",[6252],{"type":39,"tag":339,"props":6253,"children":6254},{"__ignoreMap":8},[6255],{"type":45,"value":6250},{"type":39,"tag":48,"props":6257,"children":6258},{},[6259],{"type":45,"value":6260},"Check the logs of the GitLab CI pipeline that this creates in your GitLab project's CI/CD settings.",{"type":39,"tag":48,"props":6262,"children":6263},{},[6264],{"type":45,"value":6265},"If everything runs successfully, you should be able to see your Valheim server listed in the list of community servers once it comes online, and you should be able to connect to it with the password you set in GitLab project variables.",{"type":39,"tag":40,"props":6267,"children":6269},{"id":6268},"add-the-lambda-function-handler-code",[6270],{"type":45,"value":6271},"Add the Lambda function handler code",{"type":39,"tag":48,"props":6273,"children":6274},{},[6275,6277,6282,6284,6290,6292,6298,6300,6306,6307,6313],{"type":45,"value":6276},"We will have a simple Flask application respond the the Discord ",{"type":39,"tag":339,"props":6278,"children":6280},{"className":6279},[],[6281],{"type":45,"value":2674},{"type":45,"value":6283}," requests that send Interaction events. Let's add ",{"type":39,"tag":339,"props":6285,"children":6287},{"className":6286},[],[6288],{"type":45,"value":6289},"lambda-handler.py",{"type":45,"value":6291}," in ",{"type":39,"tag":339,"props":6293,"children":6295},{"className":6294},[],[6296],{"type":45,"value":6297},"lambda/functions/interactions/lambda-handler.py",{"type":45,"value":6299},", and ",{"type":39,"tag":339,"props":6301,"children":6303},{"className":6302},[],[6304],{"type":45,"value":6305},"requirements.txt",{"type":45,"value":6291},{"type":39,"tag":339,"props":6308,"children":6310},{"className":6309},[],[6311],{"type":45,"value":6312},"lambda/functions/interactions/requirements.txt",{"type":45,"value":6314},". Our project structure should look like this:",{"type":39,"tag":563,"props":6316,"children":6318},{"code":6317},"$ tree -L 4\n.\n‚îú‚îÄ‚îÄ cdk\n‚îÇ   ‚îú‚îÄ‚îÄ app.py\n‚îÇ   ‚îú‚îÄ‚îÄ cdk\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cdk_stack.py\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py\n‚îÇ   ‚îú‚îÄ‚îÄ cdk.json\n‚îÇ   ‚îú‚îÄ‚îÄ README.md\n‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt\n‚îÇ   ‚îú‚îÄ‚îÄ setup.py\n‚îÇ   ‚îî‚îÄ‚îÄ source.bat\n‚îú‚îÄ‚îÄ lambda\n‚îÇ   ‚îî‚îÄ‚îÄ functions\n‚îÇ       ‚îî‚îÄ‚îÄ interactions\n‚îÇ           ‚îú‚îÄ‚îÄ lambda-handler.py    \u003C-- here\n‚îÇ           ‚îî‚îÄ‚îÄ requirements.txt     \u003C-- and here\n‚îú‚îÄ‚îÄ README.md\n‚îî‚îÄ‚îÄ register_bot.py\n",[6319],{"type":39,"tag":339,"props":6320,"children":6321},{"__ignoreMap":8},[6322],{"type":45,"value":6317},{"type":39,"tag":48,"props":6324,"children":6325},{},[6326,6327,6332],{"type":45,"value":1943},{"type":39,"tag":339,"props":6328,"children":6330},{"className":6329},[],[6331],{"type":45,"value":6305},{"type":45,"value":6333}," defines the pip dependencies for our Lambda function. It should include the following:",{"type":39,"tag":563,"props":6335,"children":6337},{"code":6336},"aws-wsgi==0.2.7\ndiscord-interactions==0.2.0\nFlask==1.1.2\n",[6338],{"type":39,"tag":339,"props":6339,"children":6340},{"__ignoreMap":8},[6341],{"type":45,"value":6336},{"type":39,"tag":312,"props":6343,"children":6344},{},[6345,6356,6366],{"type":39,"tag":316,"props":6346,"children":6347},{},[6348,6354],{"type":39,"tag":339,"props":6349,"children":6351},{"className":6350},[],[6352],{"type":45,"value":6353},"aws-wsgi",{"type":45,"value":6355}," will transform API Gateway requests into WSGI application requests that Flask can handle",{"type":39,"tag":316,"props":6357,"children":6358},{},[6359,6364],{"type":39,"tag":339,"props":6360,"children":6362},{"className":6361},[],[6363],{"type":45,"value":4500},{"type":45,"value":6365}," will help us with some security-related requirements",{"type":39,"tag":316,"props":6367,"children":6368},{},[6369,6375],{"type":39,"tag":339,"props":6370,"children":6372},{"className":6371},[],[6373],{"type":45,"value":6374},"Flask",{"type":45,"value":6376}," will be our web application framework",{"type":39,"tag":48,"props":6378,"children":6379},{},[6380,6382,6387],{"type":45,"value":6381},"Here's the code for ",{"type":39,"tag":339,"props":6383,"children":6385},{"className":6384},[],[6386],{"type":45,"value":6289},{"type":45,"value":2585},{"type":39,"tag":563,"props":6389,"children":6391},{"code":6390,"language":3027,"meta":8,"className":3028,"style":8},"import os\nimport logging\n\nimport awsgi\nimport boto3\nfrom discord_interactions import verify_key_decorator\nfrom flask import (\n    Flask,\n    jsonify,\n    request\n)\n\n\nclient = boto3.client('ecs')\n\n# Your public key can be found on your application in the Developer Portal\nPUBLIC_KEY = os.environ.get('APPLICATION_PUBLIC_KEY')\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\n\napp = Flask(__name__)\n\n\n@app.route('/discord', methods=['POST'])\n@verify_key_decorator(PUBLIC_KEY)\ndef index():\n    if request.json[\"type\"] == 1:\n        return jsonify({\"type\": 1})\n    else:\n        logger.info(request.json)\n        try:\n            interaction_option = request.json[\"data\"][\"options\"][0][\"value\"]\n        except KeyError:\n            logger.info(\"Could not parse the interaction option\")\n            interaction_option = \"status\"\n\n        logger.info(\"Interaction:\")\n        logger.info(interaction_option)\n\n        content = \"\"\n\n        if interaction_option == \"status\":\n            try:\n\n                resp = client.describe_services(\n                    cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                    services=[\n                        os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                    ]\n                )\n                desired_count = resp[\"services\"][0][\"desiredCount\"]\n                running_count = resp[\"services\"][0][\"runningCount\"]\n                pending_count = resp[\"services\"][0][\"pendingCount\"]\n\n                content = f\"Desired: {desired_count} | Running: {running_count} | Pending: {pending_count}\"\n\n            except Error as e:\n                content = \"Could not get server status\"\n                logger.info(\"Could not get the server status\")\n                logger.info(e)\n\n        elif interaction_option == \"start\":\n            content = \"Starting the server\"\n\n            resp = client.update_service(\n                cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                service=os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                desiredCount=1\n            )\n\n        elif interaction_option == \"stop\":\n            content = \"Stopping the server\"\n\n            resp = client.update_service(\n                cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                service=os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                desiredCount=0\n            )\n\n        else:\n            content = \"Unknown command\"\n\n        logger.info(resp)\n\n        return jsonify({\n            \"type\": 4,\n            \"data\": {\n                \"tts\": False,\n                \"content\": content,\n                \"embeds\": [],\n                \"allowed_mentions\": { \"parse\": [] }\n            }\n        })\n\ndef handler(event, context):\n    return awsgi.response(\n        app,\n        event,\n        context,\n        base64_content_types={\"image/png\"}\n    )\n",[6392],{"type":39,"tag":339,"props":6393,"children":6394},{"__ignoreMap":8},[6395,6406,6418,6425,6437,6449,6470,6490,6498,6506,6514,6521,6528,6535,6561,6568,6576,6601,6608,6625,6642,6649,6674,6681,6688,6733,6753,6771,6806,6836,6848,6856,6868,6920,6937,6954,6970,6977,6994,7002,7009,7026,7033,7058,7070,7077,7094,7128,7144,7170,7179,7188,7232,7274,7316,7324,7400,7408,7431,7448,7466,7475,7483,7509,7527,7535,7553,7586,7619,7637,7646,7654,7679,7696,7704,7720,7752,7784,7801,7809,7817,7829,7846,7854,7863,7871,7884,7905,7918,7940,7954,7968,7992,8001,8010,8018,8053,8067,8076,8085,8094,8120],{"type":39,"tag":573,"props":6396,"children":6397},{"class":575,"line":576},[6398,6402],{"type":39,"tag":573,"props":6399,"children":6400},{"style":968},[6401],{"type":45,"value":3070},{"type":39,"tag":573,"props":6403,"children":6404},{"style":580},[6405],{"type":45,"value":3075},{"type":39,"tag":573,"props":6407,"children":6408},{"class":575,"line":586},[6409,6413],{"type":39,"tag":573,"props":6410,"children":6411},{"style":968},[6412],{"type":45,"value":3070},{"type":39,"tag":573,"props":6414,"children":6415},{"style":580},[6416],{"type":45,"value":6417}," logging\n",{"type":39,"tag":573,"props":6419,"children":6420},{"class":575,"line":612},[6421],{"type":39,"tag":573,"props":6422,"children":6423},{"emptyLinePlaceholder":34},[6424],{"type":45,"value":1722},{"type":39,"tag":573,"props":6426,"children":6427},{"class":575,"line":634},[6428,6432],{"type":39,"tag":573,"props":6429,"children":6430},{"style":968},[6431],{"type":45,"value":3070},{"type":39,"tag":573,"props":6433,"children":6434},{"style":580},[6435],{"type":45,"value":6436}," awsgi\n",{"type":39,"tag":573,"props":6438,"children":6439},{"class":575,"line":656},[6440,6444],{"type":39,"tag":573,"props":6441,"children":6442},{"style":968},[6443],{"type":45,"value":3070},{"type":39,"tag":573,"props":6445,"children":6446},{"style":580},[6447],{"type":45,"value":6448}," boto3\n",{"type":39,"tag":573,"props":6450,"children":6451},{"class":575,"line":678},[6452,6456,6461,6465],{"type":39,"tag":573,"props":6453,"children":6454},{"style":968},[6455],{"type":45,"value":4727},{"type":39,"tag":573,"props":6457,"children":6458},{"style":580},[6459],{"type":45,"value":6460}," discord_interactions ",{"type":39,"tag":573,"props":6462,"children":6463},{"style":968},[6464],{"type":45,"value":3070},{"type":39,"tag":573,"props":6466,"children":6467},{"style":580},[6468],{"type":45,"value":6469}," verify_key_decorator\n",{"type":39,"tag":573,"props":6471,"children":6472},{"class":575,"line":696},[6473,6477,6482,6486],{"type":39,"tag":573,"props":6474,"children":6475},{"style":968},[6476],{"type":45,"value":4727},{"type":39,"tag":573,"props":6478,"children":6479},{"style":580},[6480],{"type":45,"value":6481}," flask ",{"type":39,"tag":573,"props":6483,"children":6484},{"style":968},[6485],{"type":45,"value":3070},{"type":39,"tag":573,"props":6487,"children":6488},{"style":580},[6489],{"type":45,"value":4777},{"type":39,"tag":573,"props":6491,"children":6492},{"class":575,"line":1800},[6493],{"type":39,"tag":573,"props":6494,"children":6495},{"style":580},[6496],{"type":45,"value":6497},"    Flask,\n",{"type":39,"tag":573,"props":6499,"children":6500},{"class":575,"line":1814},[6501],{"type":39,"tag":573,"props":6502,"children":6503},{"style":580},[6504],{"type":45,"value":6505},"    jsonify,\n",{"type":39,"tag":573,"props":6507,"children":6508},{"class":575,"line":1847},[6509],{"type":39,"tag":573,"props":6510,"children":6511},{"style":580},[6512],{"type":45,"value":6513},"    request\n",{"type":39,"tag":573,"props":6515,"children":6516},{"class":575,"line":1855},[6517],{"type":39,"tag":573,"props":6518,"children":6519},{"style":580},[6520],{"type":45,"value":3129},{"type":39,"tag":573,"props":6522,"children":6523},{"class":575,"line":3182},[6524],{"type":39,"tag":573,"props":6525,"children":6526},{"emptyLinePlaceholder":34},[6527],{"type":45,"value":1722},{"type":39,"tag":573,"props":6529,"children":6530},{"class":575,"line":3190},[6531],{"type":39,"tag":573,"props":6532,"children":6533},{"emptyLinePlaceholder":34},[6534],{"type":45,"value":1722},{"type":39,"tag":573,"props":6536,"children":6537},{"class":575,"line":3233},[6538,6543,6547,6552,6557],{"type":39,"tag":573,"props":6539,"children":6540},{"style":580},[6541],{"type":45,"value":6542},"client ",{"type":39,"tag":573,"props":6544,"children":6545},{"style":968},[6546],{"type":45,"value":1896},{"type":39,"tag":573,"props":6548,"children":6549},{"style":580},[6550],{"type":45,"value":6551}," boto3.client(",{"type":39,"tag":573,"props":6553,"children":6554},{"style":783},[6555],{"type":45,"value":6556},"'ecs'",{"type":39,"tag":573,"props":6558,"children":6559},{"style":580},[6560],{"type":45,"value":3129},{"type":39,"tag":573,"props":6562,"children":6563},{"class":575,"line":3241},[6564],{"type":39,"tag":573,"props":6565,"children":6566},{"emptyLinePlaceholder":34},[6567],{"type":45,"value":1722},{"type":39,"tag":573,"props":6569,"children":6570},{"class":575,"line":3258},[6571],{"type":39,"tag":573,"props":6572,"children":6573},{"style":1495},[6574],{"type":45,"value":6575},"# Your public key can be found on your application in the Developer Portal\n",{"type":39,"tag":573,"props":6577,"children":6578},{"class":575,"line":3280},[6579,6584,6588,6592,6597],{"type":39,"tag":573,"props":6580,"children":6581},{"style":1003},[6582],{"type":45,"value":6583},"PUBLIC_KEY",{"type":39,"tag":573,"props":6585,"children":6586},{"style":968},[6587],{"type":45,"value":3114},{"type":39,"tag":573,"props":6589,"children":6590},{"style":580},[6591],{"type":45,"value":3119},{"type":39,"tag":573,"props":6593,"children":6594},{"style":783},[6595],{"type":45,"value":6596},"'APPLICATION_PUBLIC_KEY'",{"type":39,"tag":573,"props":6598,"children":6599},{"style":580},[6600],{"type":45,"value":3129},{"type":39,"tag":573,"props":6602,"children":6603},{"class":575,"line":3302},[6604],{"type":39,"tag":573,"props":6605,"children":6606},{"emptyLinePlaceholder":34},[6607],{"type":45,"value":1722},{"type":39,"tag":573,"props":6609,"children":6610},{"class":575,"line":3316},[6611,6616,6620],{"type":39,"tag":573,"props":6612,"children":6613},{"style":580},[6614],{"type":45,"value":6615},"logger ",{"type":39,"tag":573,"props":6617,"children":6618},{"style":968},[6619],{"type":45,"value":1896},{"type":39,"tag":573,"props":6621,"children":6622},{"style":580},[6623],{"type":45,"value":6624}," logging.getLogger()\n",{"type":39,"tag":573,"props":6626,"children":6627},{"class":575,"line":3325},[6628,6633,6638],{"type":39,"tag":573,"props":6629,"children":6630},{"style":580},[6631],{"type":45,"value":6632},"logger.setLevel(logging.",{"type":39,"tag":573,"props":6634,"children":6635},{"style":1003},[6636],{"type":45,"value":6637},"INFO",{"type":39,"tag":573,"props":6639,"children":6640},{"style":580},[6641],{"type":45,"value":3129},{"type":39,"tag":573,"props":6643,"children":6644},{"class":575,"line":3347},[6645],{"type":39,"tag":573,"props":6646,"children":6647},{"emptyLinePlaceholder":34},[6648],{"type":45,"value":1722},{"type":39,"tag":573,"props":6650,"children":6651},{"class":575,"line":3369},[6652,6656,6660,6665,6670],{"type":39,"tag":573,"props":6653,"children":6654},{"style":580},[6655],{"type":45,"value":6146},{"type":39,"tag":573,"props":6657,"children":6658},{"style":968},[6659],{"type":45,"value":1896},{"type":39,"tag":573,"props":6661,"children":6662},{"style":580},[6663],{"type":45,"value":6664}," Flask(",{"type":39,"tag":573,"props":6666,"children":6667},{"style":3711},[6668],{"type":45,"value":6669},"__name__",{"type":39,"tag":573,"props":6671,"children":6672},{"style":580},[6673],{"type":45,"value":3129},{"type":39,"tag":573,"props":6675,"children":6676},{"class":575,"line":3391},[6677],{"type":39,"tag":573,"props":6678,"children":6679},{"emptyLinePlaceholder":34},[6680],{"type":45,"value":1722},{"type":39,"tag":573,"props":6682,"children":6683},{"class":575,"line":3413},[6684],{"type":39,"tag":573,"props":6685,"children":6686},{"emptyLinePlaceholder":34},[6687],{"type":45,"value":1722},{"type":39,"tag":573,"props":6689,"children":6690},{"class":575,"line":3426},[6691,6696,6700,6705,6709,6714,6718,6723,6728],{"type":39,"tag":573,"props":6692,"children":6693},{"style":772},[6694],{"type":45,"value":6695},"@app.route",{"type":39,"tag":573,"props":6697,"children":6698},{"style":580},[6699],{"type":45,"value":1533},{"type":39,"tag":573,"props":6701,"children":6702},{"style":783},[6703],{"type":45,"value":6704},"'/discord'",{"type":39,"tag":573,"props":6706,"children":6707},{"style":580},[6708],{"type":45,"value":1577},{"type":39,"tag":573,"props":6710,"children":6711},{"style":1569},[6712],{"type":45,"value":6713},"methods",{"type":39,"tag":573,"props":6715,"children":6716},{"style":968},[6717],{"type":45,"value":1896},{"type":39,"tag":573,"props":6719,"children":6720},{"style":580},[6721],{"type":45,"value":6722},"[",{"type":39,"tag":573,"props":6724,"children":6725},{"style":783},[6726],{"type":45,"value":6727},"'POST'",{"type":39,"tag":573,"props":6729,"children":6730},{"style":580},[6731],{"type":45,"value":6732},"])\n",{"type":39,"tag":573,"props":6734,"children":6735},{"class":575,"line":3435},[6736,6741,6745,6749],{"type":39,"tag":573,"props":6737,"children":6738},{"style":772},[6739],{"type":45,"value":6740},"@verify_key_decorator",{"type":39,"tag":573,"props":6742,"children":6743},{"style":580},[6744],{"type":45,"value":1533},{"type":39,"tag":573,"props":6746,"children":6747},{"style":1003},[6748],{"type":45,"value":6583},{"type":39,"tag":573,"props":6750,"children":6751},{"style":580},[6752],{"type":45,"value":3129},{"type":39,"tag":573,"props":6754,"children":6755},{"class":575,"line":3457},[6756,6761,6766],{"type":39,"tag":573,"props":6757,"children":6758},{"style":1580},[6759],{"type":45,"value":6760},"def",{"type":39,"tag":573,"props":6762,"children":6763},{"style":772},[6764],{"type":45,"value":6765}," index",{"type":39,"tag":573,"props":6767,"children":6768},{"style":580},[6769],{"type":45,"value":6770},"():\n",{"type":39,"tag":573,"props":6772,"children":6773},{"class":575,"line":3475},[6774,6778,6783,6788,6793,6797,6802],{"type":39,"tag":573,"props":6775,"children":6776},{"style":968},[6777],{"type":45,"value":1685},{"type":39,"tag":573,"props":6779,"children":6780},{"style":580},[6781],{"type":45,"value":6782}," request.json[",{"type":39,"tag":573,"props":6784,"children":6785},{"style":783},[6786],{"type":45,"value":6787},"\"type\"",{"type":39,"tag":573,"props":6789,"children":6790},{"style":580},[6791],{"type":45,"value":6792},"] ",{"type":39,"tag":573,"props":6794,"children":6795},{"style":968},[6796],{"type":45,"value":1705},{"type":39,"tag":573,"props":6798,"children":6799},{"style":1003},[6800],{"type":45,"value":6801}," 1",{"type":39,"tag":573,"props":6803,"children":6804},{"style":580},[6805],{"type":45,"value":3729},{"type":39,"tag":573,"props":6807,"children":6808},{"class":575,"line":3484},[6809,6814,6819,6823,6827,6831],{"type":39,"tag":573,"props":6810,"children":6811},{"style":968},[6812],{"type":45,"value":6813},"        return",{"type":39,"tag":573,"props":6815,"children":6816},{"style":580},[6817],{"type":45,"value":6818}," jsonify({",{"type":39,"tag":573,"props":6820,"children":6821},{"style":783},[6822],{"type":45,"value":6787},{"type":39,"tag":573,"props":6824,"children":6825},{"style":580},[6826],{"type":45,"value":598},{"type":39,"tag":573,"props":6828,"children":6829},{"style":1003},[6830],{"type":45,"value":1152},{"type":39,"tag":573,"props":6832,"children":6833},{"style":580},[6834],{"type":45,"value":6835},"})\n",{"type":39,"tag":573,"props":6837,"children":6838},{"class":575,"line":3492},[6839,6844],{"type":39,"tag":573,"props":6840,"children":6841},{"style":968},[6842],{"type":45,"value":6843},"    else",{"type":39,"tag":573,"props":6845,"children":6846},{"style":580},[6847],{"type":45,"value":3729},{"type":39,"tag":573,"props":6849,"children":6850},{"class":575,"line":3513},[6851],{"type":39,"tag":573,"props":6852,"children":6853},{"style":580},[6854],{"type":45,"value":6855},"        logger.info(request.json)\n",{"type":39,"tag":573,"props":6857,"children":6858},{"class":575,"line":3530},[6859,6864],{"type":39,"tag":573,"props":6860,"children":6861},{"style":968},[6862],{"type":45,"value":6863},"        try",{"type":39,"tag":573,"props":6865,"children":6866},{"style":580},[6867],{"type":45,"value":3729},{"type":39,"tag":573,"props":6869,"children":6870},{"class":575,"line":3538},[6871,6876,6880,6884,6889,6893,6898,6902,6906,6910,6915],{"type":39,"tag":573,"props":6872,"children":6873},{"style":580},[6874],{"type":45,"value":6875},"            interaction_option ",{"type":39,"tag":573,"props":6877,"children":6878},{"style":968},[6879],{"type":45,"value":1896},{"type":39,"tag":573,"props":6881,"children":6882},{"style":580},[6883],{"type":45,"value":6782},{"type":39,"tag":573,"props":6885,"children":6886},{"style":783},[6887],{"type":45,"value":6888},"\"data\"",{"type":39,"tag":573,"props":6890,"children":6891},{"style":580},[6892],{"type":45,"value":1911},{"type":39,"tag":573,"props":6894,"children":6895},{"style":783},[6896],{"type":45,"value":6897},"\"options\"",{"type":39,"tag":573,"props":6899,"children":6900},{"style":580},[6901],{"type":45,"value":1911},{"type":39,"tag":573,"props":6903,"children":6904},{"style":1003},[6905],{"type":45,"value":1916},{"type":39,"tag":573,"props":6907,"children":6908},{"style":580},[6909],{"type":45,"value":1911},{"type":39,"tag":573,"props":6911,"children":6912},{"style":783},[6913],{"type":45,"value":6914},"\"value\"",{"type":39,"tag":573,"props":6916,"children":6917},{"style":580},[6918],{"type":45,"value":6919},"]\n",{"type":39,"tag":573,"props":6921,"children":6922},{"class":575,"line":3546},[6923,6928,6933],{"type":39,"tag":573,"props":6924,"children":6925},{"style":968},[6926],{"type":45,"value":6927},"        except",{"type":39,"tag":573,"props":6929,"children":6930},{"style":590},[6931],{"type":45,"value":6932}," KeyError",{"type":39,"tag":573,"props":6934,"children":6935},{"style":580},[6936],{"type":45,"value":3729},{"type":39,"tag":573,"props":6938,"children":6939},{"class":575,"line":3567},[6940,6945,6950],{"type":39,"tag":573,"props":6941,"children":6942},{"style":580},[6943],{"type":45,"value":6944},"            logger.info(",{"type":39,"tag":573,"props":6946,"children":6947},{"style":783},[6948],{"type":45,"value":6949},"\"Could not parse the interaction option\"",{"type":39,"tag":573,"props":6951,"children":6952},{"style":580},[6953],{"type":45,"value":3129},{"type":39,"tag":573,"props":6955,"children":6956},{"class":575,"line":3584},[6957,6961,6965],{"type":39,"tag":573,"props":6958,"children":6959},{"style":580},[6960],{"type":45,"value":6875},{"type":39,"tag":573,"props":6962,"children":6963},{"style":968},[6964],{"type":45,"value":1896},{"type":39,"tag":573,"props":6966,"children":6967},{"style":783},[6968],{"type":45,"value":6969}," \"status\"\n",{"type":39,"tag":573,"props":6971,"children":6972},{"class":575,"line":3593},[6973],{"type":39,"tag":573,"props":6974,"children":6975},{"emptyLinePlaceholder":34},[6976],{"type":45,"value":1722},{"type":39,"tag":573,"props":6978,"children":6979},{"class":575,"line":3602},[6980,6985,6990],{"type":39,"tag":573,"props":6981,"children":6982},{"style":580},[6983],{"type":45,"value":6984},"        logger.info(",{"type":39,"tag":573,"props":6986,"children":6987},{"style":783},[6988],{"type":45,"value":6989},"\"Interaction:\"",{"type":39,"tag":573,"props":6991,"children":6992},{"style":580},[6993],{"type":45,"value":3129},{"type":39,"tag":573,"props":6995,"children":6996},{"class":575,"line":3611},[6997],{"type":39,"tag":573,"props":6998,"children":6999},{"style":580},[7000],{"type":45,"value":7001},"        logger.info(interaction_option)\n",{"type":39,"tag":573,"props":7003,"children":7004},{"class":575,"line":3620},[7005],{"type":39,"tag":573,"props":7006,"children":7007},{"emptyLinePlaceholder":34},[7008],{"type":45,"value":1722},{"type":39,"tag":573,"props":7010,"children":7011},{"class":575,"line":3628},[7012,7017,7021],{"type":39,"tag":573,"props":7013,"children":7014},{"style":580},[7015],{"type":45,"value":7016},"        content ",{"type":39,"tag":573,"props":7018,"children":7019},{"style":968},[7020],{"type":45,"value":1896},{"type":39,"tag":573,"props":7022,"children":7023},{"style":783},[7024],{"type":45,"value":7025}," \"\"\n",{"type":39,"tag":573,"props":7027,"children":7028},{"class":575,"line":3636},[7029],{"type":39,"tag":573,"props":7030,"children":7031},{"emptyLinePlaceholder":34},[7032],{"type":45,"value":1722},{"type":39,"tag":573,"props":7034,"children":7035},{"class":575,"line":3653},[7036,7040,7045,7049,7054],{"type":39,"tag":573,"props":7037,"children":7038},{"style":968},[7039],{"type":45,"value":1738},{"type":39,"tag":573,"props":7041,"children":7042},{"style":580},[7043],{"type":45,"value":7044}," interaction_option ",{"type":39,"tag":573,"props":7046,"children":7047},{"style":968},[7048],{"type":45,"value":1705},{"type":39,"tag":573,"props":7050,"children":7051},{"style":783},[7052],{"type":45,"value":7053}," \"status\"",{"type":39,"tag":573,"props":7055,"children":7056},{"style":580},[7057],{"type":45,"value":3729},{"type":39,"tag":573,"props":7059,"children":7060},{"class":575,"line":3686},[7061,7066],{"type":39,"tag":573,"props":7062,"children":7063},{"style":968},[7064],{"type":45,"value":7065},"            try",{"type":39,"tag":573,"props":7067,"children":7068},{"style":580},[7069],{"type":45,"value":3729},{"type":39,"tag":573,"props":7071,"children":7072},{"class":575,"line":3694},[7073],{"type":39,"tag":573,"props":7074,"children":7075},{"emptyLinePlaceholder":34},[7076],{"type":45,"value":1722},{"type":39,"tag":573,"props":7078,"children":7079},{"class":575,"line":3702},[7080,7085,7089],{"type":39,"tag":573,"props":7081,"children":7082},{"style":580},[7083],{"type":45,"value":7084},"                resp ",{"type":39,"tag":573,"props":7086,"children":7087},{"style":968},[7088],{"type":45,"value":1896},{"type":39,"tag":573,"props":7090,"children":7091},{"style":580},[7092],{"type":45,"value":7093}," client.describe_services(\n",{"type":39,"tag":573,"props":7095,"children":7096},{"class":575,"line":3732},[7097,7102,7106,7111,7116,7120,7124],{"type":39,"tag":573,"props":7098,"children":7099},{"style":1569},[7100],{"type":45,"value":7101},"                    cluster",{"type":39,"tag":573,"props":7103,"children":7104},{"style":968},[7105],{"type":45,"value":1896},{"type":39,"tag":573,"props":7107,"children":7108},{"style":580},[7109],{"type":45,"value":7110},"os.environ.get(",{"type":39,"tag":573,"props":7112,"children":7113},{"style":783},[7114],{"type":45,"value":7115},"\"ECS_CLUSTER_ARN\"",{"type":39,"tag":573,"props":7117,"children":7118},{"style":580},[7119],{"type":45,"value":1577},{"type":39,"tag":573,"props":7121,"children":7122},{"style":783},[7123],{"type":45,"value":6120},{"type":39,"tag":573,"props":7125,"children":7126},{"style":580},[7127],{"type":45,"value":5250},{"type":39,"tag":573,"props":7129,"children":7130},{"class":575,"line":3777},[7131,7136,7140],{"type":39,"tag":573,"props":7132,"children":7133},{"style":1569},[7134],{"type":45,"value":7135},"                    services",{"type":39,"tag":573,"props":7137,"children":7138},{"style":968},[7139],{"type":45,"value":1896},{"type":39,"tag":573,"props":7141,"children":7142},{"style":580},[7143],{"type":45,"value":4593},{"type":39,"tag":573,"props":7145,"children":7147},{"class":575,"line":7146},49,[7148,7153,7158,7162,7166],{"type":39,"tag":573,"props":7149,"children":7150},{"style":580},[7151],{"type":45,"value":7152},"                        os.environ.get(",{"type":39,"tag":573,"props":7154,"children":7155},{"style":783},[7156],{"type":45,"value":7157},"\"ECS_SERVICE_NAME\"",{"type":39,"tag":573,"props":7159,"children":7160},{"style":580},[7161],{"type":45,"value":1577},{"type":39,"tag":573,"props":7163,"children":7164},{"style":783},[7165],{"type":45,"value":6120},{"type":39,"tag":573,"props":7167,"children":7168},{"style":580},[7169],{"type":45,"value":5250},{"type":39,"tag":573,"props":7171,"children":7173},{"class":575,"line":7172},50,[7174],{"type":39,"tag":573,"props":7175,"children":7176},{"style":580},[7177],{"type":45,"value":7178},"                    ]\n",{"type":39,"tag":573,"props":7180,"children":7182},{"class":575,"line":7181},51,[7183],{"type":39,"tag":573,"props":7184,"children":7185},{"style":580},[7186],{"type":45,"value":7187},"                )\n",{"type":39,"tag":573,"props":7189,"children":7191},{"class":575,"line":7190},52,[7192,7197,7201,7206,7211,7215,7219,7223,7228],{"type":39,"tag":573,"props":7193,"children":7194},{"style":580},[7195],{"type":45,"value":7196},"                desired_count ",{"type":39,"tag":573,"props":7198,"children":7199},{"style":968},[7200],{"type":45,"value":1896},{"type":39,"tag":573,"props":7202,"children":7203},{"style":580},[7204],{"type":45,"value":7205}," resp[",{"type":39,"tag":573,"props":7207,"children":7208},{"style":783},[7209],{"type":45,"value":7210},"\"services\"",{"type":39,"tag":573,"props":7212,"children":7213},{"style":580},[7214],{"type":45,"value":1911},{"type":39,"tag":573,"props":7216,"children":7217},{"style":1003},[7218],{"type":45,"value":1916},{"type":39,"tag":573,"props":7220,"children":7221},{"style":580},[7222],{"type":45,"value":1911},{"type":39,"tag":573,"props":7224,"children":7225},{"style":783},[7226],{"type":45,"value":7227},"\"desiredCount\"",{"type":39,"tag":573,"props":7229,"children":7230},{"style":580},[7231],{"type":45,"value":6919},{"type":39,"tag":573,"props":7233,"children":7235},{"class":575,"line":7234},53,[7236,7241,7245,7249,7253,7257,7261,7265,7270],{"type":39,"tag":573,"props":7237,"children":7238},{"style":580},[7239],{"type":45,"value":7240},"                running_count ",{"type":39,"tag":573,"props":7242,"children":7243},{"style":968},[7244],{"type":45,"value":1896},{"type":39,"tag":573,"props":7246,"children":7247},{"style":580},[7248],{"type":45,"value":7205},{"type":39,"tag":573,"props":7250,"children":7251},{"style":783},[7252],{"type":45,"value":7210},{"type":39,"tag":573,"props":7254,"children":7255},{"style":580},[7256],{"type":45,"value":1911},{"type":39,"tag":573,"props":7258,"children":7259},{"style":1003},[7260],{"type":45,"value":1916},{"type":39,"tag":573,"props":7262,"children":7263},{"style":580},[7264],{"type":45,"value":1911},{"type":39,"tag":573,"props":7266,"children":7267},{"style":783},[7268],{"type":45,"value":7269},"\"runningCount\"",{"type":39,"tag":573,"props":7271,"children":7272},{"style":580},[7273],{"type":45,"value":6919},{"type":39,"tag":573,"props":7275,"children":7277},{"class":575,"line":7276},54,[7278,7283,7287,7291,7295,7299,7303,7307,7312],{"type":39,"tag":573,"props":7279,"children":7280},{"style":580},[7281],{"type":45,"value":7282},"                pending_count ",{"type":39,"tag":573,"props":7284,"children":7285},{"style":968},[7286],{"type":45,"value":1896},{"type":39,"tag":573,"props":7288,"children":7289},{"style":580},[7290],{"type":45,"value":7205},{"type":39,"tag":573,"props":7292,"children":7293},{"style":783},[7294],{"type":45,"value":7210},{"type":39,"tag":573,"props":7296,"children":7297},{"style":580},[7298],{"type":45,"value":1911},{"type":39,"tag":573,"props":7300,"children":7301},{"style":1003},[7302],{"type":45,"value":1916},{"type":39,"tag":573,"props":7304,"children":7305},{"style":580},[7306],{"type":45,"value":1911},{"type":39,"tag":573,"props":7308,"children":7309},{"style":783},[7310],{"type":45,"value":7311},"\"pendingCount\"",{"type":39,"tag":573,"props":7313,"children":7314},{"style":580},[7315],{"type":45,"value":6919},{"type":39,"tag":573,"props":7317,"children":7319},{"class":575,"line":7318},55,[7320],{"type":39,"tag":573,"props":7321,"children":7322},{"emptyLinePlaceholder":34},[7323],{"type":45,"value":1722},{"type":39,"tag":573,"props":7325,"children":7327},{"class":575,"line":7326},56,[7328,7333,7337,7341,7346,7350,7355,7360,7365,7369,7374,7378,7383,7387,7392,7396],{"type":39,"tag":573,"props":7329,"children":7330},{"style":580},[7331],{"type":45,"value":7332},"                content ",{"type":39,"tag":573,"props":7334,"children":7335},{"style":968},[7336],{"type":45,"value":1896},{"type":39,"tag":573,"props":7338,"children":7339},{"style":1580},[7340],{"type":45,"value":3205},{"type":39,"tag":573,"props":7342,"children":7343},{"style":783},[7344],{"type":45,"value":7345},"\"Desired: ",{"type":39,"tag":573,"props":7347,"children":7348},{"style":1003},[7349],{"type":45,"value":6200},{"type":39,"tag":573,"props":7351,"children":7352},{"style":580},[7353],{"type":45,"value":7354},"desired_count",{"type":39,"tag":573,"props":7356,"children":7357},{"style":1003},[7358],{"type":45,"value":7359},"}",{"type":39,"tag":573,"props":7361,"children":7362},{"style":783},[7363],{"type":45,"value":7364}," | Running: ",{"type":39,"tag":573,"props":7366,"children":7367},{"style":1003},[7368],{"type":45,"value":6200},{"type":39,"tag":573,"props":7370,"children":7371},{"style":580},[7372],{"type":45,"value":7373},"running_count",{"type":39,"tag":573,"props":7375,"children":7376},{"style":1003},[7377],{"type":45,"value":7359},{"type":39,"tag":573,"props":7379,"children":7380},{"style":783},[7381],{"type":45,"value":7382}," | Pending: ",{"type":39,"tag":573,"props":7384,"children":7385},{"style":1003},[7386],{"type":45,"value":6200},{"type":39,"tag":573,"props":7388,"children":7389},{"style":580},[7390],{"type":45,"value":7391},"pending_count",{"type":39,"tag":573,"props":7393,"children":7394},{"style":1003},[7395],{"type":45,"value":7359},{"type":39,"tag":573,"props":7397,"children":7398},{"style":783},[7399],{"type":45,"value":3683},{"type":39,"tag":573,"props":7401,"children":7403},{"class":575,"line":7402},57,[7404],{"type":39,"tag":573,"props":7405,"children":7406},{"emptyLinePlaceholder":34},[7407],{"type":45,"value":1722},{"type":39,"tag":573,"props":7409,"children":7411},{"class":575,"line":7410},58,[7412,7417,7422,7426],{"type":39,"tag":573,"props":7413,"children":7414},{"style":968},[7415],{"type":45,"value":7416},"            except",{"type":39,"tag":573,"props":7418,"children":7419},{"style":580},[7420],{"type":45,"value":7421}," Error ",{"type":39,"tag":573,"props":7423,"children":7424},{"style":968},[7425],{"type":45,"value":1289},{"type":39,"tag":573,"props":7427,"children":7428},{"style":580},[7429],{"type":45,"value":7430}," e:\n",{"type":39,"tag":573,"props":7432,"children":7434},{"class":575,"line":7433},59,[7435,7439,7443],{"type":39,"tag":573,"props":7436,"children":7437},{"style":580},[7438],{"type":45,"value":7332},{"type":39,"tag":573,"props":7440,"children":7441},{"style":968},[7442],{"type":45,"value":1896},{"type":39,"tag":573,"props":7444,"children":7445},{"style":783},[7446],{"type":45,"value":7447}," \"Could not get server status\"\n",{"type":39,"tag":573,"props":7449,"children":7451},{"class":575,"line":7450},60,[7452,7457,7462],{"type":39,"tag":573,"props":7453,"children":7454},{"style":580},[7455],{"type":45,"value":7456},"                logger.info(",{"type":39,"tag":573,"props":7458,"children":7459},{"style":783},[7460],{"type":45,"value":7461},"\"Could not get the server status\"",{"type":39,"tag":573,"props":7463,"children":7464},{"style":580},[7465],{"type":45,"value":3129},{"type":39,"tag":573,"props":7467,"children":7469},{"class":575,"line":7468},61,[7470],{"type":39,"tag":573,"props":7471,"children":7472},{"style":580},[7473],{"type":45,"value":7474},"                logger.info(e)\n",{"type":39,"tag":573,"props":7476,"children":7478},{"class":575,"line":7477},62,[7479],{"type":39,"tag":573,"props":7480,"children":7481},{"emptyLinePlaceholder":34},[7482],{"type":45,"value":1722},{"type":39,"tag":573,"props":7484,"children":7486},{"class":575,"line":7485},63,[7487,7492,7496,7500,7505],{"type":39,"tag":573,"props":7488,"children":7489},{"style":968},[7490],{"type":45,"value":7491},"        elif",{"type":39,"tag":573,"props":7493,"children":7494},{"style":580},[7495],{"type":45,"value":7044},{"type":39,"tag":573,"props":7497,"children":7498},{"style":968},[7499],{"type":45,"value":1705},{"type":39,"tag":573,"props":7501,"children":7502},{"style":783},[7503],{"type":45,"value":7504}," \"start\"",{"type":39,"tag":573,"props":7506,"children":7507},{"style":580},[7508],{"type":45,"value":3729},{"type":39,"tag":573,"props":7510,"children":7512},{"class":575,"line":7511},64,[7513,7518,7522],{"type":39,"tag":573,"props":7514,"children":7515},{"style":580},[7516],{"type":45,"value":7517},"            content ",{"type":39,"tag":573,"props":7519,"children":7520},{"style":968},[7521],{"type":45,"value":1896},{"type":39,"tag":573,"props":7523,"children":7524},{"style":783},[7525],{"type":45,"value":7526}," \"Starting the server\"\n",{"type":39,"tag":573,"props":7528,"children":7530},{"class":575,"line":7529},65,[7531],{"type":39,"tag":573,"props":7532,"children":7533},{"emptyLinePlaceholder":34},[7534],{"type":45,"value":1722},{"type":39,"tag":573,"props":7536,"children":7538},{"class":575,"line":7537},66,[7539,7544,7548],{"type":39,"tag":573,"props":7540,"children":7541},{"style":580},[7542],{"type":45,"value":7543},"            resp ",{"type":39,"tag":573,"props":7545,"children":7546},{"style":968},[7547],{"type":45,"value":1896},{"type":39,"tag":573,"props":7549,"children":7550},{"style":580},[7551],{"type":45,"value":7552}," client.update_service(\n",{"type":39,"tag":573,"props":7554,"children":7556},{"class":575,"line":7555},67,[7557,7562,7566,7570,7574,7578,7582],{"type":39,"tag":573,"props":7558,"children":7559},{"style":1569},[7560],{"type":45,"value":7561},"                cluster",{"type":39,"tag":573,"props":7563,"children":7564},{"style":968},[7565],{"type":45,"value":1896},{"type":39,"tag":573,"props":7567,"children":7568},{"style":580},[7569],{"type":45,"value":7110},{"type":39,"tag":573,"props":7571,"children":7572},{"style":783},[7573],{"type":45,"value":7115},{"type":39,"tag":573,"props":7575,"children":7576},{"style":580},[7577],{"type":45,"value":1577},{"type":39,"tag":573,"props":7579,"children":7580},{"style":783},[7581],{"type":45,"value":6120},{"type":39,"tag":573,"props":7583,"children":7584},{"style":580},[7585],{"type":45,"value":5250},{"type":39,"tag":573,"props":7587,"children":7589},{"class":575,"line":7588},68,[7590,7595,7599,7603,7607,7611,7615],{"type":39,"tag":573,"props":7591,"children":7592},{"style":1569},[7593],{"type":45,"value":7594},"                service",{"type":39,"tag":573,"props":7596,"children":7597},{"style":968},[7598],{"type":45,"value":1896},{"type":39,"tag":573,"props":7600,"children":7601},{"style":580},[7602],{"type":45,"value":7110},{"type":39,"tag":573,"props":7604,"children":7605},{"style":783},[7606],{"type":45,"value":7157},{"type":39,"tag":573,"props":7608,"children":7609},{"style":580},[7610],{"type":45,"value":1577},{"type":39,"tag":573,"props":7612,"children":7613},{"style":783},[7614],{"type":45,"value":6120},{"type":39,"tag":573,"props":7616,"children":7617},{"style":580},[7618],{"type":45,"value":5250},{"type":39,"tag":573,"props":7620,"children":7622},{"class":575,"line":7621},69,[7623,7628,7632],{"type":39,"tag":573,"props":7624,"children":7625},{"style":1569},[7626],{"type":45,"value":7627},"                desiredCount",{"type":39,"tag":573,"props":7629,"children":7630},{"style":968},[7631],{"type":45,"value":1896},{"type":39,"tag":573,"props":7633,"children":7634},{"style":1003},[7635],{"type":45,"value":7636},"1\n",{"type":39,"tag":573,"props":7638,"children":7640},{"class":575,"line":7639},70,[7641],{"type":39,"tag":573,"props":7642,"children":7643},{"style":580},[7644],{"type":45,"value":7645},"            )\n",{"type":39,"tag":573,"props":7647,"children":7649},{"class":575,"line":7648},71,[7650],{"type":39,"tag":573,"props":7651,"children":7652},{"emptyLinePlaceholder":34},[7653],{"type":45,"value":1722},{"type":39,"tag":573,"props":7655,"children":7657},{"class":575,"line":7656},72,[7658,7662,7666,7670,7675],{"type":39,"tag":573,"props":7659,"children":7660},{"style":968},[7661],{"type":45,"value":7491},{"type":39,"tag":573,"props":7663,"children":7664},{"style":580},[7665],{"type":45,"value":7044},{"type":39,"tag":573,"props":7667,"children":7668},{"style":968},[7669],{"type":45,"value":1705},{"type":39,"tag":573,"props":7671,"children":7672},{"style":783},[7673],{"type":45,"value":7674}," \"stop\"",{"type":39,"tag":573,"props":7676,"children":7677},{"style":580},[7678],{"type":45,"value":3729},{"type":39,"tag":573,"props":7680,"children":7682},{"class":575,"line":7681},73,[7683,7687,7691],{"type":39,"tag":573,"props":7684,"children":7685},{"style":580},[7686],{"type":45,"value":7517},{"type":39,"tag":573,"props":7688,"children":7689},{"style":968},[7690],{"type":45,"value":1896},{"type":39,"tag":573,"props":7692,"children":7693},{"style":783},[7694],{"type":45,"value":7695}," \"Stopping the server\"\n",{"type":39,"tag":573,"props":7697,"children":7699},{"class":575,"line":7698},74,[7700],{"type":39,"tag":573,"props":7701,"children":7702},{"emptyLinePlaceholder":34},[7703],{"type":45,"value":1722},{"type":39,"tag":573,"props":7705,"children":7707},{"class":575,"line":7706},75,[7708,7712,7716],{"type":39,"tag":573,"props":7709,"children":7710},{"style":580},[7711],{"type":45,"value":7543},{"type":39,"tag":573,"props":7713,"children":7714},{"style":968},[7715],{"type":45,"value":1896},{"type":39,"tag":573,"props":7717,"children":7718},{"style":580},[7719],{"type":45,"value":7552},{"type":39,"tag":573,"props":7721,"children":7723},{"class":575,"line":7722},76,[7724,7728,7732,7736,7740,7744,7748],{"type":39,"tag":573,"props":7725,"children":7726},{"style":1569},[7727],{"type":45,"value":7561},{"type":39,"tag":573,"props":7729,"children":7730},{"style":968},[7731],{"type":45,"value":1896},{"type":39,"tag":573,"props":7733,"children":7734},{"style":580},[7735],{"type":45,"value":7110},{"type":39,"tag":573,"props":7737,"children":7738},{"style":783},[7739],{"type":45,"value":7115},{"type":39,"tag":573,"props":7741,"children":7742},{"style":580},[7743],{"type":45,"value":1577},{"type":39,"tag":573,"props":7745,"children":7746},{"style":783},[7747],{"type":45,"value":6120},{"type":39,"tag":573,"props":7749,"children":7750},{"style":580},[7751],{"type":45,"value":5250},{"type":39,"tag":573,"props":7753,"children":7755},{"class":575,"line":7754},77,[7756,7760,7764,7768,7772,7776,7780],{"type":39,"tag":573,"props":7757,"children":7758},{"style":1569},[7759],{"type":45,"value":7594},{"type":39,"tag":573,"props":7761,"children":7762},{"style":968},[7763],{"type":45,"value":1896},{"type":39,"tag":573,"props":7765,"children":7766},{"style":580},[7767],{"type":45,"value":7110},{"type":39,"tag":573,"props":7769,"children":7770},{"style":783},[7771],{"type":45,"value":7157},{"type":39,"tag":573,"props":7773,"children":7774},{"style":580},[7775],{"type":45,"value":1577},{"type":39,"tag":573,"props":7777,"children":7778},{"style":783},[7779],{"type":45,"value":6120},{"type":39,"tag":573,"props":7781,"children":7782},{"style":580},[7783],{"type":45,"value":5250},{"type":39,"tag":573,"props":7785,"children":7787},{"class":575,"line":7786},78,[7788,7792,7796],{"type":39,"tag":573,"props":7789,"children":7790},{"style":1569},[7791],{"type":45,"value":7627},{"type":39,"tag":573,"props":7793,"children":7794},{"style":968},[7795],{"type":45,"value":1896},{"type":39,"tag":573,"props":7797,"children":7798},{"style":1003},[7799],{"type":45,"value":7800},"0\n",{"type":39,"tag":573,"props":7802,"children":7804},{"class":575,"line":7803},79,[7805],{"type":39,"tag":573,"props":7806,"children":7807},{"style":580},[7808],{"type":45,"value":7645},{"type":39,"tag":573,"props":7810,"children":7812},{"class":575,"line":7811},80,[7813],{"type":39,"tag":573,"props":7814,"children":7815},{"emptyLinePlaceholder":34},[7816],{"type":45,"value":1722},{"type":39,"tag":573,"props":7818,"children":7820},{"class":575,"line":7819},81,[7821,7825],{"type":39,"tag":573,"props":7822,"children":7823},{"style":968},[7824],{"type":45,"value":1806},{"type":39,"tag":573,"props":7826,"children":7827},{"style":580},[7828],{"type":45,"value":3729},{"type":39,"tag":573,"props":7830,"children":7832},{"class":575,"line":7831},82,[7833,7837,7841],{"type":39,"tag":573,"props":7834,"children":7835},{"style":580},[7836],{"type":45,"value":7517},{"type":39,"tag":573,"props":7838,"children":7839},{"style":968},[7840],{"type":45,"value":1896},{"type":39,"tag":573,"props":7842,"children":7843},{"style":783},[7844],{"type":45,"value":7845}," \"Unknown command\"\n",{"type":39,"tag":573,"props":7847,"children":7849},{"class":575,"line":7848},83,[7850],{"type":39,"tag":573,"props":7851,"children":7852},{"emptyLinePlaceholder":34},[7853],{"type":45,"value":1722},{"type":39,"tag":573,"props":7855,"children":7857},{"class":575,"line":7856},84,[7858],{"type":39,"tag":573,"props":7859,"children":7860},{"style":580},[7861],{"type":45,"value":7862},"        logger.info(resp)\n",{"type":39,"tag":573,"props":7864,"children":7866},{"class":575,"line":7865},85,[7867],{"type":39,"tag":573,"props":7868,"children":7869},{"emptyLinePlaceholder":34},[7870],{"type":45,"value":1722},{"type":39,"tag":573,"props":7872,"children":7874},{"class":575,"line":7873},86,[7875,7879],{"type":39,"tag":573,"props":7876,"children":7877},{"style":968},[7878],{"type":45,"value":6813},{"type":39,"tag":573,"props":7880,"children":7881},{"style":580},[7882],{"type":45,"value":7883}," jsonify({\n",{"type":39,"tag":573,"props":7885,"children":7887},{"class":575,"line":7886},87,[7888,7892,7896,7901],{"type":39,"tag":573,"props":7889,"children":7890},{"style":783},[7891],{"type":45,"value":3375},{"type":39,"tag":573,"props":7893,"children":7894},{"style":580},[7895],{"type":45,"value":598},{"type":39,"tag":573,"props":7897,"children":7898},{"style":1003},[7899],{"type":45,"value":7900},"4",{"type":39,"tag":573,"props":7902,"children":7903},{"style":580},[7904],{"type":45,"value":609},{"type":39,"tag":573,"props":7906,"children":7908},{"class":575,"line":7907},88,[7909,7914],{"type":39,"tag":573,"props":7910,"children":7911},{"style":783},[7912],{"type":45,"value":7913},"            \"data\"",{"type":39,"tag":573,"props":7915,"children":7916},{"style":580},[7917],{"type":45,"value":3989},{"type":39,"tag":573,"props":7919,"children":7921},{"class":575,"line":7920},89,[7922,7927,7931,7936],{"type":39,"tag":573,"props":7923,"children":7924},{"style":783},[7925],{"type":45,"value":7926},"                \"tts\"",{"type":39,"tag":573,"props":7928,"children":7929},{"style":580},[7930],{"type":45,"value":598},{"type":39,"tag":573,"props":7932,"children":7933},{"style":1003},[7934],{"type":45,"value":7935},"False",{"type":39,"tag":573,"props":7937,"children":7938},{"style":580},[7939],{"type":45,"value":609},{"type":39,"tag":573,"props":7941,"children":7943},{"class":575,"line":7942},90,[7944,7949],{"type":39,"tag":573,"props":7945,"children":7946},{"style":783},[7947],{"type":45,"value":7948},"                \"content\"",{"type":39,"tag":573,"props":7950,"children":7951},{"style":580},[7952],{"type":45,"value":7953},": content,\n",{"type":39,"tag":573,"props":7955,"children":7957},{"class":575,"line":7956},91,[7958,7963],{"type":39,"tag":573,"props":7959,"children":7960},{"style":783},[7961],{"type":45,"value":7962},"                \"embeds\"",{"type":39,"tag":573,"props":7964,"children":7965},{"style":580},[7966],{"type":45,"value":7967},": [],\n",{"type":39,"tag":573,"props":7969,"children":7971},{"class":575,"line":7970},92,[7972,7977,7982,7987],{"type":39,"tag":573,"props":7973,"children":7974},{"style":783},[7975],{"type":45,"value":7976},"                \"allowed_mentions\"",{"type":39,"tag":573,"props":7978,"children":7979},{"style":580},[7980],{"type":45,"value":7981},": { ",{"type":39,"tag":573,"props":7983,"children":7984},{"style":783},[7985],{"type":45,"value":7986},"\"parse\"",{"type":39,"tag":573,"props":7988,"children":7989},{"style":580},[7990],{"type":45,"value":7991},": [] }\n",{"type":39,"tag":573,"props":7993,"children":7995},{"class":575,"line":7994},93,[7996],{"type":39,"tag":573,"props":7997,"children":7998},{"style":580},[7999],{"type":45,"value":8000},"            }\n",{"type":39,"tag":573,"props":8002,"children":8004},{"class":575,"line":8003},94,[8005],{"type":39,"tag":573,"props":8006,"children":8007},{"style":580},[8008],{"type":45,"value":8009},"        })\n",{"type":39,"tag":573,"props":8011,"children":8013},{"class":575,"line":8012},95,[8014],{"type":39,"tag":573,"props":8015,"children":8016},{"emptyLinePlaceholder":34},[8017],{"type":45,"value":1722},{"type":39,"tag":573,"props":8019,"children":8021},{"class":575,"line":8020},96,[8022,8026,8031,8035,8040,8044,8049],{"type":39,"tag":573,"props":8023,"children":8024},{"style":1580},[8025],{"type":45,"value":6760},{"type":39,"tag":573,"props":8027,"children":8028},{"style":772},[8029],{"type":45,"value":8030}," handler",{"type":39,"tag":573,"props":8032,"children":8033},{"style":580},[8034],{"type":45,"value":1533},{"type":39,"tag":573,"props":8036,"children":8037},{"style":4992},[8038],{"type":45,"value":8039},"event",{"type":39,"tag":573,"props":8041,"children":8042},{"style":580},[8043],{"type":45,"value":1577},{"type":39,"tag":573,"props":8045,"children":8046},{"style":4992},[8047],{"type":45,"value":8048},"context",{"type":39,"tag":573,"props":8050,"children":8051},{"style":580},[8052],{"type":45,"value":4965},{"type":39,"tag":573,"props":8054,"children":8056},{"class":575,"line":8055},97,[8057,8062],{"type":39,"tag":573,"props":8058,"children":8059},{"style":968},[8060],{"type":45,"value":8061},"    return",{"type":39,"tag":573,"props":8063,"children":8064},{"style":580},[8065],{"type":45,"value":8066}," awsgi.response(\n",{"type":39,"tag":573,"props":8068,"children":8070},{"class":575,"line":8069},98,[8071],{"type":39,"tag":573,"props":8072,"children":8073},{"style":580},[8074],{"type":45,"value":8075},"        app,\n",{"type":39,"tag":573,"props":8077,"children":8079},{"class":575,"line":8078},99,[8080],{"type":39,"tag":573,"props":8081,"children":8082},{"style":580},[8083],{"type":45,"value":8084},"        event,\n",{"type":39,"tag":573,"props":8086,"children":8088},{"class":575,"line":8087},100,[8089],{"type":39,"tag":573,"props":8090,"children":8091},{"style":580},[8092],{"type":45,"value":8093},"        context,\n",{"type":39,"tag":573,"props":8095,"children":8097},{"class":575,"line":8096},101,[8098,8103,8107,8111,8116],{"type":39,"tag":573,"props":8099,"children":8100},{"style":1569},[8101],{"type":45,"value":8102},"        base64_content_types",{"type":39,"tag":573,"props":8104,"children":8105},{"style":968},[8106],{"type":45,"value":1896},{"type":39,"tag":573,"props":8108,"children":8109},{"style":580},[8110],{"type":45,"value":6200},{"type":39,"tag":573,"props":8112,"children":8113},{"style":783},[8114],{"type":45,"value":8115},"\"image/png\"",{"type":39,"tag":573,"props":8117,"children":8118},{"style":580},[8119],{"type":45,"value":702},{"type":39,"tag":573,"props":8121,"children":8123},{"class":575,"line":8122},102,[8124],{"type":39,"tag":573,"props":8125,"children":8126},{"style":580},[8127],{"type":45,"value":8128},"    )\n",{"type":39,"tag":48,"props":8130,"children":8131},{},[8132,8134,8140,8142,8148,8150,8155,8157,8163],{"type":45,"value":8133},"Notice how we pass the Flask ",{"type":39,"tag":339,"props":8135,"children":8137},{"className":8136},[],[8138],{"type":45,"value":8139},"app",{"type":45,"value":8141}," to ",{"type":39,"tag":339,"props":8143,"children":8145},{"className":8144},[],[8146],{"type":45,"value":8147},"awsgi.response",{"type":45,"value":8149},". ",{"type":39,"tag":339,"props":8151,"children":8153},{"className":8152},[],[8154],{"type":45,"value":6353},{"type":45,"value":8156}," (or ",{"type":39,"tag":339,"props":8158,"children":8160},{"className":8159},[],[8161],{"type":45,"value":8162},"awsgi",{"type":45,"value":8164}," as it is imported) is the go-between for API Gateway and WSGI.",{"type":39,"tag":40,"props":8166,"children":8168},{"id":8167},"add-the-cdk-code-for-api-gateway-and-lambda-that-will-serve-our-discord-interaction-endpoint-url",[8169],{"type":45,"value":8170},"Add the CDK code for API Gateway and Lambda that will serve our Discord Interaction Endpoint URL",{"type":39,"tag":48,"props":8172,"children":8173},{},[8174,8176,8181,8183,8188,8190,8196],{"type":45,"value":8175},"Now we can add the following code to ",{"type":39,"tag":339,"props":8177,"children":8179},{"className":8178},[],[8180],{"type":45,"value":4704},{"type":45,"value":8182}," to configure the API Gateway and Lambda function. Add the following to ",{"type":39,"tag":339,"props":8184,"children":8186},{"className":8185},[],[8187],{"type":45,"value":4704},{"type":45,"value":8189}," after our definition of ",{"type":39,"tag":339,"props":8191,"children":8193},{"className":8192},[],[8194],{"type":45,"value":8195},"self.valheim_world",{"type":45,"value":2585},{"type":39,"tag":563,"props":8198,"children":8200},{"code":8199,"language":3027,"meta":8,"className":3028,"style":8},"        self.env_vars = {\n            \"APPLICATION_PUBLIC_KEY\": os.environ.get(\"APPLICATION_PUBLIC_KEY\"),\n            \"ECS_SERVICE_NAME\": self.valheim_world.service.service_name,\n            \"ECS_CLUSTER_ARN\": self.valheim_world.service.cluster.cluster_arn\n        }\n\n        self.flask_lambda_layer = _lambda.LayerVersion(\n            self,\n            \"FlaskAppLambdaLayer\",\n            code=_lambda.AssetCode(\"./layers/flask\"),\n            compatible_runtimes=[_lambda.Runtime.PYTHON_3_8,],\n        )\n\n        self.flask_app_lambda = _lambda.Function(\n            self,\n            \"FlaskAppLambda\",\n            runtime=_lambda.Runtime.PYTHON_3_8,\n            code=_lambda.AssetCode('./lambda/functions/interactions'),\n            function_name=\"flask-app-handler\",\n            handler=\"lambda-handler.handler\",\n            layers=[self.flask_lambda_layer],\n            timeout=core.Duration.seconds(60),\n            environment={**self.env_vars},\n        )\n\n        self.flask_app_lambda.role.add_managed_policy(\n            iam.ManagedPolicy.from_managed_policy_arn(\n                self,\n                'ECS_FullAccessPolicy',\n                managed_policy_arn='arn:aws:iam::aws:policy/AmazonECS_FullAccess'\n            )\n        )\n\n        # https://slmkitani.medium.com/passing-custom-headers-through-amazon-api-gateway-to-an-aws-lambda-function-f3a1cfdc0e29\n        self.request_templates = {\n            \"application/json\": '''{\n                \"method\": \"$context.httpMethod\",\n                \"body\" : $input.json(\"$\"),\n                \"headers\": {\n                    #foreach($param in $input.params().header.keySet())\n                    \"$param\": \"$util.escapeJavaScript($input.params().header.get($param))\"\n                    #if($foreach.hasNext),#end\n                    #end\n                }\n            }\n            '''\n        }\n\n        self.apigateway = apigw.RestApi(\n            self,\n            'FlaskAppEndpoint',\n        )\n\n        self.apigateway.root.add_method(\"ANY\")\n\n        self.discord_interaction_webhook = self.apigateway.root.add_resource(\"discord\")\n\n        self.discord_interaction_webhook_integration = apigw.LambdaIntegration(\n            self.flask_app_lambda,\n            request_templates=self.request_templates\n        )\n\n        self.discord_interaction_webhook.add_method(\n            'POST',\n            self.discord_interaction_webhook_integration\n        )\n",[8201],{"type":39,"tag":339,"props":8202,"children":8203},{"__ignoreMap":8},[8204,8224,8245,8266,8287,8294,8301,8322,8333,8345,8371,8398,8406,8413,8434,8445,8457,8482,8506,8527,8548,8573,8599,8627,8634,8641,8653,8661,8673,8685,8702,8709,8716,8723,8731,8751,8768,8776,8784,8792,8800,8808,8816,8824,8831,8838,8846,8853,8860,8881,8892,8904,8911,8918,8939,8946,8981,8988,9009,9021,9042,9049,9056,9068,9080,9092],{"type":39,"tag":573,"props":8205,"children":8206},{"class":575,"line":576},[8207,8211,8216,8220],{"type":39,"tag":573,"props":8208,"children":8209},{"style":1553},[8210],{"type":45,"value":5099},{"type":39,"tag":573,"props":8212,"children":8213},{"style":580},[8214],{"type":45,"value":8215},".env_vars ",{"type":39,"tag":573,"props":8217,"children":8218},{"style":968},[8219],{"type":45,"value":1896},{"type":39,"tag":573,"props":8221,"children":8222},{"style":580},[8223],{"type":45,"value":1811},{"type":39,"tag":573,"props":8225,"children":8226},{"class":575,"line":586},[8227,8232,8236,8241],{"type":39,"tag":573,"props":8228,"children":8229},{"style":783},[8230],{"type":45,"value":8231},"            \"APPLICATION_PUBLIC_KEY\"",{"type":39,"tag":573,"props":8233,"children":8234},{"style":580},[8235],{"type":45,"value":5336},{"type":39,"tag":573,"props":8237,"children":8238},{"style":783},[8239],{"type":45,"value":8240},"\"APPLICATION_PUBLIC_KEY\"",{"type":39,"tag":573,"props":8242,"children":8243},{"style":580},[8244],{"type":45,"value":5250},{"type":39,"tag":573,"props":8246,"children":8247},{"class":575,"line":612},[8248,8253,8257,8261],{"type":39,"tag":573,"props":8249,"children":8250},{"style":783},[8251],{"type":45,"value":8252},"            \"ECS_SERVICE_NAME\"",{"type":39,"tag":573,"props":8254,"children":8255},{"style":580},[8256],{"type":45,"value":598},{"type":39,"tag":573,"props":8258,"children":8259},{"style":1553},[8260],{"type":45,"value":4995},{"type":39,"tag":573,"props":8262,"children":8263},{"style":580},[8264],{"type":45,"value":8265},".valheim_world.service.service_name,\n",{"type":39,"tag":573,"props":8267,"children":8268},{"class":575,"line":634},[8269,8274,8278,8282],{"type":39,"tag":573,"props":8270,"children":8271},{"style":783},[8272],{"type":45,"value":8273},"            \"ECS_CLUSTER_ARN\"",{"type":39,"tag":573,"props":8275,"children":8276},{"style":580},[8277],{"type":45,"value":598},{"type":39,"tag":573,"props":8279,"children":8280},{"style":1553},[8281],{"type":45,"value":4995},{"type":39,"tag":573,"props":8283,"children":8284},{"style":580},[8285],{"type":45,"value":8286},".valheim_world.service.cluster.cluster_arn\n",{"type":39,"tag":573,"props":8288,"children":8289},{"class":575,"line":656},[8290],{"type":39,"tag":573,"props":8291,"children":8292},{"style":580},[8293],{"type":45,"value":1797},{"type":39,"tag":573,"props":8295,"children":8296},{"class":575,"line":678},[8297],{"type":39,"tag":573,"props":8298,"children":8299},{"emptyLinePlaceholder":34},[8300],{"type":45,"value":1722},{"type":39,"tag":573,"props":8302,"children":8303},{"class":575,"line":696},[8304,8308,8313,8317],{"type":39,"tag":573,"props":8305,"children":8306},{"style":1553},[8307],{"type":45,"value":5099},{"type":39,"tag":573,"props":8309,"children":8310},{"style":580},[8311],{"type":45,"value":8312},".flask_lambda_layer ",{"type":39,"tag":573,"props":8314,"children":8315},{"style":968},[8316],{"type":45,"value":1896},{"type":39,"tag":573,"props":8318,"children":8319},{"style":580},[8320],{"type":45,"value":8321}," _lambda.LayerVersion(\n",{"type":39,"tag":573,"props":8323,"children":8324},{"class":575,"line":1800},[8325,8329],{"type":39,"tag":573,"props":8326,"children":8327},{"style":1553},[8328],{"type":45,"value":5121},{"type":39,"tag":573,"props":8330,"children":8331},{"style":580},[8332],{"type":45,"value":609},{"type":39,"tag":573,"props":8334,"children":8335},{"class":575,"line":1814},[8336,8341],{"type":39,"tag":573,"props":8337,"children":8338},{"style":783},[8339],{"type":45,"value":8340},"            \"FlaskAppLambdaLayer\"",{"type":39,"tag":573,"props":8342,"children":8343},{"style":580},[8344],{"type":45,"value":609},{"type":39,"tag":573,"props":8346,"children":8347},{"class":575,"line":1847},[8348,8353,8357,8362,8367],{"type":39,"tag":573,"props":8349,"children":8350},{"style":1569},[8351],{"type":45,"value":8352},"            code",{"type":39,"tag":573,"props":8354,"children":8355},{"style":968},[8356],{"type":45,"value":1896},{"type":39,"tag":573,"props":8358,"children":8359},{"style":580},[8360],{"type":45,"value":8361},"_lambda.AssetCode(",{"type":39,"tag":573,"props":8363,"children":8364},{"style":783},[8365],{"type":45,"value":8366},"\"./layers/flask\"",{"type":39,"tag":573,"props":8368,"children":8369},{"style":580},[8370],{"type":45,"value":5250},{"type":39,"tag":573,"props":8372,"children":8373},{"class":575,"line":1855},[8374,8379,8383,8388,8393],{"type":39,"tag":573,"props":8375,"children":8376},{"style":1569},[8377],{"type":45,"value":8378},"            compatible_runtimes",{"type":39,"tag":573,"props":8380,"children":8381},{"style":968},[8382],{"type":45,"value":1896},{"type":39,"tag":573,"props":8384,"children":8385},{"style":580},[8386],{"type":45,"value":8387},"[_lambda.Runtime.",{"type":39,"tag":573,"props":8389,"children":8390},{"style":1003},[8391],{"type":45,"value":8392},"PYTHON_3_8",{"type":39,"tag":573,"props":8394,"children":8395},{"style":580},[8396],{"type":45,"value":8397},",],\n",{"type":39,"tag":573,"props":8399,"children":8400},{"class":575,"line":3182},[8401],{"type":39,"tag":573,"props":8402,"children":8403},{"style":580},[8404],{"type":45,"value":8405},"        )\n",{"type":39,"tag":573,"props":8407,"children":8408},{"class":575,"line":3190},[8409],{"type":39,"tag":573,"props":8410,"children":8411},{"emptyLinePlaceholder":34},[8412],{"type":45,"value":1722},{"type":39,"tag":573,"props":8414,"children":8415},{"class":575,"line":3233},[8416,8420,8425,8429],{"type":39,"tag":573,"props":8417,"children":8418},{"style":1553},[8419],{"type":45,"value":5099},{"type":39,"tag":573,"props":8421,"children":8422},{"style":580},[8423],{"type":45,"value":8424},".flask_app_lambda ",{"type":39,"tag":573,"props":8426,"children":8427},{"style":968},[8428],{"type":45,"value":1896},{"type":39,"tag":573,"props":8430,"children":8431},{"style":580},[8432],{"type":45,"value":8433}," _lambda.Function(\n",{"type":39,"tag":573,"props":8435,"children":8436},{"class":575,"line":3241},[8437,8441],{"type":39,"tag":573,"props":8438,"children":8439},{"style":1553},[8440],{"type":45,"value":5121},{"type":39,"tag":573,"props":8442,"children":8443},{"style":580},[8444],{"type":45,"value":609},{"type":39,"tag":573,"props":8446,"children":8447},{"class":575,"line":3258},[8448,8453],{"type":39,"tag":573,"props":8449,"children":8450},{"style":783},[8451],{"type":45,"value":8452},"            \"FlaskAppLambda\"",{"type":39,"tag":573,"props":8454,"children":8455},{"style":580},[8456],{"type":45,"value":609},{"type":39,"tag":573,"props":8458,"children":8459},{"class":575,"line":3280},[8460,8465,8469,8474,8478],{"type":39,"tag":573,"props":8461,"children":8462},{"style":1569},[8463],{"type":45,"value":8464},"            runtime",{"type":39,"tag":573,"props":8466,"children":8467},{"style":968},[8468],{"type":45,"value":1896},{"type":39,"tag":573,"props":8470,"children":8471},{"style":580},[8472],{"type":45,"value":8473},"_lambda.Runtime.",{"type":39,"tag":573,"props":8475,"children":8476},{"style":1003},[8477],{"type":45,"value":8392},{"type":39,"tag":573,"props":8479,"children":8480},{"style":580},[8481],{"type":45,"value":609},{"type":39,"tag":573,"props":8483,"children":8484},{"class":575,"line":3302},[8485,8489,8493,8497,8502],{"type":39,"tag":573,"props":8486,"children":8487},{"style":1569},[8488],{"type":45,"value":8352},{"type":39,"tag":573,"props":8490,"children":8491},{"style":968},[8492],{"type":45,"value":1896},{"type":39,"tag":573,"props":8494,"children":8495},{"style":580},[8496],{"type":45,"value":8361},{"type":39,"tag":573,"props":8498,"children":8499},{"style":783},[8500],{"type":45,"value":8501},"'./lambda/functions/interactions'",{"type":39,"tag":573,"props":8503,"children":8504},{"style":580},[8505],{"type":45,"value":5250},{"type":39,"tag":573,"props":8507,"children":8508},{"class":575,"line":3316},[8509,8514,8518,8523],{"type":39,"tag":573,"props":8510,"children":8511},{"style":1569},[8512],{"type":45,"value":8513},"            function_name",{"type":39,"tag":573,"props":8515,"children":8516},{"style":968},[8517],{"type":45,"value":1896},{"type":39,"tag":573,"props":8519,"children":8520},{"style":783},[8521],{"type":45,"value":8522},"\"flask-app-handler\"",{"type":39,"tag":573,"props":8524,"children":8525},{"style":580},[8526],{"type":45,"value":609},{"type":39,"tag":573,"props":8528,"children":8529},{"class":575,"line":3325},[8530,8535,8539,8544],{"type":39,"tag":573,"props":8531,"children":8532},{"style":1569},[8533],{"type":45,"value":8534},"            handler",{"type":39,"tag":573,"props":8536,"children":8537},{"style":968},[8538],{"type":45,"value":1896},{"type":39,"tag":573,"props":8540,"children":8541},{"style":783},[8542],{"type":45,"value":8543},"\"lambda-handler.handler\"",{"type":39,"tag":573,"props":8545,"children":8546},{"style":580},[8547],{"type":45,"value":609},{"type":39,"tag":573,"props":8549,"children":8550},{"class":575,"line":3347},[8551,8556,8560,8564,8568],{"type":39,"tag":573,"props":8552,"children":8553},{"style":1569},[8554],{"type":45,"value":8555},"            layers",{"type":39,"tag":573,"props":8557,"children":8558},{"style":968},[8559],{"type":45,"value":1896},{"type":39,"tag":573,"props":8561,"children":8562},{"style":580},[8563],{"type":45,"value":6722},{"type":39,"tag":573,"props":8565,"children":8566},{"style":1553},[8567],{"type":45,"value":4995},{"type":39,"tag":573,"props":8569,"children":8570},{"style":580},[8571],{"type":45,"value":8572},".flask_lambda_layer],\n",{"type":39,"tag":573,"props":8574,"children":8575},{"class":575,"line":3369},[8576,8581,8585,8590,8595],{"type":39,"tag":573,"props":8577,"children":8578},{"style":1569},[8579],{"type":45,"value":8580},"            timeout",{"type":39,"tag":573,"props":8582,"children":8583},{"style":968},[8584],{"type":45,"value":1896},{"type":39,"tag":573,"props":8586,"children":8587},{"style":580},[8588],{"type":45,"value":8589},"core.Duration.seconds(",{"type":39,"tag":573,"props":8591,"children":8592},{"style":1003},[8593],{"type":45,"value":8594},"60",{"type":39,"tag":573,"props":8596,"children":8597},{"style":580},[8598],{"type":45,"value":5250},{"type":39,"tag":573,"props":8600,"children":8601},{"class":575,"line":3391},[8602,8606,8610,8614,8618,8622],{"type":39,"tag":573,"props":8603,"children":8604},{"style":1569},[8605],{"type":45,"value":5315},{"type":39,"tag":573,"props":8607,"children":8608},{"style":968},[8609],{"type":45,"value":1896},{"type":39,"tag":573,"props":8611,"children":8612},{"style":580},[8613],{"type":45,"value":6200},{"type":39,"tag":573,"props":8615,"children":8616},{"style":968},[8617],{"type":45,"value":5032},{"type":39,"tag":573,"props":8619,"children":8620},{"style":1553},[8621],{"type":45,"value":4995},{"type":39,"tag":573,"props":8623,"children":8624},{"style":580},[8625],{"type":45,"value":8626},".env_vars},\n",{"type":39,"tag":573,"props":8628,"children":8629},{"class":575,"line":3413},[8630],{"type":39,"tag":573,"props":8631,"children":8632},{"style":580},[8633],{"type":45,"value":8405},{"type":39,"tag":573,"props":8635,"children":8636},{"class":575,"line":3426},[8637],{"type":39,"tag":573,"props":8638,"children":8639},{"emptyLinePlaceholder":34},[8640],{"type":45,"value":1722},{"type":39,"tag":573,"props":8642,"children":8643},{"class":575,"line":3435},[8644,8648],{"type":39,"tag":573,"props":8645,"children":8646},{"style":1553},[8647],{"type":45,"value":5099},{"type":39,"tag":573,"props":8649,"children":8650},{"style":580},[8651],{"type":45,"value":8652},".flask_app_lambda.role.add_managed_policy(\n",{"type":39,"tag":573,"props":8654,"children":8655},{"class":575,"line":3457},[8656],{"type":39,"tag":573,"props":8657,"children":8658},{"style":580},[8659],{"type":45,"value":8660},"            iam.ManagedPolicy.from_managed_policy_arn(\n",{"type":39,"tag":573,"props":8662,"children":8663},{"class":575,"line":3475},[8664,8669],{"type":39,"tag":573,"props":8665,"children":8666},{"style":1553},[8667],{"type":45,"value":8668},"                self",{"type":39,"tag":573,"props":8670,"children":8671},{"style":580},[8672],{"type":45,"value":609},{"type":39,"tag":573,"props":8674,"children":8675},{"class":575,"line":3484},[8676,8681],{"type":39,"tag":573,"props":8677,"children":8678},{"style":783},[8679],{"type":45,"value":8680},"                'ECS_FullAccessPolicy'",{"type":39,"tag":573,"props":8682,"children":8683},{"style":580},[8684],{"type":45,"value":609},{"type":39,"tag":573,"props":8686,"children":8687},{"class":575,"line":3492},[8688,8693,8697],{"type":39,"tag":573,"props":8689,"children":8690},{"style":1569},[8691],{"type":45,"value":8692},"                managed_policy_arn",{"type":39,"tag":573,"props":8694,"children":8695},{"style":968},[8696],{"type":45,"value":1896},{"type":39,"tag":573,"props":8698,"children":8699},{"style":783},[8700],{"type":45,"value":8701},"'arn:aws:iam::aws:policy/AmazonECS_FullAccess'\n",{"type":39,"tag":573,"props":8703,"children":8704},{"class":575,"line":3513},[8705],{"type":39,"tag":573,"props":8706,"children":8707},{"style":580},[8708],{"type":45,"value":7645},{"type":39,"tag":573,"props":8710,"children":8711},{"class":575,"line":3530},[8712],{"type":39,"tag":573,"props":8713,"children":8714},{"style":580},[8715],{"type":45,"value":8405},{"type":39,"tag":573,"props":8717,"children":8718},{"class":575,"line":3538},[8719],{"type":39,"tag":573,"props":8720,"children":8721},{"emptyLinePlaceholder":34},[8722],{"type":45,"value":1722},{"type":39,"tag":573,"props":8724,"children":8725},{"class":575,"line":3546},[8726],{"type":39,"tag":573,"props":8727,"children":8728},{"style":1495},[8729],{"type":45,"value":8730},"        # https://slmkitani.medium.com/passing-custom-headers-through-amazon-api-gateway-to-an-aws-lambda-function-f3a1cfdc0e29\n",{"type":39,"tag":573,"props":8732,"children":8733},{"class":575,"line":3567},[8734,8738,8743,8747],{"type":39,"tag":573,"props":8735,"children":8736},{"style":1553},[8737],{"type":45,"value":5099},{"type":39,"tag":573,"props":8739,"children":8740},{"style":580},[8741],{"type":45,"value":8742},".request_templates ",{"type":39,"tag":573,"props":8744,"children":8745},{"style":968},[8746],{"type":45,"value":1896},{"type":39,"tag":573,"props":8748,"children":8749},{"style":580},[8750],{"type":45,"value":1811},{"type":39,"tag":573,"props":8752,"children":8753},{"class":575,"line":3584},[8754,8759,8763],{"type":39,"tag":573,"props":8755,"children":8756},{"style":783},[8757],{"type":45,"value":8758},"            \"application/json\"",{"type":39,"tag":573,"props":8760,"children":8761},{"style":580},[8762],{"type":45,"value":598},{"type":39,"tag":573,"props":8764,"children":8765},{"style":783},[8766],{"type":45,"value":8767},"'''{\n",{"type":39,"tag":573,"props":8769,"children":8770},{"class":575,"line":3593},[8771],{"type":39,"tag":573,"props":8772,"children":8773},{"style":783},[8774],{"type":45,"value":8775},"                \"method\": \"$context.httpMethod\",\n",{"type":39,"tag":573,"props":8777,"children":8778},{"class":575,"line":3602},[8779],{"type":39,"tag":573,"props":8780,"children":8781},{"style":783},[8782],{"type":45,"value":8783},"                \"body\" : $input.json(\"$\"),\n",{"type":39,"tag":573,"props":8785,"children":8786},{"class":575,"line":3611},[8787],{"type":39,"tag":573,"props":8788,"children":8789},{"style":783},[8790],{"type":45,"value":8791},"                \"headers\": {\n",{"type":39,"tag":573,"props":8793,"children":8794},{"class":575,"line":3620},[8795],{"type":39,"tag":573,"props":8796,"children":8797},{"style":783},[8798],{"type":45,"value":8799},"                    #foreach($param in $input.params().header.keySet())\n",{"type":39,"tag":573,"props":8801,"children":8802},{"class":575,"line":3628},[8803],{"type":39,"tag":573,"props":8804,"children":8805},{"style":783},[8806],{"type":45,"value":8807},"                    \"$param\": \"$util.escapeJavaScript($input.params().header.get($param))\"\n",{"type":39,"tag":573,"props":8809,"children":8810},{"class":575,"line":3636},[8811],{"type":39,"tag":573,"props":8812,"children":8813},{"style":783},[8814],{"type":45,"value":8815},"                    #if($foreach.hasNext),#end\n",{"type":39,"tag":573,"props":8817,"children":8818},{"class":575,"line":3653},[8819],{"type":39,"tag":573,"props":8820,"children":8821},{"style":783},[8822],{"type":45,"value":8823},"                    #end\n",{"type":39,"tag":573,"props":8825,"children":8826},{"class":575,"line":3686},[8827],{"type":39,"tag":573,"props":8828,"children":8829},{"style":783},[8830],{"type":45,"value":3590},{"type":39,"tag":573,"props":8832,"children":8833},{"class":575,"line":3694},[8834],{"type":39,"tag":573,"props":8835,"children":8836},{"style":783},[8837],{"type":45,"value":8000},{"type":39,"tag":573,"props":8839,"children":8840},{"class":575,"line":3702},[8841],{"type":39,"tag":573,"props":8842,"children":8843},{"style":783},[8844],{"type":45,"value":8845},"            '''\n",{"type":39,"tag":573,"props":8847,"children":8848},{"class":575,"line":3732},[8849],{"type":39,"tag":573,"props":8850,"children":8851},{"style":580},[8852],{"type":45,"value":1797},{"type":39,"tag":573,"props":8854,"children":8855},{"class":575,"line":3777},[8856],{"type":39,"tag":573,"props":8857,"children":8858},{"emptyLinePlaceholder":34},[8859],{"type":45,"value":1722},{"type":39,"tag":573,"props":8861,"children":8862},{"class":575,"line":7146},[8863,8867,8872,8876],{"type":39,"tag":573,"props":8864,"children":8865},{"style":1553},[8866],{"type":45,"value":5099},{"type":39,"tag":573,"props":8868,"children":8869},{"style":580},[8870],{"type":45,"value":8871},".apigateway ",{"type":39,"tag":573,"props":8873,"children":8874},{"style":968},[8875],{"type":45,"value":1896},{"type":39,"tag":573,"props":8877,"children":8878},{"style":580},[8879],{"type":45,"value":8880}," apigw.RestApi(\n",{"type":39,"tag":573,"props":8882,"children":8883},{"class":575,"line":7172},[8884,8888],{"type":39,"tag":573,"props":8885,"children":8886},{"style":1553},[8887],{"type":45,"value":5121},{"type":39,"tag":573,"props":8889,"children":8890},{"style":580},[8891],{"type":45,"value":609},{"type":39,"tag":573,"props":8893,"children":8894},{"class":575,"line":7181},[8895,8900],{"type":39,"tag":573,"props":8896,"children":8897},{"style":783},[8898],{"type":45,"value":8899},"            'FlaskAppEndpoint'",{"type":39,"tag":573,"props":8901,"children":8902},{"style":580},[8903],{"type":45,"value":609},{"type":39,"tag":573,"props":8905,"children":8906},{"class":575,"line":7190},[8907],{"type":39,"tag":573,"props":8908,"children":8909},{"style":580},[8910],{"type":45,"value":8405},{"type":39,"tag":573,"props":8912,"children":8913},{"class":575,"line":7234},[8914],{"type":39,"tag":573,"props":8915,"children":8916},{"emptyLinePlaceholder":34},[8917],{"type":45,"value":1722},{"type":39,"tag":573,"props":8919,"children":8920},{"class":575,"line":7276},[8921,8925,8930,8935],{"type":39,"tag":573,"props":8922,"children":8923},{"style":1553},[8924],{"type":45,"value":5099},{"type":39,"tag":573,"props":8926,"children":8927},{"style":580},[8928],{"type":45,"value":8929},".apigateway.root.add_method(",{"type":39,"tag":573,"props":8931,"children":8932},{"style":783},[8933],{"type":45,"value":8934},"\"ANY\"",{"type":39,"tag":573,"props":8936,"children":8937},{"style":580},[8938],{"type":45,"value":3129},{"type":39,"tag":573,"props":8940,"children":8941},{"class":575,"line":7318},[8942],{"type":39,"tag":573,"props":8943,"children":8944},{"emptyLinePlaceholder":34},[8945],{"type":45,"value":1722},{"type":39,"tag":573,"props":8947,"children":8948},{"class":575,"line":7326},[8949,8953,8958,8962,8967,8972,8977],{"type":39,"tag":573,"props":8950,"children":8951},{"style":1553},[8952],{"type":45,"value":5099},{"type":39,"tag":573,"props":8954,"children":8955},{"style":580},[8956],{"type":45,"value":8957},".discord_interaction_webhook ",{"type":39,"tag":573,"props":8959,"children":8960},{"style":968},[8961],{"type":45,"value":1896},{"type":39,"tag":573,"props":8963,"children":8964},{"style":1553},[8965],{"type":45,"value":8966}," self",{"type":39,"tag":573,"props":8968,"children":8969},{"style":580},[8970],{"type":45,"value":8971},".apigateway.root.add_resource(",{"type":39,"tag":573,"props":8973,"children":8974},{"style":783},[8975],{"type":45,"value":8976},"\"discord\"",{"type":39,"tag":573,"props":8978,"children":8979},{"style":580},[8980],{"type":45,"value":3129},{"type":39,"tag":573,"props":8982,"children":8983},{"class":575,"line":7402},[8984],{"type":39,"tag":573,"props":8985,"children":8986},{"emptyLinePlaceholder":34},[8987],{"type":45,"value":1722},{"type":39,"tag":573,"props":8989,"children":8990},{"class":575,"line":7410},[8991,8995,9000,9004],{"type":39,"tag":573,"props":8992,"children":8993},{"style":1553},[8994],{"type":45,"value":5099},{"type":39,"tag":573,"props":8996,"children":8997},{"style":580},[8998],{"type":45,"value":8999},".discord_interaction_webhook_integration ",{"type":39,"tag":573,"props":9001,"children":9002},{"style":968},[9003],{"type":45,"value":1896},{"type":39,"tag":573,"props":9005,"children":9006},{"style":580},[9007],{"type":45,"value":9008}," apigw.LambdaIntegration(\n",{"type":39,"tag":573,"props":9010,"children":9011},{"class":575,"line":7433},[9012,9016],{"type":39,"tag":573,"props":9013,"children":9014},{"style":1553},[9015],{"type":45,"value":5121},{"type":39,"tag":573,"props":9017,"children":9018},{"style":580},[9019],{"type":45,"value":9020},".flask_app_lambda,\n",{"type":39,"tag":573,"props":9022,"children":9023},{"class":575,"line":7450},[9024,9029,9033,9037],{"type":39,"tag":573,"props":9025,"children":9026},{"style":1569},[9027],{"type":45,"value":9028},"            request_templates",{"type":39,"tag":573,"props":9030,"children":9031},{"style":968},[9032],{"type":45,"value":1896},{"type":39,"tag":573,"props":9034,"children":9035},{"style":1553},[9036],{"type":45,"value":4995},{"type":39,"tag":573,"props":9038,"children":9039},{"style":580},[9040],{"type":45,"value":9041},".request_templates\n",{"type":39,"tag":573,"props":9043,"children":9044},{"class":575,"line":7468},[9045],{"type":39,"tag":573,"props":9046,"children":9047},{"style":580},[9048],{"type":45,"value":8405},{"type":39,"tag":573,"props":9050,"children":9051},{"class":575,"line":7477},[9052],{"type":39,"tag":573,"props":9053,"children":9054},{"emptyLinePlaceholder":34},[9055],{"type":45,"value":1722},{"type":39,"tag":573,"props":9057,"children":9058},{"class":575,"line":7485},[9059,9063],{"type":39,"tag":573,"props":9060,"children":9061},{"style":1553},[9062],{"type":45,"value":5099},{"type":39,"tag":573,"props":9064,"children":9065},{"style":580},[9066],{"type":45,"value":9067},".discord_interaction_webhook.add_method(\n",{"type":39,"tag":573,"props":9069,"children":9070},{"class":575,"line":7511},[9071,9076],{"type":39,"tag":573,"props":9072,"children":9073},{"style":783},[9074],{"type":45,"value":9075},"            'POST'",{"type":39,"tag":573,"props":9077,"children":9078},{"style":580},[9079],{"type":45,"value":609},{"type":39,"tag":573,"props":9081,"children":9082},{"class":575,"line":7529},[9083,9087],{"type":39,"tag":573,"props":9084,"children":9085},{"style":1553},[9086],{"type":45,"value":5121},{"type":39,"tag":573,"props":9088,"children":9089},{"style":580},[9090],{"type":45,"value":9091},".discord_interaction_webhook_integration\n",{"type":39,"tag":573,"props":9093,"children":9094},{"class":575,"line":7537},[9095],{"type":39,"tag":573,"props":9096,"children":9097},{"style":580},[9098],{"type":45,"value":8405},{"type":39,"tag":48,"props":9100,"children":9101},{},[9102,9104,9109],{"type":45,"value":9103},"First we add some environment variables that will be made available to the Lambda function's execution environment. The ECS cluster and service name as well as our Discord application's ",{"type":39,"tag":339,"props":9105,"children":9107},{"className":9106},[],[9108],{"type":45,"value":6583},{"type":45,"value":9110}," are needed in the Lambda function for everything to work.",{"type":39,"tag":48,"props":9112,"children":9113},{},[9114],{"type":45,"value":9115},"We have to give the lambda function permissions to make changes to ECS since it will be interacting with ECS via boto3.",{"type":39,"tag":48,"props":9117,"children":9118},{},[9119,9125,9127,9132],{"type":39,"tag":339,"props":9120,"children":9122},{"className":9121},[],[9123],{"type":45,"value":9124},"self.request_templates",{"type":45,"value":9126}," is needed in order to pass the special security headers from the Discord ",{"type":39,"tag":339,"props":9128,"children":9130},{"className":9129},[],[9131],{"type":45,"value":2674},{"type":45,"value":9133}," request that are needed for security. I couldn't find a lot of resources on how to make this work, but I learned that this uses Apache Velocity Template Language.",{"type":39,"tag":931,"props":9135,"children":9137},{"id":9136},"add-a-gitlab-ci-job-for-installing-dependencies-into-lambda-layer",[9138],{"type":45,"value":9139},"Add a GitLab CI job for installing dependencies into Lambda Layer",{"type":39,"tag":48,"props":9141,"children":9142},{},[9143],{"type":45,"value":9144},"There's one more step before we can push our code. We need to add another GitLab CI job that will install the Lambda dependencies so that they can be sent to the Lambda layer that we defined in our Lambda function. A Lambda Layer is where you install dependencies for this type of Lambda setup. Let's add the following stage:",{"type":39,"tag":563,"props":9146,"children":9150},{"code":9147,"language":9148,"meta":8,"className":9149,"style":8},"stages:\n  - build\n  - deploy\n\nimage: python:3.8\n\npip_install:\n  stage: build\n  rules:\n    - if: \"$CI_COMMIT_TAG\"\n      when: always\n  artifacts:\n    paths:\n      - layers/flask/python\n  script:\n    - pip install -r lambda/functions/interactions/requirements.txt -t layers/flask/python\n","yml","language-yml shiki shiki-themes github-light github-dark monokai",[9151],{"type":39,"tag":339,"props":9152,"children":9153},{"__ignoreMap":8},[9154,9165,9177,9188,9195,9210,9217,9229,9244,9255,9274,9289,9301,9313,9326,9337],{"type":39,"tag":573,"props":9155,"children":9156},{"class":575,"line":576},[9157,9161],{"type":39,"tag":573,"props":9158,"children":9159},{"style":5518},[9160],{"type":45,"value":5521},{"type":39,"tag":573,"props":9162,"children":9163},{"style":580},[9164],{"type":45,"value":3729},{"type":39,"tag":573,"props":9166,"children":9167},{"class":575,"line":586},[9168,9172],{"type":39,"tag":573,"props":9169,"children":9170},{"style":580},[9171],{"type":45,"value":5533},{"type":39,"tag":573,"props":9173,"children":9174},{"style":783},[9175],{"type":45,"value":9176},"build\n",{"type":39,"tag":573,"props":9178,"children":9179},{"class":575,"line":612},[9180,9184],{"type":39,"tag":573,"props":9181,"children":9182},{"style":580},[9183],{"type":45,"value":5533},{"type":39,"tag":573,"props":9185,"children":9186},{"style":783},[9187],{"type":45,"value":5538},{"type":39,"tag":573,"props":9189,"children":9190},{"class":575,"line":634},[9191],{"type":39,"tag":573,"props":9192,"children":9193},{"emptyLinePlaceholder":34},[9194],{"type":45,"value":1722},{"type":39,"tag":573,"props":9196,"children":9197},{"class":575,"line":656},[9198,9202,9206],{"type":39,"tag":573,"props":9199,"children":9200},{"style":5518},[9201],{"type":45,"value":5553},{"type":39,"tag":573,"props":9203,"children":9204},{"style":580},[9205],{"type":45,"value":598},{"type":39,"tag":573,"props":9207,"children":9208},{"style":783},[9209],{"type":45,"value":5562},{"type":39,"tag":573,"props":9211,"children":9212},{"class":575,"line":678},[9213],{"type":39,"tag":573,"props":9214,"children":9215},{"emptyLinePlaceholder":34},[9216],{"type":45,"value":1722},{"type":39,"tag":573,"props":9218,"children":9219},{"class":575,"line":696},[9220,9225],{"type":39,"tag":573,"props":9221,"children":9222},{"style":5518},[9223],{"type":45,"value":9224},"pip_install",{"type":39,"tag":573,"props":9226,"children":9227},{"style":580},[9228],{"type":45,"value":3729},{"type":39,"tag":573,"props":9230,"children":9231},{"class":575,"line":1800},[9232,9236,9240],{"type":39,"tag":573,"props":9233,"children":9234},{"style":5518},[9235],{"type":45,"value":5589},{"type":39,"tag":573,"props":9237,"children":9238},{"style":580},[9239],{"type":45,"value":598},{"type":39,"tag":573,"props":9241,"children":9242},{"style":783},[9243],{"type":45,"value":9176},{"type":39,"tag":573,"props":9245,"children":9246},{"class":575,"line":1814},[9247,9251],{"type":39,"tag":573,"props":9248,"children":9249},{"style":5518},[9250],{"type":45,"value":5605},{"type":39,"tag":573,"props":9252,"children":9253},{"style":580},[9254],{"type":45,"value":3729},{"type":39,"tag":573,"props":9256,"children":9257},{"class":575,"line":1847},[9258,9262,9266,9270],{"type":39,"tag":573,"props":9259,"children":9260},{"style":580},[9261],{"type":45,"value":5617},{"type":39,"tag":573,"props":9263,"children":9264},{"style":5518},[9265],{"type":45,"value":3708},{"type":39,"tag":573,"props":9267,"children":9268},{"style":580},[9269],{"type":45,"value":598},{"type":39,"tag":573,"props":9271,"children":9272},{"style":783},[9273],{"type":45,"value":5630},{"type":39,"tag":573,"props":9275,"children":9276},{"class":575,"line":1855},[9277,9281,9285],{"type":39,"tag":573,"props":9278,"children":9279},{"style":5518},[9280],{"type":45,"value":5638},{"type":39,"tag":573,"props":9282,"children":9283},{"style":580},[9284],{"type":45,"value":598},{"type":39,"tag":573,"props":9286,"children":9287},{"style":783},[9288],{"type":45,"value":5647},{"type":39,"tag":573,"props":9290,"children":9291},{"class":575,"line":3182},[9292,9297],{"type":39,"tag":573,"props":9293,"children":9294},{"style":5518},[9295],{"type":45,"value":9296},"  artifacts",{"type":39,"tag":573,"props":9298,"children":9299},{"style":580},[9300],{"type":45,"value":3729},{"type":39,"tag":573,"props":9302,"children":9303},{"class":575,"line":3190},[9304,9309],{"type":39,"tag":573,"props":9305,"children":9306},{"style":5518},[9307],{"type":45,"value":9308},"    paths",{"type":39,"tag":573,"props":9310,"children":9311},{"style":580},[9312],{"type":45,"value":3729},{"type":39,"tag":573,"props":9314,"children":9315},{"class":575,"line":3233},[9316,9321],{"type":39,"tag":573,"props":9317,"children":9318},{"style":580},[9319],{"type":45,"value":9320},"      - ",{"type":39,"tag":573,"props":9322,"children":9323},{"style":783},[9324],{"type":45,"value":9325},"layers/flask/python\n",{"type":39,"tag":573,"props":9327,"children":9328},{"class":575,"line":3241},[9329,9333],{"type":39,"tag":573,"props":9330,"children":9331},{"style":5518},[9332],{"type":45,"value":5702},{"type":39,"tag":573,"props":9334,"children":9335},{"style":580},[9336],{"type":45,"value":3729},{"type":39,"tag":573,"props":9338,"children":9339},{"class":575,"line":3258},[9340,9344],{"type":39,"tag":573,"props":9341,"children":9342},{"style":580},[9343],{"type":45,"value":5617},{"type":39,"tag":573,"props":9345,"children":9346},{"style":783},[9347],{"type":45,"value":9348},"pip install -r lambda/functions/interactions/requirements.txt -t layers/flask/python\n",{"type":39,"tag":48,"props":9350,"children":9351},{},[9352,9354,9360,9362,9367,9369,9375,9376,9382,9384,9390,9391,9396],{"type":45,"value":9353},"Now we are installing dependencies into a target location (with the ",{"type":39,"tag":339,"props":9355,"children":9357},{"className":9356},[],[9358],{"type":45,"value":9359},"-t",{"type":45,"value":9361}," flag) that our Lambda Layer will be able to use in the ",{"type":39,"tag":339,"props":9363,"children":9365},{"className":9364},[],[9366],{"type":45,"value":5577},{"type":45,"value":9368}," GitLab CI job. This is because we have indicated the path to ",{"type":39,"tag":339,"props":9370,"children":9372},{"className":9371},[],[9373],{"type":45,"value":9374},"layers/flask/python",{"type":45,"value":4698},{"type":39,"tag":339,"props":9377,"children":9379},{"className":9378},[],[9380],{"type":45,"value":9381},"paths",{"type":45,"value":9383}," array of ",{"type":39,"tag":339,"props":9385,"children":9387},{"className":9386},[],[9388],{"type":45,"value":9389},"artifacts",{"type":45,"value":4698},{"type":39,"tag":339,"props":9392,"children":9394},{"className":9393},[],[9395],{"type":45,"value":9224},{"type":45,"value":9397}," job. There are other ways to add the pip dependencies to the Lambda Layers. We don't absolutely need this to be done in a separate CI job.",{"type":39,"tag":48,"props":9399,"children":9400},{},[9401],{"type":45,"value":9402},"Now tag and push the code to GitLab and check to see that the pipeline runs successfully.",{"type":39,"tag":931,"props":9404,"children":9406},{"id":9405},"add-the-api-gateway-url-to-discord-application-settings",[9407],{"type":45,"value":9408},"Add the API Gateway URL to Discord Application settings",{"type":39,"tag":48,"props":9410,"children":9411},{},[9412],{"type":45,"value":9413},"If everything runs smoothly, we should see a URL in the very last lines of the pipeline. This is the URL for our API Gateway endpoint:",{"type":39,"tag":563,"props":9415,"children":9417},{"code":9416},"https://abc123xyz.execute-api.us-east-1.amazonaws.com/prod/\n",[9418],{"type":39,"tag":339,"props":9419,"children":9420},{"__ignoreMap":8},[9421],{"type":45,"value":9416},{"type":39,"tag":48,"props":9423,"children":9424},{},[9425,9427,9432,9434,9439,9440,9445],{"type":45,"value":9426},"We need to add ",{"type":39,"tag":339,"props":9428,"children":9430},{"className":9429},[],[9431],{"type":45,"value":2521},{"type":45,"value":9433}," to the end of this URL and then add that to our the ",{"type":39,"tag":339,"props":9435,"children":9437},{"className":9436},[],[9438],{"type":45,"value":3879},{"type":45,"value":4698},{"type":39,"tag":339,"props":9441,"children":9443},{"className":9442},[],[9444],{"type":45,"value":2832},{"type":45,"value":9446}," section of our Discord application's admin page:",{"type":39,"tag":563,"props":9448,"children":9450},{"code":9449},"https://abc123xyz.execute-api.us-east-1.amazonaws.com/prod/discord\n",[9451],{"type":39,"tag":339,"props":9452,"children":9453},{"__ignoreMap":8},[9454],{"type":45,"value":9449},{"type":39,"tag":48,"props":9456,"children":9457},{},[9458,9460,9467],{"type":45,"value":9459},"When we add this URL in the application settings, Discord will make sure that our endpoint is properly verifying the request based on its headers. Check out ",{"type":39,"tag":85,"props":9461,"children":9464},{"href":9462,"rel":9463},"https://github.com/discord/discord-interactions-python/blob/main/discord_interactions/__init__.py#L31",[178],[9465],{"type":45,"value":9466},"this function",{"type":45,"value":9468}," to see how it works:",{"type":39,"tag":563,"props":9470,"children":9472},{"code":9471,"language":3027,"meta":8,"className":3028,"style":8},"def verify_key_decorator(client_public_key):\n    from flask import request, jsonify\n\n    # https://stackoverflow.com/questions/51691730/flask-middleware-for-specific-route\n    def _decorator(f):\n        @wraps(f)\n        def __decorator(*args, **kwargs):\n            # Verify request\n            signature = request.headers.get('X-Signature-Ed25519')\n            timestamp = request.headers.get('X-Signature-Timestamp')\n            if signature is None or timestamp is None or not verify_key(request.data, signature, timestamp, client_public_key):\n                return 'Bad request signature', 401\n\n            # Automatically respond to pings\n            if request.json and request.json.get('type') == InteractionType.PING:\n                return jsonify({\n                    'type': InteractionResponseType.PONG\n                })\n\n            # Pass through\n            return f(*args, **kwargs)\n        return __decorator\n    return _decorator\n",[9473],{"type":39,"tag":339,"props":9474,"children":9475},{"__ignoreMap":8},[9476,9501,9522,9529,9537,9561,9574,9616,9624,9650,9675,9730,9752,9759,9767,9817,9828,9846,9854,9861,9869,9899,9911],{"type":39,"tag":573,"props":9477,"children":9478},{"class":575,"line":576},[9479,9483,9488,9492,9497],{"type":39,"tag":573,"props":9480,"children":9481},{"style":1580},[9482],{"type":45,"value":6760},{"type":39,"tag":573,"props":9484,"children":9485},{"style":772},[9486],{"type":45,"value":9487}," verify_key_decorator",{"type":39,"tag":573,"props":9489,"children":9490},{"style":580},[9491],{"type":45,"value":1533},{"type":39,"tag":573,"props":9493,"children":9494},{"style":4992},[9495],{"type":45,"value":9496},"client_public_key",{"type":39,"tag":573,"props":9498,"children":9499},{"style":580},[9500],{"type":45,"value":4965},{"type":39,"tag":573,"props":9502,"children":9503},{"class":575,"line":586},[9504,9509,9513,9517],{"type":39,"tag":573,"props":9505,"children":9506},{"style":968},[9507],{"type":45,"value":9508},"    from",{"type":39,"tag":573,"props":9510,"children":9511},{"style":580},[9512],{"type":45,"value":6481},{"type":39,"tag":573,"props":9514,"children":9515},{"style":968},[9516],{"type":45,"value":3070},{"type":39,"tag":573,"props":9518,"children":9519},{"style":580},[9520],{"type":45,"value":9521}," request, jsonify\n",{"type":39,"tag":573,"props":9523,"children":9524},{"class":575,"line":612},[9525],{"type":39,"tag":573,"props":9526,"children":9527},{"emptyLinePlaceholder":34},[9528],{"type":45,"value":1722},{"type":39,"tag":573,"props":9530,"children":9531},{"class":575,"line":634},[9532],{"type":39,"tag":573,"props":9533,"children":9534},{"style":1495},[9535],{"type":45,"value":9536},"    # https://stackoverflow.com/questions/51691730/flask-middleware-for-specific-route\n",{"type":39,"tag":573,"props":9538,"children":9539},{"class":575,"line":656},[9540,9544,9549,9553,9557],{"type":39,"tag":573,"props":9541,"children":9542},{"style":1580},[9543],{"type":45,"value":4980},{"type":39,"tag":573,"props":9545,"children":9546},{"style":772},[9547],{"type":45,"value":9548}," _decorator",{"type":39,"tag":573,"props":9550,"children":9551},{"style":580},[9552],{"type":45,"value":1533},{"type":39,"tag":573,"props":9554,"children":9555},{"style":4992},[9556],{"type":45,"value":3668},{"type":39,"tag":573,"props":9558,"children":9559},{"style":580},[9560],{"type":45,"value":4965},{"type":39,"tag":573,"props":9562,"children":9563},{"class":575,"line":678},[9564,9569],{"type":39,"tag":573,"props":9565,"children":9566},{"style":772},[9567],{"type":45,"value":9568},"        @wraps",{"type":39,"tag":573,"props":9570,"children":9571},{"style":580},[9572],{"type":45,"value":9573},"(f)\n",{"type":39,"tag":573,"props":9575,"children":9576},{"class":575,"line":696},[9577,9582,9587,9591,9595,9600,9604,9608,9612],{"type":39,"tag":573,"props":9578,"children":9579},{"style":1580},[9580],{"type":45,"value":9581},"        def",{"type":39,"tag":573,"props":9583,"children":9584},{"style":772},[9585],{"type":45,"value":9586}," __decorator",{"type":39,"tag":573,"props":9588,"children":9589},{"style":580},[9590],{"type":45,"value":1533},{"type":39,"tag":573,"props":9592,"children":9593},{"style":968},[9594],{"type":45,"value":1588},{"type":39,"tag":573,"props":9596,"children":9597},{"style":4992},[9598],{"type":45,"value":9599},"args",{"type":39,"tag":573,"props":9601,"children":9602},{"style":580},[9603],{"type":45,"value":1577},{"type":39,"tag":573,"props":9605,"children":9606},{"style":968},[9607],{"type":45,"value":5032},{"type":39,"tag":573,"props":9609,"children":9610},{"style":4992},[9611],{"type":45,"value":5037},{"type":39,"tag":573,"props":9613,"children":9614},{"style":580},[9615],{"type":45,"value":4965},{"type":39,"tag":573,"props":9617,"children":9618},{"class":575,"line":1800},[9619],{"type":39,"tag":573,"props":9620,"children":9621},{"style":1495},[9622],{"type":45,"value":9623},"            # Verify request\n",{"type":39,"tag":573,"props":9625,"children":9626},{"class":575,"line":1814},[9627,9632,9636,9641,9646],{"type":39,"tag":573,"props":9628,"children":9629},{"style":580},[9630],{"type":45,"value":9631},"            signature ",{"type":39,"tag":573,"props":9633,"children":9634},{"style":968},[9635],{"type":45,"value":1896},{"type":39,"tag":573,"props":9637,"children":9638},{"style":580},[9639],{"type":45,"value":9640}," request.headers.get(",{"type":39,"tag":573,"props":9642,"children":9643},{"style":783},[9644],{"type":45,"value":9645},"'X-Signature-Ed25519'",{"type":39,"tag":573,"props":9647,"children":9648},{"style":580},[9649],{"type":45,"value":3129},{"type":39,"tag":573,"props":9651,"children":9652},{"class":575,"line":1847},[9653,9658,9662,9666,9671],{"type":39,"tag":573,"props":9654,"children":9655},{"style":580},[9656],{"type":45,"value":9657},"            timestamp ",{"type":39,"tag":573,"props":9659,"children":9660},{"style":968},[9661],{"type":45,"value":1896},{"type":39,"tag":573,"props":9663,"children":9664},{"style":580},[9665],{"type":45,"value":9640},{"type":39,"tag":573,"props":9667,"children":9668},{"style":783},[9669],{"type":45,"value":9670},"'X-Signature-Timestamp'",{"type":39,"tag":573,"props":9672,"children":9673},{"style":580},[9674],{"type":45,"value":3129},{"type":39,"tag":573,"props":9676,"children":9677},{"class":575,"line":1855},[9678,9683,9688,9693,9698,9703,9708,9712,9716,9720,9725],{"type":39,"tag":573,"props":9679,"children":9680},{"style":968},[9681],{"type":45,"value":9682},"            if",{"type":39,"tag":573,"props":9684,"children":9685},{"style":580},[9686],{"type":45,"value":9687}," signature ",{"type":39,"tag":573,"props":9689,"children":9690},{"style":968},[9691],{"type":45,"value":9692},"is",{"type":39,"tag":573,"props":9694,"children":9695},{"style":1003},[9696],{"type":45,"value":9697}," None",{"type":39,"tag":573,"props":9699,"children":9700},{"style":968},[9701],{"type":45,"value":9702}," or",{"type":39,"tag":573,"props":9704,"children":9705},{"style":580},[9706],{"type":45,"value":9707}," timestamp ",{"type":39,"tag":573,"props":9709,"children":9710},{"style":968},[9711],{"type":45,"value":9692},{"type":39,"tag":573,"props":9713,"children":9714},{"style":1003},[9715],{"type":45,"value":9697},{"type":39,"tag":573,"props":9717,"children":9718},{"style":968},[9719],{"type":45,"value":9702},{"type":39,"tag":573,"props":9721,"children":9722},{"style":968},[9723],{"type":45,"value":9724}," not",{"type":39,"tag":573,"props":9726,"children":9727},{"style":580},[9728],{"type":45,"value":9729}," verify_key(request.data, signature, timestamp, client_public_key):\n",{"type":39,"tag":573,"props":9731,"children":9732},{"class":575,"line":3182},[9733,9738,9743,9747],{"type":39,"tag":573,"props":9734,"children":9735},{"style":968},[9736],{"type":45,"value":9737},"                return",{"type":39,"tag":573,"props":9739,"children":9740},{"style":783},[9741],{"type":45,"value":9742}," 'Bad request signature'",{"type":39,"tag":573,"props":9744,"children":9745},{"style":580},[9746],{"type":45,"value":1577},{"type":39,"tag":573,"props":9748,"children":9749},{"style":1003},[9750],{"type":45,"value":9751},"401\n",{"type":39,"tag":573,"props":9753,"children":9754},{"class":575,"line":3190},[9755],{"type":39,"tag":573,"props":9756,"children":9757},{"emptyLinePlaceholder":34},[9758],{"type":45,"value":1722},{"type":39,"tag":573,"props":9760,"children":9761},{"class":575,"line":3233},[9762],{"type":39,"tag":573,"props":9763,"children":9764},{"style":1495},[9765],{"type":45,"value":9766},"            # Automatically respond to pings\n",{"type":39,"tag":573,"props":9768,"children":9769},{"class":575,"line":3241},[9770,9774,9779,9784,9789,9794,9799,9803,9808,9813],{"type":39,"tag":573,"props":9771,"children":9772},{"style":968},[9773],{"type":45,"value":9682},{"type":39,"tag":573,"props":9775,"children":9776},{"style":580},[9777],{"type":45,"value":9778}," request.json ",{"type":39,"tag":573,"props":9780,"children":9781},{"style":968},[9782],{"type":45,"value":9783},"and",{"type":39,"tag":573,"props":9785,"children":9786},{"style":580},[9787],{"type":45,"value":9788}," request.json.get(",{"type":39,"tag":573,"props":9790,"children":9791},{"style":783},[9792],{"type":45,"value":9793},"'type'",{"type":39,"tag":573,"props":9795,"children":9796},{"style":580},[9797],{"type":45,"value":9798},") ",{"type":39,"tag":573,"props":9800,"children":9801},{"style":968},[9802],{"type":45,"value":1705},{"type":39,"tag":573,"props":9804,"children":9805},{"style":580},[9806],{"type":45,"value":9807}," InteractionType.",{"type":39,"tag":573,"props":9809,"children":9810},{"style":1003},[9811],{"type":45,"value":9812},"PING",{"type":39,"tag":573,"props":9814,"children":9815},{"style":580},[9816],{"type":45,"value":3729},{"type":39,"tag":573,"props":9818,"children":9819},{"class":575,"line":3258},[9820,9824],{"type":39,"tag":573,"props":9821,"children":9822},{"style":968},[9823],{"type":45,"value":9737},{"type":39,"tag":573,"props":9825,"children":9826},{"style":580},[9827],{"type":45,"value":7883},{"type":39,"tag":573,"props":9829,"children":9830},{"class":575,"line":3280},[9831,9836,9841],{"type":39,"tag":573,"props":9832,"children":9833},{"style":783},[9834],{"type":45,"value":9835},"                    'type'",{"type":39,"tag":573,"props":9837,"children":9838},{"style":580},[9839],{"type":45,"value":9840},": InteractionResponseType.",{"type":39,"tag":573,"props":9842,"children":9843},{"style":1003},[9844],{"type":45,"value":9845},"PONG\n",{"type":39,"tag":573,"props":9847,"children":9848},{"class":575,"line":3302},[9849],{"type":39,"tag":573,"props":9850,"children":9851},{"style":580},[9852],{"type":45,"value":9853},"                })\n",{"type":39,"tag":573,"props":9855,"children":9856},{"class":575,"line":3316},[9857],{"type":39,"tag":573,"props":9858,"children":9859},{"emptyLinePlaceholder":34},[9860],{"type":45,"value":1722},{"type":39,"tag":573,"props":9862,"children":9863},{"class":575,"line":3325},[9864],{"type":39,"tag":573,"props":9865,"children":9866},{"style":1495},[9867],{"type":45,"value":9868},"            # Pass through\n",{"type":39,"tag":573,"props":9870,"children":9871},{"class":575,"line":3347},[9872,9877,9882,9886,9891,9895],{"type":39,"tag":573,"props":9873,"children":9874},{"style":968},[9875],{"type":45,"value":9876},"            return",{"type":39,"tag":573,"props":9878,"children":9879},{"style":580},[9880],{"type":45,"value":9881}," f(",{"type":39,"tag":573,"props":9883,"children":9884},{"style":968},[9885],{"type":45,"value":1588},{"type":39,"tag":573,"props":9887,"children":9888},{"style":580},[9889],{"type":45,"value":9890},"args, ",{"type":39,"tag":573,"props":9892,"children":9893},{"style":968},[9894],{"type":45,"value":5032},{"type":39,"tag":573,"props":9896,"children":9897},{"style":580},[9898],{"type":45,"value":5083},{"type":39,"tag":573,"props":9900,"children":9901},{"class":575,"line":3369},[9902,9906],{"type":39,"tag":573,"props":9903,"children":9904},{"style":968},[9905],{"type":45,"value":6813},{"type":39,"tag":573,"props":9907,"children":9908},{"style":580},[9909],{"type":45,"value":9910}," __decorator\n",{"type":39,"tag":573,"props":9912,"children":9913},{"class":575,"line":3391},[9914,9918],{"type":39,"tag":573,"props":9915,"children":9916},{"style":968},[9917],{"type":45,"value":8061},{"type":39,"tag":573,"props":9919,"children":9920},{"style":580},[9921],{"type":45,"value":9922}," _decorator\n",{"type":39,"tag":48,"props":9924,"children":9925},{},[9926],{"type":45,"value":9927},"If it fails verification, we will not be able to add the URL and it will not work. You might want to add some additional logging to the Lambda function if you are not able to add the URL successfully.",{"type":39,"tag":48,"props":9929,"children":9930},{},[9931,9933,9940],{"type":45,"value":9932},"This is all covered in ",{"type":39,"tag":85,"props":9934,"children":9937},{"href":9935,"rel":9936},"https://discord.com/developers/docs/interactions/slash-commands",[178],[9938],{"type":45,"value":9939},"the documentation for Discord Interactions",{"type":45,"value":183},{"type":39,"tag":48,"props":9942,"children":9943},{},[9944,9946,9952,9953,9959],{"type":45,"value":9945},"Now you should be able to run the Discord slash commands. You can get the status of your ECS cluster and scale it to either 1 or 0 for ",{"type":39,"tag":339,"props":9947,"children":9949},{"className":9948},[],[9950],{"type":45,"value":9951},"ON",{"type":45,"value":2734},{"type":39,"tag":339,"props":9954,"children":9956},{"className":9955},[],[9957],{"type":45,"value":9958},"OFF",{"type":45,"value":183},{"type":39,"tag":40,"props":9961,"children":9963},{"id":9962},"overview",[9964],{"type":45,"value":9965},"Overview",{"type":39,"tag":48,"props":9967,"children":9968},{},[9969],{"type":45,"value":9970},"Here's an overview of what we covered:",{"type":39,"tag":48,"props":9972,"children":9973},{},[9974],{"type":39,"tag":227,"props":9975,"children":9976},{"alt":2787,"src":2788},[],{"type":39,"tag":9978,"props":9979,"children":9981},"ol",{"start":9980},0,[9982,9987,9992,9997,10002,10007,10020,10025,10037,10042,10058,10063,10068,10073,10078,10090,10102,10114,10133],{"type":39,"tag":316,"props":9983,"children":9984},{},[9985],{"type":45,"value":9986},"This is my computer. For development of this project (and most other projects) I used Windows with WSL2.",{"type":39,"tag":316,"props":9988,"children":9989},{},[9990],{"type":45,"value":9991},"GitLab CI - This is used to run our automated pipelines whenever we push a tag.",{"type":39,"tag":316,"props":9993,"children":9994},{},[9995],{"type":45,"value":9996},"The CDK CLI is used to create, update and delete the infrastructure in our AWS account.",{"type":39,"tag":316,"props":9998,"children":9999},{},[10000],{"type":45,"value":10001},"Valheim - The client for the game server that we set up",{"type":39,"tag":316,"props":10003,"children":10004},{},[10005],{"type":45,"value":10006},"The public IP address of the ECS Task that can be used to connect to our server on port 2456.",{"type":39,"tag":316,"props":10008,"children":10009},{},[10010,10012,10019],{"type":45,"value":10011},"The ECS Cluster that runs the actual docker container for the Valheim server. By default, the image used is ",{"type":39,"tag":85,"props":10013,"children":10016},{"href":10014,"rel":10015},"https://hub.docker.com/r/lloesche/valheim-server",[178],[10017],{"type":45,"value":10018},"lloesche/valheim-server",{"type":45,"value":183},{"type":39,"tag":316,"props":10021,"children":10022},{},[10023],{"type":45,"value":10024},"EFS - This is the file system that is mounted onto the container of the ECS task where our game's world data is stored.",{"type":39,"tag":316,"props":10026,"children":10027},{},[10028,10030,10035],{"type":45,"value":10029},"AWS Backup (Optional) - This is an optional feature of the ",{"type":39,"tag":339,"props":10031,"children":10033},{"className":10032},[],[10034],{"type":45,"value":2562},{"type":45,"value":10036}," construct that can make regular backups of our EFS file system.",{"type":39,"tag":316,"props":10038,"children":10039},{},[10040],{"type":45,"value":10041},"Events (Optional) - AWS Events can be used to scale the number of ECS tasks between 0 and 1.",{"type":39,"tag":316,"props":10043,"children":10044},{},[10045,10047,10056],{"type":45,"value":10046},"This is the ",{"type":39,"tag":85,"props":10048,"children":10050},{"href":2572,"rel":10049},[178],[10051],{"type":39,"tag":339,"props":10052,"children":10054},{"className":10053},[],[10055],{"type":45,"value":2562},{"type":45,"value":10057}," construct that I use in this project.",{"type":39,"tag":316,"props":10059,"children":10060},{},[10061],{"type":45,"value":10062},"S3 bucket for syncing data to and from EFS with DataSync (WIP)",{"type":39,"tag":316,"props":10064,"children":10065},{},[10066],{"type":45,"value":10067},"DataSync for moving game data between EFS and S3.",{"type":39,"tag":316,"props":10069,"children":10070},{},[10071],{"type":45,"value":10072},"The Slash Commands that we set up",{"type":39,"tag":316,"props":10074,"children":10075},{},[10076],{"type":45,"value":10077},"Discord",{"type":39,"tag":316,"props":10079,"children":10080},{},[10081,10083,10088],{"type":45,"value":10082},"Discord Interactions sends and a ",{"type":39,"tag":339,"props":10084,"children":10086},{"className":10085},[],[10087],{"type":45,"value":2674},{"type":45,"value":10089}," request",{"type":39,"tag":316,"props":10091,"children":10092},{},[10093,10095,10100],{"type":45,"value":10094},"The API Gateway endpoint that we configured to handle Discord Interaction ",{"type":39,"tag":339,"props":10096,"children":10098},{"className":10097},[],[10099],{"type":45,"value":2674},{"type":45,"value":10101}," requests.",{"type":39,"tag":316,"props":10103,"children":10104},{},[10105,10107,10112],{"type":45,"value":10106},"The Lambda function running a simple Flask app that responds to the Interaction ",{"type":39,"tag":339,"props":10108,"children":10110},{"className":10109},[],[10111],{"type":45,"value":2674},{"type":45,"value":10113}," request.",{"type":39,"tag":316,"props":10115,"children":10116},{},[10117,10119,10124,10125,10131],{"type":45,"value":10118},"boto3 - This is the AWS SDK Python library included in the Python execution environment that allows us to interact with the resources in our AWS account. In particular, the interactions we use from boto3 are the ",{"type":39,"tag":339,"props":10120,"children":10122},{"className":10121},[],[10123],{"type":45,"value":2682},{"type":45,"value":2734},{"type":39,"tag":339,"props":10126,"children":10128},{"className":10127},[],[10129],{"type":45,"value":10130},"describe_servics",{"type":45,"value":10132}," methods from the ECS module. This allows us to turn our server on and off and also get the status.",{"type":39,"tag":316,"props":10134,"children":10135},{},[10136,10138,10144],{"type":45,"value":10137},"This represents the ",{"type":39,"tag":339,"props":10139,"children":10141},{"className":10140},[],[10142],{"type":45,"value":10143},"valheim-server-stack",{"type":45,"value":10145}," we defined in our CDK application.",{"type":39,"tag":40,"props":10147,"children":10149},{"id":10148},"todo",[10150],{"type":45,"value":10151},"TODO",{"type":39,"tag":48,"props":10153,"children":10154},{},[10155],{"type":45,"value":10156},"There are still some things that I'm working on finalizing.",{"type":39,"tag":312,"props":10158,"children":10159},{},[10160,10165,10170,10175,10180],{"type":39,"tag":316,"props":10161,"children":10162},{},[10163],{"type":45,"value":10164},"DataSync for easily moving data between S3 and EFS",{"type":39,"tag":316,"props":10166,"children":10167},{},[10168],{"type":45,"value":10169},"Report billing data with an additional slash command sub-command",{"type":39,"tag":316,"props":10171,"children":10172},{},[10173],{"type":45,"value":10174},"Add tagging to the resources in our stack to make the billing command easier to implement.",{"type":39,"tag":316,"props":10176,"children":10177},{},[10178],{"type":45,"value":10179},"Get feedback from the Discord, CDK and Valheim communities about what I can improve here",{"type":39,"tag":316,"props":10181,"children":10182},{},[10183,10185],{"type":45,"value":10184},"Contribute to ",{"type":39,"tag":85,"props":10186,"children":10188},{"href":2572,"rel":10187},[178],[10189],{"type":39,"tag":339,"props":10190,"children":10192},{"className":10191},[],[10193],{"type":45,"value":10194},"gotodeploy/cdk-valheim",{"type":39,"tag":48,"props":10196,"children":10197},{},[10198],{"type":45,"value":10199},"Thanks for reading!",{"type":39,"tag":2476,"props":10201,"children":10202},{},[10203],{"type":45,"value":2480},{"title":8,"searchDepth":586,"depth":586,"links":10205},[10206,10208,10209,10213,10214,10219,10220,10224,10225],{"id":2555,"depth":586,"text":10207},"cdk-valheim construct on GitHub",{"id":2632,"depth":586,"text":2635},{"id":2797,"depth":586,"text":2800,"children":10210},[10211,10212],{"id":2901,"depth":612,"text":2904},{"id":3008,"depth":612,"text":3011},{"id":3898,"depth":586,"text":3901},{"id":4505,"depth":586,"text":4508,"children":10215},[10216,10217,10218],{"id":4553,"depth":612,"text":4556},{"id":5487,"depth":612,"text":5490},{"id":5880,"depth":612,"text":5883},{"id":6268,"depth":586,"text":6271},{"id":8167,"depth":586,"text":8170,"children":10221},[10222,10223],{"id":9136,"depth":612,"text":9139},{"id":9405,"depth":612,"text":9408},{"id":9962,"depth":586,"text":9965},{"id":10148,"depth":586,"text":10151},"content:2021:03:18:on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions.md","2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions.md","2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions",1723337537095]