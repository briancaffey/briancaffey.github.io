[{"data":1,"prerenderedAt":7797},["ShallowReactive",2],{"/blog/tags/discord/":3},[4],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"date":11,"image":12,"tags":13,"body":20,"_type":7791,"_id":7792,"_source":7793,"_file":7794,"_stem":7795,"_extension":7796},"/2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions","18",false,"","On-demand, serverless Valheim server setup with AWS CDK, Discord Interactions and GitLab CI","This is a detailed guide showing how to setup a dedicated Valheim server using serverless technologies on AWS","2021-03-18","/static/valheim/hall.png",[14,15,16,17,18,19],"valheim","gaming","python","flask","serverless","discord",{"type":21,"children":22,"toc":7769},"root",[23,43,48,53,58,72,93,107,119,139,145,174,210,290,295,304,309,315,328,364,373,378,406,414,421,442,450,463,482,490,522,528,540,1333,1345,1353,1358,1366,1371,1379,1399,1404,1412,1440,1446,1466,2032,2052,2058,2071,2079,2092,2100,2106,2119,2235,2262,2998,3010,3018,3031,3039,3045,3058,3283,3311,3316,3324,3337,3412,3433,3439,3451,3798,3803,3811,3816,3821,3827,3870,3878,3890,3898,3933,3944,5691,5727,5733,5759,6662,6674,6679,6697,6703,6708,6912,6961,6966,6972,6977,6985,7010,7018,7032,7486,7491,7504,7523,7529,7534,7540,7709,7715,7720,7758,7763],{"type":24,"tag":25,"props":26,"children":27},"element","blockquote",{},[28],{"type":24,"tag":29,"props":30,"children":31},"p",{},[32,35],{"type":33,"value":34},"text","Here's a link to the GitLab repo I'll be referencing in this article: ",{"type":24,"tag":36,"props":37,"children":41},"a",{"href":38,"rel":39},"https://gitlab.com/briancaffey/valheim-cdk-discord-interactions",[40],"nofollow",[42],{"type":33,"value":38},{"type":24,"tag":29,"props":44,"children":45},{},[46],{"type":33,"value":47},"This is an in-depth technical article about running an on-demand, dedicated server for Valheim using Amazon Web Services controlled with Discord Slash Commands, a new part their Interactions API that is currently in beta. Valheim is an open-world online multiplayer survival game loosely based on Norse mythology that has blown up recently.",{"type":24,"tag":29,"props":49,"children":50},{},[51],{"type":33,"value":52},"My main goal with this project was to find an inexpensive way of running a server given how my friends and I play the game, which is typically a few times a week in the evenings. Some combination of 4 of us will start playing, and we drop in and out between walking dogs, cooking, etc. When playing, we all jump on a dedicated voice channel on our group's Discord.",{"type":24,"tag":29,"props":54,"children":55},{},[56],{"type":33,"value":57},"Before setting up a dedicated server, our game's world state was stored on files that lived on one of our computers, and that computer needed to be running the game server in order for anyone to connect. Sending files around would be possible, but would quickly become tedious. There are lots of services that offer dedicated servers for Valheim, as well as many technical guides and channels on the official Valheim Discord server to support the use of dedicated servers. I wanted to see if I could set up a server myself on AWS using CDK, or Cloud Development Kit. CDK is an Infrastructure as Code (IaC) tool that allows you to define, deploy and update AWS infrastructure with popular programming languages such as Python, Typescript, Java, etc.",{"type":24,"tag":59,"props":60,"children":62},"h2",{"id":61},"cdk-valheim-construct-on-github",[63,70],{"type":24,"tag":64,"props":65,"children":67},"code",{"className":66},[],[68],{"type":33,"value":69},"cdk-valheim",{"type":33,"value":71}," construct on GitHub",{"type":24,"tag":29,"props":73,"children":74},{},[75,77,83,85,91],{"type":33,"value":76},"The best part of CDK is that it enables the creation high-level, reusable constructs that can be published to software registries like npm and PyPI. Developers can import and use these constructs in their own CDK code. A quick google search for \"cdk valheim\" turned up a few results. ",{"type":24,"tag":36,"props":78,"children":81},{"href":79,"rel":80},"https://github.com/gotodeploy/cdk-valheim",[40],[82],{"type":33,"value":69},{"type":33,"value":84}," seems like the best option for what I was looking for. This project uses ECS, a container orchestration tool from AWS that I have experience using with web applications and EFS for persistent file storage. Although it is written in Typescript, I can still use the construct in my preferred programming language (Python) without any extra effort or configuration. This is thanks to the jsii. From ",{"type":24,"tag":36,"props":86,"children":89},{"href":87,"rel":88},"https://github.com/aws/jsii",[40],[90],{"type":33,"value":87},{"type":33,"value":92},":",{"type":24,"tag":25,"props":94,"children":95},{},[96],{"type":24,"tag":29,"props":97,"children":98},{},[99,105],{"type":24,"tag":64,"props":100,"children":102},{"className":101},[],[103],{"type":33,"value":104},"jsii",{"type":33,"value":106}," allows code in any language to naturally interact with JavaScript classes. It is the technology that enables the AWS Cloud Development Kit to deliver polyglot libraries from a single codebase!",{"type":24,"tag":29,"props":108,"children":109},{},[110,112,117],{"type":33,"value":111},"Here's an overview of the ",{"type":24,"tag":64,"props":113,"children":115},{"className":114},[],[116],{"type":33,"value":69},{"type":33,"value":118}," construct:",{"type":24,"tag":120,"props":121,"children":122},"ul",{},[123,129,134],{"type":24,"tag":124,"props":125,"children":126},"li",{},[127],{"type":33,"value":128},"Scheduled scaling of an ECS service using AWS Fargate (a serverless compute engine for containers)",{"type":24,"tag":124,"props":130,"children":131},{},[132],{"type":33,"value":133},"Elastic File System (EFS) file system mounted into the Fargate Task container of our ECS service",{"type":24,"tag":124,"props":135,"children":136},{},[137],{"type":33,"value":138},"Optional automated backups of the EFS file system using AWS Backup",{"type":24,"tag":59,"props":140,"children":142},{"id":141},"discord-interactions-and-slash-commands",[143],{"type":33,"value":144},"Discord Interactions and Slash Commands",{"type":24,"tag":29,"props":146,"children":147},{},[148,150,156,158,164,166,172],{"type":33,"value":149},"Scheduled ECS scaling is nice, but we don't always know when we will be able to play together, so it is not the best way to minimize infrastructure costs. My plan was to set the ECS service to an initial task count of zero and then let any of us set the number of tasks to either zero or one through a Discord Slash Command. A Slash Command allows you to interact with a discord bot by typing ",{"type":24,"tag":64,"props":151,"children":153},{"className":152},[],[154],{"type":33,"value":155},"/",{"type":33,"value":157}," and then tabbing through to the option we want, such as ",{"type":24,"tag":64,"props":159,"children":161},{"className":160},[],[162],{"type":33,"value":163},"/valheim server start",{"type":33,"value":165}," or ",{"type":24,"tag":64,"props":167,"children":169},{"className":168},[],[170],{"type":33,"value":171},"/valheim server status",{"type":33,"value":173},".",{"type":24,"tag":29,"props":175,"children":176},{},[177,179,185,187,193,194,200,202,208],{"type":33,"value":178},"Invoking a Slash Command from Discord sends a ",{"type":24,"tag":64,"props":180,"children":182},{"className":181},[],[183],{"type":33,"value":184},"POST",{"type":33,"value":186}," request from Discord to a webhook URL that we have to provide. To handle the webhook, one simple and inexpensive approach is to use API Gateway and a Lambda function that serves a Flask app. The Flask app can then use boto3 (which is included in the Lambda execution environment) to call ",{"type":24,"tag":64,"props":188,"children":190},{"className":189},[],[191],{"type":33,"value":192},"update_service",{"type":33,"value":165},{"type":24,"tag":64,"props":195,"children":197},{"className":196},[],[198],{"type":33,"value":199},"describe_services",{"type":33,"value":201}," to scaled the ECS task's ",{"type":24,"tag":64,"props":203,"children":205},{"className":204},[],[206],{"type":33,"value":207},"desiredCount",{"type":33,"value":209}," based on the slash command options and sub options.",{"type":24,"tag":29,"props":211,"children":212},{},[213,215,220,222,228,230,236,238,244,246,252,254,260,261,267,269,274,276,282,283,289],{"type":33,"value":214},"The function that handles the webhook ",{"type":24,"tag":64,"props":216,"children":218},{"className":217},[],[219],{"type":33,"value":184},{"type":33,"value":221}," request when the sub-command is ",{"type":24,"tag":64,"props":223,"children":225},{"className":224},[],[226],{"type":33,"value":227},"status",{"type":33,"value":229}," queries AWS for the number of ECS tasks in our service that are ",{"type":24,"tag":64,"props":231,"children":233},{"className":232},[],[234],{"type":33,"value":235},"desired",{"type":33,"value":237},", ",{"type":24,"tag":64,"props":239,"children":241},{"className":240},[],[242],{"type":33,"value":243},"running",{"type":33,"value":245}," and ",{"type":24,"tag":64,"props":247,"children":249},{"className":248},[],[250],{"type":33,"value":251},"pending",{"type":33,"value":253}," and then sends back a message that will be displayed to the user who sent the command. When the sub-command is ",{"type":24,"tag":64,"props":255,"children":257},{"className":256},[],[258],{"type":33,"value":259},"start",{"type":33,"value":165},{"type":24,"tag":64,"props":262,"children":264},{"className":263},[],[265],{"type":33,"value":266},"stop",{"type":33,"value":268},", the ",{"type":24,"tag":64,"props":270,"children":272},{"className":271},[],[273],{"type":33,"value":207},{"type":33,"value":275}," is either set to ",{"type":24,"tag":64,"props":277,"children":279},{"className":278},[],[280],{"type":33,"value":281},"1",{"type":33,"value":165},{"type":24,"tag":64,"props":284,"children":286},{"className":285},[],[287],{"type":33,"value":288},"0",{"type":33,"value":173},{"type":24,"tag":29,"props":291,"children":292},{},[293],{"type":33,"value":294},"Here's an overview of the server setup and how Discord Slash Commands can be used to control the server:",{"type":24,"tag":29,"props":296,"children":297},{},[298],{"type":24,"tag":299,"props":300,"children":303},"img",{"alt":301,"src":302},"png","/static/valheim/diagram.png",[],{"type":24,"tag":29,"props":305,"children":306},{},[307],{"type":33,"value":308},"I'll cover each of the steps labelled in this diagram at the end of the article. The rest of the article will provide detailed instructions for how to set everything up. I won't be going over AWS account setup or Discord server setup.",{"type":24,"tag":59,"props":310,"children":312},{"id":311},"how-to-set-up-the-discord-developer-application-and-interaction",[313],{"type":33,"value":314},"How to set up the Discord developer application and Interaction",{"type":24,"tag":29,"props":316,"children":317},{},[318,320,326],{"type":33,"value":319},"First, you need to be the admin of a Discord server. Once you create the server, go to ",{"type":24,"tag":64,"props":321,"children":323},{"className":322},[],[324],{"type":33,"value":325},"Server Settings > Widget",{"type":33,"value":327}," and take note of the Server ID. This is also known as the Guild ID.",{"type":24,"tag":29,"props":329,"children":330},{},[331,333,339,341,347,349,355,357,363],{"type":33,"value":332},"Then go to ",{"type":24,"tag":36,"props":334,"children":337},{"href":335,"rel":336},"https://discord.com/developers/applications",[40],[338],{"type":33,"value":335},{"type":33,"value":340}," and create an application. Under ",{"type":24,"tag":64,"props":342,"children":344},{"className":343},[],[345],{"type":33,"value":346},"General Information",{"type":33,"value":348},", make note of the public key (the application ID). Put these values in a file that will be ",{"type":24,"tag":64,"props":350,"children":352},{"className":351},[],[353],{"type":33,"value":354},".gitignored",{"type":33,"value":356}," called ",{"type":24,"tag":64,"props":358,"children":360},{"className":359},[],[361],{"type":33,"value":362},".env",{"type":33,"value":92},{"type":24,"tag":365,"props":366,"children":368},"pre",{"code":367},"export GUILD_ID=123456789\nexport APPLICATION_ID=abc123\n",[369],{"type":24,"tag":64,"props":370,"children":371},{"__ignoreMap":8},[372],{"type":33,"value":367},{"type":24,"tag":29,"props":374,"children":375},{},[376],{"type":33,"value":377},"We will use this file later when registering the Interaction.",{"type":24,"tag":29,"props":379,"children":380},{},[381,383,389,391,397,398,404],{"type":33,"value":382},"Next go to the ",{"type":24,"tag":64,"props":384,"children":386},{"className":385},[],[387],{"type":33,"value":388},"OAuth2",{"type":33,"value":390}," tab and select the ",{"type":24,"tag":64,"props":392,"children":394},{"className":393},[],[395],{"type":33,"value":396},"bot",{"type":33,"value":245},{"type":24,"tag":64,"props":399,"children":401},{"className":400},[],[402],{"type":33,"value":403},"applications.commands",{"type":33,"value":405}," permissions. This will generated an OAuth2 authorization link. Copy the link and open it in a browser. We will see an error:",{"type":24,"tag":365,"props":407,"children":409},{"code":408},"OAuth2 application does not have a bot\n",[410],{"type":24,"tag":64,"props":411,"children":412},{"__ignoreMap":8},[413],{"type":33,"value":408},{"type":24,"tag":415,"props":416,"children":418},"h3",{"id":417},"configure-a-bot-for-our-discord-application",[419],{"type":33,"value":420},"Configure a bot for our Discord application",{"type":24,"tag":29,"props":422,"children":423},{},[424,426,432,434,440],{"type":33,"value":425},"Next, got to the ",{"type":24,"tag":64,"props":427,"children":429},{"className":428},[],[430],{"type":33,"value":431},"Bot",{"type":33,"value":433}," tab and click the ",{"type":24,"tag":64,"props":435,"children":437},{"className":436},[],[438],{"type":33,"value":439},"Add Bot",{"type":33,"value":441}," button.",{"type":24,"tag":25,"props":443,"children":444},{},[445],{"type":24,"tag":29,"props":446,"children":447},{},[448],{"type":33,"value":449},"Adding a bot user gives your app visible life in Discord. However, this action is irrevocable! Choose wisely.",{"type":24,"tag":29,"props":451,"children":452},{},[453,455,461],{"type":33,"value":454},"Turn off the ",{"type":24,"tag":64,"props":456,"children":458},{"className":457},[],[459],{"type":33,"value":460},"Public Bot",{"type":33,"value":462}," option and save changes.",{"type":24,"tag":29,"props":464,"children":465},{},[466,468,474,476,481],{"type":33,"value":467},"Get the bot token by clicking on ",{"type":24,"tag":64,"props":469,"children":471},{"className":470},[],[472],{"type":33,"value":473},"Click to Reveal Token",{"type":33,"value":475},", and add this to ",{"type":24,"tag":64,"props":477,"children":479},{"className":478},[],[480],{"type":33,"value":362},{"type":33,"value":92},{"type":24,"tag":365,"props":483,"children":485},{"code":484},"export BOT_TOKEN=abc.xyz.123\n",[486],{"type":24,"tag":64,"props":487,"children":488},{"__ignoreMap":8},[489],{"type":33,"value":484},{"type":24,"tag":29,"props":491,"children":492},{},[493,495,500,501,506,507,512,514,520],{"type":33,"value":494},"Now go back to the ",{"type":24,"tag":64,"props":496,"children":498},{"className":497},[],[499],{"type":33,"value":388},{"type":33,"value":390},{"type":24,"tag":64,"props":502,"children":504},{"className":503},[],[505],{"type":33,"value":396},{"type":33,"value":245},{"type":24,"tag":64,"props":508,"children":510},{"className":509},[],[511],{"type":33,"value":403},{"type":33,"value":513}," permissions again, copy the link and open it. Select the server that you want to add this application to. You should see a captcha, and then a message that says ",{"type":24,"tag":64,"props":515,"children":517},{"className":516},[],[518],{"type":33,"value":519},"Authorized",{"type":33,"value":521},". You should also see a message from your discord server that the bot has joined the server.",{"type":24,"tag":415,"props":523,"children":525},{"id":524},"create-the-interaction",[526],{"type":33,"value":527},"Create the Interaction",{"type":24,"tag":29,"props":529,"children":530},{},[531,533,538],{"type":33,"value":532},"Now we will set up the Interaction. Currently the only way to set up the interaction is through an HTTP ",{"type":24,"tag":64,"props":534,"children":536},{"className":535},[],[537],{"type":33,"value":184},{"type":33,"value":539}," request. This Python script sets up our Interaction:",{"type":24,"tag":365,"props":541,"children":545},{"code":542,"language":543,"meta":8,"className":544,"style":8},"\"\"\"\nhttps://discord.com/developers/docs/interactions/slash-commands#registering-a-command\n\"\"\"\n\nimport os\n\nimport requests\n\nAPPLICATION_ID = os.environ.get(\"APPLICATION_ID\")\nGUILD_ID = os.environ.get(\"GUILD_ID\")\nBOT_TOKEN = os.environ.get(\"BOT_TOKEN\")\n\nurl = f\"https://discord.com/api/v8/applications/{APPLICATION_ID}/guilds/{GUILD_ID}/commands\"\n\njson = {\n    \"name\": \"vh\",\n    \"description\": \"Start, stop or get the status of the Valheim server\",\n    \"options\": [\n        {\n            \"name\": \"valheim_server_controls\",\n            \"description\": \"What do you want to do?\",\n            \"type\": 3,\n            \"required\": True,\n            \"choices\": [\n                {\n                    \"name\": \"status\",\n                    \"value\": \"status\"\n                },\n                {\n                    \"name\": \"start\",\n                    \"value\": \"start\"\n                },\n                {\n                    \"name\": \"stop\",\n                    \"value\": \"stop\"\n                }\n            ]\n        },\n    ]\n}\n\nheaders = {\n    \"Authorization\": f\"Bot {BOT_TOKEN}\"\n}\n\nif __name__ == \"__main__\":\n    r = requests.post(url, headers=headers, json=json)\n    print(r.content)\n","py","language-py shiki shiki-themes github-light github-dark monokai",[546],{"type":24,"tag":64,"props":547,"children":548},{"__ignoreMap":8},[549,561,570,578,588,604,612,625,633,663,689,715,723,768,776,794,818,840,854,863,885,907,929,951,964,973,995,1013,1022,1030,1051,1068,1076,1084,1105,1122,1131,1140,1149,1158,1167,1175,1192,1225,1233,1241,1271,1318],{"type":24,"tag":550,"props":551,"children":554},"span",{"class":552,"line":553},"line",1,[555],{"type":24,"tag":550,"props":556,"children":558},{"style":557},"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[559],{"type":33,"value":560},"\"\"\"\n",{"type":24,"tag":550,"props":562,"children":564},{"class":552,"line":563},2,[565],{"type":24,"tag":550,"props":566,"children":567},{"style":557},[568],{"type":33,"value":569},"https://discord.com/developers/docs/interactions/slash-commands#registering-a-command\n",{"type":24,"tag":550,"props":571,"children":573},{"class":552,"line":572},3,[574],{"type":24,"tag":550,"props":575,"children":576},{"style":557},[577],{"type":33,"value":560},{"type":24,"tag":550,"props":579,"children":581},{"class":552,"line":580},4,[582],{"type":24,"tag":550,"props":583,"children":585},{"emptyLinePlaceholder":584},true,[586],{"type":33,"value":587},"\n",{"type":24,"tag":550,"props":589,"children":591},{"class":552,"line":590},5,[592,598],{"type":24,"tag":550,"props":593,"children":595},{"style":594},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[596],{"type":33,"value":597},"import",{"type":24,"tag":550,"props":599,"children":601},{"style":600},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[602],{"type":33,"value":603}," os\n",{"type":24,"tag":550,"props":605,"children":607},{"class":552,"line":606},6,[608],{"type":24,"tag":550,"props":609,"children":610},{"emptyLinePlaceholder":584},[611],{"type":33,"value":587},{"type":24,"tag":550,"props":613,"children":615},{"class":552,"line":614},7,[616,620],{"type":24,"tag":550,"props":617,"children":618},{"style":594},[619],{"type":33,"value":597},{"type":24,"tag":550,"props":621,"children":622},{"style":600},[623],{"type":33,"value":624}," requests\n",{"type":24,"tag":550,"props":626,"children":628},{"class":552,"line":627},8,[629],{"type":24,"tag":550,"props":630,"children":631},{"emptyLinePlaceholder":584},[632],{"type":33,"value":587},{"type":24,"tag":550,"props":634,"children":636},{"class":552,"line":635},9,[637,643,648,653,658],{"type":24,"tag":550,"props":638,"children":640},{"style":639},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[641],{"type":33,"value":642},"APPLICATION_ID",{"type":24,"tag":550,"props":644,"children":645},{"style":594},[646],{"type":33,"value":647}," =",{"type":24,"tag":550,"props":649,"children":650},{"style":600},[651],{"type":33,"value":652}," os.environ.get(",{"type":24,"tag":550,"props":654,"children":655},{"style":557},[656],{"type":33,"value":657},"\"APPLICATION_ID\"",{"type":24,"tag":550,"props":659,"children":660},{"style":600},[661],{"type":33,"value":662},")\n",{"type":24,"tag":550,"props":664,"children":666},{"class":552,"line":665},10,[667,672,676,680,685],{"type":24,"tag":550,"props":668,"children":669},{"style":639},[670],{"type":33,"value":671},"GUILD_ID",{"type":24,"tag":550,"props":673,"children":674},{"style":594},[675],{"type":33,"value":647},{"type":24,"tag":550,"props":677,"children":678},{"style":600},[679],{"type":33,"value":652},{"type":24,"tag":550,"props":681,"children":682},{"style":557},[683],{"type":33,"value":684},"\"GUILD_ID\"",{"type":24,"tag":550,"props":686,"children":687},{"style":600},[688],{"type":33,"value":662},{"type":24,"tag":550,"props":690,"children":692},{"class":552,"line":691},11,[693,698,702,706,711],{"type":24,"tag":550,"props":694,"children":695},{"style":639},[696],{"type":33,"value":697},"BOT_TOKEN",{"type":24,"tag":550,"props":699,"children":700},{"style":594},[701],{"type":33,"value":647},{"type":24,"tag":550,"props":703,"children":704},{"style":600},[705],{"type":33,"value":652},{"type":24,"tag":550,"props":707,"children":708},{"style":557},[709],{"type":33,"value":710},"\"BOT_TOKEN\"",{"type":24,"tag":550,"props":712,"children":713},{"style":600},[714],{"type":33,"value":662},{"type":24,"tag":550,"props":716,"children":718},{"class":552,"line":717},12,[719],{"type":24,"tag":550,"props":720,"children":721},{"emptyLinePlaceholder":584},[722],{"type":33,"value":587},{"type":24,"tag":550,"props":724,"children":726},{"class":552,"line":725},13,[727,732,737,743,748,753,758,763],{"type":24,"tag":550,"props":728,"children":729},{"style":600},[730],{"type":33,"value":731},"url ",{"type":24,"tag":550,"props":733,"children":734},{"style":594},[735],{"type":33,"value":736},"=",{"type":24,"tag":550,"props":738,"children":740},{"style":739},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[741],{"type":33,"value":742}," f",{"type":24,"tag":550,"props":744,"children":745},{"style":557},[746],{"type":33,"value":747},"\"https://discord.com/api/v8/applications/",{"type":24,"tag":550,"props":749,"children":750},{"style":639},[751],{"type":33,"value":752},"{APPLICATION_ID}",{"type":24,"tag":550,"props":754,"children":755},{"style":557},[756],{"type":33,"value":757},"/guilds/",{"type":24,"tag":550,"props":759,"children":760},{"style":639},[761],{"type":33,"value":762},"{GUILD_ID}",{"type":24,"tag":550,"props":764,"children":765},{"style":557},[766],{"type":33,"value":767},"/commands\"\n",{"type":24,"tag":550,"props":769,"children":771},{"class":552,"line":770},14,[772],{"type":24,"tag":550,"props":773,"children":774},{"emptyLinePlaceholder":584},[775],{"type":33,"value":587},{"type":24,"tag":550,"props":777,"children":779},{"class":552,"line":778},15,[780,785,789],{"type":24,"tag":550,"props":781,"children":782},{"style":600},[783],{"type":33,"value":784},"json ",{"type":24,"tag":550,"props":786,"children":787},{"style":594},[788],{"type":33,"value":736},{"type":24,"tag":550,"props":790,"children":791},{"style":600},[792],{"type":33,"value":793}," {\n",{"type":24,"tag":550,"props":795,"children":797},{"class":552,"line":796},16,[798,803,808,813],{"type":24,"tag":550,"props":799,"children":800},{"style":557},[801],{"type":33,"value":802},"    \"name\"",{"type":24,"tag":550,"props":804,"children":805},{"style":600},[806],{"type":33,"value":807},": ",{"type":24,"tag":550,"props":809,"children":810},{"style":557},[811],{"type":33,"value":812},"\"vh\"",{"type":24,"tag":550,"props":814,"children":815},{"style":600},[816],{"type":33,"value":817},",\n",{"type":24,"tag":550,"props":819,"children":821},{"class":552,"line":820},17,[822,827,831,836],{"type":24,"tag":550,"props":823,"children":824},{"style":557},[825],{"type":33,"value":826},"    \"description\"",{"type":24,"tag":550,"props":828,"children":829},{"style":600},[830],{"type":33,"value":807},{"type":24,"tag":550,"props":832,"children":833},{"style":557},[834],{"type":33,"value":835},"\"Start, stop or get the status of the Valheim server\"",{"type":24,"tag":550,"props":837,"children":838},{"style":600},[839],{"type":33,"value":817},{"type":24,"tag":550,"props":841,"children":843},{"class":552,"line":842},18,[844,849],{"type":24,"tag":550,"props":845,"children":846},{"style":557},[847],{"type":33,"value":848},"    \"options\"",{"type":24,"tag":550,"props":850,"children":851},{"style":600},[852],{"type":33,"value":853},": [\n",{"type":24,"tag":550,"props":855,"children":857},{"class":552,"line":856},19,[858],{"type":24,"tag":550,"props":859,"children":860},{"style":600},[861],{"type":33,"value":862},"        {\n",{"type":24,"tag":550,"props":864,"children":866},{"class":552,"line":865},20,[867,872,876,881],{"type":24,"tag":550,"props":868,"children":869},{"style":557},[870],{"type":33,"value":871},"            \"name\"",{"type":24,"tag":550,"props":873,"children":874},{"style":600},[875],{"type":33,"value":807},{"type":24,"tag":550,"props":877,"children":878},{"style":557},[879],{"type":33,"value":880},"\"valheim_server_controls\"",{"type":24,"tag":550,"props":882,"children":883},{"style":600},[884],{"type":33,"value":817},{"type":24,"tag":550,"props":886,"children":888},{"class":552,"line":887},21,[889,894,898,903],{"type":24,"tag":550,"props":890,"children":891},{"style":557},[892],{"type":33,"value":893},"            \"description\"",{"type":24,"tag":550,"props":895,"children":896},{"style":600},[897],{"type":33,"value":807},{"type":24,"tag":550,"props":899,"children":900},{"style":557},[901],{"type":33,"value":902},"\"What do you want to do?\"",{"type":24,"tag":550,"props":904,"children":905},{"style":600},[906],{"type":33,"value":817},{"type":24,"tag":550,"props":908,"children":910},{"class":552,"line":909},22,[911,916,920,925],{"type":24,"tag":550,"props":912,"children":913},{"style":557},[914],{"type":33,"value":915},"            \"type\"",{"type":24,"tag":550,"props":917,"children":918},{"style":600},[919],{"type":33,"value":807},{"type":24,"tag":550,"props":921,"children":922},{"style":639},[923],{"type":33,"value":924},"3",{"type":24,"tag":550,"props":926,"children":927},{"style":600},[928],{"type":33,"value":817},{"type":24,"tag":550,"props":930,"children":932},{"class":552,"line":931},23,[933,938,942,947],{"type":24,"tag":550,"props":934,"children":935},{"style":557},[936],{"type":33,"value":937},"            \"required\"",{"type":24,"tag":550,"props":939,"children":940},{"style":600},[941],{"type":33,"value":807},{"type":24,"tag":550,"props":943,"children":944},{"style":639},[945],{"type":33,"value":946},"True",{"type":24,"tag":550,"props":948,"children":949},{"style":600},[950],{"type":33,"value":817},{"type":24,"tag":550,"props":952,"children":954},{"class":552,"line":953},24,[955,960],{"type":24,"tag":550,"props":956,"children":957},{"style":557},[958],{"type":33,"value":959},"            \"choices\"",{"type":24,"tag":550,"props":961,"children":962},{"style":600},[963],{"type":33,"value":853},{"type":24,"tag":550,"props":965,"children":967},{"class":552,"line":966},25,[968],{"type":24,"tag":550,"props":969,"children":970},{"style":600},[971],{"type":33,"value":972},"                {\n",{"type":24,"tag":550,"props":974,"children":976},{"class":552,"line":975},26,[977,982,986,991],{"type":24,"tag":550,"props":978,"children":979},{"style":557},[980],{"type":33,"value":981},"                    \"name\"",{"type":24,"tag":550,"props":983,"children":984},{"style":600},[985],{"type":33,"value":807},{"type":24,"tag":550,"props":987,"children":988},{"style":557},[989],{"type":33,"value":990},"\"status\"",{"type":24,"tag":550,"props":992,"children":993},{"style":600},[994],{"type":33,"value":817},{"type":24,"tag":550,"props":996,"children":998},{"class":552,"line":997},27,[999,1004,1008],{"type":24,"tag":550,"props":1000,"children":1001},{"style":557},[1002],{"type":33,"value":1003},"                    \"value\"",{"type":24,"tag":550,"props":1005,"children":1006},{"style":600},[1007],{"type":33,"value":807},{"type":24,"tag":550,"props":1009,"children":1010},{"style":557},[1011],{"type":33,"value":1012},"\"status\"\n",{"type":24,"tag":550,"props":1014,"children":1016},{"class":552,"line":1015},28,[1017],{"type":24,"tag":550,"props":1018,"children":1019},{"style":600},[1020],{"type":33,"value":1021},"                },\n",{"type":24,"tag":550,"props":1023,"children":1025},{"class":552,"line":1024},29,[1026],{"type":24,"tag":550,"props":1027,"children":1028},{"style":600},[1029],{"type":33,"value":972},{"type":24,"tag":550,"props":1031,"children":1033},{"class":552,"line":1032},30,[1034,1038,1042,1047],{"type":24,"tag":550,"props":1035,"children":1036},{"style":557},[1037],{"type":33,"value":981},{"type":24,"tag":550,"props":1039,"children":1040},{"style":600},[1041],{"type":33,"value":807},{"type":24,"tag":550,"props":1043,"children":1044},{"style":557},[1045],{"type":33,"value":1046},"\"start\"",{"type":24,"tag":550,"props":1048,"children":1049},{"style":600},[1050],{"type":33,"value":817},{"type":24,"tag":550,"props":1052,"children":1054},{"class":552,"line":1053},31,[1055,1059,1063],{"type":24,"tag":550,"props":1056,"children":1057},{"style":557},[1058],{"type":33,"value":1003},{"type":24,"tag":550,"props":1060,"children":1061},{"style":600},[1062],{"type":33,"value":807},{"type":24,"tag":550,"props":1064,"children":1065},{"style":557},[1066],{"type":33,"value":1067},"\"start\"\n",{"type":24,"tag":550,"props":1069,"children":1071},{"class":552,"line":1070},32,[1072],{"type":24,"tag":550,"props":1073,"children":1074},{"style":600},[1075],{"type":33,"value":1021},{"type":24,"tag":550,"props":1077,"children":1079},{"class":552,"line":1078},33,[1080],{"type":24,"tag":550,"props":1081,"children":1082},{"style":600},[1083],{"type":33,"value":972},{"type":24,"tag":550,"props":1085,"children":1087},{"class":552,"line":1086},34,[1088,1092,1096,1101],{"type":24,"tag":550,"props":1089,"children":1090},{"style":557},[1091],{"type":33,"value":981},{"type":24,"tag":550,"props":1093,"children":1094},{"style":600},[1095],{"type":33,"value":807},{"type":24,"tag":550,"props":1097,"children":1098},{"style":557},[1099],{"type":33,"value":1100},"\"stop\"",{"type":24,"tag":550,"props":1102,"children":1103},{"style":600},[1104],{"type":33,"value":817},{"type":24,"tag":550,"props":1106,"children":1108},{"class":552,"line":1107},35,[1109,1113,1117],{"type":24,"tag":550,"props":1110,"children":1111},{"style":557},[1112],{"type":33,"value":1003},{"type":24,"tag":550,"props":1114,"children":1115},{"style":600},[1116],{"type":33,"value":807},{"type":24,"tag":550,"props":1118,"children":1119},{"style":557},[1120],{"type":33,"value":1121},"\"stop\"\n",{"type":24,"tag":550,"props":1123,"children":1125},{"class":552,"line":1124},36,[1126],{"type":24,"tag":550,"props":1127,"children":1128},{"style":600},[1129],{"type":33,"value":1130},"                }\n",{"type":24,"tag":550,"props":1132,"children":1134},{"class":552,"line":1133},37,[1135],{"type":24,"tag":550,"props":1136,"children":1137},{"style":600},[1138],{"type":33,"value":1139},"            ]\n",{"type":24,"tag":550,"props":1141,"children":1143},{"class":552,"line":1142},38,[1144],{"type":24,"tag":550,"props":1145,"children":1146},{"style":600},[1147],{"type":33,"value":1148},"        },\n",{"type":24,"tag":550,"props":1150,"children":1152},{"class":552,"line":1151},39,[1153],{"type":24,"tag":550,"props":1154,"children":1155},{"style":600},[1156],{"type":33,"value":1157},"    ]\n",{"type":24,"tag":550,"props":1159,"children":1161},{"class":552,"line":1160},40,[1162],{"type":24,"tag":550,"props":1163,"children":1164},{"style":600},[1165],{"type":33,"value":1166},"}\n",{"type":24,"tag":550,"props":1168,"children":1170},{"class":552,"line":1169},41,[1171],{"type":24,"tag":550,"props":1172,"children":1173},{"emptyLinePlaceholder":584},[1174],{"type":33,"value":587},{"type":24,"tag":550,"props":1176,"children":1178},{"class":552,"line":1177},42,[1179,1184,1188],{"type":24,"tag":550,"props":1180,"children":1181},{"style":600},[1182],{"type":33,"value":1183},"headers ",{"type":24,"tag":550,"props":1185,"children":1186},{"style":594},[1187],{"type":33,"value":736},{"type":24,"tag":550,"props":1189,"children":1190},{"style":600},[1191],{"type":33,"value":793},{"type":24,"tag":550,"props":1193,"children":1195},{"class":552,"line":1194},43,[1196,1201,1205,1210,1215,1220],{"type":24,"tag":550,"props":1197,"children":1198},{"style":557},[1199],{"type":33,"value":1200},"    \"Authorization\"",{"type":24,"tag":550,"props":1202,"children":1203},{"style":600},[1204],{"type":33,"value":807},{"type":24,"tag":550,"props":1206,"children":1207},{"style":739},[1208],{"type":33,"value":1209},"f",{"type":24,"tag":550,"props":1211,"children":1212},{"style":557},[1213],{"type":33,"value":1214},"\"Bot ",{"type":24,"tag":550,"props":1216,"children":1217},{"style":639},[1218],{"type":33,"value":1219},"{BOT_TOKEN}",{"type":24,"tag":550,"props":1221,"children":1222},{"style":557},[1223],{"type":33,"value":1224},"\"\n",{"type":24,"tag":550,"props":1226,"children":1228},{"class":552,"line":1227},44,[1229],{"type":24,"tag":550,"props":1230,"children":1231},{"style":600},[1232],{"type":33,"value":1166},{"type":24,"tag":550,"props":1234,"children":1236},{"class":552,"line":1235},45,[1237],{"type":24,"tag":550,"props":1238,"children":1239},{"emptyLinePlaceholder":584},[1240],{"type":33,"value":587},{"type":24,"tag":550,"props":1242,"children":1244},{"class":552,"line":1243},46,[1245,1250,1256,1261,1266],{"type":24,"tag":550,"props":1246,"children":1247},{"style":594},[1248],{"type":33,"value":1249},"if",{"type":24,"tag":550,"props":1251,"children":1253},{"style":1252},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[1254],{"type":33,"value":1255}," __name__",{"type":24,"tag":550,"props":1257,"children":1258},{"style":594},[1259],{"type":33,"value":1260}," ==",{"type":24,"tag":550,"props":1262,"children":1263},{"style":557},[1264],{"type":33,"value":1265}," \"__main__\"",{"type":24,"tag":550,"props":1267,"children":1268},{"style":600},[1269],{"type":33,"value":1270},":\n",{"type":24,"tag":550,"props":1272,"children":1274},{"class":552,"line":1273},47,[1275,1280,1284,1289,1295,1299,1304,1309,1313],{"type":24,"tag":550,"props":1276,"children":1277},{"style":600},[1278],{"type":33,"value":1279},"    r ",{"type":24,"tag":550,"props":1281,"children":1282},{"style":594},[1283],{"type":33,"value":736},{"type":24,"tag":550,"props":1285,"children":1286},{"style":600},[1287],{"type":33,"value":1288}," requests.post(url, ",{"type":24,"tag":550,"props":1290,"children":1292},{"style":1291},"--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1293],{"type":33,"value":1294},"headers",{"type":24,"tag":550,"props":1296,"children":1297},{"style":594},[1298],{"type":33,"value":736},{"type":24,"tag":550,"props":1300,"children":1301},{"style":600},[1302],{"type":33,"value":1303},"headers, ",{"type":24,"tag":550,"props":1305,"children":1306},{"style":1291},[1307],{"type":33,"value":1308},"json",{"type":24,"tag":550,"props":1310,"children":1311},{"style":594},[1312],{"type":33,"value":736},{"type":24,"tag":550,"props":1314,"children":1315},{"style":600},[1316],{"type":33,"value":1317},"json)\n",{"type":24,"tag":550,"props":1319,"children":1321},{"class":552,"line":1320},48,[1322,1328],{"type":24,"tag":550,"props":1323,"children":1325},{"style":1324},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF",[1326],{"type":33,"value":1327},"    print",{"type":24,"tag":550,"props":1329,"children":1330},{"style":600},[1331],{"type":33,"value":1332},"(r.content)\n",{"type":24,"tag":29,"props":1334,"children":1335},{},[1336,1338,1343],{"type":33,"value":1337},"Before running this command, source the ",{"type":24,"tag":64,"props":1339,"children":1341},{"className":1340},[],[1342],{"type":33,"value":362},{"type":33,"value":1344}," file:",{"type":24,"tag":365,"props":1346,"children":1348},{"code":1347},"source .env\n",[1349],{"type":24,"tag":64,"props":1350,"children":1351},{"__ignoreMap":8},[1352],{"type":33,"value":1347},{"type":24,"tag":29,"props":1354,"children":1355},{},[1356],{"type":33,"value":1357},"Then run the script:",{"type":24,"tag":365,"props":1359,"children":1361},{"code":1360},"python3 register_bot.py\n",[1362],{"type":24,"tag":64,"props":1363,"children":1364},{"__ignoreMap":8},[1365],{"type":33,"value":1360},{"type":24,"tag":29,"props":1367,"children":1368},{},[1369],{"type":33,"value":1370},"You should see this response:",{"type":24,"tag":365,"props":1372,"children":1374},{"code":1373},"b'{\"id\": \"XXXXXXXXXXXXXX\", \"application_id\": \"XXXXXXXXXXXXXX\", \"name\": \"vh\", \"description\": \"Start, stop or get the status of the Valheim server\", \"version\": \"XXXXXXXXXXXXXX\", \"default_permission\": true, \"guild_id\": \"XXXXXXXXXXXXXX\", \"options\": [{\"type\": 3, \"name\": \"valheim_server_controls\", \"description\": \"What do you want to do?\", \"required\": true, \"choices\": [{\"name\": \"status\", \"value\": \"status\"}, {\"name\": \"start\", \"value\": \"start\"}, {\"name\": \"stop\", \"value\": \"stop\"}]}]}'\n",[1375],{"type":24,"tag":64,"props":1376,"children":1377},{"__ignoreMap":8},[1378],{"type":33,"value":1373},{"type":24,"tag":29,"props":1380,"children":1381},{},[1382,1384,1389,1391,1397],{"type":33,"value":1383},"Now, when you type ",{"type":24,"tag":64,"props":1385,"children":1387},{"className":1386},[],[1388],{"type":33,"value":155},{"type":33,"value":1390}," in any channel on the Discord server that you authenticated the bot, you should see the ",{"type":24,"tag":64,"props":1392,"children":1394},{"className":1393},[],[1395],{"type":33,"value":1396},"vh",{"type":33,"value":1398}," command at the top of the list of autocomplete options.",{"type":24,"tag":29,"props":1400,"children":1401},{},[1402],{"type":33,"value":1403},"If we run any of these commands, we should see a response saying:",{"type":24,"tag":365,"props":1405,"children":1407},{"code":1406},"This interaction failed\n",[1408],{"type":24,"tag":64,"props":1409,"children":1410},{"__ignoreMap":8},[1411],{"type":33,"value":1406},{"type":24,"tag":29,"props":1413,"children":1414},{},[1415,1417,1423,1425,1430,1432,1438],{"type":33,"value":1416},"This is because we have not configured an ",{"type":24,"tag":64,"props":1418,"children":1420},{"className":1419},[],[1421],{"type":33,"value":1422},"Interactions Endpoint URL",{"type":33,"value":1424}," under the ",{"type":24,"tag":64,"props":1426,"children":1428},{"className":1427},[],[1429],{"type":33,"value":346},{"type":33,"value":1431}," section of our Discord Application's admin page (",{"type":24,"tag":36,"props":1433,"children":1436},{"href":1434,"rel":1435},"https://discord.com/developers/applications/",[40],[1437],{"type":33,"value":1434},{"type":33,"value":1439},").",{"type":24,"tag":59,"props":1441,"children":1443},{"id":1442},"setting-up-the-interactions-endpoint-url-for-our-slash-command",[1444],{"type":33,"value":1445},"Setting up the Interactions Endpoint URL for our Slash Command",{"type":24,"tag":29,"props":1447,"children":1448},{},[1449,1451,1456,1458,1465],{"type":33,"value":1450},"In order for our Slash Command to do anything, we need to set up URL that Discord will ",{"type":24,"tag":64,"props":1452,"children":1454},{"className":1453},[],[1455],{"type":33,"value":184},{"type":33,"value":1457}," the Interaction event data to, including information such as who sent the Interaction, what channel it was sent on, what options were used, etc. You can see an example of the event payload ",{"type":24,"tag":36,"props":1459,"children":1462},{"href":1460,"rel":1461},"https://discord.com/developers/docs/interactions/slash-commands#receiving-an-interaction",[40],[1463],{"type":33,"value":1464},"here on the Discord developer documentation",{"type":33,"value":92},{"type":24,"tag":365,"props":1467,"children":1470},{"code":1468,"language":1308,"meta":8,"className":1469,"style":8},"{\n    \"type\": 2,\n    \"token\": \"A_UNIQUE_TOKEN\",\n    \"member\": {\n        \"user\": {\n            \"id\": 53908232506183680,\n            \"username\": \"Mason\",\n            \"avatar\": \"a_d5efa99b3eeaa7dd43acca82f5692432\",\n            \"discriminator\": \"1337\",\n            \"public_flags\": 131141\n        },\n        \"roles\": [\"539082325061836999\"],\n        \"premium_since\": null,\n        \"permissions\": \"2147483647\",\n        \"pending\": false,\n        \"nick\": null,\n        \"mute\": false,\n        \"joined_at\": \"2017-03-13T19:19:14.040000+00:00\",\n        \"is_pending\": false,\n        \"deaf\": false\n    },\n    \"id\": \"786008729715212338\",\n    \"guild_id\": \"290926798626357999\",\n    \"data\": {\n        \"options\": [{\n            \"name\": \"cardname\",\n            \"value\": \"The Gitrog Monster\"\n        }],\n        \"name\": \"cardsearch\",\n        \"id\": \"771825006014889984\"\n    },\n    \"channel_id\": \"645027906669510667\"\n}\n","language-json shiki shiki-themes github-light github-dark monokai",[1471],{"type":24,"tag":64,"props":1472,"children":1473},{"__ignoreMap":8},[1474,1482,1504,1526,1539,1551,1572,1593,1614,1635,1652,1659,1682,1703,1724,1745,1765,1785,1806,1826,1843,1851,1872,1893,1905,1918,1938,1955,1963,1984,2001,2008,2025],{"type":24,"tag":550,"props":1475,"children":1476},{"class":552,"line":553},[1477],{"type":24,"tag":550,"props":1478,"children":1479},{"style":600},[1480],{"type":33,"value":1481},"{\n",{"type":24,"tag":550,"props":1483,"children":1484},{"class":552,"line":563},[1485,1491,1495,1500],{"type":24,"tag":550,"props":1486,"children":1488},{"style":1487},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1489],{"type":33,"value":1490},"    \"type\"",{"type":24,"tag":550,"props":1492,"children":1493},{"style":600},[1494],{"type":33,"value":807},{"type":24,"tag":550,"props":1496,"children":1497},{"style":639},[1498],{"type":33,"value":1499},"2",{"type":24,"tag":550,"props":1501,"children":1502},{"style":600},[1503],{"type":33,"value":817},{"type":24,"tag":550,"props":1505,"children":1506},{"class":552,"line":572},[1507,1512,1516,1522],{"type":24,"tag":550,"props":1508,"children":1509},{"style":1487},[1510],{"type":33,"value":1511},"    \"token\"",{"type":24,"tag":550,"props":1513,"children":1514},{"style":600},[1515],{"type":33,"value":807},{"type":24,"tag":550,"props":1517,"children":1519},{"style":1518},"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#CFCFC2",[1520],{"type":33,"value":1521},"\"A_UNIQUE_TOKEN\"",{"type":24,"tag":550,"props":1523,"children":1524},{"style":600},[1525],{"type":33,"value":817},{"type":24,"tag":550,"props":1527,"children":1528},{"class":552,"line":580},[1529,1534],{"type":24,"tag":550,"props":1530,"children":1531},{"style":1487},[1532],{"type":33,"value":1533},"    \"member\"",{"type":24,"tag":550,"props":1535,"children":1536},{"style":600},[1537],{"type":33,"value":1538},": {\n",{"type":24,"tag":550,"props":1540,"children":1541},{"class":552,"line":590},[1542,1547],{"type":24,"tag":550,"props":1543,"children":1544},{"style":1487},[1545],{"type":33,"value":1546},"        \"user\"",{"type":24,"tag":550,"props":1548,"children":1549},{"style":600},[1550],{"type":33,"value":1538},{"type":24,"tag":550,"props":1552,"children":1553},{"class":552,"line":606},[1554,1559,1563,1568],{"type":24,"tag":550,"props":1555,"children":1556},{"style":1487},[1557],{"type":33,"value":1558},"            \"id\"",{"type":24,"tag":550,"props":1560,"children":1561},{"style":600},[1562],{"type":33,"value":807},{"type":24,"tag":550,"props":1564,"children":1565},{"style":639},[1566],{"type":33,"value":1567},"53908232506183680",{"type":24,"tag":550,"props":1569,"children":1570},{"style":600},[1571],{"type":33,"value":817},{"type":24,"tag":550,"props":1573,"children":1574},{"class":552,"line":614},[1575,1580,1584,1589],{"type":24,"tag":550,"props":1576,"children":1577},{"style":1487},[1578],{"type":33,"value":1579},"            \"username\"",{"type":24,"tag":550,"props":1581,"children":1582},{"style":600},[1583],{"type":33,"value":807},{"type":24,"tag":550,"props":1585,"children":1586},{"style":1518},[1587],{"type":33,"value":1588},"\"Mason\"",{"type":24,"tag":550,"props":1590,"children":1591},{"style":600},[1592],{"type":33,"value":817},{"type":24,"tag":550,"props":1594,"children":1595},{"class":552,"line":627},[1596,1601,1605,1610],{"type":24,"tag":550,"props":1597,"children":1598},{"style":1487},[1599],{"type":33,"value":1600},"            \"avatar\"",{"type":24,"tag":550,"props":1602,"children":1603},{"style":600},[1604],{"type":33,"value":807},{"type":24,"tag":550,"props":1606,"children":1607},{"style":1518},[1608],{"type":33,"value":1609},"\"a_d5efa99b3eeaa7dd43acca82f5692432\"",{"type":24,"tag":550,"props":1611,"children":1612},{"style":600},[1613],{"type":33,"value":817},{"type":24,"tag":550,"props":1615,"children":1616},{"class":552,"line":635},[1617,1622,1626,1631],{"type":24,"tag":550,"props":1618,"children":1619},{"style":1487},[1620],{"type":33,"value":1621},"            \"discriminator\"",{"type":24,"tag":550,"props":1623,"children":1624},{"style":600},[1625],{"type":33,"value":807},{"type":24,"tag":550,"props":1627,"children":1628},{"style":1518},[1629],{"type":33,"value":1630},"\"1337\"",{"type":24,"tag":550,"props":1632,"children":1633},{"style":600},[1634],{"type":33,"value":817},{"type":24,"tag":550,"props":1636,"children":1637},{"class":552,"line":665},[1638,1643,1647],{"type":24,"tag":550,"props":1639,"children":1640},{"style":1487},[1641],{"type":33,"value":1642},"            \"public_flags\"",{"type":24,"tag":550,"props":1644,"children":1645},{"style":600},[1646],{"type":33,"value":807},{"type":24,"tag":550,"props":1648,"children":1649},{"style":639},[1650],{"type":33,"value":1651},"131141\n",{"type":24,"tag":550,"props":1653,"children":1654},{"class":552,"line":691},[1655],{"type":24,"tag":550,"props":1656,"children":1657},{"style":600},[1658],{"type":33,"value":1148},{"type":24,"tag":550,"props":1660,"children":1661},{"class":552,"line":717},[1662,1667,1672,1677],{"type":24,"tag":550,"props":1663,"children":1664},{"style":1487},[1665],{"type":33,"value":1666},"        \"roles\"",{"type":24,"tag":550,"props":1668,"children":1669},{"style":600},[1670],{"type":33,"value":1671},": [",{"type":24,"tag":550,"props":1673,"children":1674},{"style":1518},[1675],{"type":33,"value":1676},"\"539082325061836999\"",{"type":24,"tag":550,"props":1678,"children":1679},{"style":600},[1680],{"type":33,"value":1681},"],\n",{"type":24,"tag":550,"props":1683,"children":1684},{"class":552,"line":725},[1685,1690,1694,1699],{"type":24,"tag":550,"props":1686,"children":1687},{"style":1487},[1688],{"type":33,"value":1689},"        \"premium_since\"",{"type":24,"tag":550,"props":1691,"children":1692},{"style":600},[1693],{"type":33,"value":807},{"type":24,"tag":550,"props":1695,"children":1696},{"style":639},[1697],{"type":33,"value":1698},"null",{"type":24,"tag":550,"props":1700,"children":1701},{"style":600},[1702],{"type":33,"value":817},{"type":24,"tag":550,"props":1704,"children":1705},{"class":552,"line":770},[1706,1711,1715,1720],{"type":24,"tag":550,"props":1707,"children":1708},{"style":1487},[1709],{"type":33,"value":1710},"        \"permissions\"",{"type":24,"tag":550,"props":1712,"children":1713},{"style":600},[1714],{"type":33,"value":807},{"type":24,"tag":550,"props":1716,"children":1717},{"style":1518},[1718],{"type":33,"value":1719},"\"2147483647\"",{"type":24,"tag":550,"props":1721,"children":1722},{"style":600},[1723],{"type":33,"value":817},{"type":24,"tag":550,"props":1725,"children":1726},{"class":552,"line":778},[1727,1732,1736,1741],{"type":24,"tag":550,"props":1728,"children":1729},{"style":1487},[1730],{"type":33,"value":1731},"        \"pending\"",{"type":24,"tag":550,"props":1733,"children":1734},{"style":600},[1735],{"type":33,"value":807},{"type":24,"tag":550,"props":1737,"children":1738},{"style":639},[1739],{"type":33,"value":1740},"false",{"type":24,"tag":550,"props":1742,"children":1743},{"style":600},[1744],{"type":33,"value":817},{"type":24,"tag":550,"props":1746,"children":1747},{"class":552,"line":796},[1748,1753,1757,1761],{"type":24,"tag":550,"props":1749,"children":1750},{"style":1487},[1751],{"type":33,"value":1752},"        \"nick\"",{"type":24,"tag":550,"props":1754,"children":1755},{"style":600},[1756],{"type":33,"value":807},{"type":24,"tag":550,"props":1758,"children":1759},{"style":639},[1760],{"type":33,"value":1698},{"type":24,"tag":550,"props":1762,"children":1763},{"style":600},[1764],{"type":33,"value":817},{"type":24,"tag":550,"props":1766,"children":1767},{"class":552,"line":820},[1768,1773,1777,1781],{"type":24,"tag":550,"props":1769,"children":1770},{"style":1487},[1771],{"type":33,"value":1772},"        \"mute\"",{"type":24,"tag":550,"props":1774,"children":1775},{"style":600},[1776],{"type":33,"value":807},{"type":24,"tag":550,"props":1778,"children":1779},{"style":639},[1780],{"type":33,"value":1740},{"type":24,"tag":550,"props":1782,"children":1783},{"style":600},[1784],{"type":33,"value":817},{"type":24,"tag":550,"props":1786,"children":1787},{"class":552,"line":842},[1788,1793,1797,1802],{"type":24,"tag":550,"props":1789,"children":1790},{"style":1487},[1791],{"type":33,"value":1792},"        \"joined_at\"",{"type":24,"tag":550,"props":1794,"children":1795},{"style":600},[1796],{"type":33,"value":807},{"type":24,"tag":550,"props":1798,"children":1799},{"style":1518},[1800],{"type":33,"value":1801},"\"2017-03-13T19:19:14.040000+00:00\"",{"type":24,"tag":550,"props":1803,"children":1804},{"style":600},[1805],{"type":33,"value":817},{"type":24,"tag":550,"props":1807,"children":1808},{"class":552,"line":856},[1809,1814,1818,1822],{"type":24,"tag":550,"props":1810,"children":1811},{"style":1487},[1812],{"type":33,"value":1813},"        \"is_pending\"",{"type":24,"tag":550,"props":1815,"children":1816},{"style":600},[1817],{"type":33,"value":807},{"type":24,"tag":550,"props":1819,"children":1820},{"style":639},[1821],{"type":33,"value":1740},{"type":24,"tag":550,"props":1823,"children":1824},{"style":600},[1825],{"type":33,"value":817},{"type":24,"tag":550,"props":1827,"children":1828},{"class":552,"line":865},[1829,1834,1838],{"type":24,"tag":550,"props":1830,"children":1831},{"style":1487},[1832],{"type":33,"value":1833},"        \"deaf\"",{"type":24,"tag":550,"props":1835,"children":1836},{"style":600},[1837],{"type":33,"value":807},{"type":24,"tag":550,"props":1839,"children":1840},{"style":639},[1841],{"type":33,"value":1842},"false\n",{"type":24,"tag":550,"props":1844,"children":1845},{"class":552,"line":887},[1846],{"type":24,"tag":550,"props":1847,"children":1848},{"style":600},[1849],{"type":33,"value":1850},"    },\n",{"type":24,"tag":550,"props":1852,"children":1853},{"class":552,"line":909},[1854,1859,1863,1868],{"type":24,"tag":550,"props":1855,"children":1856},{"style":1487},[1857],{"type":33,"value":1858},"    \"id\"",{"type":24,"tag":550,"props":1860,"children":1861},{"style":600},[1862],{"type":33,"value":807},{"type":24,"tag":550,"props":1864,"children":1865},{"style":1518},[1866],{"type":33,"value":1867},"\"786008729715212338\"",{"type":24,"tag":550,"props":1869,"children":1870},{"style":600},[1871],{"type":33,"value":817},{"type":24,"tag":550,"props":1873,"children":1874},{"class":552,"line":931},[1875,1880,1884,1889],{"type":24,"tag":550,"props":1876,"children":1877},{"style":1487},[1878],{"type":33,"value":1879},"    \"guild_id\"",{"type":24,"tag":550,"props":1881,"children":1882},{"style":600},[1883],{"type":33,"value":807},{"type":24,"tag":550,"props":1885,"children":1886},{"style":1518},[1887],{"type":33,"value":1888},"\"290926798626357999\"",{"type":24,"tag":550,"props":1890,"children":1891},{"style":600},[1892],{"type":33,"value":817},{"type":24,"tag":550,"props":1894,"children":1895},{"class":552,"line":953},[1896,1901],{"type":24,"tag":550,"props":1897,"children":1898},{"style":1487},[1899],{"type":33,"value":1900},"    \"data\"",{"type":24,"tag":550,"props":1902,"children":1903},{"style":600},[1904],{"type":33,"value":1538},{"type":24,"tag":550,"props":1906,"children":1907},{"class":552,"line":966},[1908,1913],{"type":24,"tag":550,"props":1909,"children":1910},{"style":1487},[1911],{"type":33,"value":1912},"        \"options\"",{"type":24,"tag":550,"props":1914,"children":1915},{"style":600},[1916],{"type":33,"value":1917},": [{\n",{"type":24,"tag":550,"props":1919,"children":1920},{"class":552,"line":975},[1921,1925,1929,1934],{"type":24,"tag":550,"props":1922,"children":1923},{"style":1487},[1924],{"type":33,"value":871},{"type":24,"tag":550,"props":1926,"children":1927},{"style":600},[1928],{"type":33,"value":807},{"type":24,"tag":550,"props":1930,"children":1931},{"style":1518},[1932],{"type":33,"value":1933},"\"cardname\"",{"type":24,"tag":550,"props":1935,"children":1936},{"style":600},[1937],{"type":33,"value":817},{"type":24,"tag":550,"props":1939,"children":1940},{"class":552,"line":997},[1941,1946,1950],{"type":24,"tag":550,"props":1942,"children":1943},{"style":1487},[1944],{"type":33,"value":1945},"            \"value\"",{"type":24,"tag":550,"props":1947,"children":1948},{"style":600},[1949],{"type":33,"value":807},{"type":24,"tag":550,"props":1951,"children":1952},{"style":1518},[1953],{"type":33,"value":1954},"\"The Gitrog Monster\"\n",{"type":24,"tag":550,"props":1956,"children":1957},{"class":552,"line":1015},[1958],{"type":24,"tag":550,"props":1959,"children":1960},{"style":600},[1961],{"type":33,"value":1962},"        }],\n",{"type":24,"tag":550,"props":1964,"children":1965},{"class":552,"line":1024},[1966,1971,1975,1980],{"type":24,"tag":550,"props":1967,"children":1968},{"style":1487},[1969],{"type":33,"value":1970},"        \"name\"",{"type":24,"tag":550,"props":1972,"children":1973},{"style":600},[1974],{"type":33,"value":807},{"type":24,"tag":550,"props":1976,"children":1977},{"style":1518},[1978],{"type":33,"value":1979},"\"cardsearch\"",{"type":24,"tag":550,"props":1981,"children":1982},{"style":600},[1983],{"type":33,"value":817},{"type":24,"tag":550,"props":1985,"children":1986},{"class":552,"line":1032},[1987,1992,1996],{"type":24,"tag":550,"props":1988,"children":1989},{"style":1487},[1990],{"type":33,"value":1991},"        \"id\"",{"type":24,"tag":550,"props":1993,"children":1994},{"style":600},[1995],{"type":33,"value":807},{"type":24,"tag":550,"props":1997,"children":1998},{"style":1518},[1999],{"type":33,"value":2000},"\"771825006014889984\"\n",{"type":24,"tag":550,"props":2002,"children":2003},{"class":552,"line":1053},[2004],{"type":24,"tag":550,"props":2005,"children":2006},{"style":600},[2007],{"type":33,"value":1850},{"type":24,"tag":550,"props":2009,"children":2010},{"class":552,"line":1070},[2011,2016,2020],{"type":24,"tag":550,"props":2012,"children":2013},{"style":1487},[2014],{"type":33,"value":2015},"    \"channel_id\"",{"type":24,"tag":550,"props":2017,"children":2018},{"style":600},[2019],{"type":33,"value":807},{"type":24,"tag":550,"props":2021,"children":2022},{"style":1518},[2023],{"type":33,"value":2024},"\"645027906669510667\"\n",{"type":24,"tag":550,"props":2026,"children":2027},{"class":552,"line":1078},[2028],{"type":24,"tag":550,"props":2029,"children":2030},{"style":600},[2031],{"type":33,"value":1166},{"type":24,"tag":29,"props":2033,"children":2034},{},[2035,2037,2042,2044,2050],{"type":33,"value":2036},"This ",{"type":24,"tag":64,"props":2038,"children":2040},{"className":2039},[],[2041],{"type":33,"value":184},{"type":33,"value":2043}," request also includes some special headers used for security that we will need to do validation with our handling function. This part can be handled with a decorator provided by the ",{"type":24,"tag":64,"props":2045,"children":2047},{"className":2046},[],[2048],{"type":33,"value":2049},"discord-interactions",{"type":33,"value":2051}," package on PyPI, but we will need to add some additional configuration to our API Gateway endpoint since these headers will not be passed through the lambda by default.",{"type":24,"tag":59,"props":2053,"children":2055},{"id":2054},"setting-up-aws-infrastructure-with-cdk",[2056],{"type":33,"value":2057},"Setting up AWS infrastructure with CDK",{"type":24,"tag":29,"props":2059,"children":2060},{},[2061,2063,2069],{"type":33,"value":2062},"Let's start a CDK project in a blank repository that will define our infrastructure, Lambda functions and CI/CD pipeline with GitLab CI. Make sure that you have the ",{"type":24,"tag":64,"props":2064,"children":2066},{"className":2065},[],[2067],{"type":33,"value":2068},"aws-cdk",{"type":33,"value":2070}," CLI installed globally:",{"type":24,"tag":365,"props":2072,"children":2074},{"code":2073},"npm i -g aws-cdk\n",[2075],{"type":24,"tag":64,"props":2076,"children":2077},{"__ignoreMap":8},[2078],{"type":33,"value":2073},{"type":24,"tag":29,"props":2080,"children":2081},{},[2082,2084,2090],{"type":33,"value":2083},"Then start a CDK project in a subdirectory called ",{"type":24,"tag":64,"props":2085,"children":2087},{"className":2086},[],[2088],{"type":33,"value":2089},"cdk",{"type":33,"value":2091}," with:",{"type":24,"tag":365,"props":2093,"children":2095},{"code":2094},"mkdir cdk && cd cdk && cdk init app --language=python\n",[2096],{"type":24,"tag":64,"props":2097,"children":2098},{"__ignoreMap":8},[2099],{"type":33,"value":2094},{"type":24,"tag":415,"props":2101,"children":2103},{"id":2102},"add-cdk-project-dependencies",[2104],{"type":33,"value":2105},"Add CDK project dependencies",{"type":24,"tag":29,"props":2107,"children":2108},{},[2109,2111,2117],{"type":33,"value":2110},"The next step is to add all of the dependencies to our CDK project that we will use in this project. In ",{"type":24,"tag":64,"props":2112,"children":2114},{"className":2113},[],[2115],{"type":33,"value":2116},"setup.py",{"type":33,"value":2118}," add the following:",{"type":24,"tag":365,"props":2120,"children":2122},{"code":2121,"language":543,"meta":8,"className":544,"style":8},"    install_requires=[\n        \"aws-cdk.core==1.92.0\",\n        \"aws-cdk.aws_applicationautoscaling==1.92.0\",\n        \"aws-cdk.aws_datasync==1.92.0\",\n        \"aws-cdk.aws_lambda==1.92.0\",\n        \"aws-cdk.aws_s3==1.92.0\",\n        \"aws-cdk.aws_apigateway==1.92.0\",\n        \"cdk-valheim==0.0.16\",\n    ],\n",[2123],{"type":24,"tag":64,"props":2124,"children":2125},{"__ignoreMap":8},[2126,2143,2155,2167,2179,2191,2203,2215,2227],{"type":24,"tag":550,"props":2127,"children":2128},{"class":552,"line":553},[2129,2134,2138],{"type":24,"tag":550,"props":2130,"children":2131},{"style":600},[2132],{"type":33,"value":2133},"    install_requires",{"type":24,"tag":550,"props":2135,"children":2136},{"style":594},[2137],{"type":33,"value":736},{"type":24,"tag":550,"props":2139,"children":2140},{"style":600},[2141],{"type":33,"value":2142},"[\n",{"type":24,"tag":550,"props":2144,"children":2145},{"class":552,"line":563},[2146,2151],{"type":24,"tag":550,"props":2147,"children":2148},{"style":557},[2149],{"type":33,"value":2150},"        \"aws-cdk.core==1.92.0\"",{"type":24,"tag":550,"props":2152,"children":2153},{"style":600},[2154],{"type":33,"value":817},{"type":24,"tag":550,"props":2156,"children":2157},{"class":552,"line":572},[2158,2163],{"type":24,"tag":550,"props":2159,"children":2160},{"style":557},[2161],{"type":33,"value":2162},"        \"aws-cdk.aws_applicationautoscaling==1.92.0\"",{"type":24,"tag":550,"props":2164,"children":2165},{"style":600},[2166],{"type":33,"value":817},{"type":24,"tag":550,"props":2168,"children":2169},{"class":552,"line":580},[2170,2175],{"type":24,"tag":550,"props":2171,"children":2172},{"style":557},[2173],{"type":33,"value":2174},"        \"aws-cdk.aws_datasync==1.92.0\"",{"type":24,"tag":550,"props":2176,"children":2177},{"style":600},[2178],{"type":33,"value":817},{"type":24,"tag":550,"props":2180,"children":2181},{"class":552,"line":590},[2182,2187],{"type":24,"tag":550,"props":2183,"children":2184},{"style":557},[2185],{"type":33,"value":2186},"        \"aws-cdk.aws_lambda==1.92.0\"",{"type":24,"tag":550,"props":2188,"children":2189},{"style":600},[2190],{"type":33,"value":817},{"type":24,"tag":550,"props":2192,"children":2193},{"class":552,"line":606},[2194,2199],{"type":24,"tag":550,"props":2195,"children":2196},{"style":557},[2197],{"type":33,"value":2198},"        \"aws-cdk.aws_s3==1.92.0\"",{"type":24,"tag":550,"props":2200,"children":2201},{"style":600},[2202],{"type":33,"value":817},{"type":24,"tag":550,"props":2204,"children":2205},{"class":552,"line":614},[2206,2211],{"type":24,"tag":550,"props":2207,"children":2208},{"style":557},[2209],{"type":33,"value":2210},"        \"aws-cdk.aws_apigateway==1.92.0\"",{"type":24,"tag":550,"props":2212,"children":2213},{"style":600},[2214],{"type":33,"value":817},{"type":24,"tag":550,"props":2216,"children":2217},{"class":552,"line":627},[2218,2223],{"type":24,"tag":550,"props":2219,"children":2220},{"style":557},[2221],{"type":33,"value":2222},"        \"cdk-valheim==0.0.16\"",{"type":24,"tag":550,"props":2224,"children":2225},{"style":600},[2226],{"type":33,"value":817},{"type":24,"tag":550,"props":2228,"children":2229},{"class":552,"line":635},[2230],{"type":24,"tag":550,"props":2231,"children":2232},{"style":600},[2233],{"type":33,"value":2234},"    ],\n",{"type":24,"tag":29,"props":2236,"children":2237},{},[2238,2240,2246,2248,2254,2256,2261],{"type":33,"value":2239},"Next we can add the CDK construct for ",{"type":24,"tag":64,"props":2241,"children":2243},{"className":2242},[],[2244],{"type":33,"value":2245},"ValheimWorld",{"type":33,"value":2247}," in the ",{"type":24,"tag":64,"props":2249,"children":2251},{"className":2250},[],[2252],{"type":33,"value":2253},"cdk_stack.py",{"type":33,"value":2255}," file that was generated in our project as well as the imports for the packages we included in ",{"type":24,"tag":64,"props":2257,"children":2259},{"className":2258},[],[2260],{"type":33,"value":2116},{"type":33,"value":92},{"type":24,"tag":365,"props":2263,"children":2265},{"code":2264,"language":543,"meta":8,"className":544,"style":8},"from aws_cdk import core as cdk\n\nfrom aws_cdk import (\n    core,\n    aws_datasync as datasync,\n    aws_iam as iam,\n    aws_lambda as _lambda,\n    aws_apigateway as apigw,\n    aws_applicationautoscaling as appScaling,\n    aws_s3 as s3,\n)\nfrom cdk_valheim import ValheimWorld, ValheimWorldScalingSchedule\n\n\nclass CdkStack(cdk.Stack):\n\n    def __init__(self, scope: cdk.Construct, construct_id: str, **kwargs) -> None:\n        super().__init__(scope, construct_id, **kwargs)\n        # The code that defines your stack goes here\n        self.valheim_world = ValheimWorld(\n            self,\n            'ValheimWorld',\n            cpu=2048,\n            memory_limit_mib=4096,\n            schedules=[ValheimWorldScalingSchedule(\n                start=appScaling.CronOptions(hour='12', week_day='1-5'),\n                stop=appScaling.CronOptions(hour='1', week_day='1-5'),\n            )],\n            environment={\n                \"SERVER_NAME\": os.environ.get(\"SERVER_NAME\", \"CDK Valheim\"),\n                \"WORLD_NAME\": os.environ.get(\"WORLD_NAME\", \"Amazon\"),\n                \"SERVER_PASS\": os.environ.get(\"SERVER_PASS\", \"fargate\"),\n                \"BACKUPS\": 'false',\n            })\n",[2266],{"type":24,"tag":64,"props":2267,"children":2268},{"__ignoreMap":8},[2269,2301,2308,2328,2336,2353,2370,2387,2404,2421,2438,2445,2466,2473,2480,2518,2525,2604,2636,2645,2668,2680,2692,2713,2734,2751,2805,2854,2862,2878,2909,2939,2969,2990],{"type":24,"tag":550,"props":2270,"children":2271},{"class":552,"line":553},[2272,2277,2282,2286,2291,2296],{"type":24,"tag":550,"props":2273,"children":2274},{"style":594},[2275],{"type":33,"value":2276},"from",{"type":24,"tag":550,"props":2278,"children":2279},{"style":600},[2280],{"type":33,"value":2281}," aws_cdk ",{"type":24,"tag":550,"props":2283,"children":2284},{"style":594},[2285],{"type":33,"value":597},{"type":24,"tag":550,"props":2287,"children":2288},{"style":600},[2289],{"type":33,"value":2290}," core ",{"type":24,"tag":550,"props":2292,"children":2293},{"style":594},[2294],{"type":33,"value":2295},"as",{"type":24,"tag":550,"props":2297,"children":2298},{"style":600},[2299],{"type":33,"value":2300}," cdk\n",{"type":24,"tag":550,"props":2302,"children":2303},{"class":552,"line":563},[2304],{"type":24,"tag":550,"props":2305,"children":2306},{"emptyLinePlaceholder":584},[2307],{"type":33,"value":587},{"type":24,"tag":550,"props":2309,"children":2310},{"class":552,"line":572},[2311,2315,2319,2323],{"type":24,"tag":550,"props":2312,"children":2313},{"style":594},[2314],{"type":33,"value":2276},{"type":24,"tag":550,"props":2316,"children":2317},{"style":600},[2318],{"type":33,"value":2281},{"type":24,"tag":550,"props":2320,"children":2321},{"style":594},[2322],{"type":33,"value":597},{"type":24,"tag":550,"props":2324,"children":2325},{"style":600},[2326],{"type":33,"value":2327}," (\n",{"type":24,"tag":550,"props":2329,"children":2330},{"class":552,"line":580},[2331],{"type":24,"tag":550,"props":2332,"children":2333},{"style":600},[2334],{"type":33,"value":2335},"    core,\n",{"type":24,"tag":550,"props":2337,"children":2338},{"class":552,"line":590},[2339,2344,2348],{"type":24,"tag":550,"props":2340,"children":2341},{"style":600},[2342],{"type":33,"value":2343},"    aws_datasync ",{"type":24,"tag":550,"props":2345,"children":2346},{"style":594},[2347],{"type":33,"value":2295},{"type":24,"tag":550,"props":2349,"children":2350},{"style":600},[2351],{"type":33,"value":2352}," datasync,\n",{"type":24,"tag":550,"props":2354,"children":2355},{"class":552,"line":606},[2356,2361,2365],{"type":24,"tag":550,"props":2357,"children":2358},{"style":600},[2359],{"type":33,"value":2360},"    aws_iam ",{"type":24,"tag":550,"props":2362,"children":2363},{"style":594},[2364],{"type":33,"value":2295},{"type":24,"tag":550,"props":2366,"children":2367},{"style":600},[2368],{"type":33,"value":2369}," iam,\n",{"type":24,"tag":550,"props":2371,"children":2372},{"class":552,"line":614},[2373,2378,2382],{"type":24,"tag":550,"props":2374,"children":2375},{"style":600},[2376],{"type":33,"value":2377},"    aws_lambda ",{"type":24,"tag":550,"props":2379,"children":2380},{"style":594},[2381],{"type":33,"value":2295},{"type":24,"tag":550,"props":2383,"children":2384},{"style":600},[2385],{"type":33,"value":2386}," _lambda,\n",{"type":24,"tag":550,"props":2388,"children":2389},{"class":552,"line":627},[2390,2395,2399],{"type":24,"tag":550,"props":2391,"children":2392},{"style":600},[2393],{"type":33,"value":2394},"    aws_apigateway ",{"type":24,"tag":550,"props":2396,"children":2397},{"style":594},[2398],{"type":33,"value":2295},{"type":24,"tag":550,"props":2400,"children":2401},{"style":600},[2402],{"type":33,"value":2403}," apigw,\n",{"type":24,"tag":550,"props":2405,"children":2406},{"class":552,"line":635},[2407,2412,2416],{"type":24,"tag":550,"props":2408,"children":2409},{"style":600},[2410],{"type":33,"value":2411},"    aws_applicationautoscaling ",{"type":24,"tag":550,"props":2413,"children":2414},{"style":594},[2415],{"type":33,"value":2295},{"type":24,"tag":550,"props":2417,"children":2418},{"style":600},[2419],{"type":33,"value":2420}," appScaling,\n",{"type":24,"tag":550,"props":2422,"children":2423},{"class":552,"line":665},[2424,2429,2433],{"type":24,"tag":550,"props":2425,"children":2426},{"style":600},[2427],{"type":33,"value":2428},"    aws_s3 ",{"type":24,"tag":550,"props":2430,"children":2431},{"style":594},[2432],{"type":33,"value":2295},{"type":24,"tag":550,"props":2434,"children":2435},{"style":600},[2436],{"type":33,"value":2437}," s3,\n",{"type":24,"tag":550,"props":2439,"children":2440},{"class":552,"line":691},[2441],{"type":24,"tag":550,"props":2442,"children":2443},{"style":600},[2444],{"type":33,"value":662},{"type":24,"tag":550,"props":2446,"children":2447},{"class":552,"line":717},[2448,2452,2457,2461],{"type":24,"tag":550,"props":2449,"children":2450},{"style":594},[2451],{"type":33,"value":2276},{"type":24,"tag":550,"props":2453,"children":2454},{"style":600},[2455],{"type":33,"value":2456}," cdk_valheim ",{"type":24,"tag":550,"props":2458,"children":2459},{"style":594},[2460],{"type":33,"value":597},{"type":24,"tag":550,"props":2462,"children":2463},{"style":600},[2464],{"type":33,"value":2465}," ValheimWorld, ValheimWorldScalingSchedule\n",{"type":24,"tag":550,"props":2467,"children":2468},{"class":552,"line":725},[2469],{"type":24,"tag":550,"props":2470,"children":2471},{"emptyLinePlaceholder":584},[2472],{"type":33,"value":587},{"type":24,"tag":550,"props":2474,"children":2475},{"class":552,"line":770},[2476],{"type":24,"tag":550,"props":2477,"children":2478},{"emptyLinePlaceholder":584},[2479],{"type":33,"value":587},{"type":24,"tag":550,"props":2481,"children":2482},{"class":552,"line":778},[2483,2488,2494,2499,2504,2508,2513],{"type":24,"tag":550,"props":2484,"children":2485},{"style":739},[2486],{"type":33,"value":2487},"class",{"type":24,"tag":550,"props":2489,"children":2491},{"style":2490},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[2492],{"type":33,"value":2493}," CdkStack",{"type":24,"tag":550,"props":2495,"children":2496},{"style":600},[2497],{"type":33,"value":2498},"(",{"type":24,"tag":550,"props":2500,"children":2502},{"style":2501},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[2503],{"type":33,"value":2089},{"type":24,"tag":550,"props":2505,"children":2506},{"style":600},[2507],{"type":33,"value":173},{"type":24,"tag":550,"props":2509,"children":2510},{"style":2501},[2511],{"type":33,"value":2512},"Stack",{"type":24,"tag":550,"props":2514,"children":2515},{"style":600},[2516],{"type":33,"value":2517},"):\n",{"type":24,"tag":550,"props":2519,"children":2520},{"class":552,"line":796},[2521],{"type":24,"tag":550,"props":2522,"children":2523},{"emptyLinePlaceholder":584},[2524],{"type":33,"value":587},{"type":24,"tag":550,"props":2526,"children":2527},{"class":552,"line":820},[2528,2533,2538,2542,2548,2552,2557,2562,2567,2571,2576,2580,2585,2590,2595,2600],{"type":24,"tag":550,"props":2529,"children":2530},{"style":739},[2531],{"type":33,"value":2532},"    def",{"type":24,"tag":550,"props":2534,"children":2535},{"style":1324},[2536],{"type":33,"value":2537}," __init__",{"type":24,"tag":550,"props":2539,"children":2540},{"style":600},[2541],{"type":33,"value":2498},{"type":24,"tag":550,"props":2543,"children":2545},{"style":2544},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[2546],{"type":33,"value":2547},"self",{"type":24,"tag":550,"props":2549,"children":2550},{"style":600},[2551],{"type":33,"value":237},{"type":24,"tag":550,"props":2553,"children":2554},{"style":2544},[2555],{"type":33,"value":2556},"scope",{"type":24,"tag":550,"props":2558,"children":2559},{"style":600},[2560],{"type":33,"value":2561},": cdk.Construct, ",{"type":24,"tag":550,"props":2563,"children":2564},{"style":2544},[2565],{"type":33,"value":2566},"construct_id",{"type":24,"tag":550,"props":2568,"children":2569},{"style":600},[2570],{"type":33,"value":807},{"type":24,"tag":550,"props":2572,"children":2573},{"style":1487},[2574],{"type":33,"value":2575},"str",{"type":24,"tag":550,"props":2577,"children":2578},{"style":600},[2579],{"type":33,"value":237},{"type":24,"tag":550,"props":2581,"children":2582},{"style":594},[2583],{"type":33,"value":2584},"**",{"type":24,"tag":550,"props":2586,"children":2587},{"style":2544},[2588],{"type":33,"value":2589},"kwargs",{"type":24,"tag":550,"props":2591,"children":2592},{"style":600},[2593],{"type":33,"value":2594},") -> ",{"type":24,"tag":550,"props":2596,"children":2597},{"style":639},[2598],{"type":33,"value":2599},"None",{"type":24,"tag":550,"props":2601,"children":2602},{"style":600},[2603],{"type":33,"value":1270},{"type":24,"tag":550,"props":2605,"children":2606},{"class":552,"line":842},[2607,2612,2617,2622,2627,2631],{"type":24,"tag":550,"props":2608,"children":2609},{"style":1487},[2610],{"type":33,"value":2611},"        super",{"type":24,"tag":550,"props":2613,"children":2614},{"style":600},[2615],{"type":33,"value":2616},"().",{"type":24,"tag":550,"props":2618,"children":2619},{"style":1324},[2620],{"type":33,"value":2621},"__init__",{"type":24,"tag":550,"props":2623,"children":2624},{"style":600},[2625],{"type":33,"value":2626},"(scope, construct_id, ",{"type":24,"tag":550,"props":2628,"children":2629},{"style":594},[2630],{"type":33,"value":2584},{"type":24,"tag":550,"props":2632,"children":2633},{"style":600},[2634],{"type":33,"value":2635},"kwargs)\n",{"type":24,"tag":550,"props":2637,"children":2638},{"class":552,"line":856},[2639],{"type":24,"tag":550,"props":2640,"children":2642},{"style":2641},"--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F",[2643],{"type":33,"value":2644},"        # The code that defines your stack goes here\n",{"type":24,"tag":550,"props":2646,"children":2647},{"class":552,"line":865},[2648,2654,2659,2663],{"type":24,"tag":550,"props":2649,"children":2651},{"style":2650},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2652],{"type":33,"value":2653},"        self",{"type":24,"tag":550,"props":2655,"children":2656},{"style":600},[2657],{"type":33,"value":2658},".valheim_world ",{"type":24,"tag":550,"props":2660,"children":2661},{"style":594},[2662],{"type":33,"value":736},{"type":24,"tag":550,"props":2664,"children":2665},{"style":600},[2666],{"type":33,"value":2667}," ValheimWorld(\n",{"type":24,"tag":550,"props":2669,"children":2670},{"class":552,"line":887},[2671,2676],{"type":24,"tag":550,"props":2672,"children":2673},{"style":2650},[2674],{"type":33,"value":2675},"            self",{"type":24,"tag":550,"props":2677,"children":2678},{"style":600},[2679],{"type":33,"value":817},{"type":24,"tag":550,"props":2681,"children":2682},{"class":552,"line":909},[2683,2688],{"type":24,"tag":550,"props":2684,"children":2685},{"style":557},[2686],{"type":33,"value":2687},"            'ValheimWorld'",{"type":24,"tag":550,"props":2689,"children":2690},{"style":600},[2691],{"type":33,"value":817},{"type":24,"tag":550,"props":2693,"children":2694},{"class":552,"line":931},[2695,2700,2704,2709],{"type":24,"tag":550,"props":2696,"children":2697},{"style":1291},[2698],{"type":33,"value":2699},"            cpu",{"type":24,"tag":550,"props":2701,"children":2702},{"style":594},[2703],{"type":33,"value":736},{"type":24,"tag":550,"props":2705,"children":2706},{"style":639},[2707],{"type":33,"value":2708},"2048",{"type":24,"tag":550,"props":2710,"children":2711},{"style":600},[2712],{"type":33,"value":817},{"type":24,"tag":550,"props":2714,"children":2715},{"class":552,"line":953},[2716,2721,2725,2730],{"type":24,"tag":550,"props":2717,"children":2718},{"style":1291},[2719],{"type":33,"value":2720},"            memory_limit_mib",{"type":24,"tag":550,"props":2722,"children":2723},{"style":594},[2724],{"type":33,"value":736},{"type":24,"tag":550,"props":2726,"children":2727},{"style":639},[2728],{"type":33,"value":2729},"4096",{"type":24,"tag":550,"props":2731,"children":2732},{"style":600},[2733],{"type":33,"value":817},{"type":24,"tag":550,"props":2735,"children":2736},{"class":552,"line":966},[2737,2742,2746],{"type":24,"tag":550,"props":2738,"children":2739},{"style":1291},[2740],{"type":33,"value":2741},"            schedules",{"type":24,"tag":550,"props":2743,"children":2744},{"style":594},[2745],{"type":33,"value":736},{"type":24,"tag":550,"props":2747,"children":2748},{"style":600},[2749],{"type":33,"value":2750},"[ValheimWorldScalingSchedule(\n",{"type":24,"tag":550,"props":2752,"children":2753},{"class":552,"line":975},[2754,2759,2763,2768,2773,2777,2782,2786,2791,2795,2800],{"type":24,"tag":550,"props":2755,"children":2756},{"style":1291},[2757],{"type":33,"value":2758},"                start",{"type":24,"tag":550,"props":2760,"children":2761},{"style":594},[2762],{"type":33,"value":736},{"type":24,"tag":550,"props":2764,"children":2765},{"style":600},[2766],{"type":33,"value":2767},"appScaling.CronOptions(",{"type":24,"tag":550,"props":2769,"children":2770},{"style":1291},[2771],{"type":33,"value":2772},"hour",{"type":24,"tag":550,"props":2774,"children":2775},{"style":594},[2776],{"type":33,"value":736},{"type":24,"tag":550,"props":2778,"children":2779},{"style":557},[2780],{"type":33,"value":2781},"'12'",{"type":24,"tag":550,"props":2783,"children":2784},{"style":600},[2785],{"type":33,"value":237},{"type":24,"tag":550,"props":2787,"children":2788},{"style":1291},[2789],{"type":33,"value":2790},"week_day",{"type":24,"tag":550,"props":2792,"children":2793},{"style":594},[2794],{"type":33,"value":736},{"type":24,"tag":550,"props":2796,"children":2797},{"style":557},[2798],{"type":33,"value":2799},"'1-5'",{"type":24,"tag":550,"props":2801,"children":2802},{"style":600},[2803],{"type":33,"value":2804},"),\n",{"type":24,"tag":550,"props":2806,"children":2807},{"class":552,"line":997},[2808,2813,2817,2821,2825,2829,2834,2838,2842,2846,2850],{"type":24,"tag":550,"props":2809,"children":2810},{"style":1291},[2811],{"type":33,"value":2812},"                stop",{"type":24,"tag":550,"props":2814,"children":2815},{"style":594},[2816],{"type":33,"value":736},{"type":24,"tag":550,"props":2818,"children":2819},{"style":600},[2820],{"type":33,"value":2767},{"type":24,"tag":550,"props":2822,"children":2823},{"style":1291},[2824],{"type":33,"value":2772},{"type":24,"tag":550,"props":2826,"children":2827},{"style":594},[2828],{"type":33,"value":736},{"type":24,"tag":550,"props":2830,"children":2831},{"style":557},[2832],{"type":33,"value":2833},"'1'",{"type":24,"tag":550,"props":2835,"children":2836},{"style":600},[2837],{"type":33,"value":237},{"type":24,"tag":550,"props":2839,"children":2840},{"style":1291},[2841],{"type":33,"value":2790},{"type":24,"tag":550,"props":2843,"children":2844},{"style":594},[2845],{"type":33,"value":736},{"type":24,"tag":550,"props":2847,"children":2848},{"style":557},[2849],{"type":33,"value":2799},{"type":24,"tag":550,"props":2851,"children":2852},{"style":600},[2853],{"type":33,"value":2804},{"type":24,"tag":550,"props":2855,"children":2856},{"class":552,"line":1015},[2857],{"type":24,"tag":550,"props":2858,"children":2859},{"style":600},[2860],{"type":33,"value":2861},"            )],\n",{"type":24,"tag":550,"props":2863,"children":2864},{"class":552,"line":1024},[2865,2870,2874],{"type":24,"tag":550,"props":2866,"children":2867},{"style":1291},[2868],{"type":33,"value":2869},"            environment",{"type":24,"tag":550,"props":2871,"children":2872},{"style":594},[2873],{"type":33,"value":736},{"type":24,"tag":550,"props":2875,"children":2876},{"style":600},[2877],{"type":33,"value":1481},{"type":24,"tag":550,"props":2879,"children":2880},{"class":552,"line":1032},[2881,2886,2891,2896,2900,2905],{"type":24,"tag":550,"props":2882,"children":2883},{"style":557},[2884],{"type":33,"value":2885},"                \"SERVER_NAME\"",{"type":24,"tag":550,"props":2887,"children":2888},{"style":600},[2889],{"type":33,"value":2890},": os.environ.get(",{"type":24,"tag":550,"props":2892,"children":2893},{"style":557},[2894],{"type":33,"value":2895},"\"SERVER_NAME\"",{"type":24,"tag":550,"props":2897,"children":2898},{"style":600},[2899],{"type":33,"value":237},{"type":24,"tag":550,"props":2901,"children":2902},{"style":557},[2903],{"type":33,"value":2904},"\"CDK Valheim\"",{"type":24,"tag":550,"props":2906,"children":2907},{"style":600},[2908],{"type":33,"value":2804},{"type":24,"tag":550,"props":2910,"children":2911},{"class":552,"line":1053},[2912,2917,2921,2926,2930,2935],{"type":24,"tag":550,"props":2913,"children":2914},{"style":557},[2915],{"type":33,"value":2916},"                \"WORLD_NAME\"",{"type":24,"tag":550,"props":2918,"children":2919},{"style":600},[2920],{"type":33,"value":2890},{"type":24,"tag":550,"props":2922,"children":2923},{"style":557},[2924],{"type":33,"value":2925},"\"WORLD_NAME\"",{"type":24,"tag":550,"props":2927,"children":2928},{"style":600},[2929],{"type":33,"value":237},{"type":24,"tag":550,"props":2931,"children":2932},{"style":557},[2933],{"type":33,"value":2934},"\"Amazon\"",{"type":24,"tag":550,"props":2936,"children":2937},{"style":600},[2938],{"type":33,"value":2804},{"type":24,"tag":550,"props":2940,"children":2941},{"class":552,"line":1070},[2942,2947,2951,2956,2960,2965],{"type":24,"tag":550,"props":2943,"children":2944},{"style":557},[2945],{"type":33,"value":2946},"                \"SERVER_PASS\"",{"type":24,"tag":550,"props":2948,"children":2949},{"style":600},[2950],{"type":33,"value":2890},{"type":24,"tag":550,"props":2952,"children":2953},{"style":557},[2954],{"type":33,"value":2955},"\"SERVER_PASS\"",{"type":24,"tag":550,"props":2957,"children":2958},{"style":600},[2959],{"type":33,"value":237},{"type":24,"tag":550,"props":2961,"children":2962},{"style":557},[2963],{"type":33,"value":2964},"\"fargate\"",{"type":24,"tag":550,"props":2966,"children":2967},{"style":600},[2968],{"type":33,"value":2804},{"type":24,"tag":550,"props":2970,"children":2971},{"class":552,"line":1078},[2972,2977,2981,2986],{"type":24,"tag":550,"props":2973,"children":2974},{"style":557},[2975],{"type":33,"value":2976},"                \"BACKUPS\"",{"type":24,"tag":550,"props":2978,"children":2979},{"style":600},[2980],{"type":33,"value":807},{"type":24,"tag":550,"props":2982,"children":2983},{"style":557},[2984],{"type":33,"value":2985},"'false'",{"type":24,"tag":550,"props":2987,"children":2988},{"style":600},[2989],{"type":33,"value":817},{"type":24,"tag":550,"props":2991,"children":2992},{"class":552,"line":1086},[2993],{"type":24,"tag":550,"props":2994,"children":2995},{"style":600},[2996],{"type":33,"value":2997},"            })\n",{"type":24,"tag":29,"props":2999,"children":3000},{},[3001,3003,3008],{"type":33,"value":3002},"We are almost ready to deploy a basic version of our Valheim server using the ",{"type":24,"tag":64,"props":3004,"children":3006},{"className":3005},[],[3007],{"type":33,"value":69},{"type":33,"value":3009}," construct. If we were to run the following command:",{"type":24,"tag":365,"props":3011,"children":3013},{"code":3012},"cdk deploy --app cdk/app.py --require-approval never\n",[3014],{"type":24,"tag":64,"props":3015,"children":3016},{"__ignoreMap":8},[3017],{"type":33,"value":3012},{"type":24,"tag":29,"props":3019,"children":3020},{},[3021,3023,3029],{"type":33,"value":3022},"from the root of our project, it should work. This assumes that we have default credentials configured in ",{"type":24,"tag":64,"props":3024,"children":3026},{"className":3025},[],[3027],{"type":33,"value":3028},"~/.aws/credentials",{"type":33,"value":3030}," and that we have also bootstrapped our AWS account with the resources it needs for CDK to work:",{"type":24,"tag":365,"props":3032,"children":3034},{"code":3033},"cdk bootstrap --app cdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n",[3035],{"type":24,"tag":64,"props":3036,"children":3037},{"__ignoreMap":8},[3038],{"type":33,"value":3033},{"type":24,"tag":415,"props":3040,"children":3042},{"id":3041},"setup-gitlab-ci-job-for-automated-deployments",[3043],{"type":33,"value":3044},"Setup GitLab CI job for automated deployments",{"type":24,"tag":29,"props":3046,"children":3047},{},[3048,3050,3056],{"type":33,"value":3049},"Instead of deploying from the command line, it would be better to run the deployment from a CI/CD pipeline. Add a ",{"type":24,"tag":64,"props":3051,"children":3053},{"className":3052},[],[3054],{"type":33,"value":3055},".gitlab-ci.yml",{"type":33,"value":3057}," file to the root of your project and populate it with the following YAML:",{"type":24,"tag":365,"props":3059,"children":3063},{"code":3060,"language":3061,"meta":8,"className":3062,"style":8},"stages:\n  - deploy\n\nimage: python:3.8\n\ncdk_deploy:\n  stage: deploy\n  rules:\n    - if: \"$CI_COMMIT_TAG\"\n      when: always\n  before_script:\n    - apt-get -qq update && apt-get -y install nodejs npm\n    - npm i -g aws-cdk\n    - pip3 install -e cdk\n  script:\n    - cdk bootstrap --app cdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n    - cdk deploy --app cdk/app.py --require-approval never\n","yaml","language-yaml shiki shiki-themes github-light github-dark monokai",[3064],{"type":24,"tag":64,"props":3065,"children":3066},{"__ignoreMap":8},[3067,3080,3093,3100,3117,3124,3136,3152,3164,3185,3202,3214,3226,3237,3249,3261,3272],{"type":24,"tag":550,"props":3068,"children":3069},{"class":552,"line":553},[3070,3076],{"type":24,"tag":550,"props":3071,"children":3073},{"style":3072},"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[3074],{"type":33,"value":3075},"stages",{"type":24,"tag":550,"props":3077,"children":3078},{"style":600},[3079],{"type":33,"value":1270},{"type":24,"tag":550,"props":3081,"children":3082},{"class":552,"line":563},[3083,3088],{"type":24,"tag":550,"props":3084,"children":3085},{"style":600},[3086],{"type":33,"value":3087},"  - ",{"type":24,"tag":550,"props":3089,"children":3090},{"style":557},[3091],{"type":33,"value":3092},"deploy\n",{"type":24,"tag":550,"props":3094,"children":3095},{"class":552,"line":572},[3096],{"type":24,"tag":550,"props":3097,"children":3098},{"emptyLinePlaceholder":584},[3099],{"type":33,"value":587},{"type":24,"tag":550,"props":3101,"children":3102},{"class":552,"line":580},[3103,3108,3112],{"type":24,"tag":550,"props":3104,"children":3105},{"style":3072},[3106],{"type":33,"value":3107},"image",{"type":24,"tag":550,"props":3109,"children":3110},{"style":600},[3111],{"type":33,"value":807},{"type":24,"tag":550,"props":3113,"children":3114},{"style":557},[3115],{"type":33,"value":3116},"python:3.8\n",{"type":24,"tag":550,"props":3118,"children":3119},{"class":552,"line":590},[3120],{"type":24,"tag":550,"props":3121,"children":3122},{"emptyLinePlaceholder":584},[3123],{"type":33,"value":587},{"type":24,"tag":550,"props":3125,"children":3126},{"class":552,"line":606},[3127,3132],{"type":24,"tag":550,"props":3128,"children":3129},{"style":3072},[3130],{"type":33,"value":3131},"cdk_deploy",{"type":24,"tag":550,"props":3133,"children":3134},{"style":600},[3135],{"type":33,"value":1270},{"type":24,"tag":550,"props":3137,"children":3138},{"class":552,"line":614},[3139,3144,3148],{"type":24,"tag":550,"props":3140,"children":3141},{"style":3072},[3142],{"type":33,"value":3143},"  stage",{"type":24,"tag":550,"props":3145,"children":3146},{"style":600},[3147],{"type":33,"value":807},{"type":24,"tag":550,"props":3149,"children":3150},{"style":557},[3151],{"type":33,"value":3092},{"type":24,"tag":550,"props":3153,"children":3154},{"class":552,"line":627},[3155,3160],{"type":24,"tag":550,"props":3156,"children":3157},{"style":3072},[3158],{"type":33,"value":3159},"  rules",{"type":24,"tag":550,"props":3161,"children":3162},{"style":600},[3163],{"type":33,"value":1270},{"type":24,"tag":550,"props":3165,"children":3166},{"class":552,"line":635},[3167,3172,3176,3180],{"type":24,"tag":550,"props":3168,"children":3169},{"style":600},[3170],{"type":33,"value":3171},"    - ",{"type":24,"tag":550,"props":3173,"children":3174},{"style":3072},[3175],{"type":33,"value":1249},{"type":24,"tag":550,"props":3177,"children":3178},{"style":600},[3179],{"type":33,"value":807},{"type":24,"tag":550,"props":3181,"children":3182},{"style":557},[3183],{"type":33,"value":3184},"\"$CI_COMMIT_TAG\"\n",{"type":24,"tag":550,"props":3186,"children":3187},{"class":552,"line":665},[3188,3193,3197],{"type":24,"tag":550,"props":3189,"children":3190},{"style":3072},[3191],{"type":33,"value":3192},"      when",{"type":24,"tag":550,"props":3194,"children":3195},{"style":600},[3196],{"type":33,"value":807},{"type":24,"tag":550,"props":3198,"children":3199},{"style":557},[3200],{"type":33,"value":3201},"always\n",{"type":24,"tag":550,"props":3203,"children":3204},{"class":552,"line":691},[3205,3210],{"type":24,"tag":550,"props":3206,"children":3207},{"style":3072},[3208],{"type":33,"value":3209},"  before_script",{"type":24,"tag":550,"props":3211,"children":3212},{"style":600},[3213],{"type":33,"value":1270},{"type":24,"tag":550,"props":3215,"children":3216},{"class":552,"line":717},[3217,3221],{"type":24,"tag":550,"props":3218,"children":3219},{"style":600},[3220],{"type":33,"value":3171},{"type":24,"tag":550,"props":3222,"children":3223},{"style":557},[3224],{"type":33,"value":3225},"apt-get -qq update && apt-get -y install nodejs npm\n",{"type":24,"tag":550,"props":3227,"children":3228},{"class":552,"line":725},[3229,3233],{"type":24,"tag":550,"props":3230,"children":3231},{"style":600},[3232],{"type":33,"value":3171},{"type":24,"tag":550,"props":3234,"children":3235},{"style":557},[3236],{"type":33,"value":2073},{"type":24,"tag":550,"props":3238,"children":3239},{"class":552,"line":770},[3240,3244],{"type":24,"tag":550,"props":3241,"children":3242},{"style":600},[3243],{"type":33,"value":3171},{"type":24,"tag":550,"props":3245,"children":3246},{"style":557},[3247],{"type":33,"value":3248},"pip3 install -e cdk\n",{"type":24,"tag":550,"props":3250,"children":3251},{"class":552,"line":778},[3252,3257],{"type":24,"tag":550,"props":3253,"children":3254},{"style":3072},[3255],{"type":33,"value":3256},"  script",{"type":24,"tag":550,"props":3258,"children":3259},{"style":600},[3260],{"type":33,"value":1270},{"type":24,"tag":550,"props":3262,"children":3263},{"class":552,"line":796},[3264,3268],{"type":24,"tag":550,"props":3265,"children":3266},{"style":600},[3267],{"type":33,"value":3171},{"type":24,"tag":550,"props":3269,"children":3270},{"style":557},[3271],{"type":33,"value":3033},{"type":24,"tag":550,"props":3273,"children":3274},{"class":552,"line":820},[3275,3279],{"type":24,"tag":550,"props":3276,"children":3277},{"style":600},[3278],{"type":33,"value":3171},{"type":24,"tag":550,"props":3280,"children":3281},{"style":557},[3282],{"type":33,"value":3012},{"type":24,"tag":29,"props":3284,"children":3285},{},[3286,3288,3294,3296,3302,3304,3310],{"type":33,"value":3287},"Before we initialize a git repository in the root directory of our project, remove the ",{"type":24,"tag":64,"props":3289,"children":3291},{"className":3290},[],[3292],{"type":33,"value":3293},".git",{"type":33,"value":3295}," repo that CDK created when we initialized the project with ",{"type":24,"tag":64,"props":3297,"children":3299},{"className":3298},[],[3300],{"type":33,"value":3301},"rf -rf cdk/.git",{"type":33,"value":3303},". Now initialized a project in the root directory with ",{"type":24,"tag":64,"props":3305,"children":3307},{"className":3306},[],[3308],{"type":33,"value":3309},"git init",{"type":33,"value":173},{"type":24,"tag":29,"props":3312,"children":3313},{},[3314],{"type":33,"value":3315},"Next, create a GitLab repository and add the remote to this project with:",{"type":24,"tag":365,"props":3317,"children":3319},{"code":3318},"git remote add origin git@gitlab.com:gitlab-username/project-name.git\n",[3320],{"type":24,"tag":64,"props":3321,"children":3322},{"__ignoreMap":8},[3323],{"type":33,"value":3318},{"type":24,"tag":29,"props":3325,"children":3326},{},[3327,3329,3335],{"type":33,"value":3328},"In the GitLab project's ",{"type":24,"tag":64,"props":3330,"children":3332},{"className":3331},[],[3333],{"type":33,"value":3334},"Settings > CI/CD > Variables",{"type":33,"value":3336}," section, add the following environment variables as protected variables:",{"type":24,"tag":120,"props":3338,"children":3339},{},[3340,3349,3358,3367,3376,3385,3394,3403],{"type":24,"tag":124,"props":3341,"children":3342},{},[3343],{"type":24,"tag":64,"props":3344,"children":3346},{"className":3345},[],[3347],{"type":33,"value":3348},"AWS_ACCESS_KEY_ID",{"type":24,"tag":124,"props":3350,"children":3351},{},[3352],{"type":24,"tag":64,"props":3353,"children":3355},{"className":3354},[],[3356],{"type":33,"value":3357},"AWS_SECRET_ACCESS_KEY",{"type":24,"tag":124,"props":3359,"children":3360},{},[3361],{"type":24,"tag":64,"props":3362,"children":3364},{"className":3363},[],[3365],{"type":33,"value":3366},"AWS_DEFAULT_REGION",{"type":24,"tag":124,"props":3368,"children":3369},{},[3370],{"type":24,"tag":64,"props":3371,"children":3373},{"className":3372},[],[3374],{"type":33,"value":3375},"AWS_ACCOUNT_ID",{"type":24,"tag":124,"props":3377,"children":3378},{},[3379],{"type":24,"tag":64,"props":3380,"children":3382},{"className":3381},[],[3383],{"type":33,"value":3384},"APPLICATION_PUBLIC_KEY",{"type":24,"tag":124,"props":3386,"children":3387},{},[3388],{"type":24,"tag":64,"props":3389,"children":3391},{"className":3390},[],[3392],{"type":33,"value":3393},"SERVER_PASS",{"type":24,"tag":124,"props":3395,"children":3396},{},[3397],{"type":24,"tag":64,"props":3398,"children":3400},{"className":3399},[],[3401],{"type":33,"value":3402},"SERVER_NAME",{"type":24,"tag":124,"props":3404,"children":3405},{},[3406],{"type":24,"tag":64,"props":3407,"children":3409},{"className":3408},[],[3410],{"type":33,"value":3411},"WORLD_NAME",{"type":24,"tag":29,"props":3413,"children":3414},{},[3415,3417,3423,3425,3431],{"type":33,"value":3416},"Now under ",{"type":24,"tag":64,"props":3418,"children":3420},{"className":3419},[],[3421],{"type":33,"value":3422},"Settings > Repository > Protected Tags",{"type":33,"value":3424},", add a wildcard (",{"type":24,"tag":64,"props":3426,"children":3428},{"className":3427},[],[3429],{"type":33,"value":3430},"*",{"type":33,"value":3432},") so that all tags are protected and only maintainers can push tags. This allows us to use the protected environment variables only when a trusted maintainer pushes a tag to the repository.",{"type":24,"tag":415,"props":3434,"children":3436},{"id":3435},"edit-the-name-of-the-stack-and-add-region-and-account-info",[3437],{"type":33,"value":3438},"Edit the name of the stack and add region and account info",{"type":24,"tag":29,"props":3440,"children":3441},{},[3442,3444,3450],{"type":33,"value":3443},"We are almost ready to create a tag and push to GitLab, but before we do that let's change the name of the CloudFormation stack that CDK will create in ",{"type":24,"tag":64,"props":3445,"children":3447},{"className":3446},[],[3448],{"type":33,"value":3449},"cdk/app.py",{"type":33,"value":92},{"type":24,"tag":365,"props":3452,"children":3454},{"code":3453,"language":543,"meta":8,"className":544,"style":8},"#!/usr/bin/env python3\n\nimport os\n\nfrom aws_cdk import core as cdk\n\n# For consistency with TypeScript code, `cdk` is the preferred import name for\n# the CDK's core module.  The following line also imports it as `core` for use\n# with examples from the CDK Developer's Guide, which are in the process of\n# being updated to use `cdk`.  You may delete this import if you don't need it.\nfrom aws_cdk import core\n\nfrom cdk.cdk_stack import CdkStack\n\naws_region = os.environ.get(\"AWS_DEFAULT_REGION\", \"us-east-1\")\naws_account = os.environ.get(\"AWS_ACCOUNT_ID\", \"\")\n\n\napp = cdk.App()\nCdkStack(\n    app,\n    \"valheim-server-stack\",\n    env={\"region\": aws_region, \"account\": aws_account}\n)\n\napp.synth()\n",[3455],{"type":24,"tag":64,"props":3456,"children":3457},{"__ignoreMap":8},[3458,3466,3473,3484,3491,3518,3525,3533,3541,3549,3557,3577,3584,3605,3612,3646,3680,3687,3694,3711,3719,3727,3739,3776,3783,3790],{"type":24,"tag":550,"props":3459,"children":3460},{"class":552,"line":553},[3461],{"type":24,"tag":550,"props":3462,"children":3463},{"style":2641},[3464],{"type":33,"value":3465},"#!/usr/bin/env python3\n",{"type":24,"tag":550,"props":3467,"children":3468},{"class":552,"line":563},[3469],{"type":24,"tag":550,"props":3470,"children":3471},{"emptyLinePlaceholder":584},[3472],{"type":33,"value":587},{"type":24,"tag":550,"props":3474,"children":3475},{"class":552,"line":572},[3476,3480],{"type":24,"tag":550,"props":3477,"children":3478},{"style":594},[3479],{"type":33,"value":597},{"type":24,"tag":550,"props":3481,"children":3482},{"style":600},[3483],{"type":33,"value":603},{"type":24,"tag":550,"props":3485,"children":3486},{"class":552,"line":580},[3487],{"type":24,"tag":550,"props":3488,"children":3489},{"emptyLinePlaceholder":584},[3490],{"type":33,"value":587},{"type":24,"tag":550,"props":3492,"children":3493},{"class":552,"line":590},[3494,3498,3502,3506,3510,3514],{"type":24,"tag":550,"props":3495,"children":3496},{"style":594},[3497],{"type":33,"value":2276},{"type":24,"tag":550,"props":3499,"children":3500},{"style":600},[3501],{"type":33,"value":2281},{"type":24,"tag":550,"props":3503,"children":3504},{"style":594},[3505],{"type":33,"value":597},{"type":24,"tag":550,"props":3507,"children":3508},{"style":600},[3509],{"type":33,"value":2290},{"type":24,"tag":550,"props":3511,"children":3512},{"style":594},[3513],{"type":33,"value":2295},{"type":24,"tag":550,"props":3515,"children":3516},{"style":600},[3517],{"type":33,"value":2300},{"type":24,"tag":550,"props":3519,"children":3520},{"class":552,"line":606},[3521],{"type":24,"tag":550,"props":3522,"children":3523},{"emptyLinePlaceholder":584},[3524],{"type":33,"value":587},{"type":24,"tag":550,"props":3526,"children":3527},{"class":552,"line":614},[3528],{"type":24,"tag":550,"props":3529,"children":3530},{"style":2641},[3531],{"type":33,"value":3532},"# For consistency with TypeScript code, `cdk` is the preferred import name for\n",{"type":24,"tag":550,"props":3534,"children":3535},{"class":552,"line":627},[3536],{"type":24,"tag":550,"props":3537,"children":3538},{"style":2641},[3539],{"type":33,"value":3540},"# the CDK's core module.  The following line also imports it as `core` for use\n",{"type":24,"tag":550,"props":3542,"children":3543},{"class":552,"line":635},[3544],{"type":24,"tag":550,"props":3545,"children":3546},{"style":2641},[3547],{"type":33,"value":3548},"# with examples from the CDK Developer's Guide, which are in the process of\n",{"type":24,"tag":550,"props":3550,"children":3551},{"class":552,"line":665},[3552],{"type":24,"tag":550,"props":3553,"children":3554},{"style":2641},[3555],{"type":33,"value":3556},"# being updated to use `cdk`.  You may delete this import if you don't need it.\n",{"type":24,"tag":550,"props":3558,"children":3559},{"class":552,"line":691},[3560,3564,3568,3572],{"type":24,"tag":550,"props":3561,"children":3562},{"style":594},[3563],{"type":33,"value":2276},{"type":24,"tag":550,"props":3565,"children":3566},{"style":600},[3567],{"type":33,"value":2281},{"type":24,"tag":550,"props":3569,"children":3570},{"style":594},[3571],{"type":33,"value":597},{"type":24,"tag":550,"props":3573,"children":3574},{"style":600},[3575],{"type":33,"value":3576}," core\n",{"type":24,"tag":550,"props":3578,"children":3579},{"class":552,"line":717},[3580],{"type":24,"tag":550,"props":3581,"children":3582},{"emptyLinePlaceholder":584},[3583],{"type":33,"value":587},{"type":24,"tag":550,"props":3585,"children":3586},{"class":552,"line":725},[3587,3591,3596,3600],{"type":24,"tag":550,"props":3588,"children":3589},{"style":594},[3590],{"type":33,"value":2276},{"type":24,"tag":550,"props":3592,"children":3593},{"style":600},[3594],{"type":33,"value":3595}," cdk.cdk_stack ",{"type":24,"tag":550,"props":3597,"children":3598},{"style":594},[3599],{"type":33,"value":597},{"type":24,"tag":550,"props":3601,"children":3602},{"style":600},[3603],{"type":33,"value":3604}," CdkStack\n",{"type":24,"tag":550,"props":3606,"children":3607},{"class":552,"line":770},[3608],{"type":24,"tag":550,"props":3609,"children":3610},{"emptyLinePlaceholder":584},[3611],{"type":33,"value":587},{"type":24,"tag":550,"props":3613,"children":3614},{"class":552,"line":778},[3615,3620,3624,3628,3633,3637,3642],{"type":24,"tag":550,"props":3616,"children":3617},{"style":600},[3618],{"type":33,"value":3619},"aws_region ",{"type":24,"tag":550,"props":3621,"children":3622},{"style":594},[3623],{"type":33,"value":736},{"type":24,"tag":550,"props":3625,"children":3626},{"style":600},[3627],{"type":33,"value":652},{"type":24,"tag":550,"props":3629,"children":3630},{"style":557},[3631],{"type":33,"value":3632},"\"AWS_DEFAULT_REGION\"",{"type":24,"tag":550,"props":3634,"children":3635},{"style":600},[3636],{"type":33,"value":237},{"type":24,"tag":550,"props":3638,"children":3639},{"style":557},[3640],{"type":33,"value":3641},"\"us-east-1\"",{"type":24,"tag":550,"props":3643,"children":3644},{"style":600},[3645],{"type":33,"value":662},{"type":24,"tag":550,"props":3647,"children":3648},{"class":552,"line":796},[3649,3654,3658,3662,3667,3671,3676],{"type":24,"tag":550,"props":3650,"children":3651},{"style":600},[3652],{"type":33,"value":3653},"aws_account ",{"type":24,"tag":550,"props":3655,"children":3656},{"style":594},[3657],{"type":33,"value":736},{"type":24,"tag":550,"props":3659,"children":3660},{"style":600},[3661],{"type":33,"value":652},{"type":24,"tag":550,"props":3663,"children":3664},{"style":557},[3665],{"type":33,"value":3666},"\"AWS_ACCOUNT_ID\"",{"type":24,"tag":550,"props":3668,"children":3669},{"style":600},[3670],{"type":33,"value":237},{"type":24,"tag":550,"props":3672,"children":3673},{"style":557},[3674],{"type":33,"value":3675},"\"\"",{"type":24,"tag":550,"props":3677,"children":3678},{"style":600},[3679],{"type":33,"value":662},{"type":24,"tag":550,"props":3681,"children":3682},{"class":552,"line":820},[3683],{"type":24,"tag":550,"props":3684,"children":3685},{"emptyLinePlaceholder":584},[3686],{"type":33,"value":587},{"type":24,"tag":550,"props":3688,"children":3689},{"class":552,"line":842},[3690],{"type":24,"tag":550,"props":3691,"children":3692},{"emptyLinePlaceholder":584},[3693],{"type":33,"value":587},{"type":24,"tag":550,"props":3695,"children":3696},{"class":552,"line":856},[3697,3702,3706],{"type":24,"tag":550,"props":3698,"children":3699},{"style":600},[3700],{"type":33,"value":3701},"app ",{"type":24,"tag":550,"props":3703,"children":3704},{"style":594},[3705],{"type":33,"value":736},{"type":24,"tag":550,"props":3707,"children":3708},{"style":600},[3709],{"type":33,"value":3710}," cdk.App()\n",{"type":24,"tag":550,"props":3712,"children":3713},{"class":552,"line":865},[3714],{"type":24,"tag":550,"props":3715,"children":3716},{"style":600},[3717],{"type":33,"value":3718},"CdkStack(\n",{"type":24,"tag":550,"props":3720,"children":3721},{"class":552,"line":887},[3722],{"type":24,"tag":550,"props":3723,"children":3724},{"style":600},[3725],{"type":33,"value":3726},"    app,\n",{"type":24,"tag":550,"props":3728,"children":3729},{"class":552,"line":909},[3730,3735],{"type":24,"tag":550,"props":3731,"children":3732},{"style":557},[3733],{"type":33,"value":3734},"    \"valheim-server-stack\"",{"type":24,"tag":550,"props":3736,"children":3737},{"style":600},[3738],{"type":33,"value":817},{"type":24,"tag":550,"props":3740,"children":3741},{"class":552,"line":931},[3742,3747,3751,3756,3761,3766,3771],{"type":24,"tag":550,"props":3743,"children":3744},{"style":1291},[3745],{"type":33,"value":3746},"    env",{"type":24,"tag":550,"props":3748,"children":3749},{"style":594},[3750],{"type":33,"value":736},{"type":24,"tag":550,"props":3752,"children":3753},{"style":600},[3754],{"type":33,"value":3755},"{",{"type":24,"tag":550,"props":3757,"children":3758},{"style":557},[3759],{"type":33,"value":3760},"\"region\"",{"type":24,"tag":550,"props":3762,"children":3763},{"style":600},[3764],{"type":33,"value":3765},": aws_region, ",{"type":24,"tag":550,"props":3767,"children":3768},{"style":557},[3769],{"type":33,"value":3770},"\"account\"",{"type":24,"tag":550,"props":3772,"children":3773},{"style":600},[3774],{"type":33,"value":3775},": aws_account}\n",{"type":24,"tag":550,"props":3777,"children":3778},{"class":552,"line":953},[3779],{"type":24,"tag":550,"props":3780,"children":3781},{"style":600},[3782],{"type":33,"value":662},{"type":24,"tag":550,"props":3784,"children":3785},{"class":552,"line":966},[3786],{"type":24,"tag":550,"props":3787,"children":3788},{"emptyLinePlaceholder":584},[3789],{"type":33,"value":587},{"type":24,"tag":550,"props":3791,"children":3792},{"class":552,"line":975},[3793],{"type":24,"tag":550,"props":3794,"children":3795},{"style":600},[3796],{"type":33,"value":3797},"app.synth()\n",{"type":24,"tag":29,"props":3799,"children":3800},{},[3801],{"type":33,"value":3802},"Now commit changes, create a tag and push it to GitLab:",{"type":24,"tag":365,"props":3804,"children":3806},{"code":3805},"git add .\ngit commit -m \"initial commit\"\ngit tag v0.0.1\ngit push origin v0.0.1\n",[3807],{"type":24,"tag":64,"props":3808,"children":3809},{"__ignoreMap":8},[3810],{"type":33,"value":3805},{"type":24,"tag":29,"props":3812,"children":3813},{},[3814],{"type":33,"value":3815},"Check the logs of the GitLab CI pipeline that this creates in your GitLab project's CI/CD settings.",{"type":24,"tag":29,"props":3817,"children":3818},{},[3819],{"type":33,"value":3820},"If everything runs successfully, you should be able to see your Valheim server listed in the list of community servers once it comes online, and you should be able to connect to it with the password you set in GitLab project variables.",{"type":24,"tag":59,"props":3822,"children":3824},{"id":3823},"add-the-lambda-function-handler-code",[3825],{"type":33,"value":3826},"Add the Lambda function handler code",{"type":24,"tag":29,"props":3828,"children":3829},{},[3830,3832,3837,3839,3845,3847,3853,3855,3861,3862,3868],{"type":33,"value":3831},"We will have a simple Flask application respond the the Discord ",{"type":24,"tag":64,"props":3833,"children":3835},{"className":3834},[],[3836],{"type":33,"value":184},{"type":33,"value":3838}," requests that send Interaction events. Let's add ",{"type":24,"tag":64,"props":3840,"children":3842},{"className":3841},[],[3843],{"type":33,"value":3844},"lambda-handler.py",{"type":33,"value":3846}," in ",{"type":24,"tag":64,"props":3848,"children":3850},{"className":3849},[],[3851],{"type":33,"value":3852},"lambda/functions/interactions/lambda-handler.py",{"type":33,"value":3854},", and ",{"type":24,"tag":64,"props":3856,"children":3858},{"className":3857},[],[3859],{"type":33,"value":3860},"requirements.txt",{"type":33,"value":3846},{"type":24,"tag":64,"props":3863,"children":3865},{"className":3864},[],[3866],{"type":33,"value":3867},"lambda/functions/interactions/requirements.txt",{"type":33,"value":3869},". Our project structure should look like this:",{"type":24,"tag":365,"props":3871,"children":3873},{"code":3872},"$ tree -L 4\n.\n├── cdk\n│   ├── app.py\n│   ├── cdk\n│   │   ├── cdk_stack.py\n│   │   └── __init__.py\n│   ├── cdk.json\n│   ├── README.md\n│   ├── requirements.txt\n│   ├── setup.py\n│   └── source.bat\n├── lambda\n│   └── functions\n│       └── interactions\n│           ├── lambda-handler.py    \u003C-- here\n│           └── requirements.txt     \u003C-- and here\n├── README.md\n└── register_bot.py\n",[3874],{"type":24,"tag":64,"props":3875,"children":3876},{"__ignoreMap":8},[3877],{"type":33,"value":3872},{"type":24,"tag":29,"props":3879,"children":3880},{},[3881,3883,3888],{"type":33,"value":3882},"The ",{"type":24,"tag":64,"props":3884,"children":3886},{"className":3885},[],[3887],{"type":33,"value":3860},{"type":33,"value":3889}," defines the pip dependencies for our Lambda function. It should include the following:",{"type":24,"tag":365,"props":3891,"children":3893},{"code":3892},"aws-wsgi==0.2.7\ndiscord-interactions==0.2.0\nFlask==1.1.2\n",[3894],{"type":24,"tag":64,"props":3895,"children":3896},{"__ignoreMap":8},[3897],{"type":33,"value":3892},{"type":24,"tag":120,"props":3899,"children":3900},{},[3901,3912,3922],{"type":24,"tag":124,"props":3902,"children":3903},{},[3904,3910],{"type":24,"tag":64,"props":3905,"children":3907},{"className":3906},[],[3908],{"type":33,"value":3909},"aws-wsgi",{"type":33,"value":3911}," will transform API Gateway requests into WSGI application requests that Flask can handle",{"type":24,"tag":124,"props":3913,"children":3914},{},[3915,3920],{"type":24,"tag":64,"props":3916,"children":3918},{"className":3917},[],[3919],{"type":33,"value":2049},{"type":33,"value":3921}," will help us with some security-related requirements",{"type":24,"tag":124,"props":3923,"children":3924},{},[3925,3931],{"type":24,"tag":64,"props":3926,"children":3928},{"className":3927},[],[3929],{"type":33,"value":3930},"Flask",{"type":33,"value":3932}," will be our web application framework",{"type":24,"tag":29,"props":3934,"children":3935},{},[3936,3938,3943],{"type":33,"value":3937},"Here's the code for ",{"type":24,"tag":64,"props":3939,"children":3941},{"className":3940},[],[3942],{"type":33,"value":3844},{"type":33,"value":92},{"type":24,"tag":365,"props":3945,"children":3947},{"code":3946,"language":543,"meta":8,"className":544,"style":8},"import os\nimport logging\n\nimport awsgi\nimport boto3\nfrom discord_interactions import verify_key_decorator\nfrom flask import (\n    Flask,\n    jsonify,\n    request\n)\n\n\nclient = boto3.client('ecs')\n\n# Your public key can be found on your application in the Developer Portal\nPUBLIC_KEY = os.environ.get('APPLICATION_PUBLIC_KEY')\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\n\napp = Flask(__name__)\n\n\n@app.route('/discord', methods=['POST'])\n@verify_key_decorator(PUBLIC_KEY)\ndef index():\n    if request.json[\"type\"] == 1:\n        return jsonify({\"type\": 1})\n    else:\n        logger.info(request.json)\n        try:\n            interaction_option = request.json[\"data\"][\"options\"][0][\"value\"]\n        except KeyError:\n            logger.info(\"Could not parse the interaction option\")\n            interaction_option = \"status\"\n\n        logger.info(\"Interaction:\")\n        logger.info(interaction_option)\n\n        content = \"\"\n\n        if interaction_option == \"status\":\n            try:\n\n                resp = client.describe_services(\n                    cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                    services=[\n                        os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                    ]\n                )\n                desired_count = resp[\"services\"][0][\"desiredCount\"]\n                running_count = resp[\"services\"][0][\"runningCount\"]\n                pending_count = resp[\"services\"][0][\"pendingCount\"]\n\n                content = f\"Desired: {desired_count} | Running: {running_count} | Pending: {pending_count}\"\n\n            except Error as e:\n                content = \"Could not get server status\"\n                logger.info(\"Could not get the server status\")\n                logger.info(e)\n\n        elif interaction_option == \"start\":\n            content = \"Starting the server\"\n\n            resp = client.update_service(\n                cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                service=os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                desiredCount=1\n            )\n\n        elif interaction_option == \"stop\":\n            content = \"Stopping the server\"\n\n            resp = client.update_service(\n                cluster=os.environ.get(\"ECS_CLUSTER_ARN\", \"\"),\n                service=os.environ.get(\"ECS_SERVICE_NAME\", \"\"),\n                desiredCount=0\n            )\n\n        else:\n            content = \"Unknown command\"\n\n        logger.info(resp)\n\n        return jsonify({\n            \"type\": 4,\n            \"data\": {\n                \"tts\": False,\n                \"content\": content,\n                \"embeds\": [],\n                \"allowed_mentions\": { \"parse\": [] }\n            }\n        })\n\ndef handler(event, context):\n    return awsgi.response(\n        app,\n        event,\n        context,\n        base64_content_types={\"image/png\"}\n    )\n",[3948],{"type":24,"tag":64,"props":3949,"children":3950},{"__ignoreMap":8},[3951,3962,3974,3981,3993,4005,4026,4046,4054,4062,4070,4077,4084,4091,4117,4124,4132,4157,4164,4181,4198,4205,4230,4237,4244,4290,4310,4328,4365,4395,4407,4415,4427,4480,4497,4514,4530,4537,4554,4562,4569,4586,4593,4619,4631,4638,4655,4689,4705,4731,4740,4749,4793,4835,4877,4885,4961,4969,4992,5009,5027,5036,5044,5070,5088,5096,5114,5147,5180,5198,5207,5215,5240,5257,5265,5281,5313,5345,5362,5370,5378,5391,5408,5416,5425,5433,5446,5467,5480,5502,5516,5530,5554,5563,5572,5580,5615,5629,5638,5647,5656,5682],{"type":24,"tag":550,"props":3952,"children":3953},{"class":552,"line":553},[3954,3958],{"type":24,"tag":550,"props":3955,"children":3956},{"style":594},[3957],{"type":33,"value":597},{"type":24,"tag":550,"props":3959,"children":3960},{"style":600},[3961],{"type":33,"value":603},{"type":24,"tag":550,"props":3963,"children":3964},{"class":552,"line":563},[3965,3969],{"type":24,"tag":550,"props":3966,"children":3967},{"style":594},[3968],{"type":33,"value":597},{"type":24,"tag":550,"props":3970,"children":3971},{"style":600},[3972],{"type":33,"value":3973}," logging\n",{"type":24,"tag":550,"props":3975,"children":3976},{"class":552,"line":572},[3977],{"type":24,"tag":550,"props":3978,"children":3979},{"emptyLinePlaceholder":584},[3980],{"type":33,"value":587},{"type":24,"tag":550,"props":3982,"children":3983},{"class":552,"line":580},[3984,3988],{"type":24,"tag":550,"props":3985,"children":3986},{"style":594},[3987],{"type":33,"value":597},{"type":24,"tag":550,"props":3989,"children":3990},{"style":600},[3991],{"type":33,"value":3992}," awsgi\n",{"type":24,"tag":550,"props":3994,"children":3995},{"class":552,"line":590},[3996,4000],{"type":24,"tag":550,"props":3997,"children":3998},{"style":594},[3999],{"type":33,"value":597},{"type":24,"tag":550,"props":4001,"children":4002},{"style":600},[4003],{"type":33,"value":4004}," boto3\n",{"type":24,"tag":550,"props":4006,"children":4007},{"class":552,"line":606},[4008,4012,4017,4021],{"type":24,"tag":550,"props":4009,"children":4010},{"style":594},[4011],{"type":33,"value":2276},{"type":24,"tag":550,"props":4013,"children":4014},{"style":600},[4015],{"type":33,"value":4016}," discord_interactions ",{"type":24,"tag":550,"props":4018,"children":4019},{"style":594},[4020],{"type":33,"value":597},{"type":24,"tag":550,"props":4022,"children":4023},{"style":600},[4024],{"type":33,"value":4025}," verify_key_decorator\n",{"type":24,"tag":550,"props":4027,"children":4028},{"class":552,"line":614},[4029,4033,4038,4042],{"type":24,"tag":550,"props":4030,"children":4031},{"style":594},[4032],{"type":33,"value":2276},{"type":24,"tag":550,"props":4034,"children":4035},{"style":600},[4036],{"type":33,"value":4037}," flask ",{"type":24,"tag":550,"props":4039,"children":4040},{"style":594},[4041],{"type":33,"value":597},{"type":24,"tag":550,"props":4043,"children":4044},{"style":600},[4045],{"type":33,"value":2327},{"type":24,"tag":550,"props":4047,"children":4048},{"class":552,"line":627},[4049],{"type":24,"tag":550,"props":4050,"children":4051},{"style":600},[4052],{"type":33,"value":4053},"    Flask,\n",{"type":24,"tag":550,"props":4055,"children":4056},{"class":552,"line":635},[4057],{"type":24,"tag":550,"props":4058,"children":4059},{"style":600},[4060],{"type":33,"value":4061},"    jsonify,\n",{"type":24,"tag":550,"props":4063,"children":4064},{"class":552,"line":665},[4065],{"type":24,"tag":550,"props":4066,"children":4067},{"style":600},[4068],{"type":33,"value":4069},"    request\n",{"type":24,"tag":550,"props":4071,"children":4072},{"class":552,"line":691},[4073],{"type":24,"tag":550,"props":4074,"children":4075},{"style":600},[4076],{"type":33,"value":662},{"type":24,"tag":550,"props":4078,"children":4079},{"class":552,"line":717},[4080],{"type":24,"tag":550,"props":4081,"children":4082},{"emptyLinePlaceholder":584},[4083],{"type":33,"value":587},{"type":24,"tag":550,"props":4085,"children":4086},{"class":552,"line":725},[4087],{"type":24,"tag":550,"props":4088,"children":4089},{"emptyLinePlaceholder":584},[4090],{"type":33,"value":587},{"type":24,"tag":550,"props":4092,"children":4093},{"class":552,"line":770},[4094,4099,4103,4108,4113],{"type":24,"tag":550,"props":4095,"children":4096},{"style":600},[4097],{"type":33,"value":4098},"client ",{"type":24,"tag":550,"props":4100,"children":4101},{"style":594},[4102],{"type":33,"value":736},{"type":24,"tag":550,"props":4104,"children":4105},{"style":600},[4106],{"type":33,"value":4107}," boto3.client(",{"type":24,"tag":550,"props":4109,"children":4110},{"style":557},[4111],{"type":33,"value":4112},"'ecs'",{"type":24,"tag":550,"props":4114,"children":4115},{"style":600},[4116],{"type":33,"value":662},{"type":24,"tag":550,"props":4118,"children":4119},{"class":552,"line":778},[4120],{"type":24,"tag":550,"props":4121,"children":4122},{"emptyLinePlaceholder":584},[4123],{"type":33,"value":587},{"type":24,"tag":550,"props":4125,"children":4126},{"class":552,"line":796},[4127],{"type":24,"tag":550,"props":4128,"children":4129},{"style":2641},[4130],{"type":33,"value":4131},"# Your public key can be found on your application in the Developer Portal\n",{"type":24,"tag":550,"props":4133,"children":4134},{"class":552,"line":820},[4135,4140,4144,4148,4153],{"type":24,"tag":550,"props":4136,"children":4137},{"style":639},[4138],{"type":33,"value":4139},"PUBLIC_KEY",{"type":24,"tag":550,"props":4141,"children":4142},{"style":594},[4143],{"type":33,"value":647},{"type":24,"tag":550,"props":4145,"children":4146},{"style":600},[4147],{"type":33,"value":652},{"type":24,"tag":550,"props":4149,"children":4150},{"style":557},[4151],{"type":33,"value":4152},"'APPLICATION_PUBLIC_KEY'",{"type":24,"tag":550,"props":4154,"children":4155},{"style":600},[4156],{"type":33,"value":662},{"type":24,"tag":550,"props":4158,"children":4159},{"class":552,"line":842},[4160],{"type":24,"tag":550,"props":4161,"children":4162},{"emptyLinePlaceholder":584},[4163],{"type":33,"value":587},{"type":24,"tag":550,"props":4165,"children":4166},{"class":552,"line":856},[4167,4172,4176],{"type":24,"tag":550,"props":4168,"children":4169},{"style":600},[4170],{"type":33,"value":4171},"logger ",{"type":24,"tag":550,"props":4173,"children":4174},{"style":594},[4175],{"type":33,"value":736},{"type":24,"tag":550,"props":4177,"children":4178},{"style":600},[4179],{"type":33,"value":4180}," logging.getLogger()\n",{"type":24,"tag":550,"props":4182,"children":4183},{"class":552,"line":865},[4184,4189,4194],{"type":24,"tag":550,"props":4185,"children":4186},{"style":600},[4187],{"type":33,"value":4188},"logger.setLevel(logging.",{"type":24,"tag":550,"props":4190,"children":4191},{"style":639},[4192],{"type":33,"value":4193},"INFO",{"type":24,"tag":550,"props":4195,"children":4196},{"style":600},[4197],{"type":33,"value":662},{"type":24,"tag":550,"props":4199,"children":4200},{"class":552,"line":887},[4201],{"type":24,"tag":550,"props":4202,"children":4203},{"emptyLinePlaceholder":584},[4204],{"type":33,"value":587},{"type":24,"tag":550,"props":4206,"children":4207},{"class":552,"line":909},[4208,4212,4216,4221,4226],{"type":24,"tag":550,"props":4209,"children":4210},{"style":600},[4211],{"type":33,"value":3701},{"type":24,"tag":550,"props":4213,"children":4214},{"style":594},[4215],{"type":33,"value":736},{"type":24,"tag":550,"props":4217,"children":4218},{"style":600},[4219],{"type":33,"value":4220}," Flask(",{"type":24,"tag":550,"props":4222,"children":4223},{"style":1252},[4224],{"type":33,"value":4225},"__name__",{"type":24,"tag":550,"props":4227,"children":4228},{"style":600},[4229],{"type":33,"value":662},{"type":24,"tag":550,"props":4231,"children":4232},{"class":552,"line":931},[4233],{"type":24,"tag":550,"props":4234,"children":4235},{"emptyLinePlaceholder":584},[4236],{"type":33,"value":587},{"type":24,"tag":550,"props":4238,"children":4239},{"class":552,"line":953},[4240],{"type":24,"tag":550,"props":4241,"children":4242},{"emptyLinePlaceholder":584},[4243],{"type":33,"value":587},{"type":24,"tag":550,"props":4245,"children":4246},{"class":552,"line":966},[4247,4253,4257,4262,4266,4271,4275,4280,4285],{"type":24,"tag":550,"props":4248,"children":4250},{"style":4249},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[4251],{"type":33,"value":4252},"@app.route",{"type":24,"tag":550,"props":4254,"children":4255},{"style":600},[4256],{"type":33,"value":2498},{"type":24,"tag":550,"props":4258,"children":4259},{"style":557},[4260],{"type":33,"value":4261},"'/discord'",{"type":24,"tag":550,"props":4263,"children":4264},{"style":600},[4265],{"type":33,"value":237},{"type":24,"tag":550,"props":4267,"children":4268},{"style":1291},[4269],{"type":33,"value":4270},"methods",{"type":24,"tag":550,"props":4272,"children":4273},{"style":594},[4274],{"type":33,"value":736},{"type":24,"tag":550,"props":4276,"children":4277},{"style":600},[4278],{"type":33,"value":4279},"[",{"type":24,"tag":550,"props":4281,"children":4282},{"style":557},[4283],{"type":33,"value":4284},"'POST'",{"type":24,"tag":550,"props":4286,"children":4287},{"style":600},[4288],{"type":33,"value":4289},"])\n",{"type":24,"tag":550,"props":4291,"children":4292},{"class":552,"line":975},[4293,4298,4302,4306],{"type":24,"tag":550,"props":4294,"children":4295},{"style":4249},[4296],{"type":33,"value":4297},"@verify_key_decorator",{"type":24,"tag":550,"props":4299,"children":4300},{"style":600},[4301],{"type":33,"value":2498},{"type":24,"tag":550,"props":4303,"children":4304},{"style":639},[4305],{"type":33,"value":4139},{"type":24,"tag":550,"props":4307,"children":4308},{"style":600},[4309],{"type":33,"value":662},{"type":24,"tag":550,"props":4311,"children":4312},{"class":552,"line":997},[4313,4318,4323],{"type":24,"tag":550,"props":4314,"children":4315},{"style":739},[4316],{"type":33,"value":4317},"def",{"type":24,"tag":550,"props":4319,"children":4320},{"style":4249},[4321],{"type":33,"value":4322}," index",{"type":24,"tag":550,"props":4324,"children":4325},{"style":600},[4326],{"type":33,"value":4327},"():\n",{"type":24,"tag":550,"props":4329,"children":4330},{"class":552,"line":1015},[4331,4336,4341,4346,4351,4356,4361],{"type":24,"tag":550,"props":4332,"children":4333},{"style":594},[4334],{"type":33,"value":4335},"    if",{"type":24,"tag":550,"props":4337,"children":4338},{"style":600},[4339],{"type":33,"value":4340}," request.json[",{"type":24,"tag":550,"props":4342,"children":4343},{"style":557},[4344],{"type":33,"value":4345},"\"type\"",{"type":24,"tag":550,"props":4347,"children":4348},{"style":600},[4349],{"type":33,"value":4350},"] ",{"type":24,"tag":550,"props":4352,"children":4353},{"style":594},[4354],{"type":33,"value":4355},"==",{"type":24,"tag":550,"props":4357,"children":4358},{"style":639},[4359],{"type":33,"value":4360}," 1",{"type":24,"tag":550,"props":4362,"children":4363},{"style":600},[4364],{"type":33,"value":1270},{"type":24,"tag":550,"props":4366,"children":4367},{"class":552,"line":1024},[4368,4373,4378,4382,4386,4390],{"type":24,"tag":550,"props":4369,"children":4370},{"style":594},[4371],{"type":33,"value":4372},"        return",{"type":24,"tag":550,"props":4374,"children":4375},{"style":600},[4376],{"type":33,"value":4377}," jsonify({",{"type":24,"tag":550,"props":4379,"children":4380},{"style":557},[4381],{"type":33,"value":4345},{"type":24,"tag":550,"props":4383,"children":4384},{"style":600},[4385],{"type":33,"value":807},{"type":24,"tag":550,"props":4387,"children":4388},{"style":639},[4389],{"type":33,"value":281},{"type":24,"tag":550,"props":4391,"children":4392},{"style":600},[4393],{"type":33,"value":4394},"})\n",{"type":24,"tag":550,"props":4396,"children":4397},{"class":552,"line":1032},[4398,4403],{"type":24,"tag":550,"props":4399,"children":4400},{"style":594},[4401],{"type":33,"value":4402},"    else",{"type":24,"tag":550,"props":4404,"children":4405},{"style":600},[4406],{"type":33,"value":1270},{"type":24,"tag":550,"props":4408,"children":4409},{"class":552,"line":1053},[4410],{"type":24,"tag":550,"props":4411,"children":4412},{"style":600},[4413],{"type":33,"value":4414},"        logger.info(request.json)\n",{"type":24,"tag":550,"props":4416,"children":4417},{"class":552,"line":1070},[4418,4423],{"type":24,"tag":550,"props":4419,"children":4420},{"style":594},[4421],{"type":33,"value":4422},"        try",{"type":24,"tag":550,"props":4424,"children":4425},{"style":600},[4426],{"type":33,"value":1270},{"type":24,"tag":550,"props":4428,"children":4429},{"class":552,"line":1078},[4430,4435,4439,4443,4448,4453,4458,4462,4466,4470,4475],{"type":24,"tag":550,"props":4431,"children":4432},{"style":600},[4433],{"type":33,"value":4434},"            interaction_option ",{"type":24,"tag":550,"props":4436,"children":4437},{"style":594},[4438],{"type":33,"value":736},{"type":24,"tag":550,"props":4440,"children":4441},{"style":600},[4442],{"type":33,"value":4340},{"type":24,"tag":550,"props":4444,"children":4445},{"style":557},[4446],{"type":33,"value":4447},"\"data\"",{"type":24,"tag":550,"props":4449,"children":4450},{"style":600},[4451],{"type":33,"value":4452},"][",{"type":24,"tag":550,"props":4454,"children":4455},{"style":557},[4456],{"type":33,"value":4457},"\"options\"",{"type":24,"tag":550,"props":4459,"children":4460},{"style":600},[4461],{"type":33,"value":4452},{"type":24,"tag":550,"props":4463,"children":4464},{"style":639},[4465],{"type":33,"value":288},{"type":24,"tag":550,"props":4467,"children":4468},{"style":600},[4469],{"type":33,"value":4452},{"type":24,"tag":550,"props":4471,"children":4472},{"style":557},[4473],{"type":33,"value":4474},"\"value\"",{"type":24,"tag":550,"props":4476,"children":4477},{"style":600},[4478],{"type":33,"value":4479},"]\n",{"type":24,"tag":550,"props":4481,"children":4482},{"class":552,"line":1086},[4483,4488,4493],{"type":24,"tag":550,"props":4484,"children":4485},{"style":594},[4486],{"type":33,"value":4487},"        except",{"type":24,"tag":550,"props":4489,"children":4490},{"style":1487},[4491],{"type":33,"value":4492}," KeyError",{"type":24,"tag":550,"props":4494,"children":4495},{"style":600},[4496],{"type":33,"value":1270},{"type":24,"tag":550,"props":4498,"children":4499},{"class":552,"line":1107},[4500,4505,4510],{"type":24,"tag":550,"props":4501,"children":4502},{"style":600},[4503],{"type":33,"value":4504},"            logger.info(",{"type":24,"tag":550,"props":4506,"children":4507},{"style":557},[4508],{"type":33,"value":4509},"\"Could not parse the interaction option\"",{"type":24,"tag":550,"props":4511,"children":4512},{"style":600},[4513],{"type":33,"value":662},{"type":24,"tag":550,"props":4515,"children":4516},{"class":552,"line":1124},[4517,4521,4525],{"type":24,"tag":550,"props":4518,"children":4519},{"style":600},[4520],{"type":33,"value":4434},{"type":24,"tag":550,"props":4522,"children":4523},{"style":594},[4524],{"type":33,"value":736},{"type":24,"tag":550,"props":4526,"children":4527},{"style":557},[4528],{"type":33,"value":4529}," \"status\"\n",{"type":24,"tag":550,"props":4531,"children":4532},{"class":552,"line":1133},[4533],{"type":24,"tag":550,"props":4534,"children":4535},{"emptyLinePlaceholder":584},[4536],{"type":33,"value":587},{"type":24,"tag":550,"props":4538,"children":4539},{"class":552,"line":1142},[4540,4545,4550],{"type":24,"tag":550,"props":4541,"children":4542},{"style":600},[4543],{"type":33,"value":4544},"        logger.info(",{"type":24,"tag":550,"props":4546,"children":4547},{"style":557},[4548],{"type":33,"value":4549},"\"Interaction:\"",{"type":24,"tag":550,"props":4551,"children":4552},{"style":600},[4553],{"type":33,"value":662},{"type":24,"tag":550,"props":4555,"children":4556},{"class":552,"line":1151},[4557],{"type":24,"tag":550,"props":4558,"children":4559},{"style":600},[4560],{"type":33,"value":4561},"        logger.info(interaction_option)\n",{"type":24,"tag":550,"props":4563,"children":4564},{"class":552,"line":1160},[4565],{"type":24,"tag":550,"props":4566,"children":4567},{"emptyLinePlaceholder":584},[4568],{"type":33,"value":587},{"type":24,"tag":550,"props":4570,"children":4571},{"class":552,"line":1169},[4572,4577,4581],{"type":24,"tag":550,"props":4573,"children":4574},{"style":600},[4575],{"type":33,"value":4576},"        content ",{"type":24,"tag":550,"props":4578,"children":4579},{"style":594},[4580],{"type":33,"value":736},{"type":24,"tag":550,"props":4582,"children":4583},{"style":557},[4584],{"type":33,"value":4585}," \"\"\n",{"type":24,"tag":550,"props":4587,"children":4588},{"class":552,"line":1177},[4589],{"type":24,"tag":550,"props":4590,"children":4591},{"emptyLinePlaceholder":584},[4592],{"type":33,"value":587},{"type":24,"tag":550,"props":4594,"children":4595},{"class":552,"line":1194},[4596,4601,4606,4610,4615],{"type":24,"tag":550,"props":4597,"children":4598},{"style":594},[4599],{"type":33,"value":4600},"        if",{"type":24,"tag":550,"props":4602,"children":4603},{"style":600},[4604],{"type":33,"value":4605}," interaction_option ",{"type":24,"tag":550,"props":4607,"children":4608},{"style":594},[4609],{"type":33,"value":4355},{"type":24,"tag":550,"props":4611,"children":4612},{"style":557},[4613],{"type":33,"value":4614}," \"status\"",{"type":24,"tag":550,"props":4616,"children":4617},{"style":600},[4618],{"type":33,"value":1270},{"type":24,"tag":550,"props":4620,"children":4621},{"class":552,"line":1227},[4622,4627],{"type":24,"tag":550,"props":4623,"children":4624},{"style":594},[4625],{"type":33,"value":4626},"            try",{"type":24,"tag":550,"props":4628,"children":4629},{"style":600},[4630],{"type":33,"value":1270},{"type":24,"tag":550,"props":4632,"children":4633},{"class":552,"line":1235},[4634],{"type":24,"tag":550,"props":4635,"children":4636},{"emptyLinePlaceholder":584},[4637],{"type":33,"value":587},{"type":24,"tag":550,"props":4639,"children":4640},{"class":552,"line":1243},[4641,4646,4650],{"type":24,"tag":550,"props":4642,"children":4643},{"style":600},[4644],{"type":33,"value":4645},"                resp ",{"type":24,"tag":550,"props":4647,"children":4648},{"style":594},[4649],{"type":33,"value":736},{"type":24,"tag":550,"props":4651,"children":4652},{"style":600},[4653],{"type":33,"value":4654}," client.describe_services(\n",{"type":24,"tag":550,"props":4656,"children":4657},{"class":552,"line":1273},[4658,4663,4667,4672,4677,4681,4685],{"type":24,"tag":550,"props":4659,"children":4660},{"style":1291},[4661],{"type":33,"value":4662},"                    cluster",{"type":24,"tag":550,"props":4664,"children":4665},{"style":594},[4666],{"type":33,"value":736},{"type":24,"tag":550,"props":4668,"children":4669},{"style":600},[4670],{"type":33,"value":4671},"os.environ.get(",{"type":24,"tag":550,"props":4673,"children":4674},{"style":557},[4675],{"type":33,"value":4676},"\"ECS_CLUSTER_ARN\"",{"type":24,"tag":550,"props":4678,"children":4679},{"style":600},[4680],{"type":33,"value":237},{"type":24,"tag":550,"props":4682,"children":4683},{"style":557},[4684],{"type":33,"value":3675},{"type":24,"tag":550,"props":4686,"children":4687},{"style":600},[4688],{"type":33,"value":2804},{"type":24,"tag":550,"props":4690,"children":4691},{"class":552,"line":1320},[4692,4697,4701],{"type":24,"tag":550,"props":4693,"children":4694},{"style":1291},[4695],{"type":33,"value":4696},"                    services",{"type":24,"tag":550,"props":4698,"children":4699},{"style":594},[4700],{"type":33,"value":736},{"type":24,"tag":550,"props":4702,"children":4703},{"style":600},[4704],{"type":33,"value":2142},{"type":24,"tag":550,"props":4706,"children":4708},{"class":552,"line":4707},49,[4709,4714,4719,4723,4727],{"type":24,"tag":550,"props":4710,"children":4711},{"style":600},[4712],{"type":33,"value":4713},"                        os.environ.get(",{"type":24,"tag":550,"props":4715,"children":4716},{"style":557},[4717],{"type":33,"value":4718},"\"ECS_SERVICE_NAME\"",{"type":24,"tag":550,"props":4720,"children":4721},{"style":600},[4722],{"type":33,"value":237},{"type":24,"tag":550,"props":4724,"children":4725},{"style":557},[4726],{"type":33,"value":3675},{"type":24,"tag":550,"props":4728,"children":4729},{"style":600},[4730],{"type":33,"value":2804},{"type":24,"tag":550,"props":4732,"children":4734},{"class":552,"line":4733},50,[4735],{"type":24,"tag":550,"props":4736,"children":4737},{"style":600},[4738],{"type":33,"value":4739},"                    ]\n",{"type":24,"tag":550,"props":4741,"children":4743},{"class":552,"line":4742},51,[4744],{"type":24,"tag":550,"props":4745,"children":4746},{"style":600},[4747],{"type":33,"value":4748},"                )\n",{"type":24,"tag":550,"props":4750,"children":4752},{"class":552,"line":4751},52,[4753,4758,4762,4767,4772,4776,4780,4784,4789],{"type":24,"tag":550,"props":4754,"children":4755},{"style":600},[4756],{"type":33,"value":4757},"                desired_count ",{"type":24,"tag":550,"props":4759,"children":4760},{"style":594},[4761],{"type":33,"value":736},{"type":24,"tag":550,"props":4763,"children":4764},{"style":600},[4765],{"type":33,"value":4766}," resp[",{"type":24,"tag":550,"props":4768,"children":4769},{"style":557},[4770],{"type":33,"value":4771},"\"services\"",{"type":24,"tag":550,"props":4773,"children":4774},{"style":600},[4775],{"type":33,"value":4452},{"type":24,"tag":550,"props":4777,"children":4778},{"style":639},[4779],{"type":33,"value":288},{"type":24,"tag":550,"props":4781,"children":4782},{"style":600},[4783],{"type":33,"value":4452},{"type":24,"tag":550,"props":4785,"children":4786},{"style":557},[4787],{"type":33,"value":4788},"\"desiredCount\"",{"type":24,"tag":550,"props":4790,"children":4791},{"style":600},[4792],{"type":33,"value":4479},{"type":24,"tag":550,"props":4794,"children":4796},{"class":552,"line":4795},53,[4797,4802,4806,4810,4814,4818,4822,4826,4831],{"type":24,"tag":550,"props":4798,"children":4799},{"style":600},[4800],{"type":33,"value":4801},"                running_count ",{"type":24,"tag":550,"props":4803,"children":4804},{"style":594},[4805],{"type":33,"value":736},{"type":24,"tag":550,"props":4807,"children":4808},{"style":600},[4809],{"type":33,"value":4766},{"type":24,"tag":550,"props":4811,"children":4812},{"style":557},[4813],{"type":33,"value":4771},{"type":24,"tag":550,"props":4815,"children":4816},{"style":600},[4817],{"type":33,"value":4452},{"type":24,"tag":550,"props":4819,"children":4820},{"style":639},[4821],{"type":33,"value":288},{"type":24,"tag":550,"props":4823,"children":4824},{"style":600},[4825],{"type":33,"value":4452},{"type":24,"tag":550,"props":4827,"children":4828},{"style":557},[4829],{"type":33,"value":4830},"\"runningCount\"",{"type":24,"tag":550,"props":4832,"children":4833},{"style":600},[4834],{"type":33,"value":4479},{"type":24,"tag":550,"props":4836,"children":4838},{"class":552,"line":4837},54,[4839,4844,4848,4852,4856,4860,4864,4868,4873],{"type":24,"tag":550,"props":4840,"children":4841},{"style":600},[4842],{"type":33,"value":4843},"                pending_count ",{"type":24,"tag":550,"props":4845,"children":4846},{"style":594},[4847],{"type":33,"value":736},{"type":24,"tag":550,"props":4849,"children":4850},{"style":600},[4851],{"type":33,"value":4766},{"type":24,"tag":550,"props":4853,"children":4854},{"style":557},[4855],{"type":33,"value":4771},{"type":24,"tag":550,"props":4857,"children":4858},{"style":600},[4859],{"type":33,"value":4452},{"type":24,"tag":550,"props":4861,"children":4862},{"style":639},[4863],{"type":33,"value":288},{"type":24,"tag":550,"props":4865,"children":4866},{"style":600},[4867],{"type":33,"value":4452},{"type":24,"tag":550,"props":4869,"children":4870},{"style":557},[4871],{"type":33,"value":4872},"\"pendingCount\"",{"type":24,"tag":550,"props":4874,"children":4875},{"style":600},[4876],{"type":33,"value":4479},{"type":24,"tag":550,"props":4878,"children":4880},{"class":552,"line":4879},55,[4881],{"type":24,"tag":550,"props":4882,"children":4883},{"emptyLinePlaceholder":584},[4884],{"type":33,"value":587},{"type":24,"tag":550,"props":4886,"children":4888},{"class":552,"line":4887},56,[4889,4894,4898,4902,4907,4911,4916,4921,4926,4930,4935,4939,4944,4948,4953,4957],{"type":24,"tag":550,"props":4890,"children":4891},{"style":600},[4892],{"type":33,"value":4893},"                content ",{"type":24,"tag":550,"props":4895,"children":4896},{"style":594},[4897],{"type":33,"value":736},{"type":24,"tag":550,"props":4899,"children":4900},{"style":739},[4901],{"type":33,"value":742},{"type":24,"tag":550,"props":4903,"children":4904},{"style":557},[4905],{"type":33,"value":4906},"\"Desired: ",{"type":24,"tag":550,"props":4908,"children":4909},{"style":639},[4910],{"type":33,"value":3755},{"type":24,"tag":550,"props":4912,"children":4913},{"style":600},[4914],{"type":33,"value":4915},"desired_count",{"type":24,"tag":550,"props":4917,"children":4918},{"style":639},[4919],{"type":33,"value":4920},"}",{"type":24,"tag":550,"props":4922,"children":4923},{"style":557},[4924],{"type":33,"value":4925}," | Running: ",{"type":24,"tag":550,"props":4927,"children":4928},{"style":639},[4929],{"type":33,"value":3755},{"type":24,"tag":550,"props":4931,"children":4932},{"style":600},[4933],{"type":33,"value":4934},"running_count",{"type":24,"tag":550,"props":4936,"children":4937},{"style":639},[4938],{"type":33,"value":4920},{"type":24,"tag":550,"props":4940,"children":4941},{"style":557},[4942],{"type":33,"value":4943}," | Pending: ",{"type":24,"tag":550,"props":4945,"children":4946},{"style":639},[4947],{"type":33,"value":3755},{"type":24,"tag":550,"props":4949,"children":4950},{"style":600},[4951],{"type":33,"value":4952},"pending_count",{"type":24,"tag":550,"props":4954,"children":4955},{"style":639},[4956],{"type":33,"value":4920},{"type":24,"tag":550,"props":4958,"children":4959},{"style":557},[4960],{"type":33,"value":1224},{"type":24,"tag":550,"props":4962,"children":4964},{"class":552,"line":4963},57,[4965],{"type":24,"tag":550,"props":4966,"children":4967},{"emptyLinePlaceholder":584},[4968],{"type":33,"value":587},{"type":24,"tag":550,"props":4970,"children":4972},{"class":552,"line":4971},58,[4973,4978,4983,4987],{"type":24,"tag":550,"props":4974,"children":4975},{"style":594},[4976],{"type":33,"value":4977},"            except",{"type":24,"tag":550,"props":4979,"children":4980},{"style":600},[4981],{"type":33,"value":4982}," Error ",{"type":24,"tag":550,"props":4984,"children":4985},{"style":594},[4986],{"type":33,"value":2295},{"type":24,"tag":550,"props":4988,"children":4989},{"style":600},[4990],{"type":33,"value":4991}," e:\n",{"type":24,"tag":550,"props":4993,"children":4995},{"class":552,"line":4994},59,[4996,5000,5004],{"type":24,"tag":550,"props":4997,"children":4998},{"style":600},[4999],{"type":33,"value":4893},{"type":24,"tag":550,"props":5001,"children":5002},{"style":594},[5003],{"type":33,"value":736},{"type":24,"tag":550,"props":5005,"children":5006},{"style":557},[5007],{"type":33,"value":5008}," \"Could not get server status\"\n",{"type":24,"tag":550,"props":5010,"children":5012},{"class":552,"line":5011},60,[5013,5018,5023],{"type":24,"tag":550,"props":5014,"children":5015},{"style":600},[5016],{"type":33,"value":5017},"                logger.info(",{"type":24,"tag":550,"props":5019,"children":5020},{"style":557},[5021],{"type":33,"value":5022},"\"Could not get the server status\"",{"type":24,"tag":550,"props":5024,"children":5025},{"style":600},[5026],{"type":33,"value":662},{"type":24,"tag":550,"props":5028,"children":5030},{"class":552,"line":5029},61,[5031],{"type":24,"tag":550,"props":5032,"children":5033},{"style":600},[5034],{"type":33,"value":5035},"                logger.info(e)\n",{"type":24,"tag":550,"props":5037,"children":5039},{"class":552,"line":5038},62,[5040],{"type":24,"tag":550,"props":5041,"children":5042},{"emptyLinePlaceholder":584},[5043],{"type":33,"value":587},{"type":24,"tag":550,"props":5045,"children":5047},{"class":552,"line":5046},63,[5048,5053,5057,5061,5066],{"type":24,"tag":550,"props":5049,"children":5050},{"style":594},[5051],{"type":33,"value":5052},"        elif",{"type":24,"tag":550,"props":5054,"children":5055},{"style":600},[5056],{"type":33,"value":4605},{"type":24,"tag":550,"props":5058,"children":5059},{"style":594},[5060],{"type":33,"value":4355},{"type":24,"tag":550,"props":5062,"children":5063},{"style":557},[5064],{"type":33,"value":5065}," \"start\"",{"type":24,"tag":550,"props":5067,"children":5068},{"style":600},[5069],{"type":33,"value":1270},{"type":24,"tag":550,"props":5071,"children":5073},{"class":552,"line":5072},64,[5074,5079,5083],{"type":24,"tag":550,"props":5075,"children":5076},{"style":600},[5077],{"type":33,"value":5078},"            content ",{"type":24,"tag":550,"props":5080,"children":5081},{"style":594},[5082],{"type":33,"value":736},{"type":24,"tag":550,"props":5084,"children":5085},{"style":557},[5086],{"type":33,"value":5087}," \"Starting the server\"\n",{"type":24,"tag":550,"props":5089,"children":5091},{"class":552,"line":5090},65,[5092],{"type":24,"tag":550,"props":5093,"children":5094},{"emptyLinePlaceholder":584},[5095],{"type":33,"value":587},{"type":24,"tag":550,"props":5097,"children":5099},{"class":552,"line":5098},66,[5100,5105,5109],{"type":24,"tag":550,"props":5101,"children":5102},{"style":600},[5103],{"type":33,"value":5104},"            resp ",{"type":24,"tag":550,"props":5106,"children":5107},{"style":594},[5108],{"type":33,"value":736},{"type":24,"tag":550,"props":5110,"children":5111},{"style":600},[5112],{"type":33,"value":5113}," client.update_service(\n",{"type":24,"tag":550,"props":5115,"children":5117},{"class":552,"line":5116},67,[5118,5123,5127,5131,5135,5139,5143],{"type":24,"tag":550,"props":5119,"children":5120},{"style":1291},[5121],{"type":33,"value":5122},"                cluster",{"type":24,"tag":550,"props":5124,"children":5125},{"style":594},[5126],{"type":33,"value":736},{"type":24,"tag":550,"props":5128,"children":5129},{"style":600},[5130],{"type":33,"value":4671},{"type":24,"tag":550,"props":5132,"children":5133},{"style":557},[5134],{"type":33,"value":4676},{"type":24,"tag":550,"props":5136,"children":5137},{"style":600},[5138],{"type":33,"value":237},{"type":24,"tag":550,"props":5140,"children":5141},{"style":557},[5142],{"type":33,"value":3675},{"type":24,"tag":550,"props":5144,"children":5145},{"style":600},[5146],{"type":33,"value":2804},{"type":24,"tag":550,"props":5148,"children":5150},{"class":552,"line":5149},68,[5151,5156,5160,5164,5168,5172,5176],{"type":24,"tag":550,"props":5152,"children":5153},{"style":1291},[5154],{"type":33,"value":5155},"                service",{"type":24,"tag":550,"props":5157,"children":5158},{"style":594},[5159],{"type":33,"value":736},{"type":24,"tag":550,"props":5161,"children":5162},{"style":600},[5163],{"type":33,"value":4671},{"type":24,"tag":550,"props":5165,"children":5166},{"style":557},[5167],{"type":33,"value":4718},{"type":24,"tag":550,"props":5169,"children":5170},{"style":600},[5171],{"type":33,"value":237},{"type":24,"tag":550,"props":5173,"children":5174},{"style":557},[5175],{"type":33,"value":3675},{"type":24,"tag":550,"props":5177,"children":5178},{"style":600},[5179],{"type":33,"value":2804},{"type":24,"tag":550,"props":5181,"children":5183},{"class":552,"line":5182},69,[5184,5189,5193],{"type":24,"tag":550,"props":5185,"children":5186},{"style":1291},[5187],{"type":33,"value":5188},"                desiredCount",{"type":24,"tag":550,"props":5190,"children":5191},{"style":594},[5192],{"type":33,"value":736},{"type":24,"tag":550,"props":5194,"children":5195},{"style":639},[5196],{"type":33,"value":5197},"1\n",{"type":24,"tag":550,"props":5199,"children":5201},{"class":552,"line":5200},70,[5202],{"type":24,"tag":550,"props":5203,"children":5204},{"style":600},[5205],{"type":33,"value":5206},"            )\n",{"type":24,"tag":550,"props":5208,"children":5210},{"class":552,"line":5209},71,[5211],{"type":24,"tag":550,"props":5212,"children":5213},{"emptyLinePlaceholder":584},[5214],{"type":33,"value":587},{"type":24,"tag":550,"props":5216,"children":5218},{"class":552,"line":5217},72,[5219,5223,5227,5231,5236],{"type":24,"tag":550,"props":5220,"children":5221},{"style":594},[5222],{"type":33,"value":5052},{"type":24,"tag":550,"props":5224,"children":5225},{"style":600},[5226],{"type":33,"value":4605},{"type":24,"tag":550,"props":5228,"children":5229},{"style":594},[5230],{"type":33,"value":4355},{"type":24,"tag":550,"props":5232,"children":5233},{"style":557},[5234],{"type":33,"value":5235}," \"stop\"",{"type":24,"tag":550,"props":5237,"children":5238},{"style":600},[5239],{"type":33,"value":1270},{"type":24,"tag":550,"props":5241,"children":5243},{"class":552,"line":5242},73,[5244,5248,5252],{"type":24,"tag":550,"props":5245,"children":5246},{"style":600},[5247],{"type":33,"value":5078},{"type":24,"tag":550,"props":5249,"children":5250},{"style":594},[5251],{"type":33,"value":736},{"type":24,"tag":550,"props":5253,"children":5254},{"style":557},[5255],{"type":33,"value":5256}," \"Stopping the server\"\n",{"type":24,"tag":550,"props":5258,"children":5260},{"class":552,"line":5259},74,[5261],{"type":24,"tag":550,"props":5262,"children":5263},{"emptyLinePlaceholder":584},[5264],{"type":33,"value":587},{"type":24,"tag":550,"props":5266,"children":5268},{"class":552,"line":5267},75,[5269,5273,5277],{"type":24,"tag":550,"props":5270,"children":5271},{"style":600},[5272],{"type":33,"value":5104},{"type":24,"tag":550,"props":5274,"children":5275},{"style":594},[5276],{"type":33,"value":736},{"type":24,"tag":550,"props":5278,"children":5279},{"style":600},[5280],{"type":33,"value":5113},{"type":24,"tag":550,"props":5282,"children":5284},{"class":552,"line":5283},76,[5285,5289,5293,5297,5301,5305,5309],{"type":24,"tag":550,"props":5286,"children":5287},{"style":1291},[5288],{"type":33,"value":5122},{"type":24,"tag":550,"props":5290,"children":5291},{"style":594},[5292],{"type":33,"value":736},{"type":24,"tag":550,"props":5294,"children":5295},{"style":600},[5296],{"type":33,"value":4671},{"type":24,"tag":550,"props":5298,"children":5299},{"style":557},[5300],{"type":33,"value":4676},{"type":24,"tag":550,"props":5302,"children":5303},{"style":600},[5304],{"type":33,"value":237},{"type":24,"tag":550,"props":5306,"children":5307},{"style":557},[5308],{"type":33,"value":3675},{"type":24,"tag":550,"props":5310,"children":5311},{"style":600},[5312],{"type":33,"value":2804},{"type":24,"tag":550,"props":5314,"children":5316},{"class":552,"line":5315},77,[5317,5321,5325,5329,5333,5337,5341],{"type":24,"tag":550,"props":5318,"children":5319},{"style":1291},[5320],{"type":33,"value":5155},{"type":24,"tag":550,"props":5322,"children":5323},{"style":594},[5324],{"type":33,"value":736},{"type":24,"tag":550,"props":5326,"children":5327},{"style":600},[5328],{"type":33,"value":4671},{"type":24,"tag":550,"props":5330,"children":5331},{"style":557},[5332],{"type":33,"value":4718},{"type":24,"tag":550,"props":5334,"children":5335},{"style":600},[5336],{"type":33,"value":237},{"type":24,"tag":550,"props":5338,"children":5339},{"style":557},[5340],{"type":33,"value":3675},{"type":24,"tag":550,"props":5342,"children":5343},{"style":600},[5344],{"type":33,"value":2804},{"type":24,"tag":550,"props":5346,"children":5348},{"class":552,"line":5347},78,[5349,5353,5357],{"type":24,"tag":550,"props":5350,"children":5351},{"style":1291},[5352],{"type":33,"value":5188},{"type":24,"tag":550,"props":5354,"children":5355},{"style":594},[5356],{"type":33,"value":736},{"type":24,"tag":550,"props":5358,"children":5359},{"style":639},[5360],{"type":33,"value":5361},"0\n",{"type":24,"tag":550,"props":5363,"children":5365},{"class":552,"line":5364},79,[5366],{"type":24,"tag":550,"props":5367,"children":5368},{"style":600},[5369],{"type":33,"value":5206},{"type":24,"tag":550,"props":5371,"children":5373},{"class":552,"line":5372},80,[5374],{"type":24,"tag":550,"props":5375,"children":5376},{"emptyLinePlaceholder":584},[5377],{"type":33,"value":587},{"type":24,"tag":550,"props":5379,"children":5381},{"class":552,"line":5380},81,[5382,5387],{"type":24,"tag":550,"props":5383,"children":5384},{"style":594},[5385],{"type":33,"value":5386},"        else",{"type":24,"tag":550,"props":5388,"children":5389},{"style":600},[5390],{"type":33,"value":1270},{"type":24,"tag":550,"props":5392,"children":5394},{"class":552,"line":5393},82,[5395,5399,5403],{"type":24,"tag":550,"props":5396,"children":5397},{"style":600},[5398],{"type":33,"value":5078},{"type":24,"tag":550,"props":5400,"children":5401},{"style":594},[5402],{"type":33,"value":736},{"type":24,"tag":550,"props":5404,"children":5405},{"style":557},[5406],{"type":33,"value":5407}," \"Unknown command\"\n",{"type":24,"tag":550,"props":5409,"children":5411},{"class":552,"line":5410},83,[5412],{"type":24,"tag":550,"props":5413,"children":5414},{"emptyLinePlaceholder":584},[5415],{"type":33,"value":587},{"type":24,"tag":550,"props":5417,"children":5419},{"class":552,"line":5418},84,[5420],{"type":24,"tag":550,"props":5421,"children":5422},{"style":600},[5423],{"type":33,"value":5424},"        logger.info(resp)\n",{"type":24,"tag":550,"props":5426,"children":5428},{"class":552,"line":5427},85,[5429],{"type":24,"tag":550,"props":5430,"children":5431},{"emptyLinePlaceholder":584},[5432],{"type":33,"value":587},{"type":24,"tag":550,"props":5434,"children":5436},{"class":552,"line":5435},86,[5437,5441],{"type":24,"tag":550,"props":5438,"children":5439},{"style":594},[5440],{"type":33,"value":4372},{"type":24,"tag":550,"props":5442,"children":5443},{"style":600},[5444],{"type":33,"value":5445}," jsonify({\n",{"type":24,"tag":550,"props":5447,"children":5449},{"class":552,"line":5448},87,[5450,5454,5458,5463],{"type":24,"tag":550,"props":5451,"children":5452},{"style":557},[5453],{"type":33,"value":915},{"type":24,"tag":550,"props":5455,"children":5456},{"style":600},[5457],{"type":33,"value":807},{"type":24,"tag":550,"props":5459,"children":5460},{"style":639},[5461],{"type":33,"value":5462},"4",{"type":24,"tag":550,"props":5464,"children":5465},{"style":600},[5466],{"type":33,"value":817},{"type":24,"tag":550,"props":5468,"children":5470},{"class":552,"line":5469},88,[5471,5476],{"type":24,"tag":550,"props":5472,"children":5473},{"style":557},[5474],{"type":33,"value":5475},"            \"data\"",{"type":24,"tag":550,"props":5477,"children":5478},{"style":600},[5479],{"type":33,"value":1538},{"type":24,"tag":550,"props":5481,"children":5483},{"class":552,"line":5482},89,[5484,5489,5493,5498],{"type":24,"tag":550,"props":5485,"children":5486},{"style":557},[5487],{"type":33,"value":5488},"                \"tts\"",{"type":24,"tag":550,"props":5490,"children":5491},{"style":600},[5492],{"type":33,"value":807},{"type":24,"tag":550,"props":5494,"children":5495},{"style":639},[5496],{"type":33,"value":5497},"False",{"type":24,"tag":550,"props":5499,"children":5500},{"style":600},[5501],{"type":33,"value":817},{"type":24,"tag":550,"props":5503,"children":5505},{"class":552,"line":5504},90,[5506,5511],{"type":24,"tag":550,"props":5507,"children":5508},{"style":557},[5509],{"type":33,"value":5510},"                \"content\"",{"type":24,"tag":550,"props":5512,"children":5513},{"style":600},[5514],{"type":33,"value":5515},": content,\n",{"type":24,"tag":550,"props":5517,"children":5519},{"class":552,"line":5518},91,[5520,5525],{"type":24,"tag":550,"props":5521,"children":5522},{"style":557},[5523],{"type":33,"value":5524},"                \"embeds\"",{"type":24,"tag":550,"props":5526,"children":5527},{"style":600},[5528],{"type":33,"value":5529},": [],\n",{"type":24,"tag":550,"props":5531,"children":5533},{"class":552,"line":5532},92,[5534,5539,5544,5549],{"type":24,"tag":550,"props":5535,"children":5536},{"style":557},[5537],{"type":33,"value":5538},"                \"allowed_mentions\"",{"type":24,"tag":550,"props":5540,"children":5541},{"style":600},[5542],{"type":33,"value":5543},": { ",{"type":24,"tag":550,"props":5545,"children":5546},{"style":557},[5547],{"type":33,"value":5548},"\"parse\"",{"type":24,"tag":550,"props":5550,"children":5551},{"style":600},[5552],{"type":33,"value":5553},": [] }\n",{"type":24,"tag":550,"props":5555,"children":5557},{"class":552,"line":5556},93,[5558],{"type":24,"tag":550,"props":5559,"children":5560},{"style":600},[5561],{"type":33,"value":5562},"            }\n",{"type":24,"tag":550,"props":5564,"children":5566},{"class":552,"line":5565},94,[5567],{"type":24,"tag":550,"props":5568,"children":5569},{"style":600},[5570],{"type":33,"value":5571},"        })\n",{"type":24,"tag":550,"props":5573,"children":5575},{"class":552,"line":5574},95,[5576],{"type":24,"tag":550,"props":5577,"children":5578},{"emptyLinePlaceholder":584},[5579],{"type":33,"value":587},{"type":24,"tag":550,"props":5581,"children":5583},{"class":552,"line":5582},96,[5584,5588,5593,5597,5602,5606,5611],{"type":24,"tag":550,"props":5585,"children":5586},{"style":739},[5587],{"type":33,"value":4317},{"type":24,"tag":550,"props":5589,"children":5590},{"style":4249},[5591],{"type":33,"value":5592}," handler",{"type":24,"tag":550,"props":5594,"children":5595},{"style":600},[5596],{"type":33,"value":2498},{"type":24,"tag":550,"props":5598,"children":5599},{"style":2544},[5600],{"type":33,"value":5601},"event",{"type":24,"tag":550,"props":5603,"children":5604},{"style":600},[5605],{"type":33,"value":237},{"type":24,"tag":550,"props":5607,"children":5608},{"style":2544},[5609],{"type":33,"value":5610},"context",{"type":24,"tag":550,"props":5612,"children":5613},{"style":600},[5614],{"type":33,"value":2517},{"type":24,"tag":550,"props":5616,"children":5618},{"class":552,"line":5617},97,[5619,5624],{"type":24,"tag":550,"props":5620,"children":5621},{"style":594},[5622],{"type":33,"value":5623},"    return",{"type":24,"tag":550,"props":5625,"children":5626},{"style":600},[5627],{"type":33,"value":5628}," awsgi.response(\n",{"type":24,"tag":550,"props":5630,"children":5632},{"class":552,"line":5631},98,[5633],{"type":24,"tag":550,"props":5634,"children":5635},{"style":600},[5636],{"type":33,"value":5637},"        app,\n",{"type":24,"tag":550,"props":5639,"children":5641},{"class":552,"line":5640},99,[5642],{"type":24,"tag":550,"props":5643,"children":5644},{"style":600},[5645],{"type":33,"value":5646},"        event,\n",{"type":24,"tag":550,"props":5648,"children":5650},{"class":552,"line":5649},100,[5651],{"type":24,"tag":550,"props":5652,"children":5653},{"style":600},[5654],{"type":33,"value":5655},"        context,\n",{"type":24,"tag":550,"props":5657,"children":5659},{"class":552,"line":5658},101,[5660,5665,5669,5673,5678],{"type":24,"tag":550,"props":5661,"children":5662},{"style":1291},[5663],{"type":33,"value":5664},"        base64_content_types",{"type":24,"tag":550,"props":5666,"children":5667},{"style":594},[5668],{"type":33,"value":736},{"type":24,"tag":550,"props":5670,"children":5671},{"style":600},[5672],{"type":33,"value":3755},{"type":24,"tag":550,"props":5674,"children":5675},{"style":557},[5676],{"type":33,"value":5677},"\"image/png\"",{"type":24,"tag":550,"props":5679,"children":5680},{"style":600},[5681],{"type":33,"value":1166},{"type":24,"tag":550,"props":5683,"children":5685},{"class":552,"line":5684},102,[5686],{"type":24,"tag":550,"props":5687,"children":5688},{"style":600},[5689],{"type":33,"value":5690},"    )\n",{"type":24,"tag":29,"props":5692,"children":5693},{},[5694,5696,5702,5704,5710,5712,5717,5719,5725],{"type":33,"value":5695},"Notice how we pass the Flask ",{"type":24,"tag":64,"props":5697,"children":5699},{"className":5698},[],[5700],{"type":33,"value":5701},"app",{"type":33,"value":5703}," to ",{"type":24,"tag":64,"props":5705,"children":5707},{"className":5706},[],[5708],{"type":33,"value":5709},"awsgi.response",{"type":33,"value":5711},". ",{"type":24,"tag":64,"props":5713,"children":5715},{"className":5714},[],[5716],{"type":33,"value":3909},{"type":33,"value":5718}," (or ",{"type":24,"tag":64,"props":5720,"children":5722},{"className":5721},[],[5723],{"type":33,"value":5724},"awsgi",{"type":33,"value":5726}," as it is imported) is the go-between for API Gateway and WSGI.",{"type":24,"tag":59,"props":5728,"children":5730},{"id":5729},"add-the-cdk-code-for-api-gateway-and-lambda-that-will-serve-our-discord-interaction-endpoint-url",[5731],{"type":33,"value":5732},"Add the CDK code for API Gateway and Lambda that will serve our Discord Interaction Endpoint URL",{"type":24,"tag":29,"props":5734,"children":5735},{},[5736,5738,5743,5745,5750,5752,5758],{"type":33,"value":5737},"Now we can add the following code to ",{"type":24,"tag":64,"props":5739,"children":5741},{"className":5740},[],[5742],{"type":33,"value":2253},{"type":33,"value":5744}," to configure the API Gateway and Lambda function. Add the following to ",{"type":24,"tag":64,"props":5746,"children":5748},{"className":5747},[],[5749],{"type":33,"value":2253},{"type":33,"value":5751}," after our definition of ",{"type":24,"tag":64,"props":5753,"children":5755},{"className":5754},[],[5756],{"type":33,"value":5757},"self.valheim_world",{"type":33,"value":92},{"type":24,"tag":365,"props":5760,"children":5762},{"code":5761,"language":543,"meta":8,"className":544,"style":8},"        self.env_vars = {\n            \"APPLICATION_PUBLIC_KEY\": os.environ.get(\"APPLICATION_PUBLIC_KEY\"),\n            \"ECS_SERVICE_NAME\": self.valheim_world.service.service_name,\n            \"ECS_CLUSTER_ARN\": self.valheim_world.service.cluster.cluster_arn\n        }\n\n        self.flask_lambda_layer = _lambda.LayerVersion(\n            self,\n            \"FlaskAppLambdaLayer\",\n            code=_lambda.AssetCode(\"./layers/flask\"),\n            compatible_runtimes=[_lambda.Runtime.PYTHON_3_8,],\n        )\n\n        self.flask_app_lambda = _lambda.Function(\n            self,\n            \"FlaskAppLambda\",\n            runtime=_lambda.Runtime.PYTHON_3_8,\n            code=_lambda.AssetCode('./lambda/functions/interactions'),\n            function_name=\"flask-app-handler\",\n            handler=\"lambda-handler.handler\",\n            layers=[self.flask_lambda_layer],\n            timeout=core.Duration.seconds(60),\n            environment={**self.env_vars},\n        )\n\n        self.flask_app_lambda.role.add_managed_policy(\n            iam.ManagedPolicy.from_managed_policy_arn(\n                self,\n                'ECS_FullAccessPolicy',\n                managed_policy_arn='arn:aws:iam::aws:policy/AmazonECS_FullAccess'\n            )\n        )\n\n        # https://slmkitani.medium.com/passing-custom-headers-through-amazon-api-gateway-to-an-aws-lambda-function-f3a1cfdc0e29\n        self.request_templates = {\n            \"application/json\": '''{\n                \"method\": \"$context.httpMethod\",\n                \"body\" : $input.json(\"$\"),\n                \"headers\": {\n                    #foreach($param in $input.params().header.keySet())\n                    \"$param\": \"$util.escapeJavaScript($input.params().header.get($param))\"\n                    #if($foreach.hasNext),#end\n                    #end\n                }\n            }\n            '''\n        }\n\n        self.apigateway = apigw.RestApi(\n            self,\n            'FlaskAppEndpoint',\n        )\n\n        self.apigateway.root.add_method(\"ANY\")\n\n        self.discord_interaction_webhook = self.apigateway.root.add_resource(\"discord\")\n\n        self.discord_interaction_webhook_integration = apigw.LambdaIntegration(\n            self.flask_app_lambda,\n            request_templates=self.request_templates\n        )\n\n        self.discord_interaction_webhook.add_method(\n            'POST',\n            self.discord_interaction_webhook_integration\n        )\n",[5763],{"type":24,"tag":64,"props":5764,"children":5765},{"__ignoreMap":8},[5766,5786,5807,5828,5849,5857,5864,5885,5896,5908,5934,5961,5969,5976,5997,6008,6020,6045,6069,6090,6111,6136,6162,6190,6197,6204,6216,6224,6236,6248,6265,6272,6279,6286,6294,6314,6331,6339,6347,6355,6363,6371,6379,6387,6394,6401,6409,6416,6423,6444,6455,6467,6474,6481,6502,6509,6544,6551,6572,6584,6605,6612,6619,6631,6643,6655],{"type":24,"tag":550,"props":5767,"children":5768},{"class":552,"line":553},[5769,5773,5778,5782],{"type":24,"tag":550,"props":5770,"children":5771},{"style":2650},[5772],{"type":33,"value":2653},{"type":24,"tag":550,"props":5774,"children":5775},{"style":600},[5776],{"type":33,"value":5777},".env_vars ",{"type":24,"tag":550,"props":5779,"children":5780},{"style":594},[5781],{"type":33,"value":736},{"type":24,"tag":550,"props":5783,"children":5784},{"style":600},[5785],{"type":33,"value":793},{"type":24,"tag":550,"props":5787,"children":5788},{"class":552,"line":563},[5789,5794,5798,5803],{"type":24,"tag":550,"props":5790,"children":5791},{"style":557},[5792],{"type":33,"value":5793},"            \"APPLICATION_PUBLIC_KEY\"",{"type":24,"tag":550,"props":5795,"children":5796},{"style":600},[5797],{"type":33,"value":2890},{"type":24,"tag":550,"props":5799,"children":5800},{"style":557},[5801],{"type":33,"value":5802},"\"APPLICATION_PUBLIC_KEY\"",{"type":24,"tag":550,"props":5804,"children":5805},{"style":600},[5806],{"type":33,"value":2804},{"type":24,"tag":550,"props":5808,"children":5809},{"class":552,"line":572},[5810,5815,5819,5823],{"type":24,"tag":550,"props":5811,"children":5812},{"style":557},[5813],{"type":33,"value":5814},"            \"ECS_SERVICE_NAME\"",{"type":24,"tag":550,"props":5816,"children":5817},{"style":600},[5818],{"type":33,"value":807},{"type":24,"tag":550,"props":5820,"children":5821},{"style":2650},[5822],{"type":33,"value":2547},{"type":24,"tag":550,"props":5824,"children":5825},{"style":600},[5826],{"type":33,"value":5827},".valheim_world.service.service_name,\n",{"type":24,"tag":550,"props":5829,"children":5830},{"class":552,"line":580},[5831,5836,5840,5844],{"type":24,"tag":550,"props":5832,"children":5833},{"style":557},[5834],{"type":33,"value":5835},"            \"ECS_CLUSTER_ARN\"",{"type":24,"tag":550,"props":5837,"children":5838},{"style":600},[5839],{"type":33,"value":807},{"type":24,"tag":550,"props":5841,"children":5842},{"style":2650},[5843],{"type":33,"value":2547},{"type":24,"tag":550,"props":5845,"children":5846},{"style":600},[5847],{"type":33,"value":5848},".valheim_world.service.cluster.cluster_arn\n",{"type":24,"tag":550,"props":5850,"children":5851},{"class":552,"line":590},[5852],{"type":24,"tag":550,"props":5853,"children":5854},{"style":600},[5855],{"type":33,"value":5856},"        }\n",{"type":24,"tag":550,"props":5858,"children":5859},{"class":552,"line":606},[5860],{"type":24,"tag":550,"props":5861,"children":5862},{"emptyLinePlaceholder":584},[5863],{"type":33,"value":587},{"type":24,"tag":550,"props":5865,"children":5866},{"class":552,"line":614},[5867,5871,5876,5880],{"type":24,"tag":550,"props":5868,"children":5869},{"style":2650},[5870],{"type":33,"value":2653},{"type":24,"tag":550,"props":5872,"children":5873},{"style":600},[5874],{"type":33,"value":5875},".flask_lambda_layer ",{"type":24,"tag":550,"props":5877,"children":5878},{"style":594},[5879],{"type":33,"value":736},{"type":24,"tag":550,"props":5881,"children":5882},{"style":600},[5883],{"type":33,"value":5884}," _lambda.LayerVersion(\n",{"type":24,"tag":550,"props":5886,"children":5887},{"class":552,"line":627},[5888,5892],{"type":24,"tag":550,"props":5889,"children":5890},{"style":2650},[5891],{"type":33,"value":2675},{"type":24,"tag":550,"props":5893,"children":5894},{"style":600},[5895],{"type":33,"value":817},{"type":24,"tag":550,"props":5897,"children":5898},{"class":552,"line":635},[5899,5904],{"type":24,"tag":550,"props":5900,"children":5901},{"style":557},[5902],{"type":33,"value":5903},"            \"FlaskAppLambdaLayer\"",{"type":24,"tag":550,"props":5905,"children":5906},{"style":600},[5907],{"type":33,"value":817},{"type":24,"tag":550,"props":5909,"children":5910},{"class":552,"line":665},[5911,5916,5920,5925,5930],{"type":24,"tag":550,"props":5912,"children":5913},{"style":1291},[5914],{"type":33,"value":5915},"            code",{"type":24,"tag":550,"props":5917,"children":5918},{"style":594},[5919],{"type":33,"value":736},{"type":24,"tag":550,"props":5921,"children":5922},{"style":600},[5923],{"type":33,"value":5924},"_lambda.AssetCode(",{"type":24,"tag":550,"props":5926,"children":5927},{"style":557},[5928],{"type":33,"value":5929},"\"./layers/flask\"",{"type":24,"tag":550,"props":5931,"children":5932},{"style":600},[5933],{"type":33,"value":2804},{"type":24,"tag":550,"props":5935,"children":5936},{"class":552,"line":691},[5937,5942,5946,5951,5956],{"type":24,"tag":550,"props":5938,"children":5939},{"style":1291},[5940],{"type":33,"value":5941},"            compatible_runtimes",{"type":24,"tag":550,"props":5943,"children":5944},{"style":594},[5945],{"type":33,"value":736},{"type":24,"tag":550,"props":5947,"children":5948},{"style":600},[5949],{"type":33,"value":5950},"[_lambda.Runtime.",{"type":24,"tag":550,"props":5952,"children":5953},{"style":639},[5954],{"type":33,"value":5955},"PYTHON_3_8",{"type":24,"tag":550,"props":5957,"children":5958},{"style":600},[5959],{"type":33,"value":5960},",],\n",{"type":24,"tag":550,"props":5962,"children":5963},{"class":552,"line":717},[5964],{"type":24,"tag":550,"props":5965,"children":5966},{"style":600},[5967],{"type":33,"value":5968},"        )\n",{"type":24,"tag":550,"props":5970,"children":5971},{"class":552,"line":725},[5972],{"type":24,"tag":550,"props":5973,"children":5974},{"emptyLinePlaceholder":584},[5975],{"type":33,"value":587},{"type":24,"tag":550,"props":5977,"children":5978},{"class":552,"line":770},[5979,5983,5988,5992],{"type":24,"tag":550,"props":5980,"children":5981},{"style":2650},[5982],{"type":33,"value":2653},{"type":24,"tag":550,"props":5984,"children":5985},{"style":600},[5986],{"type":33,"value":5987},".flask_app_lambda ",{"type":24,"tag":550,"props":5989,"children":5990},{"style":594},[5991],{"type":33,"value":736},{"type":24,"tag":550,"props":5993,"children":5994},{"style":600},[5995],{"type":33,"value":5996}," _lambda.Function(\n",{"type":24,"tag":550,"props":5998,"children":5999},{"class":552,"line":778},[6000,6004],{"type":24,"tag":550,"props":6001,"children":6002},{"style":2650},[6003],{"type":33,"value":2675},{"type":24,"tag":550,"props":6005,"children":6006},{"style":600},[6007],{"type":33,"value":817},{"type":24,"tag":550,"props":6009,"children":6010},{"class":552,"line":796},[6011,6016],{"type":24,"tag":550,"props":6012,"children":6013},{"style":557},[6014],{"type":33,"value":6015},"            \"FlaskAppLambda\"",{"type":24,"tag":550,"props":6017,"children":6018},{"style":600},[6019],{"type":33,"value":817},{"type":24,"tag":550,"props":6021,"children":6022},{"class":552,"line":820},[6023,6028,6032,6037,6041],{"type":24,"tag":550,"props":6024,"children":6025},{"style":1291},[6026],{"type":33,"value":6027},"            runtime",{"type":24,"tag":550,"props":6029,"children":6030},{"style":594},[6031],{"type":33,"value":736},{"type":24,"tag":550,"props":6033,"children":6034},{"style":600},[6035],{"type":33,"value":6036},"_lambda.Runtime.",{"type":24,"tag":550,"props":6038,"children":6039},{"style":639},[6040],{"type":33,"value":5955},{"type":24,"tag":550,"props":6042,"children":6043},{"style":600},[6044],{"type":33,"value":817},{"type":24,"tag":550,"props":6046,"children":6047},{"class":552,"line":842},[6048,6052,6056,6060,6065],{"type":24,"tag":550,"props":6049,"children":6050},{"style":1291},[6051],{"type":33,"value":5915},{"type":24,"tag":550,"props":6053,"children":6054},{"style":594},[6055],{"type":33,"value":736},{"type":24,"tag":550,"props":6057,"children":6058},{"style":600},[6059],{"type":33,"value":5924},{"type":24,"tag":550,"props":6061,"children":6062},{"style":557},[6063],{"type":33,"value":6064},"'./lambda/functions/interactions'",{"type":24,"tag":550,"props":6066,"children":6067},{"style":600},[6068],{"type":33,"value":2804},{"type":24,"tag":550,"props":6070,"children":6071},{"class":552,"line":856},[6072,6077,6081,6086],{"type":24,"tag":550,"props":6073,"children":6074},{"style":1291},[6075],{"type":33,"value":6076},"            function_name",{"type":24,"tag":550,"props":6078,"children":6079},{"style":594},[6080],{"type":33,"value":736},{"type":24,"tag":550,"props":6082,"children":6083},{"style":557},[6084],{"type":33,"value":6085},"\"flask-app-handler\"",{"type":24,"tag":550,"props":6087,"children":6088},{"style":600},[6089],{"type":33,"value":817},{"type":24,"tag":550,"props":6091,"children":6092},{"class":552,"line":865},[6093,6098,6102,6107],{"type":24,"tag":550,"props":6094,"children":6095},{"style":1291},[6096],{"type":33,"value":6097},"            handler",{"type":24,"tag":550,"props":6099,"children":6100},{"style":594},[6101],{"type":33,"value":736},{"type":24,"tag":550,"props":6103,"children":6104},{"style":557},[6105],{"type":33,"value":6106},"\"lambda-handler.handler\"",{"type":24,"tag":550,"props":6108,"children":6109},{"style":600},[6110],{"type":33,"value":817},{"type":24,"tag":550,"props":6112,"children":6113},{"class":552,"line":887},[6114,6119,6123,6127,6131],{"type":24,"tag":550,"props":6115,"children":6116},{"style":1291},[6117],{"type":33,"value":6118},"            layers",{"type":24,"tag":550,"props":6120,"children":6121},{"style":594},[6122],{"type":33,"value":736},{"type":24,"tag":550,"props":6124,"children":6125},{"style":600},[6126],{"type":33,"value":4279},{"type":24,"tag":550,"props":6128,"children":6129},{"style":2650},[6130],{"type":33,"value":2547},{"type":24,"tag":550,"props":6132,"children":6133},{"style":600},[6134],{"type":33,"value":6135},".flask_lambda_layer],\n",{"type":24,"tag":550,"props":6137,"children":6138},{"class":552,"line":909},[6139,6144,6148,6153,6158],{"type":24,"tag":550,"props":6140,"children":6141},{"style":1291},[6142],{"type":33,"value":6143},"            timeout",{"type":24,"tag":550,"props":6145,"children":6146},{"style":594},[6147],{"type":33,"value":736},{"type":24,"tag":550,"props":6149,"children":6150},{"style":600},[6151],{"type":33,"value":6152},"core.Duration.seconds(",{"type":24,"tag":550,"props":6154,"children":6155},{"style":639},[6156],{"type":33,"value":6157},"60",{"type":24,"tag":550,"props":6159,"children":6160},{"style":600},[6161],{"type":33,"value":2804},{"type":24,"tag":550,"props":6163,"children":6164},{"class":552,"line":931},[6165,6169,6173,6177,6181,6185],{"type":24,"tag":550,"props":6166,"children":6167},{"style":1291},[6168],{"type":33,"value":2869},{"type":24,"tag":550,"props":6170,"children":6171},{"style":594},[6172],{"type":33,"value":736},{"type":24,"tag":550,"props":6174,"children":6175},{"style":600},[6176],{"type":33,"value":3755},{"type":24,"tag":550,"props":6178,"children":6179},{"style":594},[6180],{"type":33,"value":2584},{"type":24,"tag":550,"props":6182,"children":6183},{"style":2650},[6184],{"type":33,"value":2547},{"type":24,"tag":550,"props":6186,"children":6187},{"style":600},[6188],{"type":33,"value":6189},".env_vars},\n",{"type":24,"tag":550,"props":6191,"children":6192},{"class":552,"line":953},[6193],{"type":24,"tag":550,"props":6194,"children":6195},{"style":600},[6196],{"type":33,"value":5968},{"type":24,"tag":550,"props":6198,"children":6199},{"class":552,"line":966},[6200],{"type":24,"tag":550,"props":6201,"children":6202},{"emptyLinePlaceholder":584},[6203],{"type":33,"value":587},{"type":24,"tag":550,"props":6205,"children":6206},{"class":552,"line":975},[6207,6211],{"type":24,"tag":550,"props":6208,"children":6209},{"style":2650},[6210],{"type":33,"value":2653},{"type":24,"tag":550,"props":6212,"children":6213},{"style":600},[6214],{"type":33,"value":6215},".flask_app_lambda.role.add_managed_policy(\n",{"type":24,"tag":550,"props":6217,"children":6218},{"class":552,"line":997},[6219],{"type":24,"tag":550,"props":6220,"children":6221},{"style":600},[6222],{"type":33,"value":6223},"            iam.ManagedPolicy.from_managed_policy_arn(\n",{"type":24,"tag":550,"props":6225,"children":6226},{"class":552,"line":1015},[6227,6232],{"type":24,"tag":550,"props":6228,"children":6229},{"style":2650},[6230],{"type":33,"value":6231},"                self",{"type":24,"tag":550,"props":6233,"children":6234},{"style":600},[6235],{"type":33,"value":817},{"type":24,"tag":550,"props":6237,"children":6238},{"class":552,"line":1024},[6239,6244],{"type":24,"tag":550,"props":6240,"children":6241},{"style":557},[6242],{"type":33,"value":6243},"                'ECS_FullAccessPolicy'",{"type":24,"tag":550,"props":6245,"children":6246},{"style":600},[6247],{"type":33,"value":817},{"type":24,"tag":550,"props":6249,"children":6250},{"class":552,"line":1032},[6251,6256,6260],{"type":24,"tag":550,"props":6252,"children":6253},{"style":1291},[6254],{"type":33,"value":6255},"                managed_policy_arn",{"type":24,"tag":550,"props":6257,"children":6258},{"style":594},[6259],{"type":33,"value":736},{"type":24,"tag":550,"props":6261,"children":6262},{"style":557},[6263],{"type":33,"value":6264},"'arn:aws:iam::aws:policy/AmazonECS_FullAccess'\n",{"type":24,"tag":550,"props":6266,"children":6267},{"class":552,"line":1053},[6268],{"type":24,"tag":550,"props":6269,"children":6270},{"style":600},[6271],{"type":33,"value":5206},{"type":24,"tag":550,"props":6273,"children":6274},{"class":552,"line":1070},[6275],{"type":24,"tag":550,"props":6276,"children":6277},{"style":600},[6278],{"type":33,"value":5968},{"type":24,"tag":550,"props":6280,"children":6281},{"class":552,"line":1078},[6282],{"type":24,"tag":550,"props":6283,"children":6284},{"emptyLinePlaceholder":584},[6285],{"type":33,"value":587},{"type":24,"tag":550,"props":6287,"children":6288},{"class":552,"line":1086},[6289],{"type":24,"tag":550,"props":6290,"children":6291},{"style":2641},[6292],{"type":33,"value":6293},"        # https://slmkitani.medium.com/passing-custom-headers-through-amazon-api-gateway-to-an-aws-lambda-function-f3a1cfdc0e29\n",{"type":24,"tag":550,"props":6295,"children":6296},{"class":552,"line":1107},[6297,6301,6306,6310],{"type":24,"tag":550,"props":6298,"children":6299},{"style":2650},[6300],{"type":33,"value":2653},{"type":24,"tag":550,"props":6302,"children":6303},{"style":600},[6304],{"type":33,"value":6305},".request_templates ",{"type":24,"tag":550,"props":6307,"children":6308},{"style":594},[6309],{"type":33,"value":736},{"type":24,"tag":550,"props":6311,"children":6312},{"style":600},[6313],{"type":33,"value":793},{"type":24,"tag":550,"props":6315,"children":6316},{"class":552,"line":1124},[6317,6322,6326],{"type":24,"tag":550,"props":6318,"children":6319},{"style":557},[6320],{"type":33,"value":6321},"            \"application/json\"",{"type":24,"tag":550,"props":6323,"children":6324},{"style":600},[6325],{"type":33,"value":807},{"type":24,"tag":550,"props":6327,"children":6328},{"style":557},[6329],{"type":33,"value":6330},"'''{\n",{"type":24,"tag":550,"props":6332,"children":6333},{"class":552,"line":1133},[6334],{"type":24,"tag":550,"props":6335,"children":6336},{"style":557},[6337],{"type":33,"value":6338},"                \"method\": \"$context.httpMethod\",\n",{"type":24,"tag":550,"props":6340,"children":6341},{"class":552,"line":1142},[6342],{"type":24,"tag":550,"props":6343,"children":6344},{"style":557},[6345],{"type":33,"value":6346},"                \"body\" : $input.json(\"$\"),\n",{"type":24,"tag":550,"props":6348,"children":6349},{"class":552,"line":1151},[6350],{"type":24,"tag":550,"props":6351,"children":6352},{"style":557},[6353],{"type":33,"value":6354},"                \"headers\": {\n",{"type":24,"tag":550,"props":6356,"children":6357},{"class":552,"line":1160},[6358],{"type":24,"tag":550,"props":6359,"children":6360},{"style":557},[6361],{"type":33,"value":6362},"                    #foreach($param in $input.params().header.keySet())\n",{"type":24,"tag":550,"props":6364,"children":6365},{"class":552,"line":1169},[6366],{"type":24,"tag":550,"props":6367,"children":6368},{"style":557},[6369],{"type":33,"value":6370},"                    \"$param\": \"$util.escapeJavaScript($input.params().header.get($param))\"\n",{"type":24,"tag":550,"props":6372,"children":6373},{"class":552,"line":1177},[6374],{"type":24,"tag":550,"props":6375,"children":6376},{"style":557},[6377],{"type":33,"value":6378},"                    #if($foreach.hasNext),#end\n",{"type":24,"tag":550,"props":6380,"children":6381},{"class":552,"line":1194},[6382],{"type":24,"tag":550,"props":6383,"children":6384},{"style":557},[6385],{"type":33,"value":6386},"                    #end\n",{"type":24,"tag":550,"props":6388,"children":6389},{"class":552,"line":1227},[6390],{"type":24,"tag":550,"props":6391,"children":6392},{"style":557},[6393],{"type":33,"value":1130},{"type":24,"tag":550,"props":6395,"children":6396},{"class":552,"line":1235},[6397],{"type":24,"tag":550,"props":6398,"children":6399},{"style":557},[6400],{"type":33,"value":5562},{"type":24,"tag":550,"props":6402,"children":6403},{"class":552,"line":1243},[6404],{"type":24,"tag":550,"props":6405,"children":6406},{"style":557},[6407],{"type":33,"value":6408},"            '''\n",{"type":24,"tag":550,"props":6410,"children":6411},{"class":552,"line":1273},[6412],{"type":24,"tag":550,"props":6413,"children":6414},{"style":600},[6415],{"type":33,"value":5856},{"type":24,"tag":550,"props":6417,"children":6418},{"class":552,"line":1320},[6419],{"type":24,"tag":550,"props":6420,"children":6421},{"emptyLinePlaceholder":584},[6422],{"type":33,"value":587},{"type":24,"tag":550,"props":6424,"children":6425},{"class":552,"line":4707},[6426,6430,6435,6439],{"type":24,"tag":550,"props":6427,"children":6428},{"style":2650},[6429],{"type":33,"value":2653},{"type":24,"tag":550,"props":6431,"children":6432},{"style":600},[6433],{"type":33,"value":6434},".apigateway ",{"type":24,"tag":550,"props":6436,"children":6437},{"style":594},[6438],{"type":33,"value":736},{"type":24,"tag":550,"props":6440,"children":6441},{"style":600},[6442],{"type":33,"value":6443}," apigw.RestApi(\n",{"type":24,"tag":550,"props":6445,"children":6446},{"class":552,"line":4733},[6447,6451],{"type":24,"tag":550,"props":6448,"children":6449},{"style":2650},[6450],{"type":33,"value":2675},{"type":24,"tag":550,"props":6452,"children":6453},{"style":600},[6454],{"type":33,"value":817},{"type":24,"tag":550,"props":6456,"children":6457},{"class":552,"line":4742},[6458,6463],{"type":24,"tag":550,"props":6459,"children":6460},{"style":557},[6461],{"type":33,"value":6462},"            'FlaskAppEndpoint'",{"type":24,"tag":550,"props":6464,"children":6465},{"style":600},[6466],{"type":33,"value":817},{"type":24,"tag":550,"props":6468,"children":6469},{"class":552,"line":4751},[6470],{"type":24,"tag":550,"props":6471,"children":6472},{"style":600},[6473],{"type":33,"value":5968},{"type":24,"tag":550,"props":6475,"children":6476},{"class":552,"line":4795},[6477],{"type":24,"tag":550,"props":6478,"children":6479},{"emptyLinePlaceholder":584},[6480],{"type":33,"value":587},{"type":24,"tag":550,"props":6482,"children":6483},{"class":552,"line":4837},[6484,6488,6493,6498],{"type":24,"tag":550,"props":6485,"children":6486},{"style":2650},[6487],{"type":33,"value":2653},{"type":24,"tag":550,"props":6489,"children":6490},{"style":600},[6491],{"type":33,"value":6492},".apigateway.root.add_method(",{"type":24,"tag":550,"props":6494,"children":6495},{"style":557},[6496],{"type":33,"value":6497},"\"ANY\"",{"type":24,"tag":550,"props":6499,"children":6500},{"style":600},[6501],{"type":33,"value":662},{"type":24,"tag":550,"props":6503,"children":6504},{"class":552,"line":4879},[6505],{"type":24,"tag":550,"props":6506,"children":6507},{"emptyLinePlaceholder":584},[6508],{"type":33,"value":587},{"type":24,"tag":550,"props":6510,"children":6511},{"class":552,"line":4887},[6512,6516,6521,6525,6530,6535,6540],{"type":24,"tag":550,"props":6513,"children":6514},{"style":2650},[6515],{"type":33,"value":2653},{"type":24,"tag":550,"props":6517,"children":6518},{"style":600},[6519],{"type":33,"value":6520},".discord_interaction_webhook ",{"type":24,"tag":550,"props":6522,"children":6523},{"style":594},[6524],{"type":33,"value":736},{"type":24,"tag":550,"props":6526,"children":6527},{"style":2650},[6528],{"type":33,"value":6529}," self",{"type":24,"tag":550,"props":6531,"children":6532},{"style":600},[6533],{"type":33,"value":6534},".apigateway.root.add_resource(",{"type":24,"tag":550,"props":6536,"children":6537},{"style":557},[6538],{"type":33,"value":6539},"\"discord\"",{"type":24,"tag":550,"props":6541,"children":6542},{"style":600},[6543],{"type":33,"value":662},{"type":24,"tag":550,"props":6545,"children":6546},{"class":552,"line":4963},[6547],{"type":24,"tag":550,"props":6548,"children":6549},{"emptyLinePlaceholder":584},[6550],{"type":33,"value":587},{"type":24,"tag":550,"props":6552,"children":6553},{"class":552,"line":4971},[6554,6558,6563,6567],{"type":24,"tag":550,"props":6555,"children":6556},{"style":2650},[6557],{"type":33,"value":2653},{"type":24,"tag":550,"props":6559,"children":6560},{"style":600},[6561],{"type":33,"value":6562},".discord_interaction_webhook_integration ",{"type":24,"tag":550,"props":6564,"children":6565},{"style":594},[6566],{"type":33,"value":736},{"type":24,"tag":550,"props":6568,"children":6569},{"style":600},[6570],{"type":33,"value":6571}," apigw.LambdaIntegration(\n",{"type":24,"tag":550,"props":6573,"children":6574},{"class":552,"line":4994},[6575,6579],{"type":24,"tag":550,"props":6576,"children":6577},{"style":2650},[6578],{"type":33,"value":2675},{"type":24,"tag":550,"props":6580,"children":6581},{"style":600},[6582],{"type":33,"value":6583},".flask_app_lambda,\n",{"type":24,"tag":550,"props":6585,"children":6586},{"class":552,"line":5011},[6587,6592,6596,6600],{"type":24,"tag":550,"props":6588,"children":6589},{"style":1291},[6590],{"type":33,"value":6591},"            request_templates",{"type":24,"tag":550,"props":6593,"children":6594},{"style":594},[6595],{"type":33,"value":736},{"type":24,"tag":550,"props":6597,"children":6598},{"style":2650},[6599],{"type":33,"value":2547},{"type":24,"tag":550,"props":6601,"children":6602},{"style":600},[6603],{"type":33,"value":6604},".request_templates\n",{"type":24,"tag":550,"props":6606,"children":6607},{"class":552,"line":5029},[6608],{"type":24,"tag":550,"props":6609,"children":6610},{"style":600},[6611],{"type":33,"value":5968},{"type":24,"tag":550,"props":6613,"children":6614},{"class":552,"line":5038},[6615],{"type":24,"tag":550,"props":6616,"children":6617},{"emptyLinePlaceholder":584},[6618],{"type":33,"value":587},{"type":24,"tag":550,"props":6620,"children":6621},{"class":552,"line":5046},[6622,6626],{"type":24,"tag":550,"props":6623,"children":6624},{"style":2650},[6625],{"type":33,"value":2653},{"type":24,"tag":550,"props":6627,"children":6628},{"style":600},[6629],{"type":33,"value":6630},".discord_interaction_webhook.add_method(\n",{"type":24,"tag":550,"props":6632,"children":6633},{"class":552,"line":5072},[6634,6639],{"type":24,"tag":550,"props":6635,"children":6636},{"style":557},[6637],{"type":33,"value":6638},"            'POST'",{"type":24,"tag":550,"props":6640,"children":6641},{"style":600},[6642],{"type":33,"value":817},{"type":24,"tag":550,"props":6644,"children":6645},{"class":552,"line":5090},[6646,6650],{"type":24,"tag":550,"props":6647,"children":6648},{"style":2650},[6649],{"type":33,"value":2675},{"type":24,"tag":550,"props":6651,"children":6652},{"style":600},[6653],{"type":33,"value":6654},".discord_interaction_webhook_integration\n",{"type":24,"tag":550,"props":6656,"children":6657},{"class":552,"line":5098},[6658],{"type":24,"tag":550,"props":6659,"children":6660},{"style":600},[6661],{"type":33,"value":5968},{"type":24,"tag":29,"props":6663,"children":6664},{},[6665,6667,6672],{"type":33,"value":6666},"First we add some environment variables that will be made available to the Lambda function's execution environment. The ECS cluster and service name as well as our Discord application's ",{"type":24,"tag":64,"props":6668,"children":6670},{"className":6669},[],[6671],{"type":33,"value":4139},{"type":33,"value":6673}," are needed in the Lambda function for everything to work.",{"type":24,"tag":29,"props":6675,"children":6676},{},[6677],{"type":33,"value":6678},"We have to give the lambda function permissions to make changes to ECS since it will be interacting with ECS via boto3.",{"type":24,"tag":29,"props":6680,"children":6681},{},[6682,6688,6690,6695],{"type":24,"tag":64,"props":6683,"children":6685},{"className":6684},[],[6686],{"type":33,"value":6687},"self.request_templates",{"type":33,"value":6689}," is needed in order to pass the special security headers from the Discord ",{"type":24,"tag":64,"props":6691,"children":6693},{"className":6692},[],[6694],{"type":33,"value":184},{"type":33,"value":6696}," request that are needed for security. I couldn't find a lot of resources on how to make this work, but I learned that this uses Apache Velocity Template Language.",{"type":24,"tag":415,"props":6698,"children":6700},{"id":6699},"add-a-gitlab-ci-job-for-installing-dependencies-into-lambda-layer",[6701],{"type":33,"value":6702},"Add a GitLab CI job for installing dependencies into Lambda Layer",{"type":24,"tag":29,"props":6704,"children":6705},{},[6706],{"type":33,"value":6707},"There's one more step before we can push our code. We need to add another GitLab CI job that will install the Lambda dependencies so that they can be sent to the Lambda layer that we defined in our Lambda function. A Lambda Layer is where you install dependencies for this type of Lambda setup. Let's add the following stage:",{"type":24,"tag":365,"props":6709,"children":6713},{"code":6710,"language":6711,"meta":8,"className":6712,"style":8},"stages:\n  - build\n  - deploy\n\nimage: python:3.8\n\npip_install:\n  stage: build\n  rules:\n    - if: \"$CI_COMMIT_TAG\"\n      when: always\n  artifacts:\n    paths:\n      - layers/flask/python\n  script:\n    - pip install -r lambda/functions/interactions/requirements.txt -t layers/flask/python\n","yml","language-yml shiki shiki-themes github-light github-dark monokai",[6714],{"type":24,"tag":64,"props":6715,"children":6716},{"__ignoreMap":8},[6717,6728,6740,6751,6758,6773,6780,6792,6807,6818,6837,6852,6864,6876,6889,6900],{"type":24,"tag":550,"props":6718,"children":6719},{"class":552,"line":553},[6720,6724],{"type":24,"tag":550,"props":6721,"children":6722},{"style":3072},[6723],{"type":33,"value":3075},{"type":24,"tag":550,"props":6725,"children":6726},{"style":600},[6727],{"type":33,"value":1270},{"type":24,"tag":550,"props":6729,"children":6730},{"class":552,"line":563},[6731,6735],{"type":24,"tag":550,"props":6732,"children":6733},{"style":600},[6734],{"type":33,"value":3087},{"type":24,"tag":550,"props":6736,"children":6737},{"style":557},[6738],{"type":33,"value":6739},"build\n",{"type":24,"tag":550,"props":6741,"children":6742},{"class":552,"line":572},[6743,6747],{"type":24,"tag":550,"props":6744,"children":6745},{"style":600},[6746],{"type":33,"value":3087},{"type":24,"tag":550,"props":6748,"children":6749},{"style":557},[6750],{"type":33,"value":3092},{"type":24,"tag":550,"props":6752,"children":6753},{"class":552,"line":580},[6754],{"type":24,"tag":550,"props":6755,"children":6756},{"emptyLinePlaceholder":584},[6757],{"type":33,"value":587},{"type":24,"tag":550,"props":6759,"children":6760},{"class":552,"line":590},[6761,6765,6769],{"type":24,"tag":550,"props":6762,"children":6763},{"style":3072},[6764],{"type":33,"value":3107},{"type":24,"tag":550,"props":6766,"children":6767},{"style":600},[6768],{"type":33,"value":807},{"type":24,"tag":550,"props":6770,"children":6771},{"style":557},[6772],{"type":33,"value":3116},{"type":24,"tag":550,"props":6774,"children":6775},{"class":552,"line":606},[6776],{"type":24,"tag":550,"props":6777,"children":6778},{"emptyLinePlaceholder":584},[6779],{"type":33,"value":587},{"type":24,"tag":550,"props":6781,"children":6782},{"class":552,"line":614},[6783,6788],{"type":24,"tag":550,"props":6784,"children":6785},{"style":3072},[6786],{"type":33,"value":6787},"pip_install",{"type":24,"tag":550,"props":6789,"children":6790},{"style":600},[6791],{"type":33,"value":1270},{"type":24,"tag":550,"props":6793,"children":6794},{"class":552,"line":627},[6795,6799,6803],{"type":24,"tag":550,"props":6796,"children":6797},{"style":3072},[6798],{"type":33,"value":3143},{"type":24,"tag":550,"props":6800,"children":6801},{"style":600},[6802],{"type":33,"value":807},{"type":24,"tag":550,"props":6804,"children":6805},{"style":557},[6806],{"type":33,"value":6739},{"type":24,"tag":550,"props":6808,"children":6809},{"class":552,"line":635},[6810,6814],{"type":24,"tag":550,"props":6811,"children":6812},{"style":3072},[6813],{"type":33,"value":3159},{"type":24,"tag":550,"props":6815,"children":6816},{"style":600},[6817],{"type":33,"value":1270},{"type":24,"tag":550,"props":6819,"children":6820},{"class":552,"line":665},[6821,6825,6829,6833],{"type":24,"tag":550,"props":6822,"children":6823},{"style":600},[6824],{"type":33,"value":3171},{"type":24,"tag":550,"props":6826,"children":6827},{"style":3072},[6828],{"type":33,"value":1249},{"type":24,"tag":550,"props":6830,"children":6831},{"style":600},[6832],{"type":33,"value":807},{"type":24,"tag":550,"props":6834,"children":6835},{"style":557},[6836],{"type":33,"value":3184},{"type":24,"tag":550,"props":6838,"children":6839},{"class":552,"line":691},[6840,6844,6848],{"type":24,"tag":550,"props":6841,"children":6842},{"style":3072},[6843],{"type":33,"value":3192},{"type":24,"tag":550,"props":6845,"children":6846},{"style":600},[6847],{"type":33,"value":807},{"type":24,"tag":550,"props":6849,"children":6850},{"style":557},[6851],{"type":33,"value":3201},{"type":24,"tag":550,"props":6853,"children":6854},{"class":552,"line":717},[6855,6860],{"type":24,"tag":550,"props":6856,"children":6857},{"style":3072},[6858],{"type":33,"value":6859},"  artifacts",{"type":24,"tag":550,"props":6861,"children":6862},{"style":600},[6863],{"type":33,"value":1270},{"type":24,"tag":550,"props":6865,"children":6866},{"class":552,"line":725},[6867,6872],{"type":24,"tag":550,"props":6868,"children":6869},{"style":3072},[6870],{"type":33,"value":6871},"    paths",{"type":24,"tag":550,"props":6873,"children":6874},{"style":600},[6875],{"type":33,"value":1270},{"type":24,"tag":550,"props":6877,"children":6878},{"class":552,"line":770},[6879,6884],{"type":24,"tag":550,"props":6880,"children":6881},{"style":600},[6882],{"type":33,"value":6883},"      - ",{"type":24,"tag":550,"props":6885,"children":6886},{"style":557},[6887],{"type":33,"value":6888},"layers/flask/python\n",{"type":24,"tag":550,"props":6890,"children":6891},{"class":552,"line":778},[6892,6896],{"type":24,"tag":550,"props":6893,"children":6894},{"style":3072},[6895],{"type":33,"value":3256},{"type":24,"tag":550,"props":6897,"children":6898},{"style":600},[6899],{"type":33,"value":1270},{"type":24,"tag":550,"props":6901,"children":6902},{"class":552,"line":796},[6903,6907],{"type":24,"tag":550,"props":6904,"children":6905},{"style":600},[6906],{"type":33,"value":3171},{"type":24,"tag":550,"props":6908,"children":6909},{"style":557},[6910],{"type":33,"value":6911},"pip install -r lambda/functions/interactions/requirements.txt -t layers/flask/python\n",{"type":24,"tag":29,"props":6913,"children":6914},{},[6915,6917,6923,6925,6930,6932,6938,6939,6945,6947,6953,6954,6959],{"type":33,"value":6916},"Now we are installing dependencies into a target location (with the ",{"type":24,"tag":64,"props":6918,"children":6920},{"className":6919},[],[6921],{"type":33,"value":6922},"-t",{"type":33,"value":6924}," flag) that our Lambda Layer will be able to use in the ",{"type":24,"tag":64,"props":6926,"children":6928},{"className":6927},[],[6929],{"type":33,"value":3131},{"type":33,"value":6931}," GitLab CI job. This is because we have indicated the path to ",{"type":24,"tag":64,"props":6933,"children":6935},{"className":6934},[],[6936],{"type":33,"value":6937},"layers/flask/python",{"type":33,"value":2247},{"type":24,"tag":64,"props":6940,"children":6942},{"className":6941},[],[6943],{"type":33,"value":6944},"paths",{"type":33,"value":6946}," array of ",{"type":24,"tag":64,"props":6948,"children":6950},{"className":6949},[],[6951],{"type":33,"value":6952},"artifacts",{"type":33,"value":2247},{"type":24,"tag":64,"props":6955,"children":6957},{"className":6956},[],[6958],{"type":33,"value":6787},{"type":33,"value":6960}," job. There are other ways to add the pip dependencies to the Lambda Layers. We don't absolutely need this to be done in a separate CI job.",{"type":24,"tag":29,"props":6962,"children":6963},{},[6964],{"type":33,"value":6965},"Now tag and push the code to GitLab and check to see that the pipeline runs successfully.",{"type":24,"tag":415,"props":6967,"children":6969},{"id":6968},"add-the-api-gateway-url-to-discord-application-settings",[6970],{"type":33,"value":6971},"Add the API Gateway URL to Discord Application settings",{"type":24,"tag":29,"props":6973,"children":6974},{},[6975],{"type":33,"value":6976},"If everything runs smoothly, we should see a URL in the very last lines of the pipeline. This is the URL for our API Gateway endpoint:",{"type":24,"tag":365,"props":6978,"children":6980},{"code":6979},"https://abc123xyz.execute-api.us-east-1.amazonaws.com/prod/\n",[6981],{"type":24,"tag":64,"props":6982,"children":6983},{"__ignoreMap":8},[6984],{"type":33,"value":6979},{"type":24,"tag":29,"props":6986,"children":6987},{},[6988,6990,6995,6997,7002,7003,7008],{"type":33,"value":6989},"We need to add ",{"type":24,"tag":64,"props":6991,"children":6993},{"className":6992},[],[6994],{"type":33,"value":19},{"type":33,"value":6996}," to the end of this URL and then add that to our the ",{"type":24,"tag":64,"props":6998,"children":7000},{"className":6999},[],[7001],{"type":33,"value":1422},{"type":33,"value":2247},{"type":24,"tag":64,"props":7004,"children":7006},{"className":7005},[],[7007],{"type":33,"value":346},{"type":33,"value":7009}," section of our Discord application's admin page:",{"type":24,"tag":365,"props":7011,"children":7013},{"code":7012},"https://abc123xyz.execute-api.us-east-1.amazonaws.com/prod/discord\n",[7014],{"type":24,"tag":64,"props":7015,"children":7016},{"__ignoreMap":8},[7017],{"type":33,"value":7012},{"type":24,"tag":29,"props":7019,"children":7020},{},[7021,7023,7030],{"type":33,"value":7022},"When we add this URL in the application settings, Discord will make sure that our endpoint is properly verifying the request based on its headers. Check out ",{"type":24,"tag":36,"props":7024,"children":7027},{"href":7025,"rel":7026},"https://github.com/discord/discord-interactions-python/blob/main/discord_interactions/__init__.py#L31",[40],[7028],{"type":33,"value":7029},"this function",{"type":33,"value":7031}," to see how it works:",{"type":24,"tag":365,"props":7033,"children":7035},{"code":7034,"language":543,"meta":8,"className":544,"style":8},"def verify_key_decorator(client_public_key):\n    from flask import request, jsonify\n\n    # https://stackoverflow.com/questions/51691730/flask-middleware-for-specific-route\n    def _decorator(f):\n        @wraps(f)\n        def __decorator(*args, **kwargs):\n            # Verify request\n            signature = request.headers.get('X-Signature-Ed25519')\n            timestamp = request.headers.get('X-Signature-Timestamp')\n            if signature is None or timestamp is None or not verify_key(request.data, signature, timestamp, client_public_key):\n                return 'Bad request signature', 401\n\n            # Automatically respond to pings\n            if request.json and request.json.get('type') == InteractionType.PING:\n                return jsonify({\n                    'type': InteractionResponseType.PONG\n                })\n\n            # Pass through\n            return f(*args, **kwargs)\n        return __decorator\n    return _decorator\n",[7036],{"type":24,"tag":64,"props":7037,"children":7038},{"__ignoreMap":8},[7039,7064,7085,7092,7100,7124,7137,7179,7187,7213,7238,7293,7315,7322,7330,7380,7391,7409,7417,7424,7432,7462,7474],{"type":24,"tag":550,"props":7040,"children":7041},{"class":552,"line":553},[7042,7046,7051,7055,7060],{"type":24,"tag":550,"props":7043,"children":7044},{"style":739},[7045],{"type":33,"value":4317},{"type":24,"tag":550,"props":7047,"children":7048},{"style":4249},[7049],{"type":33,"value":7050}," verify_key_decorator",{"type":24,"tag":550,"props":7052,"children":7053},{"style":600},[7054],{"type":33,"value":2498},{"type":24,"tag":550,"props":7056,"children":7057},{"style":2544},[7058],{"type":33,"value":7059},"client_public_key",{"type":24,"tag":550,"props":7061,"children":7062},{"style":600},[7063],{"type":33,"value":2517},{"type":24,"tag":550,"props":7065,"children":7066},{"class":552,"line":563},[7067,7072,7076,7080],{"type":24,"tag":550,"props":7068,"children":7069},{"style":594},[7070],{"type":33,"value":7071},"    from",{"type":24,"tag":550,"props":7073,"children":7074},{"style":600},[7075],{"type":33,"value":4037},{"type":24,"tag":550,"props":7077,"children":7078},{"style":594},[7079],{"type":33,"value":597},{"type":24,"tag":550,"props":7081,"children":7082},{"style":600},[7083],{"type":33,"value":7084}," request, jsonify\n",{"type":24,"tag":550,"props":7086,"children":7087},{"class":552,"line":572},[7088],{"type":24,"tag":550,"props":7089,"children":7090},{"emptyLinePlaceholder":584},[7091],{"type":33,"value":587},{"type":24,"tag":550,"props":7093,"children":7094},{"class":552,"line":580},[7095],{"type":24,"tag":550,"props":7096,"children":7097},{"style":2641},[7098],{"type":33,"value":7099},"    # https://stackoverflow.com/questions/51691730/flask-middleware-for-specific-route\n",{"type":24,"tag":550,"props":7101,"children":7102},{"class":552,"line":590},[7103,7107,7112,7116,7120],{"type":24,"tag":550,"props":7104,"children":7105},{"style":739},[7106],{"type":33,"value":2532},{"type":24,"tag":550,"props":7108,"children":7109},{"style":4249},[7110],{"type":33,"value":7111}," _decorator",{"type":24,"tag":550,"props":7113,"children":7114},{"style":600},[7115],{"type":33,"value":2498},{"type":24,"tag":550,"props":7117,"children":7118},{"style":2544},[7119],{"type":33,"value":1209},{"type":24,"tag":550,"props":7121,"children":7122},{"style":600},[7123],{"type":33,"value":2517},{"type":24,"tag":550,"props":7125,"children":7126},{"class":552,"line":606},[7127,7132],{"type":24,"tag":550,"props":7128,"children":7129},{"style":4249},[7130],{"type":33,"value":7131},"        @wraps",{"type":24,"tag":550,"props":7133,"children":7134},{"style":600},[7135],{"type":33,"value":7136},"(f)\n",{"type":24,"tag":550,"props":7138,"children":7139},{"class":552,"line":614},[7140,7145,7150,7154,7158,7163,7167,7171,7175],{"type":24,"tag":550,"props":7141,"children":7142},{"style":739},[7143],{"type":33,"value":7144},"        def",{"type":24,"tag":550,"props":7146,"children":7147},{"style":4249},[7148],{"type":33,"value":7149}," __decorator",{"type":24,"tag":550,"props":7151,"children":7152},{"style":600},[7153],{"type":33,"value":2498},{"type":24,"tag":550,"props":7155,"children":7156},{"style":594},[7157],{"type":33,"value":3430},{"type":24,"tag":550,"props":7159,"children":7160},{"style":2544},[7161],{"type":33,"value":7162},"args",{"type":24,"tag":550,"props":7164,"children":7165},{"style":600},[7166],{"type":33,"value":237},{"type":24,"tag":550,"props":7168,"children":7169},{"style":594},[7170],{"type":33,"value":2584},{"type":24,"tag":550,"props":7172,"children":7173},{"style":2544},[7174],{"type":33,"value":2589},{"type":24,"tag":550,"props":7176,"children":7177},{"style":600},[7178],{"type":33,"value":2517},{"type":24,"tag":550,"props":7180,"children":7181},{"class":552,"line":627},[7182],{"type":24,"tag":550,"props":7183,"children":7184},{"style":2641},[7185],{"type":33,"value":7186},"            # Verify request\n",{"type":24,"tag":550,"props":7188,"children":7189},{"class":552,"line":635},[7190,7195,7199,7204,7209],{"type":24,"tag":550,"props":7191,"children":7192},{"style":600},[7193],{"type":33,"value":7194},"            signature ",{"type":24,"tag":550,"props":7196,"children":7197},{"style":594},[7198],{"type":33,"value":736},{"type":24,"tag":550,"props":7200,"children":7201},{"style":600},[7202],{"type":33,"value":7203}," request.headers.get(",{"type":24,"tag":550,"props":7205,"children":7206},{"style":557},[7207],{"type":33,"value":7208},"'X-Signature-Ed25519'",{"type":24,"tag":550,"props":7210,"children":7211},{"style":600},[7212],{"type":33,"value":662},{"type":24,"tag":550,"props":7214,"children":7215},{"class":552,"line":665},[7216,7221,7225,7229,7234],{"type":24,"tag":550,"props":7217,"children":7218},{"style":600},[7219],{"type":33,"value":7220},"            timestamp ",{"type":24,"tag":550,"props":7222,"children":7223},{"style":594},[7224],{"type":33,"value":736},{"type":24,"tag":550,"props":7226,"children":7227},{"style":600},[7228],{"type":33,"value":7203},{"type":24,"tag":550,"props":7230,"children":7231},{"style":557},[7232],{"type":33,"value":7233},"'X-Signature-Timestamp'",{"type":24,"tag":550,"props":7235,"children":7236},{"style":600},[7237],{"type":33,"value":662},{"type":24,"tag":550,"props":7239,"children":7240},{"class":552,"line":691},[7241,7246,7251,7256,7261,7266,7271,7275,7279,7283,7288],{"type":24,"tag":550,"props":7242,"children":7243},{"style":594},[7244],{"type":33,"value":7245},"            if",{"type":24,"tag":550,"props":7247,"children":7248},{"style":600},[7249],{"type":33,"value":7250}," signature ",{"type":24,"tag":550,"props":7252,"children":7253},{"style":594},[7254],{"type":33,"value":7255},"is",{"type":24,"tag":550,"props":7257,"children":7258},{"style":639},[7259],{"type":33,"value":7260}," None",{"type":24,"tag":550,"props":7262,"children":7263},{"style":594},[7264],{"type":33,"value":7265}," or",{"type":24,"tag":550,"props":7267,"children":7268},{"style":600},[7269],{"type":33,"value":7270}," timestamp ",{"type":24,"tag":550,"props":7272,"children":7273},{"style":594},[7274],{"type":33,"value":7255},{"type":24,"tag":550,"props":7276,"children":7277},{"style":639},[7278],{"type":33,"value":7260},{"type":24,"tag":550,"props":7280,"children":7281},{"style":594},[7282],{"type":33,"value":7265},{"type":24,"tag":550,"props":7284,"children":7285},{"style":594},[7286],{"type":33,"value":7287}," not",{"type":24,"tag":550,"props":7289,"children":7290},{"style":600},[7291],{"type":33,"value":7292}," verify_key(request.data, signature, timestamp, client_public_key):\n",{"type":24,"tag":550,"props":7294,"children":7295},{"class":552,"line":717},[7296,7301,7306,7310],{"type":24,"tag":550,"props":7297,"children":7298},{"style":594},[7299],{"type":33,"value":7300},"                return",{"type":24,"tag":550,"props":7302,"children":7303},{"style":557},[7304],{"type":33,"value":7305}," 'Bad request signature'",{"type":24,"tag":550,"props":7307,"children":7308},{"style":600},[7309],{"type":33,"value":237},{"type":24,"tag":550,"props":7311,"children":7312},{"style":639},[7313],{"type":33,"value":7314},"401\n",{"type":24,"tag":550,"props":7316,"children":7317},{"class":552,"line":725},[7318],{"type":24,"tag":550,"props":7319,"children":7320},{"emptyLinePlaceholder":584},[7321],{"type":33,"value":587},{"type":24,"tag":550,"props":7323,"children":7324},{"class":552,"line":770},[7325],{"type":24,"tag":550,"props":7326,"children":7327},{"style":2641},[7328],{"type":33,"value":7329},"            # Automatically respond to pings\n",{"type":24,"tag":550,"props":7331,"children":7332},{"class":552,"line":778},[7333,7337,7342,7347,7352,7357,7362,7366,7371,7376],{"type":24,"tag":550,"props":7334,"children":7335},{"style":594},[7336],{"type":33,"value":7245},{"type":24,"tag":550,"props":7338,"children":7339},{"style":600},[7340],{"type":33,"value":7341}," request.json ",{"type":24,"tag":550,"props":7343,"children":7344},{"style":594},[7345],{"type":33,"value":7346},"and",{"type":24,"tag":550,"props":7348,"children":7349},{"style":600},[7350],{"type":33,"value":7351}," request.json.get(",{"type":24,"tag":550,"props":7353,"children":7354},{"style":557},[7355],{"type":33,"value":7356},"'type'",{"type":24,"tag":550,"props":7358,"children":7359},{"style":600},[7360],{"type":33,"value":7361},") ",{"type":24,"tag":550,"props":7363,"children":7364},{"style":594},[7365],{"type":33,"value":4355},{"type":24,"tag":550,"props":7367,"children":7368},{"style":600},[7369],{"type":33,"value":7370}," InteractionType.",{"type":24,"tag":550,"props":7372,"children":7373},{"style":639},[7374],{"type":33,"value":7375},"PING",{"type":24,"tag":550,"props":7377,"children":7378},{"style":600},[7379],{"type":33,"value":1270},{"type":24,"tag":550,"props":7381,"children":7382},{"class":552,"line":796},[7383,7387],{"type":24,"tag":550,"props":7384,"children":7385},{"style":594},[7386],{"type":33,"value":7300},{"type":24,"tag":550,"props":7388,"children":7389},{"style":600},[7390],{"type":33,"value":5445},{"type":24,"tag":550,"props":7392,"children":7393},{"class":552,"line":820},[7394,7399,7404],{"type":24,"tag":550,"props":7395,"children":7396},{"style":557},[7397],{"type":33,"value":7398},"                    'type'",{"type":24,"tag":550,"props":7400,"children":7401},{"style":600},[7402],{"type":33,"value":7403},": InteractionResponseType.",{"type":24,"tag":550,"props":7405,"children":7406},{"style":639},[7407],{"type":33,"value":7408},"PONG\n",{"type":24,"tag":550,"props":7410,"children":7411},{"class":552,"line":842},[7412],{"type":24,"tag":550,"props":7413,"children":7414},{"style":600},[7415],{"type":33,"value":7416},"                })\n",{"type":24,"tag":550,"props":7418,"children":7419},{"class":552,"line":856},[7420],{"type":24,"tag":550,"props":7421,"children":7422},{"emptyLinePlaceholder":584},[7423],{"type":33,"value":587},{"type":24,"tag":550,"props":7425,"children":7426},{"class":552,"line":865},[7427],{"type":24,"tag":550,"props":7428,"children":7429},{"style":2641},[7430],{"type":33,"value":7431},"            # Pass through\n",{"type":24,"tag":550,"props":7433,"children":7434},{"class":552,"line":887},[7435,7440,7445,7449,7454,7458],{"type":24,"tag":550,"props":7436,"children":7437},{"style":594},[7438],{"type":33,"value":7439},"            return",{"type":24,"tag":550,"props":7441,"children":7442},{"style":600},[7443],{"type":33,"value":7444}," f(",{"type":24,"tag":550,"props":7446,"children":7447},{"style":594},[7448],{"type":33,"value":3430},{"type":24,"tag":550,"props":7450,"children":7451},{"style":600},[7452],{"type":33,"value":7453},"args, ",{"type":24,"tag":550,"props":7455,"children":7456},{"style":594},[7457],{"type":33,"value":2584},{"type":24,"tag":550,"props":7459,"children":7460},{"style":600},[7461],{"type":33,"value":2635},{"type":24,"tag":550,"props":7463,"children":7464},{"class":552,"line":909},[7465,7469],{"type":24,"tag":550,"props":7466,"children":7467},{"style":594},[7468],{"type":33,"value":4372},{"type":24,"tag":550,"props":7470,"children":7471},{"style":600},[7472],{"type":33,"value":7473}," __decorator\n",{"type":24,"tag":550,"props":7475,"children":7476},{"class":552,"line":931},[7477,7481],{"type":24,"tag":550,"props":7478,"children":7479},{"style":594},[7480],{"type":33,"value":5623},{"type":24,"tag":550,"props":7482,"children":7483},{"style":600},[7484],{"type":33,"value":7485}," _decorator\n",{"type":24,"tag":29,"props":7487,"children":7488},{},[7489],{"type":33,"value":7490},"If it fails verification, we will not be able to add the URL and it will not work. You might want to add some additional logging to the Lambda function if you are not able to add the URL successfully.",{"type":24,"tag":29,"props":7492,"children":7493},{},[7494,7496,7503],{"type":33,"value":7495},"This is all covered in ",{"type":24,"tag":36,"props":7497,"children":7500},{"href":7498,"rel":7499},"https://discord.com/developers/docs/interactions/slash-commands",[40],[7501],{"type":33,"value":7502},"the documentation for Discord Interactions",{"type":33,"value":173},{"type":24,"tag":29,"props":7505,"children":7506},{},[7507,7509,7515,7516,7522],{"type":33,"value":7508},"Now you should be able to run the Discord slash commands. You can get the status of your ECS cluster and scale it to either 1 or 0 for ",{"type":24,"tag":64,"props":7510,"children":7512},{"className":7511},[],[7513],{"type":33,"value":7514},"ON",{"type":33,"value":245},{"type":24,"tag":64,"props":7517,"children":7519},{"className":7518},[],[7520],{"type":33,"value":7521},"OFF",{"type":33,"value":173},{"type":24,"tag":59,"props":7524,"children":7526},{"id":7525},"overview",[7527],{"type":33,"value":7528},"Overview",{"type":24,"tag":29,"props":7530,"children":7531},{},[7532],{"type":33,"value":7533},"Here's an overview of what we covered:",{"type":24,"tag":29,"props":7535,"children":7536},{},[7537],{"type":24,"tag":299,"props":7538,"children":7539},{"alt":301,"src":302},[],{"type":24,"tag":7541,"props":7542,"children":7544},"ol",{"start":7543},0,[7545,7550,7555,7560,7565,7570,7583,7588,7600,7605,7621,7626,7631,7636,7641,7653,7665,7677,7696],{"type":24,"tag":124,"props":7546,"children":7547},{},[7548],{"type":33,"value":7549},"This is my computer. For development of this project (and most other projects) I used Windows with WSL2.",{"type":24,"tag":124,"props":7551,"children":7552},{},[7553],{"type":33,"value":7554},"GitLab CI - This is used to run our automated pipelines whenever we push a tag.",{"type":24,"tag":124,"props":7556,"children":7557},{},[7558],{"type":33,"value":7559},"The CDK CLI is used to create, update and delete the infrastructure in our AWS account.",{"type":24,"tag":124,"props":7561,"children":7562},{},[7563],{"type":33,"value":7564},"Valheim - The client for the game server that we set up",{"type":24,"tag":124,"props":7566,"children":7567},{},[7568],{"type":33,"value":7569},"The public IP address of the ECS Task that can be used to connect to our server on port 2456.",{"type":24,"tag":124,"props":7571,"children":7572},{},[7573,7575,7582],{"type":33,"value":7574},"The ECS Cluster that runs the actual docker container for the Valheim server. By default, the image used is ",{"type":24,"tag":36,"props":7576,"children":7579},{"href":7577,"rel":7578},"https://hub.docker.com/r/lloesche/valheim-server",[40],[7580],{"type":33,"value":7581},"lloesche/valheim-server",{"type":33,"value":173},{"type":24,"tag":124,"props":7584,"children":7585},{},[7586],{"type":33,"value":7587},"EFS - This is the file system that is mounted onto the container of the ECS task where our game's world data is stored.",{"type":24,"tag":124,"props":7589,"children":7590},{},[7591,7593,7598],{"type":33,"value":7592},"AWS Backup (Optional) - This is an optional feature of the ",{"type":24,"tag":64,"props":7594,"children":7596},{"className":7595},[],[7597],{"type":33,"value":69},{"type":33,"value":7599}," construct that can make regular backups of our EFS file system.",{"type":24,"tag":124,"props":7601,"children":7602},{},[7603],{"type":33,"value":7604},"Events (Optional) - AWS Events can be used to scale the number of ECS tasks between 0 and 1.",{"type":24,"tag":124,"props":7606,"children":7607},{},[7608,7610,7619],{"type":33,"value":7609},"This is the ",{"type":24,"tag":36,"props":7611,"children":7613},{"href":79,"rel":7612},[40],[7614],{"type":24,"tag":64,"props":7615,"children":7617},{"className":7616},[],[7618],{"type":33,"value":69},{"type":33,"value":7620}," construct that I use in this project.",{"type":24,"tag":124,"props":7622,"children":7623},{},[7624],{"type":33,"value":7625},"S3 bucket for syncing data to and from EFS with DataSync (WIP)",{"type":24,"tag":124,"props":7627,"children":7628},{},[7629],{"type":33,"value":7630},"DataSync for moving game data between EFS and S3.",{"type":24,"tag":124,"props":7632,"children":7633},{},[7634],{"type":33,"value":7635},"The Slash Commands that we set up",{"type":24,"tag":124,"props":7637,"children":7638},{},[7639],{"type":33,"value":7640},"Discord",{"type":24,"tag":124,"props":7642,"children":7643},{},[7644,7646,7651],{"type":33,"value":7645},"Discord Interactions sends and a ",{"type":24,"tag":64,"props":7647,"children":7649},{"className":7648},[],[7650],{"type":33,"value":184},{"type":33,"value":7652}," request",{"type":24,"tag":124,"props":7654,"children":7655},{},[7656,7658,7663],{"type":33,"value":7657},"The API Gateway endpoint that we configured to handle Discord Interaction ",{"type":24,"tag":64,"props":7659,"children":7661},{"className":7660},[],[7662],{"type":33,"value":184},{"type":33,"value":7664}," requests.",{"type":24,"tag":124,"props":7666,"children":7667},{},[7668,7670,7675],{"type":33,"value":7669},"The Lambda function running a simple Flask app that responds to the Interaction ",{"type":24,"tag":64,"props":7671,"children":7673},{"className":7672},[],[7674],{"type":33,"value":184},{"type":33,"value":7676}," request.",{"type":24,"tag":124,"props":7678,"children":7679},{},[7680,7682,7687,7688,7694],{"type":33,"value":7681},"boto3 - This is the AWS SDK Python library included in the Python execution environment that allows us to interact with the resources in our AWS account. In particular, the interactions we use from boto3 are the ",{"type":24,"tag":64,"props":7683,"children":7685},{"className":7684},[],[7686],{"type":33,"value":192},{"type":33,"value":245},{"type":24,"tag":64,"props":7689,"children":7691},{"className":7690},[],[7692],{"type":33,"value":7693},"describe_servics",{"type":33,"value":7695}," methods from the ECS module. This allows us to turn our server on and off and also get the status.",{"type":24,"tag":124,"props":7697,"children":7698},{},[7699,7701,7707],{"type":33,"value":7700},"This represents the ",{"type":24,"tag":64,"props":7702,"children":7704},{"className":7703},[],[7705],{"type":33,"value":7706},"valheim-server-stack",{"type":33,"value":7708}," we defined in our CDK application.",{"type":24,"tag":59,"props":7710,"children":7712},{"id":7711},"todo",[7713],{"type":33,"value":7714},"TODO",{"type":24,"tag":29,"props":7716,"children":7717},{},[7718],{"type":33,"value":7719},"There are still some things that I'm working on finalizing.",{"type":24,"tag":120,"props":7721,"children":7722},{},[7723,7728,7733,7738,7743],{"type":24,"tag":124,"props":7724,"children":7725},{},[7726],{"type":33,"value":7727},"DataSync for easily moving data between S3 and EFS",{"type":24,"tag":124,"props":7729,"children":7730},{},[7731],{"type":33,"value":7732},"Report billing data with an additional slash command sub-command",{"type":24,"tag":124,"props":7734,"children":7735},{},[7736],{"type":33,"value":7737},"Add tagging to the resources in our stack to make the billing command easier to implement.",{"type":24,"tag":124,"props":7739,"children":7740},{},[7741],{"type":33,"value":7742},"Get feedback from the Discord, CDK and Valheim communities about what I can improve here",{"type":24,"tag":124,"props":7744,"children":7745},{},[7746,7748],{"type":33,"value":7747},"Contribute to ",{"type":24,"tag":36,"props":7749,"children":7751},{"href":79,"rel":7750},[40],[7752],{"type":24,"tag":64,"props":7753,"children":7755},{"className":7754},[],[7756],{"type":33,"value":7757},"gotodeploy/cdk-valheim",{"type":24,"tag":29,"props":7759,"children":7760},{},[7761],{"type":33,"value":7762},"Thanks for reading!",{"type":24,"tag":7764,"props":7765,"children":7766},"style",{},[7767],{"type":33,"value":7768},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":8,"searchDepth":563,"depth":563,"links":7770},[7771,7773,7774,7778,7779,7784,7785,7789,7790],{"id":61,"depth":563,"text":7772},"cdk-valheim construct on GitHub",{"id":141,"depth":563,"text":144},{"id":311,"depth":563,"text":314,"children":7775},[7776,7777],{"id":417,"depth":572,"text":420},{"id":524,"depth":572,"text":527},{"id":1442,"depth":563,"text":1445},{"id":2054,"depth":563,"text":2057,"children":7780},[7781,7782,7783],{"id":2102,"depth":572,"text":2105},{"id":3041,"depth":572,"text":3044},{"id":3435,"depth":572,"text":3438},{"id":3823,"depth":563,"text":3826},{"id":5729,"depth":563,"text":5732,"children":7786},[7787,7788],{"id":6699,"depth":572,"text":6702},{"id":6968,"depth":572,"text":6971},{"id":7525,"depth":563,"text":7528},{"id":7711,"depth":563,"text":7714},"markdown","content:2021:03:18:on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions.md","content","2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions.md","2021/03/18/on-demand-dedicated-serverless-valheim-server-with-cdk-discrod-interactions","md",1731480222051]