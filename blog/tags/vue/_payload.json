[{"data":1,"prerenderedAt":21253},["ShallowReactive",2],{"/blog/tags/vue/":3},[4,3496,5361,5471,5515,6392,7527,8130,8362,9077,10484,11058,15528,21150],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"date":11,"image":12,"tags":13,"external":27,"comments":37,"body":38,"_type":3490,"_id":3491,"_source":3492,"_file":3493,"_stem":3494,"_extension":3495},"/2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem","27",false,"","Python, Vue, Chinese-LLaMA-2 and The Three-Body Problem","Translating The Three-Body Problem book to English with Chinese LLMs, making visualizations with stable diffusion and running n-body simulations with CUDA","2023-11-23","/static/three-body-problem/cover.png",[14,15,16,17,18,19,20,21,22,23,24,25,26],"three-body-problem","llama","llm","ai","chinese","python","nvidia","cuda","gpu","stable-diffusion","langchain","vue","three.js",[28,31,34],{"link":29,"site":30},"https://news.ycombinator.com/item?id=38393757","hn",{"link":32,"site":33},"https://www.reddit.com/r/threebodyproblem/comments/1823l5j/python_vue_chinesellama2_and_the_threebody_problem/","reddit",{"link":35,"site":36},"https://twitter.com/briancaffey/status/1727710878349332614","x",true,{"type":39,"children":40,"toc":3473},"root",[41,50,56,101,106,111,118,123,132,148,153,161,166,174,179,187,192,202,207,213,218,241,246,279,286,300,313,319,333,338,366,374,380,385,390,395,400,409,414,419,424,447,453,458,714,722,736,744,752,954,966,974,979,1017,1023,1028,1036,1046,1054,1062,1067,1073,1078,1084,1089,2202,2207,2318,2323,2733,2760,2765,2939,2952,2965,3129,3134,3193,3206,3211,3272,3284,3289,3294,3299,3307,3313,3318,3323,3329,3334,3342,3347,3355,3360,3365,3370,3376,3389,3394,3445,3459,3467],{"type":42,"tag":43,"props":44,"children":46},"element","h1",{"id":45},"tldr",[47],{"type":48,"value":49},"text","tl;dr",{"type":42,"tag":51,"props":52,"children":53},"p",{},[54],{"type":48,"value":55},"This articles brings together several of my interest, both old and new:",{"type":42,"tag":57,"props":58,"children":59},"ul",{},[60,66,71,76,81,86,91,96],{"type":42,"tag":61,"props":62,"children":63},"li",{},[64],{"type":48,"value":65},"The Sci-Fi book series 'Three-Body Problem' by Liu Cixun",{"type":42,"tag":61,"props":67,"children":68},{},[69],{"type":48,"value":70},"Chinese language",{"type":42,"tag":61,"props":72,"children":73},{},[74],{"type":48,"value":75},"NLP techniques",{"type":42,"tag":61,"props":77,"children":78},{},[79],{"type":48,"value":80},"Large Language Models (LLMs)",{"type":42,"tag":61,"props":82,"children":83},{},[84],{"type":48,"value":85},"Stable Diffusion",{"type":42,"tag":61,"props":87,"children":88},{},[89],{"type":48,"value":90},"Data visualization and 3D graphics",{"type":42,"tag":61,"props":92,"children":93},{},[94],{"type":48,"value":95},"Mathematics",{"type":42,"tag":61,"props":97,"children":98},{},[99],{"type":48,"value":100},"NVIDIA / CUDA",{"type":42,"tag":51,"props":102,"children":103},{},[104],{"type":48,"value":105},"This is a linguistic, artistic and computational experiment with the two big AI algorithms of 2023: large language models (LLMs) and Stable Diffusion. I used the leading open-source LLMs from Chinaâ€™s tech sector to translate and summarize the text of Chinese author Liu Cixinâ€™s award-winning science fiction novel: The Three-Body Problem. The book's storyline is based on a simple yet elusive problem from classical physics: predicting the movement of three gravitationally-attracted objects in space. I generated code for simulations and visualizations of this physics problem to present my own solutions to the three-body problem based on parallel computation. I also used Stable Diffusion to portray the imaginitive solutions to the three-body physics problem from one of the bookâ€™s main settings: an immersive virtual-reality game that spans centries of world history.",{"type":42,"tag":51,"props":107,"children":108},{},[109],{"type":48,"value":110},"I also share some of my experiences in China as an exchange student and research manager in the renewable energy technology sector. I wrote this article in English and translated it into Chinese using the same large language models I used to translate the Chinese text of the sci-fi novel into English. Warning: this article contains spoilers for the first book in the trilogy!",{"type":42,"tag":112,"props":113,"children":115},"h2",{"id":114},"back-story",[116],{"type":48,"value":117},"Back story",{"type":42,"tag":51,"props":119,"children":120},{},[121],{"type":48,"value":122},"A few months ago my company announced that another round of layoffs was to come the following week. I'm on an engineering team that had already been impacted by a few rounds of layoffs in the past year, and I was expecting to be let go. On an impulse I bought a book at the top of my reading list from Amazon: \"Three-Body Problem\". It is an award-winning Sci-Fi trilogy written by Liu Cixin, a Chinese computer engineer who started writing the book as a series of essays that were published in China's \"World of Sci-Fi\" magazine.",{"type":42,"tag":51,"props":124,"children":125},{},[126],{"type":42,"tag":127,"props":128,"children":131},"img",{"alt":129,"src":130},"Images of Three Body Problem Book Series","/static/three-body-problem/books.png",[],{"type":42,"tag":51,"props":133,"children":134},{},[135,137,146],{"type":48,"value":136},"I started learning Chinese in college, adding a major in Chinese Language to the mathematics major I decided on in my freshman year after taking vector calculus and linear algebra. In my sophmore year I did a semester abroad at Fudan University's ",{"type":42,"tag":138,"props":139,"children":143},"a",{"href":140,"rel":141},"https://ices.fudan.edu.cn/6628/list.htm",[142],"nofollow",[144],{"type":48,"value":145},"International Cultural Exchange School",{"type":48,"value":147},". In 2007, living and studying Chinese in Shanghai as a 19 year old American was a really fun time. I was placed in an advanced-level course with a diverse group of students where English was not the lowest common linguistic denominator. We had a demanding cirriculum that emphasized reading, listening and speaking Chinese, but most of the language learning came through extracirricular activities: exploring Shanghai's food scene, bartering with vendors at the fabric markets, late night clubbing, walking around the Bund and the French Concession and chatting with my taxi cab drivers. It is hard to imagine how I did this without an iPhone, but I was able to get pretty far with an old Nokia 3310.",{"type":42,"tag":51,"props":149,"children":150},{},[151],{"type":48,"value":152},"At the end of one night of particularly heavy drinking, some of my classmates and I dropped in on an wangba (internet cafe) before heading back to the international dorm. Chinese internet cafes in 2007 were an expansive underground dens of computers, monitors, MMORPGs, FPSs, cigarets, and on-demand instant noodles delivered directly to your seat through an app on the desktop. That night our game of choice was Counter-Strike. In one of the lowest points of my gaming career, my classmates and I were crushed by our Chinese counterterrorist opponent.",{"type":42,"tag":51,"props":154,"children":155},{},[156],{"type":42,"tag":127,"props":157,"children":160},{"alt":158,"src":159},"Chinese internet cafe","/static/three-body-problem/wangba.webp",[],{"type":42,"tag":51,"props":162,"children":163},{},[164],{"type":48,"value":165},"My favorite memory of that semester at Fudan University was travelling on an epic over-night sleeper train from Shanghai to Guangxi province with a school-sponsored class trip to see Guilin. Multiple games of sam-yuk-gu (3-6-9) ran in parallel across the matrix of 3-by-2 sleeper car bunk beds lining the train car like workloads distributed across multiple GPU cores. The rules of 3-6-9 are simple: a group of people go around in a circle counting up from 1. If your number contains a 3, 6 or 9, you clap once for each occurance of the number instead of saying your number. The first person to break the rules takes a drink. Then repeat indefinitely. The next morning we all boarded a boat cruise in a daze to see the Lijiang river's stunning limestone peaks featured on the 20 yuan note:",{"type":42,"tag":51,"props":167,"children":168},{},[169],{"type":42,"tag":127,"props":170,"children":173},{"alt":171,"src":172},"20 yuan note with Guilin rock formations","/static/three-body-problem/twenty_small.gif",[],{"type":42,"tag":51,"props":175,"children":176},{},[177],{"type":48,"value":178},"My second job after college took me back to China where I specialized in the technologies, policies and applications of large scale battery projects as a research manager for China's energy storage industry association. The job exposed me to the power industry and cutting-edge battery projects, and also sharpened my technical Chinese as I was frequently reading, translating in a bi-linguagl environment. It was fun  I didn't realize it at the time, but that job was great preperation for reading Chinese Sci-Fi novels.",{"type":42,"tag":51,"props":180,"children":181},{},[182],{"type":42,"tag":127,"props":183,"children":186},{"alt":184,"src":185},"State Grid HQ in Xi Cheng","/static/three-body-problem/invokeai/castles.png",[],{"type":42,"tag":51,"props":188,"children":189},{},[190],{"type":48,"value":191},"My first introduction to the 'Three-Body Problem' book came from one of my best friends from college. He lived at the inner-most leaf-node of one of Beijing's most labrythnian hutongs next to a family that trained racing pigeons. My friend and I bonded over our study of Chinese language, classical guitar and our experiences in Beijing. I strongly considered his recommendation to check out ä¸‰ä½“ (Three Body), the Chinese Sci-Fi novel about alien life in a solar system with three stars as he described it, but I never had the chance to read the book.",{"type":42,"tag":193,"props":194,"children":201},"iframe",{"width":195,"height":196,"src":197,"title":198,"frameBorder":199,"allow":200,"allowFullScreen":37},"100%",315,"https://www.youtube.com/embed/5lj99Uz1d50?si=TwrypbY4vTfeWGRf","YouTube video player","0","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",[],{"type":42,"tag":51,"props":203,"children":204},{},[205],{"type":48,"value":206},"Almost 10 years later I came across across a preview for the Netflix production of \"3 Body Problem\" scheduled to come out in early 2024. With the possibility of loosing my job weighing heavily on me, I picked up the books on Amazon hoping to have something to if I was going to be layed off. Over the weekend I was able to read a few of the chapters on my Kindle. I had not completely forgotten how to speak Chinese, and I could easily look up words and translate entire paragraphs with Google Translate.",{"type":42,"tag":112,"props":208,"children":210},{"id":209},"chinese-in-numbers",[211],{"type":48,"value":212},"Chinese in numbers",{"type":42,"tag":51,"props":214,"children":215},{},[216],{"type":48,"value":217},"Here's a quick primer on the Chinese language from a mathematical perspective. This will be helpful before jumping into using NLP and LLMs with Chinese text later in this article.",{"type":42,"tag":51,"props":219,"children":220},{},[221,223,230,232,239],{"type":48,"value":222},"First, how many Chinese characters are there? This question isn't specific enough to have a single answer. A common rule of thumb that I have heard before says that there are over 50,000 characters in total with roughly 10,000 characters in use and about 3,000 characters frequently used in Chinese media and newspapers (",{"type":42,"tag":138,"props":224,"children":227},{"href":225,"rel":226},"https://en.wikipedia.org/wiki/Chinese_language#Vocabulary",[142],[228],{"type":48,"value":229},"source",{"type":48,"value":231},"). ",{"type":42,"tag":138,"props":233,"children":236},{"href":234,"rel":235},"https://stackoverflow.com/a/1366113/6084948",[142],[237],{"type":48,"value":238},"This answer",{"type":48,"value":240}," from StackOverflow's legendary #1 ranked user VonC gives a good answer based on the number of Unicode characters in the CJK Unified Ideographs block: 20,992.",{"type":42,"tag":51,"props":242,"children":243},{},[244],{"type":48,"value":245},"Here are some numbers and statistics to be better understand the text of the Three-Body Problem Chinese text:",{"type":42,"tag":57,"props":247,"children":248},{},[249,254,259,264,269,274],{"type":42,"tag":61,"props":250,"children":251},{},[252],{"type":48,"value":253},"188,380 total charactes in the book",{"type":42,"tag":61,"props":255,"children":256},{},[257],{"type":48,"value":258},"2,859 unique characters in the book",{"type":42,"tag":61,"props":260,"children":261},{},[262],{"type":48,"value":263},"36 chapters in the book",{"type":42,"tag":61,"props":265,"children":266},{},[267],{"type":48,"value":268},"average of 69.78 paragraphs per chapter",{"type":42,"tag":61,"props":270,"children":271},{},[272],{"type":48,"value":273},"total of 2,512 paragraphs in the book",{"type":42,"tag":61,"props":275,"children":276},{},[277],{"type":48,"value":278},"average of 74.99 characters per paragraph",{"type":42,"tag":280,"props":281,"children":283},"h3",{"id":282},"character-frequency",[284],{"type":48,"value":285},"Character Frequency",{"type":42,"tag":51,"props":287,"children":288},{},[289,291,298],{"type":48,"value":290},"Let's look at how frequently each character in the book is used. We can also combine this with some data on the overall frequency of Chinese characters. The best measurement I found for overall character frequency is from ",{"type":42,"tag":138,"props":292,"children":295},{"href":293,"rel":294},"https://lingua.mtsu.edu/chinese-computing/statistics/char/list.php?Which=MO",[142],[296],{"type":48,"value":297},"Middle Tennessee State University",{"type":48,"value":299},". Here's a visualization that shows of all of unique characters in the book. The height of a column represents how frequently a character occurs in the book, and the color represents the relatively frequency of the character in Chinese language overall.",{"type":42,"tag":301,"props":302,"children":305},"div",{"className":303},[304],"wrap",[306],{"type":42,"tag":193,"props":307,"children":312},{"className":308,"src":310,"width":195,"height":311},[309],"p-4","https://briancaffey.github.io/three-body-problem/tjs/load.html",550,[],{"type":42,"tag":112,"props":314,"children":316},{"id":315},"meta-llms-and-grass-mud-horse",[317],{"type":48,"value":318},"Meta, LLMs, and Grass Mud Horse",{"type":42,"tag":51,"props":320,"children":321},{},[322,324,331],{"type":48,"value":323},"In recent months I have been following the development of big open source AI projects. Two projects in particular are InvokeAI, an image generation tool based on Stable Diffusion, and ",{"type":42,"tag":138,"props":325,"children":328},{"href":326,"rel":327},"https://ai.meta.com/llama/",[142],[329],{"type":48,"value":330},"LLaMA 2",{"type":48,"value":332},", the latest generation of Meta's open source LLM. The name LLaMA stands for 'Large Language Model Meta AI', which happens to be the same spelling as the word for the domesticated South American camelid: llama. Before going deeper into LLMs we need a quick Chinese lesson.",{"type":42,"tag":51,"props":334,"children":335},{},[336],{"type":48,"value":337},"è‰æ³¥é©¬ is a non-technical word that referes to animals like Llama or Alpaca. It can be directly translated as \"Grass Mud Horse\" and it is phonetically similar to the most common Chinese profanity: æ“ä½ å¦ˆ, which literally means \"f*** your mother\". The characters in these two words are nearly synonymous: the sounds of both words are \"cao ni ma\", but the tones are different, which in Chinese changes the meaning completely. The llama is basically a legendary Chinese internet meme subversive in the face of government censorship. ğŸ¦™ was approved as part of Unicode 11.0 in 2018. The extended version of this profanity is è‰æ³¥é©¬æˆˆå£ (CÇonÃ­mÇ GÄ“bÃ¬: Grass Mud Horse Gobi), refering to the geographical origin of this mythical creature: the Gobi Dessert. This term is more explicit as it synonymous with \"f*** your mother's c***\". Coincidentally, the Gobi Desert is a region of Inner Mongolia which borders the mountainous region of Greater Khingan Range (å¤§å…´å®‰å²­), the location of Red Coast and Radar Peak in Three-Body Problem where Ye Wenjie makes first contact with the Trisolarians.",{"type":42,"tag":51,"props":339,"children":340},{},[341,343,355,357,364],{"type":48,"value":342},"I requested access to Meta's LLaMa 2 models as soon as they came out and I was able to get it to run on my NVIDIA RTX 4090 GPU. I also joined a subreddit called ",{"type":42,"tag":138,"props":344,"children":347},{"href":345,"rel":346},"https://www.reddit.com/r/LocalLLaMA/",[142],[348],{"type":42,"tag":349,"props":350,"children":352},"code",{"className":351},[],[353],{"type":48,"value":354},"r/LocalLLaMa",{"type":48,"value":356}," with over seventy thousand members discussing how to run large language models on consumer hardware. Another annoucement that caught my attention in July was the release of ",{"type":42,"tag":138,"props":358,"children":361},{"href":359,"rel":360},"https://github.com/ymcui/Chinese-LLaMA-Alpaca-2",[142],[362],{"type":48,"value":363},"Chinese LLaMa 2",{"type":48,"value":365},", an open-source large language model trained on Chinese and English which does very well against Chinese Language LLM Benchmarks such as the CMMCU: Chinese Massive Multitask Language Understanding.",{"type":42,"tag":51,"props":367,"children":368},{},[369],{"type":42,"tag":127,"props":370,"children":373},{"alt":371,"src":372},"image of CMMLU","/static/three-body-problem/cmmlu.jpeg",[],{"type":42,"tag":112,"props":375,"children":377},{"id":376},"translation-in-and-of-the-three-body-problem",[378],{"type":48,"value":379},"Translation in and of The Three-Body Problem",{"type":42,"tag":51,"props":381,"children":382},{},[383],{"type":48,"value":384},"There are two important plot developments related to language translation in the Three-Body Problem novel, both of which involve bookâ€™s main female protagonist Ye Wenjie. First, copying the translation of Rachel Carson's 'Silent Spring' leads to her being relegated to the Red Coast project. At the Red Coast Ye Wenjie communicates with extraterrestrial life through a universal translation technology developed by the top-secret project.",{"type":42,"tag":51,"props":386,"children":387},{},[388],{"type":48,"value":389},"Ken Liuâ€™s translation of the Three-Body Problem book from Chinese to English places the events during the Cultural Revolution at the beginning of the book rather than in the middle of the book. According to Liu, this was done in order to avoid attention of government censors, and his original intention was to tell the story in this way, starting with the events of the late 1960's in China.",{"type":42,"tag":51,"props":391,"children":392},{},[393],{"type":48,"value":394},"I tried translating the Chinese text of the Three-Body Problem book using LLMs. I started with the Chinese-LLaMA-2 model and then tried Qwen-7B-Chat, Baichuan-13B-Chat when these models came out. I found that the Qwen-7B-Chat model worked best for my translation tasks. Qwen is short for Qian Wen (åƒé—®, or \"one thousand questions\") and is developed by Alibaba Cloud.",{"type":42,"tag":51,"props":396,"children":397},{},[398],{"type":48,"value":399},"How do you get an LLM to translate text? Ultimately the quality of the translation returned by the LLM depends on the prompt and other parameters used for inference. I experimented with both chat and completion approaches and tried lots of different kinds of prompts. The models I worked with have a 4K context window (the number of tokens the model can take as input when generating responses), so for translation tasks I had the LLM work on one paragraph at a time. Here's the prompt I used with the Qwen-7B-Chat model:",{"type":42,"tag":401,"props":402,"children":404},"pre",{"code":403},"\"ä½ æ˜¯ä¸€åç¿»è¯‘ã€‚è¯·å°†æ¯æ¡æ¶ˆæ¯ä»ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ã€‚\"\n(You are a translator. Please translate each message from Chinese to English.)\n",[405],{"type":42,"tag":349,"props":406,"children":407},{"__ignoreMap":8},[408],{"type":48,"value":403},{"type":42,"tag":51,"props":410,"children":411},{},[412],{"type":48,"value":413},"I did some basic prompt engineering to get the LLM to translate the books in the Three-Body problem paragraph by paragraph. My computer was able to translate the first book overnight in under 500 minutes. Here are the results of my translation of Three-Body Problem with Qwen-7B-Chat model:",{"type":42,"tag":193,"props":415,"children":418},{"className":416,"src":417,"width":195,"height":311},[309],"https://briancaffey.github.io/three-body-problem/reader/?book=three_body&chapterNumber=1",[],{"type":42,"tag":51,"props":420,"children":421},{},[422],{"type":48,"value":423},"It was interesting to see the failure modes of translation tasks for the different models. Most of the time the LLM was able to provided accurate translations. Some of the failure modes I observed were:",{"type":42,"tag":57,"props":425,"children":426},{},[427,432,437,442],{"type":42,"tag":61,"props":428,"children":429},{},[430],{"type":48,"value":431},"a few Chinese characters would show up in the English translations",{"type":42,"tag":61,"props":433,"children":434},{},[435],{"type":48,"value":436},"a complete Chinese sentence would show up in an otherwise complete translation of a paragraph",{"type":42,"tag":61,"props":438,"children":439},{},[440],{"type":48,"value":441},"The LLM refused to translate certain paragraphs that included violent imagery, such as the violent scenes from the Cultural Revolution chapters",{"type":42,"tag":61,"props":443,"children":444},{},[445],{"type":48,"value":446},"If the sentence it was asked to translate was a question, the LLM would respond in Chinese to the question rather than providing a translation of the question itself",{"type":42,"tag":280,"props":448,"children":450},{"id":449},"tokenization",[451],{"type":48,"value":452},"Tokenization",{"type":42,"tag":51,"props":454,"children":455},{},[456],{"type":48,"value":457},"When you feed a prompt to an LLM, it first puts the prompt through a process called tokenization. Tokenization takes a string of text and breaks it down into tokens (defined by the Large Language Model you are using). The process of tokenization is similar to the tokenization done by spaCy mentioned earlier. These tokens produced by LLM tokenization are numbers. Here's an example of tokenization in action using the Chinese-Llama-2 model:",{"type":42,"tag":401,"props":459,"children":462},{"code":460,"language":19,"meta":8,"className":461,"style":8},"import json\nimport os\nfrom llama_cpp import Llama, LlamaTokenizer\n\nllm = Llama(\n    model_path=\"/path/to/models/ggml-model-q4_0.bin\",\n    n_ctx=4096,\n    n_gpu_layers=30\n)\n\ntokenizer = LlamaTokenizer(llama=llm)\n\nTEXT=\"åœ¨é‚£ä¸ªå·²è¢«å¿˜å´çš„æ—¥å­é‡Œï¼Œå®ƒçš„ä¸–ç•Œé¢ è¦†äº†ã€‚æ³¥åœŸé£èµ°ï¼Œå‡ºç°äº†ä¸€æ¡åˆæ·±åˆå®½çš„å³¡è°·ï¼Œç„¶åæ³¥åœŸåˆè½°éš†éš†åœ°é£å›æ¥ï¼Œå³¡è°·æ¶ˆå¤±äº†ï¼Œåœ¨åŸæ¥å³¡è°·çš„å°½å¤´å‡ºç°äº†ä¸€åº§é»‘è‰²çš„å­¤å³°ã€‚å…¶å®ï¼Œåœ¨è¿™ç‰‡å¹¿é˜”çš„ç–†åŸŸä¸Šï¼Œè¿™ç§äº‹å¸¸å¸¸å‘ç”Ÿï¼Œæ³¥åœŸé£èµ°åˆé£å›ï¼Œå³¡è°·å‡ºç°åˆæ¶ˆå¤±ï¼Œç„¶åæ˜¯å­¤å³°é™ä¸´ï¼Œå¥½åƒæ˜¯ç»™æ¯æ¬¡ç¾å˜æ‰“ä¸Šä¸€ä¸ªé†’ç›®çš„æ ‡è®°ã€‚è¤èšå’Œå‡ ç™¾ä¸ªåŒæ—å¸¦ç€å¹¸å­˜çš„èšåå‘å¤ªé˜³è½ä¸‹çš„æ–¹å‘èµ°äº†ä¸€æ®µè·¯ï¼Œå»ºç«‹äº†æ–°çš„å¸å›½ã€‚\"\ntokens = tokenizer.encode(TEXT)\n","language-python shiki shiki-themes github-light github-dark monokai",[463],{"type":42,"tag":349,"props":464,"children":465},{"__ignoreMap":8},[466,484,497,520,529,548,573,596,614,623,631,662,670,688],{"type":42,"tag":467,"props":468,"children":471},"span",{"class":469,"line":470},"line",1,[472,478],{"type":42,"tag":467,"props":473,"children":475},{"style":474},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[476],{"type":48,"value":477},"import",{"type":42,"tag":467,"props":479,"children":481},{"style":480},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[482],{"type":48,"value":483}," json\n",{"type":42,"tag":467,"props":485,"children":487},{"class":469,"line":486},2,[488,492],{"type":42,"tag":467,"props":489,"children":490},{"style":474},[491],{"type":48,"value":477},{"type":42,"tag":467,"props":493,"children":494},{"style":480},[495],{"type":48,"value":496}," os\n",{"type":42,"tag":467,"props":498,"children":500},{"class":469,"line":499},3,[501,506,511,515],{"type":42,"tag":467,"props":502,"children":503},{"style":474},[504],{"type":48,"value":505},"from",{"type":42,"tag":467,"props":507,"children":508},{"style":480},[509],{"type":48,"value":510}," llama_cpp ",{"type":42,"tag":467,"props":512,"children":513},{"style":474},[514],{"type":48,"value":477},{"type":42,"tag":467,"props":516,"children":517},{"style":480},[518],{"type":48,"value":519}," Llama, LlamaTokenizer\n",{"type":42,"tag":467,"props":521,"children":523},{"class":469,"line":522},4,[524],{"type":42,"tag":467,"props":525,"children":526},{"emptyLinePlaceholder":37},[527],{"type":48,"value":528},"\n",{"type":42,"tag":467,"props":530,"children":532},{"class":469,"line":531},5,[533,538,543],{"type":42,"tag":467,"props":534,"children":535},{"style":480},[536],{"type":48,"value":537},"llm ",{"type":42,"tag":467,"props":539,"children":540},{"style":474},[541],{"type":48,"value":542},"=",{"type":42,"tag":467,"props":544,"children":545},{"style":480},[546],{"type":48,"value":547}," Llama(\n",{"type":42,"tag":467,"props":549,"children":551},{"class":469,"line":550},6,[552,558,562,568],{"type":42,"tag":467,"props":553,"children":555},{"style":554},"--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[556],{"type":48,"value":557},"    model_path",{"type":42,"tag":467,"props":559,"children":560},{"style":474},[561],{"type":48,"value":542},{"type":42,"tag":467,"props":563,"children":565},{"style":564},"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[566],{"type":48,"value":567},"\"/path/to/models/ggml-model-q4_0.bin\"",{"type":42,"tag":467,"props":569,"children":570},{"style":480},[571],{"type":48,"value":572},",\n",{"type":42,"tag":467,"props":574,"children":576},{"class":469,"line":575},7,[577,582,586,592],{"type":42,"tag":467,"props":578,"children":579},{"style":554},[580],{"type":48,"value":581},"    n_ctx",{"type":42,"tag":467,"props":583,"children":584},{"style":474},[585],{"type":48,"value":542},{"type":42,"tag":467,"props":587,"children":589},{"style":588},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[590],{"type":48,"value":591},"4096",{"type":42,"tag":467,"props":593,"children":594},{"style":480},[595],{"type":48,"value":572},{"type":42,"tag":467,"props":597,"children":599},{"class":469,"line":598},8,[600,605,609],{"type":42,"tag":467,"props":601,"children":602},{"style":554},[603],{"type":48,"value":604},"    n_gpu_layers",{"type":42,"tag":467,"props":606,"children":607},{"style":474},[608],{"type":48,"value":542},{"type":42,"tag":467,"props":610,"children":611},{"style":588},[612],{"type":48,"value":613},"30\n",{"type":42,"tag":467,"props":615,"children":617},{"class":469,"line":616},9,[618],{"type":42,"tag":467,"props":619,"children":620},{"style":480},[621],{"type":48,"value":622},")\n",{"type":42,"tag":467,"props":624,"children":626},{"class":469,"line":625},10,[627],{"type":42,"tag":467,"props":628,"children":629},{"emptyLinePlaceholder":37},[630],{"type":48,"value":528},{"type":42,"tag":467,"props":632,"children":634},{"class":469,"line":633},11,[635,640,644,649,653,657],{"type":42,"tag":467,"props":636,"children":637},{"style":480},[638],{"type":48,"value":639},"tokenizer ",{"type":42,"tag":467,"props":641,"children":642},{"style":474},[643],{"type":48,"value":542},{"type":42,"tag":467,"props":645,"children":646},{"style":480},[647],{"type":48,"value":648}," LlamaTokenizer(",{"type":42,"tag":467,"props":650,"children":651},{"style":554},[652],{"type":48,"value":15},{"type":42,"tag":467,"props":654,"children":655},{"style":474},[656],{"type":48,"value":542},{"type":42,"tag":467,"props":658,"children":659},{"style":480},[660],{"type":48,"value":661},"llm)\n",{"type":42,"tag":467,"props":663,"children":665},{"class":469,"line":664},12,[666],{"type":42,"tag":467,"props":667,"children":668},{"emptyLinePlaceholder":37},[669],{"type":48,"value":528},{"type":42,"tag":467,"props":671,"children":673},{"class":469,"line":672},13,[674,679,683],{"type":42,"tag":467,"props":675,"children":676},{"style":588},[677],{"type":48,"value":678},"TEXT",{"type":42,"tag":467,"props":680,"children":681},{"style":474},[682],{"type":48,"value":542},{"type":42,"tag":467,"props":684,"children":685},{"style":564},[686],{"type":48,"value":687},"\"åœ¨é‚£ä¸ªå·²è¢«å¿˜å´çš„æ—¥å­é‡Œï¼Œå®ƒçš„ä¸–ç•Œé¢ è¦†äº†ã€‚æ³¥åœŸé£èµ°ï¼Œå‡ºç°äº†ä¸€æ¡åˆæ·±åˆå®½çš„å³¡è°·ï¼Œç„¶åæ³¥åœŸåˆè½°éš†éš†åœ°é£å›æ¥ï¼Œå³¡è°·æ¶ˆå¤±äº†ï¼Œåœ¨åŸæ¥å³¡è°·çš„å°½å¤´å‡ºç°äº†ä¸€åº§é»‘è‰²çš„å­¤å³°ã€‚å…¶å®ï¼Œåœ¨è¿™ç‰‡å¹¿é˜”çš„ç–†åŸŸä¸Šï¼Œè¿™ç§äº‹å¸¸å¸¸å‘ç”Ÿï¼Œæ³¥åœŸé£èµ°åˆé£å›ï¼Œå³¡è°·å‡ºç°åˆæ¶ˆå¤±ï¼Œç„¶åæ˜¯å­¤å³°é™ä¸´ï¼Œå¥½åƒæ˜¯ç»™æ¯æ¬¡ç¾å˜æ‰“ä¸Šä¸€ä¸ªé†’ç›®çš„æ ‡è®°ã€‚è¤èšå’Œå‡ ç™¾ä¸ªåŒæ—å¸¦ç€å¹¸å­˜çš„èšåå‘å¤ªé˜³è½ä¸‹çš„æ–¹å‘èµ°äº†ä¸€æ®µè·¯ï¼Œå»ºç«‹äº†æ–°çš„å¸å›½ã€‚\"\n",{"type":42,"tag":467,"props":689,"children":691},{"class":469,"line":690},14,[692,697,701,706,710],{"type":42,"tag":467,"props":693,"children":694},{"style":480},[695],{"type":48,"value":696},"tokens ",{"type":42,"tag":467,"props":698,"children":699},{"style":474},[700],{"type":48,"value":542},{"type":42,"tag":467,"props":702,"children":703},{"style":480},[704],{"type":48,"value":705}," tokenizer.encode(",{"type":42,"tag":467,"props":707,"children":708},{"style":588},[709],{"type":48,"value":678},{"type":42,"tag":467,"props":711,"children":712},{"style":480},[713],{"type":48,"value":622},{"type":42,"tag":401,"props":715,"children":717},{"code":716},"print(str(tokens[:4]) + \" ...\")\n",[718],{"type":42,"tag":349,"props":719,"children":720},{"__ignoreMap":8},[721],{"type":48,"value":716},{"type":42,"tag":723,"props":724,"children":725},"blockquote",{},[726],{"type":42,"tag":51,"props":727,"children":728},{},[729,734],{"type":42,"tag":467,"props":730,"children":731},{},[732],{"type":48,"value":733},"1, 30505, 32380, 36812",{"type":48,"value":735}," ...",{"type":42,"tag":401,"props":737,"children":739},{"code":738},"for token in tokens:\n    text = tokenizer.decode([token])\n    print(text, end=\" \")\n",[740],{"type":42,"tag":349,"props":741,"children":742},{"__ignoreMap":8},[743],{"type":48,"value":738},{"type":42,"tag":723,"props":745,"children":746},{},[747],{"type":42,"tag":51,"props":748,"children":749},{},[750],{"type":48,"value":751},"åœ¨ é‚£ä¸ª å·²è¢« å¿˜ å´ çš„æ—¥å­ é‡Œ ï¼Œ å®ƒçš„ ä¸–ç•Œ é¢ è¦† äº† ã€‚ æ³¥ åœŸ é£ èµ° ï¼Œ å‡ºç°äº† ä¸€æ¡ åˆ æ·± åˆ å®½ çš„ å³¡è°· ï¼Œ ç„¶å æ³¥ åœŸ åˆ è½° éš† éš† åœ° é£ å›æ¥ ï¼Œ å³¡è°· æ¶ˆå¤± äº† ï¼Œ åœ¨ åŸæ¥ å³¡è°· çš„ å°½å¤´ å‡ºç°äº† ä¸€åº§ é»‘è‰² çš„ å­¤ å³° ã€‚ å…¶å® ï¼Œ åœ¨è¿™ ç‰‡ å¹¿é˜” çš„ ç–† åŸŸ ä¸Š ï¼Œ è¿™ç§äº‹ å¸¸å¸¸ å‘ç”Ÿ ï¼Œ æ³¥ åœŸ é£ èµ° åˆ é£ å› ï¼Œ å³¡è°· å‡ºç° åˆ æ¶ˆå¤± ï¼Œ ç„¶å æ˜¯ å­¤ å³° é™ä¸´ ï¼Œ å¥½åƒæ˜¯ ç»™ æ¯æ¬¡ ç¾ å˜ æ‰“ ä¸Š ä¸€ä¸ª é†’ç›® çš„ æ ‡è®° ã€‚ è¤ èš å’Œ å‡ ç™¾ ä¸ª åŒ æ— å¸¦ç€ å¹¸ å­˜ çš„ èš å å‘ å¤ªé˜³ è½ ä¸‹çš„ æ–¹å‘ èµ°äº† ä¸€æ®µ è·¯ ï¼Œ å»ºç«‹äº† æ–°çš„ å¸å›½ ã€‚",{"type":42,"tag":401,"props":753,"children":755},{"code":754,"language":19,"meta":8,"className":461,"style":8},"english_text = \"This is an example of tokenization using a large language model.\"\nenglish_tokens = tokenizer.encode(english_text)\nprint(str(english_tokens[:4]) + \" ...\")\n\nfor token in english_tokens:\n    text = tokenizer.decode([token])\n    print(f\"'{text}'\", end=\" \")\n",[756],{"type":42,"tag":349,"props":757,"children":758},{"__ignoreMap":8},[759,776,793,842,849,872,889],{"type":42,"tag":467,"props":760,"children":761},{"class":469,"line":470},[762,767,771],{"type":42,"tag":467,"props":763,"children":764},{"style":480},[765],{"type":48,"value":766},"english_text ",{"type":42,"tag":467,"props":768,"children":769},{"style":474},[770],{"type":48,"value":542},{"type":42,"tag":467,"props":772,"children":773},{"style":564},[774],{"type":48,"value":775}," \"This is an example of tokenization using a large language model.\"\n",{"type":42,"tag":467,"props":777,"children":778},{"class":469,"line":486},[779,784,788],{"type":42,"tag":467,"props":780,"children":781},{"style":480},[782],{"type":48,"value":783},"english_tokens ",{"type":42,"tag":467,"props":785,"children":786},{"style":474},[787],{"type":48,"value":542},{"type":42,"tag":467,"props":789,"children":790},{"style":480},[791],{"type":48,"value":792}," tokenizer.encode(english_text)\n",{"type":42,"tag":467,"props":794,"children":795},{"class":469,"line":499},[796,802,807,813,818,823,828,833,838],{"type":42,"tag":467,"props":797,"children":799},{"style":798},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF",[800],{"type":48,"value":801},"print",{"type":42,"tag":467,"props":803,"children":804},{"style":480},[805],{"type":48,"value":806},"(",{"type":42,"tag":467,"props":808,"children":810},{"style":809},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[811],{"type":48,"value":812},"str",{"type":42,"tag":467,"props":814,"children":815},{"style":480},[816],{"type":48,"value":817},"(english_tokens[:",{"type":42,"tag":467,"props":819,"children":820},{"style":588},[821],{"type":48,"value":822},"4",{"type":42,"tag":467,"props":824,"children":825},{"style":480},[826],{"type":48,"value":827},"]) ",{"type":42,"tag":467,"props":829,"children":830},{"style":474},[831],{"type":48,"value":832},"+",{"type":42,"tag":467,"props":834,"children":835},{"style":564},[836],{"type":48,"value":837}," \" ...\"",{"type":42,"tag":467,"props":839,"children":840},{"style":480},[841],{"type":48,"value":622},{"type":42,"tag":467,"props":843,"children":844},{"class":469,"line":522},[845],{"type":42,"tag":467,"props":846,"children":847},{"emptyLinePlaceholder":37},[848],{"type":48,"value":528},{"type":42,"tag":467,"props":850,"children":851},{"class":469,"line":531},[852,857,862,867],{"type":42,"tag":467,"props":853,"children":854},{"style":474},[855],{"type":48,"value":856},"for",{"type":42,"tag":467,"props":858,"children":859},{"style":480},[860],{"type":48,"value":861}," token ",{"type":42,"tag":467,"props":863,"children":864},{"style":474},[865],{"type":48,"value":866},"in",{"type":42,"tag":467,"props":868,"children":869},{"style":480},[870],{"type":48,"value":871}," english_tokens:\n",{"type":42,"tag":467,"props":873,"children":874},{"class":469,"line":550},[875,880,884],{"type":42,"tag":467,"props":876,"children":877},{"style":480},[878],{"type":48,"value":879},"    text ",{"type":42,"tag":467,"props":881,"children":882},{"style":474},[883],{"type":48,"value":542},{"type":42,"tag":467,"props":885,"children":886},{"style":480},[887],{"type":48,"value":888}," tokenizer.decode([token])\n",{"type":42,"tag":467,"props":890,"children":891},{"class":469,"line":575},[892,897,901,907,912,917,921,926,931,936,941,945,950],{"type":42,"tag":467,"props":893,"children":894},{"style":798},[895],{"type":48,"value":896},"    print",{"type":42,"tag":467,"props":898,"children":899},{"style":480},[900],{"type":48,"value":806},{"type":42,"tag":467,"props":902,"children":904},{"style":903},"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[905],{"type":48,"value":906},"f",{"type":42,"tag":467,"props":908,"children":909},{"style":564},[910],{"type":48,"value":911},"\"'",{"type":42,"tag":467,"props":913,"children":914},{"style":588},[915],{"type":48,"value":916},"{",{"type":42,"tag":467,"props":918,"children":919},{"style":480},[920],{"type":48,"value":48},{"type":42,"tag":467,"props":922,"children":923},{"style":588},[924],{"type":48,"value":925},"}",{"type":42,"tag":467,"props":927,"children":928},{"style":564},[929],{"type":48,"value":930},"'\"",{"type":42,"tag":467,"props":932,"children":933},{"style":480},[934],{"type":48,"value":935},", ",{"type":42,"tag":467,"props":937,"children":938},{"style":554},[939],{"type":48,"value":940},"end",{"type":42,"tag":467,"props":942,"children":943},{"style":474},[944],{"type":48,"value":542},{"type":42,"tag":467,"props":946,"children":947},{"style":564},[948],{"type":48,"value":949},"\" \"",{"type":42,"tag":467,"props":951,"children":952},{"style":480},[953],{"type":48,"value":622},{"type":42,"tag":723,"props":955,"children":956},{},[957],{"type":42,"tag":51,"props":958,"children":959},{},[960,965],{"type":42,"tag":467,"props":961,"children":962},{},[963],{"type":48,"value":964},"1, 4013, 338, 385",{"type":48,"value":735},{"type":42,"tag":723,"props":967,"children":968},{},[969],{"type":42,"tag":51,"props":970,"children":971},{},[972],{"type":48,"value":973},"'' 'This' ' is' ' an' ' example' ' of' ' token' 'ization' ' using' ' a' ' large' ' language' ' model' '.'",{"type":42,"tag":51,"props":975,"children":976},{},[977],{"type":48,"value":978},"Here are some key differences between English and Chinese that have implications for how the language is tokenized by large language models:",{"type":42,"tag":57,"props":980,"children":981},{},[982,987,992,997,1002,1007,1012],{"type":42,"tag":61,"props":983,"children":984},{},[985],{"type":48,"value":986},"Chinese does not use spaces between words like English does",{"type":42,"tag":61,"props":988,"children":989},{},[990],{"type":48,"value":991},"Chinese words are typically formed from 2 or more characters",{"type":42,"tag":61,"props":993,"children":994},{},[995],{"type":48,"value":996},"Chinese verbs are not conjugated and do not have different tenses",{"type":42,"tag":61,"props":998,"children":999},{},[1000],{"type":48,"value":1001},"Chinese words don't have singular and plural variants",{"type":42,"tag":61,"props":1003,"children":1004},{},[1005],{"type":48,"value":1006},"Chinese grammar is very simple and is similar to English",{"type":42,"tag":61,"props":1008,"children":1009},{},[1010],{"type":48,"value":1011},"Chinese characters do not have capitization like ASCII characters",{"type":42,"tag":61,"props":1013,"children":1014},{},[1015],{"type":48,"value":1016},"The token represented by the number 1 encodes a starting token",{"type":42,"tag":112,"props":1018,"children":1020},{"id":1019},"imagining-scenes-from-three-body-problem-with-stable-diffusion",[1021],{"type":48,"value":1022},"Imagining scenes from Three-Body Problem with Stable Diffusion",{"type":42,"tag":51,"props":1024,"children":1025},{},[1026],{"type":48,"value":1027},"Here are some images I generated using Stable Diffusion with InvokeAI that depict scenes from the Three-Body Problem book. These scenes portray solutions to the Three-Body Problem that players in the Three-Body game devised. The first is a Confucian system of etiquette for predicting the movement of the three suns. The second is a human-powered computer that Qin Shi Huang used to try to predict the movement of the three suns.",{"type":42,"tag":723,"props":1029,"children":1030},{},[1031],{"type":42,"tag":51,"props":1032,"children":1033},{},[1034],{"type":48,"value":1035},"Prompt: Ceremonies and etiquette system related to the sun and multiple celestial++ bodies Confucius artistic style",{"type":42,"tag":1037,"props":1038,"children":1039},"client-only",{},[1040],{"type":42,"tag":1041,"props":1042,"children":1045},"carousel",{":count":1043,"dir":1044},"8","confucius",[],{"type":42,"tag":723,"props":1047,"children":1048},{},[1049],{"type":42,"tag":51,"props":1050,"children":1051},{},[1052],{"type":48,"value":1053},"array of chinese++ warriors++ on a electronics+ circuit+ board qing+ dynasty style art logic puzzle",{"type":42,"tag":1037,"props":1055,"children":1056},{},[1057],{"type":42,"tag":1041,"props":1058,"children":1061},{":count":1059,"dir":1060},"5","computer",[],{"type":42,"tag":51,"props":1063,"children":1064},{},[1065],{"type":48,"value":1066},"Congrats to the InvokeAI team on the 3.0 release. It has been awesome to use and the current docker compose setup is a huge improvement on the 2.x version.",{"type":42,"tag":112,"props":1068,"children":1070},{"id":1069},"n-body-simulations-cuda-and-threejs",[1071],{"type":48,"value":1072},"n-body simulations, CUDA and Three.js",{"type":42,"tag":51,"props":1074,"children":1075},{},[1076],{"type":48,"value":1077},"The nbody problem has no closed-form analytical solution, but it is possible to do a basic simulation of the three-body problem on consumer hardware and open source software, like NVIDIA and CUDA.",{"type":42,"tag":280,"props":1079,"children":1081},{"id":1080},"three-body-cuda-simulation",[1082],{"type":48,"value":1083},"Three-Body CUDA simulation",{"type":42,"tag":51,"props":1085,"children":1086},{},[1087],{"type":48,"value":1088},"I wrote a simple program with the help of ChatGPT for running nbody problem simulations. The program uses CuPy, a Python library that exposes APIs for doing matrix multiplication to predict the position of three bodies using Euclidian Integration. Here's the script:",{"type":42,"tag":401,"props":1090,"children":1094},{"code":1091,"language":1092,"meta":8,"className":1093,"style":8},"import numpy as np\nimport cupy as cp\nimport time\nimport json\n\n# Simulation parameters\nNUM_PARTICLES = 3\nDIMENSIONS = 3 # 3D space\nNUM_STEPS = 30\nDT = 0.1\n\n# Generate initial positions and velocities\nnp_positions = np.random.randn(NUM_PARTICLES, DIMENSIONS)\nnp_velocities = np.random.randn(NUM_PARTICLES, DIMENSIONS)\n\ncp_positions = cp.array(np_positions)\ncp_velocities = cp.array(np_velocities)\n\nnp_ticks = np.expand_dims(np_positions, axis=0)\ncp_ticks = cp.array(np_ticks)\n\n# nbody simulation loop\nstart_time = time.time()\nfor step in range(NUM_STEPS):\n\n    # this gets pairwise differences\n    diff = cp_positions[:, None, :] - cp_positions[None, :, :]\n    distances = cp.sqrt(cp.sum(diff**2, axis=2))\n\n    # avoid division by zero\n    epsilon = 1e-5\n    inv_distances = 1.0 / cp.maximum(distances, epsilon)\n\n    # calculate forces\n    cp_forces = cp.sum((diff.T * inv_distances**3).T, axis=1)\n\n    # update velocities and positions\n    cp_velocities += DT * cp_forces\n    cp_positions += DT * cp_velocities\n    cp_ticks = cp.append(cp_ticks, cp.expand_dims(cp_positions, 0), 0)\n\nsim_time = time.time() - start_time\nprint(\"Simulation time:\", sim_time)\n\n\nclass NumpyArrayEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, np.ndarray):\n            return obj.tolist()\n        return json.JSONEncoder.default(self, obj)\n\n\nnp_ticks = cp_ticks.get()\n\n\n# this is data we can work with in python and write to a file\nwith open(\"ticks.json\", \"w\") as f:\n    f.write(json.dumps(np_ticks, cls=NumpyArrayEncoder))\n","py","language-py shiki shiki-themes github-light github-dark monokai",[1095],{"type":42,"tag":349,"props":1096,"children":1097},{"__ignoreMap":8},[1098,1120,1141,1153,1164,1171,1180,1198,1220,1237,1254,1261,1269,1302,1334,1342,1360,1378,1386,1421,1439,1447,1456,1474,1509,1517,1526,1573,1622,1630,1639,1657,1685,1693,1702,1761,1769,1778,1807,1833,1868,1876,1903,1925,1933,1941,1980,2018,2037,2051,2075,2083,2091,2108,2116,2124,2133,2179],{"type":42,"tag":467,"props":1099,"children":1100},{"class":469,"line":470},[1101,1105,1110,1115],{"type":42,"tag":467,"props":1102,"children":1103},{"style":474},[1104],{"type":48,"value":477},{"type":42,"tag":467,"props":1106,"children":1107},{"style":480},[1108],{"type":48,"value":1109}," numpy ",{"type":42,"tag":467,"props":1111,"children":1112},{"style":474},[1113],{"type":48,"value":1114},"as",{"type":42,"tag":467,"props":1116,"children":1117},{"style":480},[1118],{"type":48,"value":1119}," np\n",{"type":42,"tag":467,"props":1121,"children":1122},{"class":469,"line":486},[1123,1127,1132,1136],{"type":42,"tag":467,"props":1124,"children":1125},{"style":474},[1126],{"type":48,"value":477},{"type":42,"tag":467,"props":1128,"children":1129},{"style":480},[1130],{"type":48,"value":1131}," cupy ",{"type":42,"tag":467,"props":1133,"children":1134},{"style":474},[1135],{"type":48,"value":1114},{"type":42,"tag":467,"props":1137,"children":1138},{"style":480},[1139],{"type":48,"value":1140}," cp\n",{"type":42,"tag":467,"props":1142,"children":1143},{"class":469,"line":499},[1144,1148],{"type":42,"tag":467,"props":1145,"children":1146},{"style":474},[1147],{"type":48,"value":477},{"type":42,"tag":467,"props":1149,"children":1150},{"style":480},[1151],{"type":48,"value":1152}," time\n",{"type":42,"tag":467,"props":1154,"children":1155},{"class":469,"line":522},[1156,1160],{"type":42,"tag":467,"props":1157,"children":1158},{"style":474},[1159],{"type":48,"value":477},{"type":42,"tag":467,"props":1161,"children":1162},{"style":480},[1163],{"type":48,"value":483},{"type":42,"tag":467,"props":1165,"children":1166},{"class":469,"line":531},[1167],{"type":42,"tag":467,"props":1168,"children":1169},{"emptyLinePlaceholder":37},[1170],{"type":48,"value":528},{"type":42,"tag":467,"props":1172,"children":1173},{"class":469,"line":550},[1174],{"type":42,"tag":467,"props":1175,"children":1177},{"style":1176},"--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F",[1178],{"type":48,"value":1179},"# Simulation parameters\n",{"type":42,"tag":467,"props":1181,"children":1182},{"class":469,"line":575},[1183,1188,1193],{"type":42,"tag":467,"props":1184,"children":1185},{"style":588},[1186],{"type":48,"value":1187},"NUM_PARTICLES",{"type":42,"tag":467,"props":1189,"children":1190},{"style":474},[1191],{"type":48,"value":1192}," =",{"type":42,"tag":467,"props":1194,"children":1195},{"style":588},[1196],{"type":48,"value":1197}," 3\n",{"type":42,"tag":467,"props":1199,"children":1200},{"class":469,"line":598},[1201,1206,1210,1215],{"type":42,"tag":467,"props":1202,"children":1203},{"style":588},[1204],{"type":48,"value":1205},"DIMENSIONS",{"type":42,"tag":467,"props":1207,"children":1208},{"style":474},[1209],{"type":48,"value":1192},{"type":42,"tag":467,"props":1211,"children":1212},{"style":588},[1213],{"type":48,"value":1214}," 3",{"type":42,"tag":467,"props":1216,"children":1217},{"style":1176},[1218],{"type":48,"value":1219}," # 3D space\n",{"type":42,"tag":467,"props":1221,"children":1222},{"class":469,"line":616},[1223,1228,1232],{"type":42,"tag":467,"props":1224,"children":1225},{"style":588},[1226],{"type":48,"value":1227},"NUM_STEPS",{"type":42,"tag":467,"props":1229,"children":1230},{"style":474},[1231],{"type":48,"value":1192},{"type":42,"tag":467,"props":1233,"children":1234},{"style":588},[1235],{"type":48,"value":1236}," 30\n",{"type":42,"tag":467,"props":1238,"children":1239},{"class":469,"line":625},[1240,1245,1249],{"type":42,"tag":467,"props":1241,"children":1242},{"style":588},[1243],{"type":48,"value":1244},"DT",{"type":42,"tag":467,"props":1246,"children":1247},{"style":474},[1248],{"type":48,"value":1192},{"type":42,"tag":467,"props":1250,"children":1251},{"style":588},[1252],{"type":48,"value":1253}," 0.1\n",{"type":42,"tag":467,"props":1255,"children":1256},{"class":469,"line":633},[1257],{"type":42,"tag":467,"props":1258,"children":1259},{"emptyLinePlaceholder":37},[1260],{"type":48,"value":528},{"type":42,"tag":467,"props":1262,"children":1263},{"class":469,"line":664},[1264],{"type":42,"tag":467,"props":1265,"children":1266},{"style":1176},[1267],{"type":48,"value":1268},"# Generate initial positions and velocities\n",{"type":42,"tag":467,"props":1270,"children":1271},{"class":469,"line":672},[1272,1277,1281,1286,1290,1294,1298],{"type":42,"tag":467,"props":1273,"children":1274},{"style":480},[1275],{"type":48,"value":1276},"np_positions ",{"type":42,"tag":467,"props":1278,"children":1279},{"style":474},[1280],{"type":48,"value":542},{"type":42,"tag":467,"props":1282,"children":1283},{"style":480},[1284],{"type":48,"value":1285}," np.random.randn(",{"type":42,"tag":467,"props":1287,"children":1288},{"style":588},[1289],{"type":48,"value":1187},{"type":42,"tag":467,"props":1291,"children":1292},{"style":480},[1293],{"type":48,"value":935},{"type":42,"tag":467,"props":1295,"children":1296},{"style":588},[1297],{"type":48,"value":1205},{"type":42,"tag":467,"props":1299,"children":1300},{"style":480},[1301],{"type":48,"value":622},{"type":42,"tag":467,"props":1303,"children":1304},{"class":469,"line":690},[1305,1310,1314,1318,1322,1326,1330],{"type":42,"tag":467,"props":1306,"children":1307},{"style":480},[1308],{"type":48,"value":1309},"np_velocities ",{"type":42,"tag":467,"props":1311,"children":1312},{"style":474},[1313],{"type":48,"value":542},{"type":42,"tag":467,"props":1315,"children":1316},{"style":480},[1317],{"type":48,"value":1285},{"type":42,"tag":467,"props":1319,"children":1320},{"style":588},[1321],{"type":48,"value":1187},{"type":42,"tag":467,"props":1323,"children":1324},{"style":480},[1325],{"type":48,"value":935},{"type":42,"tag":467,"props":1327,"children":1328},{"style":588},[1329],{"type":48,"value":1205},{"type":42,"tag":467,"props":1331,"children":1332},{"style":480},[1333],{"type":48,"value":622},{"type":42,"tag":467,"props":1335,"children":1337},{"class":469,"line":1336},15,[1338],{"type":42,"tag":467,"props":1339,"children":1340},{"emptyLinePlaceholder":37},[1341],{"type":48,"value":528},{"type":42,"tag":467,"props":1343,"children":1345},{"class":469,"line":1344},16,[1346,1351,1355],{"type":42,"tag":467,"props":1347,"children":1348},{"style":480},[1349],{"type":48,"value":1350},"cp_positions ",{"type":42,"tag":467,"props":1352,"children":1353},{"style":474},[1354],{"type":48,"value":542},{"type":42,"tag":467,"props":1356,"children":1357},{"style":480},[1358],{"type":48,"value":1359}," cp.array(np_positions)\n",{"type":42,"tag":467,"props":1361,"children":1363},{"class":469,"line":1362},17,[1364,1369,1373],{"type":42,"tag":467,"props":1365,"children":1366},{"style":480},[1367],{"type":48,"value":1368},"cp_velocities ",{"type":42,"tag":467,"props":1370,"children":1371},{"style":474},[1372],{"type":48,"value":542},{"type":42,"tag":467,"props":1374,"children":1375},{"style":480},[1376],{"type":48,"value":1377}," cp.array(np_velocities)\n",{"type":42,"tag":467,"props":1379,"children":1381},{"class":469,"line":1380},18,[1382],{"type":42,"tag":467,"props":1383,"children":1384},{"emptyLinePlaceholder":37},[1385],{"type":48,"value":528},{"type":42,"tag":467,"props":1387,"children":1389},{"class":469,"line":1388},19,[1390,1395,1399,1404,1409,1413,1417],{"type":42,"tag":467,"props":1391,"children":1392},{"style":480},[1393],{"type":48,"value":1394},"np_ticks ",{"type":42,"tag":467,"props":1396,"children":1397},{"style":474},[1398],{"type":48,"value":542},{"type":42,"tag":467,"props":1400,"children":1401},{"style":480},[1402],{"type":48,"value":1403}," np.expand_dims(np_positions, ",{"type":42,"tag":467,"props":1405,"children":1406},{"style":554},[1407],{"type":48,"value":1408},"axis",{"type":42,"tag":467,"props":1410,"children":1411},{"style":474},[1412],{"type":48,"value":542},{"type":42,"tag":467,"props":1414,"children":1415},{"style":588},[1416],{"type":48,"value":199},{"type":42,"tag":467,"props":1418,"children":1419},{"style":480},[1420],{"type":48,"value":622},{"type":42,"tag":467,"props":1422,"children":1424},{"class":469,"line":1423},20,[1425,1430,1434],{"type":42,"tag":467,"props":1426,"children":1427},{"style":480},[1428],{"type":48,"value":1429},"cp_ticks ",{"type":42,"tag":467,"props":1431,"children":1432},{"style":474},[1433],{"type":48,"value":542},{"type":42,"tag":467,"props":1435,"children":1436},{"style":480},[1437],{"type":48,"value":1438}," cp.array(np_ticks)\n",{"type":42,"tag":467,"props":1440,"children":1442},{"class":469,"line":1441},21,[1443],{"type":42,"tag":467,"props":1444,"children":1445},{"emptyLinePlaceholder":37},[1446],{"type":48,"value":528},{"type":42,"tag":467,"props":1448,"children":1450},{"class":469,"line":1449},22,[1451],{"type":42,"tag":467,"props":1452,"children":1453},{"style":1176},[1454],{"type":48,"value":1455},"# nbody simulation loop\n",{"type":42,"tag":467,"props":1457,"children":1459},{"class":469,"line":1458},23,[1460,1465,1469],{"type":42,"tag":467,"props":1461,"children":1462},{"style":480},[1463],{"type":48,"value":1464},"start_time ",{"type":42,"tag":467,"props":1466,"children":1467},{"style":474},[1468],{"type":48,"value":542},{"type":42,"tag":467,"props":1470,"children":1471},{"style":480},[1472],{"type":48,"value":1473}," time.time()\n",{"type":42,"tag":467,"props":1475,"children":1477},{"class":469,"line":1476},24,[1478,1482,1487,1491,1496,1500,1504],{"type":42,"tag":467,"props":1479,"children":1480},{"style":474},[1481],{"type":48,"value":856},{"type":42,"tag":467,"props":1483,"children":1484},{"style":480},[1485],{"type":48,"value":1486}," step ",{"type":42,"tag":467,"props":1488,"children":1489},{"style":474},[1490],{"type":48,"value":866},{"type":42,"tag":467,"props":1492,"children":1493},{"style":798},[1494],{"type":48,"value":1495}," range",{"type":42,"tag":467,"props":1497,"children":1498},{"style":480},[1499],{"type":48,"value":806},{"type":42,"tag":467,"props":1501,"children":1502},{"style":588},[1503],{"type":48,"value":1227},{"type":42,"tag":467,"props":1505,"children":1506},{"style":480},[1507],{"type":48,"value":1508},"):\n",{"type":42,"tag":467,"props":1510,"children":1512},{"class":469,"line":1511},25,[1513],{"type":42,"tag":467,"props":1514,"children":1515},{"emptyLinePlaceholder":37},[1516],{"type":48,"value":528},{"type":42,"tag":467,"props":1518,"children":1520},{"class":469,"line":1519},26,[1521],{"type":42,"tag":467,"props":1522,"children":1523},{"style":1176},[1524],{"type":48,"value":1525},"    # this gets pairwise differences\n",{"type":42,"tag":467,"props":1527,"children":1529},{"class":469,"line":1528},27,[1530,1535,1539,1544,1549,1554,1559,1564,1568],{"type":42,"tag":467,"props":1531,"children":1532},{"style":480},[1533],{"type":48,"value":1534},"    diff ",{"type":42,"tag":467,"props":1536,"children":1537},{"style":474},[1538],{"type":48,"value":542},{"type":42,"tag":467,"props":1540,"children":1541},{"style":480},[1542],{"type":48,"value":1543}," cp_positions[:, ",{"type":42,"tag":467,"props":1545,"children":1546},{"style":588},[1547],{"type":48,"value":1548},"None",{"type":42,"tag":467,"props":1550,"children":1551},{"style":480},[1552],{"type":48,"value":1553},", :] ",{"type":42,"tag":467,"props":1555,"children":1556},{"style":474},[1557],{"type":48,"value":1558},"-",{"type":42,"tag":467,"props":1560,"children":1561},{"style":480},[1562],{"type":48,"value":1563}," cp_positions[",{"type":42,"tag":467,"props":1565,"children":1566},{"style":588},[1567],{"type":48,"value":1548},{"type":42,"tag":467,"props":1569,"children":1570},{"style":480},[1571],{"type":48,"value":1572},", :, :]\n",{"type":42,"tag":467,"props":1574,"children":1576},{"class":469,"line":1575},28,[1577,1582,1586,1591,1596,1601,1605,1609,1613,1617],{"type":42,"tag":467,"props":1578,"children":1579},{"style":480},[1580],{"type":48,"value":1581},"    distances ",{"type":42,"tag":467,"props":1583,"children":1584},{"style":474},[1585],{"type":48,"value":542},{"type":42,"tag":467,"props":1587,"children":1588},{"style":480},[1589],{"type":48,"value":1590}," cp.sqrt(cp.sum(diff",{"type":42,"tag":467,"props":1592,"children":1593},{"style":474},[1594],{"type":48,"value":1595},"**",{"type":42,"tag":467,"props":1597,"children":1598},{"style":588},[1599],{"type":48,"value":1600},"2",{"type":42,"tag":467,"props":1602,"children":1603},{"style":480},[1604],{"type":48,"value":935},{"type":42,"tag":467,"props":1606,"children":1607},{"style":554},[1608],{"type":48,"value":1408},{"type":42,"tag":467,"props":1610,"children":1611},{"style":474},[1612],{"type":48,"value":542},{"type":42,"tag":467,"props":1614,"children":1615},{"style":588},[1616],{"type":48,"value":1600},{"type":42,"tag":467,"props":1618,"children":1619},{"style":480},[1620],{"type":48,"value":1621},"))\n",{"type":42,"tag":467,"props":1623,"children":1625},{"class":469,"line":1624},29,[1626],{"type":42,"tag":467,"props":1627,"children":1628},{"emptyLinePlaceholder":37},[1629],{"type":48,"value":528},{"type":42,"tag":467,"props":1631,"children":1633},{"class":469,"line":1632},30,[1634],{"type":42,"tag":467,"props":1635,"children":1636},{"style":1176},[1637],{"type":48,"value":1638},"    # avoid division by zero\n",{"type":42,"tag":467,"props":1640,"children":1642},{"class":469,"line":1641},31,[1643,1648,1652],{"type":42,"tag":467,"props":1644,"children":1645},{"style":480},[1646],{"type":48,"value":1647},"    epsilon ",{"type":42,"tag":467,"props":1649,"children":1650},{"style":474},[1651],{"type":48,"value":542},{"type":42,"tag":467,"props":1653,"children":1654},{"style":588},[1655],{"type":48,"value":1656}," 1e-5\n",{"type":42,"tag":467,"props":1658,"children":1660},{"class":469,"line":1659},32,[1661,1666,1670,1675,1680],{"type":42,"tag":467,"props":1662,"children":1663},{"style":480},[1664],{"type":48,"value":1665},"    inv_distances ",{"type":42,"tag":467,"props":1667,"children":1668},{"style":474},[1669],{"type":48,"value":542},{"type":42,"tag":467,"props":1671,"children":1672},{"style":588},[1673],{"type":48,"value":1674}," 1.0",{"type":42,"tag":467,"props":1676,"children":1677},{"style":474},[1678],{"type":48,"value":1679}," /",{"type":42,"tag":467,"props":1681,"children":1682},{"style":480},[1683],{"type":48,"value":1684}," cp.maximum(distances, epsilon)\n",{"type":42,"tag":467,"props":1686,"children":1688},{"class":469,"line":1687},33,[1689],{"type":42,"tag":467,"props":1690,"children":1691},{"emptyLinePlaceholder":37},[1692],{"type":48,"value":528},{"type":42,"tag":467,"props":1694,"children":1696},{"class":469,"line":1695},34,[1697],{"type":42,"tag":467,"props":1698,"children":1699},{"style":1176},[1700],{"type":48,"value":1701},"    # calculate forces\n",{"type":42,"tag":467,"props":1703,"children":1705},{"class":469,"line":1704},35,[1706,1711,1715,1720,1725,1730,1734,1739,1744,1748,1752,1757],{"type":42,"tag":467,"props":1707,"children":1708},{"style":480},[1709],{"type":48,"value":1710},"    cp_forces ",{"type":42,"tag":467,"props":1712,"children":1713},{"style":474},[1714],{"type":48,"value":542},{"type":42,"tag":467,"props":1716,"children":1717},{"style":480},[1718],{"type":48,"value":1719}," cp.sum((diff.T ",{"type":42,"tag":467,"props":1721,"children":1722},{"style":474},[1723],{"type":48,"value":1724},"*",{"type":42,"tag":467,"props":1726,"children":1727},{"style":480},[1728],{"type":48,"value":1729}," inv_distances",{"type":42,"tag":467,"props":1731,"children":1732},{"style":474},[1733],{"type":48,"value":1595},{"type":42,"tag":467,"props":1735,"children":1736},{"style":588},[1737],{"type":48,"value":1738},"3",{"type":42,"tag":467,"props":1740,"children":1741},{"style":480},[1742],{"type":48,"value":1743},").T, ",{"type":42,"tag":467,"props":1745,"children":1746},{"style":554},[1747],{"type":48,"value":1408},{"type":42,"tag":467,"props":1749,"children":1750},{"style":474},[1751],{"type":48,"value":542},{"type":42,"tag":467,"props":1753,"children":1754},{"style":588},[1755],{"type":48,"value":1756},"1",{"type":42,"tag":467,"props":1758,"children":1759},{"style":480},[1760],{"type":48,"value":622},{"type":42,"tag":467,"props":1762,"children":1764},{"class":469,"line":1763},36,[1765],{"type":42,"tag":467,"props":1766,"children":1767},{"emptyLinePlaceholder":37},[1768],{"type":48,"value":528},{"type":42,"tag":467,"props":1770,"children":1772},{"class":469,"line":1771},37,[1773],{"type":42,"tag":467,"props":1774,"children":1775},{"style":1176},[1776],{"type":48,"value":1777},"    # update velocities and positions\n",{"type":42,"tag":467,"props":1779,"children":1781},{"class":469,"line":1780},38,[1782,1787,1792,1797,1802],{"type":42,"tag":467,"props":1783,"children":1784},{"style":480},[1785],{"type":48,"value":1786},"    cp_velocities ",{"type":42,"tag":467,"props":1788,"children":1789},{"style":474},[1790],{"type":48,"value":1791},"+=",{"type":42,"tag":467,"props":1793,"children":1794},{"style":588},[1795],{"type":48,"value":1796}," DT",{"type":42,"tag":467,"props":1798,"children":1799},{"style":474},[1800],{"type":48,"value":1801}," *",{"type":42,"tag":467,"props":1803,"children":1804},{"style":480},[1805],{"type":48,"value":1806}," cp_forces\n",{"type":42,"tag":467,"props":1808,"children":1810},{"class":469,"line":1809},39,[1811,1816,1820,1824,1828],{"type":42,"tag":467,"props":1812,"children":1813},{"style":480},[1814],{"type":48,"value":1815},"    cp_positions ",{"type":42,"tag":467,"props":1817,"children":1818},{"style":474},[1819],{"type":48,"value":1791},{"type":42,"tag":467,"props":1821,"children":1822},{"style":588},[1823],{"type":48,"value":1796},{"type":42,"tag":467,"props":1825,"children":1826},{"style":474},[1827],{"type":48,"value":1801},{"type":42,"tag":467,"props":1829,"children":1830},{"style":480},[1831],{"type":48,"value":1832}," cp_velocities\n",{"type":42,"tag":467,"props":1834,"children":1836},{"class":469,"line":1835},40,[1837,1842,1846,1851,1855,1860,1864],{"type":42,"tag":467,"props":1838,"children":1839},{"style":480},[1840],{"type":48,"value":1841},"    cp_ticks ",{"type":42,"tag":467,"props":1843,"children":1844},{"style":474},[1845],{"type":48,"value":542},{"type":42,"tag":467,"props":1847,"children":1848},{"style":480},[1849],{"type":48,"value":1850}," cp.append(cp_ticks, cp.expand_dims(cp_positions, ",{"type":42,"tag":467,"props":1852,"children":1853},{"style":588},[1854],{"type":48,"value":199},{"type":42,"tag":467,"props":1856,"children":1857},{"style":480},[1858],{"type":48,"value":1859},"), ",{"type":42,"tag":467,"props":1861,"children":1862},{"style":588},[1863],{"type":48,"value":199},{"type":42,"tag":467,"props":1865,"children":1866},{"style":480},[1867],{"type":48,"value":622},{"type":42,"tag":467,"props":1869,"children":1871},{"class":469,"line":1870},41,[1872],{"type":42,"tag":467,"props":1873,"children":1874},{"emptyLinePlaceholder":37},[1875],{"type":48,"value":528},{"type":42,"tag":467,"props":1877,"children":1879},{"class":469,"line":1878},42,[1880,1885,1889,1894,1898],{"type":42,"tag":467,"props":1881,"children":1882},{"style":480},[1883],{"type":48,"value":1884},"sim_time ",{"type":42,"tag":467,"props":1886,"children":1887},{"style":474},[1888],{"type":48,"value":542},{"type":42,"tag":467,"props":1890,"children":1891},{"style":480},[1892],{"type":48,"value":1893}," time.time() ",{"type":42,"tag":467,"props":1895,"children":1896},{"style":474},[1897],{"type":48,"value":1558},{"type":42,"tag":467,"props":1899,"children":1900},{"style":480},[1901],{"type":48,"value":1902}," start_time\n",{"type":42,"tag":467,"props":1904,"children":1906},{"class":469,"line":1905},43,[1907,1911,1915,1920],{"type":42,"tag":467,"props":1908,"children":1909},{"style":798},[1910],{"type":48,"value":801},{"type":42,"tag":467,"props":1912,"children":1913},{"style":480},[1914],{"type":48,"value":806},{"type":42,"tag":467,"props":1916,"children":1917},{"style":564},[1918],{"type":48,"value":1919},"\"Simulation time:\"",{"type":42,"tag":467,"props":1921,"children":1922},{"style":480},[1923],{"type":48,"value":1924},", sim_time)\n",{"type":42,"tag":467,"props":1926,"children":1928},{"class":469,"line":1927},44,[1929],{"type":42,"tag":467,"props":1930,"children":1931},{"emptyLinePlaceholder":37},[1932],{"type":48,"value":528},{"type":42,"tag":467,"props":1934,"children":1936},{"class":469,"line":1935},45,[1937],{"type":42,"tag":467,"props":1938,"children":1939},{"emptyLinePlaceholder":37},[1940],{"type":48,"value":528},{"type":42,"tag":467,"props":1942,"children":1944},{"class":469,"line":1943},46,[1945,1950,1956,1960,1966,1971,1976],{"type":42,"tag":467,"props":1946,"children":1947},{"style":903},[1948],{"type":48,"value":1949},"class",{"type":42,"tag":467,"props":1951,"children":1953},{"style":1952},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[1954],{"type":48,"value":1955}," NumpyArrayEncoder",{"type":42,"tag":467,"props":1957,"children":1958},{"style":480},[1959],{"type":48,"value":806},{"type":42,"tag":467,"props":1961,"children":1963},{"style":1962},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[1964],{"type":48,"value":1965},"json",{"type":42,"tag":467,"props":1967,"children":1968},{"style":480},[1969],{"type":48,"value":1970},".",{"type":42,"tag":467,"props":1972,"children":1973},{"style":1962},[1974],{"type":48,"value":1975},"JSONEncoder",{"type":42,"tag":467,"props":1977,"children":1978},{"style":480},[1979],{"type":48,"value":1508},{"type":42,"tag":467,"props":1981,"children":1983},{"class":469,"line":1982},47,[1984,1989,1995,1999,2005,2009,2014],{"type":42,"tag":467,"props":1985,"children":1986},{"style":903},[1987],{"type":48,"value":1988},"    def",{"type":42,"tag":467,"props":1990,"children":1992},{"style":1991},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1993],{"type":48,"value":1994}," default",{"type":42,"tag":467,"props":1996,"children":1997},{"style":480},[1998],{"type":48,"value":806},{"type":42,"tag":467,"props":2000,"children":2002},{"style":2001},"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[2003],{"type":48,"value":2004},"self",{"type":42,"tag":467,"props":2006,"children":2007},{"style":480},[2008],{"type":48,"value":935},{"type":42,"tag":467,"props":2010,"children":2011},{"style":2001},[2012],{"type":48,"value":2013},"obj",{"type":42,"tag":467,"props":2015,"children":2016},{"style":480},[2017],{"type":48,"value":1508},{"type":42,"tag":467,"props":2019,"children":2021},{"class":469,"line":2020},48,[2022,2027,2032],{"type":42,"tag":467,"props":2023,"children":2024},{"style":474},[2025],{"type":48,"value":2026},"        if",{"type":42,"tag":467,"props":2028,"children":2029},{"style":798},[2030],{"type":48,"value":2031}," isinstance",{"type":42,"tag":467,"props":2033,"children":2034},{"style":480},[2035],{"type":48,"value":2036},"(obj, np.ndarray):\n",{"type":42,"tag":467,"props":2038,"children":2040},{"class":469,"line":2039},49,[2041,2046],{"type":42,"tag":467,"props":2042,"children":2043},{"style":474},[2044],{"type":48,"value":2045},"            return",{"type":42,"tag":467,"props":2047,"children":2048},{"style":480},[2049],{"type":48,"value":2050}," obj.tolist()\n",{"type":42,"tag":467,"props":2052,"children":2054},{"class":469,"line":2053},50,[2055,2060,2065,2070],{"type":42,"tag":467,"props":2056,"children":2057},{"style":474},[2058],{"type":48,"value":2059},"        return",{"type":42,"tag":467,"props":2061,"children":2062},{"style":480},[2063],{"type":48,"value":2064}," json.JSONEncoder.default(",{"type":42,"tag":467,"props":2066,"children":2068},{"style":2067},"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2069],{"type":48,"value":2004},{"type":42,"tag":467,"props":2071,"children":2072},{"style":480},[2073],{"type":48,"value":2074},", obj)\n",{"type":42,"tag":467,"props":2076,"children":2078},{"class":469,"line":2077},51,[2079],{"type":42,"tag":467,"props":2080,"children":2081},{"emptyLinePlaceholder":37},[2082],{"type":48,"value":528},{"type":42,"tag":467,"props":2084,"children":2086},{"class":469,"line":2085},52,[2087],{"type":42,"tag":467,"props":2088,"children":2089},{"emptyLinePlaceholder":37},[2090],{"type":48,"value":528},{"type":42,"tag":467,"props":2092,"children":2094},{"class":469,"line":2093},53,[2095,2099,2103],{"type":42,"tag":467,"props":2096,"children":2097},{"style":480},[2098],{"type":48,"value":1394},{"type":42,"tag":467,"props":2100,"children":2101},{"style":474},[2102],{"type":48,"value":542},{"type":42,"tag":467,"props":2104,"children":2105},{"style":480},[2106],{"type":48,"value":2107}," cp_ticks.get()\n",{"type":42,"tag":467,"props":2109,"children":2111},{"class":469,"line":2110},54,[2112],{"type":42,"tag":467,"props":2113,"children":2114},{"emptyLinePlaceholder":37},[2115],{"type":48,"value":528},{"type":42,"tag":467,"props":2117,"children":2119},{"class":469,"line":2118},55,[2120],{"type":42,"tag":467,"props":2121,"children":2122},{"emptyLinePlaceholder":37},[2123],{"type":48,"value":528},{"type":42,"tag":467,"props":2125,"children":2127},{"class":469,"line":2126},56,[2128],{"type":42,"tag":467,"props":2129,"children":2130},{"style":1176},[2131],{"type":48,"value":2132},"# this is data we can work with in python and write to a file\n",{"type":42,"tag":467,"props":2134,"children":2136},{"class":469,"line":2135},57,[2137,2142,2147,2151,2156,2160,2165,2170,2174],{"type":42,"tag":467,"props":2138,"children":2139},{"style":474},[2140],{"type":48,"value":2141},"with",{"type":42,"tag":467,"props":2143,"children":2144},{"style":798},[2145],{"type":48,"value":2146}," open",{"type":42,"tag":467,"props":2148,"children":2149},{"style":480},[2150],{"type":48,"value":806},{"type":42,"tag":467,"props":2152,"children":2153},{"style":564},[2154],{"type":48,"value":2155},"\"ticks.json\"",{"type":42,"tag":467,"props":2157,"children":2158},{"style":480},[2159],{"type":48,"value":935},{"type":42,"tag":467,"props":2161,"children":2162},{"style":564},[2163],{"type":48,"value":2164},"\"w\"",{"type":42,"tag":467,"props":2166,"children":2167},{"style":480},[2168],{"type":48,"value":2169},") ",{"type":42,"tag":467,"props":2171,"children":2172},{"style":474},[2173],{"type":48,"value":1114},{"type":42,"tag":467,"props":2175,"children":2176},{"style":480},[2177],{"type":48,"value":2178}," f:\n",{"type":42,"tag":467,"props":2180,"children":2182},{"class":469,"line":2181},58,[2183,2188,2193,2197],{"type":42,"tag":467,"props":2184,"children":2185},{"style":480},[2186],{"type":48,"value":2187},"    f.write(json.dumps(np_ticks, ",{"type":42,"tag":467,"props":2189,"children":2190},{"style":554},[2191],{"type":48,"value":2192},"cls",{"type":42,"tag":467,"props":2194,"children":2195},{"style":474},[2196],{"type":48,"value":542},{"type":42,"tag":467,"props":2198,"children":2199},{"style":480},[2200],{"type":48,"value":2201},"NumpyArrayEncoder))\n",{"type":42,"tag":51,"props":2203,"children":2204},{},[2205],{"type":48,"value":2206},"To better understand the matrix math here I walked through a simple example of what each step does:",{"type":42,"tag":401,"props":2208,"children":2210},{"code":2209,"language":1092,"meta":8,"className":1093,"style":8},"# particle coordinates (x,y,z) in 3D space\npositions = cp.array([[1,2.5,3], [4,5,6], [7,8,9]])\n",[2211],{"type":42,"tag":349,"props":2212,"children":2213},{"__ignoreMap":8},[2214,2222],{"type":42,"tag":467,"props":2215,"children":2216},{"class":469,"line":470},[2217],{"type":42,"tag":467,"props":2218,"children":2219},{"style":1176},[2220],{"type":48,"value":2221},"# particle coordinates (x,y,z) in 3D space\n",{"type":42,"tag":467,"props":2223,"children":2224},{"class":469,"line":486},[2225,2230,2234,2239,2243,2248,2253,2257,2261,2266,2270,2274,2278,2282,2287,2291,2296,2300,2304,2308,2313],{"type":42,"tag":467,"props":2226,"children":2227},{"style":480},[2228],{"type":48,"value":2229},"positions ",{"type":42,"tag":467,"props":2231,"children":2232},{"style":474},[2233],{"type":48,"value":542},{"type":42,"tag":467,"props":2235,"children":2236},{"style":480},[2237],{"type":48,"value":2238}," cp.array([[",{"type":42,"tag":467,"props":2240,"children":2241},{"style":588},[2242],{"type":48,"value":1756},{"type":42,"tag":467,"props":2244,"children":2245},{"style":480},[2246],{"type":48,"value":2247},",",{"type":42,"tag":467,"props":2249,"children":2250},{"style":588},[2251],{"type":48,"value":2252},"2.5",{"type":42,"tag":467,"props":2254,"children":2255},{"style":480},[2256],{"type":48,"value":2247},{"type":42,"tag":467,"props":2258,"children":2259},{"style":588},[2260],{"type":48,"value":1738},{"type":42,"tag":467,"props":2262,"children":2263},{"style":480},[2264],{"type":48,"value":2265},"], [",{"type":42,"tag":467,"props":2267,"children":2268},{"style":588},[2269],{"type":48,"value":822},{"type":42,"tag":467,"props":2271,"children":2272},{"style":480},[2273],{"type":48,"value":2247},{"type":42,"tag":467,"props":2275,"children":2276},{"style":588},[2277],{"type":48,"value":1059},{"type":42,"tag":467,"props":2279,"children":2280},{"style":480},[2281],{"type":48,"value":2247},{"type":42,"tag":467,"props":2283,"children":2284},{"style":588},[2285],{"type":48,"value":2286},"6",{"type":42,"tag":467,"props":2288,"children":2289},{"style":480},[2290],{"type":48,"value":2265},{"type":42,"tag":467,"props":2292,"children":2293},{"style":588},[2294],{"type":48,"value":2295},"7",{"type":42,"tag":467,"props":2297,"children":2298},{"style":480},[2299],{"type":48,"value":2247},{"type":42,"tag":467,"props":2301,"children":2302},{"style":588},[2303],{"type":48,"value":1043},{"type":42,"tag":467,"props":2305,"children":2306},{"style":480},[2307],{"type":48,"value":2247},{"type":42,"tag":467,"props":2309,"children":2310},{"style":588},[2311],{"type":48,"value":2312},"9",{"type":42,"tag":467,"props":2314,"children":2315},{"style":480},[2316],{"type":48,"value":2317},"]])\n",{"type":42,"tag":51,"props":2319,"children":2320},{},[2321],{"type":48,"value":2322},"The first operation creates an array for pairwise distances for each dimension:",{"type":42,"tag":401,"props":2324,"children":2326},{"code":2325,"language":19,"meta":8,"className":461,"style":8},"diff = positions[None, :, :] - positions[:, None, :]\nprint(diff)\n\narray([[[ 0. ,  0. ,  0. ],\n        [ 3. ,  2.5,  3. ],\n        [ 6. ,  5.5,  6. ]],\n\n       [[-3. , -2.5, -3. ],\n        [ 0. ,  0. ,  0. ],\n        [ 3. ,  3. ,  3. ]],\n\n       [[-6. , -5.5, -6. ],\n        [-3. , -3. , -3. ],\n        [ 0. ,  0. ,  0. ]]])\n",[2327],{"type":42,"tag":349,"props":2328,"children":2329},{"__ignoreMap":8},[2330,2374,2386,2393,2427,2460,2493,2500,2545,2576,2607,2614,2657,2701],{"type":42,"tag":467,"props":2331,"children":2332},{"class":469,"line":470},[2333,2338,2342,2347,2351,2356,2360,2365,2369],{"type":42,"tag":467,"props":2334,"children":2335},{"style":480},[2336],{"type":48,"value":2337},"diff ",{"type":42,"tag":467,"props":2339,"children":2340},{"style":474},[2341],{"type":48,"value":542},{"type":42,"tag":467,"props":2343,"children":2344},{"style":480},[2345],{"type":48,"value":2346}," positions[",{"type":42,"tag":467,"props":2348,"children":2349},{"style":588},[2350],{"type":48,"value":1548},{"type":42,"tag":467,"props":2352,"children":2353},{"style":480},[2354],{"type":48,"value":2355},", :, :] ",{"type":42,"tag":467,"props":2357,"children":2358},{"style":474},[2359],{"type":48,"value":1558},{"type":42,"tag":467,"props":2361,"children":2362},{"style":480},[2363],{"type":48,"value":2364}," positions[:, ",{"type":42,"tag":467,"props":2366,"children":2367},{"style":588},[2368],{"type":48,"value":1548},{"type":42,"tag":467,"props":2370,"children":2371},{"style":480},[2372],{"type":48,"value":2373},", :]\n",{"type":42,"tag":467,"props":2375,"children":2376},{"class":469,"line":486},[2377,2381],{"type":42,"tag":467,"props":2378,"children":2379},{"style":798},[2380],{"type":48,"value":801},{"type":42,"tag":467,"props":2382,"children":2383},{"style":480},[2384],{"type":48,"value":2385},"(diff)\n",{"type":42,"tag":467,"props":2387,"children":2388},{"class":469,"line":499},[2389],{"type":42,"tag":467,"props":2390,"children":2391},{"emptyLinePlaceholder":37},[2392],{"type":48,"value":528},{"type":42,"tag":467,"props":2394,"children":2395},{"class":469,"line":522},[2396,2401,2405,2410,2414,2418,2422],{"type":42,"tag":467,"props":2397,"children":2398},{"style":480},[2399],{"type":48,"value":2400},"array([[[ ",{"type":42,"tag":467,"props":2402,"children":2403},{"style":588},[2404],{"type":48,"value":199},{"type":42,"tag":467,"props":2406,"children":2407},{"style":480},[2408],{"type":48,"value":2409},". ,  ",{"type":42,"tag":467,"props":2411,"children":2412},{"style":588},[2413],{"type":48,"value":199},{"type":42,"tag":467,"props":2415,"children":2416},{"style":480},[2417],{"type":48,"value":2409},{"type":42,"tag":467,"props":2419,"children":2420},{"style":588},[2421],{"type":48,"value":199},{"type":42,"tag":467,"props":2423,"children":2424},{"style":480},[2425],{"type":48,"value":2426},". ],\n",{"type":42,"tag":467,"props":2428,"children":2429},{"class":469,"line":531},[2430,2435,2439,2443,2447,2452,2456],{"type":42,"tag":467,"props":2431,"children":2432},{"style":480},[2433],{"type":48,"value":2434},"        [ ",{"type":42,"tag":467,"props":2436,"children":2437},{"style":588},[2438],{"type":48,"value":1738},{"type":42,"tag":467,"props":2440,"children":2441},{"style":480},[2442],{"type":48,"value":2409},{"type":42,"tag":467,"props":2444,"children":2445},{"style":588},[2446],{"type":48,"value":2252},{"type":42,"tag":467,"props":2448,"children":2449},{"style":480},[2450],{"type":48,"value":2451},",  ",{"type":42,"tag":467,"props":2453,"children":2454},{"style":588},[2455],{"type":48,"value":1738},{"type":42,"tag":467,"props":2457,"children":2458},{"style":480},[2459],{"type":48,"value":2426},{"type":42,"tag":467,"props":2461,"children":2462},{"class":469,"line":550},[2463,2467,2471,2475,2480,2484,2488],{"type":42,"tag":467,"props":2464,"children":2465},{"style":480},[2466],{"type":48,"value":2434},{"type":42,"tag":467,"props":2468,"children":2469},{"style":588},[2470],{"type":48,"value":2286},{"type":42,"tag":467,"props":2472,"children":2473},{"style":480},[2474],{"type":48,"value":2409},{"type":42,"tag":467,"props":2476,"children":2477},{"style":588},[2478],{"type":48,"value":2479},"5.5",{"type":42,"tag":467,"props":2481,"children":2482},{"style":480},[2483],{"type":48,"value":2451},{"type":42,"tag":467,"props":2485,"children":2486},{"style":588},[2487],{"type":48,"value":2286},{"type":42,"tag":467,"props":2489,"children":2490},{"style":480},[2491],{"type":48,"value":2492},". ]],\n",{"type":42,"tag":467,"props":2494,"children":2495},{"class":469,"line":575},[2496],{"type":42,"tag":467,"props":2497,"children":2498},{"emptyLinePlaceholder":37},[2499],{"type":48,"value":528},{"type":42,"tag":467,"props":2501,"children":2502},{"class":469,"line":598},[2503,2508,2512,2516,2521,2525,2529,2533,2537,2541],{"type":42,"tag":467,"props":2504,"children":2505},{"style":480},[2506],{"type":48,"value":2507},"       [[",{"type":42,"tag":467,"props":2509,"children":2510},{"style":474},[2511],{"type":48,"value":1558},{"type":42,"tag":467,"props":2513,"children":2514},{"style":588},[2515],{"type":48,"value":1738},{"type":42,"tag":467,"props":2517,"children":2518},{"style":480},[2519],{"type":48,"value":2520},". , ",{"type":42,"tag":467,"props":2522,"children":2523},{"style":474},[2524],{"type":48,"value":1558},{"type":42,"tag":467,"props":2526,"children":2527},{"style":588},[2528],{"type":48,"value":2252},{"type":42,"tag":467,"props":2530,"children":2531},{"style":480},[2532],{"type":48,"value":935},{"type":42,"tag":467,"props":2534,"children":2535},{"style":474},[2536],{"type":48,"value":1558},{"type":42,"tag":467,"props":2538,"children":2539},{"style":588},[2540],{"type":48,"value":1738},{"type":42,"tag":467,"props":2542,"children":2543},{"style":480},[2544],{"type":48,"value":2426},{"type":42,"tag":467,"props":2546,"children":2547},{"class":469,"line":616},[2548,2552,2556,2560,2564,2568,2572],{"type":42,"tag":467,"props":2549,"children":2550},{"style":480},[2551],{"type":48,"value":2434},{"type":42,"tag":467,"props":2553,"children":2554},{"style":588},[2555],{"type":48,"value":199},{"type":42,"tag":467,"props":2557,"children":2558},{"style":480},[2559],{"type":48,"value":2409},{"type":42,"tag":467,"props":2561,"children":2562},{"style":588},[2563],{"type":48,"value":199},{"type":42,"tag":467,"props":2565,"children":2566},{"style":480},[2567],{"type":48,"value":2409},{"type":42,"tag":467,"props":2569,"children":2570},{"style":588},[2571],{"type":48,"value":199},{"type":42,"tag":467,"props":2573,"children":2574},{"style":480},[2575],{"type":48,"value":2426},{"type":42,"tag":467,"props":2577,"children":2578},{"class":469,"line":625},[2579,2583,2587,2591,2595,2599,2603],{"type":42,"tag":467,"props":2580,"children":2581},{"style":480},[2582],{"type":48,"value":2434},{"type":42,"tag":467,"props":2584,"children":2585},{"style":588},[2586],{"type":48,"value":1738},{"type":42,"tag":467,"props":2588,"children":2589},{"style":480},[2590],{"type":48,"value":2409},{"type":42,"tag":467,"props":2592,"children":2593},{"style":588},[2594],{"type":48,"value":1738},{"type":42,"tag":467,"props":2596,"children":2597},{"style":480},[2598],{"type":48,"value":2409},{"type":42,"tag":467,"props":2600,"children":2601},{"style":588},[2602],{"type":48,"value":1738},{"type":42,"tag":467,"props":2604,"children":2605},{"style":480},[2606],{"type":48,"value":2492},{"type":42,"tag":467,"props":2608,"children":2609},{"class":469,"line":633},[2610],{"type":42,"tag":467,"props":2611,"children":2612},{"emptyLinePlaceholder":37},[2613],{"type":48,"value":528},{"type":42,"tag":467,"props":2615,"children":2616},{"class":469,"line":664},[2617,2621,2625,2629,2633,2637,2641,2645,2649,2653],{"type":42,"tag":467,"props":2618,"children":2619},{"style":480},[2620],{"type":48,"value":2507},{"type":42,"tag":467,"props":2622,"children":2623},{"style":474},[2624],{"type":48,"value":1558},{"type":42,"tag":467,"props":2626,"children":2627},{"style":588},[2628],{"type":48,"value":2286},{"type":42,"tag":467,"props":2630,"children":2631},{"style":480},[2632],{"type":48,"value":2520},{"type":42,"tag":467,"props":2634,"children":2635},{"style":474},[2636],{"type":48,"value":1558},{"type":42,"tag":467,"props":2638,"children":2639},{"style":588},[2640],{"type":48,"value":2479},{"type":42,"tag":467,"props":2642,"children":2643},{"style":480},[2644],{"type":48,"value":935},{"type":42,"tag":467,"props":2646,"children":2647},{"style":474},[2648],{"type":48,"value":1558},{"type":42,"tag":467,"props":2650,"children":2651},{"style":588},[2652],{"type":48,"value":2286},{"type":42,"tag":467,"props":2654,"children":2655},{"style":480},[2656],{"type":48,"value":2426},{"type":42,"tag":467,"props":2658,"children":2659},{"class":469,"line":672},[2660,2665,2669,2673,2677,2681,2685,2689,2693,2697],{"type":42,"tag":467,"props":2661,"children":2662},{"style":480},[2663],{"type":48,"value":2664},"        [",{"type":42,"tag":467,"props":2666,"children":2667},{"style":474},[2668],{"type":48,"value":1558},{"type":42,"tag":467,"props":2670,"children":2671},{"style":588},[2672],{"type":48,"value":1738},{"type":42,"tag":467,"props":2674,"children":2675},{"style":480},[2676],{"type":48,"value":2520},{"type":42,"tag":467,"props":2678,"children":2679},{"style":474},[2680],{"type":48,"value":1558},{"type":42,"tag":467,"props":2682,"children":2683},{"style":588},[2684],{"type":48,"value":1738},{"type":42,"tag":467,"props":2686,"children":2687},{"style":480},[2688],{"type":48,"value":2520},{"type":42,"tag":467,"props":2690,"children":2691},{"style":474},[2692],{"type":48,"value":1558},{"type":42,"tag":467,"props":2694,"children":2695},{"style":588},[2696],{"type":48,"value":1738},{"type":42,"tag":467,"props":2698,"children":2699},{"style":480},[2700],{"type":48,"value":2426},{"type":42,"tag":467,"props":2702,"children":2703},{"class":469,"line":690},[2704,2708,2712,2716,2720,2724,2728],{"type":42,"tag":467,"props":2705,"children":2706},{"style":480},[2707],{"type":48,"value":2434},{"type":42,"tag":467,"props":2709,"children":2710},{"style":588},[2711],{"type":48,"value":199},{"type":42,"tag":467,"props":2713,"children":2714},{"style":480},[2715],{"type":48,"value":2409},{"type":42,"tag":467,"props":2717,"children":2718},{"style":588},[2719],{"type":48,"value":199},{"type":42,"tag":467,"props":2721,"children":2722},{"style":480},[2723],{"type":48,"value":2409},{"type":42,"tag":467,"props":2725,"children":2726},{"style":588},[2727],{"type":48,"value":199},{"type":42,"tag":467,"props":2729,"children":2730},{"style":480},[2731],{"type":48,"value":2732},". ]]])\n",{"type":42,"tag":51,"props":2734,"children":2735},{},[2736,2738,2743,2744,2750,2752,2758],{"type":48,"value":2737},"The rows of zeros correspond to a particle's ",{"type":42,"tag":349,"props":2739,"children":2741},{"className":2740},[],[2742],{"type":48,"value":36},{"type":48,"value":935},{"type":42,"tag":349,"props":2745,"children":2747},{"className":2746},[],[2748],{"type":48,"value":2749},"y",{"type":48,"value":2751}," and ",{"type":42,"tag":349,"props":2753,"children":2755},{"className":2754},[],[2756],{"type":48,"value":2757},"z",{"type":48,"value":2759}," distances to itself, which are all zero by axioms of Euclidian vector spaces.",{"type":42,"tag":51,"props":2761,"children":2762},{},[2763],{"type":48,"value":2764},"The next operation calculates the distance between each particle:",{"type":42,"tag":401,"props":2766,"children":2768},{"code":2767,"language":19,"meta":8,"className":461,"style":8},"distances = cp.sqrt(cp.sum(diff**2, axis=2))\nprint(distances)\n\narray([[ 0.        ,  4.9244289 , 10.11187421],\n       [ 4.9244289 ,  0.        ,  5.19615242],\n       [10.11187421,  5.19615242,  0.        ]])\n",[2769],{"type":42,"tag":349,"props":2770,"children":2771},{"__ignoreMap":8},[2772,2816,2828,2835,2872,2906],{"type":42,"tag":467,"props":2773,"children":2774},{"class":469,"line":470},[2775,2780,2784,2788,2792,2796,2800,2804,2808,2812],{"type":42,"tag":467,"props":2776,"children":2777},{"style":480},[2778],{"type":48,"value":2779},"distances ",{"type":42,"tag":467,"props":2781,"children":2782},{"style":474},[2783],{"type":48,"value":542},{"type":42,"tag":467,"props":2785,"children":2786},{"style":480},[2787],{"type":48,"value":1590},{"type":42,"tag":467,"props":2789,"children":2790},{"style":474},[2791],{"type":48,"value":1595},{"type":42,"tag":467,"props":2793,"children":2794},{"style":588},[2795],{"type":48,"value":1600},{"type":42,"tag":467,"props":2797,"children":2798},{"style":480},[2799],{"type":48,"value":935},{"type":42,"tag":467,"props":2801,"children":2802},{"style":554},[2803],{"type":48,"value":1408},{"type":42,"tag":467,"props":2805,"children":2806},{"style":474},[2807],{"type":48,"value":542},{"type":42,"tag":467,"props":2809,"children":2810},{"style":588},[2811],{"type":48,"value":1600},{"type":42,"tag":467,"props":2813,"children":2814},{"style":480},[2815],{"type":48,"value":1621},{"type":42,"tag":467,"props":2817,"children":2818},{"class":469,"line":486},[2819,2823],{"type":42,"tag":467,"props":2820,"children":2821},{"style":798},[2822],{"type":48,"value":801},{"type":42,"tag":467,"props":2824,"children":2825},{"style":480},[2826],{"type":48,"value":2827},"(distances)\n",{"type":42,"tag":467,"props":2829,"children":2830},{"class":469,"line":499},[2831],{"type":42,"tag":467,"props":2832,"children":2833},{"emptyLinePlaceholder":37},[2834],{"type":48,"value":528},{"type":42,"tag":467,"props":2836,"children":2837},{"class":469,"line":522},[2838,2843,2847,2852,2857,2862,2867],{"type":42,"tag":467,"props":2839,"children":2840},{"style":480},[2841],{"type":48,"value":2842},"array([[ ",{"type":42,"tag":467,"props":2844,"children":2845},{"style":588},[2846],{"type":48,"value":199},{"type":42,"tag":467,"props":2848,"children":2849},{"style":480},[2850],{"type":48,"value":2851},".        ,  ",{"type":42,"tag":467,"props":2853,"children":2854},{"style":588},[2855],{"type":48,"value":2856},"4.9244289",{"type":42,"tag":467,"props":2858,"children":2859},{"style":480},[2860],{"type":48,"value":2861}," , ",{"type":42,"tag":467,"props":2863,"children":2864},{"style":588},[2865],{"type":48,"value":2866},"10.11187421",{"type":42,"tag":467,"props":2868,"children":2869},{"style":480},[2870],{"type":48,"value":2871},"],\n",{"type":42,"tag":467,"props":2873,"children":2874},{"class":469,"line":531},[2875,2880,2884,2889,2893,2897,2902],{"type":42,"tag":467,"props":2876,"children":2877},{"style":480},[2878],{"type":48,"value":2879},"       [ ",{"type":42,"tag":467,"props":2881,"children":2882},{"style":588},[2883],{"type":48,"value":2856},{"type":42,"tag":467,"props":2885,"children":2886},{"style":480},[2887],{"type":48,"value":2888}," ,  ",{"type":42,"tag":467,"props":2890,"children":2891},{"style":588},[2892],{"type":48,"value":199},{"type":42,"tag":467,"props":2894,"children":2895},{"style":480},[2896],{"type":48,"value":2851},{"type":42,"tag":467,"props":2898,"children":2899},{"style":588},[2900],{"type":48,"value":2901},"5.19615242",{"type":42,"tag":467,"props":2903,"children":2904},{"style":480},[2905],{"type":48,"value":2871},{"type":42,"tag":467,"props":2907,"children":2908},{"class":469,"line":550},[2909,2914,2918,2922,2926,2930,2934],{"type":42,"tag":467,"props":2910,"children":2911},{"style":480},[2912],{"type":48,"value":2913},"       [",{"type":42,"tag":467,"props":2915,"children":2916},{"style":588},[2917],{"type":48,"value":2866},{"type":42,"tag":467,"props":2919,"children":2920},{"style":480},[2921],{"type":48,"value":2451},{"type":42,"tag":467,"props":2923,"children":2924},{"style":588},[2925],{"type":48,"value":2901},{"type":42,"tag":467,"props":2927,"children":2928},{"style":480},[2929],{"type":48,"value":2451},{"type":42,"tag":467,"props":2931,"children":2932},{"style":588},[2933],{"type":48,"value":199},{"type":42,"tag":467,"props":2935,"children":2936},{"style":480},[2937],{"type":48,"value":2938},".        ]])\n",{"type":42,"tag":51,"props":2940,"children":2941},{},[2942,2944,2950],{"type":48,"value":2943},"The diagonal or zeros represents that fact that a particle ",{"type":42,"tag":349,"props":2945,"children":2947},{"className":2946},[],[2948],{"type":48,"value":2949},"n",{"type":48,"value":2951}," has a distance of zero to iself.",{"type":42,"tag":51,"props":2953,"children":2954},{},[2955,2957,2963],{"type":48,"value":2956},"The next step calculates inverse distances and uses a small ",{"type":42,"tag":349,"props":2958,"children":2960},{"className":2959},[],[2961],{"type":48,"value":2962},"epsilon",{"type":48,"value":2964}," value to avoid division by 0:",{"type":42,"tag":401,"props":2966,"children":2968},{"code":2967,"language":19,"meta":8,"className":461,"style":8},"epsilon = 1e-5\ninv_distances = 1.0 / cp.maximum(distances, epsilon)\nprint(inv_distances)\n\narray([[1.00000000e+05, 2.03069233e-01, 9.88936353e-02],\n       [2.03069233e-01, 1.00000000e+05, 1.92450090e-01],\n       [9.88936353e-02, 1.92450090e-01, 1.00000000e+05]])\n",[2969],{"type":42,"tag":349,"props":2970,"children":2971},{"__ignoreMap":8},[2972,2988,3012,3024,3031,3066,3098],{"type":42,"tag":467,"props":2973,"children":2974},{"class":469,"line":470},[2975,2980,2984],{"type":42,"tag":467,"props":2976,"children":2977},{"style":480},[2978],{"type":48,"value":2979},"epsilon ",{"type":42,"tag":467,"props":2981,"children":2982},{"style":474},[2983],{"type":48,"value":542},{"type":42,"tag":467,"props":2985,"children":2986},{"style":588},[2987],{"type":48,"value":1656},{"type":42,"tag":467,"props":2989,"children":2990},{"class":469,"line":486},[2991,2996,3000,3004,3008],{"type":42,"tag":467,"props":2992,"children":2993},{"style":480},[2994],{"type":48,"value":2995},"inv_distances ",{"type":42,"tag":467,"props":2997,"children":2998},{"style":474},[2999],{"type":48,"value":542},{"type":42,"tag":467,"props":3001,"children":3002},{"style":588},[3003],{"type":48,"value":1674},{"type":42,"tag":467,"props":3005,"children":3006},{"style":474},[3007],{"type":48,"value":1679},{"type":42,"tag":467,"props":3009,"children":3010},{"style":480},[3011],{"type":48,"value":1684},{"type":42,"tag":467,"props":3013,"children":3014},{"class":469,"line":499},[3015,3019],{"type":42,"tag":467,"props":3016,"children":3017},{"style":798},[3018],{"type":48,"value":801},{"type":42,"tag":467,"props":3020,"children":3021},{"style":480},[3022],{"type":48,"value":3023},"(inv_distances)\n",{"type":42,"tag":467,"props":3025,"children":3026},{"class":469,"line":522},[3027],{"type":42,"tag":467,"props":3028,"children":3029},{"emptyLinePlaceholder":37},[3030],{"type":48,"value":528},{"type":42,"tag":467,"props":3032,"children":3033},{"class":469,"line":531},[3034,3039,3044,3048,3053,3057,3062],{"type":42,"tag":467,"props":3035,"children":3036},{"style":480},[3037],{"type":48,"value":3038},"array([[",{"type":42,"tag":467,"props":3040,"children":3041},{"style":588},[3042],{"type":48,"value":3043},"1.00000000e+05",{"type":42,"tag":467,"props":3045,"children":3046},{"style":480},[3047],{"type":48,"value":935},{"type":42,"tag":467,"props":3049,"children":3050},{"style":588},[3051],{"type":48,"value":3052},"2.03069233e-01",{"type":42,"tag":467,"props":3054,"children":3055},{"style":480},[3056],{"type":48,"value":935},{"type":42,"tag":467,"props":3058,"children":3059},{"style":588},[3060],{"type":48,"value":3061},"9.88936353e-02",{"type":42,"tag":467,"props":3063,"children":3064},{"style":480},[3065],{"type":48,"value":2871},{"type":42,"tag":467,"props":3067,"children":3068},{"class":469,"line":550},[3069,3073,3077,3081,3085,3089,3094],{"type":42,"tag":467,"props":3070,"children":3071},{"style":480},[3072],{"type":48,"value":2913},{"type":42,"tag":467,"props":3074,"children":3075},{"style":588},[3076],{"type":48,"value":3052},{"type":42,"tag":467,"props":3078,"children":3079},{"style":480},[3080],{"type":48,"value":935},{"type":42,"tag":467,"props":3082,"children":3083},{"style":588},[3084],{"type":48,"value":3043},{"type":42,"tag":467,"props":3086,"children":3087},{"style":480},[3088],{"type":48,"value":935},{"type":42,"tag":467,"props":3090,"children":3091},{"style":588},[3092],{"type":48,"value":3093},"1.92450090e-01",{"type":42,"tag":467,"props":3095,"children":3096},{"style":480},[3097],{"type":48,"value":2871},{"type":42,"tag":467,"props":3099,"children":3100},{"class":469,"line":575},[3101,3105,3109,3113,3117,3121,3125],{"type":42,"tag":467,"props":3102,"children":3103},{"style":480},[3104],{"type":48,"value":2913},{"type":42,"tag":467,"props":3106,"children":3107},{"style":588},[3108],{"type":48,"value":3061},{"type":42,"tag":467,"props":3110,"children":3111},{"style":480},[3112],{"type":48,"value":935},{"type":42,"tag":467,"props":3114,"children":3115},{"style":588},[3116],{"type":48,"value":3093},{"type":42,"tag":467,"props":3118,"children":3119},{"style":480},[3120],{"type":48,"value":935},{"type":42,"tag":467,"props":3122,"children":3123},{"style":588},[3124],{"type":48,"value":3043},{"type":42,"tag":467,"props":3126,"children":3127},{"style":480},[3128],{"type":48,"value":2317},{"type":42,"tag":51,"props":3130,"children":3131},{},[3132],{"type":48,"value":3133},"The next step is the most elegant part of the simulation and really flexes the GPU's parallel compute capabilities:",{"type":42,"tag":401,"props":3135,"children":3137},{"code":3136,"language":19,"meta":8,"className":461,"style":8},"cp_forces = cp.sum((diff.T * inv_distances**3).T, axis=1)\n",[3138],{"type":42,"tag":349,"props":3139,"children":3140},{"__ignoreMap":8},[3141],{"type":42,"tag":467,"props":3142,"children":3143},{"class":469,"line":470},[3144,3149,3153,3157,3161,3165,3169,3173,3177,3181,3185,3189],{"type":42,"tag":467,"props":3145,"children":3146},{"style":480},[3147],{"type":48,"value":3148},"cp_forces ",{"type":42,"tag":467,"props":3150,"children":3151},{"style":474},[3152],{"type":48,"value":542},{"type":42,"tag":467,"props":3154,"children":3155},{"style":480},[3156],{"type":48,"value":1719},{"type":42,"tag":467,"props":3158,"children":3159},{"style":474},[3160],{"type":48,"value":1724},{"type":42,"tag":467,"props":3162,"children":3163},{"style":480},[3164],{"type":48,"value":1729},{"type":42,"tag":467,"props":3166,"children":3167},{"style":474},[3168],{"type":48,"value":1595},{"type":42,"tag":467,"props":3170,"children":3171},{"style":588},[3172],{"type":48,"value":1738},{"type":42,"tag":467,"props":3174,"children":3175},{"style":480},[3176],{"type":48,"value":1743},{"type":42,"tag":467,"props":3178,"children":3179},{"style":554},[3180],{"type":48,"value":1408},{"type":42,"tag":467,"props":3182,"children":3183},{"style":474},[3184],{"type":48,"value":542},{"type":42,"tag":467,"props":3186,"children":3187},{"style":588},[3188],{"type":48,"value":1756},{"type":42,"tag":467,"props":3190,"children":3191},{"style":480},[3192],{"type":48,"value":622},{"type":42,"tag":51,"props":3194,"children":3195},{},[3196,3198,3204],{"type":48,"value":3197},"The ",{"type":42,"tag":349,"props":3199,"children":3201},{"className":3200},[],[3202],{"type":48,"value":3203},".T",{"type":48,"value":3205}," operation transposes a matrix, multiplies by the cube of inverse distances, then transposes the matrix again before summing along the first axis. Transposing a matrix basically swaps rows and columns.",{"type":42,"tag":51,"props":3207,"children":3208},{},[3209],{"type":48,"value":3210},"The next two steps are also pretty elegant:",{"type":42,"tag":401,"props":3212,"children":3214},{"code":3213,"language":19,"meta":8,"className":461,"style":8},"# update velocities and positions\ncp_velocities += DT * cp_forces\ncp_positions += DT * cp_velocities\n",[3215],{"type":42,"tag":349,"props":3216,"children":3217},{"__ignoreMap":8},[3218,3226,3249],{"type":42,"tag":467,"props":3219,"children":3220},{"class":469,"line":470},[3221],{"type":42,"tag":467,"props":3222,"children":3223},{"style":1176},[3224],{"type":48,"value":3225},"# update velocities and positions\n",{"type":42,"tag":467,"props":3227,"children":3228},{"class":469,"line":486},[3229,3233,3237,3241,3245],{"type":42,"tag":467,"props":3230,"children":3231},{"style":480},[3232],{"type":48,"value":1368},{"type":42,"tag":467,"props":3234,"children":3235},{"style":474},[3236],{"type":48,"value":1791},{"type":42,"tag":467,"props":3238,"children":3239},{"style":588},[3240],{"type":48,"value":1796},{"type":42,"tag":467,"props":3242,"children":3243},{"style":474},[3244],{"type":48,"value":1801},{"type":42,"tag":467,"props":3246,"children":3247},{"style":480},[3248],{"type":48,"value":1806},{"type":42,"tag":467,"props":3250,"children":3251},{"class":469,"line":499},[3252,3256,3260,3264,3268],{"type":42,"tag":467,"props":3253,"children":3254},{"style":480},[3255],{"type":48,"value":1350},{"type":42,"tag":467,"props":3257,"children":3258},{"style":474},[3259],{"type":48,"value":1791},{"type":42,"tag":467,"props":3261,"children":3262},{"style":588},[3263],{"type":48,"value":1796},{"type":42,"tag":467,"props":3265,"children":3266},{"style":474},[3267],{"type":48,"value":1801},{"type":42,"tag":467,"props":3269,"children":3270},{"style":480},[3271],{"type":48,"value":1832},{"type":42,"tag":51,"props":3273,"children":3274},{},[3275,3277,3282],{"type":48,"value":3276},"In the last step I append the updated positions to an array that holds every \"tick\" (the positions of each particle between each time interval, ",{"type":42,"tag":349,"props":3278,"children":3280},{"className":3279},[],[3281],{"type":48,"value":1244},{"type":48,"value":3283}," - \"delta time\")",{"type":42,"tag":51,"props":3285,"children":3286},{},[3287],{"type":48,"value":3288},"Here's the formula for the mathematical equation used to calculate the force on any given body in an n-body system:",{"type":42,"tag":193,"props":3290,"children":3293},{"src":3291,"width":195,"height":3292},"https://briancaffey.github.io/three-body-problem/iframe/formula.html",110,[],{"type":42,"tag":51,"props":3295,"children":3296},{},[3297],{"type":48,"value":3298},"To test that the simulation was working correctly I used ChatGPT again to construct a 3D scene in Blender with a Python script:",{"type":42,"tag":51,"props":3300,"children":3301},{},[3302],{"type":42,"tag":127,"props":3303,"children":3306},{"alt":3304,"src":3305},"Blender Animation","/static/three-body-problem/blender.png",[],{"type":42,"tag":280,"props":3308,"children":3310},{"id":3309},"threejs",[3311],{"type":48,"value":3312},"Three.js",{"type":42,"tag":51,"props":3314,"children":3315},{},[3316],{"type":48,"value":3317},"Imagine that we are working for a Chinese startup called the Qin Dynasty. The founder, Qin Shi Huang, is a brutal tyrant with an obsessive fear of assassination. Let's put on our product hat for a minute and think about how we can impress him with a clean solution to the three-body problem. A recent attempt involved building a 30,000-person analog computer that was destroyed in tri-solar syzygy. Failing to accurately predict the movement of the suns could mean execution by live-burial, a fiery death or worse. Using CUDA and Blender is a good MVP but doesn't make for the best technical demo since it involves so many different steps: running the simulation in CUDA, exporting data to JSON, loading data into a visualuzation and then finally rendering a video of the simulation. With a popular Javascript library called Three.js we can run an interactive three-body problem simulation in real-time right in the browser. Here's the three-body simulation I also co-authored with ChatGPT-4 using Three.js:",{"type":42,"tag":193,"props":3319,"children":3322},{"src":3320,"width":195,"height":3321},"https://briancaffey.github.io/three-body-problem/three/",350,[],{"type":42,"tag":112,"props":3324,"children":3326},{"id":3325},"screen-adaptations-the-gaming-industry-and-the-ccp",[3327],{"type":48,"value":3328},"Screen adaptations, the gaming industry and the CCP",{"type":42,"tag":51,"props":3330,"children":3331},{},[3332],{"type":48,"value":3333},"Dream of the Red Chamber is one of China's Four Great Classical Novels and is often seen as the pinacle of Chinese fiction. It was written in the mid 18th century and first published in 1791. It is a long saga that totals 960,000 characters in length, on similar scale to the length of the Three-Body Problem trilogy. Sun Wen, a Qing dynasty artist, spent 36 years of his life doing a series of 230 paintings depicting scenes from the Dream of the Red Chamber: dream sequences, demons, goddesses, nuns, nobles, beggars, raging fires, landscapes, interiors, wildlife, gardens, temples, funerals, battles, processions, banquets, trials, operas, marriages.",{"type":42,"tag":51,"props":3335,"children":3336},{},[3337],{"type":42,"tag":127,"props":3338,"children":3341},{"alt":3339,"src":3340},"Sun Wen paintings sample","/static/three-body-problem/dorc.png",[],{"type":42,"tag":51,"props":3343,"children":3344},{},[3345],{"type":48,"value":3346},"Following in this tradition of celebrating great literature, Tencent Video and China Central Television produced a 30-episode adaptation of the Three-Body Problem that was released in Feburary 2023. It is a surprisingly faithful reproduction of the book that is worth checking out. The portrayal of Shi Qiang (Da Shi) was easily my favorite part of the series. I was also impressed by how the Three-Body VR game scenes were done with computer graphics. It got me thinking about how China is represented in some of the worlds most popular video games.",{"type":42,"tag":51,"props":3348,"children":3349},{},[3350],{"type":42,"tag":127,"props":3351,"children":3354},{"alt":3352,"src":3353},"games","/static/three-body-problem/game.png",[],{"type":42,"tag":51,"props":3356,"children":3357},{},[3358],{"type":48,"value":3359},"This is Rocket League, a competitive vehicular soccer game where players, like in the Three-Body game, must master the laws of gravity. The Chinese-themed Forbiden Temple arena shown here is one of many virtual international venues in the game. Epic Games (creator of Fortnite) bought Rocket League in 2019 for an estimated $250 to $300 million.",{"type":42,"tag":51,"props":3361,"children":3362},{},[3363],{"type":48,"value":3364},"Like Rocket League, Overwatch is a highly-competitive eSport on a global scale. It features a large roster of 38 players from all over the world. Dr. Mei-Ling Zhou (å‘¨ç¾çµ) is a Chinese climatologist who uses ice both to attack opponents and to defend herself. Mei became controversial in China due to her adoption as a symbolic figure in the 2019 Hong Kong protests.",{"type":42,"tag":51,"props":3366,"children":3367},{},[3368],{"type":48,"value":3369},"Three college friends combined their interest in anime, comics and games (ACG) and literature to publish one of the most successful games created by a Chinese company and arguably one of China's most important cultural exports: Genshin Impact. miHoYo, the Shanghai-based company that develops Genshin Impact, grossed $4 billion of revenue globally in the game's first year setting a new record in the gaming industry. Like other companies of its size, miHoYo has a party committee under the Chinese Communist Party that influences the company's operations.",{"type":42,"tag":112,"props":3371,"children":3373},{"id":3372},"ai-and-layoffs-in-the-tech-industry",[3374],{"type":48,"value":3375},"AI and layoffs in the tech industry",{"type":42,"tag":51,"props":3377,"children":3378},{},[3379,3381,3388],{"type":48,"value":3380},"I have a positive attitude toward AI and its ability to supercharge the creative work we do, but I also think that replacing humans and AI-related layoffs should should be a part of the conversation. I wasn't impacted by the recent round of layoffs at my company, and I'm grateful to have the opportunity to work with a talented team on interesting problems in the health tech industry. I do have some solid references for folks in DevOps, product and backend and frontend engineering, and Iâ€™m happy to ",{"type":42,"tag":138,"props":3382,"children":3385},{"href":3383,"rel":3384},"https://www.linkedin.com/in/brian-caffey-06b22a18/",[142],[3386],{"type":48,"value":3387},"connect and share via LinkedIn",{"type":48,"value":1970},{"type":42,"tag":51,"props":3390,"children":3391},{},[3392],{"type":48,"value":3393},"Layoffs in both China and the U.S. have been pummled the tech sector over the last two years. New graduates in China are also facing a difficult job market. There are some popular expressions that paint a picture of the job market in China:",{"type":42,"tag":57,"props":3395,"children":3396},{},[3397,3402,3407,3419,3433],{"type":42,"tag":61,"props":3398,"children":3399},{},[3400],{"type":48,"value":3401},"èººå¹³ Lying flat: avoiding relentless work",{"type":42,"tag":61,"props":3403,"children":3404},{},[3405],{"type":48,"value":3406},"ä¹ä¹å…­ 996 Work culture: describes working from 9AM to 9PM, 6 days a week, a common work schedule for many Chinese employees",{"type":42,"tag":61,"props":3408,"children":3409},{},[3410,3412],{"type":48,"value":3411},"å…¨èŒå„¿å¥³ Full-time Children: ",{"type":42,"tag":138,"props":3413,"children":3416},{"href":3414,"rel":3415},"https://www.cnn.com/2023/07/26/economy/china-youth-unemployment-intl-hnk/index.html",[142],[3417],{"type":48,"value":3418},"Young Chinese are getting paid to be â€˜full-time childrenâ€™ as jobs become harder to find",{"type":42,"tag":61,"props":3420,"children":3421},{},[3422,3424,3431],{"type":48,"value":3423},"35å²è¯…å’’ The curse of 35: ",{"type":42,"tag":138,"props":3425,"children":3428},{"href":3426,"rel":3427},"https://www.marketplace.org/shows/marketplace-tech/chinas-tech-workers-ageism-the-curse-of-35/",[142],[3429],{"type":48,"value":3430},"Ageism in Chinaâ€™s tech sector has workers fearing the â€œcurse of 35â€",{"type":48,"value":3432},". Shout out to my fellow Year of the Dragon 35 year olds! ğŸ²",{"type":42,"tag":61,"props":3434,"children":3435},{},[3436,3438],{"type":48,"value":3437},"åƒè‹¦ Eat Bitterness: ",{"type":42,"tag":138,"props":3439,"children":3442},{"href":3440,"rel":3441},"https://www.nytimes.com/2023/05/30/business/china-youth-unemployment.html",[142],[3443],{"type":48,"value":3444},"Chinaâ€™s Young People Canâ€™t Find Jobs. Xi Jinping Says to â€˜Eat Bitterness.â€™",{"type":42,"tag":51,"props":3446,"children":3447},{},[3448,3450,3457],{"type":48,"value":3449},"It is an exciting time for AI. Elon Musk and Kaifu Lee have both recently released open-source large language models: Grok and Yi. Sam Altman was fired as CEO of OpenAI, then came back. Stable Diffusion just released a text to video model. AGI might already be here. In the U.S., we are going into our first presidential election cycle with AI fully turned on. Here's a ",{"type":42,"tag":138,"props":3451,"children":3454},{"href":3452,"rel":3453},"https://www.amazon.com/Three-Body-Problem-Cixin-Liu/dp/0765382032",[142],[3455],{"type":48,"value":3456},"link to The Three-Body Problem book on Amazon",{"type":48,"value":3458},". Thanks for reading and Happy Thanksgiving!",{"type":42,"tag":51,"props":3460,"children":3461},{},[3462],{"type":42,"tag":127,"props":3463,"children":3466},{"alt":3464,"src":3465},"Happy Thanksgiving","/static/three-body-problem/thanksgiving.png",[],{"type":42,"tag":3468,"props":3469,"children":3470},"style",{},[3471],{"type":48,"value":3472},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":8,"searchDepth":486,"depth":486,"links":3474},[3475,3476,3479,3480,3483,3484,3488,3489],{"id":114,"depth":486,"text":117},{"id":209,"depth":486,"text":212,"children":3477},[3478],{"id":282,"depth":499,"text":285},{"id":315,"depth":486,"text":318},{"id":376,"depth":486,"text":379,"children":3481},[3482],{"id":449,"depth":499,"text":452},{"id":1019,"depth":486,"text":1022},{"id":1069,"depth":486,"text":1072,"children":3485},[3486,3487],{"id":1080,"depth":499,"text":1083},{"id":3309,"depth":499,"text":3312},{"id":3325,"depth":486,"text":3328},{"id":3372,"depth":486,"text":3375},"markdown","content:2023:08:27:python-vue-chinese-llama-2-and-the-three-body-problem.md","content","2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem.md","2023/08/27/python-vue-chinese-llama-2-and-the-three-body-problem","md",{"_path":3497,"_dir":3498,"_draft":7,"_partial":7,"_locale":8,"title":3499,"description":3500,"date":3501,"image":3502,"tags":3503,"external":3508,"body":3528,"_type":3490,"_id":5358,"_source":3492,"_file":5359,"_stem":5360,"_extension":3495},"/2021/10/02/how-i-write-and-share-technical-software-development-articles-in-2021","02","How I write and share technical software development articles in 2021","This article describes how to write and share technical articles in 2021","2021-10-02","/static/dev-sites.png",[3504,25,3505,3506,3507],"nuxt","publishing","writing","blogging",[3509,3511,3513,3516,3519,3522,3525],{"link":3510,"site":30},"https://news.ycombinator.com/item?id=28740415",{"link":3512,"site":33},"https://www.reddit.com/r/webdev/comments/q0qc3l/how_i_write_and_share_technical_software/",{"link":3514,"site":3515},"https://dev.to/briancaffey/how-i-write-and-share-technical-software-development-articles-in-2021-27n2","dev",{"link":3517,"site":3518},"https://medium.com/@briancaffey/how-i-write-and-share-technical-software-development-articles-in-2021-8168d3871bf9","medium",{"link":3520,"site":3521},"https://briancaffey.hashnode.dev/how-i-write-and-share-technical-software-development-articles-in-2021","hashnode",{"link":3523,"site":3524},"https://briancaffey.substack.com/p/how-i-write-and-share-technical-software","substack",{"link":3526,"site":3527},"https://hackernoon.com/how-to-get-your-dev-blog-noticed-in-2021","hackernoon",{"type":39,"children":3529,"toc":5324},[3530,3535,3540,3566,3580,3594,3600,3635,3641,3646,4166,4208,4214,4219,4225,4238,4256,4262,4267,4275,4280,4288,4293,4323,4336,4344,4364,4370,4375,4383,4403,4409,4414,4419,4432,4440,4445,4452,4458,4463,4477,4629,4634,4657,4663,4684,4690,4703,4709,4714,4720,4725,4730,4735,4747,4753,4765,4770,4774,4783,4789,4811,4814,4822,4831,4858,4864,4869,4875,4911,4917,4922,4934,4939,4945,4953,4964,4969,4977,4998,5003,5011,5016,5025,5030,5038,5050,5059,5065,5078,5084,5092,5097,5103,5111,5116,5124,5129,5149,5157,5163,5176,5182,5187,5192,5197,5219,5237,5280,5298,5310,5315,5320],{"type":42,"tag":51,"props":3531,"children":3532},{},[3533],{"type":48,"value":3534},"This article describes how I write and share technical articles on my personal website and other developer websites and technical article aggregation sites.",{"type":42,"tag":51,"props":3536,"children":3537},{},[3538],{"type":48,"value":3539},"This article is broken into three sections:",{"type":42,"tag":3541,"props":3542,"children":3543},"ol",{},[3544,3556,3561],{"type":42,"tag":61,"props":3545,"children":3546},{},[3547,3549],{"type":48,"value":3548},"How I use Nuxt.js to build ",{"type":42,"tag":138,"props":3550,"children":3553},{"href":3551,"rel":3552},"https://briancaffey.github.io",[142],[3554],{"type":48,"value":3555},"my personal website",{"type":42,"tag":61,"props":3557,"children":3558},{},[3559],{"type":48,"value":3560},"How I share my articles on other development sites and article aggregators",{"type":42,"tag":61,"props":3562,"children":3563},{},[3564],{"type":48,"value":3565},"Bonus content, project plug and conclusion",{"type":42,"tag":112,"props":3567,"children":3569},{"id":3568},"building-briancaffeygithubio-with-nuxtjs",[3570,3572,3578],{"type":48,"value":3571},"Building ",{"type":42,"tag":349,"props":3573,"children":3575},{"className":3574},[],[3576],{"type":48,"value":3577},"briancaffey.github.io",{"type":48,"value":3579}," with Nuxt.js",{"type":42,"tag":51,"props":3581,"children":3582},{},[3583,3585,3592],{"type":48,"value":3584},"I first started writing my personal website on GitHub pages using a static website builder called ",{"type":42,"tag":138,"props":3586,"children":3589},{"href":3587,"rel":3588},"https://jekyllrb.com/docs/github-pages/",[142],[3590],{"type":48,"value":3591},"Jekyll",{"type":48,"value":3593},". Jekyll is a great tool for getting started with building a personal portfolio or technical blog, and it served me well for several years. I eventually changed my static site generation tool from Jekyll to Nuxt since I wanted to learn more about Vue.js. Also, I don't know Ruby very well, and it was difficult for me to use the Jekyll template language.",{"type":42,"tag":280,"props":3595,"children":3597},{"id":3596},"github-pages",[3598],{"type":48,"value":3599},"GitHub Pages",{"type":42,"tag":51,"props":3601,"children":3602},{},[3603,3605,3610,3612,3618,3620,3626,3628,3634],{"type":48,"value":3604},"I host my website on GitHub pages at the following domain: ",{"type":42,"tag":138,"props":3606,"children":3608},{"href":3551,"rel":3607},[142],[3609],{"type":48,"value":3577},{"type":48,"value":3611},". GitHub pages is a great way to host a public site. The subdomain, ",{"type":42,"tag":349,"props":3613,"children":3615},{"className":3614},[],[3616],{"type":48,"value":3617},"briancaffey",{"type":48,"value":3619}," in my case, is your GitHub username. GitHub pages will serve content from a specified branch and nested folder. My website uses the branch ",{"type":42,"tag":349,"props":3621,"children":3623},{"className":3622},[],[3624],{"type":48,"value":3625},"gh-pages",{"type":48,"value":3627}," and the root folder ",{"type":42,"tag":349,"props":3629,"children":3631},{"className":3630},[],[3632],{"type":48,"value":3633},"/",{"type":48,"value":1970},{"type":42,"tag":280,"props":3636,"children":3638},{"id":3637},"github-actions",[3639],{"type":48,"value":3640},"GitHub Actions",{"type":42,"tag":51,"props":3642,"children":3643},{},[3644],{"type":48,"value":3645},"I use GitHub actions to deploy my website to GitHub pages. Here's the file that sets up the GitHub action that builds and deploys my site:",{"type":42,"tag":401,"props":3647,"children":3651},{"code":3648,"language":3649,"meta":8,"className":3650,"style":8},"name: github pages\n\non:\n  push:\n    branches:\n      - master\n  pull_request:\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n\n      - name: Setup Node\n        uses: actions/setup-node@v2\n        with:\n          node-version: \"14\"\n\n      - name: Cache dependencies\n        uses: actions/cache@v2\n        with:\n          path: ~/.npm\n          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\n          restore-keys: |\n            ${{ runner.os }}-node-\n\n      - run: yarn\n      - run: yarn lint\n      - run: yarn generate\n\n      - name: deploy\n        uses: peaceiris/actions-gh-pages@v3\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          publish_dir: ./docs\n","yml","language-yml shiki shiki-themes github-light github-dark monokai",[3652],{"type":42,"tag":349,"props":3653,"children":3654},{"__ignoreMap":8},[3655,3674,3681,3694,3706,3718,3731,3743,3750,3762,3774,3791,3803,3824,3831,3851,3868,3880,3897,3904,3924,3940,3951,3968,3985,4002,4010,4017,4038,4058,4078,4085,4105,4121,4132,4149],{"type":42,"tag":467,"props":3656,"children":3657},{"class":469,"line":470},[3658,3664,3669],{"type":42,"tag":467,"props":3659,"children":3661},{"style":3660},"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[3662],{"type":48,"value":3663},"name",{"type":42,"tag":467,"props":3665,"children":3666},{"style":480},[3667],{"type":48,"value":3668},": ",{"type":42,"tag":467,"props":3670,"children":3671},{"style":564},[3672],{"type":48,"value":3673},"github pages\n",{"type":42,"tag":467,"props":3675,"children":3676},{"class":469,"line":486},[3677],{"type":42,"tag":467,"props":3678,"children":3679},{"emptyLinePlaceholder":37},[3680],{"type":48,"value":528},{"type":42,"tag":467,"props":3682,"children":3683},{"class":469,"line":499},[3684,3689],{"type":42,"tag":467,"props":3685,"children":3686},{"style":588},[3687],{"type":48,"value":3688},"on",{"type":42,"tag":467,"props":3690,"children":3691},{"style":480},[3692],{"type":48,"value":3693},":\n",{"type":42,"tag":467,"props":3695,"children":3696},{"class":469,"line":522},[3697,3702],{"type":42,"tag":467,"props":3698,"children":3699},{"style":3660},[3700],{"type":48,"value":3701},"  push",{"type":42,"tag":467,"props":3703,"children":3704},{"style":480},[3705],{"type":48,"value":3693},{"type":42,"tag":467,"props":3707,"children":3708},{"class":469,"line":531},[3709,3714],{"type":42,"tag":467,"props":3710,"children":3711},{"style":3660},[3712],{"type":48,"value":3713},"    branches",{"type":42,"tag":467,"props":3715,"children":3716},{"style":480},[3717],{"type":48,"value":3693},{"type":42,"tag":467,"props":3719,"children":3720},{"class":469,"line":550},[3721,3726],{"type":42,"tag":467,"props":3722,"children":3723},{"style":480},[3724],{"type":48,"value":3725},"      - ",{"type":42,"tag":467,"props":3727,"children":3728},{"style":564},[3729],{"type":48,"value":3730},"master\n",{"type":42,"tag":467,"props":3732,"children":3733},{"class":469,"line":575},[3734,3739],{"type":42,"tag":467,"props":3735,"children":3736},{"style":3660},[3737],{"type":48,"value":3738},"  pull_request",{"type":42,"tag":467,"props":3740,"children":3741},{"style":480},[3742],{"type":48,"value":3693},{"type":42,"tag":467,"props":3744,"children":3745},{"class":469,"line":598},[3746],{"type":42,"tag":467,"props":3747,"children":3748},{"emptyLinePlaceholder":37},[3749],{"type":48,"value":528},{"type":42,"tag":467,"props":3751,"children":3752},{"class":469,"line":616},[3753,3758],{"type":42,"tag":467,"props":3754,"children":3755},{"style":3660},[3756],{"type":48,"value":3757},"jobs",{"type":42,"tag":467,"props":3759,"children":3760},{"style":480},[3761],{"type":48,"value":3693},{"type":42,"tag":467,"props":3763,"children":3764},{"class":469,"line":625},[3765,3770],{"type":42,"tag":467,"props":3766,"children":3767},{"style":3660},[3768],{"type":48,"value":3769},"  deploy",{"type":42,"tag":467,"props":3771,"children":3772},{"style":480},[3773],{"type":48,"value":3693},{"type":42,"tag":467,"props":3775,"children":3776},{"class":469,"line":633},[3777,3782,3786],{"type":42,"tag":467,"props":3778,"children":3779},{"style":3660},[3780],{"type":48,"value":3781},"    runs-on",{"type":42,"tag":467,"props":3783,"children":3784},{"style":480},[3785],{"type":48,"value":3668},{"type":42,"tag":467,"props":3787,"children":3788},{"style":564},[3789],{"type":48,"value":3790},"ubuntu-latest\n",{"type":42,"tag":467,"props":3792,"children":3793},{"class":469,"line":664},[3794,3799],{"type":42,"tag":467,"props":3795,"children":3796},{"style":3660},[3797],{"type":48,"value":3798},"    steps",{"type":42,"tag":467,"props":3800,"children":3801},{"style":480},[3802],{"type":48,"value":3693},{"type":42,"tag":467,"props":3804,"children":3805},{"class":469,"line":672},[3806,3810,3815,3819],{"type":42,"tag":467,"props":3807,"children":3808},{"style":480},[3809],{"type":48,"value":3725},{"type":42,"tag":467,"props":3811,"children":3812},{"style":3660},[3813],{"type":48,"value":3814},"uses",{"type":42,"tag":467,"props":3816,"children":3817},{"style":480},[3818],{"type":48,"value":3668},{"type":42,"tag":467,"props":3820,"children":3821},{"style":564},[3822],{"type":48,"value":3823},"actions/checkout@v2\n",{"type":42,"tag":467,"props":3825,"children":3826},{"class":469,"line":690},[3827],{"type":42,"tag":467,"props":3828,"children":3829},{"emptyLinePlaceholder":37},[3830],{"type":48,"value":528},{"type":42,"tag":467,"props":3832,"children":3833},{"class":469,"line":1336},[3834,3838,3842,3846],{"type":42,"tag":467,"props":3835,"children":3836},{"style":480},[3837],{"type":48,"value":3725},{"type":42,"tag":467,"props":3839,"children":3840},{"style":3660},[3841],{"type":48,"value":3663},{"type":42,"tag":467,"props":3843,"children":3844},{"style":480},[3845],{"type":48,"value":3668},{"type":42,"tag":467,"props":3847,"children":3848},{"style":564},[3849],{"type":48,"value":3850},"Setup Node\n",{"type":42,"tag":467,"props":3852,"children":3853},{"class":469,"line":1344},[3854,3859,3863],{"type":42,"tag":467,"props":3855,"children":3856},{"style":3660},[3857],{"type":48,"value":3858},"        uses",{"type":42,"tag":467,"props":3860,"children":3861},{"style":480},[3862],{"type":48,"value":3668},{"type":42,"tag":467,"props":3864,"children":3865},{"style":564},[3866],{"type":48,"value":3867},"actions/setup-node@v2\n",{"type":42,"tag":467,"props":3869,"children":3870},{"class":469,"line":1362},[3871,3876],{"type":42,"tag":467,"props":3872,"children":3873},{"style":3660},[3874],{"type":48,"value":3875},"        with",{"type":42,"tag":467,"props":3877,"children":3878},{"style":480},[3879],{"type":48,"value":3693},{"type":42,"tag":467,"props":3881,"children":3882},{"class":469,"line":1380},[3883,3888,3892],{"type":42,"tag":467,"props":3884,"children":3885},{"style":3660},[3886],{"type":48,"value":3887},"          node-version",{"type":42,"tag":467,"props":3889,"children":3890},{"style":480},[3891],{"type":48,"value":3668},{"type":42,"tag":467,"props":3893,"children":3894},{"style":564},[3895],{"type":48,"value":3896},"\"14\"\n",{"type":42,"tag":467,"props":3898,"children":3899},{"class":469,"line":1388},[3900],{"type":42,"tag":467,"props":3901,"children":3902},{"emptyLinePlaceholder":37},[3903],{"type":48,"value":528},{"type":42,"tag":467,"props":3905,"children":3906},{"class":469,"line":1423},[3907,3911,3915,3919],{"type":42,"tag":467,"props":3908,"children":3909},{"style":480},[3910],{"type":48,"value":3725},{"type":42,"tag":467,"props":3912,"children":3913},{"style":3660},[3914],{"type":48,"value":3663},{"type":42,"tag":467,"props":3916,"children":3917},{"style":480},[3918],{"type":48,"value":3668},{"type":42,"tag":467,"props":3920,"children":3921},{"style":564},[3922],{"type":48,"value":3923},"Cache dependencies\n",{"type":42,"tag":467,"props":3925,"children":3926},{"class":469,"line":1441},[3927,3931,3935],{"type":42,"tag":467,"props":3928,"children":3929},{"style":3660},[3930],{"type":48,"value":3858},{"type":42,"tag":467,"props":3932,"children":3933},{"style":480},[3934],{"type":48,"value":3668},{"type":42,"tag":467,"props":3936,"children":3937},{"style":564},[3938],{"type":48,"value":3939},"actions/cache@v2\n",{"type":42,"tag":467,"props":3941,"children":3942},{"class":469,"line":1449},[3943,3947],{"type":42,"tag":467,"props":3944,"children":3945},{"style":3660},[3946],{"type":48,"value":3875},{"type":42,"tag":467,"props":3948,"children":3949},{"style":480},[3950],{"type":48,"value":3693},{"type":42,"tag":467,"props":3952,"children":3953},{"class":469,"line":1458},[3954,3959,3963],{"type":42,"tag":467,"props":3955,"children":3956},{"style":3660},[3957],{"type":48,"value":3958},"          path",{"type":42,"tag":467,"props":3960,"children":3961},{"style":480},[3962],{"type":48,"value":3668},{"type":42,"tag":467,"props":3964,"children":3965},{"style":564},[3966],{"type":48,"value":3967},"~/.npm\n",{"type":42,"tag":467,"props":3969,"children":3970},{"class":469,"line":1476},[3971,3976,3980],{"type":42,"tag":467,"props":3972,"children":3973},{"style":3660},[3974],{"type":48,"value":3975},"          key",{"type":42,"tag":467,"props":3977,"children":3978},{"style":480},[3979],{"type":48,"value":3668},{"type":42,"tag":467,"props":3981,"children":3982},{"style":564},[3983],{"type":48,"value":3984},"${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\n",{"type":42,"tag":467,"props":3986,"children":3987},{"class":469,"line":1511},[3988,3993,3997],{"type":42,"tag":467,"props":3989,"children":3990},{"style":3660},[3991],{"type":48,"value":3992},"          restore-keys",{"type":42,"tag":467,"props":3994,"children":3995},{"style":480},[3996],{"type":48,"value":3668},{"type":42,"tag":467,"props":3998,"children":3999},{"style":474},[4000],{"type":48,"value":4001},"|\n",{"type":42,"tag":467,"props":4003,"children":4004},{"class":469,"line":1519},[4005],{"type":42,"tag":467,"props":4006,"children":4007},{"style":564},[4008],{"type":48,"value":4009},"            ${{ runner.os }}-node-\n",{"type":42,"tag":467,"props":4011,"children":4012},{"class":469,"line":1528},[4013],{"type":42,"tag":467,"props":4014,"children":4015},{"emptyLinePlaceholder":37},[4016],{"type":48,"value":528},{"type":42,"tag":467,"props":4018,"children":4019},{"class":469,"line":1575},[4020,4024,4029,4033],{"type":42,"tag":467,"props":4021,"children":4022},{"style":480},[4023],{"type":48,"value":3725},{"type":42,"tag":467,"props":4025,"children":4026},{"style":3660},[4027],{"type":48,"value":4028},"run",{"type":42,"tag":467,"props":4030,"children":4031},{"style":480},[4032],{"type":48,"value":3668},{"type":42,"tag":467,"props":4034,"children":4035},{"style":564},[4036],{"type":48,"value":4037},"yarn\n",{"type":42,"tag":467,"props":4039,"children":4040},{"class":469,"line":1624},[4041,4045,4049,4053],{"type":42,"tag":467,"props":4042,"children":4043},{"style":480},[4044],{"type":48,"value":3725},{"type":42,"tag":467,"props":4046,"children":4047},{"style":3660},[4048],{"type":48,"value":4028},{"type":42,"tag":467,"props":4050,"children":4051},{"style":480},[4052],{"type":48,"value":3668},{"type":42,"tag":467,"props":4054,"children":4055},{"style":564},[4056],{"type":48,"value":4057},"yarn lint\n",{"type":42,"tag":467,"props":4059,"children":4060},{"class":469,"line":1632},[4061,4065,4069,4073],{"type":42,"tag":467,"props":4062,"children":4063},{"style":480},[4064],{"type":48,"value":3725},{"type":42,"tag":467,"props":4066,"children":4067},{"style":3660},[4068],{"type":48,"value":4028},{"type":42,"tag":467,"props":4070,"children":4071},{"style":480},[4072],{"type":48,"value":3668},{"type":42,"tag":467,"props":4074,"children":4075},{"style":564},[4076],{"type":48,"value":4077},"yarn generate\n",{"type":42,"tag":467,"props":4079,"children":4080},{"class":469,"line":1641},[4081],{"type":42,"tag":467,"props":4082,"children":4083},{"emptyLinePlaceholder":37},[4084],{"type":48,"value":528},{"type":42,"tag":467,"props":4086,"children":4087},{"class":469,"line":1659},[4088,4092,4096,4100],{"type":42,"tag":467,"props":4089,"children":4090},{"style":480},[4091],{"type":48,"value":3725},{"type":42,"tag":467,"props":4093,"children":4094},{"style":3660},[4095],{"type":48,"value":3663},{"type":42,"tag":467,"props":4097,"children":4098},{"style":480},[4099],{"type":48,"value":3668},{"type":42,"tag":467,"props":4101,"children":4102},{"style":564},[4103],{"type":48,"value":4104},"deploy\n",{"type":42,"tag":467,"props":4106,"children":4107},{"class":469,"line":1687},[4108,4112,4116],{"type":42,"tag":467,"props":4109,"children":4110},{"style":3660},[4111],{"type":48,"value":3858},{"type":42,"tag":467,"props":4113,"children":4114},{"style":480},[4115],{"type":48,"value":3668},{"type":42,"tag":467,"props":4117,"children":4118},{"style":564},[4119],{"type":48,"value":4120},"peaceiris/actions-gh-pages@v3\n",{"type":42,"tag":467,"props":4122,"children":4123},{"class":469,"line":1695},[4124,4128],{"type":42,"tag":467,"props":4125,"children":4126},{"style":3660},[4127],{"type":48,"value":3875},{"type":42,"tag":467,"props":4129,"children":4130},{"style":480},[4131],{"type":48,"value":3693},{"type":42,"tag":467,"props":4133,"children":4134},{"class":469,"line":1704},[4135,4140,4144],{"type":42,"tag":467,"props":4136,"children":4137},{"style":3660},[4138],{"type":48,"value":4139},"          github_token",{"type":42,"tag":467,"props":4141,"children":4142},{"style":480},[4143],{"type":48,"value":3668},{"type":42,"tag":467,"props":4145,"children":4146},{"style":564},[4147],{"type":48,"value":4148},"${{ secrets.GITHUB_TOKEN }}\n",{"type":42,"tag":467,"props":4150,"children":4151},{"class":469,"line":1763},[4152,4157,4161],{"type":42,"tag":467,"props":4153,"children":4154},{"style":3660},[4155],{"type":48,"value":4156},"          publish_dir",{"type":42,"tag":467,"props":4158,"children":4159},{"style":480},[4160],{"type":48,"value":3668},{"type":42,"tag":467,"props":4162,"children":4163},{"style":564},[4164],{"type":48,"value":4165},"./docs\n",{"type":42,"tag":51,"props":4167,"children":4168},{},[4169,4171,4177,4179,4185,4187,4193,4195,4200,4202,4207],{"type":48,"value":4170},"When changes are pushed to the ",{"type":42,"tag":349,"props":4172,"children":4174},{"className":4173},[],[4175],{"type":48,"value":4176},"master",{"type":48,"value":4178}," branch, this GitHub Action runs. It lints the code, builds the site with ",{"type":42,"tag":349,"props":4180,"children":4182},{"className":4181},[],[4183],{"type":48,"value":4184},"yarn generate",{"type":48,"value":4186}," and then the ",{"type":42,"tag":349,"props":4188,"children":4190},{"className":4189},[],[4191],{"type":48,"value":4192},"peaceiris/actions-gh-pages@v3",{"type":48,"value":4194}," GitHub Action commits only the build artifacts to the ",{"type":42,"tag":349,"props":4196,"children":4198},{"className":4197},[],[4199],{"type":48,"value":3625},{"type":48,"value":4201}," branch where the content is served on ",{"type":42,"tag":349,"props":4203,"children":4205},{"className":4204},[],[4206],{"type":48,"value":3577},{"type":48,"value":1970},{"type":42,"tag":280,"props":4209,"children":4211},{"id":4210},"nuxtjs-framework",[4212],{"type":48,"value":4213},"Nuxt.js Framework",{"type":42,"tag":51,"props":4215,"children":4216},{},[4217],{"type":48,"value":4218},"Nuxt.js is a versatile Vue.js framework. It can be used to build several different types of websites, including Server Side Rendered (SSR) websites, single page applications (SPA) and static websites. I use the static website mode, also called Server Side Generation (SSG).",{"type":42,"tag":280,"props":4220,"children":4222},{"id":4221},"content-api",[4223],{"type":48,"value":4224},"Content API",{"type":42,"tag":51,"props":4226,"children":4227},{},[4228,4230,4236],{"type":48,"value":4229},"Nuxt has a module called ",{"type":42,"tag":138,"props":4231,"children":4234},{"href":4232,"rel":4233},"https://nuxtjs.org/api/content-api",[142],[4235],{"type":48,"value":4224},{"type":48,"value":4237}," that allows you to do the following:",{"type":42,"tag":57,"props":4239,"children":4240},{},[4241,4246,4251],{"type":42,"tag":61,"props":4242,"children":4243},{},[4244],{"type":48,"value":4245},"write articles in Markdown",{"type":42,"tag":61,"props":4247,"children":4248},{},[4249],{"type":48,"value":4250},"Use Vue components in Markdown",{"type":42,"tag":61,"props":4252,"children":4253},{},[4254],{"type":48,"value":4255},"write custom front-matter that can be used to query Markdown articles using an API",{"type":42,"tag":280,"props":4257,"children":4259},{"id":4258},"articles-and-folder-structure",[4260],{"type":48,"value":4261},"Articles and Folder Structure",{"type":42,"tag":51,"props":4263,"children":4264},{},[4265],{"type":48,"value":4266},"Nuxt uses a folder structure that automatically generates routes and helps you organize components, pages and layouts. Here is the folder structure for my personal website's repository:",{"type":42,"tag":401,"props":4268,"children":4270},{"code":4269},"$ tree -L 1 .\n.\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ assets  \u003C-- compiled assets\nâ”œâ”€â”€ components \u003C-- Vue components used in the site\nâ”œâ”€â”€ content  \u003C-- contains Markdown files for articles\nâ”œâ”€â”€ i18n  \u003C-- contains translations\nâ”œâ”€â”€ jsconfig.json\nâ”œâ”€â”€ layouts  \u003C-- layouts used for each page\nâ”œâ”€â”€ middleware  \u003C-- I'm not using this folder\nâ”œâ”€â”€ node_modules\nâ”œâ”€â”€ nuxt.config.js  \u003C-- config file\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ pages  \u003C-- directory structure defines URLs for site pages\nâ”œâ”€â”€ plugins  \u003C-- plugins\nâ”œâ”€â”€ static  \u003C-- files in this folder are served as-is\nâ”œâ”€â”€ store  \u003C-- Vuex store\nâ”œâ”€â”€ tailwind.config.js\nâ””â”€â”€ yarn.lock\n",[4271],{"type":42,"tag":349,"props":4272,"children":4273},{"__ignoreMap":8},[4274],{"type":48,"value":4269},{"type":42,"tag":51,"props":4276,"children":4277},{},[4278],{"type":48,"value":4279},"The content folder has the following structure:",{"type":42,"tag":401,"props":4281,"children":4283},{"code":4282},"$ tree -L 3 content\ncontent/\nâ”œâ”€â”€ 2016\nâ”‚   â””â”€â”€ 04\nâ”‚       â””â”€â”€ 07\nâ”‚           â””â”€â”€ my-article.md\nâ”œâ”€â”€ 2017\nâ”‚   â””â”€â”€ 01\nâ”‚      â””â”€â”€ 01\nâ”‚           â””â”€â”€ my-other-article.md\n...\nâ””â”€â”€ projects\nâ”‚   â””â”€â”€ my-project.md\n",[4284],{"type":42,"tag":349,"props":4285,"children":4286},{"__ignoreMap":8},[4287],{"type":48,"value":4282},{"type":42,"tag":51,"props":4289,"children":4290},{},[4291],{"type":48,"value":4292},"This will produce the following routes:",{"type":42,"tag":57,"props":4294,"children":4295},{},[4296,4305,4314],{"type":42,"tag":61,"props":4297,"children":4298},{},[4299],{"type":42,"tag":349,"props":4300,"children":4302},{"className":4301},[],[4303],{"type":48,"value":4304},"/2016/04/07/my-article.html",{"type":42,"tag":61,"props":4306,"children":4307},{},[4308],{"type":42,"tag":349,"props":4309,"children":4311},{"className":4310},[],[4312],{"type":48,"value":4313},"/2017/01/01/my-other-article.html",{"type":42,"tag":61,"props":4315,"children":4316},{},[4317],{"type":42,"tag":349,"props":4318,"children":4320},{"className":4319},[],[4321],{"type":48,"value":4322},"/projects/my-project.html",{"type":42,"tag":51,"props":4324,"children":4325},{},[4326,4328,4334],{"type":48,"value":4327},"Here's the folder structure for the ",{"type":42,"tag":349,"props":4329,"children":4331},{"className":4330},[],[4332],{"type":48,"value":4333},"pages",{"type":48,"value":4335}," directory:",{"type":42,"tag":401,"props":4337,"children":4339},{"code":4338},"$ tree -L 4 pages\npages\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ _year\nâ”‚   â””â”€â”€ _month\nâ”‚       â””â”€â”€ _day\nâ”‚           â””â”€â”€ _slug.vue\nâ”œâ”€â”€ blog\nâ”‚   â”œâ”€â”€ index.vue\nâ”‚   â””â”€â”€ tags\nâ”‚       â”œâ”€â”€ _tag.vue\nâ”‚       â””â”€â”€ index.vue\nâ”œâ”€â”€ confirm-subscription.vue\nâ”œâ”€â”€ contact\nâ”‚   â””â”€â”€ index.vue\nâ”œâ”€â”€ drafts\nâ”‚   â””â”€â”€ index.vue\nâ”œâ”€â”€ index.vue\nâ”œâ”€â”€ projects\nâ”‚   â”œâ”€â”€ _slug.vue\nâ”‚   â””â”€â”€ index.vue\nâ””â”€â”€ thank-you.vue\n",[4340],{"type":42,"tag":349,"props":4341,"children":4342},{"__ignoreMap":8},[4343],{"type":48,"value":4338},{"type":42,"tag":51,"props":4345,"children":4346},{},[4347,4349,4354,4356,4362],{"type":48,"value":4348},"Directories in the ",{"type":42,"tag":349,"props":4350,"children":4352},{"className":4351},[],[4353],{"type":48,"value":4333},{"type":48,"value":4355}," directory starting with an underscore (like ",{"type":42,"tag":349,"props":4357,"children":4359},{"className":4358},[],[4360],{"type":48,"value":4361},"_year",{"type":48,"value":4363},") can be used as URL parameters.",{"type":42,"tag":280,"props":4365,"children":4367},{"id":4366},"markdown-and-vue-components",[4368],{"type":48,"value":4369},"Markdown and Vue Components",{"type":42,"tag":51,"props":4371,"children":4372},{},[4373],{"type":48,"value":4374},"One nice feature of Nuxt and the Nuxt Content module is the ability to use Vue components directly in Markdown files. Here's an example of a Vue component in a Markdown file:",{"type":42,"tag":401,"props":4376,"children":4378},{"code":4377},"# Markdown with Vue components\n\nThis is some content\n\n\u003Cmy-component />\n\nThis is more content.\n",[4379],{"type":42,"tag":349,"props":4380,"children":4381},{"__ignoreMap":8},[4382],{"type":48,"value":4377},{"type":42,"tag":51,"props":4384,"children":4385},{},[4386,4388,4394,4396,4402],{"type":48,"value":4387},"Vue components used in Markdown files must be included in the ",{"type":42,"tag":349,"props":4389,"children":4391},{"className":4390},[],[4392],{"type":48,"value":4393},"components/global",{"type":48,"value":4395}," directory. Here's an article on my blog where I used Vue components to show interactive graphs: ",{"type":42,"tag":138,"props":4397,"children":4400},{"href":4398,"rel":4399},"https://briancaffey.github.io/2021/01/16/i-scraped-analyzed-and-generated-yc-companies-founders-and-work-at-a-startup-job-postings",[142],[4401],{"type":48,"value":4398},{"type":48,"value":1970},{"type":42,"tag":280,"props":4404,"children":4406},{"id":4405},"images",[4407],{"type":48,"value":4408},"Images",{"type":42,"tag":51,"props":4410,"children":4411},{},[4412],{"type":48,"value":4413},"Images are an important part of the articles that I write. Each article has an optional cover image. I try to include a cover image for each of the articles I write. I mostly use Gimp to create the cover images.",{"type":42,"tag":51,"props":4415,"children":4416},{},[4417],{"type":48,"value":4418},"The cover image for this article was made with Inkscape. I have also used Gimp and Blender to generate images for my blog.",{"type":42,"tag":51,"props":4420,"children":4421},{},[4422,4424,4430],{"type":48,"value":4423},"Including images in the body of an article is pretty simple on my personal site. First I need to add the image to the ",{"type":42,"tag":349,"props":4425,"children":4427},{"className":4426},[],[4428],{"type":48,"value":4429},"static",{"type":48,"value":4431}," directory, and then I can reference that image using the following syntax:",{"type":42,"tag":401,"props":4433,"children":4435},{"code":4434},"![alt text](/static/path/to/my-image.png)\n",[4436],{"type":42,"tag":349,"props":4437,"children":4438},{"__ignoreMap":8},[4439],{"type":48,"value":4434},{"type":42,"tag":51,"props":4441,"children":4442},{},[4443],{"type":48,"value":4444},"Here's the image for this article:",{"type":42,"tag":51,"props":4446,"children":4447},{},[4448],{"type":42,"tag":127,"props":4449,"children":4451},{"alt":4450,"src":3502},"Writing and publishing dev articles",[],{"type":42,"tag":280,"props":4453,"children":4455},{"id":4454},"markdown-front-matter",[4456],{"type":48,"value":4457},"Markdown front-matter",{"type":42,"tag":51,"props":4459,"children":4460},{},[4461],{"type":48,"value":4462},"Front-matter is a way to define metadata for a Markdown file. It is used to define the title, description, and other metadata that can be used to query articles.",{"type":42,"tag":51,"props":4464,"children":4465},{},[4466,4468,4475],{"type":48,"value":4467},"Here's whe front-matter for this article on my personal site ",{"type":42,"tag":138,"props":4469,"children":4472},{"href":4470,"rel":4471},"https://briancaffey.github.io/2021/10/02/sharing-a-dev-article-everywhere",[142],[4473],{"type":48,"value":4474},"briancaffey.github.io/2021/10/02/sharing-a-dev-article-everywhere",{"type":48,"value":4476},":",{"type":42,"tag":401,"props":4478,"children":4480},{"code":4479,"language":3649,"meta":8,"className":3650,"style":8},"---\ntitle: How I write and share technical development articles in 2021\ndate: '2021-10-02'\ndescription: This article describes how to write and share technical articles in 2021\ntags:\n  - nuxt\n  - vue\n  - publishing\n  - writing\ndraft: true\n---\n",[4481],{"type":42,"tag":349,"props":4482,"children":4483},{"__ignoreMap":8},[4484,4493,4510,4527,4544,4556,4569,4581,4593,4605,4622],{"type":42,"tag":467,"props":4485,"children":4486},{"class":469,"line":470},[4487],{"type":42,"tag":467,"props":4488,"children":4490},{"style":4489},"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[4491],{"type":48,"value":4492},"---\n",{"type":42,"tag":467,"props":4494,"children":4495},{"class":469,"line":486},[4496,4501,4505],{"type":42,"tag":467,"props":4497,"children":4498},{"style":3660},[4499],{"type":48,"value":4500},"title",{"type":42,"tag":467,"props":4502,"children":4503},{"style":480},[4504],{"type":48,"value":3668},{"type":42,"tag":467,"props":4506,"children":4507},{"style":564},[4508],{"type":48,"value":4509},"How I write and share technical development articles in 2021\n",{"type":42,"tag":467,"props":4511,"children":4512},{"class":469,"line":499},[4513,4518,4522],{"type":42,"tag":467,"props":4514,"children":4515},{"style":3660},[4516],{"type":48,"value":4517},"date",{"type":42,"tag":467,"props":4519,"children":4520},{"style":480},[4521],{"type":48,"value":3668},{"type":42,"tag":467,"props":4523,"children":4524},{"style":564},[4525],{"type":48,"value":4526},"'2021-10-02'\n",{"type":42,"tag":467,"props":4528,"children":4529},{"class":469,"line":522},[4530,4535,4539],{"type":42,"tag":467,"props":4531,"children":4532},{"style":3660},[4533],{"type":48,"value":4534},"description",{"type":42,"tag":467,"props":4536,"children":4537},{"style":480},[4538],{"type":48,"value":3668},{"type":42,"tag":467,"props":4540,"children":4541},{"style":564},[4542],{"type":48,"value":4543},"This article describes how to write and share technical articles in 2021\n",{"type":42,"tag":467,"props":4545,"children":4546},{"class":469,"line":531},[4547,4552],{"type":42,"tag":467,"props":4548,"children":4549},{"style":3660},[4550],{"type":48,"value":4551},"tags",{"type":42,"tag":467,"props":4553,"children":4554},{"style":480},[4555],{"type":48,"value":3693},{"type":42,"tag":467,"props":4557,"children":4558},{"class":469,"line":550},[4559,4564],{"type":42,"tag":467,"props":4560,"children":4561},{"style":480},[4562],{"type":48,"value":4563},"  - ",{"type":42,"tag":467,"props":4565,"children":4566},{"style":564},[4567],{"type":48,"value":4568},"nuxt\n",{"type":42,"tag":467,"props":4570,"children":4571},{"class":469,"line":575},[4572,4576],{"type":42,"tag":467,"props":4573,"children":4574},{"style":480},[4575],{"type":48,"value":4563},{"type":42,"tag":467,"props":4577,"children":4578},{"style":564},[4579],{"type":48,"value":4580},"vue\n",{"type":42,"tag":467,"props":4582,"children":4583},{"class":469,"line":598},[4584,4588],{"type":42,"tag":467,"props":4585,"children":4586},{"style":480},[4587],{"type":48,"value":4563},{"type":42,"tag":467,"props":4589,"children":4590},{"style":564},[4591],{"type":48,"value":4592},"publishing\n",{"type":42,"tag":467,"props":4594,"children":4595},{"class":469,"line":616},[4596,4600],{"type":42,"tag":467,"props":4597,"children":4598},{"style":480},[4599],{"type":48,"value":4563},{"type":42,"tag":467,"props":4601,"children":4602},{"style":564},[4603],{"type":48,"value":4604},"writing\n",{"type":42,"tag":467,"props":4606,"children":4607},{"class":469,"line":625},[4608,4613,4617],{"type":42,"tag":467,"props":4609,"children":4610},{"style":3660},[4611],{"type":48,"value":4612},"draft",{"type":42,"tag":467,"props":4614,"children":4615},{"style":480},[4616],{"type":48,"value":3668},{"type":42,"tag":467,"props":4618,"children":4619},{"style":588},[4620],{"type":48,"value":4621},"true\n",{"type":42,"tag":467,"props":4623,"children":4624},{"class":469,"line":633},[4625],{"type":42,"tag":467,"props":4626,"children":4627},{"style":4489},[4628],{"type":48,"value":4492},{"type":42,"tag":51,"props":4630,"children":4631},{},[4632],{"type":48,"value":4633},"I also use front-matter for the following:",{"type":42,"tag":57,"props":4635,"children":4636},{},[4637,4642,4647,4652],{"type":42,"tag":61,"props":4638,"children":4639},{},[4640],{"type":48,"value":4641},"OpenGraph meta tags & social sharing",{"type":42,"tag":61,"props":4643,"children":4644},{},[4645],{"type":48,"value":4646},"links to other outlets",{"type":42,"tag":61,"props":4648,"children":4649},{},[4650],{"type":48,"value":4651},"meta tags",{"type":42,"tag":61,"props":4653,"children":4654},{},[4655],{"type":48,"value":4656},"article tags",{"type":42,"tag":280,"props":4658,"children":4660},{"id":4659},"nuxt-sitemap",[4661],{"type":48,"value":4662},"Nuxt Sitemap",{"type":42,"tag":51,"props":4664,"children":4665},{},[4666,4668,4674,4676,4682],{"type":48,"value":4667},"Using the ",{"type":42,"tag":349,"props":4669,"children":4671},{"className":4670},[],[4672],{"type":48,"value":4673},"@nuxt/sitemap",{"type":48,"value":4675}," module, it is easy to generate a sitemap.xml file. This generates a static file that is available on ",{"type":42,"tag":349,"props":4677,"children":4679},{"className":4678},[],[4680],{"type":48,"value":4681},"/sitemap.xml",{"type":48,"value":4683},". This file is used in the Google Search Console to tell Google which pages on my site should be indexed. This helps with SEO.",{"type":42,"tag":280,"props":4685,"children":4687},{"id":4686},"rss-feed",[4688],{"type":48,"value":4689},"RSS Feed",{"type":42,"tag":51,"props":4691,"children":4692},{},[4693,4695,4701],{"type":48,"value":4694},"An RSS feed is configured using another official Nuxt module called ",{"type":42,"tag":349,"props":4696,"children":4698},{"className":4697},[],[4699],{"type":48,"value":4700},"@nuxtjs/feed",{"type":48,"value":4702},". This plugin generates an RSS feed for the site in XML. An RSS feed can be used to automatically publish articles to other sites, I'll show this in the next section of this article.",{"type":42,"tag":280,"props":4704,"children":4706},{"id":4705},"google-analytics",[4707],{"type":48,"value":4708},"Google Analytics",{"type":42,"tag":51,"props":4710,"children":4711},{},[4712],{"type":48,"value":4713},"Google Analytics is used to track site traffic and gives insights into what content is popular, where my users are visiting from, how long they spend browsing my site and other helpful metrics. It is likely that many readers of my site may have disabled Google Analytics in their browsers.",{"type":42,"tag":280,"props":4715,"children":4717},{"id":4716},"google-search-console",[4718],{"type":48,"value":4719},"Google Search Console",{"type":42,"tag":51,"props":4721,"children":4722},{},[4723],{"type":48,"value":4724},"Google Search Console is another tool that is helpful from an SEO perspective.",{"type":42,"tag":51,"props":4726,"children":4727},{},[4728],{"type":48,"value":4729},"Here is a report from Google Data Studio showing some some of the metrics that I use to analyze my site's traffic:",{"type":42,"tag":3468,"props":4731,"children":4732},{},[4733],{"type":48,"value":4734},"\n  .google-data-studio {\nposition: relative;\npadding-bottom: 56.25%;\npadding-top: 30px; height: 0; overflow: hidden;\n}\n\n.google-data-studio iframe,\n.google-data-studio object,\n.google-data-studio embed {\nposition: absolute;\ntop: 0;\nleft: 0;\nwidth: 100%;\nheight: 100%;\n}\n",{"type":42,"tag":301,"props":4736,"children":4739},{"className":4737},[4738],"google-data-studio",[4740],{"type":42,"tag":193,"props":4741,"children":4746},{"width":4742,"height":4743,"src":4744,"frameBorder":199,"style":4745,"allowFullScreen":37},600,450,"https://datastudio.google.com/embed/reporting/1da052a4-6d61-4dac-b85d-5e9efed870af/page/6zXD","border:0",[],{"type":42,"tag":280,"props":4748,"children":4750},{"id":4749},"mailchimp",[4751],{"type":48,"value":4752},"MailChimp",{"type":42,"tag":51,"props":4754,"children":4755},{},[4756,4758,4764],{"type":48,"value":4757},"I use MailChimp to build a newsletter audience. I'll be sending out a newsletter to my current audience with an update about this article. I wrote an article about how to set up MailChimp on Nuxt. I wrote an article on my blog about how I set up a form for guests to sign up for a newsletter using a MailChimp form: ",{"type":42,"tag":138,"props":4759,"children":4762},{"href":4760,"rel":4761},"https://briancaffey.github.io/zh/2020/10/10/how-to-add-email-signup-form-to-nuxt-site-with-mailchimp.html",[142],[4763],{"type":48,"value":4760},{"type":48,"value":1970},{"type":42,"tag":51,"props":4766,"children":4767},{},[4768],{"type":48,"value":4769},"Here's what the form looks like:",{"type":42,"tag":4771,"props":4772,"children":4773},"br",{},[],{"type":42,"tag":1037,"props":4775,"children":4776},{},[4777,4779],{"type":48,"value":4778},"\n  ",{"type":42,"tag":4780,"props":4781,"children":4782},"newsletter",{},[],{"type":42,"tag":280,"props":4784,"children":4786},{"id":4785},"formsubmitco",[4787],{"type":48,"value":4788},"formsubmit.co",{"type":42,"tag":51,"props":4790,"children":4791},{},[4792,4794,4800,4802,4809],{"type":48,"value":4793},"Site visitors can send me messages through an online form called ",{"type":42,"tag":138,"props":4795,"children":4798},{"href":4796,"rel":4797},"https://formsubmit.co",[142],[4799],{"type":48,"value":4788},{"type":48,"value":4801},". I include this form on my site's ",{"type":42,"tag":138,"props":4803,"children":4806},{"href":4804,"rel":4805},"https://briancaffey.github.io/contact",[142],[4807],{"type":48,"value":4808},"Contact",{"type":48,"value":4810}," page.",{"type":42,"tag":4771,"props":4812,"children":4813},{},[],{"type":42,"tag":1037,"props":4815,"children":4816},{},[4817,4818],{"type":48,"value":4778},{"type":42,"tag":4819,"props":4820,"children":4821},"contact-form",{},[],{"type":42,"tag":51,"props":4823,"children":4824},{},[4825,4828],{"type":42,"tag":4771,"props":4826,"children":4827},{},[],{"type":42,"tag":4771,"props":4829,"children":4830},{},[],{"type":42,"tag":51,"props":4832,"children":4833},{},[4834,4836,4842,4843,4849,4851,4856],{"type":48,"value":4835},"This two forms are examples of using Vue components in Markdown files that I mentioned earlier. Both the ",{"type":42,"tag":349,"props":4837,"children":4839},{"className":4838},[],[4840],{"type":48,"value":4841},"Nesletter",{"type":48,"value":2751},{"type":42,"tag":349,"props":4844,"children":4846},{"className":4845},[],[4847],{"type":48,"value":4848},"ContactForm",{"type":48,"value":4850}," components must be in the ",{"type":42,"tag":349,"props":4852,"children":4854},{"className":4853},[],[4855],{"type":48,"value":4393},{"type":48,"value":4857}," directory.",{"type":42,"tag":280,"props":4859,"children":4861},{"id":4860},"drift",[4862],{"type":48,"value":4863},"Drift",{"type":42,"tag":51,"props":4865,"children":4866},{},[4867],{"type":48,"value":4868},"Drift is a freemium service that allows site visitors to send me messages in real time. It's a great way to get in touch with site visitors, and it can be configured so that messages go to the Drift mobile app.",{"type":42,"tag":280,"props":4870,"children":4872},{"id":4871},"drafts",[4873],{"type":48,"value":4874},"Drafts",{"type":42,"tag":51,"props":4876,"children":4877},{},[4878,4880,4885,4887,4893,4895,4901,4903,4909],{"type":48,"value":4879},"One option in the front-matter for my blog articles is ",{"type":42,"tag":349,"props":4881,"children":4883},{"className":4882},[],[4884],{"type":48,"value":4612},{"type":48,"value":4886},". If an article has ",{"type":42,"tag":349,"props":4888,"children":4890},{"className":4889},[],[4891],{"type":48,"value":4892},"draft: true",{"type":48,"value":4894}," set in the front-matter, then the article will not be listed on the main list of blog articles on my site, and the page will not be indexed by Google. Here's where you can find the draft articles for my site: ",{"type":42,"tag":138,"props":4896,"children":4899},{"href":4897,"rel":4898},"https://briancaffey.github.io/drafts",[142],[4900],{"type":48,"value":4897},{"type":48,"value":4902},". The articles here can be accessed publicly, but I only show them on the ",{"type":42,"tag":349,"props":4904,"children":4906},{"className":4905},[],[4907],{"type":48,"value":4908},"/drafts",{"type":48,"value":4910}," page which is not listed anywhere else on my site.",{"type":42,"tag":112,"props":4912,"children":4914},{"id":4913},"publishing-on-other-outlets",[4915],{"type":48,"value":4916},"Publishing on other outlets",{"type":42,"tag":51,"props":4918,"children":4919},{},[4920],{"type":48,"value":4921},"When publishing articles from my personal website on other sites, I make sure that custom content is either removed or replaced with a link or static image that I can upload to the other site while editing the article.",{"type":42,"tag":51,"props":4923,"children":4924},{},[4925,4927,4932],{"type":48,"value":4926},"For example, this article includes an embedded Google Data Studio report in the version that is published on ",{"type":42,"tag":349,"props":4928,"children":4930},{"className":4929},[],[4931],{"type":48,"value":3577},{"type":48,"value":4933},". This embedded iframe will not work when posted to other platforms, so I can instead link to an anchor tag that corresponds to the location of the custom element on my site.",{"type":42,"tag":51,"props":4935,"children":4936},{},[4937],{"type":48,"value":4938},"For this article, I have mostly tried to keep the custom content to a minimum so that it will be easy to cross publish on other sites without having to make lots of edits to the markdown. Most of the tweaking will likely have to do with preview images and other custom front-matter properties that some site (like DEV.to) support.",{"type":42,"tag":280,"props":4940,"children":4942},{"id":4941},"devto",[4943],{"type":48,"value":4944},"DEV.to",{"type":42,"tag":51,"props":4946,"children":4947},{},[4948],{"type":42,"tag":138,"props":4949,"children":4951},{"href":3514,"rel":4950},[142],[4952],{"type":48,"value":3514},{"type":42,"tag":51,"props":4954,"children":4955},{},[4956,4962],{"type":42,"tag":138,"props":4957,"children":4960},{"href":4958,"rel":4959},"https://dev.to",[142],[4961],{"type":48,"value":4944},{"type":48,"value":4963}," is a popular site for sharing technical articles. They allow you to automatically draft articles to publish on their site by adding your site's RSS feed. This article will be published on DEV.to through the RSS feed connection that my account has with DEV.to.",{"type":42,"tag":51,"props":4965,"children":4966},{},[4967],{"type":48,"value":4968},"DEV.to articles support their own custom front-matter properties. Here's what the front-matter for the DEV.to article looks like:",{"type":42,"tag":401,"props":4970,"children":4972},{"code":4971},"---\ntitle: How I write and share technical software development articles in 2021\npublished: false\ndate: '2021-10-02'\ntags:  nuxt, vue, publishing, blogging\nimage: 'https://briancaffey.github.io/static/dev-sites.png'\ncanonical_url: https://briancaffey.github.io/2021/10/02/how-i-write-and-share-technical-software-development-articles-in-2021\n---\n",[4973],{"type":42,"tag":349,"props":4974,"children":4975},{"__ignoreMap":8},[4976],{"type":48,"value":4971},{"type":42,"tag":51,"props":4978,"children":4979},{},[4980,4982,4988,4990,4996],{"type":48,"value":4981},"If you don't see your article in your list of article drafts on your DEV.to dashboard, you can go into ",{"type":42,"tag":349,"props":4983,"children":4985},{"className":4984},[],[4986],{"type":48,"value":4987},"Settings > Extensions > Publishing to DEV Community from RSS",{"type":48,"value":4989}," and click on ",{"type":42,"tag":349,"props":4991,"children":4993},{"className":4992},[],[4994],{"type":48,"value":4995},"Save Feed Settings",{"type":48,"value":4997},". I think this refreshes your RSS feed in your dashboard.",{"type":42,"tag":280,"props":4999,"children":5000},{"id":3518},[5001],{"type":48,"value":5002},"Medium",{"type":42,"tag":51,"props":5004,"children":5005},{},[5006],{"type":42,"tag":138,"props":5007,"children":5009},{"href":3517,"rel":5008},[142],[5010],{"type":48,"value":3517},{"type":42,"tag":51,"props":5012,"children":5013},{},[5014],{"type":48,"value":5015},"I haven't published anything on Medium, so one of my goals for this article is to cross publish it on Medium in my first article on that platform.",{"type":42,"tag":51,"props":5017,"children":5018},{},[5019],{"type":42,"tag":138,"props":5020,"children":5023},{"href":5021,"rel":5022},"https://medium.com/new-story",[142],[5024],{"type":48,"value":5021},{"type":42,"tag":280,"props":5026,"children":5027},{"id":3521},[5028],{"type":48,"value":5029},"Hashnode",{"type":42,"tag":51,"props":5031,"children":5032},{},[5033],{"type":42,"tag":138,"props":5034,"children":5036},{"href":3520,"rel":5035},[142],[5037],{"type":48,"value":3520},{"type":42,"tag":51,"props":5039,"children":5040},{},[5041,5043,5049],{"type":48,"value":5042},"Hashnode seems very similar to DEV.to. Here's a comparison that shows some of the advantages of using Hashnode as a blogging platform over DEV.to: ",{"type":42,"tag":138,"props":5044,"children":5047},{"href":5045,"rel":5046},"https://hashnode.com/vs/devto",[142],[5048],{"type":48,"value":5045},{"type":48,"value":1970},{"type":42,"tag":51,"props":5051,"children":5052},{},[5053],{"type":42,"tag":138,"props":5054,"children":5057},{"href":5055,"rel":5056},"https://hashnode.com/create/story",[142],[5058],{"type":48,"value":5055},{"type":42,"tag":280,"props":5060,"children":5062},{"id":5061},"eggheadio",[5063],{"type":48,"value":5064},"egghead.io",{"type":42,"tag":51,"props":5066,"children":5067},{},[5068,5070,5076],{"type":48,"value":5069},"Egghead is another blogging platform that allows you to helps you ",{"type":42,"tag":349,"props":5071,"children":5073},{"className":5072},[],[5074],{"type":48,"value":5075},"Own Your Online Presence",{"type":48,"value":5077}," and also lets you create free and paid courses and content.",{"type":42,"tag":280,"props":5079,"children":5081},{"id":5080},"hacker-noon",[5082],{"type":48,"value":5083},"Hacker Noon",{"type":42,"tag":51,"props":5085,"children":5086},{},[5087],{"type":42,"tag":138,"props":5088,"children":5090},{"href":3526,"rel":5089},[142],[5091],{"type":48,"value":3526},{"type":42,"tag":51,"props":5093,"children":5094},{},[5095],{"type":48,"value":5096},"Hacker Noon is another platform that I haven't used before as a writer. In order to publish an article on Hacker Noon, the article must go through an editing process. The Hacker Noon editors change the title and cover image of my article, and also added some minor editor notes.",{"type":42,"tag":280,"props":5098,"children":5100},{"id":5099},"hacker-news",[5101],{"type":48,"value":5102},"Hacker News",{"type":42,"tag":51,"props":5104,"children":5105},{},[5106],{"type":42,"tag":138,"props":5107,"children":5109},{"href":3510,"rel":5108},[142],[5110],{"type":48,"value":3510},{"type":42,"tag":280,"props":5112,"children":5113},{"id":3524},[5114],{"type":48,"value":5115},"Substack",{"type":42,"tag":51,"props":5117,"children":5118},{},[5119],{"type":42,"tag":138,"props":5120,"children":5122},{"href":3523,"rel":5121},[142],[5123],{"type":48,"value":3523},{"type":42,"tag":280,"props":5125,"children":5126},{"id":33},[5127],{"type":48,"value":5128},"Reddit",{"type":42,"tag":51,"props":5130,"children":5131},{},[5132,5134,5140,5141,5147],{"type":48,"value":5133},"I have shared a lot of content on different programming subreddits specific to some of the tools and frameworks I use, such as ",{"type":42,"tag":349,"props":5135,"children":5137},{"className":5136},[],[5138],{"type":48,"value":5139},"r/aws",{"type":48,"value":2751},{"type":42,"tag":349,"props":5142,"children":5144},{"className":5143},[],[5145],{"type":48,"value":5146},"r/django",{"type":48,"value":5148},". When sharing on reddit, I like to share links to my personal website with at least on comment that provides a detailed summary of the article. When sharing on",{"type":42,"tag":51,"props":5150,"children":5151},{},[5152],{"type":42,"tag":138,"props":5153,"children":5155},{"href":3512,"rel":5154},[142],[5156],{"type":48,"value":3512},{"type":42,"tag":280,"props":5158,"children":5160},{"id":5159},"facebook",[5161],{"type":48,"value":5162},"Facebook",{"type":42,"tag":51,"props":5164,"children":5165},{},[5166,5168,5174],{"type":48,"value":5167},"Facebook has very large and active developer communities. Sometimes the communities are more fragmented than the communities on reddit. For example, there are several Nuxt communities on Facebook, but there is just one ",{"type":42,"tag":349,"props":5169,"children":5171},{"className":5170},[],[5172],{"type":48,"value":5173},"r/nuxt",{"type":48,"value":5175},". Similar to sharing content on reddit, I like to share links to my personal websites with detailed comments on the content of my article.",{"type":42,"tag":280,"props":5177,"children":5179},{"id":5178},"discord-servers",[5180],{"type":48,"value":5181},"Discord Servers",{"type":42,"tag":51,"props":5183,"children":5184},{},[5185],{"type":48,"value":5186},"Discord also has some dedicated servers for software frameworks, such as Nuxt.js. Discord seems to be the official place where Vue.js community members chat in real-time. There are dedicated channels on the server for sharing articles.",{"type":42,"tag":112,"props":5188,"children":5190},{"id":5189},"bonus-content-project-plug-and-conclusion",[5191],{"type":48,"value":3565},{"type":42,"tag":51,"props":5193,"children":5194},{},[5195],{"type":48,"value":5196},"One more great thing about GitHub pages is that you can publish a site on any of your GitHub repositories that will be hosted on a subpath of your GitHub pages blog.",{"type":42,"tag":51,"props":5198,"children":5199},{},[5200,5202,5209,5211,5218],{"type":48,"value":5201},"I have been working updating and rewriting my Django + Vue.js + AWS reference project. It contains a documentation site that I am making with VuePress. The repo for this project is here: ",{"type":42,"tag":138,"props":5203,"children":5206},{"href":5204,"rel":5205},"https://github.com/briancaffey/django-step-by-step",[142],[5207],{"type":48,"value":5208},"github.com/briancaffey/django-step-by-step",{"type":48,"value":5210},". This repository has it's own GitHub Pages configuration, as well as a GitHub Action to help automate the deployment of this project documentation site to GitHub Pages. The project site is currently hosted on ",{"type":42,"tag":138,"props":5212,"children":5215},{"href":5213,"rel":5214},"https://briancaffey.github.io/django-step-by-step/",[142],[5216],{"type":48,"value":5217},"briancaffey.github.io/django-step-by-step/",{"type":48,"value":1970},{"type":42,"tag":51,"props":5220,"children":5221},{},[5222,5224,5235],{"type":48,"value":5223},"The project uses a CDK construct library that I have been developing alongside of this reference project called ",{"type":42,"tag":138,"props":5225,"children":5228},{"href":5226,"rel":5227},"https://github.com/briancaffey/django-cdk",[142],[5229],{"type":42,"tag":349,"props":5230,"children":5232},{"className":5231},[],[5233],{"type":48,"value":5234},"django-cdk",{"type":48,"value":5236},". It provides high-level constructs that allow you to deploy a complete stack of resources on AWS that will support your Django + Vue.js application including:",{"type":42,"tag":57,"props":5238,"children":5239},{},[5240,5245,5250,5255,5260,5265,5270,5275],{"type":42,"tag":61,"props":5241,"children":5242},{},[5243],{"type":48,"value":5244},"VPC networking",{"type":42,"tag":61,"props":5246,"children":5247},{},[5248],{"type":48,"value":5249},"CloudFront & S3 for Frontend",{"type":42,"tag":61,"props":5251,"children":5252},{},[5253],{"type":48,"value":5254},"RDS & Elasticache",{"type":42,"tag":61,"props":5256,"children":5257},{},[5258],{"type":48,"value":5259},"ECS & EKS options",{"type":42,"tag":61,"props":5261,"children":5262},{},[5263],{"type":48,"value":5264},"Application Load Balancer",{"type":42,"tag":61,"props":5266,"children":5267},{},[5268],{"type":48,"value":5269},"Automatic migrations",{"type":42,"tag":61,"props":5271,"children":5272},{},[5273],{"type":48,"value":5274},"Asset and Media file storage with S3",{"type":42,"tag":61,"props":5276,"children":5277},{},[5278],{"type":48,"value":5279},"Shell access (for debugging)",{"type":42,"tag":51,"props":5281,"children":5282},{},[5283,5285,5290,5292],{"type":48,"value":5284},"The documentation for ",{"type":42,"tag":349,"props":5286,"children":5288},{"className":5287},[],[5289],{"type":48,"value":5234},{"type":48,"value":5291}," can be found here: ",{"type":42,"tag":138,"props":5293,"children":5296},{"href":5294,"rel":5295},"https://briancaffey.github.io/django-step-by-step/deploy/aws/#about-django-cdk",[142],[5297],{"type":48,"value":5294},{"type":42,"tag":51,"props":5299,"children":5300},{},[5301,5303,5308],{"type":48,"value":5302},"You may want to split a large project's documentation site into its own site, rather than having it live on the nested path of a personal blog. Following this pattern, your GitHub pages blog can become a site that is much larger than one single Nuxt static site. ",{"type":42,"tag":349,"props":5304,"children":5306},{"className":5305},[],[5307],{"type":48,"value":3577},{"type":48,"value":5309}," is now a hybrid Nuxt.js and VuePress site, with a subset of routes (starting with /django-step-by-step/) being served by VuePress.",{"type":42,"tag":51,"props":5311,"children":5312},{},[5313],{"type":48,"value":5314},"As I'm writing this article, Nuxt 3 is almost one week away from a public beta. I'm excited to try upgrading this site to Nuxt 3 and trying out some of the new features that it includes.",{"type":42,"tag":51,"props":5316,"children":5317},{},[5318],{"type":48,"value":5319},"Thanks for reading this article, wherever you may have found it on the internet!",{"type":42,"tag":3468,"props":5321,"children":5322},{},[5323],{"type":48,"value":3472},{"title":8,"searchDepth":486,"depth":486,"links":5325},[5326,5345,5357],{"id":3568,"depth":486,"text":5327,"children":5328},"Building briancaffey.github.io with Nuxt.js",[5329,5330,5331,5332,5333,5334,5335,5336,5337,5338,5339,5340,5341,5342,5343,5344],{"id":3596,"depth":499,"text":3599},{"id":3637,"depth":499,"text":3640},{"id":4210,"depth":499,"text":4213},{"id":4221,"depth":499,"text":4224},{"id":4258,"depth":499,"text":4261},{"id":4366,"depth":499,"text":4369},{"id":4405,"depth":499,"text":4408},{"id":4454,"depth":499,"text":4457},{"id":4659,"depth":499,"text":4662},{"id":4686,"depth":499,"text":4689},{"id":4705,"depth":499,"text":4708},{"id":4716,"depth":499,"text":4719},{"id":4749,"depth":499,"text":4752},{"id":4785,"depth":499,"text":4788},{"id":4860,"depth":499,"text":4863},{"id":4871,"depth":499,"text":4874},{"id":4913,"depth":486,"text":4916,"children":5346},[5347,5348,5349,5350,5351,5352,5353,5354,5355,5356],{"id":4941,"depth":499,"text":4944},{"id":3518,"depth":499,"text":5002},{"id":3521,"depth":499,"text":5029},{"id":5061,"depth":499,"text":5064},{"id":5080,"depth":499,"text":5083},{"id":5099,"depth":499,"text":5102},{"id":3524,"depth":499,"text":5115},{"id":33,"depth":499,"text":5128},{"id":5159,"depth":499,"text":5162},{"id":5178,"depth":499,"text":5181},{"id":5189,"depth":486,"text":3565},"content:2021:10:02:how-i-write-and-share-technical-software-development-articles-in-2021.md","2021/10/02/how-i-write-and-share-technical-software-development-articles-in-2021.md","2021/10/02/how-i-write-and-share-technical-software-development-articles-in-2021",{"_path":5362,"_dir":5363,"_draft":7,"_partial":7,"_locale":8,"title":5364,"description":5365,"date":5366,"image":5367,"tags":5368,"body":5372,"_type":3490,"_id":5468,"_source":3492,"_file":5469,"_stem":5470,"_extension":3495},"/2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django","07","Authenticating requests with JWT tokens stored in HTTPOnly cookies in Django","This article describes how you can use JWT tokens in Django applications with decoupled frontend JavaScript applications running the browser in secure way using HttpOnly cookies.","2021-08-01","/static/djjwt/dj_jwt.png",[5369,25,5370,5371],"django","jwt","authentication",{"type":39,"children":5373,"toc":5461},[5374,5378,5383,5389,5394,5400,5405,5414,5419,5425,5430,5439,5447,5452],{"type":42,"tag":112,"props":5375,"children":5376},{"id":45},[5377],{"type":48,"value":49},{"type":42,"tag":51,"props":5379,"children":5380},{},[5381],{"type":48,"value":5382},"If you want to use JWTs to securely authenticate requests to Django REST Framework applications in a decoupled frontend JavaScript application, you can do the following: store the access token in memory and store the refresh token  in an HttpOnly cookie. The refresh token is used to request new access tokens on an regular interval.",{"type":42,"tag":112,"props":5384,"children":5386},{"id":5385},"some-context",[5387],{"type":48,"value":5388},"Some context",{"type":42,"tag":51,"props":5390,"children":5391},{},[5392],{"type":48,"value":5393},"Django is a web framework based on the Model, Template, View (MTV) paradigm. Django is increasingly used as an API server that is coupled with a Javascript or native frontend application.",{"type":42,"tag":112,"props":5395,"children":5397},{"id":5396},"jwt-auth-with-httponly-cookies",[5398],{"type":48,"value":5399},"JWT Auth with HttpOnly Cookies",{"type":42,"tag":51,"props":5401,"children":5402},{},[5403],{"type":48,"value":5404},"Following this guide:",{"type":42,"tag":51,"props":5406,"children":5407},{},[5408],{"type":42,"tag":138,"props":5409,"children":5412},{"href":5410,"rel":5411},"https://hasura.io/blog/best-practices-of-using-jwt-with-graphql/#jwt_security",[142],[5413],{"type":48,"value":5410},{"type":42,"tag":51,"props":5415,"children":5416},{},[5417],{"type":48,"value":5418},"We can reimplement our JWT authentication setup to be more secure.",{"type":42,"tag":280,"props":5420,"children":5422},{"id":5421},"drf-simple-jwt-modifications",[5423],{"type":48,"value":5424},"DRF Simple JWT modifications",{"type":42,"tag":51,"props":5426,"children":5427},{},[5428],{"type":48,"value":5429},"We need to change the default behavior of the views from DRF simple JWT as described in this issue:",{"type":42,"tag":51,"props":5431,"children":5432},{},[5433],{"type":42,"tag":138,"props":5434,"children":5437},{"href":5435,"rel":5436},"https://github.com/jazzband/djangorestframework-simplejwt/issues/71",[142],[5438],{"type":48,"value":5435},{"type":42,"tag":51,"props":5440,"children":5441},{},[5442],{"type":42,"tag":127,"props":5443,"children":5446},{"alt":5444,"src":5445},"png","/static/jwt-authentication.png",[],{"type":42,"tag":51,"props":5448,"children":5449},{},[5450],{"type":48,"value":5451},"This diagram shows how authentication data moves between the Django backend and the Vue.js frontend running in the browser.",{"type":42,"tag":51,"props":5453,"children":5454},{},[5455],{"type":42,"tag":5456,"props":5457,"children":5458},"em",{},[5459],{"type":48,"value":5460},"This article should now be complete complete",{"title":8,"searchDepth":486,"depth":486,"links":5462},[5463,5464,5465],{"id":45,"depth":486,"text":49},{"id":5385,"depth":486,"text":5388},{"id":5396,"depth":486,"text":5399,"children":5466},[5467],{"id":5421,"depth":499,"text":5424},"content:2021:08:07:authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django.md","2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django.md","2021/08/07/authenticating-requests-with-jwt-tokens-stored-in-httponly-cookies-in-django",{"_path":5472,"_dir":5473,"_draft":7,"_partial":7,"_locale":8,"title":5474,"description":5475,"date":5476,"image":5477,"tags":5478,"body":5480,"_type":3490,"_id":5512,"_source":3492,"_file":5513,"_stem":5514,"_extension":3495},"/2021/01/15/adding-internationalization-to-a-statically-generated-nuxt-site","15","Adding internationalization to a statically generated Nuxt site","This article will summarize my experience implementing internationalization (i18n) for a statically-generated Nuxt.js site","2021-01-15","/static/emoji_flags.png",[5479,25,3504],"i18n",{"type":39,"children":5481,"toc":5510},[5482,5487,5492,5500,5505],{"type":42,"tag":51,"props":5483,"children":5484},{},[5485],{"type":48,"value":5486},"This article will give an overview of my experience adding internationalization to my statically-generated Nuxt website.",{"type":42,"tag":51,"props":5488,"children":5489},{},[5490],{"type":48,"value":5491},"Since I migrated my site from Jekyll to Nuxt, I have had issues with my blog post URLs. My Jekyll site automatically generated URLs that included the date:",{"type":42,"tag":401,"props":5493,"children":5495},{"code":5494},"https://my-site.com/2021/01/01/my-first-blog-post-of-2021\n",[5496],{"type":42,"tag":349,"props":5497,"children":5498},{"__ignoreMap":8},[5499],{"type":48,"value":5494},{"type":42,"tag":51,"props":5501,"children":5502},{},[5503],{"type":48,"value":5504},"To replicate this URL pattern with Nuxt, I have had to use some advanced features of the content API and Nuxt configuration options, as well as an awkward folder structure.",{"type":42,"tag":51,"props":5506,"children":5507},{},[5508],{"type":48,"value":5509},"Because of this, I will be implementing internationalization in to phases: first I'll work on translating the core pages, next I'll work on setting up translations for individual blog posts. I don't plan on translating most of my blog posts, and in some cases I might only be providing translations for some of the locales that my site supports, falling back to the English version where a given locale is not available.",{"title":8,"searchDepth":486,"depth":486,"links":5511},[],"content:2021:01:15:adding-internationalization-to-a-statically-generated-nuxt-site.md","2021/01/15/adding-internationalization-to-a-statically-generated-nuxt-site.md","2021/01/15/adding-internationalization-to-a-statically-generated-nuxt-site",{"_path":5516,"_dir":3498,"_draft":7,"_partial":7,"_locale":8,"title":5517,"description":5518,"date":5519,"image":5520,"tags":5521,"body":5524,"_type":3490,"_id":6389,"_source":3492,"_file":6390,"_stem":6391,"_extension":3495},"/2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application","Using Stripe for recurring monthly SaaS subscriptions in a Django + Vue application","This article shares my experience learning and implementing the Stripe API for recurring monthly SaaS subscription payments in an application using Django and Vue.js","2021-01-02T00:00:00.000Z","/static/django_vue_stripe.png",[5369,25,5522,5523],"drf","stripe",{"type":39,"children":5525,"toc":6379},[5526,5532,5537,5542,5548,5561,5574,5580,5600,5607,5613,5618,5624,5856,5862,5867,6195,6201,6206,6268,6274],{"type":42,"tag":43,"props":5527,"children":5529},{"id":5528},"using-stripe-for-recurring-monthly-payments-to-a-paid-saas-subscription-in-a-django-vuejs-application",[5530],{"type":48,"value":5531},"Using Stripe for recurring monthly payments to a paid SaaS subscription in a Django + Vue.js application",{"type":42,"tag":51,"props":5533,"children":5534},{},[5535],{"type":48,"value":5536},"This diagram shows the flow of data for the lifecycle of a paid customer subscription in a Django application with a Vue.js client. There are four stages:",{"type":42,"tag":51,"props":5538,"children":5539},{},[5540],{"type":48,"value":5541},"I. Account setup, configuration, model and object creation\nII. Logic and data flow for starting a customer's premium monthly subscription\nIII. Automatic subscription renewal\nIV. Cancelling a premium subscription",{"type":42,"tag":112,"props":5543,"children":5545},{"id":5544},"context",[5546],{"type":48,"value":5547},"Context",{"type":42,"tag":51,"props":5549,"children":5550},{},[5551,5553,5559],{"type":48,"value":5552},"This is my first attempt at using Stripe, or any other online payment service API. Most of what I have diagramed here comes from this article from the Stripe documentation: ",{"type":42,"tag":138,"props":5554,"children":5557},{"href":5555,"rel":5556},"https://stripe.com/docs/billing/subscriptions/fixed-price",[142],[5558],{"type":48,"value":5555},{"type":48,"value":5560},". Knowing almost nothing about what is needed to create a SaaS subscription, I found this article very helpful. It was a lot to read at once, but each call to to the Stripe API is very clear and straightforward.",{"type":42,"tag":51,"props":5562,"children":5563},{},[5564,5566,5572],{"type":48,"value":5565},"I made some modifications and additions to this walk-through for my use case, which is an API service called Open SEC Data, an open source project that I'm working on (",{"type":42,"tag":138,"props":5567,"children":5570},{"href":5568,"rel":5569},"https://gitlab.com/briancaffey/sec-filings-app",[142],[5571],{"type":48,"value":5568},{"type":48,"value":5573},").",{"type":42,"tag":112,"props":5575,"children":5577},{"id":5576},"diagram",[5578],{"type":48,"value":5579},"Diagram",{"type":42,"tag":51,"props":5581,"children":5582},{},[5583,5585,5591,5593,5599],{"type":48,"value":5584},"Here's a read-only link to the diagram: ",{"type":42,"tag":138,"props":5586,"children":5589},{"href":5587,"rel":5588},"https://drive.google.com/file/d/1oH2b0W-c-dI5oXzc_jvCGvXx9sJagr4a/view?usp=sharing",[142],[5590],{"type":48,"value":5587},{"type":48,"value":5592},". This diagram is made with ",{"type":42,"tag":138,"props":5594,"children":5597},{"href":5595,"rel":5596},"https://www.diagrams.net/",[142],[5598],{"type":48,"value":5595},{"type":48,"value":1970},{"type":42,"tag":51,"props":5601,"children":5602},{},[5603],{"type":42,"tag":127,"props":5604,"children":5606},{"alt":5444,"src":5605},"/static/django_vue_stripe_diagram.png",[],{"type":42,"tag":112,"props":5608,"children":5610},{"id":5609},"legend",[5611],{"type":48,"value":5612},"Legend",{"type":42,"tag":51,"props":5614,"children":5615},{},[5616],{"type":48,"value":5617},"Here's a detailed description of each part of the diagram, starting with the first section.",{"type":42,"tag":280,"props":5619,"children":5621},{"id":5620},"i-account-setup-configuration-model-and-object-creation",[5622],{"type":48,"value":5623},"I. Account setup, configuration, model and object creation",{"type":42,"tag":3541,"props":5625,"children":5626},{},[5627,5640,5653,5678,5691,5709,5714,5743,5769,5795,5820,5831],{"type":42,"tag":61,"props":5628,"children":5629},{},[5630,5632,5638],{"type":48,"value":5631},"Setup a Stripe account. For local development, make sure you turn on ",{"type":42,"tag":349,"props":5633,"children":5635},{"className":5634},[],[5636],{"type":48,"value":5637},"View test data",{"type":48,"value":5639},". On your local machine, install the stripe CLI and authenticate with your Stripe account",{"type":42,"tag":61,"props":5641,"children":5642},{},[5643,5645,5651],{"type":48,"value":5644},"Create a Product in Stripe (mine is called ",{"type":42,"tag":349,"props":5646,"children":5648},{"className":5647},[],[5649],{"type":48,"value":5650},"Open SEC Data Premium Subscription",{"type":48,"value":5652},")",{"type":42,"tag":61,"props":5654,"children":5655},{},[5656,5658,5661,5663,5669,5671,5677],{"type":48,"value":5657},"Create a Price in Stripe that references the Product.",{"type":42,"tag":4771,"props":5659,"children":5660},{},[],{"type":48,"value":5662},"Instead of creating these objects in the Stripe Dashboard, you can also create them with the Stripe CLI or the Python SDK. I created a Django management command called ",{"type":42,"tag":349,"props":5664,"children":5666},{"className":5665},[],[5667],{"type":48,"value":5668},"create_stripe_data",{"type":48,"value":5670}," that will create a Product and related Price in Stripe. We will need the id of the Price, it looks like this: ",{"type":42,"tag":349,"props":5672,"children":5674},{"className":5673},[],[5675],{"type":48,"value":5676},"price_1Hx0goL67dRDwyuDh9yEWsBo",{"type":48,"value":1970},{"type":42,"tag":61,"props":5679,"children":5680},{},[5681,5683,5689],{"type":48,"value":5682},"Add the Price ID as an environment variable ",{"type":42,"tag":349,"props":5684,"children":5686},{"className":5685},[],[5687],{"type":48,"value":5688},"SUBSCRIPTION_PRICE_ID",{"type":48,"value":5690}," to the backend. This will be used later when we make API calls to Stripe from inside of Django views.",{"type":42,"tag":61,"props":5692,"children":5693},{},[5694,5696,5699,5701,5707],{"type":48,"value":5695},"For production environments, you will need to a register a Stripe webhook. This is an endpoint in Django that Stripe will POST to in order to inform the Django application of events that have happened in Stripe.",{"type":42,"tag":4771,"props":5697,"children":5698},{},[],{"type":48,"value":5700},"For local development we need to run ",{"type":42,"tag":349,"props":5702,"children":5704},{"className":5703},[],[5705],{"type":48,"value":5706},"stripe listen --forward-to localhost/api/stripe-webhooks/",{"type":48,"value":5708}," in order to forward webhook events to the local Django application. This works really well for local development.",{"type":42,"tag":61,"props":5710,"children":5711},{},[5712],{"type":48,"value":5713},"In both local and production environments we need to add an environment variables to the Django application that will be used to validate the webhook event.",{"type":42,"tag":61,"props":5715,"children":5716},{},[5717,5719,5725,5727,5733,5735,5741],{"type":48,"value":5718},"You will need to create a ",{"type":42,"tag":349,"props":5720,"children":5722},{"className":5721},[],[5723],{"type":48,"value":5724},"Subscription",{"type":48,"value":5726}," model or similar in your Django models. This model should be related to your user model in some way. At a minimum it should have the ",{"type":42,"tag":349,"props":5728,"children":5730},{"className":5729},[],[5731],{"type":48,"value":5732},"subscription_id",{"type":48,"value":5734}," (the ID of the Stripe Subscription) and ",{"type":42,"tag":349,"props":5736,"children":5738},{"className":5737},[],[5739],{"type":48,"value":5740},"current_period_end",{"type":48,"value":5742}," (also from the Stripe Subscription object). We will use this model in the next sections.",{"type":42,"tag":61,"props":5744,"children":5745},{},[5746,5752,5754,5760,5762,5768],{"type":42,"tag":349,"props":5747,"children":5749},{"className":5748},[],[5750],{"type":48,"value":5751},"/api/stripe-webhooks/",{"type":48,"value":5753}," is the endpoint in the Django application that Stripe will send POST requests to in order to inform the Django application of events that happen in Stripe. The URL can be called anything you want, as long as you register it with that URL. In local development, you need to specify this URL in the ",{"type":42,"tag":349,"props":5755,"children":5757},{"className":5756},[],[5758],{"type":48,"value":5759},"stipe listen",{"type":48,"value":5761}," command (for example, ",{"type":42,"tag":349,"props":5763,"children":5765},{"className":5764},[],[5766],{"type":48,"value":5767},"stripe listen forward-to localhost/api/stripe-webhooks/",{"type":48,"value":5573},{"type":42,"tag":61,"props":5770,"children":5771},{},[5772,5778,5780,5786,5788,5794],{"type":42,"tag":349,"props":5773,"children":5775},{"className":5774},[],[5776],{"type":48,"value":5777},"STRIPE_SECRET_KEY",{"type":48,"value":5779}," is the name of the secret API key that should only be accessible by the backend. In local development, this key looks like ",{"type":42,"tag":349,"props":5781,"children":5783},{"className":5782},[],[5784],{"type":48,"value":5785},"sk_test_Abc123",{"type":48,"value":5787},". In production, this key will look like ",{"type":42,"tag":349,"props":5789,"children":5791},{"className":5790},[],[5792],{"type":48,"value":5793},"sk_Abc123",{"type":48,"value":1970},{"type":42,"tag":61,"props":5796,"children":5797},{},[5798,5803,5805,5811,5813,5819],{"type":42,"tag":349,"props":5799,"children":5801},{"className":5800},[],[5802],{"type":48,"value":5523},{"type":48,"value":5804}," is the name of the PyPI package that we need to add to ",{"type":42,"tag":349,"props":5806,"children":5808},{"className":5807},[],[5809],{"type":48,"value":5810},"requirements.txt",{"type":48,"value":5812}," (",{"type":42,"tag":349,"props":5814,"children":5816},{"className":5815},[],[5817],{"type":48,"value":5818},"requirements/base.txt",{"type":48,"value":5573},{"type":42,"tag":61,"props":5821,"children":5822},{},[5823,5829],{"type":42,"tag":349,"props":5824,"children":5826},{"className":5825},[],[5827],{"type":48,"value":5828},"STRIPE_PUBLISHABLE_KEY",{"type":48,"value":5830}," is the value of the Stripe API key that can be made public and is used in the Vue application to instantiate Stripe.",{"type":42,"tag":61,"props":5832,"children":5833},{},[5834,5836,5842,5844],{"type":48,"value":5835},"The Stripe library is included in ",{"type":42,"tag":349,"props":5837,"children":5839},{"className":5838},[],[5840],{"type":48,"value":5841},"index.html",{"type":48,"value":5843}," via CDN so that it is accessible anywhere in the Vue application. Stripe object is instantiated in the Vue application with:",{"type":42,"tag":723,"props":5845,"children":5846},{},[5847],{"type":42,"tag":51,"props":5848,"children":5849},{},[5850],{"type":42,"tag":349,"props":5851,"children":5853},{"className":5852},[],[5854],{"type":48,"value":5855},"let stripe = Stripe(process.env.STRIPE_PUBLISHABLE_KEY)",{"type":42,"tag":280,"props":5857,"children":5859},{"id":5858},"ii-logic-and-data-flow-for-starting-a-customers-premium-monthly-subscription",[5860],{"type":48,"value":5861},"II. Logic and data flow for starting a customer's premium monthly subscription",{"type":42,"tag":51,"props":5863,"children":5864},{},[5865],{"type":48,"value":5866},"With everything setup and configured properly in Stripe, the backend Django application and the frontend Vue application, customers can now start paying for monthly subscriptions. In my application, a user can sign up for an account first without having a premium subscription. In other scenarios, having an active account may require a premium subscription.",{"type":42,"tag":3541,"props":5868,"children":5869},{"start":672},[5870,5907,5957,5969,5994,6012,6025,6030,6035,6040,6082,6100,6111,6121,6141,6146,6151,6156,6190],{"type":42,"tag":61,"props":5871,"children":5872},{},[5873,5875,5881,5883,5889,5891,5898,5900,5906],{"type":48,"value":5874},"When a logged-in user visits their ",{"type":42,"tag":349,"props":5876,"children":5878},{"className":5877},[],[5879],{"type":48,"value":5880},"/account",{"type":48,"value":5882}," page, they will see the status of their account: Basic (free) or Premium (paid subscription). Users on a Basic plan will see the option to upgrade to Premium. They will be redirected to a ",{"type":42,"tag":349,"props":5884,"children":5886},{"className":5885},[],[5887],{"type":48,"value":5888},"/premium",{"type":48,"value":5890}," page where they will be presented with a credit card form. This credit card form is generated by ",{"type":42,"tag":138,"props":5892,"children":5895},{"href":5893,"rel":5894},"https://stripe.com/payments/elements",[142],[5896],{"type":48,"value":5897},"Stripe Elements",{"type":48,"value":5899},". The user fills out their credit card, expiration date, card security code and billing ZIP code and then clicks ",{"type":42,"tag":349,"props":5901,"children":5903},{"className":5902},[],[5904],{"type":48,"value":5905},"Purchase",{"type":48,"value":1970},{"type":42,"tag":61,"props":5908,"children":5909},{},[5910,5912,5917,5919,5925,5927,5933,5935,5941,5943,5948,5950,5956],{"type":48,"value":5911},"Clicking on ",{"type":42,"tag":349,"props":5913,"children":5915},{"className":5914},[],[5916],{"type":48,"value":5905},{"type":48,"value":5918}," calls a method ",{"type":42,"tag":349,"props":5920,"children":5922},{"className":5921},[],[5923],{"type":48,"value":5924},"purchase",{"type":48,"value":5926}," that calls ",{"type":42,"tag":349,"props":5928,"children":5930},{"className":5929},[],[5931],{"type":48,"value":5932},"stripe.CreatePaymentMethod",{"type":48,"value":5934},". The ",{"type":42,"tag":349,"props":5936,"children":5938},{"className":5937},[],[5939],{"type":48,"value":5940},"paymentMethodId",{"type":48,"value":5942}," token returned from ",{"type":42,"tag":349,"props":5944,"children":5946},{"className":5945},[],[5947],{"type":48,"value":5932},{"type":48,"value":5949}," is then passed to the method called ",{"type":42,"tag":349,"props":5951,"children":5953},{"className":5952},[],[5954],{"type":48,"value":5955},"createSubscription",{"type":48,"value":1970},{"type":42,"tag":61,"props":5958,"children":5959},{},[5960,5962,5967],{"type":48,"value":5961},"Stripe creates this object and returns a response that contains a ",{"type":42,"tag":349,"props":5963,"children":5965},{"className":5964},[],[5966],{"type":48,"value":5940},{"type":48,"value":5968}," token.",{"type":42,"tag":61,"props":5970,"children":5971},{},[5972,5977,5979,5985,5987,5992],{"type":42,"tag":349,"props":5973,"children":5975},{"className":5974},[],[5976],{"type":48,"value":5955},{"type":48,"value":5978}," sends a POST request to ",{"type":42,"tag":349,"props":5980,"children":5982},{"className":5981},[],[5983],{"type":48,"value":5984},"/api/stripe/create-subscription/",{"type":48,"value":5986}," in the Django application with the ",{"type":42,"tag":349,"props":5988,"children":5990},{"className":5989},[],[5991],{"type":48,"value":5940},{"type":48,"value":5993}," that we generated in the previous step.",{"type":42,"tag":61,"props":5995,"children":5996},{},[5997,6002,6004,6010],{"type":42,"tag":349,"props":5998,"children":6000},{"className":5999},[],[6001],{"type":48,"value":5984},{"type":48,"value":6003}," calls a view called ",{"type":42,"tag":349,"props":6005,"children":6007},{"className":6006},[],[6008],{"type":48,"value":6009},"create_subscription",{"type":48,"value":6011}," which makes a number of API calls to Stripe and then finally saves some data in the application's Postgres database.",{"type":42,"tag":61,"props":6013,"children":6014},{},[6015,6017,6023],{"type":48,"value":6016},"The first API call creates the Customer object in Stripe if it does not exist. ",{"type":42,"tag":349,"props":6018,"children":6020},{"className":6019},[],[6021],{"type":48,"value":6022},"email=request.user.email",{"type":48,"value":6024}," is used in the API call to associate the Stripe customer with the user's email.",{"type":42,"tag":61,"props":6026,"children":6027},{},[6028],{"type":48,"value":6029},"Next the payment method is attached to Stripe Customer model.",{"type":42,"tag":61,"props":6031,"children":6032},{},[6033],{"type":48,"value":6034},"Next the Stripe payment method is set as the default payment method for Stripe customer for future billing.",{"type":42,"tag":61,"props":6036,"children":6037},{},[6038],{"type":48,"value":6039},"The Stripe subscription model is created with the customer ID that was created in the earlier and the price ID corresponding to the premium subscription (added in the setup stage).",{"type":42,"tag":61,"props":6041,"children":6042},{},[6043,6045,6051,6052,6058,6059,6065,6067,6072,6074,6080],{"type":48,"value":6044},"Once these Stripe API calls have finished, a new Subscription is saved in the Postgres database. ",{"type":42,"tag":349,"props":6046,"children":6048},{"className":6047},[],[6049],{"type":48,"value":6050},"stripe_subscription_id",{"type":48,"value":935},{"type":42,"tag":349,"props":6053,"children":6055},{"className":6054},[],[6056],{"type":48,"value":6057},"stripe_customer_id",{"type":48,"value":2751},{"type":42,"tag":349,"props":6060,"children":6062},{"className":6061},[],[6063],{"type":48,"value":6064},"valid_through",{"type":48,"value":6066}," (DateTimeField that keeps track of the date through which the user's subscription has been paid for) are saved to the ",{"type":42,"tag":349,"props":6068,"children":6070},{"className":6069},[],[6071],{"type":48,"value":5724},{"type":48,"value":6073}," model and then the subscription model is saved to the user model's ",{"type":42,"tag":349,"props":6075,"children":6077},{"className":6076},[],[6078],{"type":48,"value":6079},"subscription",{"type":48,"value":6081}," field.",{"type":42,"tag":61,"props":6083,"children":6084},{},[6085,6087,6092,6094],{"type":48,"value":6086},"When the ",{"type":42,"tag":349,"props":6088,"children":6090},{"className":6089},[],[6091],{"type":48,"value":5955},{"type":48,"value":6093}," method's POST requests returns successfully, the user's account is fetched again from ",{"type":42,"tag":349,"props":6095,"children":6097},{"className":6096},[],[6098],{"type":48,"value":6099},"/api/account/",{"type":42,"tag":61,"props":6101,"children":6102},{},[6103,6105,6110],{"type":48,"value":6104},"The browser makes a request to ",{"type":42,"tag":349,"props":6106,"children":6108},{"className":6107},[],[6109],{"type":48,"value":6099},{"type":48,"value":1970},{"type":42,"tag":61,"props":6112,"children":6113},{},[6114,6119],{"type":42,"tag":349,"props":6115,"children":6117},{"className":6116},[],[6118],{"type":48,"value":6099},{"type":48,"value":6120}," returns information on the user and their subscription.",{"type":42,"tag":61,"props":6122,"children":6123},{},[6124,6126,6131,6133,6139],{"type":48,"value":6125},"Data from ",{"type":42,"tag":349,"props":6127,"children":6129},{"className":6128},[],[6130],{"type":48,"value":6099},{"type":48,"value":6132}," is updated in Vuex ",{"type":42,"tag":349,"props":6134,"children":6136},{"className":6135},[],[6137],{"type":48,"value":6138},"user",{"type":48,"value":6140}," store.",{"type":42,"tag":61,"props":6142,"children":6143},{},[6144],{"type":48,"value":6145},"The user is now able to make requests to resources for premium features.",{"type":42,"tag":61,"props":6147,"children":6148},{},[6149],{"type":48,"value":6150},"In this application, one such example is the ability to request an API key for making for making API calls.",{"type":42,"tag":61,"props":6152,"children":6153},{},[6154],{"type":48,"value":6155},"A user makes a request to an API endpoint for a premium feature.",{"type":42,"tag":61,"props":6157,"children":6158},{},[6159,6161,6167,6169,6175,6177,6182,6184,6189],{"type":48,"value":6160},"When determining permissions for resources that should only be accessible to customers with valid subscriptions, we need to compare ",{"type":42,"tag":349,"props":6162,"children":6164},{"className":6163},[],[6165],{"type":48,"value":6166},"request.user.subscription.valid_through",{"type":48,"value":6168}," to ",{"type":42,"tag":349,"props":6170,"children":6172},{"className":6171},[],[6173],{"type":48,"value":6174},"timezone.now()",{"type":48,"value":6176}," and make sure that ",{"type":42,"tag":349,"props":6178,"children":6180},{"className":6179},[],[6181],{"type":48,"value":6064},{"type":48,"value":6183}," is greater than ",{"type":42,"tag":349,"props":6185,"children":6187},{"className":6186},[],[6188],{"type":48,"value":6174},{"type":48,"value":1970},{"type":42,"tag":61,"props":6191,"children":6192},{},[6193],{"type":48,"value":6194},"Requests for protected resources are successfully returned to the browser.",{"type":42,"tag":280,"props":6196,"children":6198},{"id":6197},"iii-automatic-subscription-renewal",[6199],{"type":48,"value":6200},"III. Automatic subscription renewal",{"type":42,"tag":51,"props":6202,"children":6203},{},[6204],{"type":48,"value":6205},"The customer's credit card is charged once each month that they are subscribed to the service. This action happens in Stripe. This section assumes that the customer's primary payment method is still valid (it has not been canceled expired or not able to be charged for some other reason).",{"type":42,"tag":3541,"props":6207,"children":6208},{"start":1659},[6209,6214,6235],{"type":42,"tag":61,"props":6210,"children":6211},{},[6212],{"type":48,"value":6213},"The customer's card is charged in Stripe and an event is sent to the Django backend via a webhook that we registered in the setup stage.",{"type":42,"tag":61,"props":6215,"children":6216},{},[6217,6219,6225,6227,6233],{"type":48,"value":6218},"The webhook view checks ",{"type":42,"tag":349,"props":6220,"children":6222},{"className":6221},[],[6223],{"type":48,"value":6224},"event.type",{"type":48,"value":6226}," and if the event is of type ",{"type":42,"tag":349,"props":6228,"children":6230},{"className":6229},[],[6231],{"type":48,"value":6232},"invoice.paid",{"type":48,"value":6234}," we extend the user's subscription by one month.",{"type":42,"tag":61,"props":6236,"children":6237},{},[6238,6240,6246,6248,6253,6255,6260,6262,6267],{"type":48,"value":6239},"To extend the user's subscription, we modify the ",{"type":42,"tag":349,"props":6241,"children":6243},{"className":6242},[],[6244],{"type":48,"value":6245},"DateTimeField",{"type":48,"value":6247}," field on the ",{"type":42,"tag":349,"props":6249,"children":6251},{"className":6250},[],[6252],{"type":48,"value":5724},{"type":48,"value":6254}," that tracks the ",{"type":42,"tag":349,"props":6256,"children":6258},{"className":6257},[],[6259],{"type":48,"value":5740},{"type":48,"value":6261}," which is included in the webhook data object. The model field in my code is called ",{"type":42,"tag":349,"props":6263,"children":6265},{"className":6264},[],[6266],{"type":48,"value":6064},{"type":48,"value":1970},{"type":42,"tag":280,"props":6269,"children":6271},{"id":6270},"iv-cancelling-a-premium-subscription",[6272],{"type":48,"value":6273},"IV. Cancelling a premium subscription",{"type":42,"tag":3541,"props":6275,"children":6276},{"start":1704},[6277,6290,6342,6355,6367],{"type":42,"tag":61,"props":6278,"children":6279},{},[6280,6282,6288],{"type":48,"value":6281},"When a user decides to cancel their payed subscription service, they click on the ",{"type":42,"tag":349,"props":6283,"children":6285},{"className":6284},[],[6286],{"type":48,"value":6287},"Cancel My Subscription",{"type":48,"value":6289}," button.",{"type":42,"tag":61,"props":6291,"children":6292},{},[6293,6295,6301,6303,6309,6311,6317,6319,6325,6327,6333,6335,6340],{"type":48,"value":6294},"This makes a POST request to ",{"type":42,"tag":349,"props":6296,"children":6298},{"className":6297},[],[6299],{"type":48,"value":6300},"/api/stripe/cancel-subscription",{"type":48,"value":6302}," which calls the ",{"type":42,"tag":349,"props":6304,"children":6306},{"className":6305},[],[6307],{"type":48,"value":6308},"cancel_subscription",{"type":48,"value":6310}," view. This view calls ",{"type":42,"tag":349,"props":6312,"children":6314},{"className":6313},[],[6315],{"type":48,"value":6316},"stripe.Subscription.delete(subscriptionId)",{"type":48,"value":6318},", where the ",{"type":42,"tag":349,"props":6320,"children":6322},{"className":6321},[],[6323],{"type":48,"value":6324},"subscriptionId",{"type":48,"value":6326}," is retrieved from ",{"type":42,"tag":349,"props":6328,"children":6330},{"className":6329},[],[6331],{"type":48,"value":6332},"request.user.subscription",{"type":48,"value":6334}," (the ",{"type":42,"tag":349,"props":6336,"children":6338},{"className":6337},[],[6339],{"type":48,"value":5724},{"type":48,"value":6341}," model created in the setup section).",{"type":42,"tag":61,"props":6343,"children":6344},{},[6345,6347,6353],{"type":48,"value":6346},"The subscription is deleted in Stripe through the ",{"type":42,"tag":349,"props":6348,"children":6350},{"className":6349},[],[6351],{"type":48,"value":6352},"stripe.Subscription.delete",{"type":48,"value":6354}," API call.",{"type":42,"tag":61,"props":6356,"children":6357},{},[6358,6360,6366],{"type":48,"value":6359},"The user's subscription is deleted from the user model with ",{"type":42,"tag":349,"props":6361,"children":6363},{"className":6362},[],[6364],{"type":48,"value":6365},"request.user.subscription.delete()",{"type":48,"value":1970},{"type":42,"tag":61,"props":6368,"children":6369},{},[6370,6372,6377],{"type":48,"value":6371},"The frontend responds to the deleted subscription by fetching ",{"type":42,"tag":349,"props":6373,"children":6375},{"className":6374},[],[6376],{"type":48,"value":6099},{"type":48,"value":6378}," again, refresh, or redirecting and the user no longer has access to their premium subscription.",{"title":8,"searchDepth":486,"depth":486,"links":6380},[6381,6382,6383],{"id":5544,"depth":486,"text":5547},{"id":5576,"depth":486,"text":5579},{"id":5609,"depth":486,"text":5612,"children":6384},[6385,6386,6387,6388],{"id":5620,"depth":499,"text":5623},{"id":5858,"depth":499,"text":5861},{"id":6197,"depth":499,"text":6200},{"id":6270,"depth":499,"text":6273},"content:2021:01:02:using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application.md","2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application.md","2021/01/02/using-the-stripe-api-for-recurring-monthly-saas-subscription-payments-in-django-and-vue-application",{"_path":6393,"_dir":6394,"_draft":7,"_partial":7,"_locale":8,"title":6395,"description":6396,"date":6397,"image":6398,"tags":6399,"body":6400,"_type":3490,"_id":7524,"_source":3492,"_file":7525,"_stem":7526,"_extension":3495},"/2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt","01","Session Authentication with Django, Django REST Framework and Nuxt","This article shows how to use session authentication with Django + Nuxt.js applications","2021-01-01T00:00:00.000Z","/static/django_nuxt_auth_og.png",[5369,25,3504,5522,5371],{"type":39,"children":6401,"toc":7499},[6402,6407,6412,6421,6426,6431,6436,6441,6445,6450,6455,6461,6466,6472,6477,6500,6505,6511,6516,6563,6569,6574,6579,6585,6590,6595,6600,6604,6612,6617,6635,6640,6671,6676,6701,6729,6899,6911,6974,7038,7091,7103,7167,7187,7209,7220,7398,7404,7410,7415,7421,7434,7439,7445,7450,7455,7461,7466,7472,7477,7483,7488,7494],{"type":42,"tag":51,"props":6403,"children":6404},{},[6405],{"type":48,"value":6406},"This will be a continuation of the discussion about how data flows in Django + Nuxt applications, looking specifically at session authentication.",{"type":42,"tag":51,"props":6408,"children":6409},{},[6410],{"type":48,"value":6411},"Here's a GitLab repo that where you can find the source code and other diagrams related to this project:",{"type":42,"tag":51,"props":6413,"children":6414},{},[6415],{"type":42,"tag":138,"props":6416,"children":6419},{"href":6417,"rel":6418},"https://gitlab.com/briancaffey/django-nuxt-starter",[142],[6420],{"type":48,"value":6417},{"type":42,"tag":51,"props":6422,"children":6423},{},[6424],{"type":48,"value":6425},"This diagram focuses on the interactions between:",{"type":42,"tag":51,"props":6427,"children":6428},{},[6429],{"type":48,"value":6430},"I. The browser",{"type":42,"tag":51,"props":6432,"children":6433},{},[6434],{"type":48,"value":6435},"II. The Nuxt server (Node process)",{"type":42,"tag":51,"props":6437,"children":6438},{},[6439],{"type":48,"value":6440},"III. The Django backend API server (gunicorn process)",{"type":42,"tag":112,"props":6442,"children":6443},{"id":5544},[6444],{"type":48,"value":5547},{"type":42,"tag":51,"props":6446,"children":6447},{},[6448],{"type":48,"value":6449},"For illustration purposes, I'm using a simple CRUD application that has two models: Users and (blog) Posts. Users can log in with email and password credentials and create, read, update and delete blog posts (CRUD). Currently I'm only doing the R (read) of CRUD: listing and viewing blog posts. Creating, updating and delete will be added later. For now, users must be logged in to see posts.",{"type":42,"tag":51,"props":6451,"children":6452},{},[6453],{"type":48,"value":6454},"I'm still learning a lot about Nuxt and how it can be used with Django and Django REST Framework. This project is an effort at documenting my learning process, learning in public and learning from mistakes, so any feedback or guidance on what I have written here would be highly appreciated!",{"type":42,"tag":112,"props":6456,"children":6458},{"id":6457},"why-nuxt",[6459],{"type":48,"value":6460},"Why Nuxt?",{"type":42,"tag":51,"props":6462,"children":6463},{},[6464],{"type":48,"value":6465},"Using Nuxt (with Server Side Rendering, or SSR) is one of many ways to use Vue.js with Django. Vue is a progressive framework, which means that it can be gradually adopted into a project--you don't have to go all-in on the framework or rewrite the application from scratch to fit with how Vue works.",{"type":42,"tag":280,"props":6467,"children":6469},{"id":6468},"different-ways-to-use-vue-with-django",[6470],{"type":48,"value":6471},"Different ways to use Vue with Django",{"type":42,"tag":51,"props":6473,"children":6474},{},[6475],{"type":48,"value":6476},"In terms of Django, here are some ways that you can use Vue:",{"type":42,"tag":57,"props":6478,"children":6479},{},[6480,6485,6490,6495],{"type":42,"tag":61,"props":6481,"children":6482},{},[6483],{"type":48,"value":6484},"Vue as a jQuery replacement for adding basic interactivity in views served by Django templates",{"type":42,"tag":61,"props":6486,"children":6487},{},[6488],{"type":48,"value":6489},"Build a static Vue application and serve it as a set of static assets in a Django project alongside routes that are served by other normal Django templates views.",{"type":42,"tag":61,"props":6491,"children":6492},{},[6493],{"type":48,"value":6494},"Build a Vue SPA which consumes a Django API (usually built with Django REST Framework or similar), and serve it over a content delivery network (CDN).",{"type":42,"tag":61,"props":6496,"children":6497},{},[6498],{"type":48,"value":6499},"Use Vue to build an Electron desktop app that uses Django as an API",{"type":42,"tag":51,"props":6501,"children":6502},{},[6503],{"type":48,"value":6504},"In these scenarios, Vue is served as either static assets (such as in the case of serving a SPA over a CDN), or Vue code is included in an HTML response from a server (where the view library, not your application, is served over a CDN), similar to how jQuery is used.",{"type":42,"tag":280,"props":6506,"children":6508},{"id":6507},"different-ways-to-use-nuxt",[6509],{"type":48,"value":6510},"Different ways to use Nuxt",{"type":42,"tag":51,"props":6512,"children":6513},{},[6514],{"type":48,"value":6515},"Nuxt is a Framework that can be used in a few different ways, I'll briefly discus three ways in which Nuxt can be used. Common to all three of these ways of using Nuxt is the directory structure. No matter how you use Nuxt, it provides a great way to organize Vue code.",{"type":42,"tag":3541,"props":6517,"children":6518},{},[6519,6530,6535],{"type":42,"tag":61,"props":6520,"children":6521},{},[6522,6524,6529],{"type":48,"value":6523},"Static mode: this mode allows you to write Vue code which is built into a static HTML, and then that HTML is deployed to a CDN or webserver like NGINX. The developer (or CI/CD process) runs a command to generate HTML files for each page in the application, and these pages are served as-is when accessed by a user. I recently migrated my personal blog from Jekyll to Nuxt with full-static mode. Check it out at (",{"type":42,"tag":138,"props":6525,"children":6527},{"href":3551,"rel":6526},[142],[6528],{"type":48,"value":3577},{"type":48,"value":5573},{"type":42,"tag":61,"props":6531,"children":6532},{},[6533],{"type":48,"value":6534},"SPA mode: This is similar to what you might use if you started a Vue project with Vue CLI. The project is also generated as in Static Mode, but what is generated is primarily Javascript code that is executed on the browser.",{"type":42,"tag":61,"props":6536,"children":6537},{},[6538,6540,6546,6548,6553,6555,6561],{"type":48,"value":6539},"SSR mode: Server Side Rendering is the mode that I'll be focusing on here. Unlike the other ways of using Vue that have already been discussed, this mode involves a Node.js server that will handle our requests. For example, a web request for ",{"type":42,"tag":349,"props":6541,"children":6543},{"className":6542},[],[6544],{"type":48,"value":6545},"/posts",{"type":48,"value":6547}," is sent to our Nuxt Server (a Node.js server process) and Node.js is responsible for returning HTML that contains all of the blog Posts that we want to show (or a paginated selection of all blog posts, which is how my example blog app is built). So the Nuxt app has to make a request to our Django API server before returning fully rendered HTML page for the ",{"type":42,"tag":349,"props":6549,"children":6551},{"className":6550},[],[6552],{"type":48,"value":6545},{"type":48,"value":6554}," page. The user then gets the page from Nuxt, reads all of the blog posts and then decides to check out the blog posts on the second page of posts. When the user clicks on page 2, we request the second page of data from our Django API directly, not from Nuxt. The user then sees a short loading animation followed by the second page of blog posts that are loaded in using AJAX (usually with ",{"type":42,"tag":349,"props":6556,"children":6558},{"className":6557},[],[6559],{"type":48,"value":6560},"fetch",{"type":48,"value":6562}," or axios).",{"type":42,"tag":280,"props":6564,"children":6566},{"id":6565},"nuxt-benefits",[6567],{"type":48,"value":6568},"Nuxt Benefits",{"type":42,"tag":51,"props":6570,"children":6571},{},[6572],{"type":48,"value":6573},"The main reason for using Nuxt is to render the first page loads on the server, returning a complete HTML response that can be beneficial for SEO, social sharing, and other scenarios where you need control over how a website's pages are delivered (specifically, the initial request made to the server).",{"type":42,"tag":51,"props":6575,"children":6576},{},[6577],{"type":48,"value":6578},"This type of control is not possible for applications that serve Vue over CDN since they can only request backend API data once the JS client has been requested from a CDN.",{"type":42,"tag":280,"props":6580,"children":6582},{"id":6581},"nuxt-downsides-and-tradeoffs",[6583],{"type":48,"value":6584},"Nuxt Downsides and Tradeoffs",{"type":42,"tag":51,"props":6586,"children":6587},{},[6588],{"type":48,"value":6589},"Using Nuxt for SSR introduces quite a bit of complexity in both the application deployment and our Vue code. The backend API won't have to change at all when moving to Nuxt from a static Vue SPA.",{"type":42,"tag":51,"props":6591,"children":6592},{},[6593],{"type":48,"value":6594},"Django alone is capable of returning fully generated, SEO-optimized HTML for each request, but applications built with Vue and Django templates may be difficult to work on as the project grows larger and larger. The Django/DRF + Nuxt approach may be more appropriate for projects with dedicated backend and frontend teams.",{"type":42,"tag":51,"props":6596,"children":6597},{},[6598],{"type":48,"value":6599},"One other potential downside is added latency because of the \"double request\". If the Nuxt server and the Django server are on the same machine, then this latency will probably be a non-issue.",{"type":42,"tag":112,"props":6601,"children":6602},{"id":5576},[6603],{"type":48,"value":5579},{"type":42,"tag":51,"props":6605,"children":6606},{},[6607],{"type":42,"tag":127,"props":6608,"children":6611},{"alt":6609,"src":6610},"Nuxt Django Auth","/static/django_nuxt_auth.png",[],{"type":42,"tag":51,"props":6613,"children":6614},{},[6615],{"type":48,"value":6616},"This diagram looks at session authentication with a focus on the browser, the Nuxt server and the Django server. It looks at two simple user stories, ordered from top to bottom in the diagram.",{"type":42,"tag":51,"props":6618,"children":6619},{},[6620,6622,6627,6629,6634],{"type":48,"value":6621},"I. An existing application user visits the site in a new browser, navigates to the Login page, logs in with credentials and then visits a protected page: ",{"type":42,"tag":349,"props":6623,"children":6625},{"className":6624},[],[6626],{"type":48,"value":6545},{"type":48,"value":6628},".\nII. The user closes the browser and then comes back directly to the ",{"type":42,"tag":349,"props":6630,"children":6632},{"className":6631},[],[6633],{"type":48,"value":6545},{"type":48,"value":4810},{"type":42,"tag":51,"props":6636,"children":6637},{},[6638],{"type":48,"value":6639},"These two user stories sound simple, but they touch on a lot of the features of Nuxt that make it powerful, and complicated at first (for Vue users). These include:",{"type":42,"tag":57,"props":6641,"children":6642},{},[6643,6652,6661,6666],{"type":42,"tag":61,"props":6644,"children":6645},{},[6646],{"type":42,"tag":349,"props":6647,"children":6649},{"className":6648},[],[6650],{"type":48,"value":6651},"asyncData",{"type":42,"tag":61,"props":6653,"children":6654},{},[6655],{"type":42,"tag":349,"props":6656,"children":6658},{"className":6657},[],[6659],{"type":48,"value":6660},"nuxtServerInit",{"type":42,"tag":61,"props":6662,"children":6663},{},[6664],{"type":48,"value":6665},"Vuex on the client and server",{"type":42,"tag":61,"props":6667,"children":6668},{},[6669],{"type":48,"value":6670},"Custom plugin for axios",{"type":42,"tag":51,"props":6672,"children":6673},{},[6674],{"type":48,"value":6675},"Some important parts of Nuxt that this diagram does not (yet) touch on are:",{"type":42,"tag":57,"props":6677,"children":6678},{},[6679,6684,6696],{"type":42,"tag":61,"props":6680,"children":6681},{},[6682],{"type":48,"value":6683},"Nuxt auth module (I don't know if this is relevant for my use case)",{"type":42,"tag":61,"props":6685,"children":6686},{},[6687,6689,6694],{"type":48,"value":6688},"Nuxt fetch property (different from the ",{"type":42,"tag":349,"props":6690,"children":6692},{"className":6691},[],[6693],{"type":48,"value":6560},{"type":48,"value":6695}," web API)",{"type":42,"tag":61,"props":6697,"children":6698},{},[6699],{"type":48,"value":6700},"Nuxt middleware (I'm also not sure if this would be helpful for anything I am doing in this example project)",{"type":42,"tag":280,"props":6702,"children":6704},{"id":6703},"user-story-i-a-user-tries-to-open-posts-is-redirected-to-login-logs-in-then-navigate-to-posts-and-sees-blog-posts",[6705,6707,6712,6714,6720,6722,6727],{"type":48,"value":6706},"User story I.: A user tries to open ",{"type":42,"tag":349,"props":6708,"children":6710},{"className":6709},[],[6711],{"type":48,"value":6545},{"type":48,"value":6713},", is redirected to ",{"type":42,"tag":349,"props":6715,"children":6717},{"className":6716},[],[6718],{"type":48,"value":6719},"/login",{"type":48,"value":6721},", logs in, then navigate to ",{"type":42,"tag":349,"props":6723,"children":6725},{"className":6724},[],[6726],{"type":48,"value":6545},{"type":48,"value":6728}," and sees blog posts",{"type":42,"tag":3541,"props":6730,"children":6731},{},[6732,6745,6773,6805,6824,6829,6834,6875,6880],{"type":42,"tag":61,"props":6733,"children":6734},{},[6735,6737,6743],{"type":48,"value":6736},"User navigates to ",{"type":42,"tag":349,"props":6738,"children":6740},{"className":6739},[],[6741],{"type":48,"value":6742},"http://domain.com/",{"type":48,"value":6744},". This request is handled by the Nuxt server.",{"type":42,"tag":61,"props":6746,"children":6747},{},[6748,6749,6754,6756,6763,6765,6771],{"type":48,"value":3197},{"type":42,"tag":349,"props":6750,"children":6752},{"className":6751},[],[6753],{"type":48,"value":6660},{"type":48,"value":6755}," action is called (",{"type":42,"tag":138,"props":6757,"children":6760},{"href":6758,"rel":6759},"https://nuxtjs.org/docs/2.x/directory-structure/store#the-nuxtserverinit-action",[142],[6761],{"type":48,"value":6762},"read more on nuxtServerInit",{"type":48,"value":6764},"). This is a special Vuex action that, if defined in ",{"type":42,"tag":349,"props":6766,"children":6768},{"className":6767},[],[6769],{"type":48,"value":6770},"store/index.js",{"type":48,"value":6772},", will be called once per request to the Nuxt Server (when a page is initially visited or refreshed in the browser).",{"type":42,"tag":61,"props":6774,"children":6775},{},[6776,6781,6783,6788,6790,6796,6798,6803],{"type":42,"tag":349,"props":6777,"children":6779},{"className":6778},[],[6780],{"type":48,"value":6660},{"type":48,"value":6782}," dispatches a Vuex action in the ",{"type":42,"tag":349,"props":6784,"children":6786},{"className":6785},[],[6787],{"type":48,"value":6138},{"type":48,"value":6789}," module called ",{"type":42,"tag":349,"props":6791,"children":6793},{"className":6792},[],[6794],{"type":48,"value":6795},"fetchData",{"type":48,"value":6797},". This action makes an GET request to ",{"type":42,"tag":349,"props":6799,"children":6801},{"className":6800},[],[6802],{"type":48,"value":6099},{"type":48,"value":6804}," in the Django application.",{"type":42,"tag":61,"props":6806,"children":6807},{},[6808,6810,6815,6817,6823],{"type":48,"value":6809},"An API call to ",{"type":42,"tag":349,"props":6811,"children":6813},{"className":6812},[],[6814],{"type":48,"value":6099},{"type":48,"value":6816}," is made to the Django backend directly from the Nuxt container over the docker network (",{"type":42,"tag":349,"props":6818,"children":6820},{"className":6819},[],[6821],{"type":48,"value":6822},"backend:8000",{"type":48,"value":5652},{"type":42,"tag":61,"props":6825,"children":6826},{},[6827],{"type":48,"value":6828},"If the request is made by an anonymous user (no user is logged in), a 403 response is returned to the Nuxt server and no account data is set in the Vuex store (on the server).",{"type":42,"tag":61,"props":6830,"children":6831},{},[6832],{"type":48,"value":6833},"Since the user is currently not logged in, the request returns a 403 response.",{"type":42,"tag":61,"props":6835,"children":6836},{},[6837,6843,6845,6850,6852,6858,6860,6865,6867,6873],{"type":42,"tag":349,"props":6838,"children":6840},{"className":6839},[],[6841],{"type":48,"value":6842},"authMiddleware",{"type":48,"value":6844}," (on the Nuxt server) redirects the user to ",{"type":42,"tag":349,"props":6846,"children":6848},{"className":6847},[],[6849],{"type":48,"value":6719},{"type":48,"value":6851}," based on the value of ",{"type":42,"tag":349,"props":6853,"children":6855},{"className":6854},[],[6856],{"type":48,"value":6857},"authenticated",{"type":48,"value":6859}," in the Vuex store. The Original request for ",{"type":42,"tag":349,"props":6861,"children":6863},{"className":6862},[],[6864],{"type":48,"value":6545},{"type":48,"value":6866}," returns a fully-rendered ",{"type":42,"tag":349,"props":6868,"children":6870},{"className":6869},[],[6871],{"type":48,"value":6872},"/login/",{"type":48,"value":6874}," page instead.",{"type":42,"tag":61,"props":6876,"children":6877},{},[6878],{"type":48,"value":6879},"User is now on the Login page",{"type":42,"tag":61,"props":6881,"children":6882},{},[6883,6884,6890,6892,6898],{"type":48,"value":3197},{"type":42,"tag":349,"props":6885,"children":6887},{"className":6886},[],[6888],{"type":48,"value":6889},"created",{"type":48,"value":6891}," hook for the Login page makes a GET request to ",{"type":42,"tag":349,"props":6893,"children":6895},{"className":6894},[],[6896],{"type":48,"value":6897},"/api/login-set-cookie/",{"type":48,"value":1970},{"type":42,"tag":51,"props":6900,"children":6901},{},[6902,6904,6910],{"type":48,"value":6903},"10, 11. This endpoint calls a simple view that is decorated with ",{"type":42,"tag":349,"props":6905,"children":6907},{"className":6906},[],[6908],{"type":48,"value":6909},"@ensure_csrf_token",{"type":48,"value":1970},{"type":42,"tag":3541,"props":6912,"children":6913},{"start":664},[6914,6927,6963],{"type":42,"tag":61,"props":6915,"children":6916},{},[6917,6919,6925],{"type":48,"value":6918},"When the response returns to the browser, the ",{"type":42,"tag":349,"props":6920,"children":6922},{"className":6921},[],[6923],{"type":48,"value":6924},"csrftoken",{"type":48,"value":6926}," is set in the browser.",{"type":42,"tag":61,"props":6928,"children":6929},{},[6930,6932,6938,6940,6945,6947,6953,6955,6961],{"type":48,"value":6931},"The $apiCall function is defined in ",{"type":42,"tag":349,"props":6933,"children":6935},{"className":6934},[],[6936],{"type":48,"value":6937},"plugins/axios.js",{"type":48,"value":6939},", and it adds the ",{"type":42,"tag":349,"props":6941,"children":6943},{"className":6942},[],[6944],{"type":48,"value":6924},{"type":48,"value":6946}," cookie to the ",{"type":42,"tag":349,"props":6948,"children":6950},{"className":6949},[],[6951],{"type":48,"value":6952},"X-CSRFToken",{"type":48,"value":6954}," header of API requests. This is important for POST request where the CSRF token is required. When the user fills out their email and password in the login form, the $apiCall function is called with ",{"type":42,"tag":349,"props":6956,"children":6958},{"className":6957},[],[6959],{"type":48,"value":6960},"/api/login/",{"type":48,"value":6962}," and the email/password as credentials.",{"type":42,"tag":61,"props":6964,"children":6965},{},[6966,6968,6973],{"type":48,"value":6967},"The email and password are sent as data in the POST request to ",{"type":42,"tag":349,"props":6969,"children":6971},{"className":6970},[],[6972],{"type":48,"value":6960},{"type":48,"value":1970},{"type":42,"tag":51,"props":6975,"children":6976},{},[6977,6979,6984,6986,6992,6994,7000,7001,7007,7008,7014,7016,7021,7023,7028,7030,7036],{"type":48,"value":6978},"15, 16. The ",{"type":42,"tag":349,"props":6980,"children":6982},{"className":6981},[],[6983],{"type":48,"value":6960},{"type":48,"value":6985}," URL calls the ",{"type":42,"tag":349,"props":6987,"children":6989},{"className":6988},[],[6990],{"type":48,"value":6991},"login_view",{"type":48,"value":6993}," which makes use of two functions from ",{"type":42,"tag":349,"props":6995,"children":6997},{"className":6996},[],[6998],{"type":48,"value":6999},"django.contrib.auth",{"type":48,"value":3668},{"type":42,"tag":349,"props":7002,"children":7004},{"className":7003},[],[7005],{"type":48,"value":7006},"authenticate",{"type":48,"value":2751},{"type":42,"tag":349,"props":7009,"children":7011},{"className":7010},[],[7012],{"type":48,"value":7013},"login",{"type":48,"value":7015},". ",{"type":42,"tag":349,"props":7017,"children":7019},{"className":7018},[],[7020],{"type":48,"value":7006},{"type":48,"value":7022}," gets a user from the provided email/password, and the ",{"type":42,"tag":349,"props":7024,"children":7026},{"className":7025},[],[7027],{"type":48,"value":7013},{"type":48,"value":7029}," function sets an HttpOnly ",{"type":42,"tag":349,"props":7031,"children":7033},{"className":7032},[],[7034],{"type":48,"value":7035},"sessionid",{"type":48,"value":7037}," session cookie on the response.",{"type":42,"tag":3541,"props":7039,"children":7040},{"start":1362},[7041,7060,7080],{"type":42,"tag":61,"props":7042,"children":7043},{},[7044,7046,7051,7053,7058],{"type":48,"value":7045},"The HttpOnly ",{"type":42,"tag":349,"props":7047,"children":7049},{"className":7048},[],[7050],{"type":48,"value":7035},{"type":48,"value":7052}," cookie is automatically set on the browser when the ",{"type":42,"tag":349,"props":7054,"children":7056},{"className":7055},[],[7057],{"type":48,"value":6960},{"type":48,"value":7059}," request returns successfully.",{"type":42,"tag":61,"props":7061,"children":7062},{},[7063,7065,7070,7072,7078],{"type":48,"value":7064},"When this ",{"type":42,"tag":349,"props":7066,"children":7068},{"className":7067},[],[7069],{"type":48,"value":6960},{"type":48,"value":7071}," request returns successfully, a value in the ",{"type":42,"tag":349,"props":7073,"children":7075},{"className":7074},[],[7076],{"type":48,"value":7077},"auth",{"type":48,"value":7079}," Vuex module is set to keep track of the current user's logged in state.",{"type":42,"tag":61,"props":7081,"children":7082},{},[7083,7085,7090],{"type":48,"value":7084},"Next, a GET request is made to ",{"type":42,"tag":349,"props":7086,"children":7088},{"className":7087},[],[7089],{"type":48,"value":6099},{"type":48,"value":1970},{"type":42,"tag":51,"props":7092,"children":7093},{},[7094,7096,7101],{"type":48,"value":7095},"20, 21. Since the ",{"type":42,"tag":349,"props":7097,"children":7099},{"className":7098},[],[7100],{"type":48,"value":7035},{"type":48,"value":7102}," cookie is set and sent along with the request automatically, this request will succeed.",{"type":42,"tag":3541,"props":7104,"children":7105},{"start":1449},[7106,7124,7136,7155],{"type":42,"tag":61,"props":7107,"children":7108},{},[7109,7110,7115,7117,7122],{"type":48,"value":6086},{"type":42,"tag":349,"props":7111,"children":7113},{"className":7112},[],[7114],{"type":48,"value":6099},{"type":48,"value":7116}," request returns, the user's account information is saved to the ",{"type":42,"tag":349,"props":7118,"children":7120},{"className":7119},[],[7121],{"type":48,"value":6138},{"type":48,"value":7123}," Vuex module. At this point, the client may redirect automatically to the home page, or user account page, dashboard, etc.",{"type":42,"tag":61,"props":7125,"children":7126},{},[7127,7129,7134],{"type":48,"value":7128},"Now logged in, the user navigates (again via Vue router) to ",{"type":42,"tag":349,"props":7130,"children":7132},{"className":7131},[],[7133],{"type":48,"value":6545},{"type":48,"value":7135},", a page that shows a paginated view of all blog posts.",{"type":42,"tag":61,"props":7137,"children":7138},{},[7139,7141,7146,7148,7154],{"type":48,"value":7140},"This page has an ",{"type":42,"tag":349,"props":7142,"children":7144},{"className":7143},[],[7145],{"type":48,"value":6651},{"type":48,"value":7147}," method which is called when the page component is created and it dispatches a Vuex action ",{"type":42,"tag":349,"props":7149,"children":7151},{"className":7150},[],[7152],{"type":48,"value":7153},"posts/fetchData",{"type":48,"value":1970},{"type":42,"tag":61,"props":7156,"children":7157},{},[7158,7160,7166],{"type":48,"value":7159},"This Vuex action makes a GET request to ",{"type":42,"tag":349,"props":7161,"children":7163},{"className":7162},[],[7164],{"type":48,"value":7165},"/api/posts/",{"type":48,"value":1970},{"type":42,"tag":51,"props":7168,"children":7169},{},[7170,7172,7177,7179,7185],{"type":48,"value":7171},"26, 27. ",{"type":42,"tag":349,"props":7173,"children":7175},{"className":7174},[],[7176],{"type":48,"value":7165},{"type":48,"value":7178}," uses a ",{"type":42,"tag":349,"props":7180,"children":7182},{"className":7181},[],[7183],{"type":48,"value":7184},"ModelViewSet",{"type":48,"value":7186}," and returns a paginated list of blog posts",{"type":42,"tag":3541,"props":7188,"children":7189},{"start":1575},[7190],{"type":42,"tag":61,"props":7191,"children":7192},{},[7193,7194,7199,7201,7207],{"type":48,"value":6086},{"type":42,"tag":349,"props":7195,"children":7197},{"className":7196},[],[7198],{"type":48,"value":7165},{"type":48,"value":7200}," request returns successfully, the blog post data is saved to the ",{"type":42,"tag":349,"props":7202,"children":7204},{"className":7203},[],[7205],{"type":48,"value":7206},"blog",{"type":48,"value":7208}," Vuex module.",{"type":42,"tag":280,"props":7210,"children":7212},{"id":7211},"user-story-ii-logged-in-user-opens-new-browser-window-and-revisits-posts",[7213,7215],{"type":48,"value":7214},"User story II.: Logged in user opens new browser window and revisits ",{"type":42,"tag":349,"props":7216,"children":7218},{"className":7217},[],[7219],{"type":48,"value":6545},{"type":42,"tag":3541,"props":7221,"children":7222},{"start":1624},[7223,7234,7244,7262,7294,7312,7327,7343,7369,7393],{"type":42,"tag":61,"props":7224,"children":7225},{},[7226,7228,7233],{"type":48,"value":7227},"The user closes their browser and then opens a new browser window and navigates to ",{"type":42,"tag":349,"props":7229,"children":7231},{"className":7230},[],[7232],{"type":48,"value":6545},{"type":48,"value":1970},{"type":42,"tag":61,"props":7235,"children":7236},{},[7237,7242],{"type":42,"tag":349,"props":7238,"children":7240},{"className":7239},[],[7241],{"type":48,"value":6660},{"type":48,"value":7243}," is called as usual,",{"type":42,"tag":61,"props":7245,"children":7246},{},[7247,7248,7254,7256,7261],{"type":48,"value":3197},{"type":42,"tag":349,"props":7249,"children":7251},{"className":7250},[],[7252],{"type":48,"value":7253},"user/fetchData",{"type":48,"value":7255}," action is called. This action makes a GET request to ",{"type":42,"tag":349,"props":7257,"children":7259},{"className":7258},[],[7260],{"type":48,"value":6099},{"type":48,"value":1970},{"type":42,"tag":61,"props":7263,"children":7264},{},[7265,7266,7271,7273,7278,7280,7285,7287,7292],{"type":48,"value":3197},{"type":42,"tag":349,"props":7267,"children":7269},{"className":7268},[],[7270],{"type":48,"value":6099},{"type":48,"value":7272}," request returns successfully. The ",{"type":42,"tag":349,"props":7274,"children":7276},{"className":7275},[],[7277],{"type":48,"value":7035},{"type":48,"value":7279}," cookie is passed along from the browser to the API request that is made from the Nuxt server to the backend API (",{"type":42,"tag":349,"props":7281,"children":7283},{"className":7282},[],[7284],{"type":48,"value":6099},{"type":48,"value":7286},").  User account data is then set on the Vuex ",{"type":42,"tag":349,"props":7288,"children":7290},{"className":7289},[],[7291],{"type":48,"value":6138},{"type":48,"value":7293}," module.",{"type":42,"tag":61,"props":7295,"children":7296},{},[7297,7298,7303,7305,7310],{"type":48,"value":3197},{"type":42,"tag":349,"props":7299,"children":7301},{"className":7300},[],[7302],{"type":48,"value":6651},{"type":48,"value":7304}," method for the ",{"type":42,"tag":349,"props":7306,"children":7308},{"className":7307},[],[7309],{"type":48,"value":6545},{"type":48,"value":7311}," pages is called.",{"type":42,"tag":61,"props":7313,"children":7314},{},[7315,7320,7322],{"type":42,"tag":349,"props":7316,"children":7318},{"className":7317},[],[7319],{"type":48,"value":6651},{"type":48,"value":7321}," dispatches a Vuex action ",{"type":42,"tag":349,"props":7323,"children":7325},{"className":7324},[],[7326],{"type":48,"value":7153},{"type":42,"tag":61,"props":7328,"children":7329},{},[7330,7335,7337,7342],{"type":42,"tag":349,"props":7331,"children":7333},{"className":7332},[],[7334],{"type":48,"value":7153},{"type":48,"value":7336}," makes an API request to ",{"type":42,"tag":349,"props":7338,"children":7340},{"className":7339},[],[7341],{"type":48,"value":7165},{"type":48,"value":1970},{"type":42,"tag":61,"props":7344,"children":7345},{},[7346,7347,7352,7354,7359,7361,7367],{"type":48,"value":3197},{"type":42,"tag":349,"props":7348,"children":7350},{"className":7349},[],[7351],{"type":48,"value":7165},{"type":48,"value":7353}," request is handled by a ",{"type":42,"tag":349,"props":7355,"children":7357},{"className":7356},[],[7358],{"type":48,"value":7184},{"type":48,"value":7360}," for the ",{"type":42,"tag":349,"props":7362,"children":7364},{"className":7363},[],[7365],{"type":48,"value":7366},"Post",{"type":48,"value":7368}," model that gets blog posts and then sets them to the Vuex store (on the server) when the request returns a response (to the Nuxt server).",{"type":42,"tag":61,"props":7370,"children":7371},{},[7372,7374,7379,7380,7385,7386,7391],{"type":48,"value":7373},"Once the async data fetching is compete (",{"type":42,"tag":349,"props":7375,"children":7377},{"className":7376},[],[7378],{"type":48,"value":6660},{"type":48,"value":2751},{"type":42,"tag":349,"props":7381,"children":7383},{"className":7382},[],[7384],{"type":48,"value":6651},{"type":48,"value":7360},{"type":42,"tag":349,"props":7387,"children":7389},{"className":7388},[],[7390],{"type":48,"value":6545},{"type":48,"value":7392}," page), the page HTML is rendered using the Vuex store data stored on the server. The Vuex data is sent back with the rendered HTML (I think this is how it works).",{"type":42,"tag":61,"props":7394,"children":7395},{},[7396],{"type":48,"value":7397},"Finally, the user sees the list of blog posts. The page is loaded \"at once\"; there is no waiting for data to load after loading the page initially.",{"type":42,"tag":112,"props":7399,"children":7401},{"id":7400},"discussion",[7402],{"type":48,"value":7403},"Discussion",{"type":42,"tag":280,"props":7405,"children":7407},{"id":7406},"complexity",[7408],{"type":48,"value":7409},"Complexity",{"type":42,"tag":51,"props":7411,"children":7412},{},[7413],{"type":48,"value":7414},"Is this authentication process overly complicated? When I make these diagrams, I try to make simple concept as detailed as possible, but there are a lot of distinct actions being taken in many different parts of the application and getting them all into one diagram was tricky.",{"type":42,"tag":280,"props":7416,"children":7418},{"id":7417},"httponly-session-cookies",[7419],{"type":48,"value":7420},"HttpOnly Session Cookies",{"type":42,"tag":51,"props":7422,"children":7423},{},[7424,7426,7432],{"type":48,"value":7425},"Session authentication is the officially recommended way to do authentication with Django REST Framework for clients that run in the browser. However, there seem to be lots of people using JWT with DRF and Javascript clients that run in the browser. The main argument against doing this is that the JWT must be stored in a Javascript-accessible store (localStorage or Cookies) so it can be passed with each request. Many people are also interested in trying to store JWT for authentication in HttpOnly cookies to harden client-side security. I'm very curious to know if anyone is actually doing this, and what the implementation looks like. While ",{"type":42,"tag":349,"props":7427,"children":7429},{"className":7428},[],[7430],{"type":48,"value":7431},"djangorestframework_simplejwt",{"type":48,"value":7433}," doesn't support HttpOnly, there seems to be lots of interest in doing this. I think it might be possible with a special middleware, so let me know if anyone is interested in proof-of-concept/diagram for that.",{"type":42,"tag":51,"props":7435,"children":7436},{},[7437],{"type":48,"value":7438},"Some use cases for JWT and other token authentication methods with DRF might include native mobile apps or Desktop apps. For most cases, I think session authentication with Django's built in session cookies for DRF authentication is the best option. JWTs also have no clear solution for logging out, which may be important for some security considerations. The concept of stateless authentication is interesting, but for most use cases I would argue that it is not worth doing. Let me know if anyone has thoughts on this, I'm curious to see what everyone thinks.",{"type":42,"tag":280,"props":7440,"children":7442},{"id":7441},"next-steps",[7443],{"type":48,"value":7444},"Next Steps",{"type":42,"tag":51,"props":7446,"children":7447},{},[7448],{"type":48,"value":7449},"My next steps for this project/repo are to deploy this to a production environment as soon as I have time to do so. My local setup has been working well, and I think it should work well for a simple DigitalOcean docker swarm deployment like I have done with other Django + Vue projects.",{"type":42,"tag":51,"props":7451,"children":7452},{},[7453],{"type":48,"value":7454},"I also want to add the create, update and delete functionality for posts, improve error handling with API calls, add form validation, and maybe write some tests with Jest.",{"type":42,"tag":112,"props":7456,"children":7458},{"id":7457},"questions",[7459],{"type":48,"value":7460},"Questions",{"type":42,"tag":51,"props":7462,"children":7463},{},[7464],{"type":48,"value":7465},"Here are some questions and areas that I still need to investigate.",{"type":42,"tag":280,"props":7467,"children":7469},{"id":7468},"nuxt-composition-api",[7470],{"type":48,"value":7471},"Nuxt Composition API",{"type":42,"tag":51,"props":7473,"children":7474},{},[7475],{"type":48,"value":7476},"I have seen that there is a Composition API module for Nuxt. I have only just now started looking at Composition API examples and documentation for \"vanilla\" Vue, but I have heard that the Nuxt Composition API module has some additional features specifically for use with Nuxt, so I'm curious to learn what these are.",{"type":42,"tag":280,"props":7478,"children":7480},{"id":7479},"nuxt-v3-and-vue-3",[7481],{"type":48,"value":7482},"Nuxt v3 and Vue 3",{"type":42,"tag":51,"props":7484,"children":7485},{},[7486],{"type":48,"value":7487},"Nuxt looks like it has plans to support Vue 3, so I am interested to learn more about Vue 3 as it is adopted by Vue frameworks such as Nuxt and Quasar.",{"type":42,"tag":280,"props":7489,"children":7491},{"id":7490},"nuxts-fetch-method-server-middleware-nuxt-auth-module",[7492],{"type":48,"value":7493},"Nuxt's fetch method, server middleware, Nuxt auth module",{"type":42,"tag":51,"props":7495,"children":7496},{},[7497],{"type":48,"value":7498},"I think I am using server middleware correctly, it can be improved by redirecting to the initial requested route after successful login. I'm not sure if I should use the Nuxt auth module in this application, I have read that it doesn't support HttpOnly cookie use cases, but I could be wrong.",{"title":8,"searchDepth":486,"depth":486,"links":7500},[7501,7502,7508,7514,7519],{"id":5544,"depth":486,"text":5547},{"id":6457,"depth":486,"text":6460,"children":7503},[7504,7505,7506,7507],{"id":6468,"depth":499,"text":6471},{"id":6507,"depth":499,"text":6510},{"id":6565,"depth":499,"text":6568},{"id":6581,"depth":499,"text":6584},{"id":5576,"depth":486,"text":5579,"children":7509},[7510,7512],{"id":6703,"depth":499,"text":7511},"User story I.: A user tries to open /posts, is redirected to /login, logs in, then navigate to /posts and sees blog posts",{"id":7211,"depth":499,"text":7513},"User story II.: Logged in user opens new browser window and revisits /posts",{"id":7400,"depth":486,"text":7403,"children":7515},[7516,7517,7518],{"id":7406,"depth":499,"text":7409},{"id":7417,"depth":499,"text":7420},{"id":7441,"depth":499,"text":7444},{"id":7457,"depth":486,"text":7460,"children":7520},[7521,7522,7523],{"id":7468,"depth":499,"text":7471},{"id":7479,"depth":499,"text":7482},{"id":7490,"depth":499,"text":7493},"content:2021:01:01:session-authentication-with-django-django-rest-framework-and-nuxt.md","2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt.md","2021/01/01/session-authentication-with-django-django-rest-framework-and-nuxt",{"_path":7528,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":7529,"description":7530,"date":7531,"image":7532,"tags":7533,"body":7535,"_type":3490,"_id":8127,"_source":3492,"_file":8128,"_stem":8129,"_extension":3495},"/2020/12/27/building-web-applications-with-django-drf-and-nuxt","Building web applications with Django, Django REST Framework, Nuxt.js and docker","This article documents my progress combining the Django web framework with Nuxt JS to build applications that have both great SEO and a smooth SPA user experience.","2020-12-27T00:00:00.000Z","/static/django_nuxt_app_diagram.png",[5369,25,3504,5522,7534],"docker",{"type":39,"children":7536,"toc":8120},[7537,7542,7572,7582,7587,7593,7599,7604,7631,7636,7641,7646,7658,7663,7668,7674,7709,7729,8036,8040,8045,8050,8056,8087,8092,8097,8110,8115],{"type":42,"tag":51,"props":7538,"children":7539},{},[7540],{"type":48,"value":7541},"Over the holidays between lots of big meals and many naps, I tried to tackle one more goal of mine before this year come to an end: building an application with Django and Nuxt.js.",{"type":42,"tag":51,"props":7543,"children":7544},{},[7545,7547,7553,7555,7561,7563,7570],{"type":48,"value":7546},"This year I rebuilt my personal blog (",{"type":42,"tag":138,"props":7548,"children":7551},{"href":7549,"rel":7550},"https://briancaffey.github.io/",[142],[7552],{"type":48,"value":3577},{"type":48,"value":7554},") with Nuxt.js, the ",{"type":42,"tag":349,"props":7556,"children":7558},{"className":7557},[],[7559],{"type":48,"value":7560},"@nuxt/content",{"type":48,"value":7562}," headless git-based CMS and TailwindCSS. It is statically generated with Nuxt's full-static mode and has been really enjoyable to work with. I have also learned a lot more about SEO and how Nuxt helps improve Vue applications' SEO. I have also been working a lot with Django and Vue.js applications where Django serves as an API to a Vue.js SPA. This combination of technologies works well for a lot of use cases, but it falls short in SEO. Nuxt also provides a great way to organize large Vue.js projects which I have been finding very helpful. For these reasons, combining Django and Nuxt has been something that I have wanted to try for a while, so this article will share some of my experiences in recent efforts to build with these two frameworks. I took ",{"type":42,"tag":138,"props":7564,"children":7567},{"href":7565,"rel":7566},"https://gitlab.com/briancaffey/django-nuxt-starter/-/blob/develop/STEP_BY_STEP.md",[142],[7568],{"type":48,"value":7569},"detailed notes of each step of the project setup",{"type":48,"value":7571}," starting from an empty repository, and I put together a diagram of my understanding of how data flows in the application.",{"type":42,"tag":51,"props":7573,"children":7574},{},[7575,7577],{"type":48,"value":7576},"Here's the link to the project repository that I'll be referencing: ",{"type":42,"tag":138,"props":7578,"children":7580},{"href":6417,"rel":7579},[142],[7581],{"type":48,"value":6417},{"type":42,"tag":51,"props":7583,"children":7584},{},[7585],{"type":48,"value":7586},"This article will focus on explaining the project through the diagram shown below. I added two types of labels: letters and numbers. The letters will introduce each component of the application and its role in the application as a whole. The numbers summarize how data flows through the different components in my sample blog application.",{"type":42,"tag":51,"props":7588,"children":7589},{},[7590],{"type":42,"tag":127,"props":7591,"children":7592},{"alt":5579,"src":7532},[],{"type":42,"tag":112,"props":7594,"children":7596},{"id":7595},"diagram-components",[7597],{"type":48,"value":7598},"Diagram components",{"type":42,"tag":51,"props":7600,"children":7601},{},[7602],{"type":48,"value":7603},"A. Your computer - Possibly also your development machine which is running the application in docker containers with docker-compose.",{"type":42,"tag":51,"props":7605,"children":7606},{},[7607,7609,7615,7616,7622,7623,7629],{"type":48,"value":7608},"B. NGINX - This is the \"front desk\" of the application that does a few different things. It is the first component that web requests come to. It serves as a reverse proxy which does path-based routing. It looks at the URL request and determines where to send it. For example: ",{"type":42,"tag":349,"props":7610,"children":7612},{"className":7611},[],[7613],{"type":48,"value":7614},"/api/posts/1",{"type":48,"value":935},{"type":42,"tag":349,"props":7617,"children":7619},{"className":7618},[],[7620],{"type":48,"value":7621},"/dashboard/",{"type":48,"value":935},{"type":42,"tag":349,"props":7624,"children":7626},{"className":7625},[],[7627],{"type":48,"value":7628},"/admin/",{"type":48,"value":7630}," could all be routed differently depending on the NGINX configuration file. We will look at this again in the next section. This  component, like most of the other things in the diagram, runs in a container. NGINX can also serve static files for our Django app and do TLS termination to make our application available over a secure HTTPS connection.",{"type":42,"tag":51,"props":7632,"children":7633},{},[7634],{"type":48,"value":7635},"C. Nuxt.JS server - The first \"S\" in SSR (server side rendering). It is a Node.js process that renders HTML from Vue components that we define in our Nuxt app, as well as data fetched from other servers/APIs before returning HTML back to the client.",{"type":42,"tag":51,"props":7637,"children":7638},{},[7639],{"type":48,"value":7640},"D. Django server - This runs the WSGI application with a gunicorn process in a container.",{"type":42,"tag":51,"props":7642,"children":7643},{},[7644],{"type":48,"value":7645},"E. Django REST Framework is a Django package the facilitates the creation of REST API endpoints. This is part of the Django application, it primarily takes care of data serialization (which can be thought of as translating between JSON and Python objects that represent rows of data in our Postgres database)",{"type":42,"tag":51,"props":7647,"children":7648},{},[7649,7651,7657],{"type":48,"value":7650},"F. This is the Postgres database, also a containerized service. It is on the same docker network as the Django/gunicorn application, so the Django application can connect to the Postgres database using the hostname ",{"type":42,"tag":349,"props":7652,"children":7654},{"className":7653},[],[7655],{"type":48,"value":7656},"postgres",{"type":48,"value":1970},{"type":42,"tag":51,"props":7659,"children":7660},{},[7661],{"type":48,"value":7662},"G. docker-compose is used to orchestrate the docker network, containers and volumes that make up the application.",{"type":42,"tag":51,"props":7664,"children":7665},{},[7666],{"type":48,"value":7667},"H. This box represents the docker network that allows for easy networking between services. We will come back to this the significance of this in the next section.",{"type":42,"tag":112,"props":7669,"children":7671},{"id":7670},"data-flow-in-the-application",[7672],{"type":48,"value":7673},"Data flow in the application",{"type":42,"tag":51,"props":7675,"children":7676},{},[7677,7679,7685,7687,7692,7694,7700,7702,7708],{"type":48,"value":7678},"The simple application I have built for this demonstration is a blog. There is only a list view and a detail view for simple blog post model with three fields: title, body and created date. For the list view, the frontend (Nuxt) route is ",{"type":42,"tag":349,"props":7680,"children":7682},{"className":7681},[],[7683],{"type":48,"value":7684},"/posts/",{"type":48,"value":7686}," and the backend route is ",{"type":42,"tag":349,"props":7688,"children":7690},{"className":7689},[],[7691],{"type":48,"value":7165},{"type":48,"value":7693}," for the detail view the frontend route is ",{"type":42,"tag":349,"props":7695,"children":7697},{"className":7696},[],[7698],{"type":48,"value":7699},"/posts/_id",{"type":48,"value":7701}," and the API route is ",{"type":42,"tag":349,"props":7703,"children":7705},{"className":7704},[],[7706],{"type":48,"value":7707},"/api/posts/_id/",{"type":48,"value":1970},{"type":42,"tag":51,"props":7710,"children":7711},{},[7712,7714,7720,7722,7728],{"type":48,"value":7713},"The data flow shown here will walk through what happens when a user visits ",{"type":42,"tag":349,"props":7715,"children":7717},{"className":7716},[],[7718],{"type":48,"value":7719},"http://localhost/posts/",{"type":48,"value":7721},", and then show what happens when the user clicks on one of the listed posts to see the detail view of the post (",{"type":42,"tag":349,"props":7723,"children":7725},{"className":7724},[],[7726],{"type":48,"value":7727},"http://localhost/posts/2",{"type":48,"value":5573},{"type":42,"tag":3541,"props":7730,"children":7732},{"start":7731},0,[7733,7744,7756,7777,7789,7840,7868,7887,7892,7897,7908,8000],{"type":42,"tag":61,"props":7734,"children":7735},{},[7736,7742],{"type":42,"tag":349,"props":7737,"children":7739},{"className":7738},[],[7740],{"type":48,"value":7741},"docker-compose up",{"type":48,"value":7743}," is one command that is used to start the entire application in local development. This exposes the NGINX process on port 80 of the host machine (your laptop).",{"type":42,"tag":61,"props":7745,"children":7746},{},[7747,7749,7754],{"type":48,"value":7748},"When the application is running on your machine and you navigate to ",{"type":42,"tag":349,"props":7750,"children":7752},{"className":7751},[],[7753],{"type":48,"value":7719},{"type":48,"value":7755},", the request is first handled by NGINX.",{"type":42,"tag":61,"props":7757,"children":7758},{},[7759,7761,7767,7769,7775],{"type":48,"value":7760},"As we mentioned earlier, NGINX's path-based routing sends all requests that do not start with ",{"type":42,"tag":349,"props":7762,"children":7764},{"className":7763},[],[7765],{"type":48,"value":7766},"/api/*",{"type":48,"value":7768}," or ",{"type":42,"tag":349,"props":7770,"children":7772},{"className":7771},[],[7773],{"type":48,"value":7774},"/admin/*",{"type":48,"value":7776}," to the Nuxt.js server.",{"type":42,"tag":61,"props":7778,"children":7779},{},[7780,7782,7787],{"type":48,"value":7781},"When the request gets to the Nuxt server, the Nuxt lifecycle methods start. The important one that I'm using so far is ",{"type":42,"tag":349,"props":7783,"children":7785},{"className":7784},[],[7786],{"type":48,"value":6651},{"type":48,"value":7788},". This property is used to request data that will be used in the rendering of our HTML response.",{"type":42,"tag":61,"props":7790,"children":7791},{},[7792,7794,7799,7801,7806,7808,7814,7816,7822,7824,7830,7832,7838],{"type":48,"value":7793},"Inside of ",{"type":42,"tag":349,"props":7795,"children":7797},{"className":7796},[],[7798],{"type":48,"value":6651},{"type":48,"value":7800},", the application uses axios to make a request to ",{"type":42,"tag":349,"props":7802,"children":7804},{"className":7803},[],[7805],{"type":48,"value":7165},{"type":48,"value":7807}," (for example). In ",{"type":42,"tag":349,"props":7809,"children":7811},{"className":7810},[],[7812],{"type":48,"value":7813},"nuxt.config.js",{"type":48,"value":7815},", the ",{"type":42,"tag":349,"props":7817,"children":7819},{"className":7818},[],[7820],{"type":48,"value":7821},"privateRuntimeConfig",{"type":48,"value":7823}," sets a baseUrl value for axios to ",{"type":42,"tag":349,"props":7825,"children":7827},{"className":7826},[],[7828],{"type":48,"value":7829},"http://backend:8000",{"type":48,"value":7831},". Since the Nuxt server is on the same docker network as the backend Django/gunicorn server, the Nuxt server is able to resolve ",{"type":42,"tag":349,"props":7833,"children":7835},{"className":7834},[],[7836],{"type":48,"value":7837},"http://backend",{"type":48,"value":7839}," to the address of the backend server.",{"type":42,"tag":61,"props":7841,"children":7842},{},[7843,7845,7851,7853,7859,7861,7867],{"type":48,"value":7844},"Django processes this endpoint, using the ",{"type":42,"tag":349,"props":7846,"children":7848},{"className":7847},[],[7849],{"type":48,"value":7850},"PostViewSet",{"type":48,"value":7852},", the views of which have been added to ",{"type":42,"tag":349,"props":7854,"children":7856},{"className":7855},[],[7857],{"type":48,"value":7858},"urlpatterns",{"type":48,"value":7860}," in ",{"type":42,"tag":349,"props":7862,"children":7864},{"className":7863},[],[7865],{"type":48,"value":7866},"blog/urls.py",{"type":48,"value":1970},{"type":42,"tag":61,"props":7869,"children":7870},{},[7871,7872,7877,7879,7885],{"type":48,"value":3197},{"type":42,"tag":349,"props":7873,"children":7875},{"className":7874},[],[7876],{"type":48,"value":7850},{"type":48,"value":7878}," makes a database query on the ",{"type":42,"tag":349,"props":7880,"children":7882},{"className":7881},[],[7883],{"type":48,"value":7884},"posts",{"type":48,"value":7886}," which is used to serialize the data.",{"type":42,"tag":61,"props":7888,"children":7889},{},[7890],{"type":48,"value":7891},"The Django server returns the response to the original axios call.",{"type":42,"tag":61,"props":7893,"children":7894},{},[7895],{"type":48,"value":7896},"The data returned from Django is used to render the HTML response.",{"type":42,"tag":61,"props":7898,"children":7899},{},[7900,7902,7907],{"type":48,"value":7901},"The HTML response from the Nuxt server is sent back to the browser that originally navigated to ",{"type":42,"tag":349,"props":7903,"children":7905},{"className":7904},[],[7906],{"type":48,"value":7719},{"type":48,"value":1970},{"type":42,"tag":61,"props":7909,"children":7910},{},[7911,7913,7919,7921,7927,7929,7935,7937,7943,7945,7951,7953,7958,7960,7966,7968,7974,7976,7982,7984,7990,7992,7998],{"type":48,"value":7912},"The user is presented with page that lists blog posts. Each blog posts lists to a detail view. When a blog post (let's say the post with ",{"type":42,"tag":349,"props":7914,"children":7916},{"className":7915},[],[7917],{"type":48,"value":7918},"id",{"type":48,"value":7920}," of 2) is clicked on, a request for ",{"type":42,"tag":349,"props":7922,"children":7924},{"className":7923},[],[7925],{"type":48,"value":7926},"/posts/2/",{"type":48,"value":7928}," is made directly to the Django backend. The ",{"type":42,"tag":349,"props":7930,"children":7932},{"className":7931},[],[7933],{"type":48,"value":7934},"browserBaseURL",{"type":48,"value":7936}," value in the ",{"type":42,"tag":349,"props":7938,"children":7940},{"className":7939},[],[7941],{"type":48,"value":7942},"axios",{"type":48,"value":7944}," settings under ",{"type":42,"tag":349,"props":7946,"children":7948},{"className":7947},[],[7949],{"type":48,"value":7950},"publicRuntimeConfig",{"type":48,"value":7952}," defined in ",{"type":42,"tag":349,"props":7954,"children":7956},{"className":7955},[],[7957],{"type":48,"value":7813},{"type":48,"value":7959}," is set to ",{"type":42,"tag":349,"props":7961,"children":7963},{"className":7962},[],[7964],{"type":48,"value":7965},"http://localhost",{"type":48,"value":7967},", so the request is made to ",{"type":42,"tag":349,"props":7969,"children":7971},{"className":7970},[],[7972],{"type":48,"value":7973},"http://localhost/api/posts/2/",{"type":48,"value":7975},". To clarify, since we are making this request using axios in the browser, we can't make a request to ",{"type":42,"tag":349,"props":7977,"children":7979},{"className":7978},[],[7980],{"type":48,"value":7981},"http://backend:8000/api/posts/2/",{"type":48,"value":7983}," like we did in step 4 (",{"type":42,"tag":349,"props":7985,"children":7987},{"className":7986},[],[7988],{"type":48,"value":7989},"http://backend:8000/api/posts/",{"type":48,"value":7991},") because the browser doesn't know how to resolve the ",{"type":42,"tag":349,"props":7993,"children":7995},{"className":7994},[],[7996],{"type":48,"value":7997},"backend",{"type":48,"value":7999}," hostname.",{"type":42,"tag":61,"props":8001,"children":8002},{},[8003,8005,8010,8012,8018,8020,8026,8028,8034],{"type":48,"value":8004},"This request to ",{"type":42,"tag":349,"props":8006,"children":8008},{"className":8007},[],[8009],{"type":48,"value":7973},{"type":48,"value":8011},", like all others, first goes to NGINX which sends it to the backend since the path starts with ",{"type":42,"tag":349,"props":8013,"children":8015},{"className":8014},[],[8016],{"type":48,"value":8017},"/api/",{"type":48,"value":8019},". At this point the application functions like a regular Vue SPA making axios calls to a backend service. This is because we used ",{"type":42,"tag":349,"props":8021,"children":8023},{"className":8022},[],[8024],{"type":48,"value":8025},"\u003Cnuxt-link>",{"type":48,"value":8027}," for the posts listed in the posts list view. If we used ",{"type":42,"tag":349,"props":8029,"children":8031},{"className":8030},[],[8032],{"type":48,"value":8033},"\u003Ca>",{"type":48,"value":8035}," tags, we would go through the same process as in step 4 where the HTML is rendered on the Nuxt server and sent back to the browser all at once.",{"type":42,"tag":112,"props":8037,"children":8038},{"id":7400},[8039],{"type":48,"value":7403},{"type":42,"tag":51,"props":8041,"children":8042},{},[8043],{"type":48,"value":8044},"My main takeaway is that using Nuxt and Django together can give you good SEO and a great SPA experience at the same time. Using Django alone, or Django with traditional non SSR Vue makes this harder to do. Being a progressive framework, there are a lot of ways to use Vue with any other backend. From what I have heard, most people use Vue via CDN similar to how jQuery was and still is delivered for use in the browser.",{"type":42,"tag":51,"props":8046,"children":8047},{},[8048],{"type":48,"value":8049},"There is additional work in setting up 3 servers for a single application (Nuxt, Django and NGINX), but the tradeoff is that I am (at least I feel) very productive writing frontend logic in Vue and backend logic with DRF. I have never liked working with Django templates and I used to know a lot more about them than I do now.",{"type":42,"tag":112,"props":8051,"children":8053},{"id":8052},"spotlight-for-baserowios-awesome-open-source-django-nuxt-application",[8054],{"type":48,"value":8055},"Spotlight for baserow.io's awesome open-source Django Nuxt application",{"type":42,"tag":51,"props":8057,"children":8058},{},[8059,8061,8068,8070,8077,8079,8085],{"type":48,"value":8060},"Lastly I want to mention that there are some great resources in the ",{"type":42,"tag":138,"props":8062,"children":8065},{"href":8063,"rel":8064},"https://github.com/nuxt-community/awesome-nuxt",[142],[8066],{"type":48,"value":8067},"nuxt-community/awesome-nuxt",{"type":48,"value":8069}," GitHub repo. There's one project that really stood out to me when I searched for \"django\" projects in the README, and that project is called ",{"type":42,"tag":138,"props":8071,"children":8074},{"href":8072,"rel":8073},"https://baserow.io/",[142],[8075],{"type":48,"value":8076},"baserow.io",{"type":48,"value":8078}," (repo: ",{"type":42,"tag":138,"props":8080,"children":8083},{"href":8081,"rel":8082},"https://gitlab.com/bramw/baserow",[142],[8084],{"type":48,"value":8081},{"type":48,"value":8086},"). Please check this repo our if you are interested in Django and Nuxt. This company is building an open source no-code database, similar to Airtable which I have worked with before.",{"type":42,"tag":51,"props":8088,"children":8089},{},[8090],{"type":48,"value":8091},"Their entire product is open source and I have been very impressed with what I have seen. Please go give that project a star or consider becoming a Github sponsor if you are interested. I'm not affiliated with that project in any way, but I'll be referencing how they use Django and Nuxt to build their application.",{"type":42,"tag":112,"props":8093,"children":8094},{"id":7441},[8095],{"type":48,"value":8096},"Next steps",{"type":42,"tag":51,"props":8098,"children":8099},{},[8100,8102,8108],{"type":48,"value":8101},"There is a still a lot I have to learn about Nuxt. I'm still very new to the Framework and this is my first time using Nuxt's SSR mode. Nuxt seems to have its own way of doing lots of things that I'm used to doing in Vue. There is a very supportive community and well-maintained official packages to help with lots of things, like the ",{"type":42,"tag":349,"props":8103,"children":8105},{"className":8104},[],[8106],{"type":48,"value":8107},"@nuxt/axios",{"type":48,"value":8109}," package that I'm using.",{"type":42,"tag":51,"props":8111,"children":8112},{},[8113],{"type":48,"value":8114},"My next step is to keep expanding my blog application. One thing I didn't mention is authentication. I plan on using Django session authentication for authenticating request to Django. It seems that it already works correctly in my application (logging in through Django admin and then navigating to Nuxt routes that make Django requests are working only when I'm logged in.) I think I have an idea about how Vuex, authentication and route guards will work together, but I haven't gotten there yet. If anyone has some good reference projects or recommendations on how to expand on what I already have, please let me know!",{"type":42,"tag":51,"props":8116,"children":8117},{},[8118],{"type":48,"value":8119},"I know that Nuxt has an auth module, so I need to see if that is relevant for what I want need in my application. I also need to continue reading the Nuxt documentation. I still don't know what I don't know about Nuxt and the plugins and modules that it makes available. I also noticed that Nuxt has it's own version of the Vue 3 Composition API, something I am just now starting to learn more about, so that it another area I'll need to dig into eventually.",{"title":8,"searchDepth":486,"depth":486,"links":8121},[8122,8123,8124,8125,8126],{"id":7595,"depth":486,"text":7598},{"id":7670,"depth":486,"text":7673},{"id":7400,"depth":486,"text":7403},{"id":8052,"depth":486,"text":8055},{"id":7441,"depth":486,"text":8096},"content:2020:12:27:building-web-applications-with-django-drf-and-nuxt.md","2020/12/27/building-web-applications-with-django-drf-and-nuxt.md","2020/12/27/building-web-applications-with-django-drf-and-nuxt",{"_path":8131,"_dir":8132,"_draft":7,"_partial":7,"_locale":8,"title":8133,"description":8134,"date":8135,"image":8136,"tags":8137,"body":8142,"_type":3490,"_id":8359,"_source":3492,"_file":8360,"_stem":8361,"_extension":3495},"/2020/11/29/weekend-project-update-open-sec-data","29","Weekend project update: Open SEC Data","This project uses Django, DRF and Celery to read public SEC filings from sec.gov, build it into an API which is consumed through a Vue.js application.","2020-11-29T00:00:00.000Z","/static/sec-update.jpg",[5369,25,8138,8139,8140,7534,8141],"data","api","gitlab","celery",{"type":39,"children":8143,"toc":8357},[8144,8149,8184,8198,8203,8287,8292],{"type":42,"tag":51,"props":8145,"children":8146},{},[8147],{"type":48,"value":8148},"Here's an early look at a project I have been working on to practice some Django and Vue.js concepts: Open SEC Data.",{"type":42,"tag":57,"props":8150,"children":8151},{},[8152,8163,8173],{"type":42,"tag":61,"props":8153,"children":8154},{},[8155,8161],{"type":42,"tag":138,"props":8156,"children":8159},{"href":8157,"rel":8158},"https://opensecdata.ga",[142],[8160],{"type":48,"value":8157},{"type":48,"value":8162}," (project staging website, deployed to docker swarm cluster running on DigitalOcean)",{"type":42,"tag":61,"props":8164,"children":8165},{},[8166,8171],{"type":42,"tag":138,"props":8167,"children":8169},{"href":5568,"rel":8168},[142],[8170],{"type":48,"value":5568},{"type":48,"value":8172}," (main repository, requires GitLab account)",{"type":42,"tag":61,"props":8174,"children":8175},{},[8176,8182],{"type":42,"tag":138,"props":8177,"children":8180},{"href":8178,"rel":8179},"https://github.com/briancaffey/sec-filings-app",[142],[8181],{"type":48,"value":8178},{"type":48,"value":8183}," (mirror, no account required to view)",{"type":42,"tag":51,"props":8185,"children":8186},{},[8187,8189,8196],{"type":48,"value":8188},"This project uses Django, DRF and Celery to read public SEC filings from ",{"type":42,"tag":138,"props":8190,"children":8193},{"href":8191,"rel":8192},"https://www.sec.gov/Archives/edgar/full-index/",[142],[8194],{"type":48,"value":8195},"sec.gov",{"type":48,"value":8197},", build it into an API which is consumed through a Vue.js application. I'm currently focused on 13F filings which are required for large US investment funds managing over $100 million USD. There is data dating back to 1993 and it is published quarterly.",{"type":42,"tag":51,"props":8199,"children":8200},{},[8201],{"type":48,"value":8202},"Here are some of the things I'm focusing on in this project in no particular order:",{"type":42,"tag":57,"props":8204,"children":8205},{},[8206,8211,8216,8221,8226,8231,8236,8257,8277,8282],{"type":42,"tag":61,"props":8207,"children":8208},{},[8209],{"type":48,"value":8210},"Getting better at Django REST Framework. This project has been helping me apply some of the parts of DRF that I have found difficult. I'm currently using ViewSets which feels function-based views inside of class-based views. They are flexible, but I would like to add more abstraction with filtering",{"type":42,"tag":61,"props":8212,"children":8213},{},[8214],{"type":48,"value":8215},"Django admin. While this project primarily uses Django as a REST API with Django REST Framework, I have tried to take advantage of the Django admin to build out helpful views that can be used to spot check the data I'm creating. Most of my API is read-only, this makes things pretty simple.",{"type":42,"tag":61,"props":8217,"children":8218},{},[8219],{"type":48,"value":8220},"Moderately complex paginated data tables with Vue. I work with lots of paginated table data, and I think there is a better way to do abstract some of the repeated logic that I use (getting and setting current page, rows per page). I'm using Vuex, and I have heard of module factories, but I'm thinking that there will be a better way to do this when Vue 3 officially comes to Quasar Framework (Quasar is a Vue.js framework).",{"type":42,"tag":61,"props":8222,"children":8223},{},[8224],{"type":48,"value":8225},"Session authentication with DRF. There are a lot of guides showing how to use JWT and Token Authentication for DRF with Javascript frontends. The DRF recommends using Session Authentication for such use cases as a web-base Javascript client, so I hope I can promote some best practices around how to use Django's built-in session authentication for use with the Django REST Framework using an HttpOnly session cookie. I also understand that all security decisions have trade-offs, and I'm trying to understand what trade-offs come with handling authentication in this way.",{"type":42,"tag":61,"props":8227,"children":8228},{},[8229],{"type":48,"value":8230},"Social authentication. I have previously setup social authentication with Google, Facebook and GitHub using Python Social Auth. I think it is a great package, and it adds a lot of flexibility with it's concept of pipelines, but I haven't done much with these yet, so I'm hoping to dig in further and better understand how I can make better use of social authentication in my app. This app uses Linkedin 0Auth2 with a custom user model. Logging in with Linkedin account gives you the ability to request an API Token (Django REST Framework's Token) to access the public API.",{"type":42,"tag":61,"props":8232,"children":8233},{},[8234],{"type":48,"value":8235},"Automatic API documentation with OpenAPI. Swagger/OpenAPI seems like nice way to document and API, so I'm hoping to build best practices around how to document a DRF API automatically with OpenAPI and Swagger UI.",{"type":42,"tag":61,"props":8237,"children":8238},{},[8239,8241,8247,8249,8255],{"type":48,"value":8240},"CI/CD with GitLab and docker swarm. I will admit that I am huge GitLab fan. I love how flexible their CI/CD pipelines are. Being a docker fan as well, I chose to use docker swarm for this project to keep things simple and straightforward. I think one under-appreciate feature of docker is being able to set ",{"type":42,"tag":349,"props":8242,"children":8244},{"className":8243},[],[8245],{"type":48,"value":8246},"DOCKER_HOST",{"type":48,"value":8248}," to an SSH connection, such as ",{"type":42,"tag":349,"props":8250,"children":8252},{"className":8251},[],[8253],{"type":48,"value":8254},"ssh://root@123.456.789.10",{"type":48,"value":8256},". This let's you control the remote docker host without needing to SSH to it first, and it is also how I'm able to deploy and run management commands \"manually\" through the GitLab UI.",{"type":42,"tag":61,"props":8258,"children":8259},{},[8260,8262,8268,8269,8275],{"type":48,"value":8261},"Productive development environment. To start the project, you only need to run docker-compose up (after copying ",{"type":42,"tag":349,"props":8263,"children":8265},{"className":8264},[],[8266],{"type":48,"value":8267},".env.template",{"type":48,"value":6168},{"type":42,"tag":349,"props":8270,"children":8272},{"className":8271},[],[8273],{"type":48,"value":8274},".env",{"type":48,"value":8276}," in the root directory for storing sensitive data outside of git such as LinkedIn OAuth2 keys). The development environment is very similar to how this project runs in production with some additional utilities for monitoring and debugging such as pgadmin4, flower (for celery), redis commander (a GUI for viewing redis databases), Django debug toolbar (a must have for any Django project, I believe), runserver_plus with Werkzeug, and others. Also, the backend and frontend hot reload automatically with the help of webpack for Vue and watchdog for Django and Celery.",{"type":42,"tag":61,"props":8278,"children":8279},{},[8280],{"type":48,"value":8281},"Automatic TLS certificate generation with Traefik. For a simple project in docker swarm, I'm really happy with how simple it is to request TLS certificates from Let's Encrypt automatically with Traefik. There are no scripts, cron jobs or one-time setup jobs, it just seems to work out of the box if configured correctly.",{"type":42,"tag":61,"props":8283,"children":8284},{},[8285],{"type":48,"value":8286},"Testing with pytest. I have only been trying to test most of my API views so far. I really like using factory with pytest, so I use that in most of my tests.",{"type":42,"tag":51,"props":8288,"children":8289},{},[8290],{"type":48,"value":8291},"That's all I have for now. I have a long list of questions, things I want to improve, add and experiment with, here are just a few that come to mind:",{"type":42,"tag":57,"props":8293,"children":8294},{},[8295,8300,8305,8318,8323,8328,8333,8338],{"type":42,"tag":61,"props":8296,"children":8297},{},[8298],{"type":48,"value":8299},"Frontend testing. I don't have any component testing or e2d tests, so this would be good to add eventually. Since I'm using a component library and my app uses these components directly, I'm not exactly sure how much testing I should be doing.",{"type":42,"tag":61,"props":8301,"children":8302},{},[8303],{"type":48,"value":8304},"Data verification/validation. There are a lot of site that do provide similar data, WhaleWisdom is the biggest one that I know of. Once I get more data built on the site it would be good to spot check some of the values. There are some nuances to the filing data that I haven't addressed, such as Amendment filings and additions.",{"type":42,"tag":61,"props":8306,"children":8307},{},[8308,8310,8317],{"type":48,"value":8309},"Calculating period changes. One of the features that I'm not sure how best to implement is the ability to sort holdings for a filer in a given period on the percent increase from the last period. One way would be to add these as additional fields to the Holding model and then calculate these values as I process the data in celery. If I process the data from recent periods to later periods, I will have to update these values once the previous period has been processed, so it would be an additional check to do. I'll probably post this question here in more detail later. Here's ",{"type":42,"tag":138,"props":8311,"children":8314},{"href":8312,"rel":8313},"https://whalewisdom.com/filer/ubs-ag#tabholdings_tab_link",[142],[8315],{"type":48,"value":8316},"an example of what this means from WhaleWisdom",{"type":48,"value":1970},{"type":42,"tag":61,"props":8319,"children":8320},{},[8321],{"type":48,"value":8322},"Accessing LinkedIn profile data to populate fields on my CustomUser model.",{"type":42,"tag":61,"props":8324,"children":8325},{},[8326],{"type":48,"value":8327},"Scaling? I have a lot more experience with deploying projects to AWS which is built around the ability to scale. I don't know a project on DigitalOcean would be scaled automatically. A single node docker swarm cluster while take some time to process all of the data. I would probably be better of scaling vertically with much bigger droplets and higher celery concurrency.",{"type":42,"tag":61,"props":8329,"children":8330},{},[8331],{"type":48,"value":8332},"Docker swarm secrets. I'm currently using environment variables to pass secrets stored in GitLab CI when I build images and deploy to docker swarm. I would like to learn how to properly use swarm secrets and work them into my CI/CD pipeline.",{"type":42,"tag":61,"props":8334,"children":8335},{},[8336],{"type":48,"value":8337},"As I mentioned above, I'm also interested in updating this project to Vue3 and to apply some of its new features to this project.",{"type":42,"tag":61,"props":8339,"children":8340},{},[8341,8343,8348,8350,8356],{"type":48,"value":8342},"Use pipenv, poetry or some other way of pinning secondary python dependencies. Does anyone have a recommendation on how best to do this with docker. I have always thought that docker ",{"type":42,"tag":5456,"props":8344,"children":8345},{},[8346],{"type":48,"value":8347},"is",{"type":48,"value":8349}," the virtual environment, but I realize that some versions of indirect dependencies may change when pip installing without using a lockfile similar to ",{"type":42,"tag":349,"props":8351,"children":8353},{"className":8352},[],[8354],{"type":48,"value":8355},"package-lock.json",{"type":48,"value":1970},{"title":8,"searchDepth":486,"depth":486,"links":8358},[],"content:2020:11:29:weekend-project-update-open-sec-data.md","2020/11/29/weekend-project-update-open-sec-data.md","2020/11/29/weekend-project-update-open-sec-data",{"_path":8363,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":8364,"description":8365,"layout":8366,"date":8367,"comments":37,"image":8368,"tags":8369,"body":8370,"_type":3490,"_id":9074,"_source":3492,"_file":9075,"_stem":9076,"_extension":3495},"/2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies","How to authenticate Django REST Framework API calls from a (Vue) JS client using Session Authentication and HttpOnly cookies","This article will describe an authentication strategy using Django REST Framework with a Javascript frontend application. I'll be demonstrating this with Vue.js (Qusar Framework, using Vue 2), but the concepts should transfer to any other Javascript framework.","post","2020-11-27T00:00:00.000Z","/static/padlocks.jpg",[5369,25,5371,8139],{"type":39,"children":8371,"toc":9068},[8372,8376,8388,8415,8429,8434,8442,8469,8475,8480,8954,8958,8963,8968,8973,8978,8983,8987,8992,9015,9021],{"type":42,"tag":51,"props":8373,"children":8374},{},[8375],{"type":48,"value":8365},{"type":42,"tag":51,"props":8377,"children":8378},{},[8379,8381,8387],{"type":48,"value":8380},"Here's a GitLab repository for a project that I will be referencing throughout this article: ",{"type":42,"tag":138,"props":8382,"children":8385},{"href":8383,"rel":8384},"https://gitlab.com/verbose-equals-true/django-postgres-vue-gitlab-ecs",[142],[8386],{"type":48,"value":8383},{"type":48,"value":1970},{"type":42,"tag":51,"props":8389,"children":8390},{},[8391,8393,8400,8402,8413],{"type":48,"value":8392},"When I first started learning about how to do authentication from a Vue client, I found ",{"type":42,"tag":138,"props":8394,"children":8397},{"href":8395,"rel":8396},"https://blog.sqreen.com/authentication-best-practices-vue/",[142],[8398],{"type":48,"value":8399},"this article from Sqreen",{"type":48,"value":8401}," which describes how to use JWT to authenticate a Vue application. The example uses a mocked backend, but it is a good proxy for what you would have if you were to use a library like ",{"type":42,"tag":138,"props":8403,"children":8406},{"href":8404,"rel":8405},"https://github.com/SimpleJWT/django-rest-framework-simplejwt",[142],[8407],{"type":42,"tag":349,"props":8408,"children":8410},{"className":8409},[],[8411],{"type":48,"value":8412},"django-rest-framework-simplejwt",{"type":48,"value":8414},", which I have previously used with success in Django projects.",{"type":42,"tag":51,"props":8416,"children":8417},{},[8418,8420,8427],{"type":48,"value":8419},"JWT is an option for doing authentication with DRF ",{"type":42,"tag":138,"props":8421,"children":8424},{"href":8422,"rel":8423},"https://www.django-rest-framework.org/api-guide/authentication/#json-web-token-authentication",[142],[8425],{"type":48,"value":8426},"listed in the authentication documentation",{"type":48,"value":8428},", but the documentation doesn't recommend when or how to use JWT authentication.",{"type":42,"tag":51,"props":8430,"children":8431},{},[8432],{"type":48,"value":8433},"Session authentication is mentioned as well:",{"type":42,"tag":723,"props":8435,"children":8436},{},[8437],{"type":42,"tag":51,"props":8438,"children":8439},{},[8440],{"type":48,"value":8441},"This authentication scheme uses Django's default session backend for authentication. Session authentication is appropriate for AJAX clients that are running in the same session context as your website.",{"type":42,"tag":51,"props":8443,"children":8444},{},[8445,8447,8452,8454,8460,8461,8467],{"type":48,"value":8446},"In my project, both in local development and in production environments, I serve the API and the Javascript clients on the same domain. ",{"type":42,"tag":349,"props":8448,"children":8450},{"className":8449},[],[8451],{"type":48,"value":7766},{"type":48,"value":8453}," requests go to the API, and all other request paths route to the frontend client. In other scenarios such as using ",{"type":42,"tag":349,"props":8455,"children":8457},{"className":8456},[],[8458],{"type":48,"value":8459},"https://mysite.com",{"type":48,"value":2751},{"type":42,"tag":349,"props":8462,"children":8464},{"className":8463},[],[8465],{"type":48,"value":8466},"https://api.mysite.com",{"type":48,"value":8468}," for hosting a frontend and API an different subdomains, there would need to be additional considerations for CORS, but since I have the frontend and the backend being served on the same domain (and same subdomain), this isn't a concern. You might need to watch out for this if your requirements are different.",{"type":42,"tag":112,"props":8470,"children":8472},{"id":8471},"the-authentication-flow",[8473],{"type":48,"value":8474},"The authentication flow",{"type":42,"tag":51,"props":8476,"children":8477},{},[8478],{"type":48,"value":8479},"Now let's describe the login process at a high level.",{"type":42,"tag":3541,"props":8481,"children":8482},{},[8483,8496,8515,8551,8592,8648,8703,8767,8781,8825,8851,8887],{"type":42,"tag":61,"props":8484,"children":8485},{},[8486,8488,8494],{"type":48,"value":8487},"A user navigates to your site. There is currently nothing in the browser's ",{"type":42,"tag":349,"props":8489,"children":8491},{"className":8490},[],[8492],{"type":48,"value":8493},"localStorage",{"type":48,"value":8495}," or cookies related to authentication.",{"type":42,"tag":61,"props":8497,"children":8498},{},[8499,8501,8507,8509,8514],{"type":48,"value":8500},"The user navigates to the ",{"type":42,"tag":349,"props":8502,"children":8504},{"className":8503},[],[8505],{"type":48,"value":8506},"Login",{"type":48,"value":8508}," page at ",{"type":42,"tag":349,"props":8510,"children":8512},{"className":8511},[],[8513],{"type":48,"value":6719},{"type":48,"value":1970},{"type":42,"tag":61,"props":8516,"children":8517},{},[8518,8520,8526,8528,8533,8535,8541,8543,8549],{"type":48,"value":8519},"Loading this Vue component makes a ",{"type":42,"tag":349,"props":8521,"children":8523},{"className":8522},[],[8524],{"type":48,"value":8525},"GET",{"type":48,"value":8527}," request to a special endpoint in our Django backend ",{"type":42,"tag":349,"props":8529,"children":8531},{"className":8530},[],[8532],{"type":48,"value":6897},{"type":48,"value":8534},". This request returns a simple JSON message: ",{"type":42,"tag":349,"props":8536,"children":8538},{"className":8537},[],[8539],{"type":48,"value":8540},"\"CSRF cookie set\"",{"type":48,"value":8542},", and as the message says, the response sets a ",{"type":42,"tag":349,"props":8544,"children":8546},{"className":8545},[],[8547],{"type":48,"value":8548},"csrf",{"type":48,"value":8550}," cookie on our browser.",{"type":42,"tag":61,"props":8552,"children":8553},{},[8554,8556,8561,8563,8569,8571,8576,8578,8583,8585,8590],{"type":48,"value":8555},"Once the CSRF cookie is set by the response from ",{"type":42,"tag":349,"props":8557,"children":8559},{"className":8558},[],[8560],{"type":48,"value":6897},{"type":48,"value":8562},", the user is presented with a login form and enters account credentials (email and password in my example, where email is the ",{"type":42,"tag":349,"props":8564,"children":8566},{"className":8565},[],[8567],{"type":48,"value":8568},"USERNAME_FIELD",{"type":48,"value":8570}," on my custom user model). Clicking \"Login\" dispatches a Vuex action that uses Axios to send a send a request to ",{"type":42,"tag":349,"props":8572,"children":8574},{"className":8573},[],[8575],{"type":48,"value":6960},{"type":48,"value":8577}," with the ",{"type":42,"tag":349,"props":8579,"children":8581},{"className":8580},[],[8582],{"type":48,"value":8548},{"type":48,"value":8584}," cookie set in a ",{"type":42,"tag":349,"props":8586,"children":8588},{"className":8587},[],[8589],{"type":48,"value":6952},{"type":48,"value":8591}," header.",{"type":42,"tag":61,"props":8593,"children":8594},{},[8595,8600,8602,8607,8609,8614,8615,8620,8621,8626,8627,8632,8634,8639,8641,8646],{"type":42,"tag":349,"props":8596,"children":8598},{"className":8597},[],[8599],{"type":48,"value":6960},{"type":48,"value":8601}," is handled by the ",{"type":42,"tag":349,"props":8603,"children":8605},{"className":8604},[],[8606],{"type":48,"value":6991},{"type":48,"value":8608}," view which uses two important functions from ",{"type":42,"tag":349,"props":8610,"children":8612},{"className":8611},[],[8613],{"type":48,"value":6999},{"type":48,"value":3668},{"type":42,"tag":349,"props":8616,"children":8618},{"className":8617},[],[8619],{"type":48,"value":7006},{"type":48,"value":2751},{"type":42,"tag":349,"props":8622,"children":8624},{"className":8623},[],[8625],{"type":48,"value":7013},{"type":48,"value":7015},{"type":42,"tag":349,"props":8628,"children":8630},{"className":8629},[],[8631],{"type":48,"value":7006},{"type":48,"value":8633}," gets the user from the provided credentials, and ",{"type":42,"tag":349,"props":8635,"children":8637},{"className":8636},[],[8638],{"type":48,"value":7013},{"type":48,"value":8640}," sets a ",{"type":42,"tag":349,"props":8642,"children":8644},{"className":8643},[],[8645],{"type":48,"value":7035},{"type":48,"value":8647}," HttpOnly cookie on the response.",{"type":42,"tag":61,"props":8649,"children":8650},{},[8651,8653,8658,8660,8665,8667,8672,8673,8679,8681,8687,8689,8694,8696,8702],{"type":48,"value":8652},"When the response from ",{"type":42,"tag":349,"props":8654,"children":8656},{"className":8655},[],[8657],{"type":48,"value":6960},{"type":48,"value":8659}," comes back, two things happen: first the ",{"type":42,"tag":349,"props":8661,"children":8663},{"className":8662},[],[8664],{"type":48,"value":7035},{"type":48,"value":8666}," HttpOnly cookie is set on our browser. Second, we set a value in both Vuex and localStorage named ",{"type":42,"tag":349,"props":8668,"children":8670},{"className":8669},[],[8671],{"type":48,"value":6857},{"type":48,"value":6168},{"type":42,"tag":349,"props":8674,"children":8676},{"className":8675},[],[8677],{"type":48,"value":8678},"success",{"type":48,"value":8680},". We are not storing any sensitive information in this value. Instead, we are using this value to signal to the rest of our Vue application that the user has authenticated. Storing this in Vuex allows us to use global Vuex ",{"type":42,"tag":349,"props":8682,"children":8684},{"className":8683},[],[8685],{"type":48,"value":8686},"getters",{"type":48,"value":8688}," so that we can change component state and other logic where authentication is concerned, such as route guards (for Vue router). We store it in localStorage so that when a new browser tab is opened, we can set the value of ",{"type":42,"tag":349,"props":8690,"children":8692},{"className":8691},[],[8693],{"type":48,"value":6857},{"type":48,"value":8695}," in Vuex based on the value in localStorage. (",{"type":42,"tag":349,"props":8697,"children":8699},{"className":8698},[],[8700],{"type":48,"value":8701},"authenticated: localStorage.getItem(\"authenticated\") || \"\",",{"type":48,"value":5652},{"type":42,"tag":61,"props":8704,"children":8705},{},[8706,8708,8713,8715,8721,8723,8729,8731,8736,8738,8744,8746,8751,8753,8758,8759,8765],{"type":48,"value":8707},"Since the ",{"type":42,"tag":349,"props":8709,"children":8711},{"className":8710},[],[8712],{"type":48,"value":7035},{"type":48,"value":8714}," cookie is HttpOnly, we can't use Javascript to interact with it, so when we want to logout the user we can't just delete the cookie. To logout the user, we make a request to ",{"type":42,"tag":349,"props":8716,"children":8718},{"className":8717},[],[8719],{"type":48,"value":8720},"/api/logout/",{"type":48,"value":8722}," when the user clicks on the logout button. The view for this endpoint does ",{"type":42,"tag":349,"props":8724,"children":8726},{"className":8725},[],[8727],{"type":48,"value":8728},"logout(request)",{"type":48,"value":8730},". This returns a response with a new value for the ",{"type":42,"tag":349,"props":8732,"children":8734},{"className":8733},[],[8735],{"type":48,"value":7035},{"type":48,"value":8737}," cookie: ",{"type":42,"tag":349,"props":8739,"children":8741},{"className":8740},[],[8742],{"type":48,"value":8743},"Set-Cookie: sessionid=\"\"; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/; SameSite=Lax",{"type":48,"value":8745},". Since the cookie's expiration is in the past, it is removed entirely. We also remove the ",{"type":42,"tag":349,"props":8747,"children":8749},{"className":8748},[],[8750],{"type":48,"value":6857},{"type":48,"value":8752}," localStorage item and set the Vuex store value of ",{"type":42,"tag":349,"props":8754,"children":8756},{"className":8755},[],[8757],{"type":48,"value":6857},{"type":48,"value":6168},{"type":42,"tag":349,"props":8760,"children":8762},{"className":8761},[],[8763],{"type":48,"value":8764},"''",{"type":48,"value":8766}," (which is falsey). This lets the Vue application know that user has been logged out. One consideration for this is that your user can't logout while offline.",{"type":42,"tag":61,"props":8768,"children":8769},{},[8770,8772,8779],{"type":48,"value":8771},"This repo also implements social authentication with the fantastic Python Social Auth library. I used Facebook, Google and GitHub, but there are lots of other providers you can choose from depending on what you need. This is a lengthy topic, and I recommend that you read ",{"type":42,"tag":138,"props":8773,"children":8776},{"href":8774,"rel":8775},"https://www.toptal.com/django/integrate-oauth-2-into-django-drf-back-end",[142],[8777],{"type":48,"value":8778},"How to Integrate OAuth 2 Into Your Django/DRF Back-end Without Going Insane",{"type":48,"value":8780}," on which I have based my implementation. Here's the short story of how this works. First, a user clicks on one of the social sign-in links. These links are the same for sign-in and sign-up.",{"type":42,"tag":61,"props":8782,"children":8783},{},[8784,8786,8792,8793,8799,8801,8807,8809,8815,8817,8823],{"type":48,"value":8785},"The link has a few parts, here's an example: ",{"type":42,"tag":349,"props":8787,"children":8789},{"className":8788},[],[8790],{"type":48,"value":8791},"https://github.com/login/oauth/authorize?client_id=r66bdfgsfsbferfef4&redirect_uri=http:%2F%2Flocalhost%2Fauth%2Fgithub%2Fcallback&login=&scope=user:email&state=ewori4t95k3vdzem",{"type":48,"value":5934},{"type":42,"tag":349,"props":8794,"children":8796},{"className":8795},[],[8797],{"type":48,"value":8798},"client_id",{"type":48,"value":8800}," is the app we created to allow our users to sign in. When you create this app, you specify the ",{"type":42,"tag":349,"props":8802,"children":8804},{"className":8803},[],[8805],{"type":48,"value":8806},"redirect_uri",{"type":48,"value":8808}," in the configuration, and you reference that here as well. ",{"type":42,"tag":349,"props":8810,"children":8812},{"className":8811},[],[8813],{"type":48,"value":8814},"scope",{"type":48,"value":8816}," specifies scope of access we are requesting from the user's social account. ",{"type":42,"tag":349,"props":8818,"children":8820},{"className":8819},[],[8821],{"type":48,"value":8822},"state",{"type":48,"value":8824}," is used for security.",{"type":42,"tag":61,"props":8826,"children":8827},{},[8828,8830,8835,8836,8842,8844,8849],{"type":48,"value":8829},"When you click on the link above, you are redirected to GitHub and asked if you want to grant my GitHub application access to your account's associated email address. Clicking on \"Authorize\" then redirects you back to the ",{"type":42,"tag":349,"props":8831,"children":8833},{"className":8832},[],[8834],{"type":48,"value":8806},{"type":48,"value":3668},{"type":42,"tag":349,"props":8837,"children":8839},{"className":8838},[],[8840],{"type":48,"value":8841},"http://localhost/auth/github/callback?code=veroi3409e203ej&state=ewori4t95k3vdzem",{"type":48,"value":8843},". Notice the ",{"type":42,"tag":349,"props":8845,"children":8847},{"className":8846},[],[8848],{"type":48,"value":349},{"type":48,"value":8850}," parameter.",{"type":42,"tag":61,"props":8852,"children":8853},{},[8854,8856,8862,8864,8870,8872,8878,8880,8886],{"type":48,"value":8855},"When you navigate to ",{"type":42,"tag":349,"props":8857,"children":8859},{"className":8858},[],[8860],{"type":48,"value":8861},"/auth/github/callback",{"type":48,"value":8863}," on the Vue application, you see a message: \"Logging in with GitHub...\". On this page's ",{"type":42,"tag":349,"props":8865,"children":8867},{"className":8866},[],[8868],{"type":48,"value":8869},"mounted",{"type":48,"value":8871}," method we call ",{"type":42,"tag":349,"props":8873,"children":8875},{"className":8874},[],[8876],{"type":48,"value":8877},"handleOauthCallback",{"type":48,"value":8879}," which makes a request to our Django application: ",{"type":42,"tag":349,"props":8881,"children":8883},{"className":8882},[],[8884],{"type":48,"value":8885},"/api/social/github/?code=veroi3409e203ej",{"type":48,"value":1970},{"type":42,"tag":61,"props":8888,"children":8889},{},[8890,8892,8898,8900,8906,8908,8913,8915,8921,8923,8929,8931,8937,8939,8944,8946,8952],{"type":48,"value":8891},"This API endpoint uses the ",{"type":42,"tag":349,"props":8893,"children":8895},{"className":8894},[],[8896],{"type":48,"value":8897},"exchange_token",{"type":48,"value":8899}," view which is where Python Social Auth starts to do the heavy lifting. First, we need to make an API request to GitHub (",{"type":42,"tag":349,"props":8901,"children":8903},{"className":8902},[],[8904],{"type":48,"value":8905},"https://github.com/login/oauth/access_token",{"type":48,"value":8907},") with the ",{"type":42,"tag":349,"props":8909,"children":8911},{"className":8910},[],[8912],{"type":48,"value":349},{"type":48,"value":8914}," as a URL parameter, then we pass the access code that this API call returns into Python Social Auth's ",{"type":42,"tag":349,"props":8916,"children":8918},{"className":8917},[],[8919],{"type":48,"value":8920},"do_auth",{"type":48,"value":8922}," function to get our Django user. Finally, similar to the email/password login approach described above, we call ",{"type":42,"tag":349,"props":8924,"children":8926},{"className":8925},[],[8927],{"type":48,"value":8928},"login(request, user)",{"type":48,"value":8930}," and return a simple JSON response: ",{"type":42,"tag":349,"props":8932,"children":8934},{"className":8933},[],[8935],{"type":48,"value":8936},"{\"detail\": \"success\"}",{"type":48,"value":8938},". This will set the ",{"type":42,"tag":349,"props":8940,"children":8942},{"className":8941},[],[8943],{"type":48,"value":7035},{"type":48,"value":8945}," automatically when the response returns, and we can dispatch the same Vuex action ",{"type":42,"tag":349,"props":8947,"children":8949},{"className":8948},[],[8950],{"type":48,"value":8951},"AUTH_SUCCESS",{"type":48,"value":8953}," to tell Vuex that a user has been logged in.",{"type":42,"tag":112,"props":8955,"children":8956},{"id":7400},[8957],{"type":48,"value":7403},{"type":42,"tag":51,"props":8959,"children":8960},{},[8961],{"type":48,"value":8962},"Using the default Django session authentication mechanism has some nice advantages. It allows us to easily navigate between our Javascript SPA which uses Django REST Framework, regular Django admin views that you may also be using, as well as the Django admin.",{"type":42,"tag":51,"props":8964,"children":8965},{},[8966],{"type":48,"value":8967},"Using DRF's token authentication is still possible if you choose to use Session authentication for your JS frontend. For example, you may wish to allow users to make authenticated API requests to your public API using DRF Token Authentication.",{"type":42,"tag":51,"props":8969,"children":8970},{},[8971],{"type":48,"value":8972},"JWT is a really interesting concept and important to know about, but it doesn't seem like a practical solution for any of my use cases with Django APIs or frontends. You also can't really \"logout\" a user if you are using this solution for authentication.",{"type":42,"tag":51,"props":8974,"children":8975},{},[8976],{"type":48,"value":8977},"What I have described here is pretty simple scenario. It assumes that there is only one type of user and that there are no additional steps needed to make your account \"active\". Doing this would require additional logic on the Vue/Vuex side as well as the backend logic, including the User model. I also don't make use of any data from the social providers except for the user's email address.",{"type":42,"tag":51,"props":8979,"children":8980},{},[8981],{"type":48,"value":8982},"Another thing to be aware of with this scenario is that a user can register with social authentication first, and then reset their password and login with email (I haven't implemented this client-side on this project yet). Or, you can login with an email account that was created through the Django admin and then login with a social account tied to that email. There are a lot of options for each backend in Python social auth, making it a very flexible library for handling social authentication.",{"type":42,"tag":112,"props":8984,"children":8985},{"id":7441},[8986],{"type":48,"value":7444},{"type":42,"tag":51,"props":8988,"children":8989},{},[8990],{"type":48,"value":8991},"There is a lot more work to do on this example project regarding authentication, but I hope it can help point some people in the right direction. Here are some areas that I would like to work on next:",{"type":42,"tag":57,"props":8993,"children":8994},{},[8995,9000,9005,9010],{"type":42,"tag":61,"props":8996,"children":8997},{},[8998],{"type":48,"value":8999},"Error handling for a bad authentication attempt",{"type":42,"tag":61,"props":9001,"children":9002},{},[9003],{"type":48,"value":9004},"A signup form with email confirmation, handling cases where the user trying to signup may already have signed in with social authentication",{"type":42,"tag":61,"props":9006,"children":9007},{},[9008],{"type":48,"value":9009},"Password reset with email",{"type":42,"tag":61,"props":9011,"children":9012},{},[9013],{"type":48,"value":9014},"Making use of Python Social Auth settings and options, including pipelines.",{"type":42,"tag":112,"props":9016,"children":9018},{"id":9017},"resources",[9019],{"type":48,"value":9020},"Resources",{"type":42,"tag":57,"props":9022,"children":9023},{},[9024,9032,9041,9050,9059],{"type":42,"tag":61,"props":9025,"children":9026},{},[9027],{"type":42,"tag":138,"props":9028,"children":9030},{"href":8774,"rel":9029},[142],[9031],{"type":48,"value":8774},{"type":42,"tag":61,"props":9033,"children":9034},{},[9035],{"type":42,"tag":138,"props":9036,"children":9039},{"href":9037,"rel":9038},"https://yoongkang.com/blog/cookie-based-authentication-spa-django/",[142],[9040],{"type":48,"value":9037},{"type":42,"tag":61,"props":9042,"children":9043},{},[9044],{"type":42,"tag":138,"props":9045,"children":9048},{"href":9046,"rel":9047},"https://github.com/encode/django-rest-framework/issues/7273",[142],[9049],{"type":48,"value":9046},{"type":42,"tag":61,"props":9051,"children":9052},{},[9053],{"type":42,"tag":138,"props":9054,"children":9057},{"href":9055,"rel":9056},"https://github.com/SimpleJWT/django-rest-framework-simplejwt/issues/71",[142],[9058],{"type":48,"value":9055},{"type":42,"tag":61,"props":9060,"children":9061},{},[9062],{"type":42,"tag":138,"props":9063,"children":9066},{"href":9064,"rel":9065},"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/",[142],[9067],{"type":48,"value":9064},{"title":8,"searchDepth":486,"depth":486,"links":9069},[9070,9071,9072,9073],{"id":8471,"depth":486,"text":8474},{"id":7400,"depth":486,"text":7403},{"id":7441,"depth":486,"text":7444},{"id":9017,"depth":486,"text":9020},"content:2020:11:27:how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies.md","2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies.md","2020/11/27/how-to-authenticate-django-rest-framework-from-vue-app-with-session-authentication-httponly-cookies",{"_path":9078,"_dir":9079,"_draft":7,"_partial":7,"_locale":8,"title":9080,"description":9081,"layout":8366,"date":9082,"comments":37,"image":9083,"tags":9084,"body":9085,"_type":3490,"_id":10481,"_source":3492,"_file":10482,"_stem":10483,"_extension":3495},"/2020/10/10/how-to-add-email-signup-form-to-nuxt-site-with-mailchimp","10","How to add an email signup form to a Nuxt site with MailChimp","This is a guide for setting up a MailChimp-powered newsletter signup form on a static Nuxt site hosted on GitHub Pages. I wanted to implement this on my personal blog to grow a mailing list so I can update readers when I puslish a new blog article. I haven't done too much work with MailChimp before, but I've definitely subscribed to plenty of MailChimp mailing lists.","2020-10-11T00:00:00.000Z","/static/chimps.webp",[3504,4749,25],{"type":39,"children":9086,"toc":10472},[9087,9091,9097,9102,9120,9124,9129,9206,9211,9217,9238,9246,9251,9271,9283,9319,9332,10292,10297,10303,10315,10321,10326,10331,10340,10359,10364,10381,10393,10419,10423,10446,10450,10468],{"type":42,"tag":51,"props":9088,"children":9089},{},[9090],{"type":48,"value":9081},{"type":42,"tag":112,"props":9092,"children":9094},{"id":9093},"goals",[9095],{"type":48,"value":9096},"Goals",{"type":42,"tag":51,"props":9098,"children":9099},{},[9100],{"type":48,"value":9101},"I'm hoping to acheive some of the following:",{"type":42,"tag":57,"props":9103,"children":9104},{},[9105,9110,9115],{"type":42,"tag":61,"props":9106,"children":9107},{},[9108],{"type":48,"value":9109},"Build a list of emails from people who visit my site and want get",{"type":42,"tag":61,"props":9111,"children":9112},{},[9113],{"type":48,"value":9114},"Include a simple newletter signup form (Vue) component in the Footer of my site",{"type":42,"tag":61,"props":9116,"children":9117},{},[9118],{"type":48,"value":9119},"Send customized emails (campaigns) to a mailing list that I can track",{"type":42,"tag":112,"props":9121,"children":9122},{"id":7457},[9123],{"type":48,"value":7460},{"type":42,"tag":51,"props":9125,"children":9126},{},[9127],{"type":48,"value":9128},"Here are some of the questions (and answers) that I had going into this:",{"type":42,"tag":57,"props":9130,"children":9131},{},[9132,9144,9170,9180,9185,9196],{"type":42,"tag":61,"props":9133,"children":9134},{},[9135,9137,9143],{"type":48,"value":9136},"Do I need to use the MailChimp API or MailChimp API keys? (",{"type":42,"tag":9138,"props":9139,"children":9140},"strong",{},[9141],{"type":48,"value":9142},"No",{"type":48,"value":5652},{"type":42,"tag":61,"props":9145,"children":9146},{},[9147,9149,9154,9156,9162,9164,9169],{"type":48,"value":9148},"Is ",{"type":42,"tag":9138,"props":9150,"children":9151},{},[9152],{"type":48,"value":9153},"Double Opt-In",{"type":48,"value":9155}," possible with a static GitHub pages site hosted on a ",{"type":42,"tag":349,"props":9157,"children":9159},{"className":9158},[],[9160],{"type":48,"value":9161},"\u003Cusernme>.github.io",{"type":48,"value":9163}," subdomain? (",{"type":42,"tag":9138,"props":9165,"children":9166},{},[9167],{"type":48,"value":9168},"Yes",{"type":48,"value":5652},{"type":42,"tag":61,"props":9171,"children":9172},{},[9173,9175,9179],{"type":48,"value":9174},"What is the signup flow? Will a new subscriber be sent to a MailChimp page first, and then back to my site? (",{"type":42,"tag":9138,"props":9176,"children":9177},{},[9178],{"type":48,"value":9168},{"type":48,"value":5652},{"type":42,"tag":61,"props":9181,"children":9182},{},[9183],{"type":48,"value":9184},"How do I setup a \"Thank you\" page to show users after they subscribe?",{"type":42,"tag":61,"props":9186,"children":9187},{},[9188,9190,9195],{"type":48,"value":9189},"How much will this cost? (",{"type":42,"tag":9138,"props":9191,"children":9192},{},[9193],{"type":48,"value":9194},"Free up to 2,000 subscribers",{"type":48,"value":5652},{"type":42,"tag":61,"props":9197,"children":9198},{},[9199,9201,9205],{"type":48,"value":9200},"Should I create a new campaign for each new blog post email update I send out? (",{"type":42,"tag":9138,"props":9202,"children":9203},{},[9204],{"type":48,"value":9168},{"type":48,"value":5652},{"type":42,"tag":51,"props":9207,"children":9208},{},[9209],{"type":48,"value":9210},"I'll touch on these questions as I describe how to set things up.",{"type":42,"tag":112,"props":9212,"children":9214},{"id":9213},"creating-the-form",[9215],{"type":48,"value":9216},"Creating the form",{"type":42,"tag":51,"props":9218,"children":9219},{},[9220,9222,9228,9230,9236],{"type":48,"value":9221},"Under the ",{"type":42,"tag":349,"props":9223,"children":9225},{"className":9224},[],[9226],{"type":48,"value":9227},"Audience > Signup forms",{"type":48,"value":9229}," menu, I selected the ",{"type":42,"tag":349,"props":9231,"children":9233},{"className":9232},[],[9234],{"type":48,"value":9235},"Embedded Forms",{"type":48,"value":9237}," option:",{"type":42,"tag":401,"props":9239,"children":9241},{"code":9240},"Embedded forms\nGenerate HTML code to embed in your site or blog to collect signups.\n",[9242],{"type":42,"tag":349,"props":9243,"children":9244},{"__ignoreMap":8},[9245],{"type":48,"value":9240},{"type":42,"tag":51,"props":9247,"children":9248},{},[9249],{"type":48,"value":9250},"Most of the MailChimp Admin that I have been using seems to have 4 different menus: 2 vertical menus and 2 horizontal.",{"type":42,"tag":51,"props":9252,"children":9253},{},[9254,9255,9261,9263,9269],{"type":48,"value":9221},{"type":42,"tag":349,"props":9256,"children":9258},{"className":9257},[],[9259],{"type":48,"value":9260},"Embedded forms",{"type":48,"value":9262}," menu, I selected ",{"type":42,"tag":349,"props":9264,"children":9266},{"className":9265},[],[9267],{"type":48,"value":9268},"Unstyled",{"type":48,"value":9270}," since I want to add my own Tailwind CSS classes to keep the style of my signup form consistent with the different color schemes available on my site.",{"type":42,"tag":51,"props":9272,"children":9273},{},[9274,9276,9282],{"type":48,"value":9275},"I'll start with an Unstyled Embedded form. Let's go through the ",{"type":42,"tag":349,"props":9277,"children":9279},{"className":9278},[],[9280],{"type":48,"value":9281},"Form options",{"type":48,"value":4476},{"type":42,"tag":57,"props":9284,"children":9285},{},[9286,9296,9314],{"type":42,"tag":61,"props":9287,"children":9288},{},[9289,9294],{"type":42,"tag":9138,"props":9290,"children":9291},{},[9292],{"type":48,"value":9293},"Include form title",{"type":48,"value":9295}," (no, I'll add this myself)",{"type":42,"tag":61,"props":9297,"children":9298},{},[9299,9304,9306,9312],{"type":42,"tag":9138,"props":9300,"children":9301},{},[9302],{"type":48,"value":9303},"Show only required fields",{"type":48,"value":9305}," (For now, ",{"type":42,"tag":349,"props":9307,"children":9309},{"className":9308},[],[9310],{"type":48,"value":9311},"email",{"type":48,"value":9313}," is the only field I will be capturing. It can be helpful to include a First and/or Last name to avoid having your emails go to users' spam folders.)",{"type":42,"tag":61,"props":9315,"children":9316},{},[9317],{"type":48,"value":9318},"Unselect everything else",{"type":42,"tag":51,"props":9320,"children":9321},{},[9322,9324,9330],{"type":48,"value":9323},"Here's the HTML that we can use in our ",{"type":42,"tag":349,"props":9325,"children":9327},{"className":9326},[],[9328],{"type":48,"value":9329},"Subscribe.vue",{"type":48,"value":9331}," component:",{"type":42,"tag":401,"props":9333,"children":9337},{"code":9334,"language":9335,"meta":8,"className":9336,"style":8},"    \u003C!-- Begin Mailchimp Signup Form -->\n    \u003Cdiv id=\"mc_embed_signup\">\n      \u003Cform\n        action=\"https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6&amp;id=9937fe4fc5\"\n        method=\"post\"\n        id=\"mc-embedded-subscribe-form\"\n        name=\"mc-embedded-subscribe-form\"\n        class=\"validate\"\n        target=\"_blank\"\n        novalidate\n      >\n        \u003Cdiv id=\"mc_embed_signup_scroll\">\n          \u003Cdiv class=\"mc-field-group\">\n            \u003C!-- \u003Clabel for=\"mce-EMAIL\">Email Address \u003C/label> -->\n            \u003C!-- Added placeholder -->\n            \u003Cinput\n              type=\"email\"\n              value=\"\"\n              name=\"EMAIL\"\n              class=\"required email\"\n              id=\"mce-EMAIL\"\n              placeholder=\"Enter your email address\"\n            />\n          \u003C/div>\n          \u003Cdiv id=\"mce-responses\" class=\"clear\">\n            \u003Cdiv\n              class=\"response\"\n              id=\"mce-error-response\"\n              style=\"display: none\"\n            >\u003C/div>\n            \u003Cdiv\n              class=\"response\"\n              id=\"mce-success-response\"\n              style=\"display: none\"\n            >\u003C/div>\n          \u003C/div>\n          \u003C!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->\n          \u003Cdiv style=\"position: absolute; left: -5000px\" aria-hidden=\"true\">\n            \u003Cinput\n              type=\"text\"\n              name=\"b_43a795784ca963e25903a0da6_9937fe4fc5\"\n              tabindex=\"-1\"\n              value=\"\"\n            />\n          \u003C/div>\n          \u003Cdiv class=\"clear\">\n            \u003Cinput\n              type=\"submit\"\n              value=\"Subscribe\"\n              name=\"subscribe\"\n              id=\"mc-embedded-subscribe\"\n              class=\"button\"\n            />\n          \u003C/div>\n        \u003C/div>\n      \u003C/form>\n    \u003C/div>\n\n    \u003C!--End mc_embed_signup-->\n","html","language-html shiki shiki-themes github-light github-dark monokai",[9338],{"type":42,"tag":349,"props":9339,"children":9340},{"__ignoreMap":8},[9341,9349,9380,9393,9420,9437,9454,9470,9487,9504,9512,9520,9549,9579,9587,9595,9608,9625,9642,9659,9676,9693,9710,9718,9734,9775,9787,9803,9819,9836,9852,9863,9878,9894,9909,9924,9939,9947,9990,10001,10017,10033,10050,10065,10072,10087,10114,10125,10141,10157,10173,10189,10205,10212,10227,10243,10260,10276,10283],{"type":42,"tag":467,"props":9342,"children":9343},{"class":469,"line":470},[9344],{"type":42,"tag":467,"props":9345,"children":9346},{"style":1176},[9347],{"type":48,"value":9348},"    \u003C!-- Begin Mailchimp Signup Form -->\n",{"type":42,"tag":467,"props":9350,"children":9351},{"class":469,"line":486},[9352,9357,9361,9366,9370,9375],{"type":42,"tag":467,"props":9353,"children":9354},{"style":480},[9355],{"type":48,"value":9356},"    \u003C",{"type":42,"tag":467,"props":9358,"children":9359},{"style":3660},[9360],{"type":48,"value":301},{"type":42,"tag":467,"props":9362,"children":9363},{"style":1991},[9364],{"type":48,"value":9365}," id",{"type":42,"tag":467,"props":9367,"children":9368},{"style":480},[9369],{"type":48,"value":542},{"type":42,"tag":467,"props":9371,"children":9372},{"style":564},[9373],{"type":48,"value":9374},"\"mc_embed_signup\"",{"type":42,"tag":467,"props":9376,"children":9377},{"style":480},[9378],{"type":48,"value":9379},">\n",{"type":42,"tag":467,"props":9381,"children":9382},{"class":469,"line":499},[9383,9388],{"type":42,"tag":467,"props":9384,"children":9385},{"style":480},[9386],{"type":48,"value":9387},"      \u003C",{"type":42,"tag":467,"props":9389,"children":9390},{"style":3660},[9391],{"type":48,"value":9392},"form\n",{"type":42,"tag":467,"props":9394,"children":9395},{"class":469,"line":522},[9396,9401,9405,9410,9415],{"type":42,"tag":467,"props":9397,"children":9398},{"style":1991},[9399],{"type":48,"value":9400},"        action",{"type":42,"tag":467,"props":9402,"children":9403},{"style":480},[9404],{"type":48,"value":542},{"type":42,"tag":467,"props":9406,"children":9407},{"style":564},[9408],{"type":48,"value":9409},"\"https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6",{"type":42,"tag":467,"props":9411,"children":9412},{"style":588},[9413],{"type":48,"value":9414},"&amp;",{"type":42,"tag":467,"props":9416,"children":9417},{"style":564},[9418],{"type":48,"value":9419},"id=9937fe4fc5\"\n",{"type":42,"tag":467,"props":9421,"children":9422},{"class":469,"line":531},[9423,9428,9432],{"type":42,"tag":467,"props":9424,"children":9425},{"style":1991},[9426],{"type":48,"value":9427},"        method",{"type":42,"tag":467,"props":9429,"children":9430},{"style":480},[9431],{"type":48,"value":542},{"type":42,"tag":467,"props":9433,"children":9434},{"style":564},[9435],{"type":48,"value":9436},"\"post\"\n",{"type":42,"tag":467,"props":9438,"children":9439},{"class":469,"line":550},[9440,9445,9449],{"type":42,"tag":467,"props":9441,"children":9442},{"style":1991},[9443],{"type":48,"value":9444},"        id",{"type":42,"tag":467,"props":9446,"children":9447},{"style":480},[9448],{"type":48,"value":542},{"type":42,"tag":467,"props":9450,"children":9451},{"style":564},[9452],{"type":48,"value":9453},"\"mc-embedded-subscribe-form\"\n",{"type":42,"tag":467,"props":9455,"children":9456},{"class":469,"line":575},[9457,9462,9466],{"type":42,"tag":467,"props":9458,"children":9459},{"style":1991},[9460],{"type":48,"value":9461},"        name",{"type":42,"tag":467,"props":9463,"children":9464},{"style":480},[9465],{"type":48,"value":542},{"type":42,"tag":467,"props":9467,"children":9468},{"style":564},[9469],{"type":48,"value":9453},{"type":42,"tag":467,"props":9471,"children":9472},{"class":469,"line":598},[9473,9478,9482],{"type":42,"tag":467,"props":9474,"children":9475},{"style":1991},[9476],{"type":48,"value":9477},"        class",{"type":42,"tag":467,"props":9479,"children":9480},{"style":480},[9481],{"type":48,"value":542},{"type":42,"tag":467,"props":9483,"children":9484},{"style":564},[9485],{"type":48,"value":9486},"\"validate\"\n",{"type":42,"tag":467,"props":9488,"children":9489},{"class":469,"line":616},[9490,9495,9499],{"type":42,"tag":467,"props":9491,"children":9492},{"style":1991},[9493],{"type":48,"value":9494},"        target",{"type":42,"tag":467,"props":9496,"children":9497},{"style":480},[9498],{"type":48,"value":542},{"type":42,"tag":467,"props":9500,"children":9501},{"style":564},[9502],{"type":48,"value":9503},"\"_blank\"\n",{"type":42,"tag":467,"props":9505,"children":9506},{"class":469,"line":625},[9507],{"type":42,"tag":467,"props":9508,"children":9509},{"style":1991},[9510],{"type":48,"value":9511},"        novalidate\n",{"type":42,"tag":467,"props":9513,"children":9514},{"class":469,"line":633},[9515],{"type":42,"tag":467,"props":9516,"children":9517},{"style":480},[9518],{"type":48,"value":9519},"      >\n",{"type":42,"tag":467,"props":9521,"children":9522},{"class":469,"line":664},[9523,9528,9532,9536,9540,9545],{"type":42,"tag":467,"props":9524,"children":9525},{"style":480},[9526],{"type":48,"value":9527},"        \u003C",{"type":42,"tag":467,"props":9529,"children":9530},{"style":3660},[9531],{"type":48,"value":301},{"type":42,"tag":467,"props":9533,"children":9534},{"style":1991},[9535],{"type":48,"value":9365},{"type":42,"tag":467,"props":9537,"children":9538},{"style":480},[9539],{"type":48,"value":542},{"type":42,"tag":467,"props":9541,"children":9542},{"style":564},[9543],{"type":48,"value":9544},"\"mc_embed_signup_scroll\"",{"type":42,"tag":467,"props":9546,"children":9547},{"style":480},[9548],{"type":48,"value":9379},{"type":42,"tag":467,"props":9550,"children":9551},{"class":469,"line":672},[9552,9557,9561,9566,9570,9575],{"type":42,"tag":467,"props":9553,"children":9554},{"style":480},[9555],{"type":48,"value":9556},"          \u003C",{"type":42,"tag":467,"props":9558,"children":9559},{"style":3660},[9560],{"type":48,"value":301},{"type":42,"tag":467,"props":9562,"children":9563},{"style":1991},[9564],{"type":48,"value":9565}," class",{"type":42,"tag":467,"props":9567,"children":9568},{"style":480},[9569],{"type":48,"value":542},{"type":42,"tag":467,"props":9571,"children":9572},{"style":564},[9573],{"type":48,"value":9574},"\"mc-field-group\"",{"type":42,"tag":467,"props":9576,"children":9577},{"style":480},[9578],{"type":48,"value":9379},{"type":42,"tag":467,"props":9580,"children":9581},{"class":469,"line":690},[9582],{"type":42,"tag":467,"props":9583,"children":9584},{"style":1176},[9585],{"type":48,"value":9586},"            \u003C!-- \u003Clabel for=\"mce-EMAIL\">Email Address \u003C/label> -->\n",{"type":42,"tag":467,"props":9588,"children":9589},{"class":469,"line":1336},[9590],{"type":42,"tag":467,"props":9591,"children":9592},{"style":1176},[9593],{"type":48,"value":9594},"            \u003C!-- Added placeholder -->\n",{"type":42,"tag":467,"props":9596,"children":9597},{"class":469,"line":1344},[9598,9603],{"type":42,"tag":467,"props":9599,"children":9600},{"style":480},[9601],{"type":48,"value":9602},"            \u003C",{"type":42,"tag":467,"props":9604,"children":9605},{"style":3660},[9606],{"type":48,"value":9607},"input\n",{"type":42,"tag":467,"props":9609,"children":9610},{"class":469,"line":1362},[9611,9616,9620],{"type":42,"tag":467,"props":9612,"children":9613},{"style":1991},[9614],{"type":48,"value":9615},"              type",{"type":42,"tag":467,"props":9617,"children":9618},{"style":480},[9619],{"type":48,"value":542},{"type":42,"tag":467,"props":9621,"children":9622},{"style":564},[9623],{"type":48,"value":9624},"\"email\"\n",{"type":42,"tag":467,"props":9626,"children":9627},{"class":469,"line":1380},[9628,9633,9637],{"type":42,"tag":467,"props":9629,"children":9630},{"style":1991},[9631],{"type":48,"value":9632},"              value",{"type":42,"tag":467,"props":9634,"children":9635},{"style":480},[9636],{"type":48,"value":542},{"type":42,"tag":467,"props":9638,"children":9639},{"style":564},[9640],{"type":48,"value":9641},"\"\"\n",{"type":42,"tag":467,"props":9643,"children":9644},{"class":469,"line":1388},[9645,9650,9654],{"type":42,"tag":467,"props":9646,"children":9647},{"style":1991},[9648],{"type":48,"value":9649},"              name",{"type":42,"tag":467,"props":9651,"children":9652},{"style":480},[9653],{"type":48,"value":542},{"type":42,"tag":467,"props":9655,"children":9656},{"style":564},[9657],{"type":48,"value":9658},"\"EMAIL\"\n",{"type":42,"tag":467,"props":9660,"children":9661},{"class":469,"line":1423},[9662,9667,9671],{"type":42,"tag":467,"props":9663,"children":9664},{"style":1991},[9665],{"type":48,"value":9666},"              class",{"type":42,"tag":467,"props":9668,"children":9669},{"style":480},[9670],{"type":48,"value":542},{"type":42,"tag":467,"props":9672,"children":9673},{"style":564},[9674],{"type":48,"value":9675},"\"required email\"\n",{"type":42,"tag":467,"props":9677,"children":9678},{"class":469,"line":1441},[9679,9684,9688],{"type":42,"tag":467,"props":9680,"children":9681},{"style":1991},[9682],{"type":48,"value":9683},"              id",{"type":42,"tag":467,"props":9685,"children":9686},{"style":480},[9687],{"type":48,"value":542},{"type":42,"tag":467,"props":9689,"children":9690},{"style":564},[9691],{"type":48,"value":9692},"\"mce-EMAIL\"\n",{"type":42,"tag":467,"props":9694,"children":9695},{"class":469,"line":1449},[9696,9701,9705],{"type":42,"tag":467,"props":9697,"children":9698},{"style":1991},[9699],{"type":48,"value":9700},"              placeholder",{"type":42,"tag":467,"props":9702,"children":9703},{"style":480},[9704],{"type":48,"value":542},{"type":42,"tag":467,"props":9706,"children":9707},{"style":564},[9708],{"type":48,"value":9709},"\"Enter your email address\"\n",{"type":42,"tag":467,"props":9711,"children":9712},{"class":469,"line":1458},[9713],{"type":42,"tag":467,"props":9714,"children":9715},{"style":480},[9716],{"type":48,"value":9717},"            />\n",{"type":42,"tag":467,"props":9719,"children":9720},{"class":469,"line":1476},[9721,9726,9730],{"type":42,"tag":467,"props":9722,"children":9723},{"style":480},[9724],{"type":48,"value":9725},"          \u003C/",{"type":42,"tag":467,"props":9727,"children":9728},{"style":3660},[9729],{"type":48,"value":301},{"type":42,"tag":467,"props":9731,"children":9732},{"style":480},[9733],{"type":48,"value":9379},{"type":42,"tag":467,"props":9735,"children":9736},{"class":469,"line":1511},[9737,9741,9745,9749,9753,9758,9762,9766,9771],{"type":42,"tag":467,"props":9738,"children":9739},{"style":480},[9740],{"type":48,"value":9556},{"type":42,"tag":467,"props":9742,"children":9743},{"style":3660},[9744],{"type":48,"value":301},{"type":42,"tag":467,"props":9746,"children":9747},{"style":1991},[9748],{"type":48,"value":9365},{"type":42,"tag":467,"props":9750,"children":9751},{"style":480},[9752],{"type":48,"value":542},{"type":42,"tag":467,"props":9754,"children":9755},{"style":564},[9756],{"type":48,"value":9757},"\"mce-responses\"",{"type":42,"tag":467,"props":9759,"children":9760},{"style":1991},[9761],{"type":48,"value":9565},{"type":42,"tag":467,"props":9763,"children":9764},{"style":480},[9765],{"type":48,"value":542},{"type":42,"tag":467,"props":9767,"children":9768},{"style":564},[9769],{"type":48,"value":9770},"\"clear\"",{"type":42,"tag":467,"props":9772,"children":9773},{"style":480},[9774],{"type":48,"value":9379},{"type":42,"tag":467,"props":9776,"children":9777},{"class":469,"line":1519},[9778,9782],{"type":42,"tag":467,"props":9779,"children":9780},{"style":480},[9781],{"type":48,"value":9602},{"type":42,"tag":467,"props":9783,"children":9784},{"style":3660},[9785],{"type":48,"value":9786},"div\n",{"type":42,"tag":467,"props":9788,"children":9789},{"class":469,"line":1528},[9790,9794,9798],{"type":42,"tag":467,"props":9791,"children":9792},{"style":1991},[9793],{"type":48,"value":9666},{"type":42,"tag":467,"props":9795,"children":9796},{"style":480},[9797],{"type":48,"value":542},{"type":42,"tag":467,"props":9799,"children":9800},{"style":564},[9801],{"type":48,"value":9802},"\"response\"\n",{"type":42,"tag":467,"props":9804,"children":9805},{"class":469,"line":1575},[9806,9810,9814],{"type":42,"tag":467,"props":9807,"children":9808},{"style":1991},[9809],{"type":48,"value":9683},{"type":42,"tag":467,"props":9811,"children":9812},{"style":480},[9813],{"type":48,"value":542},{"type":42,"tag":467,"props":9815,"children":9816},{"style":564},[9817],{"type":48,"value":9818},"\"mce-error-response\"\n",{"type":42,"tag":467,"props":9820,"children":9821},{"class":469,"line":1624},[9822,9827,9831],{"type":42,"tag":467,"props":9823,"children":9824},{"style":1991},[9825],{"type":48,"value":9826},"              style",{"type":42,"tag":467,"props":9828,"children":9829},{"style":480},[9830],{"type":48,"value":542},{"type":42,"tag":467,"props":9832,"children":9833},{"style":564},[9834],{"type":48,"value":9835},"\"display: none\"\n",{"type":42,"tag":467,"props":9837,"children":9838},{"class":469,"line":1632},[9839,9844,9848],{"type":42,"tag":467,"props":9840,"children":9841},{"style":480},[9842],{"type":48,"value":9843},"            >\u003C/",{"type":42,"tag":467,"props":9845,"children":9846},{"style":3660},[9847],{"type":48,"value":301},{"type":42,"tag":467,"props":9849,"children":9850},{"style":480},[9851],{"type":48,"value":9379},{"type":42,"tag":467,"props":9853,"children":9854},{"class":469,"line":1641},[9855,9859],{"type":42,"tag":467,"props":9856,"children":9857},{"style":480},[9858],{"type":48,"value":9602},{"type":42,"tag":467,"props":9860,"children":9861},{"style":3660},[9862],{"type":48,"value":9786},{"type":42,"tag":467,"props":9864,"children":9865},{"class":469,"line":1659},[9866,9870,9874],{"type":42,"tag":467,"props":9867,"children":9868},{"style":1991},[9869],{"type":48,"value":9666},{"type":42,"tag":467,"props":9871,"children":9872},{"style":480},[9873],{"type":48,"value":542},{"type":42,"tag":467,"props":9875,"children":9876},{"style":564},[9877],{"type":48,"value":9802},{"type":42,"tag":467,"props":9879,"children":9880},{"class":469,"line":1687},[9881,9885,9889],{"type":42,"tag":467,"props":9882,"children":9883},{"style":1991},[9884],{"type":48,"value":9683},{"type":42,"tag":467,"props":9886,"children":9887},{"style":480},[9888],{"type":48,"value":542},{"type":42,"tag":467,"props":9890,"children":9891},{"style":564},[9892],{"type":48,"value":9893},"\"mce-success-response\"\n",{"type":42,"tag":467,"props":9895,"children":9896},{"class":469,"line":1695},[9897,9901,9905],{"type":42,"tag":467,"props":9898,"children":9899},{"style":1991},[9900],{"type":48,"value":9826},{"type":42,"tag":467,"props":9902,"children":9903},{"style":480},[9904],{"type":48,"value":542},{"type":42,"tag":467,"props":9906,"children":9907},{"style":564},[9908],{"type":48,"value":9835},{"type":42,"tag":467,"props":9910,"children":9911},{"class":469,"line":1704},[9912,9916,9920],{"type":42,"tag":467,"props":9913,"children":9914},{"style":480},[9915],{"type":48,"value":9843},{"type":42,"tag":467,"props":9917,"children":9918},{"style":3660},[9919],{"type":48,"value":301},{"type":42,"tag":467,"props":9921,"children":9922},{"style":480},[9923],{"type":48,"value":9379},{"type":42,"tag":467,"props":9925,"children":9926},{"class":469,"line":1763},[9927,9931,9935],{"type":42,"tag":467,"props":9928,"children":9929},{"style":480},[9930],{"type":48,"value":9725},{"type":42,"tag":467,"props":9932,"children":9933},{"style":3660},[9934],{"type":48,"value":301},{"type":42,"tag":467,"props":9936,"children":9937},{"style":480},[9938],{"type":48,"value":9379},{"type":42,"tag":467,"props":9940,"children":9941},{"class":469,"line":1771},[9942],{"type":42,"tag":467,"props":9943,"children":9944},{"style":1176},[9945],{"type":48,"value":9946},"          \u003C!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->\n",{"type":42,"tag":467,"props":9948,"children":9949},{"class":469,"line":1780},[9950,9954,9958,9963,9967,9972,9977,9981,9986],{"type":42,"tag":467,"props":9951,"children":9952},{"style":480},[9953],{"type":48,"value":9556},{"type":42,"tag":467,"props":9955,"children":9956},{"style":3660},[9957],{"type":48,"value":301},{"type":42,"tag":467,"props":9959,"children":9960},{"style":1991},[9961],{"type":48,"value":9962}," style",{"type":42,"tag":467,"props":9964,"children":9965},{"style":480},[9966],{"type":48,"value":542},{"type":42,"tag":467,"props":9968,"children":9969},{"style":564},[9970],{"type":48,"value":9971},"\"position: absolute; left: -5000px\"",{"type":42,"tag":467,"props":9973,"children":9974},{"style":1991},[9975],{"type":48,"value":9976}," aria-hidden",{"type":42,"tag":467,"props":9978,"children":9979},{"style":480},[9980],{"type":48,"value":542},{"type":42,"tag":467,"props":9982,"children":9983},{"style":564},[9984],{"type":48,"value":9985},"\"true\"",{"type":42,"tag":467,"props":9987,"children":9988},{"style":480},[9989],{"type":48,"value":9379},{"type":42,"tag":467,"props":9991,"children":9992},{"class":469,"line":1809},[9993,9997],{"type":42,"tag":467,"props":9994,"children":9995},{"style":480},[9996],{"type":48,"value":9602},{"type":42,"tag":467,"props":9998,"children":9999},{"style":3660},[10000],{"type":48,"value":9607},{"type":42,"tag":467,"props":10002,"children":10003},{"class":469,"line":1835},[10004,10008,10012],{"type":42,"tag":467,"props":10005,"children":10006},{"style":1991},[10007],{"type":48,"value":9615},{"type":42,"tag":467,"props":10009,"children":10010},{"style":480},[10011],{"type":48,"value":542},{"type":42,"tag":467,"props":10013,"children":10014},{"style":564},[10015],{"type":48,"value":10016},"\"text\"\n",{"type":42,"tag":467,"props":10018,"children":10019},{"class":469,"line":1870},[10020,10024,10028],{"type":42,"tag":467,"props":10021,"children":10022},{"style":1991},[10023],{"type":48,"value":9649},{"type":42,"tag":467,"props":10025,"children":10026},{"style":480},[10027],{"type":48,"value":542},{"type":42,"tag":467,"props":10029,"children":10030},{"style":564},[10031],{"type":48,"value":10032},"\"b_43a795784ca963e25903a0da6_9937fe4fc5\"\n",{"type":42,"tag":467,"props":10034,"children":10035},{"class":469,"line":1878},[10036,10041,10045],{"type":42,"tag":467,"props":10037,"children":10038},{"style":1991},[10039],{"type":48,"value":10040},"              tabindex",{"type":42,"tag":467,"props":10042,"children":10043},{"style":480},[10044],{"type":48,"value":542},{"type":42,"tag":467,"props":10046,"children":10047},{"style":564},[10048],{"type":48,"value":10049},"\"-1\"\n",{"type":42,"tag":467,"props":10051,"children":10052},{"class":469,"line":1905},[10053,10057,10061],{"type":42,"tag":467,"props":10054,"children":10055},{"style":1991},[10056],{"type":48,"value":9632},{"type":42,"tag":467,"props":10058,"children":10059},{"style":480},[10060],{"type":48,"value":542},{"type":42,"tag":467,"props":10062,"children":10063},{"style":564},[10064],{"type":48,"value":9641},{"type":42,"tag":467,"props":10066,"children":10067},{"class":469,"line":1927},[10068],{"type":42,"tag":467,"props":10069,"children":10070},{"style":480},[10071],{"type":48,"value":9717},{"type":42,"tag":467,"props":10073,"children":10074},{"class":469,"line":1935},[10075,10079,10083],{"type":42,"tag":467,"props":10076,"children":10077},{"style":480},[10078],{"type":48,"value":9725},{"type":42,"tag":467,"props":10080,"children":10081},{"style":3660},[10082],{"type":48,"value":301},{"type":42,"tag":467,"props":10084,"children":10085},{"style":480},[10086],{"type":48,"value":9379},{"type":42,"tag":467,"props":10088,"children":10089},{"class":469,"line":1943},[10090,10094,10098,10102,10106,10110],{"type":42,"tag":467,"props":10091,"children":10092},{"style":480},[10093],{"type":48,"value":9556},{"type":42,"tag":467,"props":10095,"children":10096},{"style":3660},[10097],{"type":48,"value":301},{"type":42,"tag":467,"props":10099,"children":10100},{"style":1991},[10101],{"type":48,"value":9565},{"type":42,"tag":467,"props":10103,"children":10104},{"style":480},[10105],{"type":48,"value":542},{"type":42,"tag":467,"props":10107,"children":10108},{"style":564},[10109],{"type":48,"value":9770},{"type":42,"tag":467,"props":10111,"children":10112},{"style":480},[10113],{"type":48,"value":9379},{"type":42,"tag":467,"props":10115,"children":10116},{"class":469,"line":1982},[10117,10121],{"type":42,"tag":467,"props":10118,"children":10119},{"style":480},[10120],{"type":48,"value":9602},{"type":42,"tag":467,"props":10122,"children":10123},{"style":3660},[10124],{"type":48,"value":9607},{"type":42,"tag":467,"props":10126,"children":10127},{"class":469,"line":2020},[10128,10132,10136],{"type":42,"tag":467,"props":10129,"children":10130},{"style":1991},[10131],{"type":48,"value":9615},{"type":42,"tag":467,"props":10133,"children":10134},{"style":480},[10135],{"type":48,"value":542},{"type":42,"tag":467,"props":10137,"children":10138},{"style":564},[10139],{"type":48,"value":10140},"\"submit\"\n",{"type":42,"tag":467,"props":10142,"children":10143},{"class":469,"line":2039},[10144,10148,10152],{"type":42,"tag":467,"props":10145,"children":10146},{"style":1991},[10147],{"type":48,"value":9632},{"type":42,"tag":467,"props":10149,"children":10150},{"style":480},[10151],{"type":48,"value":542},{"type":42,"tag":467,"props":10153,"children":10154},{"style":564},[10155],{"type":48,"value":10156},"\"Subscribe\"\n",{"type":42,"tag":467,"props":10158,"children":10159},{"class":469,"line":2053},[10160,10164,10168],{"type":42,"tag":467,"props":10161,"children":10162},{"style":1991},[10163],{"type":48,"value":9649},{"type":42,"tag":467,"props":10165,"children":10166},{"style":480},[10167],{"type":48,"value":542},{"type":42,"tag":467,"props":10169,"children":10170},{"style":564},[10171],{"type":48,"value":10172},"\"subscribe\"\n",{"type":42,"tag":467,"props":10174,"children":10175},{"class":469,"line":2077},[10176,10180,10184],{"type":42,"tag":467,"props":10177,"children":10178},{"style":1991},[10179],{"type":48,"value":9683},{"type":42,"tag":467,"props":10181,"children":10182},{"style":480},[10183],{"type":48,"value":542},{"type":42,"tag":467,"props":10185,"children":10186},{"style":564},[10187],{"type":48,"value":10188},"\"mc-embedded-subscribe\"\n",{"type":42,"tag":467,"props":10190,"children":10191},{"class":469,"line":2085},[10192,10196,10200],{"type":42,"tag":467,"props":10193,"children":10194},{"style":1991},[10195],{"type":48,"value":9666},{"type":42,"tag":467,"props":10197,"children":10198},{"style":480},[10199],{"type":48,"value":542},{"type":42,"tag":467,"props":10201,"children":10202},{"style":564},[10203],{"type":48,"value":10204},"\"button\"\n",{"type":42,"tag":467,"props":10206,"children":10207},{"class":469,"line":2093},[10208],{"type":42,"tag":467,"props":10209,"children":10210},{"style":480},[10211],{"type":48,"value":9717},{"type":42,"tag":467,"props":10213,"children":10214},{"class":469,"line":2110},[10215,10219,10223],{"type":42,"tag":467,"props":10216,"children":10217},{"style":480},[10218],{"type":48,"value":9725},{"type":42,"tag":467,"props":10220,"children":10221},{"style":3660},[10222],{"type":48,"value":301},{"type":42,"tag":467,"props":10224,"children":10225},{"style":480},[10226],{"type":48,"value":9379},{"type":42,"tag":467,"props":10228,"children":10229},{"class":469,"line":2118},[10230,10235,10239],{"type":42,"tag":467,"props":10231,"children":10232},{"style":480},[10233],{"type":48,"value":10234},"        \u003C/",{"type":42,"tag":467,"props":10236,"children":10237},{"style":3660},[10238],{"type":48,"value":301},{"type":42,"tag":467,"props":10240,"children":10241},{"style":480},[10242],{"type":48,"value":9379},{"type":42,"tag":467,"props":10244,"children":10245},{"class":469,"line":2126},[10246,10251,10256],{"type":42,"tag":467,"props":10247,"children":10248},{"style":480},[10249],{"type":48,"value":10250},"      \u003C/",{"type":42,"tag":467,"props":10252,"children":10253},{"style":3660},[10254],{"type":48,"value":10255},"form",{"type":42,"tag":467,"props":10257,"children":10258},{"style":480},[10259],{"type":48,"value":9379},{"type":42,"tag":467,"props":10261,"children":10262},{"class":469,"line":2135},[10263,10268,10272],{"type":42,"tag":467,"props":10264,"children":10265},{"style":480},[10266],{"type":48,"value":10267},"    \u003C/",{"type":42,"tag":467,"props":10269,"children":10270},{"style":3660},[10271],{"type":48,"value":301},{"type":42,"tag":467,"props":10273,"children":10274},{"style":480},[10275],{"type":48,"value":9379},{"type":42,"tag":467,"props":10277,"children":10278},{"class":469,"line":2181},[10279],{"type":42,"tag":467,"props":10280,"children":10281},{"emptyLinePlaceholder":37},[10282],{"type":48,"value":528},{"type":42,"tag":467,"props":10284,"children":10286},{"class":469,"line":10285},59,[10287],{"type":42,"tag":467,"props":10288,"children":10289},{"style":1176},[10290],{"type":48,"value":10291},"    \u003C!--End mc_embed_signup-->\n",{"type":42,"tag":51,"props":10293,"children":10294},{},[10295],{"type":48,"value":10296},"Now we can create a Vue component that contains the HTML form generated by the MailChimp admin. For now, just put the embed HTML in the template of a Vue component.",{"type":42,"tag":112,"props":10298,"children":10300},{"id":10299},"styling-the-form",[10301],{"type":48,"value":10302},"Styling the form",{"type":42,"tag":51,"props":10304,"children":10305},{},[10306,10308,10313],{"type":48,"value":10307},"Next you can add styles to the form. You can reference the ",{"type":42,"tag":349,"props":10309,"children":10311},{"className":10310},[],[10312],{"type":48,"value":9329},{"type":48,"value":10314}," file in the repo for this site to see how I have added styles using TailwindCSS.",{"type":42,"tag":112,"props":10316,"children":10318},{"id":10317},"settings",[10319],{"type":48,"value":10320},"Settings",{"type":42,"tag":51,"props":10322,"children":10323},{},[10324],{"type":48,"value":10325},"Next let's look at some settings around Double Opt-in.",{"type":42,"tag":51,"props":10327,"children":10328},{},[10329],{"type":48,"value":10330},"To navigate to the page where these settings can be set, go to:",{"type":42,"tag":51,"props":10332,"children":10333},{},[10334],{"type":42,"tag":349,"props":10335,"children":10337},{"className":10336},[],[10338],{"type":48,"value":10339},"Audience > Signup forms > Settings > Audience name and defaults",{"type":42,"tag":51,"props":10341,"children":10342},{},[10343,10345,10351,10353],{"type":48,"value":10344},"In the ",{"type":42,"tag":349,"props":10346,"children":10348},{"className":10347},[],[10349],{"type":48,"value":10350},"Form Settings",{"type":48,"value":10352}," of this menu, you can select ",{"type":42,"tag":349,"props":10354,"children":10356},{"className":10355},[],[10357],{"type":48,"value":10358},"Enable double opt-in",{"type":42,"tag":51,"props":10360,"children":10361},{},[10362],{"type":48,"value":10363},"Next, let's configure the redirect to a custom \"Thank you for subscribing page\" on our static site. Go to",{"type":42,"tag":51,"props":10365,"children":10366},{},[10367,10373,10375],{"type":42,"tag":349,"props":10368,"children":10370},{"className":10369},[],[10371],{"type":48,"value":10372},"Audience > Signup forms > Signup forms",{"type":48,"value":10374}," and select ",{"type":42,"tag":349,"props":10376,"children":10378},{"className":10377},[],[10379],{"type":48,"value":10380},"Form builder",{"type":42,"tag":51,"props":10382,"children":10383},{},[10384,10386,10391],{"type":48,"value":10385},"Select ",{"type":42,"tag":9138,"props":10387,"children":10388},{},[10389],{"type":48,"value":10390},"Signup thank you page",{"type":48,"value":10392}," from the dropdown menu and add a custom URL that you will show users when they first submit their email to the form.",{"type":42,"tag":51,"props":10394,"children":10395},{},[10396,10398,10404,10406,10411,10413],{"type":48,"value":10397},"Next, also on the ",{"type":42,"tag":349,"props":10399,"children":10401},{"className":10400},[],[10402],{"type":48,"value":10403},"Form Builder",{"type":48,"value":10405}," menu, select ",{"type":42,"tag":9138,"props":10407,"children":10408},{},[10409],{"type":48,"value":10410},"Confirmation thank you page",{"type":48,"value":10412}," from the dropdown menu and enter the URL of the page that you want to redirect to after a user confirms their subscription where it says: ",{"type":42,"tag":349,"props":10414,"children":10416},{"className":10415},[],[10417],{"type":48,"value":10418},"Instead of showing this thank you page, send subscribers to another URL",{"type":42,"tag":112,"props":10420,"children":10421},{"id":7441},[10422],{"type":48,"value":7444},{"type":42,"tag":57,"props":10424,"children":10425},{},[10426,10436,10441],{"type":42,"tag":61,"props":10427,"children":10428},{},[10429,10434],{"type":42,"tag":9138,"props":10430,"children":10431},{},[10432],{"type":48,"value":10433},"Form validation",{"type":48,"value":10435},": we can validate that the user has entered a valid email address",{"type":42,"tag":61,"props":10437,"children":10438},{},[10439],{"type":48,"value":10440},"GDPR considerations",{"type":42,"tag":61,"props":10442,"children":10443},{},[10444],{"type":48,"value":10445},"Captcha",{"type":42,"tag":112,"props":10447,"children":10448},{"id":9017},[10449],{"type":48,"value":9020},{"type":42,"tag":57,"props":10451,"children":10452},{},[10453],{"type":42,"tag":61,"props":10454,"children":10455},{},[10456,10461,10462],{"type":42,"tag":9138,"props":10457,"children":10458},{},[10459],{"type":48,"value":10460},"Single vs Double Opt-in",{"type":48,"value":3668},{"type":42,"tag":138,"props":10463,"children":10466},{"href":10464,"rel":10465},"https://www.sendinblue.com/blog/double-opt-in/",[142],[10467],{"type":48,"value":10464},{"type":42,"tag":3468,"props":10469,"children":10470},{},[10471],{"type":48,"value":3472},{"title":8,"searchDepth":486,"depth":486,"links":10473},[10474,10475,10476,10477,10478,10479,10480],{"id":9093,"depth":486,"text":9096},{"id":7457,"depth":486,"text":7460},{"id":9213,"depth":486,"text":9216},{"id":10299,"depth":486,"text":10302},{"id":10317,"depth":486,"text":10320},{"id":7441,"depth":486,"text":7444},{"id":9017,"depth":486,"text":9020},"content:2020:10:10:how-to-add-email-signup-form-to-nuxt-site-with-mailchimp.md","2020/10/10/how-to-add-email-signup-form-to-nuxt-site-with-mailchimp.md","2020/10/10/how-to-add-email-signup-form-to-nuxt-site-with-mailchimp",{"_path":10485,"_dir":10486,"_draft":7,"_partial":7,"_locale":8,"title":10487,"description":10488,"layout":8366,"date":10489,"comments":37,"image":10490,"tags":10491,"body":10494,"_type":3490,"_id":11055,"_source":3492,"_file":11056,"_stem":11057,"_extension":3495},"/2020/09/17/migrating-from-jekyll-to-nuxt-static-site","17","Migrating my personal GitHub pages blog from Jekyll to Nuxt","Jekyll has served me well for a long time, but I've decided to switch the static site generator I use for my personal blog from Jekyll to Nuxt. This article will hopefully be the first new article in my Nuxt blog.","2020-09-17T00:00:00.000Z","/static/nuxt-app.png",[3504,25,3492,10492,10493],"static-site","web",{"type":39,"children":10495,"toc":11048},[10496,10500,10505,10523,10529,10548,10783,10788,10796,10808,10815,10821,10826,10910,10916,10933,10992,10998,11030,11036,11044],{"type":42,"tag":51,"props":10497,"children":10498},{},[10499],{"type":48,"value":10488},{"type":42,"tag":51,"props":10501,"children":10502},{},[10503],{"type":48,"value":10504},"Here are some goals for what I want to do with this new site:",{"type":42,"tag":57,"props":10506,"children":10507},{},[10508,10513,10518],{"type":42,"tag":61,"props":10509,"children":10510},{},[10511],{"type":48,"value":10512},"Learn more about Nuxt and Nuxt Content, JAM Stack and static site generation",{"type":42,"tag":61,"props":10514,"children":10515},{},[10516],{"type":48,"value":10517},"Master TailwindCSS for building responsive layouts",{"type":42,"tag":61,"props":10519,"children":10520},{},[10521],{"type":48,"value":10522},"Better understand and measure SEO for my site and the content I publish on it",{"type":42,"tag":112,"props":10524,"children":10526},{"id":10525},"creating-a-nuxt-project",[10527],{"type":48,"value":10528},"Creating a nuxt project",{"type":42,"tag":51,"props":10530,"children":10531},{},[10532,10534,10540,10542,10547],{"type":48,"value":10533},"I'm going to start off with a ",{"type":42,"tag":349,"props":10535,"children":10537},{"className":10536},[],[10538],{"type":48,"value":10539},"feature-nuxt",{"type":48,"value":10541}," feature branch. Since I can't create the nuxt project in a non-empty directory, I'll create a new nuxt project in a folder called ",{"type":42,"tag":349,"props":10543,"children":10545},{"className":10544},[],[10546],{"type":48,"value":3504},{"type":48,"value":4476},{"type":42,"tag":401,"props":10549,"children":10553},{"code":10550,"language":10551,"meta":8,"className":10552,"style":8},"brian@x1:~/github/briancaffey.github.io/nuxt$ npx create-nuxt-app .\n\ncreate-nuxt-app v3.2.0\nâœ¨  Generating Nuxt.js project in .\n(node:8073) ExperimentalWarning: Conditional exports is an experimental feature. This feature could change at any time\n? Project name: brian-caffey\n? Programming language: JavaScript\n? Package manager: Yarn\n? UI framework: Tailwind CSS\n? Nuxt.js modules: Axios, Content\n? Linting tools: ESLint, Prettier\n? Testing framework: None\n? Rendering mode: Universal (SSR / SSG)\n? Deployment target: Static (Static/JAMStack hosting)\n? Development tools: jsconfig.json (Recommended for VS Code if you're not using typescript)\nyarn run v1.22.5\n$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\nDone in 1.57s.\n\nğŸ‰  Successfully created project brian-caffey\n\n  To get started:\n\n        yarn dev\n\n  To build & start for production:\n\n        yarn build\n        yarn start\n","txt","language-txt shiki shiki-themes github-light github-dark monokai",[10554],{"type":42,"tag":349,"props":10555,"children":10556},{"__ignoreMap":8},[10557,10565,10572,10580,10588,10596,10604,10612,10620,10628,10636,10644,10652,10660,10668,10676,10684,10692,10700,10707,10715,10722,10730,10737,10745,10752,10760,10767,10775],{"type":42,"tag":467,"props":10558,"children":10559},{"class":469,"line":470},[10560],{"type":42,"tag":467,"props":10561,"children":10562},{},[10563],{"type":48,"value":10564},"brian@x1:~/github/briancaffey.github.io/nuxt$ npx create-nuxt-app .\n",{"type":42,"tag":467,"props":10566,"children":10567},{"class":469,"line":486},[10568],{"type":42,"tag":467,"props":10569,"children":10570},{"emptyLinePlaceholder":37},[10571],{"type":48,"value":528},{"type":42,"tag":467,"props":10573,"children":10574},{"class":469,"line":499},[10575],{"type":42,"tag":467,"props":10576,"children":10577},{},[10578],{"type":48,"value":10579},"create-nuxt-app v3.2.0\n",{"type":42,"tag":467,"props":10581,"children":10582},{"class":469,"line":522},[10583],{"type":42,"tag":467,"props":10584,"children":10585},{},[10586],{"type":48,"value":10587},"âœ¨  Generating Nuxt.js project in .\n",{"type":42,"tag":467,"props":10589,"children":10590},{"class":469,"line":531},[10591],{"type":42,"tag":467,"props":10592,"children":10593},{},[10594],{"type":48,"value":10595},"(node:8073) ExperimentalWarning: Conditional exports is an experimental feature. This feature could change at any time\n",{"type":42,"tag":467,"props":10597,"children":10598},{"class":469,"line":550},[10599],{"type":42,"tag":467,"props":10600,"children":10601},{},[10602],{"type":48,"value":10603},"? Project name: brian-caffey\n",{"type":42,"tag":467,"props":10605,"children":10606},{"class":469,"line":575},[10607],{"type":42,"tag":467,"props":10608,"children":10609},{},[10610],{"type":48,"value":10611},"? Programming language: JavaScript\n",{"type":42,"tag":467,"props":10613,"children":10614},{"class":469,"line":598},[10615],{"type":42,"tag":467,"props":10616,"children":10617},{},[10618],{"type":48,"value":10619},"? Package manager: Yarn\n",{"type":42,"tag":467,"props":10621,"children":10622},{"class":469,"line":616},[10623],{"type":42,"tag":467,"props":10624,"children":10625},{},[10626],{"type":48,"value":10627},"? UI framework: Tailwind CSS\n",{"type":42,"tag":467,"props":10629,"children":10630},{"class":469,"line":625},[10631],{"type":42,"tag":467,"props":10632,"children":10633},{},[10634],{"type":48,"value":10635},"? Nuxt.js modules: Axios, Content\n",{"type":42,"tag":467,"props":10637,"children":10638},{"class":469,"line":633},[10639],{"type":42,"tag":467,"props":10640,"children":10641},{},[10642],{"type":48,"value":10643},"? Linting tools: ESLint, Prettier\n",{"type":42,"tag":467,"props":10645,"children":10646},{"class":469,"line":664},[10647],{"type":42,"tag":467,"props":10648,"children":10649},{},[10650],{"type":48,"value":10651},"? Testing framework: None\n",{"type":42,"tag":467,"props":10653,"children":10654},{"class":469,"line":672},[10655],{"type":42,"tag":467,"props":10656,"children":10657},{},[10658],{"type":48,"value":10659},"? Rendering mode: Universal (SSR / SSG)\n",{"type":42,"tag":467,"props":10661,"children":10662},{"class":469,"line":690},[10663],{"type":42,"tag":467,"props":10664,"children":10665},{},[10666],{"type":48,"value":10667},"? Deployment target: Static (Static/JAMStack hosting)\n",{"type":42,"tag":467,"props":10669,"children":10670},{"class":469,"line":1336},[10671],{"type":42,"tag":467,"props":10672,"children":10673},{},[10674],{"type":48,"value":10675},"? Development tools: jsconfig.json (Recommended for VS Code if you're not using typescript)\n",{"type":42,"tag":467,"props":10677,"children":10678},{"class":469,"line":1344},[10679],{"type":42,"tag":467,"props":10680,"children":10681},{},[10682],{"type":48,"value":10683},"yarn run v1.22.5\n",{"type":42,"tag":467,"props":10685,"children":10686},{"class":469,"line":1362},[10687],{"type":42,"tag":467,"props":10688,"children":10689},{},[10690],{"type":48,"value":10691},"$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\n",{"type":42,"tag":467,"props":10693,"children":10694},{"class":469,"line":1380},[10695],{"type":42,"tag":467,"props":10696,"children":10697},{},[10698],{"type":48,"value":10699},"Done in 1.57s.\n",{"type":42,"tag":467,"props":10701,"children":10702},{"class":469,"line":1388},[10703],{"type":42,"tag":467,"props":10704,"children":10705},{"emptyLinePlaceholder":37},[10706],{"type":48,"value":528},{"type":42,"tag":467,"props":10708,"children":10709},{"class":469,"line":1423},[10710],{"type":42,"tag":467,"props":10711,"children":10712},{},[10713],{"type":48,"value":10714},"ğŸ‰  Successfully created project brian-caffey\n",{"type":42,"tag":467,"props":10716,"children":10717},{"class":469,"line":1441},[10718],{"type":42,"tag":467,"props":10719,"children":10720},{"emptyLinePlaceholder":37},[10721],{"type":48,"value":528},{"type":42,"tag":467,"props":10723,"children":10724},{"class":469,"line":1449},[10725],{"type":42,"tag":467,"props":10726,"children":10727},{},[10728],{"type":48,"value":10729},"  To get started:\n",{"type":42,"tag":467,"props":10731,"children":10732},{"class":469,"line":1458},[10733],{"type":42,"tag":467,"props":10734,"children":10735},{"emptyLinePlaceholder":37},[10736],{"type":48,"value":528},{"type":42,"tag":467,"props":10738,"children":10739},{"class":469,"line":1476},[10740],{"type":42,"tag":467,"props":10741,"children":10742},{},[10743],{"type":48,"value":10744},"        yarn dev\n",{"type":42,"tag":467,"props":10746,"children":10747},{"class":469,"line":1511},[10748],{"type":42,"tag":467,"props":10749,"children":10750},{"emptyLinePlaceholder":37},[10751],{"type":48,"value":528},{"type":42,"tag":467,"props":10753,"children":10754},{"class":469,"line":1519},[10755],{"type":42,"tag":467,"props":10756,"children":10757},{},[10758],{"type":48,"value":10759},"  To build & start for production:\n",{"type":42,"tag":467,"props":10761,"children":10762},{"class":469,"line":1528},[10763],{"type":42,"tag":467,"props":10764,"children":10765},{"emptyLinePlaceholder":37},[10766],{"type":48,"value":528},{"type":42,"tag":467,"props":10768,"children":10769},{"class":469,"line":1575},[10770],{"type":42,"tag":467,"props":10771,"children":10772},{},[10773],{"type":48,"value":10774},"        yarn build\n",{"type":42,"tag":467,"props":10776,"children":10777},{"class":469,"line":1624},[10778],{"type":42,"tag":467,"props":10779,"children":10780},{},[10781],{"type":48,"value":10782},"        yarn start\n",{"type":42,"tag":51,"props":10784,"children":10785},{},[10786],{"type":48,"value":10787},"Running the following:",{"type":42,"tag":401,"props":10789,"children":10791},{"code":10790},"yarn generate\nyarn start\n",[10792],{"type":42,"tag":349,"props":10793,"children":10794},{"__ignoreMap":8},[10795],{"type":48,"value":10790},{"type":42,"tag":51,"props":10797,"children":10798},{},[10799,10801,10807],{"type":48,"value":10800},"Starts my project on ",{"type":42,"tag":349,"props":10802,"children":10804},{"className":10803},[],[10805],{"type":48,"value":10806},"localhost:3000",{"type":48,"value":4476},{"type":42,"tag":51,"props":10809,"children":10810},{},[10811],{"type":42,"tag":127,"props":10812,"children":10814},{"alt":10813,"src":10490},"Nuxt app",[],{"type":42,"tag":112,"props":10816,"children":10818},{"id":10817},"tricky-parts",[10819],{"type":48,"value":10820},"Tricky parts",{"type":42,"tag":51,"props":10822,"children":10823},{},[10824],{"type":48,"value":10825},"Here are some of the parts of migrating that I need to think about:",{"type":42,"tag":57,"props":10827,"children":10828},{},[10829,10869],{"type":42,"tag":61,"props":10830,"children":10831},{},[10832,10837,10839,10845,10847,10853,10855,10860,10862,10867],{"type":42,"tag":9138,"props":10833,"children":10834},{},[10835],{"type":48,"value":10836},"Disqus comments",{"type":48,"value":10838},": I previously based the ",{"type":42,"tag":349,"props":10840,"children":10842},{"className":10841},[],[10843],{"type":48,"value":10844},"disqus_identifier",{"type":48,"value":10846}," used to link Disqus threads to specific pages on Jekyll's page URLs (of the form ",{"type":42,"tag":349,"props":10848,"children":10850},{"className":10849},[],[10851],{"type":48,"value":10852},"/YYYY/MM/DD/name-of-article.html",{"type":48,"value":10854},"). I could transform the slug value with a hook in ",{"type":42,"tag":349,"props":10856,"children":10858},{"className":10857},[],[10859],{"type":48,"value":7813},{"type":48,"value":10861},", or manually add a ",{"type":42,"tag":349,"props":10863,"children":10865},{"className":10864},[],[10866],{"type":48,"value":10844},{"type":48,"value":10868}," value to the frontmatter of markdown files.",{"type":42,"tag":61,"props":10870,"children":10871},{},[10872,10877,10879,10885,10887,10892,10894,10900,10902,10908],{"type":42,"tag":9138,"props":10873,"children":10874},{},[10875],{"type":48,"value":10876},"Static Content",{"type":48,"value":10878},": In Jekyll I had static content in a few different places. With Nuxt, all static content will live under the top level folder ",{"type":42,"tag":349,"props":10880,"children":10882},{"className":10881},[],[10883],{"type":48,"value":10884},"/static",{"type":48,"value":10886}," that is mapped to the root URL where my site is hosted. Since I had lots of content under ",{"type":42,"tag":349,"props":10888,"children":10890},{"className":10889},[],[10891],{"type":48,"value":10884},{"type":48,"value":10893}," in my Jekyll site, such as ",{"type":42,"tag":349,"props":10895,"children":10897},{"className":10896},[],[10898],{"type":48,"value":10899},"/static/my-image.png",{"type":48,"value":10901},", I ended up putting conent in ",{"type":42,"tag":349,"props":10903,"children":10905},{"className":10904},[],[10906],{"type":48,"value":10907},"/static/static",{"type":48,"value":10909},", hopefully this won't be too confusing.",{"type":42,"tag":112,"props":10911,"children":10913},{"id":10912},"nuxt-community",[10914],{"type":48,"value":10915},"Nuxt Community",{"type":42,"tag":51,"props":10917,"children":10918},{},[10919,10921,10931],{"type":48,"value":10920},"There are a lot of great packages from the ",{"type":42,"tag":138,"props":10922,"children":10925},{"href":10923,"rel":10924},"https://github.com/nuxt-community",[142],[10926],{"type":42,"tag":349,"props":10927,"children":10929},{"className":10928},[],[10930],{"type":48,"value":10912},{"type":48,"value":10932}," GitHub organization that are widely used in many Nuxt projects. Here are a few of the Nuxt community plugins and other Nuxt extensions that I have used so far:",{"type":42,"tag":57,"props":10934,"children":10935},{},[10936,10948,10957,10966,10975,10984],{"type":42,"tag":61,"props":10937,"children":10938},{},[10939,10946],{"type":42,"tag":138,"props":10940,"children":10943},{"href":10941,"rel":10942},"https://content.nuxtjs.org/",[142],[10944],{"type":48,"value":10945},"nuxt/content",{"type":48,"value":10947},": an official Nuxt project that provides a Git-based Headless CMS",{"type":42,"tag":61,"props":10949,"children":10950},{},[10951],{"type":42,"tag":349,"props":10952,"children":10954},{"className":10953},[],[10955],{"type":48,"value":10956},"@nuxtjs/tailwindcss",{"type":42,"tag":61,"props":10958,"children":10959},{},[10960],{"type":42,"tag":349,"props":10961,"children":10963},{"className":10962},[],[10964],{"type":48,"value":10965},"@nuxtjs/color-mode",{"type":42,"tag":61,"props":10967,"children":10968},{},[10969],{"type":42,"tag":349,"props":10970,"children":10972},{"className":10971},[],[10973],{"type":48,"value":10974},"@nuxtjs/google-analytics",{"type":42,"tag":61,"props":10976,"children":10977},{},[10978],{"type":42,"tag":349,"props":10979,"children":10981},{"className":10980},[],[10982],{"type":48,"value":10983},"@nuxtjs/sitemap",{"type":42,"tag":61,"props":10985,"children":10986},{},[10987],{"type":42,"tag":349,"props":10988,"children":10990},{"className":10989},[],[10991],{"type":48,"value":4700},{"type":42,"tag":112,"props":10993,"children":10995},{"id":10994},"issues",[10996],{"type":48,"value":10997},"Issues",{"type":42,"tag":57,"props":10999,"children":11000},{},[11001,11014,11019],{"type":42,"tag":61,"props":11002,"children":11003},{},[11004,11006,11013],{"type":48,"value":11005},"Tailwind removes markdown styles in blog articles from nuxt/content (solved by adding some extra css with ",{"type":42,"tag":138,"props":11007,"children":11010},{"href":11008,"rel":11009},"https://github.com/iandinwoodie/github-markdown-tailwindcss/blob/master/markdown.css",[142],[11011],{"type":48,"value":11012},"this",{"type":48,"value":5652},{"type":42,"tag":61,"props":11015,"children":11016},{},[11017],{"type":48,"value":11018},"No support for automatically adding markdown anchors (GitHub Flavored Markdown supports this)",{"type":42,"tag":61,"props":11020,"children":11021},{},[11022,11024],{"type":48,"value":11023},"Not able to do true server-side redirects, but you can do something like this: ",{"type":42,"tag":138,"props":11025,"children":11028},{"href":11026,"rel":11027},"https://github.com/nuxt-community/redirect-module/issues/1#issuecomment-615070920",[142],[11029],{"type":48,"value":11026},{"type":42,"tag":112,"props":11031,"children":11033},{"id":11032},"todo",[11034],{"type":48,"value":11035},"TODO",{"type":42,"tag":57,"props":11037,"children":11038},{},[11039],{"type":42,"tag":61,"props":11040,"children":11041},{},[11042],{"type":48,"value":11043},"Add tags, categories, search to blog",{"type":42,"tag":3468,"props":11045,"children":11046},{},[11047],{"type":48,"value":3472},{"title":8,"searchDepth":486,"depth":486,"links":11049},[11050,11051,11052,11053,11054],{"id":10525,"depth":486,"text":10528},{"id":10817,"depth":486,"text":10820},{"id":10912,"depth":486,"text":10915},{"id":10994,"depth":486,"text":10997},{"id":11032,"depth":486,"text":11035},"content:2020:09:17:migrating-from-jekyll-to-nuxt-static-site.md","2020/09/17/migrating-from-jekyll-to-nuxt-static-site.md","2020/09/17/migrating-from-jekyll-to-nuxt-static-site",{"_path":11059,"_dir":11060,"_draft":7,"_partial":7,"_locale":8,"title":11061,"description":11062,"layout":8366,"date":11063,"comments":37,"image":11064,"tags":11065,"body":11071,"_type":3490,"_id":15525,"_source":3492,"_file":15526,"_stem":15527,"_extension":3495},"/2020/08/09/digital-ocean-docker-swarm-django-traefik-nginx","09","Deploying Django applications with docker swarm on DigitalOcean using GitLab CI, Traefik, NGINX and REX-Ray","A guide to deploying Django applications with docker using popular open-source tools","2020-08-09T00:00:00.000Z","/static/shark.jpg",[5369,7534,11066,25,8140,11067,11068,11069,11070],"digital-ocean","rex-ray","traefik","nginx","swarm",{"type":39,"children":11072,"toc":15499},[11073,11105,11110,11118,11130,11135,11141,11146,11212,11244,11250,11294,11300,11337,11342,11347,11352,11358,11371,11448,11454,11476,11482,11487,11495,11506,11512,11524,11529,11537,11558,11563,11571,11584,11592,11597,11606,11634,11681,11699,11710,11878,11904,11941,12017,12025,12050,12145,12153,12174,12261,12274,12280,12316,12324,12352,12393,12399,12404,12412,12420,12457,12462,12470,12482,12501,12509,12529,12537,12557,12566,12593,12821,12897,12941,12982,12990,13011,13016,13023,13041,13053,13060,13080,13090,13123,13127,13334,13352,13359,13372,13409,13451,13464,13513,13529,13615,13837,13866,13871,13876,13888,13906,13917,14108,14127,14162,14170,14242,14250,14270,14296,14304,14382,14394,14537,14542,14556,14576,14584,14589,14597,14635,14669,14674,14681,14695,14700,14718,14723,14731,14736,14763,14782,14812,14817,15136,15144,15168,15255,15267,15275,15287,15294,15306,15314,15332,15340,15345,15353,15358,15363,15371,15390,15396,15401,15418,15426,15431,15435,15440,15446,15451,15457,15462,15468,15473,15479,15484,15490,15495],{"type":42,"tag":51,"props":11074,"children":11075},{},[11076,11078,11085,11087,11094,11096,11103],{"type":48,"value":11077},"I recently wrote two articles about deploying Django applications to AWS serverless environments: one on ",{"type":42,"tag":138,"props":11079,"children":11082},{"href":11080,"rel":11081},"https://briancaffey.github.io/2020/06/02/django-postgres-vue-gitlab-ecs.html",[142],[11083],{"type":48,"value":11084},"AWS Fargate",{"type":48,"value":11086}," (CloudFront, ALB and ECS Fargate containers) and one on ",{"type":42,"tag":138,"props":11088,"children":11091},{"href":11089,"rel":11090},"https://briancaffey.github.io/2020/08/01/django-and-lambda-with-cdk-and-api-gateway.html",[142],[11092],{"type":48,"value":11093},"AWS Lambda",{"type":48,"value":11095}," (Lambda + API Gateway, without using Zappa or Serverless Framework). Both projects focused on automating as much of the setup and operation as possible using DevOps patterns: Infrastructure as Code, GitOps, CI/CD and docker containers. I used AWS resources exclusively (with the exception of GitLab) with the help of ",{"type":42,"tag":138,"props":11097,"children":11100},{"href":11098,"rel":11099},"https://aws.amazon.com/cdk/",[142],[11101],{"type":48,"value":11102},"AWS Cloud Development Kit (CDK)",{"type":48,"value":11104},", an awesome tool that I have really come to like. In general I really like AWS, and the more I use it I start to think about what I would do without it. Also, a lot of the feedback I got on these projects recommended to \"just use a VPS\" instead of bothering with AWS because it is complicated, expensive, overkill, etc. This got me thinking about how far I could get in deploying a Django application on a server with little or no external services that AWS has spoiled me with. After a little bit of discomfort and confusion, I was able to check off most of what I was hoping to and came away with a few questions as well. If you are interested to know how I got things setup and and hear some of my thoughts on running Django applications in production, continue reading!",{"type":42,"tag":51,"props":11106,"children":11107},{},[11108],{"type":48,"value":11109},"In this article, I'm going to go over my approach to deploying and running Django applications using DigitalOcean Droplets (Linux-based virtual machine that runs on top of virtualized hardware) and block storage volumes (network-based block devices that provide additional data storage for Droplets).",{"type":42,"tag":723,"props":11111,"children":11112},{},[11113],{"type":42,"tag":51,"props":11114,"children":11115},{},[11116],{"type":48,"value":11117},"I'll also touch on trade-offs between DigitalOcean and AWS and emphasize aspects of the project that confuse/d me with these block quotes.",{"type":42,"tag":51,"props":11119,"children":11120},{},[11121,11123,11129],{"type":48,"value":11122},"Here's a link to my project that I'll be referencing: ",{"type":42,"tag":138,"props":11124,"children":11127},{"href":11125,"rel":11126},"https://gitlab.com/briancaffey/digital-ocean-docker-swarm-django-traefik",[142],[11128],{"type":48,"value":11125},{"type":48,"value":1970},{"type":42,"tag":51,"props":11131,"children":11132},{},[11133],{"type":48,"value":11134},"The project setup is a combination of some of the best practices I have picked up along the way as well as some very helpful guides, repositories and blog posts that I'll do my best to reference throughout this article.",{"type":42,"tag":112,"props":11136,"children":11138},{"id":11137},"overview",[11139],{"type":48,"value":11140},"Overview",{"type":42,"tag":51,"props":11142,"children":11143},{},[11144],{"type":48,"value":11145},"Here are some of the key parts of the project that I'll go over:",{"type":42,"tag":57,"props":11147,"children":11148},{},[11149,11154,11159,11164,11169,11174,11187,11192,11197,11202,11207],{"type":42,"tag":61,"props":11150,"children":11151},{},[11152],{"type":48,"value":11153},"DigitalOcean and GitLab setup",{"type":42,"tag":61,"props":11155,"children":11156},{},[11157],{"type":48,"value":11158},"Creating an A Record that points to our Droplet IP",{"type":42,"tag":61,"props":11160,"children":11161},{},[11162],{"type":48,"value":11163},"Using a prebuilt VM image that ships with docker and docker-compose",{"type":42,"tag":61,"props":11165,"children":11166},{},[11167],{"type":48,"value":11168},"Setting up the REX-Ray storage driver to automatically provision Digital Ocean block storage volumes",{"type":42,"tag":61,"props":11170,"children":11171},{},[11172],{"type":48,"value":11173},"Setting up a docker swarm cluster",{"type":42,"tag":61,"props":11175,"children":11176},{},[11177,11179,11185],{"type":48,"value":11178},"Setting up a ",{"type":42,"tag":349,"props":11180,"children":11182},{"className":11181},[],[11183],{"type":48,"value":11184},".gitlab-ci.yml",{"type":48,"value":11186}," file to build images and push them to a private GitLab CI project registry",{"type":42,"tag":61,"props":11188,"children":11189},{},[11190],{"type":48,"value":11191},"Writing a docker-compose file to configure the services (containers) that will support the application",{"type":42,"tag":61,"props":11193,"children":11194},{},[11195],{"type":48,"value":11196},"Deploying a stack to the docker swarm cluster on DigitalOcean from our GitLab CI environment over SSH",{"type":42,"tag":61,"props":11198,"children":11199},{},[11200],{"type":48,"value":11201},"Django project settings and management commands for our Postgres database and static files",{"type":42,"tag":61,"props":11203,"children":11204},{},[11205],{"type":48,"value":11206},"Monitoring, logging and debugging",{"type":42,"tag":61,"props":11208,"children":11209},{},[11210],{"type":48,"value":11211},"Destroying the environment + cleanup",{"type":42,"tag":51,"props":11213,"children":11214},{},[11215,11217,11224,11226,11233,11235,11242],{"type":48,"value":11216},"Before I dig into all of this, I recommend that you check out ",{"type":42,"tag":138,"props":11218,"children":11221},{"href":11219,"rel":11220},"https://mattsegal.dev/django-prod-architectures.html",[142],[11222],{"type":48,"value":11223},"this article about Django production architectures by Matt Segal",{"type":48,"value":11225},". This is a great primer for a lot of what I'll be talking about and it includes some great visualizations. ",{"type":42,"tag":138,"props":11227,"children":11230},{"href":11228,"rel":11229},"https://mattsegal.dev",[142],[11231],{"type":48,"value":11232},"mattsegal.dev",{"type":48,"value":11234}," has lots of good content related to Django, I also recommend checking out ",{"type":42,"tag":138,"props":11236,"children":11239},{"href":11237,"rel":11238},"https://mattsegal.dev/nginx-django-reverse-proxy-config.html",[142],[11240],{"type":48,"value":11241},"this article about how NGINX is used with Django",{"type":48,"value":11243},". Thanks for the great resources, Matt!",{"type":42,"tag":112,"props":11245,"children":11247},{"id":11246},"digitalocean-setup",[11248],{"type":48,"value":11249},"DigitalOcean setup",{"type":42,"tag":57,"props":11251,"children":11252},{},[11253,11258,11269,11280],{"type":42,"tag":61,"props":11254,"children":11255},{},[11256],{"type":48,"value":11257},"Sign up for a new DigitalOcean account if you don't already have one",{"type":42,"tag":61,"props":11259,"children":11260},{},[11261,11263],{"type":48,"value":11262},"Create a DigitalOcean project ",{"type":42,"tag":138,"props":11264,"children":11267},{"href":11265,"rel":11266},"https://cloud.digitalocean.com/projects/new",[142],[11268],{"type":48,"value":11265},{"type":42,"tag":61,"props":11270,"children":11271},{},[11272,11274],{"type":48,"value":11273},"Create a personal access token (we will use this to configure a docker addon that will provision block storage volumes automatically) ",{"type":42,"tag":138,"props":11275,"children":11278},{"href":11276,"rel":11277},"https://cloud.digitalocean.com/account/api/tokens",[142],[11279],{"type":48,"value":11276},{"type":42,"tag":61,"props":11281,"children":11282},{},[11283,11285,11292],{"type":48,"value":11284},"Create and add an SSH key to your account. This is a pretty simple step, but DigitalOcean still has really thorough documentation on how to do this (see ",{"type":42,"tag":138,"props":11286,"children":11289},{"href":11287,"rel":11288},"https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/",[142],[11290],{"type":48,"value":11291},"this article",{"type":48,"value":11293}," for more information)",{"type":42,"tag":112,"props":11295,"children":11297},{"id":11296},"prebuilt-docker-vm-image",[11298],{"type":48,"value":11299},"Prebuilt Docker VM image",{"type":42,"tag":51,"props":11301,"children":11302},{},[11303,11305,11312,11314,11320,11322,11327,11329,11335],{"type":48,"value":11304},"From the ",{"type":42,"tag":138,"props":11306,"children":11309},{"href":11307,"rel":11308},"https://cloud.digitalocean.com/droplets/new",[142],[11310],{"type":48,"value":11311},"Create Droplets",{"type":48,"value":11313}," page, select ",{"type":42,"tag":349,"props":11315,"children":11317},{"className":11316},[],[11318],{"type":48,"value":11319},"Marketplace",{"type":48,"value":11321}," and search for ",{"type":42,"tag":349,"props":11323,"children":11325},{"className":11324},[],[11326],{"type":48,"value":7534},{"type":48,"value":11328},". Select the ",{"type":42,"tag":349,"props":11330,"children":11332},{"className":11331},[],[11333],{"type":48,"value":11334},"Docker 5:19.03.1~3 18.04",{"type":48,"value":11336}," image. Note that this VM is Ubuntun 18.04 with Docker Community Edition and docker-compose pre-installed.",{"type":42,"tag":51,"props":11338,"children":11339},{},[11340],{"type":48,"value":11341},"Select the basic plan, and then scroll to the left to choose the $5.00/month option. Select a datacenter region. Most of these regions should be OK, but you should verify that the region you have selected supports volumes (they may all support volumes, but there are some DO features that are not supported accross all regiongs, similar to AWS). Do not select a VPC or any of the additional options.",{"type":42,"tag":51,"props":11343,"children":11344},{},[11345],{"type":48,"value":11346},"For Authentication, select the SSH key that you created earlier.",{"type":42,"tag":51,"props":11348,"children":11349},{},[11350],{"type":48,"value":11351},"Take note of the Droplet's IP address; we will use this in the next step.",{"type":42,"tag":112,"props":11353,"children":11355},{"id":11354},"gitlab-setup",[11356],{"type":48,"value":11357},"GitLab setup",{"type":42,"tag":51,"props":11359,"children":11360},{},[11361,11363,11369],{"type":48,"value":11362},"Create a new GitLab project and clone it locally. You can also clone or fork my project and use that as a starting point. Go to ",{"type":42,"tag":349,"props":11364,"children":11366},{"className":11365},[],[11367],{"type":48,"value":11368},"Settings > CI/CD > Variables",{"type":48,"value":11370}," in your GitLab project and add the following environment variables:",{"type":42,"tag":57,"props":11372,"children":11373},{},[11374,11399,11410,11421,11432],{"type":42,"tag":61,"props":11375,"children":11376},{},[11377,11383,11385,11391,11393],{"type":42,"tag":349,"props":11378,"children":11380},{"className":11379},[],[11381],{"type":48,"value":11382},"SSH_PRIVATE_KEY",{"type":48,"value":11384},": the value should start with ",{"type":42,"tag":349,"props":11386,"children":11388},{"className":11387},[],[11389],{"type":48,"value":11390},"-----BEGIN RSA PRIVATE KEY-----",{"type":48,"value":11392}," and end with ",{"type":42,"tag":349,"props":11394,"children":11396},{"className":11395},[],[11397],{"type":48,"value":11398},"-----END RSA PRIVATE KEY-----",{"type":42,"tag":61,"props":11400,"children":11401},{},[11402,11408],{"type":42,"tag":349,"props":11403,"children":11405},{"className":11404},[],[11406],{"type":48,"value":11407},"DROPLET_IP",{"type":48,"value":11409},": the IP address of the droplet you just created",{"type":42,"tag":61,"props":11411,"children":11412},{},[11413,11419],{"type":42,"tag":349,"props":11414,"children":11416},{"className":11415},[],[11417],{"type":48,"value":11418},"POSTGRES_PASSWORD",{"type":48,"value":11420},": a secure password that we will use for our Postgres database (we will share this with our Django application later on)",{"type":42,"tag":61,"props":11422,"children":11423},{},[11424,11430],{"type":42,"tag":349,"props":11425,"children":11427},{"className":11426},[],[11428],{"type":48,"value":11429},"SECRET_KEY",{"type":48,"value":11431},": a random secret key to use for our Django application.",{"type":42,"tag":61,"props":11433,"children":11434},{},[11435,11441,11443],{"type":42,"tag":349,"props":11436,"children":11438},{"className":11437},[],[11439],{"type":48,"value":11440},"DEBUG",{"type":48,"value":11442},": the number ",{"type":42,"tag":349,"props":11444,"children":11446},{"className":11445},[],[11447],{"type":48,"value":199},{"type":42,"tag":112,"props":11449,"children":11451},{"id":11450},"a-record",[11452],{"type":48,"value":11453},"A Record",{"type":42,"tag":51,"props":11455,"children":11456},{},[11457,11459,11465,11467,11474],{"type":48,"value":11458},"By the end of this project you will be able to deploy your Django application to a live domain name provided that you have one. All you need to do is create an A Record that points to the Droplet IP. There are no DNS configuration changes to make inside of DigitalOcean. I'm using a domain that I purchased through Route53. You can get a free ",{"type":42,"tag":349,"props":11460,"children":11462},{"className":11461},[],[11463],{"type":48,"value":11464},".tk",{"type":48,"value":11466}," domain from ",{"type":42,"tag":138,"props":11468,"children":11471},{"href":11469,"rel":11470},"https://www.freenom.com/en/freeandpaiddomains.html",[142],[11472],{"type":48,"value":11473},"freenom",{"type":48,"value":11475},". I have used this before and it is a great option for testing things out.",{"type":42,"tag":112,"props":11477,"children":11479},{"id":11478},"ssh-into-your-digitalocean-droplet",[11480],{"type":48,"value":11481},"SSH into your DigitalOcean Droplet",{"type":42,"tag":51,"props":11483,"children":11484},{},[11485],{"type":48,"value":11486},"You can do this with the following command:",{"type":42,"tag":401,"props":11488,"children":11490},{"code":11489},"ssh -i ~/.ssh/a1_rsa root@123.45.578.91\n",[11491],{"type":42,"tag":349,"props":11492,"children":11493},{"__ignoreMap":8},[11494],{"type":48,"value":11489},{"type":42,"tag":51,"props":11496,"children":11497},{},[11498,11504],{"type":42,"tag":349,"props":11499,"children":11501},{"className":11500},[],[11502],{"type":48,"value":11503},"a1_rsa",{"type":48,"value":11505}," is the private key I added to GitHub. You can logout for now, but keep this command handy, because we will be coming back to our Droplet via SSH shortly.",{"type":42,"tag":112,"props":11507,"children":11509},{"id":11508},"add-the-rex-ray-docker-plugin",[11510],{"type":48,"value":11511},"Add the REX-Ray docker plugin",{"type":42,"tag":51,"props":11513,"children":11514},{},[11515,11517,11523],{"type":48,"value":11516},"This step is very simple, you can follow along with this short guide: ",{"type":42,"tag":138,"props":11518,"children":11521},{"href":11519,"rel":11520},"https://www.digitalocean.com/community/questions/how-to-attach-digitalocean-block-storage-to-docker-container",[142],[11522],{"type":48,"value":11519},{"type":48,"value":1970},{"type":42,"tag":51,"props":11525,"children":11526},{},[11527],{"type":48,"value":11528},"There is basically one command to run:",{"type":42,"tag":401,"props":11530,"children":11532},{"code":11531},"docker plugin install rexray/dobs DOBS_TOKEN=YOUR_DIGITALOCEAN_TOKEN DOBS_REGION=nyc1 LINUX_VOLUME_FILEMODE=0775\n",[11533],{"type":42,"tag":349,"props":11534,"children":11535},{"__ignoreMap":8},[11536],{"type":48,"value":11531},{"type":42,"tag":51,"props":11538,"children":11539},{},[11540,11542,11548,11550,11556],{"type":48,"value":11541},"You will need to make sure that you replace ",{"type":42,"tag":349,"props":11543,"children":11545},{"className":11544},[],[11546],{"type":48,"value":11547},"YOUR_DIGITALOCEAN_TOKEN",{"type":48,"value":11549}," with the personal access token you added earlier. Also, ",{"type":42,"tag":349,"props":11551,"children":11553},{"className":11552},[],[11554],{"type":48,"value":11555},"DOBS_REGION",{"type":48,"value":11557}," should be the region you selected for your Droplet earlier.",{"type":42,"tag":51,"props":11559,"children":11560},{},[11561],{"type":48,"value":11562},"Check that the plugin was installed correctly with:",{"type":42,"tag":401,"props":11564,"children":11566},{"code":11565},"docker plugin ls\n",[11567],{"type":42,"tag":349,"props":11568,"children":11569},{"__ignoreMap":8},[11570],{"type":48,"value":11565},{"type":42,"tag":51,"props":11572,"children":11573},{},[11574,11576,11583],{"type":48,"value":11575},"Here's a quick intro to REX-Ray from ",{"type":42,"tag":138,"props":11577,"children":11580},{"href":11578,"rel":11579},"https://rexray.readthedocs.io/en/stable/",[142],[11581],{"type":48,"value":11582},"rexray.readthedocs.io",{"type":48,"value":4476},{"type":42,"tag":723,"props":11585,"children":11586},{},[11587],{"type":42,"tag":51,"props":11588,"children":11589},{},[11590],{"type":48,"value":11591},"REX-Ray is an open source, storage management solution designed to support container runtimes such as Docker and Mesos. REX-Ray enables stateful applications, such as databases, to persist and maintain its data after the life cycle of the container has ended. Built-in high availability enables orchestrators such as Docker Swarm, Kubernetes, and Mesos Frameworks like Marathon to automatically orchestrate storage tasks between hosts in a cluster.",{"type":42,"tag":51,"props":11593,"children":11594},{},[11595],{"type":48,"value":11596},"In the context of this project, REX-Ray will automate the creation of DigitalOcean Block Storage Volumes. We will talk about volumes and how they are used later on in this article.",{"type":42,"tag":112,"props":11598,"children":11600},{"id":11599},"gitlab-ciyml",[11601],{"type":42,"tag":349,"props":11602,"children":11604},{"className":11603},[],[11605],{"type":48,"value":11184},{"type":42,"tag":51,"props":11607,"children":11608},{},[11609,11614,11616,11623,11625,11632],{"type":42,"tag":349,"props":11610,"children":11612},{"className":11611},[],[11613],{"type":48,"value":11184},{"type":48,"value":11615}," is a file that configures pipelines when code is pushed to GitLab, similar to how GitHub Actions work with GitHub. This single file is a huge topic, if you are unfamiliar with GitLab CI, you might want to have a look over ",{"type":42,"tag":138,"props":11617,"children":11620},{"href":11618,"rel":11619},"https://docs.gitlab.com/ee/ci/yaml/",[142],[11621],{"type":48,"value":11622},"this page from the GitLab documentation",{"type":48,"value":11624}," which goes over all of the configuration options with many examples. Also, ",{"type":42,"tag":138,"props":11626,"children":11629},{"href":11627,"rel":11628},"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html",[142],[11630],{"type":48,"value":11631},"this documentation page",{"type":48,"value":11633}," covers the predefined environment variables that are made available to GitLab CI pipelines. I'm using these in a few different places as we will see shortly.",{"type":42,"tag":51,"props":11635,"children":11636},{},[11637,11639,11644,11646,11652,11653,11659,11660,11666,11668,11673,11674,11679],{"type":48,"value":11638},"CI/CD pipelines that I define with ",{"type":42,"tag":349,"props":11640,"children":11642},{"className":11641},[],[11643],{"type":48,"value":11184},{"type":48,"value":11645}," typically contain three stages: ",{"type":42,"tag":349,"props":11647,"children":11649},{"className":11648},[],[11650],{"type":48,"value":11651},"test",{"type":48,"value":935},{"type":42,"tag":349,"props":11654,"children":11656},{"className":11655},[],[11657],{"type":48,"value":11658},"build",{"type":48,"value":2751},{"type":42,"tag":349,"props":11661,"children":11663},{"className":11662},[],[11664],{"type":48,"value":11665},"deploy",{"type":48,"value":11667},". We will focus on the ",{"type":42,"tag":349,"props":11669,"children":11671},{"className":11670},[],[11672],{"type":48,"value":11658},{"type":48,"value":2751},{"type":42,"tag":349,"props":11675,"children":11677},{"className":11676},[],[11678],{"type":48,"value":11665},{"type":48,"value":11680}," stages for now (reference the article on my Fargate project linked above for reference on setting up unit tests with pytest).",{"type":42,"tag":51,"props":11682,"children":11683},{},[11684,11690,11692,11697],{"type":42,"tag":349,"props":11685,"children":11687},{"className":11686},[],[11688],{"type":48,"value":11689},"build-backend",{"type":48,"value":11691}," is the name of a GitLab CI job that builds and tags a docker image from the source code in the ",{"type":42,"tag":349,"props":11693,"children":11695},{"className":11694},[],[11696],{"type":48,"value":7997},{"type":48,"value":11698}," directory of this project and pushes the tagged container image to a private image registry on gitlab.com that we will use later.",{"type":42,"tag":51,"props":11700,"children":11701},{},[11702,11704,11709],{"type":48,"value":11703},"Here's the YAML code for ",{"type":42,"tag":349,"props":11705,"children":11707},{"className":11706},[],[11708],{"type":48,"value":11689},{"type":48,"value":4476},{"type":42,"tag":401,"props":11711,"children":11713},{"code":11712,"language":3649,"meta":8,"className":3650,"style":8},"build-backend:\n  stage: build\n  image: docker:19.03.1\n  services:\n    - docker:19.03.5-dind\n  before_script:\n    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY\n  script:\n    - |\n      docker build \\\n        -t $CI_REGISTRY_IMAGE/backend:$CI_COMMIT_SHORT_SHA \\\n        -f backend/docker/Dockerfile.prod \\\n        ./backend/\n    - docker push $CI_REGISTRY_IMAGE/backend:$CI_COMMIT_SHORT_SHA\n",[11714],{"type":42,"tag":349,"props":11715,"children":11716},{"__ignoreMap":8},[11717,11728,11745,11762,11774,11787,11799,11811,11823,11834,11842,11850,11858,11866],{"type":42,"tag":467,"props":11718,"children":11719},{"class":469,"line":470},[11720,11724],{"type":42,"tag":467,"props":11721,"children":11722},{"style":3660},[11723],{"type":48,"value":11689},{"type":42,"tag":467,"props":11725,"children":11726},{"style":480},[11727],{"type":48,"value":3693},{"type":42,"tag":467,"props":11729,"children":11730},{"class":469,"line":486},[11731,11736,11740],{"type":42,"tag":467,"props":11732,"children":11733},{"style":3660},[11734],{"type":48,"value":11735},"  stage",{"type":42,"tag":467,"props":11737,"children":11738},{"style":480},[11739],{"type":48,"value":3668},{"type":42,"tag":467,"props":11741,"children":11742},{"style":564},[11743],{"type":48,"value":11744},"build\n",{"type":42,"tag":467,"props":11746,"children":11747},{"class":469,"line":499},[11748,11753,11757],{"type":42,"tag":467,"props":11749,"children":11750},{"style":3660},[11751],{"type":48,"value":11752},"  image",{"type":42,"tag":467,"props":11754,"children":11755},{"style":480},[11756],{"type":48,"value":3668},{"type":42,"tag":467,"props":11758,"children":11759},{"style":564},[11760],{"type":48,"value":11761},"docker:19.03.1\n",{"type":42,"tag":467,"props":11763,"children":11764},{"class":469,"line":522},[11765,11770],{"type":42,"tag":467,"props":11766,"children":11767},{"style":3660},[11768],{"type":48,"value":11769},"  services",{"type":42,"tag":467,"props":11771,"children":11772},{"style":480},[11773],{"type":48,"value":3693},{"type":42,"tag":467,"props":11775,"children":11776},{"class":469,"line":531},[11777,11782],{"type":42,"tag":467,"props":11778,"children":11779},{"style":480},[11780],{"type":48,"value":11781},"    - ",{"type":42,"tag":467,"props":11783,"children":11784},{"style":564},[11785],{"type":48,"value":11786},"docker:19.03.5-dind\n",{"type":42,"tag":467,"props":11788,"children":11789},{"class":469,"line":550},[11790,11795],{"type":42,"tag":467,"props":11791,"children":11792},{"style":3660},[11793],{"type":48,"value":11794},"  before_script",{"type":42,"tag":467,"props":11796,"children":11797},{"style":480},[11798],{"type":48,"value":3693},{"type":42,"tag":467,"props":11800,"children":11801},{"class":469,"line":575},[11802,11806],{"type":42,"tag":467,"props":11803,"children":11804},{"style":480},[11805],{"type":48,"value":11781},{"type":42,"tag":467,"props":11807,"children":11808},{"style":564},[11809],{"type":48,"value":11810},"docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY\n",{"type":42,"tag":467,"props":11812,"children":11813},{"class":469,"line":598},[11814,11819],{"type":42,"tag":467,"props":11815,"children":11816},{"style":3660},[11817],{"type":48,"value":11818},"  script",{"type":42,"tag":467,"props":11820,"children":11821},{"style":480},[11822],{"type":48,"value":3693},{"type":42,"tag":467,"props":11824,"children":11825},{"class":469,"line":616},[11826,11830],{"type":42,"tag":467,"props":11827,"children":11828},{"style":480},[11829],{"type":48,"value":11781},{"type":42,"tag":467,"props":11831,"children":11832},{"style":474},[11833],{"type":48,"value":4001},{"type":42,"tag":467,"props":11835,"children":11836},{"class":469,"line":625},[11837],{"type":42,"tag":467,"props":11838,"children":11839},{"style":564},[11840],{"type":48,"value":11841},"      docker build \\\n",{"type":42,"tag":467,"props":11843,"children":11844},{"class":469,"line":633},[11845],{"type":42,"tag":467,"props":11846,"children":11847},{"style":564},[11848],{"type":48,"value":11849},"        -t $CI_REGISTRY_IMAGE/backend:$CI_COMMIT_SHORT_SHA \\\n",{"type":42,"tag":467,"props":11851,"children":11852},{"class":469,"line":664},[11853],{"type":42,"tag":467,"props":11854,"children":11855},{"style":564},[11856],{"type":48,"value":11857},"        -f backend/docker/Dockerfile.prod \\\n",{"type":42,"tag":467,"props":11859,"children":11860},{"class":469,"line":672},[11861],{"type":42,"tag":467,"props":11862,"children":11863},{"style":564},[11864],{"type":48,"value":11865},"        ./backend/\n",{"type":42,"tag":467,"props":11867,"children":11868},{"class":469,"line":690},[11869,11873],{"type":42,"tag":467,"props":11870,"children":11871},{"style":480},[11872],{"type":48,"value":11781},{"type":42,"tag":467,"props":11874,"children":11875},{"style":564},[11876],{"type":48,"value":11877},"docker push $CI_REGISTRY_IMAGE/backend:$CI_COMMIT_SHORT_SHA\n",{"type":42,"tag":51,"props":11879,"children":11880},{},[11881,11887,11889,11895,11897,11902],{"type":42,"tag":349,"props":11882,"children":11884},{"className":11883},[],[11885],{"type":48,"value":11886},"build-nginx",{"type":48,"value":11888}," is almost identical, but the ",{"type":42,"tag":349,"props":11890,"children":11892},{"className":11891},[],[11893],{"type":48,"value":11894},"docker build",{"type":48,"value":11896}," arguments are slightly different. There are three arguments for the ",{"type":42,"tag":349,"props":11898,"children":11900},{"className":11899},[],[11901],{"type":48,"value":11894},{"type":48,"value":11903}," command that I'm using here:",{"type":42,"tag":3541,"props":11905,"children":11906},{},[11907,11918,11929],{"type":42,"tag":61,"props":11908,"children":11909},{},[11910,11916],{"type":42,"tag":349,"props":11911,"children":11913},{"className":11912},[],[11914],{"type":48,"value":11915},"-t",{"type":48,"value":11917},": the tag to tag the built image with",{"type":42,"tag":61,"props":11919,"children":11920},{},[11921,11927],{"type":42,"tag":349,"props":11922,"children":11924},{"className":11923},[],[11925],{"type":48,"value":11926},"-f",{"type":48,"value":11928},": the Dockerfile to be used for building the image",{"type":42,"tag":61,"props":11930,"children":11931},{},[11932,11934,11939],{"type":48,"value":11933},"the ",{"type":42,"tag":349,"props":11935,"children":11937},{"className":11936},[],[11938],{"type":48,"value":5544},{"type":48,"value":11940}," that is sent to the docker daemon when we build the image",{"type":42,"tag":51,"props":11942,"children":11943},{},[11944,11949,11951,11957,11958,11964,11965,11971,11973,11979,11981,11986,11988,11994,11996,12001,12003,12008,12010,12015],{"type":42,"tag":349,"props":11945,"children":11947},{"className":11946},[],[11948],{"type":48,"value":11915},{"type":48,"value":11950}," makes use of two predefined GitLab CI variables: ",{"type":42,"tag":349,"props":11952,"children":11954},{"className":11953},[],[11955],{"type":48,"value":11956},"CI_REGISTRY_IMAGE",{"type":48,"value":2751},{"type":42,"tag":349,"props":11959,"children":11961},{"className":11960},[],[11962],{"type":48,"value":11963},"CI_COMMIT_SHORT_SHA",{"type":48,"value":7015},{"type":42,"tag":349,"props":11966,"children":11968},{"className":11967},[],[11969],{"type":48,"value":11970},"$CI_REGISTRY_IMAGE",{"type":48,"value":11972}," is the URL for the private image registry on gitlab.com that we push our images to that is specific to our project: ",{"type":42,"tag":349,"props":11974,"children":11976},{"className":11975},[],[11977],{"type":48,"value":11978},"registry.gitlab.com/\u003Cgitlab_username>/\u003Cproject_name>",{"type":48,"value":11980},", and ",{"type":42,"tag":349,"props":11982,"children":11984},{"className":11983},[],[11985],{"type":48,"value":11963},{"type":48,"value":11987}," is an character alphanumeric value that contains the truncated name of the commit hash, this is known as the ",{"type":42,"tag":349,"props":11989,"children":11991},{"className":11990},[],[11992],{"type":48,"value":11993},"tag",{"type":48,"value":11995},", even though we pass in more than just this value. We combine these two values with ",{"type":42,"tag":349,"props":11997,"children":11999},{"className":11998},[],[12000],{"type":48,"value":3633},{"type":48,"value":12002}," and the name of the image we are building, such as ",{"type":42,"tag":349,"props":12004,"children":12006},{"className":12005},[],[12007],{"type":48,"value":7997},{"type":48,"value":12009},", so the full value being passed to ",{"type":42,"tag":349,"props":12011,"children":12013},{"className":12012},[],[12014],{"type":48,"value":11915},{"type":48,"value":12016}," is:",{"type":42,"tag":401,"props":12018,"children":12020},{"code":12019},"registry.gitlab.com/gitlab-username/my-project/backend:abcd1234\n",[12021],{"type":42,"tag":349,"props":12022,"children":12023},{"__ignoreMap":8},[12024],{"type":48,"value":12019},{"type":42,"tag":51,"props":12026,"children":12027},{},[12028,12033,12035,12041,12043,12048],{"type":42,"tag":349,"props":12029,"children":12031},{"className":12030},[],[12032],{"type":48,"value":11926},{"type":48,"value":12034}," is the path to the ",{"type":42,"tag":349,"props":12036,"children":12038},{"className":12037},[],[12039],{"type":48,"value":12040},"Dockerfile",{"type":48,"value":12042}," we are using relative to the directory where we are running the ",{"type":42,"tag":349,"props":12044,"children":12046},{"className":12045},[],[12047],{"type":48,"value":11894},{"type":48,"value":12049}," command, which is the root directory of the project.",{"type":42,"tag":51,"props":12051,"children":12052},{},[12053,12055,12060,12062,12068,12069,12075,12077,12082,12083,12088,12090,12095,12097,12102,12104,12109,12111,12116,12117,12122,12124,12129,12131,12136,12138,12143],{"type":48,"value":12054},"The final argument defines the context that we are using to build the image, and this is an important part for understanding how Docker works. This argument defines the directory that is zipped up and sent to the docker daemon via the docker API. When we build an image with ",{"type":42,"tag":349,"props":12056,"children":12058},{"className":12057},[],[12059],{"type":48,"value":11894},{"type":48,"value":12061},", we are essentially using the docker CLI to make a POST request to our docker daemon (server) where the POST data contains all of the files that we will have access to in the steps of the Dockerfile (such as ",{"type":42,"tag":349,"props":12063,"children":12065},{"className":12064},[],[12066],{"type":48,"value":12067},"ADD",{"type":48,"value":2751},{"type":42,"tag":349,"props":12070,"children":12072},{"className":12071},[],[12073],{"type":48,"value":12074},"COPY",{"type":48,"value":12076}," -- we will get to these soon). There's a key difference between the ",{"type":42,"tag":349,"props":12078,"children":12080},{"className":12079},[],[12081],{"type":48,"value":7997},{"type":48,"value":2751},{"type":42,"tag":349,"props":12084,"children":12086},{"className":12085},[],[12087],{"type":48,"value":11069},{"type":48,"value":12089}," ",{"type":42,"tag":349,"props":12091,"children":12093},{"className":12092},[],[12094],{"type":48,"value":11894},{"type":48,"value":12096}," commands: the context for ",{"type":42,"tag":349,"props":12098,"children":12100},{"className":12099},[],[12101],{"type":48,"value":7997},{"type":48,"value":12103}," is ",{"type":42,"tag":349,"props":12105,"children":12107},{"className":12106},[],[12108],{"type":48,"value":7997},{"type":48,"value":12110},", but the context for ",{"type":42,"tag":349,"props":12112,"children":12114},{"className":12113},[],[12115],{"type":48,"value":11069},{"type":48,"value":12103},{"type":42,"tag":349,"props":12118,"children":12120},{"className":12119},[],[12121],{"type":48,"value":1970},{"type":48,"value":12123}," (the root of the project). This is because we may want access to another top level directory in our project that contains, for example, a Vue.js or React application, that we will build into our NGINX container. In order to be able to access both files in the ",{"type":42,"tag":349,"props":12125,"children":12127},{"className":12126},[],[12128],{"type":48,"value":11069},{"type":48,"value":12130}," and the folder containing our frontend app, we need to send a context that contains both of these directories. Sending too many files to to the docker daemon when you run docker build will usually cause the ",{"type":42,"tag":349,"props":12132,"children":12134},{"className":12133},[],[12135],{"type":48,"value":11894},{"type":48,"value":12137}," command to hang. The first line of output from a ",{"type":42,"tag":349,"props":12139,"children":12141},{"className":12140},[],[12142],{"type":48,"value":11894},{"type":48,"value":12144}," command should be something like this:",{"type":42,"tag":401,"props":12146,"children":12148},{"code":12147},"Sending build context to Docker daemon  24.58kB\n",[12149],{"type":42,"tag":349,"props":12150,"children":12151},{"__ignoreMap":8},[12152],{"type":48,"value":12147},{"type":42,"tag":51,"props":12154,"children":12155},{},[12156,12158,12164,12166,12172],{"type":48,"value":12157},"If this number is too high, you should use a ",{"type":42,"tag":349,"props":12159,"children":12161},{"className":12160},[],[12162],{"type":48,"value":12163},".dockerignore",{"type":48,"value":12165}," file that ignores any files or directories you don't want to send to the docker daemon (similar to how ",{"type":42,"tag":349,"props":12167,"children":12169},{"className":12168},[],[12170],{"type":48,"value":12171},".gitignore",{"type":48,"value":12173}," works with git).",{"type":42,"tag":51,"props":12175,"children":12176},{},[12177,12179,12185,12187,12193,12195,12201,12202,12208,12210,12216,12218,12224,12226,12232,12234,12239,12240,12245,12247,12252,12254,12259],{"type":48,"value":12178},"To be able to pull and push (read and write) images to our private project container image registry, we need login with our docker client using the ",{"type":42,"tag":349,"props":12180,"children":12182},{"className":12181},[],[12183],{"type":48,"value":12184},"docker login",{"type":48,"value":12186}," command in the ",{"type":42,"tag":349,"props":12188,"children":12190},{"className":12189},[],[12191],{"type":48,"value":12192},"before_script",{"type":48,"value":12194}," as well two other predefined GitLab CI variables: ",{"type":42,"tag":349,"props":12196,"children":12198},{"className":12197},[],[12199],{"type":48,"value":12200},"CI_JOB_TOKEN",{"type":48,"value":2751},{"type":42,"tag":349,"props":12203,"children":12205},{"className":12204},[],[12206],{"type":48,"value":12207},"CI_REGISTRY",{"type":48,"value":12209},". This all happens using a special service called ",{"type":42,"tag":349,"props":12211,"children":12213},{"className":12212},[],[12214],{"type":48,"value":12215},"docker-in-docker",{"type":48,"value":12217}," which I won't go into too much detail here, but it is a common practice when working with containers in a CI/CD environment that itself which is also based on containers, such as GitLab CI (each job runs in a container -- the key ",{"type":42,"tag":349,"props":12219,"children":12221},{"className":12220},[],[12222],{"type":48,"value":12223},"image",{"type":48,"value":12225}," -- and can define additional containers -- the ",{"type":42,"tag":349,"props":12227,"children":12229},{"className":12228},[],[12230],{"type":48,"value":12231},"services",{"type":48,"value":12233}," key -- to help with the CI job). Once the two images for ",{"type":42,"tag":349,"props":12235,"children":12237},{"className":12236},[],[12238],{"type":48,"value":7997},{"type":48,"value":2751},{"type":42,"tag":349,"props":12241,"children":12243},{"className":12242},[],[12244],{"type":48,"value":11069},{"type":48,"value":12246}," have been built and pushed, our GitLab CI pipeline moves on to the next stage: ",{"type":42,"tag":349,"props":12248,"children":12250},{"className":12249},[],[12251],{"type":48,"value":11665},{"type":48,"value":12253},". In the ",{"type":42,"tag":349,"props":12255,"children":12257},{"className":12256},[],[12258],{"type":48,"value":11665},{"type":48,"value":12260}," stage, we will start these and other containers on our DigitalOcean droplet, so we are getting close, but there is a lot more to explain. Before we deploy our containers, we need to do some one-time setup:",{"type":42,"tag":3541,"props":12262,"children":12263},{},[12264,12269],{"type":42,"tag":61,"props":12265,"children":12266},{},[12267],{"type":48,"value":12268},"initialize a single-node docker swarm cluster on our Droplet and",{"type":42,"tag":61,"props":12270,"children":12271},{},[12272],{"type":48,"value":12273},"create a docker network that our cluster's services (containers) will use",{"type":42,"tag":112,"props":12275,"children":12277},{"id":12276},"setup-a-docker-swarm-cluster",[12278],{"type":48,"value":12279},"Setup a docker swarm cluster",{"type":42,"tag":51,"props":12281,"children":12282},{},[12283,12285,12291,12293,12298,12300,12306,12308,12314],{"type":48,"value":12284},"To setup a docker swarm cluster, SSH into the Droplet with the command we introduced above (",{"type":42,"tag":349,"props":12286,"children":12288},{"className":12287},[],[12289],{"type":48,"value":12290},"ssh -i ~/.ssh/a1_rsa root@123.45.578.91",{"type":48,"value":12292}," where ",{"type":42,"tag":349,"props":12294,"children":12296},{"className":12295},[],[12297],{"type":48,"value":11503},{"type":48,"value":12299}," is the name of the private key file -- you can ignore the ",{"type":42,"tag":349,"props":12301,"children":12303},{"className":12302},[],[12304],{"type":48,"value":12305},"-i ~/.ssh/a1_rsa",{"type":48,"value":12307}," part if you are using an SSH key called ",{"type":42,"tag":349,"props":12309,"children":12311},{"className":12310},[],[12312],{"type":48,"value":12313},"id_rsa",{"type":48,"value":12315},"), and run the following command:",{"type":42,"tag":401,"props":12317,"children":12319},{"code":12318},"docker swarm init --advertise-addr DROPLET_IP\n",[12320],{"type":42,"tag":349,"props":12321,"children":12322},{"__ignoreMap":8},[12323],{"type":48,"value":12318},{"type":42,"tag":51,"props":12325,"children":12326},{},[12327,12329,12334,12336,12342,12344,12350],{"type":48,"value":12328},"Replace ",{"type":42,"tag":349,"props":12330,"children":12332},{"className":12331},[],[12333],{"type":48,"value":11407},{"type":48,"value":12335}," with your Droplet's IP address (e.g. ",{"type":42,"tag":349,"props":12337,"children":12339},{"className":12338},[],[12340],{"type":48,"value":12341},"123.45.578.91",{"type":48,"value":12343},"). Check out ",{"type":42,"tag":138,"props":12345,"children":12348},{"href":12346,"rel":12347},"https://www.digitalocean.com/community/tutorials/how-to-create-a-cluster-of-docker-containers-with-docker-swarm-and-digitalocean-on-ubuntu-16-04",[142],[12349],{"type":48,"value":11291},{"type":48,"value":12351}," for some additional information about using docker swarm on GitLab. It is a little bit outdated, but the main ideas should still hold up. Docker swarm is designed to orchestrate containers running on a group (or swarm) of multiple machines. However, it is perfectly fine to run a single-node cluster as we are doing here.",{"type":42,"tag":51,"props":12353,"children":12354},{},[12355,12357,12362,12364,12370,12372,12377,12379,12384,12386,12391],{"type":48,"value":12356},"Docker swarm uses docker-compose files, but using docker swarm is very different from running ",{"type":42,"tag":349,"props":12358,"children":12360},{"className":12359},[],[12361],{"type":48,"value":7741},{"type":48,"value":12363},", a command which you might see people running both locally and in production and which also uses docker-compose files. As a best practice, you should not be using ",{"type":42,"tag":349,"props":12365,"children":12367},{"className":12366},[],[12368],{"type":48,"value":12369},"docker-compose",{"type":48,"value":12371}," (the command) in production. Many people do this, and several official tutorials will often end with \"now just run ",{"type":42,"tag":349,"props":12373,"children":12375},{"className":12374},[],[12376],{"type":48,"value":7741},{"type":48,"value":12378}," and you are done\". The first time I ran containers in the cloud I pulled my git repo into a VM, installed docker and docker-compose and ran ",{"type":42,"tag":349,"props":12380,"children":12382},{"className":12381},[],[12383],{"type":48,"value":7741},{"type":48,"value":12385},". It is pretty easy and it works very similarly in both local and production environments, but this guide will be using ",{"type":42,"tag":349,"props":12387,"children":12389},{"className":12388},[],[12390],{"type":48,"value":12369},{"type":48,"value":12392}," in production. There is more I could say here, but the main point is that docker swarm is a simplified version of something like Kubernetes, but it comes built-in to docker and is very simple to use.",{"type":42,"tag":112,"props":12394,"children":12396},{"id":12395},"defining-an-overlay-network",[12397],{"type":48,"value":12398},"Defining an overlay network",{"type":42,"tag":51,"props":12400,"children":12401},{},[12402],{"type":48,"value":12403},"SSH into your droplet and run the following command:",{"type":42,"tag":401,"props":12405,"children":12407},{"code":12406},"docker network create --driver=overlay traefik-public\n",[12408],{"type":42,"tag":349,"props":12409,"children":12410},{"__ignoreMap":8},[12411],{"type":48,"value":12406},{"type":42,"tag":723,"props":12413,"children":12414},{},[12415],{"type":42,"tag":51,"props":12416,"children":12417},{},[12418],{"type":48,"value":12419},"Usually we define networks in our docker-compose file, but this network needs to be defined first and then referenced in our docker-compose file. Here's a thread on SO that goes into a little bit more on why this is necessary, but I still don't have a very clear idea of why this is the case. With another configuration or perhaps docker-compose version, this may not be needed. I'll update this part of the article if I figure anything out.",{"type":42,"tag":51,"props":12421,"children":12422},{},[12423,12425,12431,12433,12438,12440,12446,12448,12455],{"type":48,"value":12424},"Let's go over one more docker concept that will helpful in the next few steps. When you run ",{"type":42,"tag":349,"props":12426,"children":12428},{"className":12427},[],[12429],{"type":48,"value":12430},"docker ps",{"type":48,"value":12432}," on your local machine, the docker CLI first looks to see if the ",{"type":42,"tag":349,"props":12434,"children":12436},{"className":12435},[],[12437],{"type":48,"value":8246},{"type":48,"value":12439}," environment variable is set. If it is not, then docker defaults to ",{"type":42,"tag":349,"props":12441,"children":12443},{"className":12442},[],[12444],{"type":48,"value":12445},"unix:///var/run/docker.sock",{"type":48,"value":12447},", a UNIX socket. Check out ",{"type":42,"tag":138,"props":12449,"children":12452},{"href":12450,"rel":12451},"https://stackoverflow.com/questions/35110146/can-anyone-explain-docker-sock",[142],[12453],{"type":48,"value":12454},"this SO post",{"type":48,"value":12456}," titled \"Can anyone explain docker.sock?\"",{"type":42,"tag":51,"props":12458,"children":12459},{},[12460],{"type":48,"value":12461},"We change the docker host that our local docker CLI is talking to by setting this environment variable, and one nice way to set this environment variables uses an SSH connection:",{"type":42,"tag":401,"props":12463,"children":12465},{"code":12464},"DOCKER_HOST=ssh://root@$DOCKER_IP\n",[12466],{"type":42,"tag":349,"props":12467,"children":12468},{"__ignoreMap":8},[12469],{"type":48,"value":12464},{"type":42,"tag":51,"props":12471,"children":12472},{},[12473,12475,12481],{"type":48,"value":12474},"See this article for a more in-depth discussion: ",{"type":42,"tag":138,"props":12476,"children":12479},{"href":12477,"rel":12478},"https://www.digitalocean.com/community/tutorials/how-to-use-a-remote-docker-server-to-speed-up-your-workflow",[142],[12480],{"type":48,"value":12477},{"type":48,"value":1970},{"type":42,"tag":51,"props":12483,"children":12484},{},[12485,12487,12492,12494,12499],{"type":48,"value":12486},"You can try this out locally. Run a container locally, check it with ",{"type":42,"tag":349,"props":12488,"children":12490},{"className":12489},[],[12491],{"type":48,"value":12430},{"type":48,"value":12493},", then export the ",{"type":42,"tag":349,"props":12495,"children":12497},{"className":12496},[],[12498],{"type":48,"value":8246},{"type":48,"value":12500}," environment variable with the following command:",{"type":42,"tag":401,"props":12502,"children":12504},{"code":12503},"export DOCKER_HOST=ssh://root@123.45.678.91\n",[12505],{"type":42,"tag":349,"props":12506,"children":12507},{"__ignoreMap":8},[12508],{"type":48,"value":12503},{"type":42,"tag":51,"props":12510,"children":12511},{},[12512,12514,12520,12522,12527],{"type":48,"value":12513},"Replacing ",{"type":42,"tag":349,"props":12515,"children":12517},{"className":12516},[],[12518],{"type":48,"value":12519},"123.45.678.91",{"type":48,"value":12521}," with your Droplet IP. Run ",{"type":42,"tag":349,"props":12523,"children":12525},{"className":12524},[],[12526],{"type":48,"value":12430},{"type":48,"value":12528}," again and you should see nothing (or any other containers that you started on your Droplet). Finally, run:",{"type":42,"tag":401,"props":12530,"children":12532},{"code":12531},"unset DOCKER_HOST\n",[12533],{"type":42,"tag":349,"props":12534,"children":12535},{"__ignoreMap":8},[12536],{"type":48,"value":12531},{"type":42,"tag":51,"props":12538,"children":12539},{},[12540,12542,12547,12549,12555],{"type":48,"value":12541},"Running ",{"type":42,"tag":349,"props":12543,"children":12545},{"className":12544},[],[12546],{"type":48,"value":12430},{"type":48,"value":12548}," again you should see the containers on your machine. We will be using this idea in the next step when we look at the ",{"type":42,"tag":349,"props":12550,"children":12552},{"className":12551},[],[12553],{"type":48,"value":12554},"docker stack deploy",{"type":48,"value":12556}," command.",{"type":42,"tag":112,"props":12558,"children":12560},{"id":12559},"docker-stack-deploy",[12561],{"type":42,"tag":349,"props":12562,"children":12564},{"className":12563},[],[12565],{"type":48,"value":12554},{"type":42,"tag":51,"props":12567,"children":12568},{},[12569,12571,12576,12578,12583,12585,12591],{"type":48,"value":12570},"Now that we have done our one-time-setup steps, let's look at the ",{"type":42,"tag":349,"props":12572,"children":12574},{"className":12573},[],[12575],{"type":48,"value":11665},{"type":48,"value":12577}," stage of ",{"type":42,"tag":349,"props":12579,"children":12581},{"className":12580},[],[12582],{"type":48,"value":11184},{"type":48,"value":12584},", the GitLab CI job that will get our containers running on our Droplet. First, let's break down the ",{"type":42,"tag":349,"props":12586,"children":12588},{"className":12587},[],[12589],{"type":48,"value":12590},"deploy-digital-ocean",{"type":48,"value":12592}," command:",{"type":42,"tag":401,"props":12594,"children":12596},{"code":12595,"language":3649,"meta":8,"className":3650,"style":8},"deploy-digital-ocean:\n  stage: deploy\n  image: docker:19.03.1\n  services:\n    - docker:19.03.5-dind\n  variables:\n    DOCKER_HOST: 'ssh://root@$DROPLET_IP'\n  before_script:\n    - apk update && apk add openssh-client bash\n    - mkdir -p ~/.ssh\n    - echo \"$SSH_PRIVATE_KEY\" > ~/.ssh/id_rsa\n    - chmod 600 ~/.ssh/id_rsa\n    - eval \"$(ssh-agent -s)\"\n    - ssh-add ~/.ssh/id_rsa\n    - ssh-keyscan -H $DROPLET_IP >> ~/.ssh/known_hosts\n    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY\n  script:\n    - docker stack deploy -c stack.yml my-stack --with-registry-auth\n",[12597],{"type":42,"tag":349,"props":12598,"children":12599},{"__ignoreMap":8},[12600,12611,12626,12641,12652,12663,12675,12692,12703,12715,12727,12739,12751,12763,12775,12787,12798,12809],{"type":42,"tag":467,"props":12601,"children":12602},{"class":469,"line":470},[12603,12607],{"type":42,"tag":467,"props":12604,"children":12605},{"style":3660},[12606],{"type":48,"value":12590},{"type":42,"tag":467,"props":12608,"children":12609},{"style":480},[12610],{"type":48,"value":3693},{"type":42,"tag":467,"props":12612,"children":12613},{"class":469,"line":486},[12614,12618,12622],{"type":42,"tag":467,"props":12615,"children":12616},{"style":3660},[12617],{"type":48,"value":11735},{"type":42,"tag":467,"props":12619,"children":12620},{"style":480},[12621],{"type":48,"value":3668},{"type":42,"tag":467,"props":12623,"children":12624},{"style":564},[12625],{"type":48,"value":4104},{"type":42,"tag":467,"props":12627,"children":12628},{"class":469,"line":499},[12629,12633,12637],{"type":42,"tag":467,"props":12630,"children":12631},{"style":3660},[12632],{"type":48,"value":11752},{"type":42,"tag":467,"props":12634,"children":12635},{"style":480},[12636],{"type":48,"value":3668},{"type":42,"tag":467,"props":12638,"children":12639},{"style":564},[12640],{"type":48,"value":11761},{"type":42,"tag":467,"props":12642,"children":12643},{"class":469,"line":522},[12644,12648],{"type":42,"tag":467,"props":12645,"children":12646},{"style":3660},[12647],{"type":48,"value":11769},{"type":42,"tag":467,"props":12649,"children":12650},{"style":480},[12651],{"type":48,"value":3693},{"type":42,"tag":467,"props":12653,"children":12654},{"class":469,"line":531},[12655,12659],{"type":42,"tag":467,"props":12656,"children":12657},{"style":480},[12658],{"type":48,"value":11781},{"type":42,"tag":467,"props":12660,"children":12661},{"style":564},[12662],{"type":48,"value":11786},{"type":42,"tag":467,"props":12664,"children":12665},{"class":469,"line":550},[12666,12671],{"type":42,"tag":467,"props":12667,"children":12668},{"style":3660},[12669],{"type":48,"value":12670},"  variables",{"type":42,"tag":467,"props":12672,"children":12673},{"style":480},[12674],{"type":48,"value":3693},{"type":42,"tag":467,"props":12676,"children":12677},{"class":469,"line":575},[12678,12683,12687],{"type":42,"tag":467,"props":12679,"children":12680},{"style":3660},[12681],{"type":48,"value":12682},"    DOCKER_HOST",{"type":42,"tag":467,"props":12684,"children":12685},{"style":480},[12686],{"type":48,"value":3668},{"type":42,"tag":467,"props":12688,"children":12689},{"style":564},[12690],{"type":48,"value":12691},"'ssh://root@$DROPLET_IP'\n",{"type":42,"tag":467,"props":12693,"children":12694},{"class":469,"line":598},[12695,12699],{"type":42,"tag":467,"props":12696,"children":12697},{"style":3660},[12698],{"type":48,"value":11794},{"type":42,"tag":467,"props":12700,"children":12701},{"style":480},[12702],{"type":48,"value":3693},{"type":42,"tag":467,"props":12704,"children":12705},{"class":469,"line":616},[12706,12710],{"type":42,"tag":467,"props":12707,"children":12708},{"style":480},[12709],{"type":48,"value":11781},{"type":42,"tag":467,"props":12711,"children":12712},{"style":564},[12713],{"type":48,"value":12714},"apk update && apk add openssh-client bash\n",{"type":42,"tag":467,"props":12716,"children":12717},{"class":469,"line":625},[12718,12722],{"type":42,"tag":467,"props":12719,"children":12720},{"style":480},[12721],{"type":48,"value":11781},{"type":42,"tag":467,"props":12723,"children":12724},{"style":564},[12725],{"type":48,"value":12726},"mkdir -p ~/.ssh\n",{"type":42,"tag":467,"props":12728,"children":12729},{"class":469,"line":633},[12730,12734],{"type":42,"tag":467,"props":12731,"children":12732},{"style":480},[12733],{"type":48,"value":11781},{"type":42,"tag":467,"props":12735,"children":12736},{"style":564},[12737],{"type":48,"value":12738},"echo \"$SSH_PRIVATE_KEY\" > ~/.ssh/id_rsa\n",{"type":42,"tag":467,"props":12740,"children":12741},{"class":469,"line":664},[12742,12746],{"type":42,"tag":467,"props":12743,"children":12744},{"style":480},[12745],{"type":48,"value":11781},{"type":42,"tag":467,"props":12747,"children":12748},{"style":564},[12749],{"type":48,"value":12750},"chmod 600 ~/.ssh/id_rsa\n",{"type":42,"tag":467,"props":12752,"children":12753},{"class":469,"line":672},[12754,12758],{"type":42,"tag":467,"props":12755,"children":12756},{"style":480},[12757],{"type":48,"value":11781},{"type":42,"tag":467,"props":12759,"children":12760},{"style":564},[12761],{"type":48,"value":12762},"eval \"$(ssh-agent -s)\"\n",{"type":42,"tag":467,"props":12764,"children":12765},{"class":469,"line":690},[12766,12770],{"type":42,"tag":467,"props":12767,"children":12768},{"style":480},[12769],{"type":48,"value":11781},{"type":42,"tag":467,"props":12771,"children":12772},{"style":564},[12773],{"type":48,"value":12774},"ssh-add ~/.ssh/id_rsa\n",{"type":42,"tag":467,"props":12776,"children":12777},{"class":469,"line":1336},[12778,12782],{"type":42,"tag":467,"props":12779,"children":12780},{"style":480},[12781],{"type":48,"value":11781},{"type":42,"tag":467,"props":12783,"children":12784},{"style":564},[12785],{"type":48,"value":12786},"ssh-keyscan -H $DROPLET_IP >> ~/.ssh/known_hosts\n",{"type":42,"tag":467,"props":12788,"children":12789},{"class":469,"line":1344},[12790,12794],{"type":42,"tag":467,"props":12791,"children":12792},{"style":480},[12793],{"type":48,"value":11781},{"type":42,"tag":467,"props":12795,"children":12796},{"style":564},[12797],{"type":48,"value":11810},{"type":42,"tag":467,"props":12799,"children":12800},{"class":469,"line":1362},[12801,12805],{"type":42,"tag":467,"props":12802,"children":12803},{"style":3660},[12804],{"type":48,"value":11818},{"type":42,"tag":467,"props":12806,"children":12807},{"style":480},[12808],{"type":48,"value":3693},{"type":42,"tag":467,"props":12810,"children":12811},{"class":469,"line":1380},[12812,12816],{"type":42,"tag":467,"props":12813,"children":12814},{"style":480},[12815],{"type":48,"value":11781},{"type":42,"tag":467,"props":12817,"children":12818},{"style":564},[12819],{"type":48,"value":12820},"docker stack deploy -c stack.yml my-stack --with-registry-auth\n",{"type":42,"tag":51,"props":12822,"children":12823},{},[12824,12826,12831,12832,12837,12839,12844,12846,12851,12852,12858,12860,12865,12867,12873,12875,12881,12882,12888,12890,12896],{"type":48,"value":12825},"This job uses the same ",{"type":42,"tag":349,"props":12827,"children":12829},{"className":12828},[],[12830],{"type":48,"value":12223},{"type":48,"value":2751},{"type":42,"tag":349,"props":12833,"children":12835},{"className":12834},[],[12836],{"type":48,"value":12231},{"type":48,"value":12838}," that our ",{"type":42,"tag":349,"props":12840,"children":12842},{"className":12841},[],[12843],{"type":48,"value":11658},{"type":48,"value":12845}," stage jobs used. Notice that we set ",{"type":42,"tag":349,"props":12847,"children":12849},{"className":12848},[],[12850],{"type":48,"value":8246},{"type":48,"value":6168},{"type":42,"tag":349,"props":12853,"children":12855},{"className":12854},[],[12856],{"type":48,"value":12857},"\"ssh://root@$DROPLET_IP\"",{"type":48,"value":12859},", this means that any docker CLI commands in this job will be communicating with the docker daemon on our Droplet. The ",{"type":42,"tag":349,"props":12861,"children":12863},{"className":12862},[],[12864],{"type":48,"value":12192},{"type":48,"value":12866}," has a lot going on, but all we are doing is preparing to use the SSH private key that we previously added to our GitLab project's CI/CD environment variables. The base image for this job, ",{"type":42,"tag":349,"props":12868,"children":12870},{"className":12869},[],[12871],{"type":48,"value":12872},"docker:19.03.1",{"type":48,"value":12874}," is based on Alpine Linus. This version of Linux is super light weight and doesn't come with ",{"type":42,"tag":349,"props":12876,"children":12878},{"className":12877},[],[12879],{"type":48,"value":12880},"openssh-client",{"type":48,"value":7768},{"type":42,"tag":349,"props":12883,"children":12885},{"className":12884},[],[12886],{"type":48,"value":12887},"bash",{"type":48,"value":12889},", so our first step is to install these with the Alpine package manager, ",{"type":42,"tag":349,"props":12891,"children":12893},{"className":12892},[],[12894],{"type":48,"value":12895},"apk",{"type":48,"value":4476},{"type":42,"tag":401,"props":12898,"children":12901},{"code":12714,"language":12899,"meta":8,"className":12900,"style":8},"sh","language-sh shiki shiki-themes github-light github-dark monokai",[12902],{"type":42,"tag":349,"props":12903,"children":12904},{"__ignoreMap":8},[12905],{"type":42,"tag":467,"props":12906,"children":12907},{"class":469,"line":470},[12908,12912,12917,12922,12926,12931,12936],{"type":42,"tag":467,"props":12909,"children":12910},{"style":1991},[12911],{"type":48,"value":12895},{"type":42,"tag":467,"props":12913,"children":12914},{"style":564},[12915],{"type":48,"value":12916}," update",{"type":42,"tag":467,"props":12918,"children":12919},{"style":480},[12920],{"type":48,"value":12921}," && ",{"type":42,"tag":467,"props":12923,"children":12924},{"style":1991},[12925],{"type":48,"value":12895},{"type":42,"tag":467,"props":12927,"children":12928},{"style":564},[12929],{"type":48,"value":12930}," add",{"type":42,"tag":467,"props":12932,"children":12933},{"style":564},[12934],{"type":48,"value":12935}," openssh-client",{"type":42,"tag":467,"props":12937,"children":12938},{"style":564},[12939],{"type":48,"value":12940}," bash\n",{"type":42,"tag":51,"props":12942,"children":12943},{},[12944,12946,12951,12953,12958,12960,12966,12968,12974,12975,12981],{"type":48,"value":12945},"Next, we add the ",{"type":42,"tag":349,"props":12947,"children":12949},{"className":12948},[],[12950],{"type":48,"value":11382},{"type":48,"value":12952}," environment variable into the body of the ",{"type":42,"tag":349,"props":12954,"children":12956},{"className":12955},[],[12957],{"type":48,"value":12313},{"type":48,"value":12959}," private key file, change the permission of this file and then add the key to our SSH agent. Here's an excerpt from ",{"type":42,"tag":349,"props":12961,"children":12963},{"className":12962},[],[12964],{"type":48,"value":12965},"man ssh-agent",{"type":48,"value":12967}," that provides a little bit more context into why we need to run ",{"type":42,"tag":349,"props":12969,"children":12971},{"className":12970},[],[12972],{"type":48,"value":12973},"eval \"$(ssh-agent -s)\"",{"type":48,"value":2751},{"type":42,"tag":349,"props":12976,"children":12978},{"className":12977},[],[12979],{"type":48,"value":12980},"ssh-add ~/.ssh/id_rsa",{"type":48,"value":4476},{"type":42,"tag":401,"props":12983,"children":12985},{"code":12984},"DESCRIPTION\n     ssh-agent is a program to hold private keys used for public key authentication (RSA, DSA, ECDSA, Ed25519)ssh-agent is usually started in the beginning of an X-session or a login session, and all other windows or programs are started as clients to the ssh-agent program.  Through use of environment variables the agent can be located and automatically used for authentication when logging in to other machines using ssh(1).\n\n     The agent initially does not have any private keys.  Keys are added using ssh(1) (see AddKeysToAgent in ssh_config(5) for details) or ssh-add(1).  Multiple identities may be stored in ssh-agent concurrently and ssh(1) will automatically use them if present.  ssh-add(1) is also used to remove keys from ssh-agent and to query the keys that are held in one.\n",[12986],{"type":42,"tag":349,"props":12987,"children":12988},{"__ignoreMap":8},[12989],{"type":48,"value":12984},{"type":42,"tag":51,"props":12991,"children":12992},{},[12993,12995,13001,13003,13009],{"type":48,"value":12994},"Next, ",{"type":42,"tag":349,"props":12996,"children":12998},{"className":12997},[],[12999],{"type":48,"value":13000},"ssh-keyscan -H $DROPLET_IP >> ~/.ssh/known_hosts",{"type":48,"value":13002}," tells our SSH agent about our Droplet so that it doesn't prompt us with a ",{"type":42,"tag":349,"props":13004,"children":13006},{"className":13005},[],[13007],{"type":48,"value":13008},"Do you want to add this server to known hosts? (yes/no)",{"type":48,"value":13010},", or whatever the equivalent of that is for the docker CLI when it attempts to connect to a remote docker daemon over SSH.",{"type":42,"tag":51,"props":13012,"children":13013},{},[13014],{"type":48,"value":13015},"Finally, we login to our our GitLab private registry using the same command from before when we built and pushed images to our private registry on gitlab.com:",{"type":42,"tag":401,"props":13017,"children":13018},{"code":11810},[13019],{"type":42,"tag":349,"props":13020,"children":13021},{"__ignoreMap":8},[13022],{"type":48,"value":11810},{"type":42,"tag":51,"props":13024,"children":13025},{},[13026,13028,13033,13034,13039],{"type":48,"value":13027},"This essentially gives our DigitalOcean Droplet access to the ",{"type":42,"tag":349,"props":13029,"children":13031},{"className":13030},[],[13032],{"type":48,"value":7997},{"type":48,"value":2751},{"type":42,"tag":349,"props":13035,"children":13037},{"className":13036},[],[13038],{"type":48,"value":11069},{"type":48,"value":13040}," images in our private GitLab CI image registry, even tho we are running this command in a contain, in a container that is probably running in Kubernetes on GCP. Next, we are actually going to use these images.",{"type":42,"tag":51,"props":13042,"children":13043},{},[13044,13046,13051],{"type":48,"value":13045},"The last command in the ",{"type":42,"tag":349,"props":13047,"children":13049},{"className":13048},[],[13050],{"type":48,"value":12590},{"type":48,"value":13052}," job is:",{"type":42,"tag":401,"props":13054,"children":13055},{"code":12820},[13056],{"type":42,"tag":349,"props":13057,"children":13058},{"__ignoreMap":8},[13059],{"type":48,"value":12820},{"type":42,"tag":51,"props":13061,"children":13062},{},[13063,13065,13071,13072,13078],{"type":48,"value":13064},"Check out this link from the docker docs on docker stacks ",{"type":42,"tag":138,"props":13066,"children":13069},{"href":13067,"rel":13068},"https://docs.docker.com/engine/swarm/stack-deploy/",[142],[13070],{"type":48,"value":13067},{"type":48,"value":7015},{"type":42,"tag":349,"props":13073,"children":13075},{"className":13074},[],[13076],{"type":48,"value":13077},"--with-registry-auth",{"type":48,"value":13079}," is important, our command will complete if this is not included, but our application won't start.",{"type":42,"tag":112,"props":13081,"children":13083},{"id":13082},"stackyml",[13084],{"type":42,"tag":349,"props":13085,"children":13087},{"className":13086},[],[13088],{"type":48,"value":13089},"stack.yml",{"type":42,"tag":51,"props":13091,"children":13092},{},[13093,13095,13100,13102,13107,13109,13114,13116,13121],{"type":48,"value":13094},"Now we are ready to tackle the last big file in our repo: ",{"type":42,"tag":349,"props":13096,"children":13098},{"className":13097},[],[13099],{"type":48,"value":13089},{"type":48,"value":13101},". This is a the docker-compose file that we use to deploy our project. The only reason we needed to run ",{"type":42,"tag":349,"props":13103,"children":13105},{"className":13104},[],[13106],{"type":48,"value":12184},{"type":48,"value":13108}," above is because ",{"type":42,"tag":349,"props":13110,"children":13112},{"className":13111},[],[13113],{"type":48,"value":13089},{"type":48,"value":13115}," references the two images we built and pushed to our GitLab private repo. There's a lot going on in this file, let's start with the ",{"type":42,"tag":349,"props":13117,"children":13119},{"className":13118},[],[13120],{"type":48,"value":7997},{"type":48,"value":13122}," service:",{"type":42,"tag":280,"props":13124,"children":13125},{"id":7997},[13126],{"type":48,"value":7997},{"type":42,"tag":401,"props":13128,"children":13130},{"code":13129,"language":3649,"meta":8,"className":3650,"style":8},"version: '3.4'\nservices:\n  backend:\n  image: ${CI_REGISTRY_IMAGE}/backend:${CI_COMMIT_SHORT_SHA}\n  networks:\n    - main\n  environment:\n    - POSTGRES_PASSWORD\n    - SECRET_KEY\n    - DEBUG\n  volumes:\n    - backendassets:/code/assets\n  depends_on:\n    - postgres\n    - redis\n    - web\n",[13131],{"type":42,"tag":349,"props":13132,"children":13133},{"__ignoreMap":8},[13134,13151,13162,13174,13190,13202,13214,13226,13238,13250,13262,13274,13286,13298,13310,13322],{"type":42,"tag":467,"props":13135,"children":13136},{"class":469,"line":470},[13137,13142,13146],{"type":42,"tag":467,"props":13138,"children":13139},{"style":3660},[13140],{"type":48,"value":13141},"version",{"type":42,"tag":467,"props":13143,"children":13144},{"style":480},[13145],{"type":48,"value":3668},{"type":42,"tag":467,"props":13147,"children":13148},{"style":564},[13149],{"type":48,"value":13150},"'3.4'\n",{"type":42,"tag":467,"props":13152,"children":13153},{"class":469,"line":486},[13154,13158],{"type":42,"tag":467,"props":13155,"children":13156},{"style":3660},[13157],{"type":48,"value":12231},{"type":42,"tag":467,"props":13159,"children":13160},{"style":480},[13161],{"type":48,"value":3693},{"type":42,"tag":467,"props":13163,"children":13164},{"class":469,"line":499},[13165,13170],{"type":42,"tag":467,"props":13166,"children":13167},{"style":3660},[13168],{"type":48,"value":13169},"  backend",{"type":42,"tag":467,"props":13171,"children":13172},{"style":480},[13173],{"type":48,"value":3693},{"type":42,"tag":467,"props":13175,"children":13176},{"class":469,"line":522},[13177,13181,13185],{"type":42,"tag":467,"props":13178,"children":13179},{"style":3660},[13180],{"type":48,"value":11752},{"type":42,"tag":467,"props":13182,"children":13183},{"style":480},[13184],{"type":48,"value":3668},{"type":42,"tag":467,"props":13186,"children":13187},{"style":564},[13188],{"type":48,"value":13189},"${CI_REGISTRY_IMAGE}/backend:${CI_COMMIT_SHORT_SHA}\n",{"type":42,"tag":467,"props":13191,"children":13192},{"class":469,"line":531},[13193,13198],{"type":42,"tag":467,"props":13194,"children":13195},{"style":3660},[13196],{"type":48,"value":13197},"  networks",{"type":42,"tag":467,"props":13199,"children":13200},{"style":480},[13201],{"type":48,"value":3693},{"type":42,"tag":467,"props":13203,"children":13204},{"class":469,"line":550},[13205,13209],{"type":42,"tag":467,"props":13206,"children":13207},{"style":480},[13208],{"type":48,"value":11781},{"type":42,"tag":467,"props":13210,"children":13211},{"style":564},[13212],{"type":48,"value":13213},"main\n",{"type":42,"tag":467,"props":13215,"children":13216},{"class":469,"line":575},[13217,13222],{"type":42,"tag":467,"props":13218,"children":13219},{"style":3660},[13220],{"type":48,"value":13221},"  environment",{"type":42,"tag":467,"props":13223,"children":13224},{"style":480},[13225],{"type":48,"value":3693},{"type":42,"tag":467,"props":13227,"children":13228},{"class":469,"line":598},[13229,13233],{"type":42,"tag":467,"props":13230,"children":13231},{"style":480},[13232],{"type":48,"value":11781},{"type":42,"tag":467,"props":13234,"children":13235},{"style":564},[13236],{"type":48,"value":13237},"POSTGRES_PASSWORD\n",{"type":42,"tag":467,"props":13239,"children":13240},{"class":469,"line":616},[13241,13245],{"type":42,"tag":467,"props":13242,"children":13243},{"style":480},[13244],{"type":48,"value":11781},{"type":42,"tag":467,"props":13246,"children":13247},{"style":564},[13248],{"type":48,"value":13249},"SECRET_KEY\n",{"type":42,"tag":467,"props":13251,"children":13252},{"class":469,"line":625},[13253,13257],{"type":42,"tag":467,"props":13254,"children":13255},{"style":480},[13256],{"type":48,"value":11781},{"type":42,"tag":467,"props":13258,"children":13259},{"style":564},[13260],{"type":48,"value":13261},"DEBUG\n",{"type":42,"tag":467,"props":13263,"children":13264},{"class":469,"line":633},[13265,13270],{"type":42,"tag":467,"props":13266,"children":13267},{"style":3660},[13268],{"type":48,"value":13269},"  volumes",{"type":42,"tag":467,"props":13271,"children":13272},{"style":480},[13273],{"type":48,"value":3693},{"type":42,"tag":467,"props":13275,"children":13276},{"class":469,"line":664},[13277,13281],{"type":42,"tag":467,"props":13278,"children":13279},{"style":480},[13280],{"type":48,"value":11781},{"type":42,"tag":467,"props":13282,"children":13283},{"style":564},[13284],{"type":48,"value":13285},"backendassets:/code/assets\n",{"type":42,"tag":467,"props":13287,"children":13288},{"class":469,"line":672},[13289,13294],{"type":42,"tag":467,"props":13290,"children":13291},{"style":3660},[13292],{"type":48,"value":13293},"  depends_on",{"type":42,"tag":467,"props":13295,"children":13296},{"style":480},[13297],{"type":48,"value":3693},{"type":42,"tag":467,"props":13299,"children":13300},{"class":469,"line":690},[13301,13305],{"type":42,"tag":467,"props":13302,"children":13303},{"style":480},[13304],{"type":48,"value":11781},{"type":42,"tag":467,"props":13306,"children":13307},{"style":564},[13308],{"type":48,"value":13309},"postgres\n",{"type":42,"tag":467,"props":13311,"children":13312},{"class":469,"line":1336},[13313,13317],{"type":42,"tag":467,"props":13314,"children":13315},{"style":480},[13316],{"type":48,"value":11781},{"type":42,"tag":467,"props":13318,"children":13319},{"style":564},[13320],{"type":48,"value":13321},"redis\n",{"type":42,"tag":467,"props":13323,"children":13324},{"class":469,"line":1344},[13325,13329],{"type":42,"tag":467,"props":13326,"children":13327},{"style":480},[13328],{"type":48,"value":11781},{"type":42,"tag":467,"props":13330,"children":13331},{"style":564},[13332],{"type":48,"value":13333},"web\n",{"type":42,"tag":51,"props":13335,"children":13336},{},[13337,13338,13343,13345,13350],{"type":48,"value":3197},{"type":42,"tag":349,"props":13339,"children":13341},{"className":13340},[],[13342],{"type":48,"value":12223},{"type":48,"value":13344}," is essentially what we defined in ",{"type":42,"tag":349,"props":13346,"children":13348},{"className":13347},[],[13349],{"type":48,"value":11184},{"type":48,"value":13351},", but the syntax is slightly different:",{"type":42,"tag":401,"props":13353,"children":13354},{"code":13189},[13355],{"type":42,"tag":349,"props":13356,"children":13357},{"__ignoreMap":8},[13358],{"type":48,"value":13189},{"type":42,"tag":51,"props":13360,"children":13361},{},[13362,13364,13370],{"type":48,"value":13363},"We pass environment variables that we defined in GitLab CI via the ",{"type":42,"tag":349,"props":13365,"children":13367},{"className":13366},[],[13368],{"type":48,"value":13369},"environment",{"type":48,"value":13371}," key.",{"type":42,"tag":51,"props":13373,"children":13374},{},[13375,13377,13383,13385,13391,13393,13399,13401,13407],{"type":48,"value":13376},"The volume ",{"type":42,"tag":349,"props":13378,"children":13380},{"className":13379},[],[13381],{"type":48,"value":13382},"backendassets",{"type":48,"value":13384}," is used for storing static assets (CSS, JS, etc.) as well as media assets (images, videos, any other file type). We mount this directory at ",{"type":42,"tag":349,"props":13386,"children":13388},{"className":13387},[],[13389],{"type":48,"value":13390},"/code/assets",{"type":48,"value":13392}," and then define our ",{"type":42,"tag":349,"props":13394,"children":13396},{"className":13395},[],[13397],{"type":48,"value":13398},"STATIC_ROOT",{"type":48,"value":13400}," in Django's ",{"type":42,"tag":349,"props":13402,"children":13404},{"className":13403},[],[13405],{"type":48,"value":13406},"settings.py",{"type":48,"value":13408}," to be:",{"type":42,"tag":401,"props":13410,"children":13412},{"code":13411,"language":1092,"meta":8,"className":1093,"style":8},"os.path.join(BASE_DIR, \"assets\", \"static\")\n",[13413],{"type":42,"tag":349,"props":13414,"children":13415},{"__ignoreMap":8},[13416],{"type":42,"tag":467,"props":13417,"children":13418},{"class":469,"line":470},[13419,13424,13429,13433,13438,13442,13447],{"type":42,"tag":467,"props":13420,"children":13421},{"style":480},[13422],{"type":48,"value":13423},"os.path.join(",{"type":42,"tag":467,"props":13425,"children":13426},{"style":588},[13427],{"type":48,"value":13428},"BASE_DIR",{"type":42,"tag":467,"props":13430,"children":13431},{"style":480},[13432],{"type":48,"value":935},{"type":42,"tag":467,"props":13434,"children":13435},{"style":564},[13436],{"type":48,"value":13437},"\"assets\"",{"type":42,"tag":467,"props":13439,"children":13440},{"style":480},[13441],{"type":48,"value":935},{"type":42,"tag":467,"props":13443,"children":13444},{"style":564},[13445],{"type":48,"value":13446},"\"static\"",{"type":42,"tag":467,"props":13448,"children":13449},{"style":480},[13450],{"type":48,"value":622},{"type":42,"tag":51,"props":13452,"children":13453},{},[13454,13456,13462],{"type":48,"value":13455},"Later, when we run ",{"type":42,"tag":349,"props":13457,"children":13459},{"className":13458},[],[13460],{"type":48,"value":13461},"collectstatic",{"type":48,"value":13463},", files are copied to this location in our container, and since this is the location of the volume, the files are actually copied to the volume and will be persisted if we destroy the backend container and restart it. When the container restarts, the volume is mounted again and the static files will still be available to our application.",{"type":42,"tag":51,"props":13465,"children":13466},{},[13467,13473,13474,13480,13482,13488,13490,13496,13498,13503,13505,13511],{"type":42,"tag":349,"props":13468,"children":13470},{"className":13469},[],[13471],{"type":48,"value":13472},"network",{"type":48,"value":2751},{"type":42,"tag":349,"props":13475,"children":13477},{"className":13476},[],[13478],{"type":48,"value":13479},"depends_on",{"type":48,"value":13481}," related to to the other services that this application will communicate with. ",{"type":42,"tag":349,"props":13483,"children":13485},{"className":13484},[],[13486],{"type":48,"value":13487},"main",{"type":48,"value":13489}," is a network defined in the ",{"type":42,"tag":349,"props":13491,"children":13493},{"className":13492},[],[13494],{"type":48,"value":13495},"networks",{"type":48,"value":13497}," part of ",{"type":42,"tag":349,"props":13499,"children":13501},{"className":13500},[],[13502],{"type":48,"value":13089},{"type":48,"value":13504},", notice that we reference the ",{"type":42,"tag":349,"props":13506,"children":13508},{"className":13507},[],[13509],{"type":48,"value":13510},"traefik-public",{"type":48,"value":13512}," network here that we created earlier, as well.",{"type":42,"tag":723,"props":13514,"children":13515},{},[13516],{"type":42,"tag":51,"props":13517,"children":13518},{},[13519,13521,13527],{"type":48,"value":13520},"Depends on helps with service startup order, but it is a better practice to use ",{"type":42,"tag":349,"props":13522,"children":13524},{"className":13523},[],[13525],{"type":48,"value":13526},"./wait-for-it.sh",{"type":48,"value":13528},". However, I have never had any issues related to startup order. I'll try adding this later to make things more robust.",{"type":42,"tag":51,"props":13530,"children":13531},{},[13532,13537,13538,13544,13546,13551,13553,13558,13559,13564,13566,13571,13572,13577,13578,13583,13585,13590,13592,13598,13600,13606,13608,13613],{"type":42,"tag":349,"props":13533,"children":13535},{"className":13534},[],[13536],{"type":48,"value":7656},{"type":48,"value":2751},{"type":42,"tag":349,"props":13539,"children":13541},{"className":13540},[],[13542],{"type":48,"value":13543},"redis",{"type":48,"value":13545}," will start before ",{"type":42,"tag":349,"props":13547,"children":13549},{"className":13548},[],[13550],{"type":48,"value":7997},{"type":48,"value":13552},". Our Django application will communicate to these services by their hostnames: ",{"type":42,"tag":349,"props":13554,"children":13556},{"className":13555},[],[13557],{"type":48,"value":7656},{"type":48,"value":2751},{"type":42,"tag":349,"props":13560,"children":13562},{"className":13561},[],[13563],{"type":48,"value":13543},{"type":48,"value":13565},". The fact that ",{"type":42,"tag":349,"props":13567,"children":13569},{"className":13568},[],[13570],{"type":48,"value":7997},{"type":48,"value":935},{"type":42,"tag":349,"props":13573,"children":13575},{"className":13574},[],[13576],{"type":48,"value":7656},{"type":48,"value":2751},{"type":42,"tag":349,"props":13579,"children":13581},{"className":13580},[],[13582],{"type":48,"value":13543},{"type":48,"value":13584}," are all on the same network (",{"type":42,"tag":349,"props":13586,"children":13588},{"className":13587},[],[13589],{"type":48,"value":13487},{"type":48,"value":13591},") means that they can resolve each other by these names. For example, the connection string to redis will look like: ",{"type":42,"tag":349,"props":13593,"children":13595},{"className":13594},[],[13596],{"type":48,"value":13597},"redis://redis:6379",{"type":48,"value":13599},". Let's look at the ",{"type":42,"tag":349,"props":13601,"children":13603},{"className":13602},[],[13604],{"type":48,"value":13605},"DATABASES",{"type":48,"value":13607}," configuration in ",{"type":42,"tag":349,"props":13609,"children":13611},{"className":13610},[],[13612],{"type":48,"value":13406},{"type":48,"value":13614}," to see how we connect to Postgres:",{"type":42,"tag":401,"props":13616,"children":13618},{"code":13617,"language":1092,"meta":8,"className":1093,"style":8},"DATABASES = {\n    \"default\": {\n        \"ENGINE\": \"django.db.backends.postgresql_psycopg2\",\n        \"NAME\": os.environ.get(\"POSTGRES_NAME\", \"postgres\"),\n        \"USER\": os.environ.get(\"POSTGRES_USERNAME\", \"postgres\"),\n        \"PASSWORD\": os.environ.get(\"POSTGRES_PASSWORD\", \"postgres\"),\n        \"HOST\": os.environ.get(\"POSTGRES_SERVICE_HOST\", \"postgres\"),\n        \"PORT\": os.environ.get(\"POSTGRES_SERVICE_PORT\", 5432),\n    }\n}\n",[13619],{"type":42,"tag":349,"props":13620,"children":13621},{"__ignoreMap":8},[13622,13638,13651,13672,13704,13733,13762,13791,13821,13829],{"type":42,"tag":467,"props":13623,"children":13624},{"class":469,"line":470},[13625,13629,13633],{"type":42,"tag":467,"props":13626,"children":13627},{"style":588},[13628],{"type":48,"value":13605},{"type":42,"tag":467,"props":13630,"children":13631},{"style":474},[13632],{"type":48,"value":1192},{"type":42,"tag":467,"props":13634,"children":13635},{"style":480},[13636],{"type":48,"value":13637}," {\n",{"type":42,"tag":467,"props":13639,"children":13640},{"class":469,"line":486},[13641,13646],{"type":42,"tag":467,"props":13642,"children":13643},{"style":564},[13644],{"type":48,"value":13645},"    \"default\"",{"type":42,"tag":467,"props":13647,"children":13648},{"style":480},[13649],{"type":48,"value":13650},": {\n",{"type":42,"tag":467,"props":13652,"children":13653},{"class":469,"line":499},[13654,13659,13663,13668],{"type":42,"tag":467,"props":13655,"children":13656},{"style":564},[13657],{"type":48,"value":13658},"        \"ENGINE\"",{"type":42,"tag":467,"props":13660,"children":13661},{"style":480},[13662],{"type":48,"value":3668},{"type":42,"tag":467,"props":13664,"children":13665},{"style":564},[13666],{"type":48,"value":13667},"\"django.db.backends.postgresql_psycopg2\"",{"type":42,"tag":467,"props":13669,"children":13670},{"style":480},[13671],{"type":48,"value":572},{"type":42,"tag":467,"props":13673,"children":13674},{"class":469,"line":522},[13675,13680,13685,13690,13694,13699],{"type":42,"tag":467,"props":13676,"children":13677},{"style":564},[13678],{"type":48,"value":13679},"        \"NAME\"",{"type":42,"tag":467,"props":13681,"children":13682},{"style":480},[13683],{"type":48,"value":13684},": os.environ.get(",{"type":42,"tag":467,"props":13686,"children":13687},{"style":564},[13688],{"type":48,"value":13689},"\"POSTGRES_NAME\"",{"type":42,"tag":467,"props":13691,"children":13692},{"style":480},[13693],{"type":48,"value":935},{"type":42,"tag":467,"props":13695,"children":13696},{"style":564},[13697],{"type":48,"value":13698},"\"postgres\"",{"type":42,"tag":467,"props":13700,"children":13701},{"style":480},[13702],{"type":48,"value":13703},"),\n",{"type":42,"tag":467,"props":13705,"children":13706},{"class":469,"line":531},[13707,13712,13716,13721,13725,13729],{"type":42,"tag":467,"props":13708,"children":13709},{"style":564},[13710],{"type":48,"value":13711},"        \"USER\"",{"type":42,"tag":467,"props":13713,"children":13714},{"style":480},[13715],{"type":48,"value":13684},{"type":42,"tag":467,"props":13717,"children":13718},{"style":564},[13719],{"type":48,"value":13720},"\"POSTGRES_USERNAME\"",{"type":42,"tag":467,"props":13722,"children":13723},{"style":480},[13724],{"type":48,"value":935},{"type":42,"tag":467,"props":13726,"children":13727},{"style":564},[13728],{"type":48,"value":13698},{"type":42,"tag":467,"props":13730,"children":13731},{"style":480},[13732],{"type":48,"value":13703},{"type":42,"tag":467,"props":13734,"children":13735},{"class":469,"line":550},[13736,13741,13745,13750,13754,13758],{"type":42,"tag":467,"props":13737,"children":13738},{"style":564},[13739],{"type":48,"value":13740},"        \"PASSWORD\"",{"type":42,"tag":467,"props":13742,"children":13743},{"style":480},[13744],{"type":48,"value":13684},{"type":42,"tag":467,"props":13746,"children":13747},{"style":564},[13748],{"type":48,"value":13749},"\"POSTGRES_PASSWORD\"",{"type":42,"tag":467,"props":13751,"children":13752},{"style":480},[13753],{"type":48,"value":935},{"type":42,"tag":467,"props":13755,"children":13756},{"style":564},[13757],{"type":48,"value":13698},{"type":42,"tag":467,"props":13759,"children":13760},{"style":480},[13761],{"type":48,"value":13703},{"type":42,"tag":467,"props":13763,"children":13764},{"class":469,"line":575},[13765,13770,13774,13779,13783,13787],{"type":42,"tag":467,"props":13766,"children":13767},{"style":564},[13768],{"type":48,"value":13769},"        \"HOST\"",{"type":42,"tag":467,"props":13771,"children":13772},{"style":480},[13773],{"type":48,"value":13684},{"type":42,"tag":467,"props":13775,"children":13776},{"style":564},[13777],{"type":48,"value":13778},"\"POSTGRES_SERVICE_HOST\"",{"type":42,"tag":467,"props":13780,"children":13781},{"style":480},[13782],{"type":48,"value":935},{"type":42,"tag":467,"props":13784,"children":13785},{"style":564},[13786],{"type":48,"value":13698},{"type":42,"tag":467,"props":13788,"children":13789},{"style":480},[13790],{"type":48,"value":13703},{"type":42,"tag":467,"props":13792,"children":13793},{"class":469,"line":598},[13794,13799,13803,13808,13812,13817],{"type":42,"tag":467,"props":13795,"children":13796},{"style":564},[13797],{"type":48,"value":13798},"        \"PORT\"",{"type":42,"tag":467,"props":13800,"children":13801},{"style":480},[13802],{"type":48,"value":13684},{"type":42,"tag":467,"props":13804,"children":13805},{"style":564},[13806],{"type":48,"value":13807},"\"POSTGRES_SERVICE_PORT\"",{"type":42,"tag":467,"props":13809,"children":13810},{"style":480},[13811],{"type":48,"value":935},{"type":42,"tag":467,"props":13813,"children":13814},{"style":588},[13815],{"type":48,"value":13816},"5432",{"type":42,"tag":467,"props":13818,"children":13819},{"style":480},[13820],{"type":48,"value":13703},{"type":42,"tag":467,"props":13822,"children":13823},{"class":469,"line":616},[13824],{"type":42,"tag":467,"props":13825,"children":13826},{"style":480},[13827],{"type":48,"value":13828},"    }\n",{"type":42,"tag":467,"props":13830,"children":13831},{"class":469,"line":625},[13832],{"type":42,"tag":467,"props":13833,"children":13834},{"style":480},[13835],{"type":48,"value":13836},"}\n",{"type":42,"tag":51,"props":13838,"children":13839},{},[13840,13842,13848,13850,13856,13858,13864],{"type":48,"value":13841},"I have defined the ",{"type":42,"tag":349,"props":13843,"children":13845},{"className":13844},[],[13846],{"type":48,"value":13847},"HOST",{"type":48,"value":13849}," to be based on the environment variable ",{"type":42,"tag":349,"props":13851,"children":13853},{"className":13852},[],[13854],{"type":48,"value":13855},"POSTGRES_HOST",{"type":48,"value":13857},", but I have not defined this environment variable, so why didn't I just say ",{"type":42,"tag":349,"props":13859,"children":13861},{"className":13860},[],[13862],{"type":48,"value":13863},"\"HOST\": \"postgres\"",{"type":48,"value":13865},"? I could have, but if I want to change the database in the future, the only change will be adding an environment variable; I won't have to worry about hardcoded values.",{"type":42,"tag":51,"props":13867,"children":13868},{},[13869],{"type":48,"value":13870},"I'm choosing to run Postgres in a container and not use a managed database (which DigitalOcean does offer) in order to save on costs and also to get more practice managing my own database. I use RDS with AWS and it handles a lot of things that I don't have to worry about, such as backups, and it allows me to quickly restore from a snapshot. I'm interested in learning more about how I can do these tasks with a database that I run myself.",{"type":42,"tag":280,"props":13872,"children":13873},{"id":11069},[13874],{"type":48,"value":13875},"NGINX",{"type":42,"tag":51,"props":13877,"children":13878},{},[13879,13881,13886],{"type":48,"value":13880},"The next service we should go over is ",{"type":42,"tag":349,"props":13882,"children":13884},{"className":13883},[],[13885],{"type":48,"value":10493},{"type":48,"value":13887},", the service that runs the NGINX container that we pushed to our private GitLab image registry. This service has a couple of functions that I'll walk through:",{"type":42,"tag":3541,"props":13889,"children":13890},{},[13891,13896,13901],{"type":42,"tag":61,"props":13892,"children":13893},{},[13894],{"type":48,"value":13895},"Reverse proxy",{"type":42,"tag":61,"props":13897,"children":13898},{},[13899],{"type":48,"value":13900},"Serve static files for Django",{"type":42,"tag":61,"props":13902,"children":13903},{},[13904],{"type":48,"value":13905},"Serve a frontend Javascript application",{"type":42,"tag":51,"props":13907,"children":13908},{},[13909,13911,13916],{"type":48,"value":13910},"Here's the definition of this service in ",{"type":42,"tag":349,"props":13912,"children":13914},{"className":13913},[],[13915],{"type":48,"value":13089},{"type":48,"value":4476},{"type":42,"tag":401,"props":13918,"children":13920},{"code":13919,"language":3649,"meta":8,"className":3650,"style":8},"services:\n  web:\n    image: ${CI_REGISTRY_IMAGE}/nginx:${CI_COMMIT_SHORT_SHA}\n    networks:\n      - traefik-public\n      - main\n    volumes:\n      - backendassets:/usr/src/app/assets\n    deploy:\n      labels:\n        - 'traefik.enable=true'\n        - 'traefik.http.routers.nginx-web.rule=Host(`mysite.com`)'\n        - 'traefik.http.routers.nginx-web.entrypoints=websecure'\n        - 'traefik.http.routers.nginx-web.tls.certresolver=letsencryptresolver'\n        - 'traefik.http.services.nginx-web.loadbalancer.server.port=80'\n",[13921],{"type":42,"tag":349,"props":13922,"children":13923},{"__ignoreMap":8},[13924,13935,13947,13964,13976,13988,13999,14011,14023,14035,14047,14060,14072,14084,14096],{"type":42,"tag":467,"props":13925,"children":13926},{"class":469,"line":470},[13927,13931],{"type":42,"tag":467,"props":13928,"children":13929},{"style":3660},[13930],{"type":48,"value":12231},{"type":42,"tag":467,"props":13932,"children":13933},{"style":480},[13934],{"type":48,"value":3693},{"type":42,"tag":467,"props":13936,"children":13937},{"class":469,"line":486},[13938,13943],{"type":42,"tag":467,"props":13939,"children":13940},{"style":3660},[13941],{"type":48,"value":13942},"  web",{"type":42,"tag":467,"props":13944,"children":13945},{"style":480},[13946],{"type":48,"value":3693},{"type":42,"tag":467,"props":13948,"children":13949},{"class":469,"line":499},[13950,13955,13959],{"type":42,"tag":467,"props":13951,"children":13952},{"style":3660},[13953],{"type":48,"value":13954},"    image",{"type":42,"tag":467,"props":13956,"children":13957},{"style":480},[13958],{"type":48,"value":3668},{"type":42,"tag":467,"props":13960,"children":13961},{"style":564},[13962],{"type":48,"value":13963},"${CI_REGISTRY_IMAGE}/nginx:${CI_COMMIT_SHORT_SHA}\n",{"type":42,"tag":467,"props":13965,"children":13966},{"class":469,"line":522},[13967,13972],{"type":42,"tag":467,"props":13968,"children":13969},{"style":3660},[13970],{"type":48,"value":13971},"    networks",{"type":42,"tag":467,"props":13973,"children":13974},{"style":480},[13975],{"type":48,"value":3693},{"type":42,"tag":467,"props":13977,"children":13978},{"class":469,"line":531},[13979,13983],{"type":42,"tag":467,"props":13980,"children":13981},{"style":480},[13982],{"type":48,"value":3725},{"type":42,"tag":467,"props":13984,"children":13985},{"style":564},[13986],{"type":48,"value":13987},"traefik-public\n",{"type":42,"tag":467,"props":13989,"children":13990},{"class":469,"line":550},[13991,13995],{"type":42,"tag":467,"props":13992,"children":13993},{"style":480},[13994],{"type":48,"value":3725},{"type":42,"tag":467,"props":13996,"children":13997},{"style":564},[13998],{"type":48,"value":13213},{"type":42,"tag":467,"props":14000,"children":14001},{"class":469,"line":575},[14002,14007],{"type":42,"tag":467,"props":14003,"children":14004},{"style":3660},[14005],{"type":48,"value":14006},"    volumes",{"type":42,"tag":467,"props":14008,"children":14009},{"style":480},[14010],{"type":48,"value":3693},{"type":42,"tag":467,"props":14012,"children":14013},{"class":469,"line":598},[14014,14018],{"type":42,"tag":467,"props":14015,"children":14016},{"style":480},[14017],{"type":48,"value":3725},{"type":42,"tag":467,"props":14019,"children":14020},{"style":564},[14021],{"type":48,"value":14022},"backendassets:/usr/src/app/assets\n",{"type":42,"tag":467,"props":14024,"children":14025},{"class":469,"line":616},[14026,14031],{"type":42,"tag":467,"props":14027,"children":14028},{"style":3660},[14029],{"type":48,"value":14030},"    deploy",{"type":42,"tag":467,"props":14032,"children":14033},{"style":480},[14034],{"type":48,"value":3693},{"type":42,"tag":467,"props":14036,"children":14037},{"class":469,"line":625},[14038,14043],{"type":42,"tag":467,"props":14039,"children":14040},{"style":3660},[14041],{"type":48,"value":14042},"      labels",{"type":42,"tag":467,"props":14044,"children":14045},{"style":480},[14046],{"type":48,"value":3693},{"type":42,"tag":467,"props":14048,"children":14049},{"class":469,"line":633},[14050,14055],{"type":42,"tag":467,"props":14051,"children":14052},{"style":480},[14053],{"type":48,"value":14054},"        - ",{"type":42,"tag":467,"props":14056,"children":14057},{"style":564},[14058],{"type":48,"value":14059},"'traefik.enable=true'\n",{"type":42,"tag":467,"props":14061,"children":14062},{"class":469,"line":664},[14063,14067],{"type":42,"tag":467,"props":14064,"children":14065},{"style":480},[14066],{"type":48,"value":14054},{"type":42,"tag":467,"props":14068,"children":14069},{"style":564},[14070],{"type":48,"value":14071},"'traefik.http.routers.nginx-web.rule=Host(`mysite.com`)'\n",{"type":42,"tag":467,"props":14073,"children":14074},{"class":469,"line":672},[14075,14079],{"type":42,"tag":467,"props":14076,"children":14077},{"style":480},[14078],{"type":48,"value":14054},{"type":42,"tag":467,"props":14080,"children":14081},{"style":564},[14082],{"type":48,"value":14083},"'traefik.http.routers.nginx-web.entrypoints=websecure'\n",{"type":42,"tag":467,"props":14085,"children":14086},{"class":469,"line":690},[14087,14091],{"type":42,"tag":467,"props":14088,"children":14089},{"style":480},[14090],{"type":48,"value":14054},{"type":42,"tag":467,"props":14092,"children":14093},{"style":564},[14094],{"type":48,"value":14095},"'traefik.http.routers.nginx-web.tls.certresolver=letsencryptresolver'\n",{"type":42,"tag":467,"props":14097,"children":14098},{"class":469,"line":1336},[14099,14103],{"type":42,"tag":467,"props":14100,"children":14101},{"style":480},[14102],{"type":48,"value":14054},{"type":42,"tag":467,"props":14104,"children":14105},{"style":564},[14106],{"type":48,"value":14107},"'traefik.http.services.nginx-web.loadbalancer.server.port=80'\n",{"type":42,"tag":51,"props":14109,"children":14110},{},[14111,14113,14118,14120,14125],{"type":48,"value":14112},"For now, ignore the contents under the ",{"type":42,"tag":349,"props":14114,"children":14116},{"className":14115},[],[14117],{"type":48,"value":11665},{"type":48,"value":14119}," key; we will cover this next when we go over the ",{"type":42,"tag":349,"props":14121,"children":14123},{"className":14122},[],[14124],{"type":48,"value":11068},{"type":48,"value":14126}," service.",{"type":42,"tag":51,"props":14128,"children":14129},{},[14130,14132,14138,14139,14145,14147,14152,14154,14160],{"type":48,"value":14131},"NGINX acts as a reverse proxy when it sends request starting with ",{"type":42,"tag":349,"props":14133,"children":14135},{"className":14134},[],[14136],{"type":48,"value":14137},"/api",{"type":48,"value":7768},{"type":42,"tag":349,"props":14140,"children":14142},{"className":14141},[],[14143],{"type":48,"value":14144},"/admin",{"type":48,"value":14146}," to the ",{"type":42,"tag":349,"props":14148,"children":14150},{"className":14149},[],[14151],{"type":48,"value":7997},{"type":48,"value":14153}," container. Two blocks in ",{"type":42,"tag":349,"props":14155,"children":14157},{"className":14156},[],[14158],{"type":48,"value":14159},"prod.conf",{"type":48,"value":14161}," enable this behavior:",{"type":42,"tag":401,"props":14163,"children":14165},{"code":14164},"  upstream backend {\n    server backend:8000;\n  }\n",[14166],{"type":42,"tag":349,"props":14167,"children":14168},{"__ignoreMap":8},[14169],{"type":48,"value":14164},{"type":42,"tag":51,"props":14171,"children":14172},{},[14173,14175,14180,14182,14187,14188,14193,14195,14200,14202,14207,14209,14214,14216,14221,14222,14227,14229,14234,14236,14241],{"type":48,"value":14174},"This hostname ",{"type":42,"tag":349,"props":14176,"children":14178},{"className":14177},[],[14179],{"type":48,"value":7997},{"type":48,"value":14181}," is defined as ",{"type":42,"tag":349,"props":14183,"children":14185},{"className":14184},[],[14186],{"type":48,"value":6822},{"type":48,"value":7015},{"type":42,"tag":349,"props":14189,"children":14191},{"className":14190},[],[14192],{"type":48,"value":6822},{"type":48,"value":14194}," can be resolved by the ",{"type":42,"tag":349,"props":14196,"children":14198},{"className":14197},[],[14199],{"type":48,"value":10493},{"type":48,"value":14201}," service because it is on the same ",{"type":42,"tag":349,"props":14203,"children":14205},{"className":14204},[],[14206],{"type":48,"value":13487},{"type":48,"value":14208}," network that ",{"type":42,"tag":349,"props":14210,"children":14212},{"className":14211},[],[14213],{"type":48,"value":7997},{"type":48,"value":14215}," is on. If either of the ",{"type":42,"tag":349,"props":14217,"children":14219},{"className":14218},[],[14220],{"type":48,"value":10493},{"type":48,"value":7768},{"type":42,"tag":349,"props":14223,"children":14225},{"className":14224},[],[14226],{"type":48,"value":7997},{"type":48,"value":14228}," wasn't on the ",{"type":42,"tag":349,"props":14230,"children":14232},{"className":14231},[],[14233],{"type":48,"value":13487},{"type":48,"value":14235}," network, NGINX would not be able to make sense of ",{"type":42,"tag":349,"props":14237,"children":14239},{"className":14238},[],[14240],{"type":48,"value":6822},{"type":48,"value":1970},{"type":42,"tag":401,"props":14243,"children":14245},{"code":14244},"    # backend urls\n    location ~ ^/(admin|api) {\n      proxy_redirect off;\n      proxy_pass http://backend;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header Host $http_host;\n    }\n",[14246],{"type":42,"tag":349,"props":14247,"children":14248},{"__ignoreMap":8},[14249],{"type":48,"value":14244},{"type":42,"tag":51,"props":14251,"children":14252},{},[14253,14255,14260,14262,14268],{"type":48,"value":14254},"This block does that actual request forwarding. ",{"type":42,"tag":349,"props":14256,"children":14258},{"className":14257},[],[14259],{"type":48,"value":7837},{"type":48,"value":14261}," references the ",{"type":42,"tag":349,"props":14263,"children":14265},{"className":14264},[],[14266],{"type":48,"value":14267},"upstream backend {}",{"type":48,"value":14269}," block defined above.",{"type":42,"tag":51,"props":14271,"children":14272},{},[14273,14274,14279,14281,14287,14289,14294],{"type":48,"value":13376},{"type":42,"tag":349,"props":14275,"children":14277},{"className":14276},[],[14278],{"type":48,"value":13382},{"type":48,"value":14280}," is referenced here and mounts to ",{"type":42,"tag":349,"props":14282,"children":14284},{"className":14283},[],[14285],{"type":48,"value":14286},"/usr/src/app/assets",{"type":48,"value":14288},". This path is then referenced in ",{"type":42,"tag":349,"props":14290,"children":14292},{"className":14291},[],[14293],{"type":48,"value":14159},{"type":48,"value":14295},", the NGINX configuration file that is used in our custom NGINX-based image:",{"type":42,"tag":401,"props":14297,"children":14299},{"code":14298},"    # static files\n    location /static {\n      autoindex on;\n      alias /usr/src/app/assets/static;\n    }\n",[14300],{"type":42,"tag":349,"props":14301,"children":14302},{"__ignoreMap":8},[14303],{"type":48,"value":14298},{"type":42,"tag":51,"props":14305,"children":14306},{},[14307,14309,14314,14316,14322,14324,14329,14331,14337,14339,14344,14346,14352,14354,14359,14361,14366,14368,14373,14375,14380],{"type":48,"value":14308},"In this block of ",{"type":42,"tag":349,"props":14310,"children":14312},{"className":14311},[],[14313],{"type":48,"value":14159},{"type":48,"value":14315},", we tell NGINX to serve files from ",{"type":42,"tag":349,"props":14317,"children":14319},{"className":14318},[],[14320],{"type":48,"value":14321},"/usr/src/app/assets/static",{"type":48,"value":14323}," for requests that start with ",{"type":42,"tag":349,"props":14325,"children":14327},{"className":14326},[],[14328],{"type":48,"value":10884},{"type":48,"value":14330},". A request made to ",{"type":42,"tag":349,"props":14332,"children":14334},{"className":14333},[],[14335],{"type":48,"value":14336},"https://mysite.com/static/base.css",{"type":48,"value":14338}," would return a file located at ",{"type":42,"tag":349,"props":14340,"children":14342},{"className":14341},[],[14343],{"type":48,"value":14321},{"type":48,"value":14345}," if that file existed. Remember, when we run the ",{"type":42,"tag":349,"props":14347,"children":14349},{"className":14348},[],[14350],{"type":48,"value":14351},"collecstatic",{"type":48,"value":14353}," management command in our Django container, it will collect our static files to ",{"type":42,"tag":349,"props":14355,"children":14357},{"className":14356},[],[14358],{"type":48,"value":13382},{"type":48,"value":14360},". Since ",{"type":42,"tag":349,"props":14362,"children":14364},{"className":14363},[],[14365],{"type":48,"value":13382},{"type":48,"value":14367}," is mounted to the ",{"type":42,"tag":349,"props":14369,"children":14371},{"className":14370},[],[14372],{"type":48,"value":10493},{"type":48,"value":14374}," service at ",{"type":42,"tag":349,"props":14376,"children":14378},{"className":14377},[],[14379],{"type":48,"value":14286},{"type":48,"value":14381},", NGINX will have access to these files by way of the volume mount and they will persist across restarts of the web service and its NGINX container.",{"type":42,"tag":51,"props":14383,"children":14384},{},[14385,14387,14392],{"type":48,"value":14386},"Finally, NGINX can serve a Javascript SPA or similar if we choose to use one in our project. To understand how this is done, we need to understand multistage Dockerfiles. Here's the Dockerfile used for the ",{"type":42,"tag":349,"props":14388,"children":14390},{"className":14389},[],[14391],{"type":48,"value":11069},{"type":48,"value":14393}," container:",{"type":42,"tag":401,"props":14395,"children":14398},{"code":14396,"language":12040,"meta":8,"className":14397,"style":8},"# # build stage\n# FROM node:10-alpine as build-stage\n# WORKDIR /app/\n# COPY frontend/package.json /app/\n# RUN npm cache verify\n# RUN npm install\n# COPY frontend /app/\n# RUN npm run build\n\n# production stage\n# FROM nginx:1.19.1-alpine as production-stage\nFROM nginx:1.19.1-alpine\nCOPY nginx/prod/prod.conf /etc/nginx/nginx.conf\nCOPY nginx/prod/index.html /dist/\n# COPY --from=build-stage /app/dist /dist/\nEXPOSE 80\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n","language-Dockerfile shiki shiki-themes github-light github-dark monokai",[14399],{"type":42,"tag":349,"props":14400,"children":14401},{"__ignoreMap":8},[14402,14410,14418,14426,14434,14442,14450,14458,14466,14473,14481,14489,14497,14505,14513,14521,14529],{"type":42,"tag":467,"props":14403,"children":14404},{"class":469,"line":470},[14405],{"type":42,"tag":467,"props":14406,"children":14407},{},[14408],{"type":48,"value":14409},"# # build stage\n",{"type":42,"tag":467,"props":14411,"children":14412},{"class":469,"line":486},[14413],{"type":42,"tag":467,"props":14414,"children":14415},{},[14416],{"type":48,"value":14417},"# FROM node:10-alpine as build-stage\n",{"type":42,"tag":467,"props":14419,"children":14420},{"class":469,"line":499},[14421],{"type":42,"tag":467,"props":14422,"children":14423},{},[14424],{"type":48,"value":14425},"# WORKDIR /app/\n",{"type":42,"tag":467,"props":14427,"children":14428},{"class":469,"line":522},[14429],{"type":42,"tag":467,"props":14430,"children":14431},{},[14432],{"type":48,"value":14433},"# COPY frontend/package.json /app/\n",{"type":42,"tag":467,"props":14435,"children":14436},{"class":469,"line":531},[14437],{"type":42,"tag":467,"props":14438,"children":14439},{},[14440],{"type":48,"value":14441},"# RUN npm cache verify\n",{"type":42,"tag":467,"props":14443,"children":14444},{"class":469,"line":550},[14445],{"type":42,"tag":467,"props":14446,"children":14447},{},[14448],{"type":48,"value":14449},"# RUN npm install\n",{"type":42,"tag":467,"props":14451,"children":14452},{"class":469,"line":575},[14453],{"type":42,"tag":467,"props":14454,"children":14455},{},[14456],{"type":48,"value":14457},"# COPY frontend /app/\n",{"type":42,"tag":467,"props":14459,"children":14460},{"class":469,"line":598},[14461],{"type":42,"tag":467,"props":14462,"children":14463},{},[14464],{"type":48,"value":14465},"# RUN npm run build\n",{"type":42,"tag":467,"props":14467,"children":14468},{"class":469,"line":616},[14469],{"type":42,"tag":467,"props":14470,"children":14471},{"emptyLinePlaceholder":37},[14472],{"type":48,"value":528},{"type":42,"tag":467,"props":14474,"children":14475},{"class":469,"line":625},[14476],{"type":42,"tag":467,"props":14477,"children":14478},{},[14479],{"type":48,"value":14480},"# production stage\n",{"type":42,"tag":467,"props":14482,"children":14483},{"class":469,"line":633},[14484],{"type":42,"tag":467,"props":14485,"children":14486},{},[14487],{"type":48,"value":14488},"# FROM nginx:1.19.1-alpine as production-stage\n",{"type":42,"tag":467,"props":14490,"children":14491},{"class":469,"line":664},[14492],{"type":42,"tag":467,"props":14493,"children":14494},{},[14495],{"type":48,"value":14496},"FROM nginx:1.19.1-alpine\n",{"type":42,"tag":467,"props":14498,"children":14499},{"class":469,"line":672},[14500],{"type":42,"tag":467,"props":14501,"children":14502},{},[14503],{"type":48,"value":14504},"COPY nginx/prod/prod.conf /etc/nginx/nginx.conf\n",{"type":42,"tag":467,"props":14506,"children":14507},{"class":469,"line":690},[14508],{"type":42,"tag":467,"props":14509,"children":14510},{},[14511],{"type":48,"value":14512},"COPY nginx/prod/index.html /dist/\n",{"type":42,"tag":467,"props":14514,"children":14515},{"class":469,"line":1336},[14516],{"type":42,"tag":467,"props":14517,"children":14518},{},[14519],{"type":48,"value":14520},"# COPY --from=build-stage /app/dist /dist/\n",{"type":42,"tag":467,"props":14522,"children":14523},{"class":469,"line":1344},[14524],{"type":42,"tag":467,"props":14525,"children":14526},{},[14527],{"type":48,"value":14528},"EXPOSE 80\n",{"type":42,"tag":467,"props":14530,"children":14531},{"class":469,"line":1362},[14532],{"type":42,"tag":467,"props":14533,"children":14534},{},[14535],{"type":48,"value":14536},"CMD [\"nginx\", \"-g\", \"daemon off;\"]\n",{"type":42,"tag":51,"props":14538,"children":14539},{},[14540],{"type":48,"value":14541},"Currently I don't have a SPA setup, but this is how we could setup one using Vue.js. The important part is this line:",{"type":42,"tag":401,"props":14543,"children":14545},{"code":14544,"language":12040,"meta":8,"className":14397,"style":8},"COPY --from=build-stage /app/dist /dist/\n",[14546],{"type":42,"tag":349,"props":14547,"children":14548},{"__ignoreMap":8},[14549],{"type":42,"tag":467,"props":14550,"children":14551},{"class":469,"line":470},[14552],{"type":42,"tag":467,"props":14553,"children":14554},{},[14555],{"type":48,"value":14544},{"type":42,"tag":51,"props":14557,"children":14558},{},[14559,14561,14567,14569,14574],{"type":48,"value":14560},"This would copy the build files for our Javascript application into the ",{"type":42,"tag":349,"props":14562,"children":14564},{"className":14563},[],[14565],{"type":48,"value":14566},"/dist/",{"type":48,"value":14568}," folder of our NGINX container. Another few declarations and blocks in ",{"type":42,"tag":349,"props":14570,"children":14572},{"className":14571},[],[14573],{"type":48,"value":14159},{"type":48,"value":14575}," allow all other requests to be served by the contents of this folder:",{"type":42,"tag":401,"props":14577,"children":14579},{"code":14578},"    root /dist/;\n    index index.html;\n",[14580],{"type":42,"tag":349,"props":14581,"children":14582},{"__ignoreMap":8},[14583],{"type":48,"value":14578},{"type":42,"tag":51,"props":14585,"children":14586},{},[14587],{"type":48,"value":14588},"This sets the root and the index document for our NGINX webserver.",{"type":42,"tag":401,"props":14590,"children":14592},{"code":14591},"    # frontend\n    location / {\n      try_files $uri $uri/ @rewrites;\n    }\n\n    location @rewrites {\n      rewrite ^(.+)$ /index.html last;\n    }\n",[14593],{"type":42,"tag":349,"props":14594,"children":14595},{"__ignoreMap":8},[14596],{"type":48,"value":14591},{"type":42,"tag":51,"props":14598,"children":14599},{},[14600,14602,14607,14609,14614,14616,14621,14622,14627,14628,14633],{"type":48,"value":14601},"These two blocks route all other requests to the frontend Javascript app's ",{"type":42,"tag":349,"props":14603,"children":14605},{"className":14604},[],[14606],{"type":48,"value":5841},{"type":48,"value":14608}," file location in ",{"type":42,"tag":349,"props":14610,"children":14612},{"className":14611},[],[14613],{"type":48,"value":14566},{"type":48,"value":14615}," (any request that doesn't start with ",{"type":42,"tag":349,"props":14617,"children":14619},{"className":14618},[],[14620],{"type":48,"value":10884},{"type":48,"value":935},{"type":42,"tag":349,"props":14623,"children":14625},{"className":14624},[],[14626],{"type":48,"value":14137},{"type":48,"value":7768},{"type":42,"tag":349,"props":14629,"children":14631},{"className":14630},[],[14632],{"type":48,"value":14144},{"type":48,"value":14634},"). We may wish to change this behavior if you want Django to serve most of your requests and possibly serve a single page application on another path.",{"type":42,"tag":51,"props":14636,"children":14637},{},[14638,14640,14645,14647,14653,14655,14661,14663,14668],{"type":48,"value":14639},"Lastly, the ",{"type":42,"tag":349,"props":14641,"children":14643},{"className":14642},[],[14644],{"type":48,"value":10493},{"type":48,"value":14646}," service's ",{"type":42,"tag":349,"props":14648,"children":14650},{"className":14649},[],[14651],{"type":48,"value":14652},"deployment",{"type":48,"value":14654}," key has some ",{"type":42,"tag":349,"props":14656,"children":14658},{"className":14657},[],[14659],{"type":48,"value":14660},"labels",{"type":48,"value":14662}," defined for Traefik. Let's come back to these after having a look at the ",{"type":42,"tag":349,"props":14664,"children":14666},{"className":14665},[],[14667],{"type":48,"value":11068},{"type":48,"value":14126},{"type":42,"tag":280,"props":14670,"children":14671},{"id":11068},[14672],{"type":48,"value":14673},"Traefik",{"type":42,"tag":51,"props":14675,"children":14676},{},[14677],{"type":42,"tag":127,"props":14678,"children":14680},{"alt":5444,"src":14679},"https://docs.traefik.io/assets/img/traefik-architecture.png",[],{"type":42,"tag":723,"props":14682,"children":14683},{},[14684],{"type":42,"tag":51,"props":14685,"children":14686},{},[14687,14689],{"type":48,"value":14688},"Traefik is an open-source Edge Router that makes publishing your services a fun and easy experience. It receives requests on behalf of your system and finds out which components are responsible for handling them. -- ",{"type":42,"tag":138,"props":14690,"children":14693},{"href":14691,"rel":14692},"https://docs.traefik.io/",[142],[14694],{"type":48,"value":14691},{"type":42,"tag":51,"props":14696,"children":14697},{},[14698],{"type":48,"value":14699},"Traefik has three main functions in my application:",{"type":42,"tag":3541,"props":14701,"children":14702},{},[14703,14708,14713],{"type":42,"tag":61,"props":14704,"children":14705},{},[14706],{"type":48,"value":14707},"Request TLS certificates from Let's Encrypt that allow us to encrypt our web traffic with HTTPS",{"type":42,"tag":61,"props":14709,"children":14710},{},[14711],{"type":48,"value":14712},"Do TLS termination",{"type":42,"tag":61,"props":14714,"children":14715},{},[14716],{"type":48,"value":14717},"Route all requests to NGINX",{"type":42,"tag":51,"props":14719,"children":14720},{},[14721],{"type":48,"value":14722},"The one thing that Traefik cannot do is serve static files; it is not a webserver, unlike NGINX which is a webserver. NGINX is also capable of requesting TLS certs from Let's Encrypt, so we don't technically need Traefik, but it is indeed \"fun and easy\", especially when it comes to requesting certificates.",{"type":42,"tag":723,"props":14724,"children":14725},{},[14726],{"type":42,"tag":51,"props":14727,"children":14728},{},[14729],{"type":48,"value":14730},"I have tried setting up Certbot with NGINX a long time ago but I never go it to work, and I didn't like the idea about how to run a chron job to refresh old certs.",{"type":42,"tag":51,"props":14732,"children":14733},{},[14734],{"type":48,"value":14735},"There are two main ways to set up Traefik:",{"type":42,"tag":3541,"props":14737,"children":14738},{},[14739,14758],{"type":42,"tag":61,"props":14740,"children":14741},{},[14742,14744,14750,14752,14757],{"type":48,"value":14743},"write a ",{"type":42,"tag":349,"props":14745,"children":14747},{"className":14746},[],[14748],{"type":48,"value":14749},"traefik.toml",{"type":48,"value":14751}," file and build this into your own custom image (similar to what we do with NGINX and ",{"type":42,"tag":349,"props":14753,"children":14755},{"className":14754},[],[14756],{"type":48,"value":14159},{"type":48,"value":5652},{"type":42,"tag":61,"props":14759,"children":14760},{},[14761],{"type":48,"value":14762},"use a base image and specify all configure options through command line arguments.",{"type":42,"tag":51,"props":14764,"children":14765},{},[14766,14768,14773,14775,14780],{"type":48,"value":14767},"I started out with the first approach, and I did get it to work, but I have decided that the second way is better. It requires one less image to build in our deployment process and it is easy to parametrize the command line arguments in ",{"type":42,"tag":349,"props":14769,"children":14771},{"className":14770},[],[14772],{"type":48,"value":13089},{"type":48,"value":14774}," (for now all the values I'm using in the ",{"type":42,"tag":349,"props":14776,"children":14778},{"className":14777},[],[14779],{"type":48,"value":11068},{"type":48,"value":14781}," service are hard-coded, this is one more item for my ToDo list on this project).",{"type":42,"tag":51,"props":14783,"children":14784},{},[14785,14787,14792,14794,14801,14803,14810],{"type":48,"value":14786},"I had a hard time finding good examples of how to use Traefik version 2 with Docker Swarm in the Traefik docs. Their official example for using docker uses ",{"type":42,"tag":349,"props":14788,"children":14790},{"className":14789},[],[14791],{"type":48,"value":7741},{"type":48,"value":14793},". There is a Swarm example, but it is for an older version of Traefik (1.7). This article titled ",{"type":42,"tag":138,"props":14795,"children":14798},{"href":14796,"rel":14797},"https://blog.creekorful.com/2019/10/how-to-install-traefik-2-docker-swarm/",[142],[14799],{"type":48,"value":14800},"How to install Traefik 2.x on a Docker Swarm",{"type":48,"value":14802}," helped me a lot in figuring out how to get everything working. Thank you for the great article, ",{"type":42,"tag":138,"props":14804,"children":14807},{"href":14805,"rel":14806},"https://github.com/creekorful",[142],[14808],{"type":48,"value":14809},"AloÃ¯s",{"type":48,"value":14811},"!",{"type":42,"tag":51,"props":14813,"children":14814},{},[14815],{"type":48,"value":14816},"Here's the code that sets up the traefik service:",{"type":42,"tag":401,"props":14818,"children":14820},{"code":14819,"language":3649,"meta":8,"className":3650,"style":8},"services:\n  traefik:\n    image: traefik:v2.0.2\n    ports:\n      - '80:80'\n      - '443:443'\n    command:\n      - '--providers.docker.endpoint=unix:///var/run/docker.sock'\n      - '--providers.docker.swarmMode=true'\n      - '--providers.docker.exposedbydefault=false'\n      - '--providers.docker.network=traefik-public'\n      - '--entrypoints.web.address=:80'\n      - '--entrypoints.websecure.address=:443'\n      - '--certificatesresolvers.letsencryptresolver.acme.httpchallenge=true'\n      - '--certificatesresolvers.letsencryptresolver.acme.httpchallenge.entrypoint=web'\n      - '--certificatesresolvers.letsencryptresolver.acme.email=brian@email.com'\n      - '--certificatesresolvers.letsencryptresolver.acme.storage=/letsencrypt/acme.json'\n    volumes:\n      - letsencrypt:/letsencrypt\n      - /var/run/docker.sock:/var/run/docker.sock\n    networks:\n      - traefik-public\n    deploy:\n      placement:\n        constraints:\n          - node.role == manager\n",[14821],{"type":42,"tag":349,"props":14822,"children":14823},{"__ignoreMap":8},[14824,14835,14847,14863,14875,14887,14899,14911,14923,14935,14947,14959,14971,14983,14995,15007,15019,15031,15042,15054,15066,15077,15088,15099,15111,15123],{"type":42,"tag":467,"props":14825,"children":14826},{"class":469,"line":470},[14827,14831],{"type":42,"tag":467,"props":14828,"children":14829},{"style":3660},[14830],{"type":48,"value":12231},{"type":42,"tag":467,"props":14832,"children":14833},{"style":480},[14834],{"type":48,"value":3693},{"type":42,"tag":467,"props":14836,"children":14837},{"class":469,"line":486},[14838,14843],{"type":42,"tag":467,"props":14839,"children":14840},{"style":3660},[14841],{"type":48,"value":14842},"  traefik",{"type":42,"tag":467,"props":14844,"children":14845},{"style":480},[14846],{"type":48,"value":3693},{"type":42,"tag":467,"props":14848,"children":14849},{"class":469,"line":499},[14850,14854,14858],{"type":42,"tag":467,"props":14851,"children":14852},{"style":3660},[14853],{"type":48,"value":13954},{"type":42,"tag":467,"props":14855,"children":14856},{"style":480},[14857],{"type":48,"value":3668},{"type":42,"tag":467,"props":14859,"children":14860},{"style":564},[14861],{"type":48,"value":14862},"traefik:v2.0.2\n",{"type":42,"tag":467,"props":14864,"children":14865},{"class":469,"line":522},[14866,14871],{"type":42,"tag":467,"props":14867,"children":14868},{"style":3660},[14869],{"type":48,"value":14870},"    ports",{"type":42,"tag":467,"props":14872,"children":14873},{"style":480},[14874],{"type":48,"value":3693},{"type":42,"tag":467,"props":14876,"children":14877},{"class":469,"line":531},[14878,14882],{"type":42,"tag":467,"props":14879,"children":14880},{"style":480},[14881],{"type":48,"value":3725},{"type":42,"tag":467,"props":14883,"children":14884},{"style":564},[14885],{"type":48,"value":14886},"'80:80'\n",{"type":42,"tag":467,"props":14888,"children":14889},{"class":469,"line":550},[14890,14894],{"type":42,"tag":467,"props":14891,"children":14892},{"style":480},[14893],{"type":48,"value":3725},{"type":42,"tag":467,"props":14895,"children":14896},{"style":564},[14897],{"type":48,"value":14898},"'443:443'\n",{"type":42,"tag":467,"props":14900,"children":14901},{"class":469,"line":575},[14902,14907],{"type":42,"tag":467,"props":14903,"children":14904},{"style":3660},[14905],{"type":48,"value":14906},"    command",{"type":42,"tag":467,"props":14908,"children":14909},{"style":480},[14910],{"type":48,"value":3693},{"type":42,"tag":467,"props":14912,"children":14913},{"class":469,"line":598},[14914,14918],{"type":42,"tag":467,"props":14915,"children":14916},{"style":480},[14917],{"type":48,"value":3725},{"type":42,"tag":467,"props":14919,"children":14920},{"style":564},[14921],{"type":48,"value":14922},"'--providers.docker.endpoint=unix:///var/run/docker.sock'\n",{"type":42,"tag":467,"props":14924,"children":14925},{"class":469,"line":616},[14926,14930],{"type":42,"tag":467,"props":14927,"children":14928},{"style":480},[14929],{"type":48,"value":3725},{"type":42,"tag":467,"props":14931,"children":14932},{"style":564},[14933],{"type":48,"value":14934},"'--providers.docker.swarmMode=true'\n",{"type":42,"tag":467,"props":14936,"children":14937},{"class":469,"line":625},[14938,14942],{"type":42,"tag":467,"props":14939,"children":14940},{"style":480},[14941],{"type":48,"value":3725},{"type":42,"tag":467,"props":14943,"children":14944},{"style":564},[14945],{"type":48,"value":14946},"'--providers.docker.exposedbydefault=false'\n",{"type":42,"tag":467,"props":14948,"children":14949},{"class":469,"line":633},[14950,14954],{"type":42,"tag":467,"props":14951,"children":14952},{"style":480},[14953],{"type":48,"value":3725},{"type":42,"tag":467,"props":14955,"children":14956},{"style":564},[14957],{"type":48,"value":14958},"'--providers.docker.network=traefik-public'\n",{"type":42,"tag":467,"props":14960,"children":14961},{"class":469,"line":664},[14962,14966],{"type":42,"tag":467,"props":14963,"children":14964},{"style":480},[14965],{"type":48,"value":3725},{"type":42,"tag":467,"props":14967,"children":14968},{"style":564},[14969],{"type":48,"value":14970},"'--entrypoints.web.address=:80'\n",{"type":42,"tag":467,"props":14972,"children":14973},{"class":469,"line":672},[14974,14978],{"type":42,"tag":467,"props":14975,"children":14976},{"style":480},[14977],{"type":48,"value":3725},{"type":42,"tag":467,"props":14979,"children":14980},{"style":564},[14981],{"type":48,"value":14982},"'--entrypoints.websecure.address=:443'\n",{"type":42,"tag":467,"props":14984,"children":14985},{"class":469,"line":690},[14986,14990],{"type":42,"tag":467,"props":14987,"children":14988},{"style":480},[14989],{"type":48,"value":3725},{"type":42,"tag":467,"props":14991,"children":14992},{"style":564},[14993],{"type":48,"value":14994},"'--certificatesresolvers.letsencryptresolver.acme.httpchallenge=true'\n",{"type":42,"tag":467,"props":14996,"children":14997},{"class":469,"line":1336},[14998,15002],{"type":42,"tag":467,"props":14999,"children":15000},{"style":480},[15001],{"type":48,"value":3725},{"type":42,"tag":467,"props":15003,"children":15004},{"style":564},[15005],{"type":48,"value":15006},"'--certificatesresolvers.letsencryptresolver.acme.httpchallenge.entrypoint=web'\n",{"type":42,"tag":467,"props":15008,"children":15009},{"class":469,"line":1344},[15010,15014],{"type":42,"tag":467,"props":15011,"children":15012},{"style":480},[15013],{"type":48,"value":3725},{"type":42,"tag":467,"props":15015,"children":15016},{"style":564},[15017],{"type":48,"value":15018},"'--certificatesresolvers.letsencryptresolver.acme.email=brian@email.com'\n",{"type":42,"tag":467,"props":15020,"children":15021},{"class":469,"line":1362},[15022,15026],{"type":42,"tag":467,"props":15023,"children":15024},{"style":480},[15025],{"type":48,"value":3725},{"type":42,"tag":467,"props":15027,"children":15028},{"style":564},[15029],{"type":48,"value":15030},"'--certificatesresolvers.letsencryptresolver.acme.storage=/letsencrypt/acme.json'\n",{"type":42,"tag":467,"props":15032,"children":15033},{"class":469,"line":1380},[15034,15038],{"type":42,"tag":467,"props":15035,"children":15036},{"style":3660},[15037],{"type":48,"value":14006},{"type":42,"tag":467,"props":15039,"children":15040},{"style":480},[15041],{"type":48,"value":3693},{"type":42,"tag":467,"props":15043,"children":15044},{"class":469,"line":1388},[15045,15049],{"type":42,"tag":467,"props":15046,"children":15047},{"style":480},[15048],{"type":48,"value":3725},{"type":42,"tag":467,"props":15050,"children":15051},{"style":564},[15052],{"type":48,"value":15053},"letsencrypt:/letsencrypt\n",{"type":42,"tag":467,"props":15055,"children":15056},{"class":469,"line":1423},[15057,15061],{"type":42,"tag":467,"props":15058,"children":15059},{"style":480},[15060],{"type":48,"value":3725},{"type":42,"tag":467,"props":15062,"children":15063},{"style":564},[15064],{"type":48,"value":15065},"/var/run/docker.sock:/var/run/docker.sock\n",{"type":42,"tag":467,"props":15067,"children":15068},{"class":469,"line":1441},[15069,15073],{"type":42,"tag":467,"props":15070,"children":15071},{"style":3660},[15072],{"type":48,"value":13971},{"type":42,"tag":467,"props":15074,"children":15075},{"style":480},[15076],{"type":48,"value":3693},{"type":42,"tag":467,"props":15078,"children":15079},{"class":469,"line":1449},[15080,15084],{"type":42,"tag":467,"props":15081,"children":15082},{"style":480},[15083],{"type":48,"value":3725},{"type":42,"tag":467,"props":15085,"children":15086},{"style":564},[15087],{"type":48,"value":13987},{"type":42,"tag":467,"props":15089,"children":15090},{"class":469,"line":1458},[15091,15095],{"type":42,"tag":467,"props":15092,"children":15093},{"style":3660},[15094],{"type":48,"value":14030},{"type":42,"tag":467,"props":15096,"children":15097},{"style":480},[15098],{"type":48,"value":3693},{"type":42,"tag":467,"props":15100,"children":15101},{"class":469,"line":1476},[15102,15107],{"type":42,"tag":467,"props":15103,"children":15104},{"style":3660},[15105],{"type":48,"value":15106},"      placement",{"type":42,"tag":467,"props":15108,"children":15109},{"style":480},[15110],{"type":48,"value":3693},{"type":42,"tag":467,"props":15112,"children":15113},{"class":469,"line":1511},[15114,15119],{"type":42,"tag":467,"props":15115,"children":15116},{"style":3660},[15117],{"type":48,"value":15118},"        constraints",{"type":42,"tag":467,"props":15120,"children":15121},{"style":480},[15122],{"type":48,"value":3693},{"type":42,"tag":467,"props":15124,"children":15125},{"class":469,"line":1519},[15126,15131],{"type":42,"tag":467,"props":15127,"children":15128},{"style":480},[15129],{"type":48,"value":15130},"          - ",{"type":42,"tag":467,"props":15132,"children":15133},{"style":564},[15134],{"type":48,"value":15135},"node.role == manager\n",{"type":42,"tag":723,"props":15137,"children":15138},{},[15139],{"type":42,"tag":51,"props":15140,"children":15141},{},[15142],{"type":48,"value":15143},"The one thing I don't like about this setup is that it uses a 1GB volume to store one small JSON file. I think that 1GB is the smallest block storage volume I can request using REX-Ray. This only adds $0.10/month to our project costs which is not that bad.",{"type":42,"tag":51,"props":15145,"children":15146},{},[15147,15152,15153,15159,15161,15166],{"type":42,"tag":349,"props":15148,"children":15150},{"className":15149},[],[15151],{"type":48,"value":10493},{"type":48,"value":2751},{"type":42,"tag":349,"props":15154,"children":15156},{"className":15155},[],[15157],{"type":48,"value":15158},"websecure",{"type":48,"value":15160}," refer to values declared on the ",{"type":42,"tag":349,"props":15162,"children":15164},{"className":15163},[],[15165],{"type":48,"value":10493},{"type":48,"value":15167}," service. Let's take a look at those values:",{"type":42,"tag":401,"props":15169,"children":15173},{"code":15170,"language":15171,"meta":8,"className":15172,"style":8},"deploy:\n  labels:\n    - 'traefik.enable=true'\n    - 'traefik.http.routers.nginx-web.rule=Host(`mysite.com`)'\n    - 'traefik.http.routers.nginx-web.entrypoints=websecure'\n    - 'traefik.http.routers.nginx-web.tls.certresolver=letsencryptresolver'\n    - 'traefik.http.services.nginx-web.loadbalancer.server.port=80'\n","yaml","language-yaml shiki shiki-themes github-light github-dark monokai",[15174],{"type":42,"tag":349,"props":15175,"children":15176},{"__ignoreMap":8},[15177,15188,15200,15211,15222,15233,15244],{"type":42,"tag":467,"props":15178,"children":15179},{"class":469,"line":470},[15180,15184],{"type":42,"tag":467,"props":15181,"children":15182},{"style":3660},[15183],{"type":48,"value":11665},{"type":42,"tag":467,"props":15185,"children":15186},{"style":480},[15187],{"type":48,"value":3693},{"type":42,"tag":467,"props":15189,"children":15190},{"class":469,"line":486},[15191,15196],{"type":42,"tag":467,"props":15192,"children":15193},{"style":3660},[15194],{"type":48,"value":15195},"  labels",{"type":42,"tag":467,"props":15197,"children":15198},{"style":480},[15199],{"type":48,"value":3693},{"type":42,"tag":467,"props":15201,"children":15202},{"class":469,"line":499},[15203,15207],{"type":42,"tag":467,"props":15204,"children":15205},{"style":480},[15206],{"type":48,"value":11781},{"type":42,"tag":467,"props":15208,"children":15209},{"style":564},[15210],{"type":48,"value":14059},{"type":42,"tag":467,"props":15212,"children":15213},{"class":469,"line":522},[15214,15218],{"type":42,"tag":467,"props":15215,"children":15216},{"style":480},[15217],{"type":48,"value":11781},{"type":42,"tag":467,"props":15219,"children":15220},{"style":564},[15221],{"type":48,"value":14071},{"type":42,"tag":467,"props":15223,"children":15224},{"class":469,"line":531},[15225,15229],{"type":42,"tag":467,"props":15226,"children":15227},{"style":480},[15228],{"type":48,"value":11781},{"type":42,"tag":467,"props":15230,"children":15231},{"style":564},[15232],{"type":48,"value":14083},{"type":42,"tag":467,"props":15234,"children":15235},{"class":469,"line":550},[15236,15240],{"type":42,"tag":467,"props":15237,"children":15238},{"style":480},[15239],{"type":48,"value":11781},{"type":42,"tag":467,"props":15241,"children":15242},{"style":564},[15243],{"type":48,"value":14095},{"type":42,"tag":467,"props":15245,"children":15246},{"class":469,"line":575},[15247,15251],{"type":42,"tag":467,"props":15248,"children":15249},{"style":480},[15250],{"type":48,"value":11781},{"type":42,"tag":467,"props":15252,"children":15253},{"style":564},[15254],{"type":48,"value":14107},{"type":42,"tag":51,"props":15256,"children":15257},{},[15258,15260,15265],{"type":48,"value":15259},"I still need to setup HTTP -> HTTPS redirecting, so for now only ",{"type":42,"tag":349,"props":15261,"children":15263},{"className":15262},[],[15264],{"type":48,"value":15158},{"type":48,"value":15266}," is defined, but AloÃ¯s explains this clearly in his article.",{"type":42,"tag":723,"props":15268,"children":15269},{},[15270],{"type":42,"tag":51,"props":15271,"children":15272},{},[15273],{"type":48,"value":15274},"For me this is the most complicated part of the setup. I'm still not familiar with exactly how Traefik and Let's Encrypt work. Hopefully I can run through this process a few more times with some variations to better understand the rough edges. Otherwise for this simple way to get TLS certificates. AWS makes this very easy with Amazon Certificate Manager (ACM) which makes the requesting of certificates very simple, especially within CDK.",{"type":42,"tag":51,"props":15276,"children":15277},{},[15278,15280,15285],{"type":48,"value":15279},"That wraps up our overview of ",{"type":42,"tag":349,"props":15281,"children":15283},{"className":15282},[],[15284],{"type":48,"value":13089},{"type":48,"value":15286},", we left off with the following command:",{"type":42,"tag":401,"props":15288,"children":15289},{"code":12820},[15290],{"type":42,"tag":349,"props":15291,"children":15292},{"__ignoreMap":8},[15293],{"type":48,"value":12820},{"type":42,"tag":51,"props":15295,"children":15296},{},[15297,15299,15304],{"type":48,"value":15298},"We can check out the status of our docker stack deployment by running a few different docker CLI commands. You can either SSH into your Droplet or configure the ",{"type":42,"tag":349,"props":15300,"children":15302},{"className":15301},[],[15303],{"type":48,"value":8246},{"type":48,"value":15305}," environment variable that I showed you earlier and run these commands from your local terminal:",{"type":42,"tag":401,"props":15307,"children":15309},{"code":15308},"docker stack ps my-stack --no-trunc\n",[15310],{"type":42,"tag":349,"props":15311,"children":15312},{"__ignoreMap":8},[15313],{"type":48,"value":15308},{"type":42,"tag":51,"props":15315,"children":15316},{},[15317,15323,15325,15331],{"type":42,"tag":349,"props":15318,"children":15320},{"className":15319},[],[15321],{"type":48,"value":15322},"--no-trunc",{"type":48,"value":15324}," is important because important error messages tend to be cut off. This option will show the full version of each column returned by ",{"type":42,"tag":349,"props":15326,"children":15328},{"className":15327},[],[15329],{"type":48,"value":15330},"docker stack ps",{"type":48,"value":1970},{"type":42,"tag":401,"props":15333,"children":15335},{"code":15334},"docker service ls\n",[15336],{"type":42,"tag":349,"props":15337,"children":15338},{"__ignoreMap":8},[15339],{"type":48,"value":15334},{"type":42,"tag":51,"props":15341,"children":15342},{},[15343],{"type":48,"value":15344},"This command shows some the active services on our Droplet.",{"type":42,"tag":401,"props":15346,"children":15348},{"code":15347},"docker ps\n",[15349],{"type":42,"tag":349,"props":15350,"children":15351},{"__ignoreMap":8},[15352],{"type":48,"value":15347},{"type":42,"tag":51,"props":15354,"children":15355},{},[15356],{"type":48,"value":15357},"This command is useful for shelling into a container to run commands and poke around for debugging.",{"type":42,"tag":51,"props":15359,"children":15360},{},[15361],{"type":48,"value":15362},"You can get the Container ID of a running container and access it with the following command:",{"type":42,"tag":401,"props":15364,"children":15366},{"code":15365},"docker exec -it 0da8370ab283 bash\n",[15367],{"type":42,"tag":349,"props":15368,"children":15369},{"__ignoreMap":8},[15370],{"type":48,"value":15365},{"type":42,"tag":51,"props":15372,"children":15373},{},[15374,15376,15381,15383,15389],{"type":48,"value":15375},"This assumes that ",{"type":42,"tag":349,"props":15377,"children":15379},{"className":15378},[],[15380],{"type":48,"value":12887},{"type":48,"value":15382}," is installed on the container with ID ",{"type":42,"tag":349,"props":15384,"children":15386},{"className":15385},[],[15387],{"type":48,"value":15388},"0da8370ab283",{"type":48,"value":1970},{"type":42,"tag":112,"props":15391,"children":15393},{"id":15392},"management-commands",[15394],{"type":48,"value":15395},"Management commands",{"type":42,"tag":51,"props":15397,"children":15398},{},[15399],{"type":48,"value":15400},"Once the site is deployed we stil need to run a few commands to set up our Djnago application:",{"type":42,"tag":3541,"props":15402,"children":15403},{},[15404,15408,15413],{"type":42,"tag":61,"props":15405,"children":15406},{},[15407],{"type":48,"value":13461},{"type":42,"tag":61,"props":15409,"children":15410},{},[15411],{"type":48,"value":15412},"migrate",{"type":42,"tag":61,"props":15414,"children":15415},{},[15416],{"type":48,"value":15417},"createsuperuser",{"type":42,"tag":723,"props":15419,"children":15420},{},[15421],{"type":42,"tag":51,"props":15422,"children":15423},{},[15424],{"type":48,"value":15425},"One other ToDo is to figure out how to run these commands through manual GitLab CI jobs.",{"type":42,"tag":51,"props":15427,"children":15428},{},[15429],{"type":48,"value":15430},"That's most of what I wanted to cover on a first pass. This should be a good starting point for working with a Django application in Docker Swarm on DigitalOcean.",{"type":42,"tag":112,"props":15432,"children":15433},{"id":7441},[15434],{"type":48,"value":8096},{"type":42,"tag":51,"props":15436,"children":15437},{},[15438],{"type":48,"value":15439},"Here are some ideas about the next steps I could take on this project.",{"type":42,"tag":280,"props":15441,"children":15443},{"id":15442},"local-environment",[15444],{"type":48,"value":15445},"Local environment",{"type":42,"tag":51,"props":15447,"children":15448},{},[15449],{"type":48,"value":15450},"I'll probably need to create another docker-compose file to bring up everything locally. It might be a good way to experiment with different Traefik settings.",{"type":42,"tag":280,"props":15452,"children":15454},{"id":15453},"infrastructure-as-code-setup",[15455],{"type":48,"value":15456},"Infrastructure as Code setup",{"type":42,"tag":51,"props":15458,"children":15459},{},[15460],{"type":48,"value":15461},"There might be a good opportunity to learn more about Terreform or Ansible here. There are a number of manual, one time setup steps. Some of these can't be automated, but some of them would probably fit very neatly into one of these tools. Pulumi would also be a good option to explore as it is more analagous to CDK.",{"type":42,"tag":280,"props":15463,"children":15465},{"id":15464},"scaling-out-docker-swarm-services-across-multiple-machines",[15466],{"type":48,"value":15467},"Scaling out docker swarm services across multiple machines",{"type":42,"tag":51,"props":15469,"children":15470},{},[15471],{"type":48,"value":15472},"I have only scratched the surface of what docker swarm can do. There are lots of other settings that would be helpful to setup for learning purposes, especially around resource limits for services. For simplicity I haven't touch on any of these options yet. I'm curious to know how many containers I can fit onto one small Droplet, and if resource limits could help with compute and memory-intensive workloads.",{"type":42,"tag":280,"props":15474,"children":15476},{"id":15475},"kubernetes-on-digitalocean",[15477],{"type":48,"value":15478},"Kubernetes on DigitalOcean",{"type":42,"tag":51,"props":15480,"children":15481},{},[15482],{"type":48,"value":15483},"DigitalOcean now offers simplified Kubernetes solutions. It would be interesting to try this out once I get better with docker swarm. I have used Kubernetes a with minikube and to a limited extent with GCP.",{"type":42,"tag":280,"props":15485,"children":15487},{"id":15486},"deploying-locally-without-using-gitlab-ci",[15488],{"type":48,"value":15489},"Deploying locally, without using GitLab CI",{"type":42,"tag":51,"props":15491,"children":15492},{},[15493],{"type":48,"value":15494},"CDK makes deploying locally very easy, especially with the Lambda project I put together. This project as it stands might be a little bit more difficult to deploy locally. It assumes that the images we want to deploy are private. It might be possible, but for now I am fine with deploying through GitLab CI since the pipeline only takes a few minutes to complete for the build and deploy stages.",{"type":42,"tag":3468,"props":15496,"children":15497},{},[15498],{"type":48,"value":3472},{"title":8,"searchDepth":486,"depth":486,"links":15500},[15501,15502,15503,15504,15505,15506,15507,15508,15509,15510,15511,15512,15517,15518],{"id":11137,"depth":486,"text":11140},{"id":11246,"depth":486,"text":11249},{"id":11296,"depth":486,"text":11299},{"id":11354,"depth":486,"text":11357},{"id":11450,"depth":486,"text":11453},{"id":11478,"depth":486,"text":11481},{"id":11508,"depth":486,"text":11511},{"id":11599,"depth":486,"text":11184},{"id":12276,"depth":486,"text":12279},{"id":12395,"depth":486,"text":12398},{"id":12559,"depth":486,"text":12554},{"id":13082,"depth":486,"text":13089,"children":15513},[15514,15515,15516],{"id":7997,"depth":499,"text":7997},{"id":11069,"depth":499,"text":13875},{"id":11068,"depth":499,"text":14673},{"id":15392,"depth":486,"text":15395},{"id":7441,"depth":486,"text":8096,"children":15519},[15520,15521,15522,15523,15524],{"id":15442,"depth":499,"text":15445},{"id":15453,"depth":499,"text":15456},{"id":15464,"depth":499,"text":15467},{"id":15475,"depth":499,"text":15478},{"id":15486,"depth":499,"text":15489},"content:2020:08:09:digital-ocean-docker-swarm-django-traefik-nginx.md","2020/08/09/digital-ocean-docker-swarm-django-traefik-nginx.md","2020/08/09/digital-ocean-docker-swarm-django-traefik-nginx",{"_path":15529,"_dir":3498,"_draft":7,"_partial":7,"_locale":8,"title":15530,"description":8,"layout":8366,"date":15531,"comments":37,"image":15532,"tags":15533,"body":15536,"_type":3490,"_id":21147,"_source":3492,"_file":21148,"_stem":21149,"_extension":3495},"/2020/06/02/django-postgres-vue-gitlab-ecs","Using AWS CDK, GitLab, Fargate and CloudFront for Django + Vue.js applications","2020-06-02T00:00:00.000Z","/static/architecture_verbose_equals_true.png",[15534,5369,8140,25,15535],"fargate","cdk",{"type":39,"children":15537,"toc":21108},[15538,15560,15566,15579,15621,15626,15632,15637,15709,15715,15721,15725,15739,15744,15749,15754,15759,15764,15769,15774,15779,15784,15789,15794,15799,15804,15809,15814,15819,15824,15829,15834,15839,15844,15849,15854,15859,15864,15869,15874,15879,15884,15889,15894,15900,15938,15944,15985,15990,16013,16020,16086,16092,16166,16172,16209,16215,16229,16234,16240,16315,16321,16389,16401,16407,16412,16418,16438,16444,16449,16472,16478,16497,16502,16548,16554,16567,16595,16627,16633,16638,16650,16655,16661,16679,16700,16849,16860,17579,17593,17665,17677,17762,17770,17796,17807,17841,17863,17882,18114,18142,18249,18257,18267,18277,18283,18294,18430,18466,18509,18529,18535,18555,18640,18679,18698,18709,18721,18730,18750,18759,18771,18780,18821,18830,18863,18872,18877,18886,18891,18900,18913,18926,18961,18981,18991,19003,19012,19017,19026,19068,19077,19082,19103,19113,19125,19134,19139,19148,19161,19228,19237,19248,19257,19262,19289,19298,19303,19312,19335,19357,19362,19368,19381,19414,19419,19425,19430,19436,19441,19461,19466,19484,19490,19495,19501,19506,19529,19561,19566,19578,19591,19596,19634,19639,19644,19656,19661,19682,19687,19772,19777,20109,20137,20142,20530,20535,21030,21036,21070,21074,21104],{"type":42,"tag":723,"props":15539,"children":15540},{},[15541],{"type":42,"tag":51,"props":15542,"children":15543},{},[15544,15546,15552,15554],{"type":48,"value":15545},"This article was originally posted on ",{"type":42,"tag":138,"props":15547,"children":15550},{"href":15548,"rel":15549},"https://dev.to/briancaffey/building-a-django-vue-js-application-with-aws-cdk-and-gitlab-ci-also-how-to-scale-celery-workers-to-zero-1o6i",[142],[15551],{"type":48,"value":15548},{"type":48,"value":15553},". It is also available on the documentation site for the project: ",{"type":42,"tag":138,"props":15555,"children":15558},{"href":15556,"rel":15557},"https://verbose-equals-true.gitlab.io/django-postgres-vue-gitlab-ecs/start/overview/",[142],[15559],{"type":48,"value":15556},{"type":42,"tag":43,"props":15561,"children":15563},{"id":15562},"project-overview",[15564],{"type":48,"value":15565},"Project Overview",{"type":42,"tag":51,"props":15567,"children":15568},{},[15569,15571,15577],{"type":48,"value":15570},"This is an overview of a Proof-of-Concept web application I'm working on called ",{"type":42,"tag":349,"props":15572,"children":15574},{"className":15573},[],[15575],{"type":48,"value":15576},"django-postgres-vue-gitlab-ecs",{"type":48,"value":15578},". This project aims to demonstrate the development and deployment of a web application using some of my favorite tools, languages and frameworks including:",{"type":42,"tag":57,"props":15580,"children":15581},{},[15582,15587,15592,15597,15602,15607,15612],{"type":42,"tag":61,"props":15583,"children":15584},{},[15585],{"type":48,"value":15586},"Python",{"type":42,"tag":61,"props":15588,"children":15589},{},[15590],{"type":48,"value":15591},"Django",{"type":42,"tag":61,"props":15593,"children":15594},{},[15595],{"type":48,"value":15596},"JavaScript",{"type":42,"tag":61,"props":15598,"children":15599},{},[15600],{"type":48,"value":15601},"Vue.js/Quasar Framework",{"type":42,"tag":61,"props":15603,"children":15604},{},[15605],{"type":48,"value":15606},"GitLab",{"type":42,"tag":61,"props":15608,"children":15609},{},[15610],{"type":48,"value":15611},"AWS",{"type":42,"tag":61,"props":15613,"children":15614},{},[15615,15617],{"type":48,"value":15616},"and last but not least, ",{"type":42,"tag":9138,"props":15618,"children":15619},{},[15620],{"type":48,"value":11102},{"type":42,"tag":51,"props":15622,"children":15623},{},[15624],{"type":48,"value":15625},"This README will start by describing some features of the application I'm building and how the different technologies are used together. I also share my experience in adopting CDK for managing cloud infrastructure on AWS. Finally, I discuss my solution to a specific question I have been trying to answer: what's the best way to scale Celery workers to zero to reduce Total Cost of Ownership?",{"type":42,"tag":112,"props":15627,"children":15629},{"id":15628},"development-philosophies-and-best-practices",[15630],{"type":48,"value":15631},"Development Philosophies and Best Practices",{"type":42,"tag":51,"props":15633,"children":15634},{},[15635],{"type":48,"value":15636},"Here are some of the best practices that this project aims to use:",{"type":42,"tag":57,"props":15638,"children":15639},{},[15640,15645,15650,15655,15660,15665,15670,15682,15687,15692,15697],{"type":42,"tag":61,"props":15641,"children":15642},{},[15643],{"type":48,"value":15644},"Open-source, MIT-Licensed",{"type":42,"tag":61,"props":15646,"children":15647},{},[15648],{"type":48,"value":15649},"12 Factor App",{"type":42,"tag":61,"props":15651,"children":15652},{},[15653],{"type":48,"value":15654},"Infrastructure as Code",{"type":42,"tag":61,"props":15656,"children":15657},{},[15658],{"type":48,"value":15659},"Containerization with Docker",{"type":42,"tag":61,"props":15661,"children":15662},{},[15663],{"type":48,"value":15664},"Testing",{"type":42,"tag":61,"props":15666,"children":15667},{},[15668],{"type":48,"value":15669},"GitOps",{"type":42,"tag":61,"props":15671,"children":15672},{},[15673,15675],{"type":48,"value":15674},"Serverless* ",{"type":42,"tag":9138,"props":15676,"children":15677},{},[15678],{"type":42,"tag":467,"props":15679,"children":15680},{},[15681],{"type":48,"value":1756},{"type":42,"tag":61,"props":15683,"children":15684},{},[15685],{"type":48,"value":15686},"Project documentation",{"type":42,"tag":61,"props":15688,"children":15689},{},[15690],{"type":48,"value":15691},"Cost containment and tracking",{"type":42,"tag":61,"props":15693,"children":15694},{},[15695],{"type":48,"value":15696},"KISS & DRY",{"type":42,"tag":61,"props":15698,"children":15699},{},[15700,15702,15707],{"type":48,"value":15701},"Initial AWS console interaction is strictly limited to what can ",{"type":42,"tag":5456,"props":15703,"children":15704},{},[15705],{"type":48,"value":15706},"only",{"type":48,"value":15708}," be done through the AWS console, otherwise AWS CDK and AWS CLI (preferably in CI/CD pipelines) are the primary means of interacting with AWS resources and the AWS Console is treated as a \"read-only\" convenience.",{"type":42,"tag":112,"props":15710,"children":15712},{"id":15711},"topics",[15713],{"type":48,"value":15714},"Topics",{"type":42,"tag":51,"props":15716,"children":15717},{},[15718],{"type":42,"tag":127,"props":15719,"children":15720},{"alt":5444,"src":15532},[],{"type":42,"tag":280,"props":15722,"children":15723},{"id":5609},[15724],{"type":48,"value":5612},{"type":42,"tag":723,"props":15726,"children":15727},{},[15728],{"type":42,"tag":51,"props":15729,"children":15730},{},[15731,15733],{"type":48,"value":15732},"This diagram was created with draw.io. Here's the link to the a read-only version of the diagram on draw.io: ",{"type":42,"tag":138,"props":15734,"children":15737},{"href":15735,"rel":15736},"https://drive.google.com/file/d/1gU61zjoW80fCusUcswU1zhEE5VFB1Z5U/view?usp=sharing",[142],[15738],{"type":48,"value":15735},{"type":42,"tag":51,"props":15740,"children":15741},{},[15742],{"type":48,"value":15743},"1 - GitLab is used to host the source code, test the source code and deploy the application to AWS.",{"type":42,"tag":51,"props":15745,"children":15746},{},[15747],{"type":48,"value":15748},"2 - Unit testing (see .gitlab-ci.yml)",{"type":42,"tag":51,"props":15750,"children":15751},{},[15752],{"type":48,"value":15753},"2a - Pytest",{"type":42,"tag":51,"props":15755,"children":15756},{},[15757],{"type":48,"value":15758},"2b - Jest",{"type":42,"tag":51,"props":15760,"children":15761},{},[15762],{"type":48,"value":15763},"2c - Cypress",{"type":42,"tag":51,"props":15765,"children":15766},{},[15767],{"type":48,"value":15768},"3 - Deployment phase (see /gitlab-ci/aws/cdk.yml)",{"type":42,"tag":51,"props":15770,"children":15771},{},[15772],{"type":48,"value":15773},"3a - Quasar PWA assets are built if there are changes in the quasar directory",{"type":42,"tag":51,"props":15775,"children":15776},{},[15777],{"type":48,"value":15778},"3b - AWS Cloud Development Kit (CDK) defines all infrastructure in AWS (4a - 12)",{"type":42,"tag":51,"props":15780,"children":15781},{},[15782],{"type":48,"value":15783},"3c - AWS CLI is used to run Fargate tasks through manual GitLab CI jobs",{"type":42,"tag":51,"props":15785,"children":15786},{},[15787],{"type":48,"value":15788},"4 - CDK Assets (ECR and S3 buckets that CDK uses internally to manage build assets and artifacts)",{"type":42,"tag":51,"props":15790,"children":15791},{},[15792],{"type":48,"value":15793},"4a - Elastic Container Repository is used to manage the Django docker image used in various parts of the application",{"type":42,"tag":51,"props":15795,"children":15796},{},[15797],{"type":48,"value":15798},"4b - S3 bucket used to store files associated with CDK and CloudFormation",{"type":42,"tag":51,"props":15800,"children":15801},{},[15802],{"type":48,"value":15803},"5 - Route53 is used to route traffic to the CloudFront distribution",{"type":42,"tag":51,"props":15805,"children":15806},{},[15807],{"type":48,"value":15808},"6 - CloudFront distribution that serves as the \"front desk\" of the application. It routes requests to to the correct CloudFront Origin",{"type":42,"tag":51,"props":15810,"children":15811},{},[15812],{"type":48,"value":15813},"7 - CloudFront Origin Configurations",{"type":42,"tag":51,"props":15815,"children":15816},{},[15817],{"type":48,"value":15818},"7a - S3 bucket for Quasar PWA assets",{"type":42,"tag":51,"props":15820,"children":15821},{},[15822],{"type":48,"value":15823},"7b - Application Load Balancer for Django application (/api/, /admin/, /flower/, /ws/, /graphql/)",{"type":42,"tag":51,"props":15825,"children":15826},{},[15827],{"type":48,"value":15828},"7c - S3 bucket for Django assets (static files, public media and private media)",{"type":42,"tag":51,"props":15830,"children":15831},{},[15832],{"type":48,"value":15833},"8 - Web server and websocket servers",{"type":42,"tag":51,"props":15835,"children":15836},{},[15837],{"type":48,"value":15838},"8a - Fargate service running uvicorn process (REST, GraphQL, Django Channels)",{"type":42,"tag":51,"props":15840,"children":15841},{},[15842],{"type":48,"value":15843},"8b - Autoscaling Group for Fargate Service that serves Django API",{"type":42,"tag":51,"props":15845,"children":15846},{},[15847],{"type":48,"value":15848},"9 - Celery and celery worker autoscaling",{"type":42,"tag":51,"props":15850,"children":15851},{},[15852],{"type":48,"value":15853},"9a - Fargate service that is autoscaled between 0 and N Fargate tasks for a given celery queue",{"type":42,"tag":51,"props":15855,"children":15856},{},[15857],{"type":48,"value":15858},"9b - Scheduled Event that triggers a Lambda to make a request to Django backend which collects celery queue metrics and published\nmetrics to CloudWatch using boto3",{"type":42,"tag":51,"props":15860,"children":15861},{},[15862],{"type":48,"value":15863},"9c - Lambda event the makes a request to /api/celery-metrics/",{"type":42,"tag":51,"props":15865,"children":15866},{},[15867],{"type":48,"value":15868},"9d - CloudWatch alarm that is used to scale the Fargate service for a celery queue",{"type":42,"tag":51,"props":15870,"children":15871},{},[15872],{"type":48,"value":15873},"9e - Autoscaling group for celery Fargate service",{"type":42,"tag":51,"props":15875,"children":15876},{},[15877],{"type":48,"value":15878},"10 - Fargate tasks that run Django management commands such as migrate and collectstatic. These are triggered from manual GitLab CI\njobs using the AWS CLI (3c)",{"type":42,"tag":51,"props":15880,"children":15881},{},[15882],{"type":48,"value":15883},"11 - ElastiCache for Redis, used for Caching, Celery Broker, Channels Layer, etc.",{"type":42,"tag":51,"props":15885,"children":15886},{},[15887],{"type":48,"value":15888},"12 - Aurora Postgres Serverless",{"type":42,"tag":51,"props":15890,"children":15891},{},[15892],{"type":48,"value":15893},"Here's a list of some of the major topics covered:",{"type":42,"tag":280,"props":15895,"children":15897},{"id":15896},"local-development",[15898],{"type":48,"value":15899},"Local development",{"type":42,"tag":57,"props":15901,"children":15902},{},[15903,15913,15918,15923,15928,15933],{"type":42,"tag":61,"props":15904,"children":15905},{},[15906,15908],{"type":48,"value":15907},"Setting up a local development environment using docker with one easy command: ",{"type":42,"tag":349,"props":15909,"children":15911},{"className":15910},[],[15912],{"type":48,"value":7741},{"type":42,"tag":61,"props":15914,"children":15915},{},[15916],{"type":48,"value":15917},"Hot-reloading for all parts of the application in local development",{"type":42,"tag":61,"props":15919,"children":15920},{},[15921],{"type":48,"value":15922},"Structuring a Django application (apps, settings modules, environment variables)",{"type":42,"tag":61,"props":15924,"children":15925},{},[15926],{"type":48,"value":15927},"Automatic code formatting with black and prettier",{"type":42,"tag":61,"props":15929,"children":15930},{},[15931],{"type":48,"value":15932},"Monitoring services (flower, pgadmin4, redis-commander)",{"type":42,"tag":61,"props":15934,"children":15935},{},[15936],{"type":48,"value":15937},"VSCode settings and extensions",{"type":42,"tag":280,"props":15939,"children":15941},{"id":15940},"gitlab-ci",[15942],{"type":48,"value":15943},"GitLab CI",{"type":42,"tag":57,"props":15945,"children":15946},{},[15947,15952,15957,15962,15967,15980],{"type":42,"tag":61,"props":15948,"children":15949},{},[15950],{"type":48,"value":15951},"GitLab CI for running unit and integration tests",{"type":42,"tag":61,"props":15953,"children":15954},{},[15955],{"type":48,"value":15956},"GitLab CI configuration for deployment to multiple environments (dev, prod) using AWS CDK",{"type":42,"tag":61,"props":15958,"children":15959},{},[15960],{"type":48,"value":15961},"GitLab CI scheduled jobs for updating all project dependencies through automated merge requests with Renovate",{"type":42,"tag":61,"props":15963,"children":15964},{},[15965],{"type":48,"value":15966},"GitLab CI manual jobs for running admin and management commands (database migrations, collectstatic, etc.)",{"type":42,"tag":61,"props":15968,"children":15969},{},[15970,15972,15978],{"type":48,"value":15971},"How to deploy to multiple environments (master -> staging, tags -> prod pattern as well as optional ephemeral environments per commit) using the new GitLab CI ",{"type":42,"tag":349,"props":15973,"children":15975},{"className":15974},[],[15976],{"type":48,"value":15977},"rules",{"type":48,"value":15979}," syntax",{"type":42,"tag":61,"props":15981,"children":15982},{},[15983],{"type":48,"value":15984},"Recording Cypress test videos with GitLab CI artifacts for manual review",{"type":42,"tag":280,"props":15986,"children":15988},{"id":15987},"aws",[15989],{"type":48,"value":15611},{"type":42,"tag":57,"props":15991,"children":15992},{},[15993,15998,16003,16008],{"type":42,"tag":61,"props":15994,"children":15995},{},[15996],{"type":48,"value":15997},"Initial account setup",{"type":42,"tag":61,"props":15999,"children":16000},{},[16001],{"type":48,"value":16002},"Generating keys used in GitLab CI for deployment",{"type":42,"tag":61,"props":16004,"children":16005},{},[16006],{"type":48,"value":16007},"Opting in to new ARN format for ECS services and tasks (used for resource tagging) and container insights",{"type":42,"tag":61,"props":16009,"children":16010},{},[16011],{"type":48,"value":16012},"AWS Cloud Development Kit (CDK) for Infrastructure as Code to manage all AWS resources with CloudFormation Stacks - Nested stacks for grouping related resources under parent tasks (one parent task represent on environment for the application, such as production)",{"type":42,"tag":16014,"props":16015,"children":16017},"h4",{"id":16016},"aws-resources",[16018],{"type":48,"value":16019},"AWS Resources",{"type":42,"tag":57,"props":16021,"children":16022},{},[16023,16028,16041,16046,16051,16056,16061,16066,16071,16076,16081],{"type":42,"tag":61,"props":16024,"children":16025},{},[16026],{"type":48,"value":16027},"Automated provisioning of Amazon Certificate Manager certificates for TLS (HTTPS)",{"type":42,"tag":61,"props":16029,"children":16030},{},[16031,16033,16040],{"type":48,"value":16032},"Multi-AZ VPC with security groups and NACLs (no NAT Gateways/NAT instances used* ",{"type":42,"tag":9138,"props":16034,"children":16035},{},[16036],{"type":42,"tag":467,"props":16037,"children":16038},{},[16039],{"type":48,"value":1600},{"type":48,"value":5652},{"type":42,"tag":61,"props":16042,"children":16043},{},[16044],{"type":48,"value":16045},"S3 buckets for static site hosting and Django static and media assets",{"type":42,"tag":61,"props":16047,"children":16048},{},[16049],{"type":48,"value":16050},"CloudFront for serving Vue.js SPA (PWA) static assets, Django static/media files and proxy to Application Load Balancer which forwards to ECS",{"type":42,"tag":61,"props":16052,"children":16053},{},[16054],{"type":48,"value":16055},"Fargate for multiple Django processes: gunicorn for backend API, daphne for Django Channels, celery for asynchronous tasks and celery beat for scheduled tasks",{"type":42,"tag":61,"props":16057,"children":16058},{},[16059],{"type":48,"value":16060},"Autoscaling (between 0 and N Fargate tasks) for infrequent, compute/memory intensive and long-running celery tasks with custom CloudWatch metrics",{"type":42,"tag":61,"props":16062,"children":16063},{},[16064],{"type":48,"value":16065},"Hosted Redis with ElastiCache for celery broker, application caching, django-constance, etc.",{"type":42,"tag":61,"props":16067,"children":16068},{},[16069],{"type":48,"value":16070},"Aurora Postgres and Aurora Postgres Serverless for cost savings in staging environments",{"type":42,"tag":61,"props":16072,"children":16073},{},[16074],{"type":48,"value":16075},"CDK Assets for automating S3 asset deployment and automated container building during deployment with AWS CDK",{"type":42,"tag":61,"props":16077,"children":16078},{},[16079],{"type":48,"value":16080},"Thorough resource tagging by both application and environment (dev, prod, etc.) for comprehensive cost tracking",{"type":42,"tag":61,"props":16082,"children":16083},{},[16084],{"type":48,"value":16085},"Optional bastion host for SSH access to bring up a Django shell in a container running on a container instance (this requires an EC2 instance)",{"type":42,"tag":280,"props":16087,"children":16089},{"id":16088},"django-application",[16090],{"type":48,"value":16091},"Django Application",{"type":42,"tag":57,"props":16093,"children":16094},{},[16095,16100,16105,16110,16123,16128,16133,16146,16151,16156,16161],{"type":42,"tag":61,"props":16096,"children":16097},{},[16098],{"type":48,"value":16099},"Django REST Framework",{"type":42,"tag":61,"props":16101,"children":16102},{},[16103],{"type":48,"value":16104},"JWT-based authentication with django-rest-framework-simplejwt",{"type":42,"tag":61,"props":16106,"children":16107},{},[16108],{"type":48,"value":16109},"Custom user model with email as username",{"type":42,"tag":61,"props":16111,"children":16112},{},[16113,16115,16121],{"type":48,"value":16114},"Social authentication with ",{"type":42,"tag":349,"props":16116,"children":16118},{"className":16117},[],[16119],{"type":48,"value":16120},"python-social-auth",{"type":48,"value":16122}," (Google, Facebook, GitHub)",{"type":42,"tag":61,"props":16124,"children":16125},{},[16126],{"type":48,"value":16127},"Pytest for unit testing",{"type":42,"tag":61,"props":16129,"children":16130},{},[16131],{"type":48,"value":16132},"Settings broken into separate modules (development, ci, production)",{"type":42,"tag":61,"props":16134,"children":16135},{},[16136,16138,16144],{"type":48,"value":16137},"Django apps organized in ",{"type":42,"tag":349,"props":16139,"children":16141},{"className":16140},[],[16142],{"type":48,"value":16143},"apps",{"type":48,"value":16145}," directory",{"type":42,"tag":61,"props":16147,"children":16148},{},[16149],{"type":48,"value":16150},"S3 for static assets, public media and private media files in production, local file system for assets in local development",{"type":42,"tag":61,"props":16152,"children":16153},{},[16154],{"type":48,"value":16155},"Multiple Celery queues for asynchronous tasks",{"type":42,"tag":61,"props":16157,"children":16158},{},[16159],{"type":48,"value":16160},"Django Channels for websocket support with daphne",{"type":42,"tag":61,"props":16162,"children":16163},{},[16164],{"type":48,"value":16165},"Graphene for GraphQL",{"type":42,"tag":280,"props":16167,"children":16169},{"id":16168},"vuejs-application",[16170],{"type":48,"value":16171},"Vue.js application",{"type":42,"tag":57,"props":16173,"children":16174},{},[16175,16180,16185,16190,16195,16200,16204],{"type":42,"tag":61,"props":16176,"children":16177},{},[16178],{"type":48,"value":16179},"Quasar Framework for creating a Vue.js app with multiple build targets (SPA, PWA, Electron, SSR and Cordova)",{"type":42,"tag":61,"props":16181,"children":16182},{},[16183],{"type":48,"value":16184},"Internationalization",{"type":42,"tag":61,"props":16186,"children":16187},{},[16188],{"type":48,"value":16189},"Dark/Light mode",{"type":42,"tag":61,"props":16191,"children":16192},{},[16193],{"type":48,"value":16194},"Vuex for state management",{"type":42,"tag":61,"props":16196,"children":16197},{},[16198],{"type":48,"value":16199},"vue-router",{"type":42,"tag":61,"props":16201,"children":16202},{},[16203],{"type":48,"value":7942},{"type":42,"tag":61,"props":16205,"children":16206},{},[16207],{"type":48,"value":16208},"Vue Apollo",{"type":42,"tag":280,"props":16210,"children":16212},{"id":16211},"aws-django-vuejs",[16213],{"type":48,"value":16214},"AWS âˆ© Django âˆ© Vue.js",{"type":42,"tag":51,"props":16216,"children":16217},{},[16218,16220,16227],{"type":48,"value":16219},"CloudFront is used as a CDN and proxy in order to serve the frontend Vue.js PWA* ",{"type":42,"tag":9138,"props":16221,"children":16222},{},[16223],{"type":42,"tag":467,"props":16224,"children":16225},{},[16226],{"type":48,"value":1738},{"type":48,"value":16228},", static and media assets, Django API and other monitoring services all on the same URL with environments namespaced by subdomain (or a combination of domain and subdomains by production and non-production environments, respectively). The PWA uses Workbox to route certain URL paths to network only (not served by the local cache).",{"type":42,"tag":51,"props":16230,"children":16231},{},[16232],{"type":48,"value":16233},"Here are some examples:",{"type":42,"tag":16014,"props":16235,"children":16237},{"id":16236},"staging-environment-urls",[16238],{"type":48,"value":16239},"Staging environment URLs",{"type":42,"tag":57,"props":16241,"children":16242},{},[16243,16254,16265,16276,16287,16298],{"type":42,"tag":61,"props":16244,"children":16245},{},[16246,16252],{"type":42,"tag":349,"props":16247,"children":16249},{"className":16248},[],[16250],{"type":48,"value":16251},"https://dev.mysite.com/api/*",{"type":48,"value":16253}," - Django REST Framework",{"type":42,"tag":61,"props":16255,"children":16256},{},[16257,16263],{"type":42,"tag":349,"props":16258,"children":16260},{"className":16259},[],[16261],{"type":48,"value":16262},"https://dev.mysite.com/admin/*",{"type":48,"value":16264}," - Django Admin",{"type":42,"tag":61,"props":16266,"children":16267},{},[16268,16274],{"type":42,"tag":349,"props":16269,"children":16271},{"className":16270},[],[16272],{"type":48,"value":16273},"https://dev.mysite.com/graphql/",{"type":48,"value":16275}," - Graphene/GraphQL",{"type":42,"tag":61,"props":16277,"children":16278},{},[16279,16285],{"type":42,"tag":349,"props":16280,"children":16282},{"className":16281},[],[16283],{"type":48,"value":16284},"https://dev.mysite.com/flower/*",{"type":48,"value":16286}," - Flower (Celery monitoring utility)",{"type":42,"tag":61,"props":16288,"children":16289},{},[16290,16296],{"type":42,"tag":349,"props":16291,"children":16293},{"className":16292},[],[16294],{"type":48,"value":16295},"https://dev.mysite.com/media/private/private-file.csv",{"type":48,"value":16297}," - private media files",{"type":42,"tag":61,"props":16299,"children":16300},{},[16301,16307,16309,16314],{"type":42,"tag":349,"props":16302,"children":16304},{"className":16303},[],[16305],{"type":48,"value":16306},"https://dev.mysite.com/*",{"type":48,"value":16308}," - Vue.js PWA (all other routes load ",{"type":42,"tag":349,"props":16310,"children":16312},{"className":16311},[],[16313],{"type":48,"value":5841},{"type":48,"value":5652},{"type":42,"tag":16014,"props":16316,"children":16318},{"id":16317},"production-environment-urls",[16319],{"type":48,"value":16320},"Production environment URLs",{"type":42,"tag":57,"props":16322,"children":16323},{},[16324,16334,16344,16354,16364,16374],{"type":42,"tag":61,"props":16325,"children":16326},{},[16327,16333],{"type":42,"tag":349,"props":16328,"children":16330},{"className":16329},[],[16331],{"type":48,"value":16332},"https://mysite.com/api/*",{"type":48,"value":16253},{"type":42,"tag":61,"props":16335,"children":16336},{},[16337,16343],{"type":42,"tag":349,"props":16338,"children":16340},{"className":16339},[],[16341],{"type":48,"value":16342},"https://mysite.com/admin/*",{"type":48,"value":16264},{"type":42,"tag":61,"props":16345,"children":16346},{},[16347,16353],{"type":42,"tag":349,"props":16348,"children":16350},{"className":16349},[],[16351],{"type":48,"value":16352},"https://mysite.com/graphql/",{"type":48,"value":16275},{"type":42,"tag":61,"props":16355,"children":16356},{},[16357,16363],{"type":42,"tag":349,"props":16358,"children":16360},{"className":16359},[],[16361],{"type":48,"value":16362},"https://mysite.com/flower/*",{"type":48,"value":16286},{"type":42,"tag":61,"props":16365,"children":16366},{},[16367,16373],{"type":42,"tag":349,"props":16368,"children":16370},{"className":16369},[],[16371],{"type":48,"value":16372},"https://mysite.com/media/private/private-file.csv",{"type":48,"value":16297},{"type":42,"tag":61,"props":16375,"children":16376},{},[16377,16382,16383,16388],{"type":42,"tag":349,"props":16378,"children":16380},{"className":16379},[],[16381],{"type":48,"value":8459},{"type":48,"value":16308},{"type":42,"tag":349,"props":16384,"children":16386},{"className":16385},[],[16387],{"type":48,"value":5841},{"type":48,"value":5652},{"type":42,"tag":51,"props":16390,"children":16391},{},[16392,16394,16400],{"type":48,"value":16393},"Alternatively, the production domain name could be configured to use a dedicated subdomain such as ",{"type":42,"tag":349,"props":16395,"children":16397},{"className":16396},[],[16398],{"type":48,"value":16399},"https://app.mysite.com",{"type":48,"value":1970},{"type":42,"tag":280,"props":16402,"children":16404},{"id":16403},"sample-application-logic",[16405],{"type":48,"value":16406},"Sample application logic",{"type":42,"tag":51,"props":16408,"children":16409},{},[16410],{"type":48,"value":16411},"While this is mostly a Proof-of-Concept project that focuses on architecture, I have included some light-weight examples of what you can do with this application. These examples are all WIP.",{"type":42,"tag":16014,"props":16413,"children":16415},{"id":16414},"social-authentication",[16416],{"type":48,"value":16417},"Social Authentication",{"type":42,"tag":57,"props":16419,"children":16420},{},[16421,16433],{"type":42,"tag":61,"props":16422,"children":16423},{},[16424,16426,16431],{"type":48,"value":16425},"Uses ",{"type":42,"tag":349,"props":16427,"children":16429},{"className":16428},[],[16430],{"type":48,"value":16120},{"type":48,"value":16432}," to allow users to Sign Up/Login with Google, Facebook and GitHub accounts",{"type":42,"tag":61,"props":16434,"children":16435},{},[16436],{"type":48,"value":16437},"Makes use of the custom user model",{"type":42,"tag":16014,"props":16439,"children":16441},{"id":16440},"credit-card-statement-app",[16442],{"type":48,"value":16443},"Credit Card Statement App",{"type":42,"tag":51,"props":16445,"children":16446},{},[16447],{"type":48,"value":16448},"This is a simple application for users to upload credit card statements in CSV format.",{"type":42,"tag":57,"props":16450,"children":16451},{},[16452,16457,16462,16467],{"type":42,"tag":61,"props":16453,"children":16454},{},[16455],{"type":48,"value":16456},"Credit card transactions in CSV files are created using bulk inserts via the Django ORM in a celery task",{"type":42,"tag":61,"props":16458,"children":16459},{},[16460],{"type":48,"value":16461},"CSV files are saved in private S3 storage",{"type":42,"tag":61,"props":16463,"children":16464},{},[16465],{"type":48,"value":16466},"Basic visualization of spend over time",{"type":42,"tag":61,"props":16468,"children":16469},{},[16470],{"type":48,"value":16471},"Download consolidated CSV file",{"type":42,"tag":16014,"props":16473,"children":16475},{"id":16474},"hacker-news-clone",[16476],{"type":48,"value":16477},"Hacker News Clone",{"type":42,"tag":57,"props":16479,"children":16480},{},[16481,16492],{"type":42,"tag":61,"props":16482,"children":16483},{},[16484,16486],{"type":48,"value":16485},"An implementation of the application from this tutorial: ",{"type":42,"tag":138,"props":16487,"children":16490},{"href":16488,"rel":16489},"https://www.howtographql.com/graphql-python/0-introduction/",[142],[16491],{"type":48,"value":16488},{"type":42,"tag":61,"props":16493,"children":16494},{},[16495],{"type":48,"value":16496},"Uses Vue Apollo GraphQL client",{"type":42,"tag":280,"props":16498,"children":16500},{"id":16499},"testing",[16501],{"type":48,"value":15664},{"type":42,"tag":57,"props":16503,"children":16504},{},[16505,16510,16515,16520,16525,16536],{"type":42,"tag":61,"props":16506,"children":16507},{},[16508],{"type":48,"value":16509},"Unit testing with pytest and Jest",{"type":42,"tag":61,"props":16511,"children":16512},{},[16513],{"type":48,"value":16514},"Test coverage reports",{"type":42,"tag":61,"props":16516,"children":16517},{},[16518],{"type":48,"value":16519},"Integration testing with Cypress",{"type":42,"tag":61,"props":16521,"children":16522},{},[16523],{"type":48,"value":16524},"Capture integration test run recordings as GitLab CI job artifacts",{"type":42,"tag":61,"props":16526,"children":16527},{},[16528,16530],{"type":48,"value":16529},"Testing GitLab CI jobs locally with ",{"type":42,"tag":349,"props":16531,"children":16533},{"className":16532},[],[16534],{"type":48,"value":16535},"gitlab-runner",{"type":42,"tag":61,"props":16537,"children":16538},{},[16539,16541],{"type":48,"value":16540},"Tests for CDK?* ",{"type":42,"tag":9138,"props":16542,"children":16543},{},[16544],{"type":42,"tag":467,"props":16545,"children":16546},{},[16547],{"type":48,"value":822},{"type":42,"tag":280,"props":16549,"children":16551},{"id":16550},"caveats-questions-confusion-and-footnotes",[16552],{"type":48,"value":16553},"Caveats, Questions, Confusion and Footnotes",{"type":42,"tag":3541,"props":16555,"children":16556},{},[16557,16562],{"type":42,"tag":61,"props":16558,"children":16559},{},[16560],{"type":48,"value":16561},"In the context of this project, it is serverless in the sense that AWS Fargate is serverless: there are no EC2 instances to manage. It is not serverless in the way that Zappa can deploy a Django application as an AWS Lambda function with one invocation per request. There are \"always on\" processes that listen for incoming requests. I'm interested in trying Zappa, but I'm confused about how CDK, zappa-cli, SAM and Serverless Framework would all play together. Aurora Postgres Serverless is another nice \"serverless\" aspect of this project and contributes significantly to cost savings.",{"type":42,"tag":61,"props":16563,"children":16564},{},[16565],{"type":48,"value":16566},"This project currently uses no NAT Gateways. The Fargate services and tasks running Django processes (gunicorn, celery, daphne as well as migration, collectstatic and other management commands) are launched in public subnets and the databases (RDS and ElastiCache) are placed in private subnets. This is primarily done to avoid the cost of running a NAT Gateway.",{"type":42,"tag":57,"props":16568,"children":16569},{},[16570,16582],{"type":42,"tag":61,"props":16571,"children":16572},{},[16573,16575,16581],{"type":48,"value":16574},"I think it would fairly easy to switch to using a NAT Gatway to add an additional layer of security that is recommended in this article: ",{"type":42,"tag":138,"props":16576,"children":16579},{"href":16577,"rel":16578},"https://aws.amazon.com/blogs/compute/task-networking-in-aws-fargate/",[142],[16580],{"type":48,"value":16577},{"type":48,"value":1970},{"type":42,"tag":61,"props":16583,"children":16584},{},[16585,16587,16593],{"type":48,"value":16586},"I asked a question about this on the Stack Exchange Information Security forum: ",{"type":42,"tag":138,"props":16588,"children":16591},{"href":16589,"rel":16590},"https://security.stackexchange.com/questions/232055/security-implications-of-using-public-subnets-in-aws-vpc-for-hosting-web-and-job",[142],[16592],{"type":48,"value":16589},{"type":48,"value":16594},"\nI'm curious to know if this is a reasonable tradeoff to make, as well as how secure the proposed solution is (using security groups and network ACLs).",{"type":42,"tag":3541,"props":16596,"children":16597},{"start":499},[16598,16610],{"type":42,"tag":61,"props":16599,"children":16600},{},[16601,16603,16608],{"type":48,"value":16602},"I'm not focusing on SEO in this project. I'm using ",{"type":42,"tag":349,"props":16604,"children":16606},{"className":16605},[],[16607],{"type":48,"value":5841},{"type":48,"value":16609}," as the error document for the S3 website that CloudFront uses as the default behavior. This means that nested routes for the PWA have 404 response codes. I have heard about using lambda@edge to rewrite the the response code, I'm also curious about using this project in SSR mode (and also \"serverless-side rendering\"), but for now that is outside of the scope of what I want to do with this project.",{"type":42,"tag":61,"props":16611,"children":16612},{},[16613,16618,16620,16626],{"type":42,"tag":9138,"props":16614,"children":16615},{},[16616],{"type":48,"value":16617},"CDK is an awesome tool!",{"type":48,"value":16619}," Here is a great introduction by Nathan Peck, Senior Developer Advocate at Amazon Web Services: ",{"type":42,"tag":138,"props":16621,"children":16624},{"href":16622,"rel":16623},"https://www.youtube.com/watch?v=184S7ki6fJA",[142],[16625],{"type":48,"value":16622},{"type":48,"value":1970},{"type":42,"tag":112,"props":16628,"children":16630},{"id":16629},"my-experience-with-aws-cdk",[16631],{"type":48,"value":16632},"My experience with AWS CDK",{"type":42,"tag":51,"props":16634,"children":16635},{},[16636],{"type":48,"value":16637},"Having worked with CloudFormation for almost a year, I was not looking forward to learning a another Infrastructure as Code (IaC) tool. I struggled with CloudFormation and the whole concept of using an extended version of YAML to define infrastructure for multiple environments. I have limited experience with Terraform, but learning another DSL seemed like a lateral move that didn't seem worth it. I'm glad I did spend time learning and using CloudFormation, because CDK is an abstraction layer over CloudFormation. Here are some of my thoughts on adopting CDK.",{"type":42,"tag":280,"props":16639,"children":16641},{"id":16640},"start-here-httpscdkworkshopcom",[16642,16644],{"type":48,"value":16643},"Start here: ",{"type":42,"tag":138,"props":16645,"children":16648},{"href":16646,"rel":16647},"https://cdkworkshop.com",[142],[16649],{"type":48,"value":16646},{"type":42,"tag":51,"props":16651,"children":16652},{},[16653],{"type":48,"value":16654},"This is a great resource that was my first exposure to CDK. It focuses on using Lambda, DynamoDB and API Gateway, three technologies that I haven't used in production environments. In my mind this stack is the antithesis of the stack paradigm I am most experienced with: EC2, RDS and ELB. Regardless, I went ahead with it and was pretty much instantly hooked on CDK.",{"type":42,"tag":280,"props":16656,"children":16658},{"id":16657},"the-stack-is-defined-by-a-small-number-of-inputs-used-for-namespacing",[16659],{"type":48,"value":16660},"The stack is defined by a small number of inputs used for namespacing",{"type":42,"tag":51,"props":16662,"children":16663},{},[16664,16670,16672,16677],{"type":42,"tag":349,"props":16665,"children":16667},{"className":16666},[],[16668],{"type":48,"value":16669},"awscdk/app.py",{"type":48,"value":16671}," is the entrypoint for ",{"type":42,"tag":349,"props":16673,"children":16675},{"className":16674},[],[16676],{"type":48,"value":15535},{"type":48,"value":16678}," commands. Here's what it contains:",{"type":42,"tag":51,"props":16680,"children":16681},{},[16682,16684,16690,16692,16698],{"type":48,"value":16683},"Here are the main parameters for ",{"type":42,"tag":349,"props":16685,"children":16687},{"className":16686},[],[16688],{"type":48,"value":16689},"ApplicationStack",{"type":48,"value":16691},", which represents all of the resources for a specific environment environment. Each value is composed of environment variables set in GitLab CI when ",{"type":42,"tag":349,"props":16693,"children":16695},{"className":16694},[],[16696],{"type":48,"value":16697},"cdk deploy",{"type":48,"value":16699}," is called:",{"type":42,"tag":57,"props":16701,"children":16702},{},[16703,16742,16753,16777,16809,16840],{"type":42,"tag":61,"props":16704,"children":16705},{},[16706,16712,16714,16719,16720,16726,16727,16733,16734,16740],{"type":42,"tag":349,"props":16707,"children":16709},{"className":16708},[],[16710],{"type":48,"value":16711},"environment_name",{"type":48,"value":16713}," - Possible examples could be ",{"type":42,"tag":349,"props":16715,"children":16717},{"className":16716},[],[16718],{"type":48,"value":3515},{"type":48,"value":935},{"type":42,"tag":349,"props":16721,"children":16723},{"className":16722},[],[16724],{"type":48,"value":16725},"qa",{"type":48,"value":935},{"type":42,"tag":349,"props":16728,"children":16730},{"className":16729},[],[16731],{"type":48,"value":16732},"some-feature-branch",{"type":48,"value":935},{"type":42,"tag":349,"props":16735,"children":16737},{"className":16736},[],[16738],{"type":48,"value":16739},"prod",{"type":48,"value":16741},", etc.",{"type":42,"tag":61,"props":16743,"children":16744},{},[16745,16751],{"type":42,"tag":349,"props":16746,"children":16748},{"className":16747},[],[16749],{"type":48,"value":16750},"base_domain_name",{"type":48,"value":16752}," - The domain name of the Hosted Zone that needs to be setup manually in Route53",{"type":42,"tag":61,"props":16754,"children":16755},{},[16756,16762,16764,16770,16772],{"type":42,"tag":349,"props":16757,"children":16759},{"className":16758},[],[16760],{"type":48,"value":16761},"full_domain_name",{"type":48,"value":16763}," - ",{"type":42,"tag":349,"props":16765,"children":16767},{"className":16766},[],[16768],{"type":48,"value":16769},"f\"{environment_name}.{base_domain_name}\"",{"type":48,"value":16771}," or optionally just ",{"type":42,"tag":349,"props":16773,"children":16775},{"className":16774},[],[16776],{"type":48,"value":16750},{"type":42,"tag":61,"props":16778,"children":16779},{},[16780,16786,16788,16793,16795,16800,16802,16807],{"type":42,"tag":349,"props":16781,"children":16783},{"className":16782},[],[16784],{"type":48,"value":16785},"base_app_name",{"type":48,"value":16787}," - Based on the ",{"type":42,"tag":349,"props":16789,"children":16791},{"className":16790},[],[16792],{"type":48,"value":16750},{"type":48,"value":16794},", but ",{"type":42,"tag":349,"props":16796,"children":16798},{"className":16797},[],[16799],{"type":48,"value":1970},{"type":48,"value":16801}," is replaced with ",{"type":42,"tag":349,"props":16803,"children":16805},{"className":16804},[],[16806],{"type":48,"value":1558},{"type":48,"value":16808}," in order to be used for naming certain AWS resources, used for resources tagging so we can easily look at the costs of all environments for our application with one tag.",{"type":42,"tag":61,"props":16810,"children":16811},{},[16812,16818,16820,16825,16826,16831,16833,16838],{"type":42,"tag":349,"props":16813,"children":16815},{"className":16814},[],[16816],{"type":48,"value":16817},"full_app_name",{"type":48,"value":16819}," - Base on ",{"type":42,"tag":349,"props":16821,"children":16823},{"className":16822},[],[16824],{"type":48,"value":16761},{"type":48,"value":935},{"type":42,"tag":349,"props":16827,"children":16829},{"className":16828},[],[16830],{"type":48,"value":1970},{"type":48,"value":16832}," replaced with ",{"type":42,"tag":349,"props":16834,"children":16836},{"className":16835},[],[16837],{"type":48,"value":1558},{"type":48,"value":16839}," as well.",{"type":42,"tag":61,"props":16841,"children":16842},{},[16843],{"type":42,"tag":349,"props":16844,"children":16846},{"className":16845},[],[16847],{"type":48,"value":16848},"aws_region",{"type":42,"tag":51,"props":16850,"children":16851},{},[16852,16854,16859],{"type":48,"value":16853},"Expand to the following to view ",{"type":42,"tag":349,"props":16855,"children":16857},{"className":16856},[],[16858],{"type":48,"value":16669},{"type":48,"value":4476},{"type":42,"tag":16861,"props":16862,"children":16863},"details",{},[16864],{"type":42,"tag":401,"props":16865,"children":16867},{"code":16866,"language":19,"meta":8,"className":461,"style":8},"#!/usr/bin/env python3\nimport os\n\nfrom aws_cdk import core\n\nfrom awscdk.cdk_app_root import ApplicationStack\n\n# naming conventions, also used for ACM certs, DNS Records, resource naming\n# Dynamically generated resource names created in CDK are used in GitLab CI\n# such as cluster name, task definitions, etc.\nenvironment_name = f\"{os.environ.get('ENVIRONMENT', 'dev')}\"\nbase_domain_name = os.environ.get(\"DOMAIN_NAME\", \"mysite.com\")\n# if the the production environent subdomain should nott be included in the URL\n# redefine `full_domain_name` to `base_domain_name` for that environment\nfull_domain_name = f\"{environment_name}.{base_domain_name}\"  # dev.mysite.com\n# if environment_name == \"prod\":\n#     full_domain_name = base_domain_name\nbase_app_name = os.environ.get(\"APP_NAME\", \"mysite-com\")\nfull_app_name = f\"{environment_name}-{base_app_name}\"  # dev-mysite-com\naws_region = os.environ.get(\"AWS_DEFAULT_REGION\", \"us-east-1\")\n\n\napp = core.App()\nstack = ApplicationStack(\n    app,\n    f\"{full_app_name}-stack\",\n    environment_name=environment_name,\n    base_domain_name=base_domain_name,\n    full_domain_name=full_domain_name,\n    base_app_name=base_app_name,\n    full_app_name=full_app_name,\n    env={\"region\": aws_region},\n)\n\n# in order to be able to tag ECS resources, you need to go to\n# the ECS Console > Account Settings > Amazon ECS ARN and resource ID settings\n# and enable at least Service and Task. Optionally enable\n# CloudWatch Container Insights\nstack.node.apply_aspect(core.Tag(\"StackName\", full_app_name))\nstack.node.apply_aspect(core.Tag(\"StackName\", base_app_name))\n\napp.synth()\n",[16868],{"type":42,"tag":349,"props":16869,"children":16870},{"__ignoreMap":8},[16871,16879,16890,16897,16918,16925,16946,16953,16961,16969,16977,17035,17070,17078,17086,17143,17151,17159,17193,17250,17284,17291,17298,17315,17332,17340,17373,17390,17407,17424,17441,17458,17484,17491,17498,17506,17514,17522,17530,17548,17564,17571],{"type":42,"tag":467,"props":16872,"children":16873},{"class":469,"line":470},[16874],{"type":42,"tag":467,"props":16875,"children":16876},{"style":1176},[16877],{"type":48,"value":16878},"#!/usr/bin/env python3\n",{"type":42,"tag":467,"props":16880,"children":16881},{"class":469,"line":486},[16882,16886],{"type":42,"tag":467,"props":16883,"children":16884},{"style":474},[16885],{"type":48,"value":477},{"type":42,"tag":467,"props":16887,"children":16888},{"style":480},[16889],{"type":48,"value":496},{"type":42,"tag":467,"props":16891,"children":16892},{"class":469,"line":499},[16893],{"type":42,"tag":467,"props":16894,"children":16895},{"emptyLinePlaceholder":37},[16896],{"type":48,"value":528},{"type":42,"tag":467,"props":16898,"children":16899},{"class":469,"line":522},[16900,16904,16909,16913],{"type":42,"tag":467,"props":16901,"children":16902},{"style":474},[16903],{"type":48,"value":505},{"type":42,"tag":467,"props":16905,"children":16906},{"style":480},[16907],{"type":48,"value":16908}," aws_cdk ",{"type":42,"tag":467,"props":16910,"children":16911},{"style":474},[16912],{"type":48,"value":477},{"type":42,"tag":467,"props":16914,"children":16915},{"style":480},[16916],{"type":48,"value":16917}," core\n",{"type":42,"tag":467,"props":16919,"children":16920},{"class":469,"line":531},[16921],{"type":42,"tag":467,"props":16922,"children":16923},{"emptyLinePlaceholder":37},[16924],{"type":48,"value":528},{"type":42,"tag":467,"props":16926,"children":16927},{"class":469,"line":550},[16928,16932,16937,16941],{"type":42,"tag":467,"props":16929,"children":16930},{"style":474},[16931],{"type":48,"value":505},{"type":42,"tag":467,"props":16933,"children":16934},{"style":480},[16935],{"type":48,"value":16936}," awscdk.cdk_app_root ",{"type":42,"tag":467,"props":16938,"children":16939},{"style":474},[16940],{"type":48,"value":477},{"type":42,"tag":467,"props":16942,"children":16943},{"style":480},[16944],{"type":48,"value":16945}," ApplicationStack\n",{"type":42,"tag":467,"props":16947,"children":16948},{"class":469,"line":575},[16949],{"type":42,"tag":467,"props":16950,"children":16951},{"emptyLinePlaceholder":37},[16952],{"type":48,"value":528},{"type":42,"tag":467,"props":16954,"children":16955},{"class":469,"line":598},[16956],{"type":42,"tag":467,"props":16957,"children":16958},{"style":1176},[16959],{"type":48,"value":16960},"# naming conventions, also used for ACM certs, DNS Records, resource naming\n",{"type":42,"tag":467,"props":16962,"children":16963},{"class":469,"line":616},[16964],{"type":42,"tag":467,"props":16965,"children":16966},{"style":1176},[16967],{"type":48,"value":16968},"# Dynamically generated resource names created in CDK are used in GitLab CI\n",{"type":42,"tag":467,"props":16970,"children":16971},{"class":469,"line":625},[16972],{"type":42,"tag":467,"props":16973,"children":16974},{"style":1176},[16975],{"type":48,"value":16976},"# such as cluster name, task definitions, etc.\n",{"type":42,"tag":467,"props":16978,"children":16979},{"class":469,"line":633},[16980,16985,16989,16994,16999,17003,17008,17013,17017,17022,17026,17030],{"type":42,"tag":467,"props":16981,"children":16982},{"style":480},[16983],{"type":48,"value":16984},"environment_name ",{"type":42,"tag":467,"props":16986,"children":16987},{"style":474},[16988],{"type":48,"value":542},{"type":42,"tag":467,"props":16990,"children":16991},{"style":903},[16992],{"type":48,"value":16993}," f",{"type":42,"tag":467,"props":16995,"children":16996},{"style":564},[16997],{"type":48,"value":16998},"\"",{"type":42,"tag":467,"props":17000,"children":17001},{"style":588},[17002],{"type":48,"value":916},{"type":42,"tag":467,"props":17004,"children":17005},{"style":480},[17006],{"type":48,"value":17007},"os.environ.get(",{"type":42,"tag":467,"props":17009,"children":17010},{"style":564},[17011],{"type":48,"value":17012},"'ENVIRONMENT'",{"type":42,"tag":467,"props":17014,"children":17015},{"style":480},[17016],{"type":48,"value":935},{"type":42,"tag":467,"props":17018,"children":17019},{"style":564},[17020],{"type":48,"value":17021},"'dev'",{"type":42,"tag":467,"props":17023,"children":17024},{"style":480},[17025],{"type":48,"value":5652},{"type":42,"tag":467,"props":17027,"children":17028},{"style":588},[17029],{"type":48,"value":925},{"type":42,"tag":467,"props":17031,"children":17032},{"style":564},[17033],{"type":48,"value":17034},"\"\n",{"type":42,"tag":467,"props":17036,"children":17037},{"class":469,"line":664},[17038,17043,17047,17052,17057,17061,17066],{"type":42,"tag":467,"props":17039,"children":17040},{"style":480},[17041],{"type":48,"value":17042},"base_domain_name ",{"type":42,"tag":467,"props":17044,"children":17045},{"style":474},[17046],{"type":48,"value":542},{"type":42,"tag":467,"props":17048,"children":17049},{"style":480},[17050],{"type":48,"value":17051}," os.environ.get(",{"type":42,"tag":467,"props":17053,"children":17054},{"style":564},[17055],{"type":48,"value":17056},"\"DOMAIN_NAME\"",{"type":42,"tag":467,"props":17058,"children":17059},{"style":480},[17060],{"type":48,"value":935},{"type":42,"tag":467,"props":17062,"children":17063},{"style":564},[17064],{"type":48,"value":17065},"\"mysite.com\"",{"type":42,"tag":467,"props":17067,"children":17068},{"style":480},[17069],{"type":48,"value":622},{"type":42,"tag":467,"props":17071,"children":17072},{"class":469,"line":672},[17073],{"type":42,"tag":467,"props":17074,"children":17075},{"style":1176},[17076],{"type":48,"value":17077},"# if the the production environent subdomain should nott be included in the URL\n",{"type":42,"tag":467,"props":17079,"children":17080},{"class":469,"line":690},[17081],{"type":42,"tag":467,"props":17082,"children":17083},{"style":1176},[17084],{"type":48,"value":17085},"# redefine `full_domain_name` to `base_domain_name` for that environment\n",{"type":42,"tag":467,"props":17087,"children":17088},{"class":469,"line":1336},[17089,17094,17098,17102,17106,17110,17114,17118,17122,17126,17130,17134,17138],{"type":42,"tag":467,"props":17090,"children":17091},{"style":480},[17092],{"type":48,"value":17093},"full_domain_name ",{"type":42,"tag":467,"props":17095,"children":17096},{"style":474},[17097],{"type":48,"value":542},{"type":42,"tag":467,"props":17099,"children":17100},{"style":903},[17101],{"type":48,"value":16993},{"type":42,"tag":467,"props":17103,"children":17104},{"style":564},[17105],{"type":48,"value":16998},{"type":42,"tag":467,"props":17107,"children":17108},{"style":588},[17109],{"type":48,"value":916},{"type":42,"tag":467,"props":17111,"children":17112},{"style":480},[17113],{"type":48,"value":16711},{"type":42,"tag":467,"props":17115,"children":17116},{"style":588},[17117],{"type":48,"value":925},{"type":42,"tag":467,"props":17119,"children":17120},{"style":564},[17121],{"type":48,"value":1970},{"type":42,"tag":467,"props":17123,"children":17124},{"style":588},[17125],{"type":48,"value":916},{"type":42,"tag":467,"props":17127,"children":17128},{"style":480},[17129],{"type":48,"value":16750},{"type":42,"tag":467,"props":17131,"children":17132},{"style":588},[17133],{"type":48,"value":925},{"type":42,"tag":467,"props":17135,"children":17136},{"style":564},[17137],{"type":48,"value":16998},{"type":42,"tag":467,"props":17139,"children":17140},{"style":1176},[17141],{"type":48,"value":17142},"  # dev.mysite.com\n",{"type":42,"tag":467,"props":17144,"children":17145},{"class":469,"line":1344},[17146],{"type":42,"tag":467,"props":17147,"children":17148},{"style":1176},[17149],{"type":48,"value":17150},"# if environment_name == \"prod\":\n",{"type":42,"tag":467,"props":17152,"children":17153},{"class":469,"line":1362},[17154],{"type":42,"tag":467,"props":17155,"children":17156},{"style":1176},[17157],{"type":48,"value":17158},"#     full_domain_name = base_domain_name\n",{"type":42,"tag":467,"props":17160,"children":17161},{"class":469,"line":1380},[17162,17167,17171,17175,17180,17184,17189],{"type":42,"tag":467,"props":17163,"children":17164},{"style":480},[17165],{"type":48,"value":17166},"base_app_name ",{"type":42,"tag":467,"props":17168,"children":17169},{"style":474},[17170],{"type":48,"value":542},{"type":42,"tag":467,"props":17172,"children":17173},{"style":480},[17174],{"type":48,"value":17051},{"type":42,"tag":467,"props":17176,"children":17177},{"style":564},[17178],{"type":48,"value":17179},"\"APP_NAME\"",{"type":42,"tag":467,"props":17181,"children":17182},{"style":480},[17183],{"type":48,"value":935},{"type":42,"tag":467,"props":17185,"children":17186},{"style":564},[17187],{"type":48,"value":17188},"\"mysite-com\"",{"type":42,"tag":467,"props":17190,"children":17191},{"style":480},[17192],{"type":48,"value":622},{"type":42,"tag":467,"props":17194,"children":17195},{"class":469,"line":1388},[17196,17201,17205,17209,17213,17217,17221,17225,17229,17233,17237,17241,17245],{"type":42,"tag":467,"props":17197,"children":17198},{"style":480},[17199],{"type":48,"value":17200},"full_app_name ",{"type":42,"tag":467,"props":17202,"children":17203},{"style":474},[17204],{"type":48,"value":542},{"type":42,"tag":467,"props":17206,"children":17207},{"style":903},[17208],{"type":48,"value":16993},{"type":42,"tag":467,"props":17210,"children":17211},{"style":564},[17212],{"type":48,"value":16998},{"type":42,"tag":467,"props":17214,"children":17215},{"style":588},[17216],{"type":48,"value":916},{"type":42,"tag":467,"props":17218,"children":17219},{"style":480},[17220],{"type":48,"value":16711},{"type":42,"tag":467,"props":17222,"children":17223},{"style":588},[17224],{"type":48,"value":925},{"type":42,"tag":467,"props":17226,"children":17227},{"style":564},[17228],{"type":48,"value":1558},{"type":42,"tag":467,"props":17230,"children":17231},{"style":588},[17232],{"type":48,"value":916},{"type":42,"tag":467,"props":17234,"children":17235},{"style":480},[17236],{"type":48,"value":16785},{"type":42,"tag":467,"props":17238,"children":17239},{"style":588},[17240],{"type":48,"value":925},{"type":42,"tag":467,"props":17242,"children":17243},{"style":564},[17244],{"type":48,"value":16998},{"type":42,"tag":467,"props":17246,"children":17247},{"style":1176},[17248],{"type":48,"value":17249},"  # dev-mysite-com\n",{"type":42,"tag":467,"props":17251,"children":17252},{"class":469,"line":1423},[17253,17258,17262,17266,17271,17275,17280],{"type":42,"tag":467,"props":17254,"children":17255},{"style":480},[17256],{"type":48,"value":17257},"aws_region ",{"type":42,"tag":467,"props":17259,"children":17260},{"style":474},[17261],{"type":48,"value":542},{"type":42,"tag":467,"props":17263,"children":17264},{"style":480},[17265],{"type":48,"value":17051},{"type":42,"tag":467,"props":17267,"children":17268},{"style":564},[17269],{"type":48,"value":17270},"\"AWS_DEFAULT_REGION\"",{"type":42,"tag":467,"props":17272,"children":17273},{"style":480},[17274],{"type":48,"value":935},{"type":42,"tag":467,"props":17276,"children":17277},{"style":564},[17278],{"type":48,"value":17279},"\"us-east-1\"",{"type":42,"tag":467,"props":17281,"children":17282},{"style":480},[17283],{"type":48,"value":622},{"type":42,"tag":467,"props":17285,"children":17286},{"class":469,"line":1441},[17287],{"type":42,"tag":467,"props":17288,"children":17289},{"emptyLinePlaceholder":37},[17290],{"type":48,"value":528},{"type":42,"tag":467,"props":17292,"children":17293},{"class":469,"line":1449},[17294],{"type":42,"tag":467,"props":17295,"children":17296},{"emptyLinePlaceholder":37},[17297],{"type":48,"value":528},{"type":42,"tag":467,"props":17299,"children":17300},{"class":469,"line":1458},[17301,17306,17310],{"type":42,"tag":467,"props":17302,"children":17303},{"style":480},[17304],{"type":48,"value":17305},"app ",{"type":42,"tag":467,"props":17307,"children":17308},{"style":474},[17309],{"type":48,"value":542},{"type":42,"tag":467,"props":17311,"children":17312},{"style":480},[17313],{"type":48,"value":17314}," core.App()\n",{"type":42,"tag":467,"props":17316,"children":17317},{"class":469,"line":1476},[17318,17323,17327],{"type":42,"tag":467,"props":17319,"children":17320},{"style":480},[17321],{"type":48,"value":17322},"stack ",{"type":42,"tag":467,"props":17324,"children":17325},{"style":474},[17326],{"type":48,"value":542},{"type":42,"tag":467,"props":17328,"children":17329},{"style":480},[17330],{"type":48,"value":17331}," ApplicationStack(\n",{"type":42,"tag":467,"props":17333,"children":17334},{"class":469,"line":1511},[17335],{"type":42,"tag":467,"props":17336,"children":17337},{"style":480},[17338],{"type":48,"value":17339},"    app,\n",{"type":42,"tag":467,"props":17341,"children":17342},{"class":469,"line":1519},[17343,17348,17352,17356,17360,17364,17369],{"type":42,"tag":467,"props":17344,"children":17345},{"style":903},[17346],{"type":48,"value":17347},"    f",{"type":42,"tag":467,"props":17349,"children":17350},{"style":564},[17351],{"type":48,"value":16998},{"type":42,"tag":467,"props":17353,"children":17354},{"style":588},[17355],{"type":48,"value":916},{"type":42,"tag":467,"props":17357,"children":17358},{"style":480},[17359],{"type":48,"value":16817},{"type":42,"tag":467,"props":17361,"children":17362},{"style":588},[17363],{"type":48,"value":925},{"type":42,"tag":467,"props":17365,"children":17366},{"style":564},[17367],{"type":48,"value":17368},"-stack\"",{"type":42,"tag":467,"props":17370,"children":17371},{"style":480},[17372],{"type":48,"value":572},{"type":42,"tag":467,"props":17374,"children":17375},{"class":469,"line":1528},[17376,17381,17385],{"type":42,"tag":467,"props":17377,"children":17378},{"style":554},[17379],{"type":48,"value":17380},"    environment_name",{"type":42,"tag":467,"props":17382,"children":17383},{"style":474},[17384],{"type":48,"value":542},{"type":42,"tag":467,"props":17386,"children":17387},{"style":480},[17388],{"type":48,"value":17389},"environment_name,\n",{"type":42,"tag":467,"props":17391,"children":17392},{"class":469,"line":1575},[17393,17398,17402],{"type":42,"tag":467,"props":17394,"children":17395},{"style":554},[17396],{"type":48,"value":17397},"    base_domain_name",{"type":42,"tag":467,"props":17399,"children":17400},{"style":474},[17401],{"type":48,"value":542},{"type":42,"tag":467,"props":17403,"children":17404},{"style":480},[17405],{"type":48,"value":17406},"base_domain_name,\n",{"type":42,"tag":467,"props":17408,"children":17409},{"class":469,"line":1624},[17410,17415,17419],{"type":42,"tag":467,"props":17411,"children":17412},{"style":554},[17413],{"type":48,"value":17414},"    full_domain_name",{"type":42,"tag":467,"props":17416,"children":17417},{"style":474},[17418],{"type":48,"value":542},{"type":42,"tag":467,"props":17420,"children":17421},{"style":480},[17422],{"type":48,"value":17423},"full_domain_name,\n",{"type":42,"tag":467,"props":17425,"children":17426},{"class":469,"line":1632},[17427,17432,17436],{"type":42,"tag":467,"props":17428,"children":17429},{"style":554},[17430],{"type":48,"value":17431},"    base_app_name",{"type":42,"tag":467,"props":17433,"children":17434},{"style":474},[17435],{"type":48,"value":542},{"type":42,"tag":467,"props":17437,"children":17438},{"style":480},[17439],{"type":48,"value":17440},"base_app_name,\n",{"type":42,"tag":467,"props":17442,"children":17443},{"class":469,"line":1641},[17444,17449,17453],{"type":42,"tag":467,"props":17445,"children":17446},{"style":554},[17447],{"type":48,"value":17448},"    full_app_name",{"type":42,"tag":467,"props":17450,"children":17451},{"style":474},[17452],{"type":48,"value":542},{"type":42,"tag":467,"props":17454,"children":17455},{"style":480},[17456],{"type":48,"value":17457},"full_app_name,\n",{"type":42,"tag":467,"props":17459,"children":17460},{"class":469,"line":1659},[17461,17466,17470,17474,17479],{"type":42,"tag":467,"props":17462,"children":17463},{"style":554},[17464],{"type":48,"value":17465},"    env",{"type":42,"tag":467,"props":17467,"children":17468},{"style":474},[17469],{"type":48,"value":542},{"type":42,"tag":467,"props":17471,"children":17472},{"style":480},[17473],{"type":48,"value":916},{"type":42,"tag":467,"props":17475,"children":17476},{"style":564},[17477],{"type":48,"value":17478},"\"region\"",{"type":42,"tag":467,"props":17480,"children":17481},{"style":480},[17482],{"type":48,"value":17483},": aws_region},\n",{"type":42,"tag":467,"props":17485,"children":17486},{"class":469,"line":1687},[17487],{"type":42,"tag":467,"props":17488,"children":17489},{"style":480},[17490],{"type":48,"value":622},{"type":42,"tag":467,"props":17492,"children":17493},{"class":469,"line":1695},[17494],{"type":42,"tag":467,"props":17495,"children":17496},{"emptyLinePlaceholder":37},[17497],{"type":48,"value":528},{"type":42,"tag":467,"props":17499,"children":17500},{"class":469,"line":1704},[17501],{"type":42,"tag":467,"props":17502,"children":17503},{"style":1176},[17504],{"type":48,"value":17505},"# in order to be able to tag ECS resources, you need to go to\n",{"type":42,"tag":467,"props":17507,"children":17508},{"class":469,"line":1763},[17509],{"type":42,"tag":467,"props":17510,"children":17511},{"style":1176},[17512],{"type":48,"value":17513},"# the ECS Console > Account Settings > Amazon ECS ARN and resource ID settings\n",{"type":42,"tag":467,"props":17515,"children":17516},{"class":469,"line":1771},[17517],{"type":42,"tag":467,"props":17518,"children":17519},{"style":1176},[17520],{"type":48,"value":17521},"# and enable at least Service and Task. Optionally enable\n",{"type":42,"tag":467,"props":17523,"children":17524},{"class":469,"line":1780},[17525],{"type":42,"tag":467,"props":17526,"children":17527},{"style":1176},[17528],{"type":48,"value":17529},"# CloudWatch Container Insights\n",{"type":42,"tag":467,"props":17531,"children":17532},{"class":469,"line":1809},[17533,17538,17543],{"type":42,"tag":467,"props":17534,"children":17535},{"style":480},[17536],{"type":48,"value":17537},"stack.node.apply_aspect(core.Tag(",{"type":42,"tag":467,"props":17539,"children":17540},{"style":564},[17541],{"type":48,"value":17542},"\"StackName\"",{"type":42,"tag":467,"props":17544,"children":17545},{"style":480},[17546],{"type":48,"value":17547},", full_app_name))\n",{"type":42,"tag":467,"props":17549,"children":17550},{"class":469,"line":1835},[17551,17555,17559],{"type":42,"tag":467,"props":17552,"children":17553},{"style":480},[17554],{"type":48,"value":17537},{"type":42,"tag":467,"props":17556,"children":17557},{"style":564},[17558],{"type":48,"value":17542},{"type":42,"tag":467,"props":17560,"children":17561},{"style":480},[17562],{"type":48,"value":17563},", base_app_name))\n",{"type":42,"tag":467,"props":17565,"children":17566},{"class":469,"line":1870},[17567],{"type":42,"tag":467,"props":17568,"children":17569},{"emptyLinePlaceholder":37},[17570],{"type":48,"value":528},{"type":42,"tag":467,"props":17572,"children":17573},{"class":469,"line":1878},[17574],{"type":42,"tag":467,"props":17575,"children":17576},{"style":480},[17577],{"type":48,"value":17578},"app.synth()\n",{"type":42,"tag":280,"props":17580,"children":17582},{"id":17581},"using-cdk-synth-in-development",[17583,17585,17591],{"type":48,"value":17584},"Using ",{"type":42,"tag":349,"props":17586,"children":17588},{"className":17587},[],[17589],{"type":48,"value":17590},"cdk synth",{"type":48,"value":17592}," in development",{"type":42,"tag":51,"props":17594,"children":17595},{},[17596,17598,17604,17606,17612,17614,17620,17621,17627,17628,17634,17636,17642,17644,17650,17652,17657,17659,17664],{"type":48,"value":17597},"When I first started using CDK, I defined a root stack containing multiple CDK constructs that each included groups of related CDK resources. For example, I had an ",{"type":42,"tag":349,"props":17599,"children":17601},{"className":17600},[],[17602],{"type":48,"value":17603},"RDSConstruct",{"type":48,"value":17605}," that contained a ",{"type":42,"tag":349,"props":17607,"children":17609},{"className":17608},[],[17610],{"type":48,"value":17611},"Secret",{"type":48,"value":17613},", a ",{"type":42,"tag":349,"props":17615,"children":17617},{"className":17616},[],[17618],{"type":48,"value":17619},"StringParameter",{"type":48,"value":17613},{"type":42,"tag":349,"props":17622,"children":17624},{"className":17623},[],[17625],{"type":48,"value":17626},"CfnSecurityGroup",{"type":48,"value":17613},{"type":42,"tag":349,"props":17629,"children":17631},{"className":17630},[],[17632],{"type":48,"value":17633},"CfnDBSubnetGroup",{"type":48,"value":17635}," and a ",{"type":42,"tag":349,"props":17637,"children":17639},{"className":17638},[],[17640],{"type":48,"value":17641},"CfnDBCluster",{"type":48,"value":17643},". Whenever I added a new section of CDK code, I would run ",{"type":42,"tag":349,"props":17645,"children":17647},{"className":17646},[],[17648],{"type":48,"value":17649},"cdk synth > stack.yml",{"type":48,"value":17651}," to generate a \"snapshot\" of my infrastructure in one file. ",{"type":42,"tag":349,"props":17653,"children":17655},{"className":17654},[],[17656],{"type":48,"value":13089},{"type":48,"value":17658}," was committed in my repo, and I could easily see how changes in CDK code changed the resulting CloudFormation YAML by repeating this ",{"type":42,"tag":349,"props":17660,"children":17662},{"className":17661},[],[17663],{"type":48,"value":17590},{"type":48,"value":12556},{"type":42,"tag":280,"props":17666,"children":17668},{"id":17667},"nestedstacks",[17669,17675],{"type":42,"tag":349,"props":17670,"children":17672},{"className":17671},[],[17673],{"type":48,"value":17674},"NestedStack",{"type":48,"value":17676},"s",{"type":42,"tag":51,"props":17678,"children":17679},{},[17680,17685,17687,17692,17694,17700,17702,17708,17710,17715,17716,17722,17724,17730,17732,17738,17740,17745,17747,17753,17755,17760],{"type":42,"tag":349,"props":17681,"children":17683},{"className":17682},[],[17684],{"type":48,"value":13089},{"type":48,"value":17686}," grew larger and larger as I added more resources in my main \"master stack\" or \"skeleton stack\", and I realized that I was going to reach the hard limit of 200 resources per CloudFormation stack. Refactoring to use ",{"type":42,"tag":349,"props":17688,"children":17690},{"className":17689},[],[17691],{"type":48,"value":17674},{"type":48,"value":17693},"s was pretty straightforward, all I had to do was replace ",{"type":42,"tag":349,"props":17695,"children":17697},{"className":17696},[],[17698],{"type":48,"value":17699},"core.Construct",{"type":48,"value":17701}," with ",{"type":42,"tag":349,"props":17703,"children":17705},{"className":17704},[],[17706],{"type":48,"value":17707},"cloudformation.NestedStack",{"type":48,"value":17709},". With nested stacks, running ",{"type":42,"tag":349,"props":17711,"children":17713},{"className":17712},[],[17714],{"type":48,"value":17649},{"type":48,"value":14261},{"type":42,"tag":349,"props":17717,"children":17719},{"className":17718},[],[17720],{"type":48,"value":17721},"AWS::CloudFormation::Stack",{"type":48,"value":17723},"s that are created, with ",{"type":42,"tag":349,"props":17725,"children":17727},{"className":17726},[],[17728],{"type":48,"value":17729},"TemplateURL",{"type":48,"value":17731}," and parameters from other stacks. It is more useful to look into contents of ",{"type":42,"tag":349,"props":17733,"children":17735},{"className":17734},[],[17736],{"type":48,"value":17737},"cdk.out",{"type":48,"value":17739}," when working with ",{"type":42,"tag":349,"props":17741,"children":17743},{"className":17742},[],[17744],{"type":48,"value":17674},{"type":48,"value":17746},"s. The following command (executed from the root of the project) update the contents of the ",{"type":42,"tag":349,"props":17748,"children":17750},{"className":17749},[],[17751],{"type":48,"value":17752},"awscdk/cdk.out",{"type":48,"value":17754}," directory with templates for each of the ",{"type":42,"tag":349,"props":17756,"children":17758},{"className":17757},[],[17759],{"type":48,"value":17674},{"type":48,"value":17761},"s:",{"type":42,"tag":401,"props":17763,"children":17765},{"code":17764},"cdk synth --app awscdk/app.py --output awscdk/cdk.out\n",[17766],{"type":42,"tag":349,"props":17767,"children":17768},{"__ignoreMap":8},[17769],{"type":48,"value":17764},{"type":42,"tag":51,"props":17771,"children":17772},{},[17773,17775,17780,17781,17786,17788,17794],{"type":48,"value":17774},"The result is JSON, not YAML, and ",{"type":42,"tag":349,"props":17776,"children":17778},{"className":17777},[],[17779],{"type":48,"value":17737},{"type":48,"value":12103},{"type":42,"tag":349,"props":17782,"children":17784},{"className":17783},[],[17785],{"type":48,"value":12171},{"type":48,"value":17787},"d, but it can still be helpful in verifying that your CDK code is generating the correct CloudFormation templates. (",{"type":42,"tag":349,"props":17789,"children":17791},{"className":17790},[],[17792],{"type":48,"value":17793},"cdk diff",{"type":48,"value":17795}," may be the best option for seeing how CDK code changes will change your infrastructure).",{"type":42,"tag":280,"props":17797,"children":17799},{"id":17798},"cdk-deploy-and-cdk-in-gitlab-ci-pipelines",[17800,17805],{"type":42,"tag":349,"props":17801,"children":17803},{"className":17802},[],[17804],{"type":48,"value":16697},{"type":48,"value":17806}," and CDK in GitLab CI pipelines",{"type":42,"tag":51,"props":17808,"children":17809},{},[17810,17812,17817,17818,17824,17826,17832,17834,17840],{"type":48,"value":17811},"I like how ",{"type":42,"tag":349,"props":17813,"children":17815},{"className":17814},[],[17816],{"type":48,"value":16697},{"type":48,"value":12089},{"type":42,"tag":349,"props":17819,"children":17821},{"className":17820},[],[17822],{"type":48,"value":17823},"tail",{"type":48,"value":17825},"s the output of CloudFormation events until the stack update finishes or fails. I previously had been using the AWS CLI to call ",{"type":42,"tag":349,"props":17827,"children":17829},{"className":17828},[],[17830],{"type":48,"value":17831},"aws cloudformation update-stack",{"type":48,"value":17833},". This command kicks off a stack update and the GitLab pipeline will succeed regardless of the success of failure of the ",{"type":42,"tag":349,"props":17835,"children":17837},{"className":17836},[],[17838],{"type":48,"value":17839},"update-stack",{"type":48,"value":12556},{"type":42,"tag":723,"props":17842,"children":17843},{},[17844],{"type":42,"tag":51,"props":17845,"children":17846},{},[17847,17849,17854,17856,17861],{"type":48,"value":17848},"With CDK, the CI pipeline that calls ",{"type":42,"tag":349,"props":17850,"children":17852},{"className":17851},[],[17853],{"type":48,"value":16697},{"type":48,"value":17855}," fails if ",{"type":42,"tag":349,"props":17857,"children":17859},{"className":17858},[],[17860],{"type":48,"value":16697},{"type":48,"value":17862}," results in a stack rollback.",{"type":42,"tag":51,"props":17864,"children":17865},{},[17866,17868,17873,17875,17880],{"type":48,"value":17867},"I couldn't find any examples of how to run ",{"type":42,"tag":349,"props":17869,"children":17871},{"className":17870},[],[17872],{"type":48,"value":16697},{"type":48,"value":17874}," in a GitLab CI pipeline (using the Python version of CDK, or any version of CDK). It would be nice if there was an official image maintained for the different languages that are ready to run CDK deploy. Here's how I got ",{"type":42,"tag":349,"props":17876,"children":17878},{"className":17877},[],[17879],{"type":48,"value":16697},{"type":48,"value":17881}," working correctly in my CI/CD pipline:",{"type":42,"tag":401,"props":17883,"children":17885},{"code":17884,"language":15171,"meta":8,"className":15172,"style":8},"cdk deploy:\n  image: docker:19.03.1\n  services:\n    - docker:19.03.5-dind\n  stage: deploy\n  only:\n    - master\n  variables:\n    ENVIRONMENT: dev\n    DOCKER_TLS_CERTDIR: ''\n  before_script:\n    - apk add nodejs-current npm\n    - npm i -g aws-cdk\n    - apk add --no-cache python3\n    - pip3 install -e awscdk\n  script:\n    - cdk bootstrap --app awscdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n    - cdk deploy --app awscdk/app.py --require-approval never\n",[17886],{"type":42,"tag":349,"props":17887,"children":17888},{"__ignoreMap":8},[17889,17900,17915,17926,17937,17952,17964,17975,17986,18003,18020,18031,18043,18055,18067,18079,18090,18102],{"type":42,"tag":467,"props":17890,"children":17891},{"class":469,"line":470},[17892,17896],{"type":42,"tag":467,"props":17893,"children":17894},{"style":3660},[17895],{"type":48,"value":16697},{"type":42,"tag":467,"props":17897,"children":17898},{"style":480},[17899],{"type":48,"value":3693},{"type":42,"tag":467,"props":17901,"children":17902},{"class":469,"line":486},[17903,17907,17911],{"type":42,"tag":467,"props":17904,"children":17905},{"style":3660},[17906],{"type":48,"value":11752},{"type":42,"tag":467,"props":17908,"children":17909},{"style":480},[17910],{"type":48,"value":3668},{"type":42,"tag":467,"props":17912,"children":17913},{"style":564},[17914],{"type":48,"value":11761},{"type":42,"tag":467,"props":17916,"children":17917},{"class":469,"line":499},[17918,17922],{"type":42,"tag":467,"props":17919,"children":17920},{"style":3660},[17921],{"type":48,"value":11769},{"type":42,"tag":467,"props":17923,"children":17924},{"style":480},[17925],{"type":48,"value":3693},{"type":42,"tag":467,"props":17927,"children":17928},{"class":469,"line":522},[17929,17933],{"type":42,"tag":467,"props":17930,"children":17931},{"style":480},[17932],{"type":48,"value":11781},{"type":42,"tag":467,"props":17934,"children":17935},{"style":564},[17936],{"type":48,"value":11786},{"type":42,"tag":467,"props":17938,"children":17939},{"class":469,"line":531},[17940,17944,17948],{"type":42,"tag":467,"props":17941,"children":17942},{"style":3660},[17943],{"type":48,"value":11735},{"type":42,"tag":467,"props":17945,"children":17946},{"style":480},[17947],{"type":48,"value":3668},{"type":42,"tag":467,"props":17949,"children":17950},{"style":564},[17951],{"type":48,"value":4104},{"type":42,"tag":467,"props":17953,"children":17954},{"class":469,"line":550},[17955,17960],{"type":42,"tag":467,"props":17956,"children":17957},{"style":3660},[17958],{"type":48,"value":17959},"  only",{"type":42,"tag":467,"props":17961,"children":17962},{"style":480},[17963],{"type":48,"value":3693},{"type":42,"tag":467,"props":17965,"children":17966},{"class":469,"line":575},[17967,17971],{"type":42,"tag":467,"props":17968,"children":17969},{"style":480},[17970],{"type":48,"value":11781},{"type":42,"tag":467,"props":17972,"children":17973},{"style":564},[17974],{"type":48,"value":3730},{"type":42,"tag":467,"props":17976,"children":17977},{"class":469,"line":598},[17978,17982],{"type":42,"tag":467,"props":17979,"children":17980},{"style":3660},[17981],{"type":48,"value":12670},{"type":42,"tag":467,"props":17983,"children":17984},{"style":480},[17985],{"type":48,"value":3693},{"type":42,"tag":467,"props":17987,"children":17988},{"class":469,"line":616},[17989,17994,17998],{"type":42,"tag":467,"props":17990,"children":17991},{"style":3660},[17992],{"type":48,"value":17993},"    ENVIRONMENT",{"type":42,"tag":467,"props":17995,"children":17996},{"style":480},[17997],{"type":48,"value":3668},{"type":42,"tag":467,"props":17999,"children":18000},{"style":564},[18001],{"type":48,"value":18002},"dev\n",{"type":42,"tag":467,"props":18004,"children":18005},{"class":469,"line":625},[18006,18011,18015],{"type":42,"tag":467,"props":18007,"children":18008},{"style":3660},[18009],{"type":48,"value":18010},"    DOCKER_TLS_CERTDIR",{"type":42,"tag":467,"props":18012,"children":18013},{"style":480},[18014],{"type":48,"value":3668},{"type":42,"tag":467,"props":18016,"children":18017},{"style":564},[18018],{"type":48,"value":18019},"''\n",{"type":42,"tag":467,"props":18021,"children":18022},{"class":469,"line":633},[18023,18027],{"type":42,"tag":467,"props":18024,"children":18025},{"style":3660},[18026],{"type":48,"value":11794},{"type":42,"tag":467,"props":18028,"children":18029},{"style":480},[18030],{"type":48,"value":3693},{"type":42,"tag":467,"props":18032,"children":18033},{"class":469,"line":664},[18034,18038],{"type":42,"tag":467,"props":18035,"children":18036},{"style":480},[18037],{"type":48,"value":11781},{"type":42,"tag":467,"props":18039,"children":18040},{"style":564},[18041],{"type":48,"value":18042},"apk add nodejs-current npm\n",{"type":42,"tag":467,"props":18044,"children":18045},{"class":469,"line":672},[18046,18050],{"type":42,"tag":467,"props":18047,"children":18048},{"style":480},[18049],{"type":48,"value":11781},{"type":42,"tag":467,"props":18051,"children":18052},{"style":564},[18053],{"type":48,"value":18054},"npm i -g aws-cdk\n",{"type":42,"tag":467,"props":18056,"children":18057},{"class":469,"line":690},[18058,18062],{"type":42,"tag":467,"props":18059,"children":18060},{"style":480},[18061],{"type":48,"value":11781},{"type":42,"tag":467,"props":18063,"children":18064},{"style":564},[18065],{"type":48,"value":18066},"apk add --no-cache python3\n",{"type":42,"tag":467,"props":18068,"children":18069},{"class":469,"line":1336},[18070,18074],{"type":42,"tag":467,"props":18071,"children":18072},{"style":480},[18073],{"type":48,"value":11781},{"type":42,"tag":467,"props":18075,"children":18076},{"style":564},[18077],{"type":48,"value":18078},"pip3 install -e awscdk\n",{"type":42,"tag":467,"props":18080,"children":18081},{"class":469,"line":1344},[18082,18086],{"type":42,"tag":467,"props":18083,"children":18084},{"style":3660},[18085],{"type":48,"value":11818},{"type":42,"tag":467,"props":18087,"children":18088},{"style":480},[18089],{"type":48,"value":3693},{"type":42,"tag":467,"props":18091,"children":18092},{"class":469,"line":1362},[18093,18097],{"type":42,"tag":467,"props":18094,"children":18095},{"style":480},[18096],{"type":48,"value":11781},{"type":42,"tag":467,"props":18098,"children":18099},{"style":564},[18100],{"type":48,"value":18101},"cdk bootstrap --app awscdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n",{"type":42,"tag":467,"props":18103,"children":18104},{"class":469,"line":1380},[18105,18109],{"type":42,"tag":467,"props":18106,"children":18107},{"style":480},[18108],{"type":48,"value":11781},{"type":42,"tag":467,"props":18110,"children":18111},{"style":564},[18112],{"type":48,"value":18113},"cdk deploy --app awscdk/app.py --require-approval never\n",{"type":42,"tag":51,"props":18115,"children":18116},{},[18117,18119,18125,18127,18132,18134,18140],{"type":48,"value":18118},"I have all of my CDK code in a top level directory called ",{"type":42,"tag":349,"props":18120,"children":18122},{"className":18121},[],[18123],{"type":48,"value":18124},"awscdk",{"type":48,"value":18126},", my Django code is in the top level ",{"type":42,"tag":349,"props":18128,"children":18130},{"className":18129},[],[18131],{"type":48,"value":7997},{"type":48,"value":18133}," directory and my frontend code is in the top level ",{"type":42,"tag":349,"props":18135,"children":18137},{"className":18136},[],[18138],{"type":48,"value":18139},"quasar",{"type":48,"value":18141}," directory. This directory structure is important, I'll come back to it shortly. Here are some things to note about this GitLab CI job definition:",{"type":42,"tag":57,"props":18143,"children":18144},{},[18145,18196,18222],{"type":42,"tag":61,"props":18146,"children":18147},{},[18148,18150,18155,18157,18163,18165,18171,18173,18179,18181,18187,18189,18194],{"type":48,"value":18149},"It uses the base ",{"type":42,"tag":349,"props":18151,"children":18153},{"className":18152},[],[18154],{"type":48,"value":7534},{"type":48,"value":18156}," image with ",{"type":42,"tag":349,"props":18158,"children":18160},{"className":18159},[],[18161],{"type":48,"value":18162},"docker:dind",{"type":48,"value":18164}," as a dependent service. This is necessary only if you hare using CDK constructs that build docker images and make use of ",{"type":42,"tag":349,"props":18166,"children":18168},{"className":18167},[],[18169],{"type":48,"value":18170},"cdk bootstrap",{"type":48,"value":18172},", such as the ",{"type":42,"tag":349,"props":18174,"children":18176},{"className":18175},[],[18177],{"type":48,"value":18178},"aws_ecs.AssetImage",{"type":48,"value":18180}," that I use to define ",{"type":42,"tag":349,"props":18182,"children":18184},{"className":18183},[],[18185],{"type":48,"value":18186},"self.image",{"type":48,"value":18188}," in the ",{"type":42,"tag":349,"props":18190,"children":18192},{"className":18191},[],[18193],{"type":48,"value":16689},{"type":48,"value":18195}," class that defines that main stack of my application.",{"type":42,"tag":61,"props":18197,"children":18198},{},[18199,18201,18206,18208,18213,18215,18220],{"type":48,"value":18200},"It requires node, npm python and pip, so these all need to be installed via ",{"type":42,"tag":349,"props":18202,"children":18204},{"className":18203},[],[18205],{"type":48,"value":12895},{"type":48,"value":18207},", the package manager for Alpine Linux. These are done in the ",{"type":42,"tag":349,"props":18209,"children":18211},{"className":18210},[],[18212],{"type":48,"value":12192},{"type":48,"value":18214},", the setup for the main \"script\" where ",{"type":42,"tag":349,"props":18216,"children":18218},{"className":18217},[],[18219],{"type":48,"value":16697},{"type":48,"value":18221}," is called.",{"type":42,"tag":61,"props":18223,"children":18224},{},[18225,18227,18233,18235,18240,18242,18247],{"type":48,"value":18226},"The main ",{"type":42,"tag":349,"props":18228,"children":18230},{"className":18229},[],[18231],{"type":48,"value":18232},"script",{"type":48,"value":18234}," section calls ",{"type":42,"tag":349,"props":18236,"children":18238},{"className":18237},[],[18239],{"type":48,"value":18170},{"type":48,"value":18241},". You only need to call ",{"type":42,"tag":349,"props":18243,"children":18245},{"className":18244},[],[18246],{"type":48,"value":18170},{"type":48,"value":18248}," once to initialize resources that CDK will use, so placing it here in my CI script is more of a reminder that we are using CDK assets (S3 buckets and ECR images); calling it again once it has been called initially on your AWS account does nothing, and you will see a message that communicates this:",{"type":42,"tag":401,"props":18250,"children":18252},{"code":18251}," $ cdk bootstrap --app awscdk/app.py aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION\n  â³  Bootstrapping environment aws://XXXXXXXXXXXX/us-east-1...\n  âœ…  Environment aws://XXXXXXXXXXXX/us-east-1 bootstrapped (no changes).\n",[18253],{"type":42,"tag":349,"props":18254,"children":18255},{"__ignoreMap":8},[18256],{"type":48,"value":18251},{"type":42,"tag":280,"props":18258,"children":18260},{"id":18259},"cdk-bootstap",[18261],{"type":42,"tag":349,"props":18262,"children":18264},{"className":18263},[],[18265],{"type":48,"value":18266},"cdk bootstap",{"type":42,"tag":51,"props":18268,"children":18269},{},[18270,18275],{"type":42,"tag":349,"props":18271,"children":18273},{"className":18272},[],[18274],{"type":48,"value":18170},{"type":48,"value":18276}," is one of my favorite features of CDK. As I mentioned earlier, it is used with S3 and ECR.",{"type":42,"tag":16014,"props":18278,"children":18280},{"id":18279},"s3-assets",[18281],{"type":48,"value":18282},"S3 Assets",{"type":42,"tag":51,"props":18284,"children":18285},{},[18286,18288,18293],{"type":48,"value":18287},"With S3, it allows you to populate the contents of an S3 bucket. Here's an example from ",{"type":42,"tag":349,"props":18289,"children":18291},{"className":18290},[],[18292],{"type":48,"value":16689},{"type":48,"value":4476},{"type":42,"tag":401,"props":18295,"children":18297},{"code":18296,"language":19,"meta":8,"className":461,"style":8},"        if os.path.isdir(\"./quasar/dist/pwa\"):\n            s3_deployment.BucketDeployment(\n                self,\n                \"BucketDeployment\",\n                destination_bucket=self.static_site_bucket,\n                sources=[s3_deployment.Source.asset(\"./quasar/dist/pwa\")],\n                distribution=self.cloudfront.distribution,\n            )\n",[18298],{"type":42,"tag":349,"props":18299,"children":18300},{"__ignoreMap":8},[18301,18322,18330,18342,18354,18375,18401,18422],{"type":42,"tag":467,"props":18302,"children":18303},{"class":469,"line":470},[18304,18308,18313,18318],{"type":42,"tag":467,"props":18305,"children":18306},{"style":474},[18307],{"type":48,"value":2026},{"type":42,"tag":467,"props":18309,"children":18310},{"style":480},[18311],{"type":48,"value":18312}," os.path.isdir(",{"type":42,"tag":467,"props":18314,"children":18315},{"style":564},[18316],{"type":48,"value":18317},"\"./quasar/dist/pwa\"",{"type":42,"tag":467,"props":18319,"children":18320},{"style":480},[18321],{"type":48,"value":1508},{"type":42,"tag":467,"props":18323,"children":18324},{"class":469,"line":486},[18325],{"type":42,"tag":467,"props":18326,"children":18327},{"style":480},[18328],{"type":48,"value":18329},"            s3_deployment.BucketDeployment(\n",{"type":42,"tag":467,"props":18331,"children":18332},{"class":469,"line":499},[18333,18338],{"type":42,"tag":467,"props":18334,"children":18335},{"style":2067},[18336],{"type":48,"value":18337},"                self",{"type":42,"tag":467,"props":18339,"children":18340},{"style":480},[18341],{"type":48,"value":572},{"type":42,"tag":467,"props":18343,"children":18344},{"class":469,"line":522},[18345,18350],{"type":42,"tag":467,"props":18346,"children":18347},{"style":564},[18348],{"type":48,"value":18349},"                \"BucketDeployment\"",{"type":42,"tag":467,"props":18351,"children":18352},{"style":480},[18353],{"type":48,"value":572},{"type":42,"tag":467,"props":18355,"children":18356},{"class":469,"line":531},[18357,18362,18366,18370],{"type":42,"tag":467,"props":18358,"children":18359},{"style":554},[18360],{"type":48,"value":18361},"                destination_bucket",{"type":42,"tag":467,"props":18363,"children":18364},{"style":474},[18365],{"type":48,"value":542},{"type":42,"tag":467,"props":18367,"children":18368},{"style":2067},[18369],{"type":48,"value":2004},{"type":42,"tag":467,"props":18371,"children":18372},{"style":480},[18373],{"type":48,"value":18374},".static_site_bucket,\n",{"type":42,"tag":467,"props":18376,"children":18377},{"class":469,"line":550},[18378,18383,18387,18392,18396],{"type":42,"tag":467,"props":18379,"children":18380},{"style":554},[18381],{"type":48,"value":18382},"                sources",{"type":42,"tag":467,"props":18384,"children":18385},{"style":474},[18386],{"type":48,"value":542},{"type":42,"tag":467,"props":18388,"children":18389},{"style":480},[18390],{"type":48,"value":18391},"[s3_deployment.Source.asset(",{"type":42,"tag":467,"props":18393,"children":18394},{"style":564},[18395],{"type":48,"value":18317},{"type":42,"tag":467,"props":18397,"children":18398},{"style":480},[18399],{"type":48,"value":18400},")],\n",{"type":42,"tag":467,"props":18402,"children":18403},{"class":469,"line":575},[18404,18409,18413,18417],{"type":42,"tag":467,"props":18405,"children":18406},{"style":554},[18407],{"type":48,"value":18408},"                distribution",{"type":42,"tag":467,"props":18410,"children":18411},{"style":474},[18412],{"type":48,"value":542},{"type":42,"tag":467,"props":18414,"children":18415},{"style":2067},[18416],{"type":48,"value":2004},{"type":42,"tag":467,"props":18418,"children":18419},{"style":480},[18420],{"type":48,"value":18421},".cloudfront.distribution,\n",{"type":42,"tag":467,"props":18423,"children":18424},{"class":469,"line":598},[18425],{"type":42,"tag":467,"props":18426,"children":18427},{"style":480},[18428],{"type":48,"value":18429},"            )\n",{"type":42,"tag":51,"props":18431,"children":18432},{},[18433,18435,18441,18443,18449,18451,18457,18459,18464],{"type":48,"value":18434},"If the directory ",{"type":42,"tag":349,"props":18436,"children":18438},{"className":18437},[],[18439],{"type":48,"value":18440},"./quasar/dist/pwa",{"type":48,"value":18442}," exists, CDK will upload the contents of that directory to the ",{"type":42,"tag":349,"props":18444,"children":18446},{"className":18445},[],[18447],{"type":48,"value":18448},"static_site_bucket",{"type":48,"value":18450}," and then invalidate the cache for ",{"type":42,"tag":349,"props":18452,"children":18454},{"className":18453},[],[18455],{"type":48,"value":18456},"self.cloudfront.distribution",{"type":48,"value":18458},", all in one shot. ",{"type":42,"tag":349,"props":18460,"children":18462},{"className":18461},[],[18463],{"type":48,"value":18440},{"type":48,"value":18465}," is the directory where assets from my frontend PWA are placed when compiled. GitLab CI passes these files between the jobs using artifacts:",{"type":42,"tag":401,"props":18467,"children":18469},{"code":18468,"language":15171,"meta":8,"className":15172,"style":8},"artifacts:\n  paths:\n    - quasar/dist/pwa\n",[18470],{"type":42,"tag":349,"props":18471,"children":18472},{"__ignoreMap":8},[18473,18485,18497],{"type":42,"tag":467,"props":18474,"children":18475},{"class":469,"line":470},[18476,18481],{"type":42,"tag":467,"props":18477,"children":18478},{"style":3660},[18479],{"type":48,"value":18480},"artifacts",{"type":42,"tag":467,"props":18482,"children":18483},{"style":480},[18484],{"type":48,"value":3693},{"type":42,"tag":467,"props":18486,"children":18487},{"class":469,"line":486},[18488,18493],{"type":42,"tag":467,"props":18489,"children":18490},{"style":3660},[18491],{"type":48,"value":18492},"  paths",{"type":42,"tag":467,"props":18494,"children":18495},{"style":480},[18496],{"type":48,"value":3693},{"type":42,"tag":467,"props":18498,"children":18499},{"class":469,"line":499},[18500,18504],{"type":42,"tag":467,"props":18501,"children":18502},{"style":480},[18503],{"type":48,"value":11781},{"type":42,"tag":467,"props":18505,"children":18506},{"style":564},[18507],{"type":48,"value":18508},"quasar/dist/pwa\n",{"type":42,"tag":51,"props":18510,"children":18511},{},[18512,18514,18519,18521,18527],{"type":48,"value":18513},"The job to build PWA assets can be set to only run when there are changes in the ",{"type":42,"tag":349,"props":18515,"children":18517},{"className":18516},[],[18518],{"type":48,"value":18139},{"type":48,"value":18520}," directory, so the ",{"type":42,"tag":349,"props":18522,"children":18524},{"className":18523},[],[18525],{"type":48,"value":18526},".quasar/dist/pwa",{"type":48,"value":18528}," directory will only exist if the job is executed. This helps speed up our CI/CD pipeline.",{"type":42,"tag":16014,"props":18530,"children":18532},{"id":18531},"ecr-assets",[18533],{"type":48,"value":18534},"ECR Assets",{"type":42,"tag":51,"props":18536,"children":18537},{},[18538,18540,18546,18548,18553],{"type":48,"value":18539},"I use ",{"type":42,"tag":349,"props":18541,"children":18543},{"className":18542},[],[18544],{"type":48,"value":18545},"cdk boostrap",{"type":48,"value":18547}," and CDK assets in a similar way for building and pushing my application container. In ",{"type":42,"tag":349,"props":18549,"children":18551},{"className":18550},[],[18552],{"type":48,"value":16689},{"type":48,"value":18554},", I define the following:",{"type":42,"tag":401,"props":18556,"children":18558},{"code":18557,"language":19,"meta":8,"className":461,"style":8},"        self.image = ecs.AssetImage(\n            \"./backend\", file=\"scripts/prod/Dockerfile\", target=\"production\",\n        )\n",[18559],{"type":42,"tag":349,"props":18560,"children":18561},{"__ignoreMap":8},[18562,18584,18632],{"type":42,"tag":467,"props":18563,"children":18564},{"class":469,"line":470},[18565,18570,18575,18579],{"type":42,"tag":467,"props":18566,"children":18567},{"style":2067},[18568],{"type":48,"value":18569},"        self",{"type":42,"tag":467,"props":18571,"children":18572},{"style":480},[18573],{"type":48,"value":18574},".image ",{"type":42,"tag":467,"props":18576,"children":18577},{"style":474},[18578],{"type":48,"value":542},{"type":42,"tag":467,"props":18580,"children":18581},{"style":480},[18582],{"type":48,"value":18583}," ecs.AssetImage(\n",{"type":42,"tag":467,"props":18585,"children":18586},{"class":469,"line":486},[18587,18592,18596,18601,18605,18610,18614,18619,18623,18628],{"type":42,"tag":467,"props":18588,"children":18589},{"style":564},[18590],{"type":48,"value":18591},"            \"./backend\"",{"type":42,"tag":467,"props":18593,"children":18594},{"style":480},[18595],{"type":48,"value":935},{"type":42,"tag":467,"props":18597,"children":18598},{"style":554},[18599],{"type":48,"value":18600},"file",{"type":42,"tag":467,"props":18602,"children":18603},{"style":474},[18604],{"type":48,"value":542},{"type":42,"tag":467,"props":18606,"children":18607},{"style":564},[18608],{"type":48,"value":18609},"\"scripts/prod/Dockerfile\"",{"type":42,"tag":467,"props":18611,"children":18612},{"style":480},[18613],{"type":48,"value":935},{"type":42,"tag":467,"props":18615,"children":18616},{"style":554},[18617],{"type":48,"value":18618},"target",{"type":42,"tag":467,"props":18620,"children":18621},{"style":474},[18622],{"type":48,"value":542},{"type":42,"tag":467,"props":18624,"children":18625},{"style":564},[18626],{"type":48,"value":18627},"\"production\"",{"type":42,"tag":467,"props":18629,"children":18630},{"style":480},[18631],{"type":48,"value":572},{"type":42,"tag":467,"props":18633,"children":18634},{"class":469,"line":499},[18635],{"type":42,"tag":467,"props":18636,"children":18637},{"style":480},[18638],{"type":48,"value":18639},"        )\n",{"type":42,"tag":51,"props":18641,"children":18642},{},[18643,18645,18650,18652,18658,18659,18665,18666,18671,18673,18678],{"type":48,"value":18644},"This image is then referenced by multiple ",{"type":42,"tag":349,"props":18646,"children":18648},{"className":18647},[],[18649],{"type":48,"value":17674},{"type":48,"value":18651},"s that define Fargate services and tasks (",{"type":42,"tag":349,"props":18653,"children":18655},{"className":18654},[],[18656],{"type":48,"value":18657},"gunicorn",{"type":48,"value":935},{"type":42,"tag":349,"props":18660,"children":18662},{"className":18661},[],[18663],{"type":48,"value":18664},"daphne",{"type":48,"value":935},{"type":42,"tag":349,"props":18667,"children":18669},{"className":18668},[],[18670],{"type":48,"value":8141},{"type":48,"value":18672}," workers, etc.) This keeps our CDK code DRY.. Don't Repeat Yourself! Similarly, we aren't rebuilding, pushing and pulling the backend container when there are no changes to the code in ",{"type":42,"tag":349,"props":18674,"children":18676},{"className":18675},[],[18677],{"type":48,"value":7997},{"type":48,"value":4857},{"type":42,"tag":51,"props":18680,"children":18681},{},[18682,18684,18690,18692,18697],{"type":48,"value":18683},"I'm not setting up an ECR image repository for my application, but I believe there is a way to do this. One question that I have about using ",{"type":42,"tag":349,"props":18685,"children":18687},{"className":18686},[],[18688],{"type":48,"value":18689},"ecs.AssetImage",{"type":48,"value":18691}," is about image lifecycle management. I know that you can implement rules about how many images you want to keep in an ECR image repository, but ",{"type":42,"tag":9138,"props":18693,"children":18694},{},[18695],{"type":48,"value":18696},"I'm not sure how this works with CDK Image Assets",{"type":48,"value":1970},{"type":42,"tag":280,"props":18699,"children":18701},{"id":18700},"quick-tour-of-applicationstack",[18702,18704],{"type":48,"value":18703},"Quick tour of ",{"type":42,"tag":349,"props":18705,"children":18707},{"className":18706},[],[18708],{"type":48,"value":16689},{"type":42,"tag":51,"props":18710,"children":18711},{},[18712,18714,18719],{"type":48,"value":18713},"Here's a very quick look at the structure of my CDK code, focusing on the ",{"type":42,"tag":349,"props":18715,"children":18717},{"className":18716},[],[18718],{"type":48,"value":16689},{"type":48,"value":18720},", the \"master stack\" or \"skeleton stack\" that contains.",{"type":42,"tag":16014,"props":18722,"children":18724},{"id":18723},"hosted_zone",[18725],{"type":42,"tag":349,"props":18726,"children":18728},{"className":18727},[],[18729],{"type":48,"value":18723},{"type":42,"tag":51,"props":18731,"children":18732},{},[18733,18735,18741,18742,18748],{"type":48,"value":18734},"We get the hosted zone using the ",{"type":42,"tag":349,"props":18736,"children":18738},{"className":18737},[],[18739],{"type":48,"value":18740},"DOMAIN_NAME",{"type":48,"value":2751},{"type":42,"tag":349,"props":18743,"children":18745},{"className":18744},[],[18746],{"type":48,"value":18747},"HOSTED_ZONE_ID",{"type":48,"value":18749},". This is not a nested stack.",{"type":42,"tag":16014,"props":18751,"children":18753},{"id":18752},"site_certificate",[18754],{"type":42,"tag":349,"props":18755,"children":18757},{"className":18756},[],[18758],{"type":48,"value":18752},{"type":42,"tag":51,"props":18760,"children":18761},{},[18762,18764,18769],{"type":48,"value":18763},"The ACM Certificate that will be used for the given environment. This references the ",{"type":42,"tag":349,"props":18765,"children":18767},{"className":18766},[],[18768],{"type":48,"value":16761},{"type":48,"value":18770}," (environment + application).",{"type":42,"tag":16014,"props":18772,"children":18774},{"id":18773},"vpc_stack",[18775],{"type":42,"tag":349,"props":18776,"children":18778},{"className":18777},[],[18779],{"type":48,"value":18773},{"type":42,"tag":51,"props":18781,"children":18782},{},[18783,18785,18790,18792,18798,18800,18806,18807,18813,18815,18820],{"type":48,"value":18784},"A ",{"type":42,"tag":349,"props":18786,"children":18788},{"className":18787},[],[18789],{"type":48,"value":17674},{"type":48,"value":18791}," for defining VPC resources. This construct generates lots of CloudFormation resources. I currently have ",{"type":42,"tag":349,"props":18793,"children":18795},{"className":18794},[],[18796],{"type":48,"value":18797},"nat_gateways",{"type":48,"value":18799}," set to zero, and I'm ",{"type":42,"tag":349,"props":18801,"children":18803},{"className":18802},[],[18804],{"type":48,"value":18805},"PUBLIC",{"type":48,"value":2751},{"type":42,"tag":349,"props":18808,"children":18810},{"className":18809},[],[18811],{"type":48,"value":18812},"PRIVATE",{"type":48,"value":18814}," subnets spread over 2 AZs. As I mentioned earlier, this is primarily for cost considerations and it is a best practice to use the tiered security model and run our Fargate tasks in private subnets instead of public subnets. I think I need to add NACL resources in this ",{"type":42,"tag":349,"props":18816,"children":18818},{"className":18817},[],[18819],{"type":48,"value":17674},{"type":48,"value":1970},{"type":42,"tag":16014,"props":18822,"children":18824},{"id":18823},"alb_stack",[18825],{"type":42,"tag":349,"props":18826,"children":18828},{"className":18827},[],[18829],{"type":48,"value":18823},{"type":42,"tag":51,"props":18831,"children":18832},{},[18833,18835,18841,18842,18848,18850,18855,18857,18862],{"type":48,"value":18834},"This defines the load balancer, configures that will send traffic to our Fargate services (such as our Django API). I was a little bit unclear about needing a ",{"type":42,"tag":349,"props":18836,"children":18838},{"className":18837},[],[18839],{"type":48,"value":18840},"listener",{"type":48,"value":2751},{"type":42,"tag":349,"props":18843,"children":18845},{"className":18844},[],[18846],{"type":48,"value":18847},"https_listener",{"type":48,"value":18849},". I might be able to get away with removing the ",{"type":42,"tag":349,"props":18851,"children":18853},{"className":18852},[],[18854],{"type":48,"value":18840},{"type":48,"value":18856}," and only using ",{"type":42,"tag":349,"props":18858,"children":18860},{"className":18859},[],[18861],{"type":48,"value":18847},{"type":48,"value":1970},{"type":42,"tag":16014,"props":18864,"children":18866},{"id":18865},"static_site_stack",[18867],{"type":42,"tag":349,"props":18868,"children":18870},{"className":18869},[],[18871],{"type":48,"value":18865},{"type":42,"tag":51,"props":18873,"children":18874},{},[18875],{"type":48,"value":18876},"This stack defines the S3 bucket and policies that will be used for hosting our static site (Quasar PWA).",{"type":42,"tag":16014,"props":18878,"children":18880},{"id":18879},"backend_assets",[18881],{"type":42,"tag":349,"props":18882,"children":18884},{"className":18883},[],[18885],{"type":48,"value":18879},{"type":42,"tag":51,"props":18887,"children":18888},{},[18889],{"type":48,"value":18890},"This stack defines the bucket and policies for managing the bucket that holds static and media assets for Django.",{"type":42,"tag":16014,"props":18892,"children":18894},{"id":18893},"cloudfront",[18895],{"type":42,"tag":349,"props":18896,"children":18898},{"className":18897},[],[18899],{"type":48,"value":18893},{"type":42,"tag":51,"props":18901,"children":18902},{},[18903,18905,18911],{"type":48,"value":18904},"This defines the CloudFront distribution that ties together several different parts of the application. It is the \"front desk\" of the application, and acts as a CDN and proxy. There is a separate CloudFront distribution for each environment (dev, staging, production). This stack also defines the Route53 ",{"type":42,"tag":349,"props":18906,"children":18908},{"className":18907},[],[18909],{"type":48,"value":18910},"ARecord",{"type":48,"value":18912}," that will be used to send traffic to a specific subdomain to the correct CloudFront distribution.",{"type":42,"tag":51,"props":18914,"children":18915},{},[18916,18918,18924],{"type":48,"value":18917},"There are three ",{"type":42,"tag":349,"props":18919,"children":18921},{"className":18920},[],[18922],{"type":48,"value":18923},"origin_configs",{"type":48,"value":18925}," for each distribution:",{"type":42,"tag":3541,"props":18927,"children":18928},{},[18929,18940,18950],{"type":42,"tag":61,"props":18930,"children":18931},{},[18932,18938],{"type":42,"tag":349,"props":18933,"children":18935},{"className":18934},[],[18936],{"type":48,"value":18937},"CustomOriginConfig",{"type":48,"value":18939}," for the ALB",{"type":42,"tag":61,"props":18941,"children":18942},{},[18943,18948],{"type":42,"tag":349,"props":18944,"children":18946},{"className":18945},[],[18947],{"type":48,"value":18937},{"type":48,"value":18949}," for the S3 bucket website",{"type":42,"tag":61,"props":18951,"children":18952},{},[18953,18959],{"type":42,"tag":349,"props":18954,"children":18956},{"className":18955},[],[18957],{"type":48,"value":18958},"S3OriginConfig",{"type":48,"value":18960}," for the Django static assets",{"type":42,"tag":51,"props":18962,"children":18963},{},[18964,18966,18971,18973,18979],{"type":48,"value":18965},"Note that these ",{"type":42,"tag":349,"props":18967,"children":18969},{"className":18968},[],[18970],{"type":48,"value":18923},{"type":48,"value":18972}," each have different ",{"type":42,"tag":349,"props":18974,"children":18976},{"className":18975},[],[18977],{"type":48,"value":18978},"behaviors",{"type":48,"value":18980},", and that list comprehension is used to keep this code DRY.",{"type":42,"tag":16014,"props":18982,"children":18984},{"id":18983},"bucketdeployment",[18985],{"type":42,"tag":349,"props":18986,"children":18988},{"className":18987},[],[18989],{"type":48,"value":18990},"BucketDeployment",{"type":42,"tag":51,"props":18992,"children":18993},{},[18994,18996,19001],{"type":48,"value":18995},"This will deploy our static site assets to the S3 bucket defined in ",{"type":42,"tag":349,"props":18997,"children":18999},{"className":18998},[],[19000],{"type":48,"value":18865},{"type":48,"value":19002}," if the static site assets are present at the time of deployment. If they are not present, this means that there were no changes made to the frontend site.",{"type":42,"tag":16014,"props":19004,"children":19006},{"id":19005},"ecs",[19007],{"type":42,"tag":349,"props":19008,"children":19010},{"className":19009},[],[19011],{"type":48,"value":19005},{"type":42,"tag":51,"props":19013,"children":19014},{},[19015],{"type":48,"value":19016},"Defines the ECS Cluster.",{"type":42,"tag":16014,"props":19018,"children":19020},{"id":19019},"rds",[19021],{"type":42,"tag":349,"props":19022,"children":19024},{"className":19023},[],[19025],{"type":48,"value":19019},{"type":42,"tag":51,"props":19027,"children":19028},{},[19029,19031,19037,19039,19044,19046,19052,19054,19060,19061,19067],{"type":48,"value":19030},"There is no L2 construct for ",{"type":42,"tag":349,"props":19032,"children":19034},{"className":19033},[],[19035],{"type":48,"value":19036},"DBCluster",{"type":48,"value":19038},", so I used ",{"type":42,"tag":349,"props":19040,"children":19042},{"className":19041},[],[19043],{"type":48,"value":17641},{"type":48,"value":19045}," in order to use the Aurora Postgres ",{"type":42,"tag":349,"props":19047,"children":19049},{"className":19048},[],[19050],{"type":48,"value":19051},"engine",{"type":48,"value":19053}," and the ",{"type":42,"tag":349,"props":19055,"children":19057},{"className":19056},[],[19058],{"type":48,"value":19059},"serverless",{"type":48,"value":12089},{"type":42,"tag":349,"props":19062,"children":19064},{"className":19063},[],[19065],{"type":48,"value":19066},"engine_mode",{"type":48,"value":1970},{"type":42,"tag":16014,"props":19069,"children":19071},{"id":19070},"elasticache",[19072],{"type":42,"tag":349,"props":19073,"children":19075},{"className":19074},[],[19076],{"type":48,"value":19070},{"type":42,"tag":51,"props":19078,"children":19079},{},[19080],{"type":48,"value":19081},"I also had to use L1 constructs for ElastiCache, but this one is pretty straightforward.",{"type":42,"tag":51,"props":19083,"children":19084},{},[19085,19087,19093,19095,19101],{"type":48,"value":19086},"For both RDS and ElastiCache I used the ",{"type":42,"tag":349,"props":19088,"children":19090},{"className":19089},[],[19091],{"type":48,"value":19092},"vpc_default_security_group",{"type":48,"value":19094}," as the ",{"type":42,"tag":349,"props":19096,"children":19098},{"className":19097},[],[19099],{"type":48,"value":19100},"source_security_group",{"type":48,"value":19102},". It might be a better idea to define another security group altogether, but this approach works.",{"type":42,"tag":16014,"props":19104,"children":19106},{"id":19105},"assetimage",[19107],{"type":42,"tag":349,"props":19108,"children":19110},{"className":19109},[],[19111],{"type":48,"value":19112},"AssetImage",{"type":42,"tag":51,"props":19114,"children":19115},{},[19116,19118,19123],{"type":48,"value":19117},"The docker image that references Django application code in the ",{"type":42,"tag":349,"props":19119,"children":19121},{"className":19120},[],[19122],{"type":48,"value":7997},{"type":48,"value":19124}," directory. This image is referenced in Fargate services and tasks.",{"type":42,"tag":16014,"props":19126,"children":19128},{"id":19127},"variables",[19129],{"type":42,"tag":349,"props":19130,"children":19132},{"className":19131},[],[19133],{"type":48,"value":19127},{"type":42,"tag":51,"props":19135,"children":19136},{},[19137],{"type":48,"value":19138},"This section defines and organizes all of the environment variables and secrets for my application.",{"type":42,"tag":16014,"props":19140,"children":19142},{"id":19141},"backend_service",[19143],{"type":42,"tag":349,"props":19144,"children":19146},{"className":19145},[],[19147],{"type":48,"value":19141},{"type":42,"tag":51,"props":19149,"children":19150},{},[19151,19153,19159],{"type":48,"value":19152},"It might be a better idea to replace this with ",{"type":42,"tag":349,"props":19154,"children":19156},{"className":19155},[],[19157],{"type":48,"value":19158},"NetworkLoadBalancedFargateService",{"type":48,"value":19160},", but instead I implemented this with lower-level constructs just to be clear about what I'm doing. To add a load balanced service, here is what I did:",{"type":42,"tag":3541,"props":19162,"children":19163},{},[19164,19169,19182,19195,19200,19205,19223],{"type":42,"tag":61,"props":19165,"children":19166},{},[19167],{"type":48,"value":19168},"Define the Fargate task",{"type":42,"tag":61,"props":19170,"children":19171},{},[19172,19174,19180],{"type":48,"value":19173},"Add the container to this task with other information (secrets, logging, ",{"type":42,"tag":349,"props":19175,"children":19177},{"className":19176},[],[19178],{"type":48,"value":19179},"command",{"type":48,"value":19181},", etc.)",{"type":42,"tag":61,"props":19183,"children":19184},{},[19185,19187,19193],{"type":48,"value":19186},"Give the task role permissions it needs such as access to Secrets, S3 permissions. (It might be a good idea to refactor this into a function that can be called on ",{"type":42,"tag":349,"props":19188,"children":19190},{"className":19189},[],[19191],{"type":48,"value":19192},"task_role",{"type":48,"value":19194},", but for now I am explicitly granting all permissions)",{"type":42,"tag":61,"props":19196,"children":19197},{},[19198],{"type":48,"value":19199},"Create and add a port mapping",{"type":42,"tag":61,"props":19201,"children":19202},{},[19203],{"type":48,"value":19204},"Define an ECS Fargate Service that reference the previously defined Fargate task, configure security group",{"type":42,"tag":61,"props":19206,"children":19207},{},[19208,19210,19215,19217,19222],{"type":48,"value":19209},"Add the service as a target to the ",{"type":42,"tag":349,"props":19211,"children":19213},{"className":19212},[],[19214],{"type":48,"value":18847},{"type":48,"value":19216}," defined previously in ",{"type":42,"tag":349,"props":19218,"children":19220},{"className":19219},[],[19221],{"type":48,"value":18823},{"type":48,"value":1970},{"type":42,"tag":61,"props":19224,"children":19225},{},[19226],{"type":48,"value":19227},"Optionally configure autoscaling for the Fargate service",{"type":42,"tag":16014,"props":19229,"children":19231},{"id":19230},"flower_service",[19232],{"type":42,"tag":349,"props":19233,"children":19235},{"className":19234},[],[19236],{"type":48,"value":19230},{"type":42,"tag":51,"props":19238,"children":19239},{},[19240,19242],{"type":48,"value":19241},"Flower is a monitoring utility for Celery. I had trouble getting this to work correctly, but I managed to make it work by adding a simple nginx container that passes traffic to the flower container running in the same task. ",{"type":42,"tag":138,"props":19243,"children":19246},{"href":19244,"rel":19245},"https://flower.readthedocs.io/en/latest/reverse-proxy.html",[142],[19247],{"type":48,"value":19244},{"type":42,"tag":16014,"props":19249,"children":19251},{"id":19250},"celery_default_service",[19252],{"type":42,"tag":349,"props":19253,"children":19255},{"className":19254},[],[19256],{"type":48,"value":19250},{"type":42,"tag":51,"props":19258,"children":19259},{},[19260],{"type":48,"value":19261},"This stack defines the default celery queue. This is discussed later in more detail, but the basic idea is to:",{"type":42,"tag":3541,"props":19263,"children":19264},{},[19265,19269,19274,19279,19284],{"type":42,"tag":61,"props":19266,"children":19267},{},[19268],{"type":48,"value":19168},{"type":42,"tag":61,"props":19270,"children":19271},{},[19272],{"type":48,"value":19273},"Add the container",{"type":42,"tag":61,"props":19275,"children":19276},{},[19277],{"type":48,"value":19278},"Define the Fargate service",{"type":42,"tag":61,"props":19280,"children":19281},{},[19282],{"type":48,"value":19283},"Grant permissions",{"type":42,"tag":61,"props":19285,"children":19286},{},[19287],{"type":48,"value":19288},"Configure autoscaling",{"type":42,"tag":16014,"props":19290,"children":19292},{"id":19291},"celery_autoscaling",[19293],{"type":42,"tag":349,"props":19294,"children":19296},{"className":19295},[],[19297],{"type":48,"value":19291},{"type":42,"tag":51,"props":19299,"children":19300},{},[19301],{"type":48,"value":19302},"This stack defines the Lambda function and schedule on which this Lambda is called. This stack is discussed in more detail later on.",{"type":42,"tag":16014,"props":19304,"children":19306},{"id":19305},"backend_tasks",[19307],{"type":42,"tag":349,"props":19308,"children":19310},{"className":19309},[],[19311],{"type":48,"value":19305},{"type":42,"tag":51,"props":19313,"children":19314},{},[19315,19317,19322,19323,19328,19329,19334],{"type":48,"value":19316},"These are administrative tasks that are executed by running manual GitLab CI jobs such as ",{"type":42,"tag":349,"props":19318,"children":19320},{"className":19319},[],[19321],{"type":48,"value":15412},{"type":48,"value":935},{"type":42,"tag":349,"props":19324,"children":19326},{"className":19325},[],[19327],{"type":48,"value":13461},{"type":48,"value":2751},{"type":42,"tag":349,"props":19330,"children":19332},{"className":19331},[],[19333],{"type":48,"value":15417},{"type":48,"value":1970},{"type":42,"tag":112,"props":19336,"children":19338},{"id":19337},"why-x-why-not-y",[19339,19341,19347,19349,19355],{"type":48,"value":19340},"Why ",{"type":42,"tag":349,"props":19342,"children":19344},{"className":19343},[],[19345],{"type":48,"value":19346},"X",{"type":48,"value":19348},"? Why not ",{"type":42,"tag":349,"props":19350,"children":19352},{"className":19351},[],[19353],{"type":48,"value":19354},"Y",{"type":48,"value":19356},"?",{"type":42,"tag":51,"props":19358,"children":19359},{},[19360],{"type":48,"value":19361},"This section will compare some of the technology choices I have made in this project to other popular alternatives.",{"type":42,"tag":280,"props":19363,"children":19365},{"id":19364},"why-ecs-why-not-kubernetes",[19366],{"type":48,"value":19367},"Why ECS? Why not Kubernetes?",{"type":42,"tag":51,"props":19369,"children":19370},{},[19371,19373,19379],{"type":48,"value":19372},"I like Kubernetes. I have never used it to support production workloads, but I have explored it in a limited capacity. I have set up this project in Kubernetes locally using ",{"type":42,"tag":349,"props":19374,"children":19376},{"className":19375},[],[19377],{"type":48,"value":19378},"minikube",{"type":48,"value":19380},", there is an article on this in the documentation. There are also lots of options for how you do Kubernetes, here are a few off of the top of my head:",{"type":42,"tag":57,"props":19382,"children":19383},{},[19384,19389,19394,19399,19404,19409],{"type":42,"tag":61,"props":19385,"children":19386},{},[19387],{"type":48,"value":19388},"KOPS",{"type":42,"tag":61,"props":19390,"children":19391},{},[19392],{"type":48,"value":19393},"EKS",{"type":42,"tag":61,"props":19395,"children":19396},{},[19397],{"type":48,"value":19398},"k3s",{"type":42,"tag":61,"props":19400,"children":19401},{},[19402],{"type":48,"value":19403},"cdk8s",{"type":42,"tag":61,"props":19405,"children":19406},{},[19407],{"type":48,"value":19408},"Kubernetes on Fargate",{"type":42,"tag":61,"props":19410,"children":19411},{},[19412],{"type":48,"value":19413},"\"Kuberetes the Hard Way\"",{"type":42,"tag":51,"props":19415,"children":19416},{},[19417],{"type":48,"value":19418},"With any of these options you are probably going to want to use Helm to do deployments, which adds another layer of abstraction that also has several different ways to be managed. On the other hand, ECS is \"just ECS\"; there are not a lot of other considerations to make when running workloads in ECS. You have to choose between the two available launch types: EC2 and Fargate. Comparisons of ECS and Kubernetes often mention that ECS integrates nicely with other AWS Services, something I have generally found to be true in setting up this project. Granting permissions to S3 buckets or CloudWatch, or using security groups to give ECS tasks access to certain resources in your VPC are some examples of what this \"tight integration\" has meant for me so far.",{"type":42,"tag":280,"props":19420,"children":19422},{"id":19421},"why-django-why-not-flask",[19423],{"type":48,"value":19424},"Why Django? Why not Flask?",{"type":42,"tag":51,"props":19426,"children":19427},{},[19428],{"type":48,"value":19429},"I like Django for lots of reasons. I get why people say it can be \"overkill\", and there are definitely lots of parts of Django that don't use. I use Django primarily for the ORM, migrations system and the Django Admin. I also use the Django REST Framework, which gives me another big productivity boost when building APIs. I dislike Django Forms and Django templates, but that wasn't always the case. Before that, I disliked JavaScript frameworks and single page applications. That changes when I started working with Vue.js and Quasar.",{"type":42,"tag":280,"props":19431,"children":19433},{"id":19432},"why-quasar-framework-why-not-nuxtjs-or-vanilla-vuejs-why-not-react",[19434],{"type":48,"value":19435},"Why Quasar Framework? Why not Nuxt.js or vanilla Vue.js? Why not React?",{"type":42,"tag":51,"props":19437,"children":19438},{},[19439],{"type":48,"value":19440},"Quasar Framework is a few different things, and just like Vue.js itself, Quasar can be incrementally adopted. Primarily, Quasar is a CLI for creating Vue.js projects. It offers some opinions on how to organize files and folders. It handles SPA, PWA, SSR, Electron, Cordova and other build targets. It implements the MaterialUI spec and it has an awesome and active community (but Django, GitLab and AWS do, too!)",{"type":42,"tag":51,"props":19442,"children":19443},{},[19444,19446,19452,19454,19459],{"type":48,"value":19445},"Quasar does things a little bit differently than vanilla Vue.js. There is no ",{"type":42,"tag":349,"props":19447,"children":19449},{"className":19448},[],[19450],{"type":48,"value":19451},"main.js",{"type":48,"value":19453}," file in a typical Quasar application. Instead, bootfiles are used to initialize things that would typically go into ",{"type":42,"tag":349,"props":19455,"children":19457},{"className":19456},[],[19458],{"type":48,"value":19451},{"type":48,"value":19460},". I believe this helps Quasar manage multiple build targets easily.",{"type":42,"tag":51,"props":19462,"children":19463},{},[19464],{"type":48,"value":19465},"I really haven't worked a lot with Nuxt.js, but I would probably be drawn to it if Quasar was not an option. I like how it helps structure your application. In the same way that Django is \"batteries included\", Quasar is also very much \"batteries included\".",{"type":42,"tag":51,"props":19467,"children":19468},{},[19469,19471,19476,19477,19483],{"type":48,"value":19470},"I think React is neat, but I have similar feelings between React and Vue that I have between Django and Flask. One requires you make more decisions and therefore has a heavy mental load. The biggest example of this is the tight integration of an official router and state management system for Vue (",{"type":42,"tag":349,"props":19472,"children":19474},{"className":19473},[],[19475],{"type":48,"value":16199},{"type":48,"value":2751},{"type":42,"tag":349,"props":19478,"children":19480},{"className":19479},[],[19481],{"type":48,"value":19482},"vuex",{"type":48,"value":5573},{"type":42,"tag":280,"props":19485,"children":19487},{"id":19486},"why-celery-why-not-heuy-or-django-rq",[19488],{"type":48,"value":19489},"Why Celery? Why not Heuy or django-rq?",{"type":42,"tag":51,"props":19491,"children":19492},{},[19493],{"type":48,"value":19494},"I think celery is probably the most heavy-weight option for managing asynchronous tasks in Django. It is very flexible and \"pluggable\" which makes it slightly more challenging to get setup. I would be interested in trying another option, but celery is a mature option that has a large community of users.",{"type":42,"tag":112,"props":19496,"children":19498},{"id":19497},"scaling-celery-workers-to-zero",[19499],{"type":48,"value":19500},"Scaling Celery workers to zero",{"type":42,"tag":51,"props":19502,"children":19503},{},[19504],{"type":48,"value":19505},"Django is used in a few different ways in this application:",{"type":42,"tag":57,"props":19507,"children":19508},{},[19509,19514,19519,19524],{"type":42,"tag":61,"props":19510,"children":19511},{},[19512],{"type":48,"value":19513},"a backend API supported by Django REST Framework, Postgres and static files stored in AWS S3, served over CloudFront",{"type":42,"tag":61,"props":19515,"children":19516},{},[19517],{"type":48,"value":19518},"a websocket server supported by Django Channels",{"type":42,"tag":61,"props":19520,"children":19521},{},[19522],{"type":48,"value":19523},"an administrative backend that is automatically generated by Django (Django Admin)",{"type":42,"tag":61,"props":19525,"children":19526},{},[19527],{"type":48,"value":19528},"asynchronous task workers supported by Celery",{"type":42,"tag":51,"props":19530,"children":19531},{},[19532,19534,19539,19541,19546,19547,19553,19554,19559],{"type":48,"value":19533},"The API server, websocket server and Django admin can technically be served by the same ",{"type":42,"tag":349,"props":19535,"children":19537},{"className":19536},[],[19538],{"type":48,"value":18664},{"type":48,"value":19540}," process. In terms of our application and AWS architecture, this means that requests for URLs starting with ",{"type":42,"tag":349,"props":19542,"children":19544},{"className":19543},[],[19545],{"type":48,"value":8017},{"type":48,"value":935},{"type":42,"tag":349,"props":19548,"children":19550},{"className":19549},[],[19551],{"type":48,"value":19552},"/ws/",{"type":48,"value":2751},{"type":42,"tag":349,"props":19555,"children":19557},{"className":19556},[],[19558],{"type":48,"value":7628},{"type":48,"value":19560}," can all be sent to the same Fargate service target group.",{"type":42,"tag":51,"props":19562,"children":19563},{},[19564],{"type":48,"value":19565},"Alternatively, we could split these up into two or three different process that can then be scaled individually.",{"type":42,"tag":51,"props":19567,"children":19568},{},[19569,19571,19577],{"type":48,"value":19570},"Celery processes should be run as separate processes. If you have multiple queues, you may have workers that are dedicated to processing tasks from certain queues which run as individual Fargate tasks, each with certain CPU and memory allocations and other celery settings, such as ",{"type":42,"tag":349,"props":19572,"children":19574},{"className":19573},[],[19575],{"type":48,"value":19576},"max_concurrency",{"type":48,"value":1970},{"type":42,"tag":51,"props":19579,"children":19580},{},[19581,19583,19589],{"type":48,"value":19582},"To manage the total cost of ownership, I wanted to know how to scale Celery workers between 0 and ",{"type":42,"tag":349,"props":19584,"children":19586},{"className":19585},[],[19587],{"type":48,"value":19588},"N",{"type":48,"value":19590},". A celery worker is typically an \"always on\" process that watches for new messages that arrive in the queue and then processes message specified (the messages delivered to the queue contain information on which function to call, and what arguments that function should be called with.",{"type":42,"tag":51,"props":19592,"children":19593},{},[19594],{"type":48,"value":19595},"Let's image that we have a celery task to process with the following properties:",{"type":42,"tag":57,"props":19597,"children":19598},{},[19599,19604,19609,19614,19619,19624,19629],{"type":42,"tag":61,"props":19600,"children":19601},{},[19602],{"type":48,"value":19603},"It takes a long time to process (between 15 minutes and 1 or 2 hours)",{"type":42,"tag":61,"props":19605,"children":19606},{},[19607],{"type":48,"value":19608},"It has lots of dependencies (such as pandas, scikit-learn, etc.)",{"type":42,"tag":61,"props":19610,"children":19611},{},[19612],{"type":48,"value":19613},"It requires a high amount of CPU and memory",{"type":42,"tag":61,"props":19615,"children":19616},{},[19617],{"type":48,"value":19618},"It cannot easily be broken down into smaller sub-tasks",{"type":42,"tag":61,"props":19620,"children":19621},{},[19622],{"type":48,"value":19623},"The time and frequency at which this task will be called is not predictable",{"type":42,"tag":61,"props":19625,"children":19626},{},[19627],{"type":48,"value":19628},"A 2 - 3 minute delay between calling the task and starting work on the task is acceptable",{"type":42,"tag":61,"props":19630,"children":19631},{},[19632],{"type":48,"value":19633},"This task might not be very easy to process with AWS Lambda without lots of additional logic, if not impossible.",{"type":42,"tag":51,"props":19635,"children":19636},{},[19637],{"type":48,"value":19638},"To manage our project's TCO, we want scale down the number of Fargate tasks that process the queue this task is sent to. If there are no messages queued for this worker and no messages currently being processed by any of the workers for the queue, the number of Fargate tasks (celery workers) should be scaled down.",{"type":42,"tag":51,"props":19640,"children":19641},{},[19642],{"type":48,"value":19643},"I haven't done much with autoscaling on AWS before, but I found that CDK provides some very nice abstractions that make scaling with Fargate task very straightforward.",{"type":42,"tag":51,"props":19645,"children":19646},{},[19647,19649,19654],{"type":48,"value":19648},"ECS allows you to scale based on some built in metrics, such as CPU Utilization. Scaling between 0 and ",{"type":42,"tag":349,"props":19650,"children":19652},{"className":19651},[],[19653],{"type":48,"value":19588},{"type":48,"value":19655}," workers based on CPU utilization metrics wouldn't work because there would be no CPU utilization after the Fargate tasks are scaled to zero; messages in the queue would remain unprocessed and no new workers would be brought online.",{"type":42,"tag":51,"props":19657,"children":19658},{},[19659],{"type":48,"value":19660},"Using the number of tasks in the queue would be a better option. I tried a few different options to get this to work.",{"type":42,"tag":51,"props":19662,"children":19663},{},[19664,19666,19672,19674,19680],{"type":48,"value":19665},"First, I tried using one of the high-level constructs (L3 construct) from ",{"type":42,"tag":349,"props":19667,"children":19669},{"className":19668},[],[19670],{"type":48,"value":19671},"ecs_patterns",{"type":48,"value":19673}," called ",{"type":42,"tag":349,"props":19675,"children":19677},{"className":19676},[],[19678],{"type":48,"value":19679},"QueueProcessingFargateService",{"type":48,"value":19681},", but this would require that I replace Redis with SQS as the broker to be used with Celery. Some people prefer to use SQS, but I like having the ability to inspect and control, which requires a broker like Redis and is not possible with SQS.",{"type":42,"tag":51,"props":19683,"children":19684},{},[19685],{"type":48,"value":19686},"My current solution involves:",{"type":42,"tag":3541,"props":19688,"children":19689},{},[19690,19710,19723,19740,19760],{"type":42,"tag":61,"props":19691,"children":19692},{},[19693,19695,19701,19703,19709],{"type":48,"value":19694},"Creating a CloudWatch metric (the namespace is ",{"type":42,"tag":349,"props":19696,"children":19698},{"className":19697},[],[19699],{"type":48,"value":19700},"FULL_APP_NAME",{"type":48,"value":19702}," and the metric name is the name of the queue, ",{"type":42,"tag":349,"props":19704,"children":19706},{"className":19705},[],[19707],{"type":48,"value":19708},"default",{"type":48,"value":5652},{"type":42,"tag":61,"props":19711,"children":19712},{},[19713,19715,19721],{"type":48,"value":19714},"Calling ",{"type":42,"tag":349,"props":19716,"children":19718},{"className":19717},[],[19719],{"type":48,"value":19720},"auto_scale_task_count",{"type":48,"value":19722}," on the Fargate service to create a an \"autoscaling Fargate task\"",{"type":42,"tag":61,"props":19724,"children":19725},{},[19726,19727,19733,19735],{"type":48,"value":19714},{"type":42,"tag":349,"props":19728,"children":19730},{"className":19729},[],[19731],{"type":48,"value":19732},"scale_on_metric",{"type":48,"value":19734}," on the \"autoscaling Fargate task\" with the CloudWatch metric created in ",{"type":42,"tag":349,"props":19736,"children":19738},{"className":19737},[],[19739],{"type":48,"value":1756},{"type":42,"tag":61,"props":19741,"children":19742},{},[19743,19744,19750,19752,19758],{"type":48,"value":11178},{"type":42,"tag":349,"props":19745,"children":19747},{"className":19746},[],[19748],{"type":48,"value":19749},"celery-metrics",{"type":48,"value":19751}," API endpoint on my Django API server that, when ",{"type":42,"tag":349,"props":19753,"children":19755},{"className":19754},[],[19756],{"type":48,"value":19757},"POST",{"type":48,"value":19759},"ed to, collects celery metrics per queue and publishes these metrics to CloudWatch.",{"type":42,"tag":61,"props":19761,"children":19762},{},[19763,19765,19770],{"type":48,"value":19764},"Scheduling a Lambda function to post to the ",{"type":42,"tag":349,"props":19766,"children":19768},{"className":19767},[],[19769],{"type":48,"value":19749},{"type":48,"value":19771}," endpoint every 5 minutes.",{"type":42,"tag":51,"props":19773,"children":19774},{},[19775],{"type":48,"value":19776},"Here's the code that takes care of steps 1, 2 and 3:",{"type":42,"tag":401,"props":19778,"children":19780},{"code":19779,"language":19,"meta":8,"className":461,"style":8},"        self.default_celery_queue_cw_metric = cw.Metric(\n            namespace=scope.full_app_name, metric_name=\"default\"\n        )\n\n        self.celery_default_queue_asg = self.celery_default_worker_service.auto_scale_task_count(\n            min_capacity=0, max_capacity=2\n        )\n\n        self.celery_default_queue_asg.scale_on_metric(\n            \"CeleryDefaultQueueAutoscaling\",\n            metric=self.default_celery_queue_cw_metric,\n            scaling_steps=[\n                aas.ScalingInterval(change=-1, lower=0),\n                aas.ScalingInterval(change=1, lower=1),\n            ],\n            adjustment_type=aas.AdjustmentType.CHANGE_IN_CAPACITY,\n        )\n",[19781],{"type":42,"tag":349,"props":19782,"children":19783},{"__ignoreMap":8},[19784,19805,19836,19843,19850,19876,19910,19917,19924,19936,19948,19969,19986,20029,20068,20076,20102],{"type":42,"tag":467,"props":19785,"children":19786},{"class":469,"line":470},[19787,19791,19796,19800],{"type":42,"tag":467,"props":19788,"children":19789},{"style":2067},[19790],{"type":48,"value":18569},{"type":42,"tag":467,"props":19792,"children":19793},{"style":480},[19794],{"type":48,"value":19795},".default_celery_queue_cw_metric ",{"type":42,"tag":467,"props":19797,"children":19798},{"style":474},[19799],{"type":48,"value":542},{"type":42,"tag":467,"props":19801,"children":19802},{"style":480},[19803],{"type":48,"value":19804}," cw.Metric(\n",{"type":42,"tag":467,"props":19806,"children":19807},{"class":469,"line":486},[19808,19813,19817,19822,19827,19831],{"type":42,"tag":467,"props":19809,"children":19810},{"style":554},[19811],{"type":48,"value":19812},"            namespace",{"type":42,"tag":467,"props":19814,"children":19815},{"style":474},[19816],{"type":48,"value":542},{"type":42,"tag":467,"props":19818,"children":19819},{"style":480},[19820],{"type":48,"value":19821},"scope.full_app_name, ",{"type":42,"tag":467,"props":19823,"children":19824},{"style":554},[19825],{"type":48,"value":19826},"metric_name",{"type":42,"tag":467,"props":19828,"children":19829},{"style":474},[19830],{"type":48,"value":542},{"type":42,"tag":467,"props":19832,"children":19833},{"style":564},[19834],{"type":48,"value":19835},"\"default\"\n",{"type":42,"tag":467,"props":19837,"children":19838},{"class":469,"line":499},[19839],{"type":42,"tag":467,"props":19840,"children":19841},{"style":480},[19842],{"type":48,"value":18639},{"type":42,"tag":467,"props":19844,"children":19845},{"class":469,"line":522},[19846],{"type":42,"tag":467,"props":19847,"children":19848},{"emptyLinePlaceholder":37},[19849],{"type":48,"value":528},{"type":42,"tag":467,"props":19851,"children":19852},{"class":469,"line":531},[19853,19857,19862,19866,19871],{"type":42,"tag":467,"props":19854,"children":19855},{"style":2067},[19856],{"type":48,"value":18569},{"type":42,"tag":467,"props":19858,"children":19859},{"style":480},[19860],{"type":48,"value":19861},".celery_default_queue_asg ",{"type":42,"tag":467,"props":19863,"children":19864},{"style":474},[19865],{"type":48,"value":542},{"type":42,"tag":467,"props":19867,"children":19868},{"style":2067},[19869],{"type":48,"value":19870}," self",{"type":42,"tag":467,"props":19872,"children":19873},{"style":480},[19874],{"type":48,"value":19875},".celery_default_worker_service.auto_scale_task_count(\n",{"type":42,"tag":467,"props":19877,"children":19878},{"class":469,"line":550},[19879,19884,19888,19892,19896,19901,19905],{"type":42,"tag":467,"props":19880,"children":19881},{"style":554},[19882],{"type":48,"value":19883},"            min_capacity",{"type":42,"tag":467,"props":19885,"children":19886},{"style":474},[19887],{"type":48,"value":542},{"type":42,"tag":467,"props":19889,"children":19890},{"style":588},[19891],{"type":48,"value":199},{"type":42,"tag":467,"props":19893,"children":19894},{"style":480},[19895],{"type":48,"value":935},{"type":42,"tag":467,"props":19897,"children":19898},{"style":554},[19899],{"type":48,"value":19900},"max_capacity",{"type":42,"tag":467,"props":19902,"children":19903},{"style":474},[19904],{"type":48,"value":542},{"type":42,"tag":467,"props":19906,"children":19907},{"style":588},[19908],{"type":48,"value":19909},"2\n",{"type":42,"tag":467,"props":19911,"children":19912},{"class":469,"line":575},[19913],{"type":42,"tag":467,"props":19914,"children":19915},{"style":480},[19916],{"type":48,"value":18639},{"type":42,"tag":467,"props":19918,"children":19919},{"class":469,"line":598},[19920],{"type":42,"tag":467,"props":19921,"children":19922},{"emptyLinePlaceholder":37},[19923],{"type":48,"value":528},{"type":42,"tag":467,"props":19925,"children":19926},{"class":469,"line":616},[19927,19931],{"type":42,"tag":467,"props":19928,"children":19929},{"style":2067},[19930],{"type":48,"value":18569},{"type":42,"tag":467,"props":19932,"children":19933},{"style":480},[19934],{"type":48,"value":19935},".celery_default_queue_asg.scale_on_metric(\n",{"type":42,"tag":467,"props":19937,"children":19938},{"class":469,"line":625},[19939,19944],{"type":42,"tag":467,"props":19940,"children":19941},{"style":564},[19942],{"type":48,"value":19943},"            \"CeleryDefaultQueueAutoscaling\"",{"type":42,"tag":467,"props":19945,"children":19946},{"style":480},[19947],{"type":48,"value":572},{"type":42,"tag":467,"props":19949,"children":19950},{"class":469,"line":633},[19951,19956,19960,19964],{"type":42,"tag":467,"props":19952,"children":19953},{"style":554},[19954],{"type":48,"value":19955},"            metric",{"type":42,"tag":467,"props":19957,"children":19958},{"style":474},[19959],{"type":48,"value":542},{"type":42,"tag":467,"props":19961,"children":19962},{"style":2067},[19963],{"type":48,"value":2004},{"type":42,"tag":467,"props":19965,"children":19966},{"style":480},[19967],{"type":48,"value":19968},".default_celery_queue_cw_metric,\n",{"type":42,"tag":467,"props":19970,"children":19971},{"class":469,"line":664},[19972,19977,19981],{"type":42,"tag":467,"props":19973,"children":19974},{"style":554},[19975],{"type":48,"value":19976},"            scaling_steps",{"type":42,"tag":467,"props":19978,"children":19979},{"style":474},[19980],{"type":48,"value":542},{"type":42,"tag":467,"props":19982,"children":19983},{"style":480},[19984],{"type":48,"value":19985},"[\n",{"type":42,"tag":467,"props":19987,"children":19988},{"class":469,"line":672},[19989,19994,19999,20004,20008,20012,20017,20021,20025],{"type":42,"tag":467,"props":19990,"children":19991},{"style":480},[19992],{"type":48,"value":19993},"                aas.ScalingInterval(",{"type":42,"tag":467,"props":19995,"children":19996},{"style":554},[19997],{"type":48,"value":19998},"change",{"type":42,"tag":467,"props":20000,"children":20001},{"style":474},[20002],{"type":48,"value":20003},"=-",{"type":42,"tag":467,"props":20005,"children":20006},{"style":588},[20007],{"type":48,"value":1756},{"type":42,"tag":467,"props":20009,"children":20010},{"style":480},[20011],{"type":48,"value":935},{"type":42,"tag":467,"props":20013,"children":20014},{"style":554},[20015],{"type":48,"value":20016},"lower",{"type":42,"tag":467,"props":20018,"children":20019},{"style":474},[20020],{"type":48,"value":542},{"type":42,"tag":467,"props":20022,"children":20023},{"style":588},[20024],{"type":48,"value":199},{"type":42,"tag":467,"props":20026,"children":20027},{"style":480},[20028],{"type":48,"value":13703},{"type":42,"tag":467,"props":20030,"children":20031},{"class":469,"line":690},[20032,20036,20040,20044,20048,20052,20056,20060,20064],{"type":42,"tag":467,"props":20033,"children":20034},{"style":480},[20035],{"type":48,"value":19993},{"type":42,"tag":467,"props":20037,"children":20038},{"style":554},[20039],{"type":48,"value":19998},{"type":42,"tag":467,"props":20041,"children":20042},{"style":474},[20043],{"type":48,"value":542},{"type":42,"tag":467,"props":20045,"children":20046},{"style":588},[20047],{"type":48,"value":1756},{"type":42,"tag":467,"props":20049,"children":20050},{"style":480},[20051],{"type":48,"value":935},{"type":42,"tag":467,"props":20053,"children":20054},{"style":554},[20055],{"type":48,"value":20016},{"type":42,"tag":467,"props":20057,"children":20058},{"style":474},[20059],{"type":48,"value":542},{"type":42,"tag":467,"props":20061,"children":20062},{"style":588},[20063],{"type":48,"value":1756},{"type":42,"tag":467,"props":20065,"children":20066},{"style":480},[20067],{"type":48,"value":13703},{"type":42,"tag":467,"props":20069,"children":20070},{"class":469,"line":1336},[20071],{"type":42,"tag":467,"props":20072,"children":20073},{"style":480},[20074],{"type":48,"value":20075},"            ],\n",{"type":42,"tag":467,"props":20077,"children":20078},{"class":469,"line":1344},[20079,20084,20088,20093,20098],{"type":42,"tag":467,"props":20080,"children":20081},{"style":554},[20082],{"type":48,"value":20083},"            adjustment_type",{"type":42,"tag":467,"props":20085,"children":20086},{"style":474},[20087],{"type":48,"value":542},{"type":42,"tag":467,"props":20089,"children":20090},{"style":480},[20091],{"type":48,"value":20092},"aas.AdjustmentType.",{"type":42,"tag":467,"props":20094,"children":20095},{"style":588},[20096],{"type":48,"value":20097},"CHANGE_IN_CAPACITY",{"type":42,"tag":467,"props":20099,"children":20100},{"style":480},[20101],{"type":48,"value":572},{"type":42,"tag":467,"props":20103,"children":20104},{"class":469,"line":1362},[20105],{"type":42,"tag":467,"props":20106,"children":20107},{"style":480},[20108],{"type":48,"value":18639},{"type":42,"tag":51,"props":20110,"children":20111},{},[20112,20114,20120,20122,20128,20130,20136],{"type":48,"value":20113},"Step 4 inspects active and reserved tasks, filters the tasks by the ",{"type":42,"tag":349,"props":20115,"children":20117},{"className":20116},[],[20118],{"type":48,"value":20119},"routing_key",{"type":48,"value":20121}," (which is the same as the queue name) and the combines this with any queued tasks by calling ",{"type":42,"tag":349,"props":20123,"children":20125},{"className":20124},[],[20126],{"type":48,"value":20127},"llen(queue_name)",{"type":48,"value":20129},". Finally, the queue names and combined active, reserved and queued task totals are sent to CloudWatch via boto3. The code for this is in ",{"type":42,"tag":349,"props":20131,"children":20133},{"className":20132},[],[20134],{"type":48,"value":20135},"backend/apps/core/utils/celery_utils.py",{"type":48,"value":1970},{"type":42,"tag":51,"props":20138,"children":20139},{},[20140],{"type":48,"value":20141},"Here's the code for the Lambda function in step 5:",{"type":42,"tag":401,"props":20143,"children":20145},{"code":20144,"language":19,"meta":8,"className":461,"style":8},"import json\nimport os\nimport urllib.request\n\nFULL_DOMAIN_NAME = os.environ.get(\"FULL_DOMAIN_NAME\")\nCELERY_METRICS_PATH = \"api/celery-metrics/\"\n\nCELERY_METRICS_URL = f\"https://{FULL_DOMAIN_NAME}/{CELERY_METRICS_PATH}\"\nCELERY_METRICS_TOKEN = os.environ.get(\"CELERY_METRICS_TOKEN\")\n\n\ndef lambda_handler(event, context):\n    data = {\"celery_metrics_token\": CELERY_METRICS_TOKEN}\n    params = json.dumps(data).encode('utf8')\n    req = urllib.request.Request(\n        CELERY_METRICS_URL,\n        data=params,\n        headers={'content-type': 'application/json'},\n    )\n    response = urllib.request.urlopen(req)\n    return response.read()\n",[20146],{"type":42,"tag":349,"props":20147,"children":20148},{"__ignoreMap":8},[20149,20160,20171,20183,20190,20215,20232,20239,20278,20303,20310,20317,20351,20385,20411,20428,20440,20457,20492,20500,20517],{"type":42,"tag":467,"props":20150,"children":20151},{"class":469,"line":470},[20152,20156],{"type":42,"tag":467,"props":20153,"children":20154},{"style":474},[20155],{"type":48,"value":477},{"type":42,"tag":467,"props":20157,"children":20158},{"style":480},[20159],{"type":48,"value":483},{"type":42,"tag":467,"props":20161,"children":20162},{"class":469,"line":486},[20163,20167],{"type":42,"tag":467,"props":20164,"children":20165},{"style":474},[20166],{"type":48,"value":477},{"type":42,"tag":467,"props":20168,"children":20169},{"style":480},[20170],{"type":48,"value":496},{"type":42,"tag":467,"props":20172,"children":20173},{"class":469,"line":499},[20174,20178],{"type":42,"tag":467,"props":20175,"children":20176},{"style":474},[20177],{"type":48,"value":477},{"type":42,"tag":467,"props":20179,"children":20180},{"style":480},[20181],{"type":48,"value":20182}," urllib.request\n",{"type":42,"tag":467,"props":20184,"children":20185},{"class":469,"line":522},[20186],{"type":42,"tag":467,"props":20187,"children":20188},{"emptyLinePlaceholder":37},[20189],{"type":48,"value":528},{"type":42,"tag":467,"props":20191,"children":20192},{"class":469,"line":531},[20193,20198,20202,20206,20211],{"type":42,"tag":467,"props":20194,"children":20195},{"style":588},[20196],{"type":48,"value":20197},"FULL_DOMAIN_NAME",{"type":42,"tag":467,"props":20199,"children":20200},{"style":474},[20201],{"type":48,"value":1192},{"type":42,"tag":467,"props":20203,"children":20204},{"style":480},[20205],{"type":48,"value":17051},{"type":42,"tag":467,"props":20207,"children":20208},{"style":564},[20209],{"type":48,"value":20210},"\"FULL_DOMAIN_NAME\"",{"type":42,"tag":467,"props":20212,"children":20213},{"style":480},[20214],{"type":48,"value":622},{"type":42,"tag":467,"props":20216,"children":20217},{"class":469,"line":550},[20218,20223,20227],{"type":42,"tag":467,"props":20219,"children":20220},{"style":588},[20221],{"type":48,"value":20222},"CELERY_METRICS_PATH",{"type":42,"tag":467,"props":20224,"children":20225},{"style":474},[20226],{"type":48,"value":1192},{"type":42,"tag":467,"props":20228,"children":20229},{"style":564},[20230],{"type":48,"value":20231}," \"api/celery-metrics/\"\n",{"type":42,"tag":467,"props":20233,"children":20234},{"class":469,"line":575},[20235],{"type":42,"tag":467,"props":20236,"children":20237},{"emptyLinePlaceholder":37},[20238],{"type":48,"value":528},{"type":42,"tag":467,"props":20240,"children":20241},{"class":469,"line":598},[20242,20247,20251,20255,20260,20265,20269,20274],{"type":42,"tag":467,"props":20243,"children":20244},{"style":588},[20245],{"type":48,"value":20246},"CELERY_METRICS_URL",{"type":42,"tag":467,"props":20248,"children":20249},{"style":474},[20250],{"type":48,"value":1192},{"type":42,"tag":467,"props":20252,"children":20253},{"style":903},[20254],{"type":48,"value":16993},{"type":42,"tag":467,"props":20256,"children":20257},{"style":564},[20258],{"type":48,"value":20259},"\"https://",{"type":42,"tag":467,"props":20261,"children":20262},{"style":588},[20263],{"type":48,"value":20264},"{FULL_DOMAIN_NAME}",{"type":42,"tag":467,"props":20266,"children":20267},{"style":564},[20268],{"type":48,"value":3633},{"type":42,"tag":467,"props":20270,"children":20271},{"style":588},[20272],{"type":48,"value":20273},"{CELERY_METRICS_PATH}",{"type":42,"tag":467,"props":20275,"children":20276},{"style":564},[20277],{"type":48,"value":17034},{"type":42,"tag":467,"props":20279,"children":20280},{"class":469,"line":616},[20281,20286,20290,20294,20299],{"type":42,"tag":467,"props":20282,"children":20283},{"style":588},[20284],{"type":48,"value":20285},"CELERY_METRICS_TOKEN",{"type":42,"tag":467,"props":20287,"children":20288},{"style":474},[20289],{"type":48,"value":1192},{"type":42,"tag":467,"props":20291,"children":20292},{"style":480},[20293],{"type":48,"value":17051},{"type":42,"tag":467,"props":20295,"children":20296},{"style":564},[20297],{"type":48,"value":20298},"\"CELERY_METRICS_TOKEN\"",{"type":42,"tag":467,"props":20300,"children":20301},{"style":480},[20302],{"type":48,"value":622},{"type":42,"tag":467,"props":20304,"children":20305},{"class":469,"line":625},[20306],{"type":42,"tag":467,"props":20307,"children":20308},{"emptyLinePlaceholder":37},[20309],{"type":48,"value":528},{"type":42,"tag":467,"props":20311,"children":20312},{"class":469,"line":633},[20313],{"type":42,"tag":467,"props":20314,"children":20315},{"emptyLinePlaceholder":37},[20316],{"type":48,"value":528},{"type":42,"tag":467,"props":20318,"children":20319},{"class":469,"line":664},[20320,20325,20330,20334,20339,20343,20347],{"type":42,"tag":467,"props":20321,"children":20322},{"style":903},[20323],{"type":48,"value":20324},"def",{"type":42,"tag":467,"props":20326,"children":20327},{"style":1991},[20328],{"type":48,"value":20329}," lambda_handler",{"type":42,"tag":467,"props":20331,"children":20332},{"style":480},[20333],{"type":48,"value":806},{"type":42,"tag":467,"props":20335,"children":20336},{"style":2001},[20337],{"type":48,"value":20338},"event",{"type":42,"tag":467,"props":20340,"children":20341},{"style":480},[20342],{"type":48,"value":935},{"type":42,"tag":467,"props":20344,"children":20345},{"style":2001},[20346],{"type":48,"value":5544},{"type":42,"tag":467,"props":20348,"children":20349},{"style":480},[20350],{"type":48,"value":1508},{"type":42,"tag":467,"props":20352,"children":20353},{"class":469,"line":672},[20354,20359,20363,20368,20373,20377,20381],{"type":42,"tag":467,"props":20355,"children":20356},{"style":480},[20357],{"type":48,"value":20358},"    data ",{"type":42,"tag":467,"props":20360,"children":20361},{"style":474},[20362],{"type":48,"value":542},{"type":42,"tag":467,"props":20364,"children":20365},{"style":480},[20366],{"type":48,"value":20367}," {",{"type":42,"tag":467,"props":20369,"children":20370},{"style":564},[20371],{"type":48,"value":20372},"\"celery_metrics_token\"",{"type":42,"tag":467,"props":20374,"children":20375},{"style":480},[20376],{"type":48,"value":3668},{"type":42,"tag":467,"props":20378,"children":20379},{"style":588},[20380],{"type":48,"value":20285},{"type":42,"tag":467,"props":20382,"children":20383},{"style":480},[20384],{"type":48,"value":13836},{"type":42,"tag":467,"props":20386,"children":20387},{"class":469,"line":690},[20388,20393,20397,20402,20407],{"type":42,"tag":467,"props":20389,"children":20390},{"style":480},[20391],{"type":48,"value":20392},"    params ",{"type":42,"tag":467,"props":20394,"children":20395},{"style":474},[20396],{"type":48,"value":542},{"type":42,"tag":467,"props":20398,"children":20399},{"style":480},[20400],{"type":48,"value":20401}," json.dumps(data).encode(",{"type":42,"tag":467,"props":20403,"children":20404},{"style":564},[20405],{"type":48,"value":20406},"'utf8'",{"type":42,"tag":467,"props":20408,"children":20409},{"style":480},[20410],{"type":48,"value":622},{"type":42,"tag":467,"props":20412,"children":20413},{"class":469,"line":1336},[20414,20419,20423],{"type":42,"tag":467,"props":20415,"children":20416},{"style":480},[20417],{"type":48,"value":20418},"    req ",{"type":42,"tag":467,"props":20420,"children":20421},{"style":474},[20422],{"type":48,"value":542},{"type":42,"tag":467,"props":20424,"children":20425},{"style":480},[20426],{"type":48,"value":20427}," urllib.request.Request(\n",{"type":42,"tag":467,"props":20429,"children":20430},{"class":469,"line":1344},[20431,20436],{"type":42,"tag":467,"props":20432,"children":20433},{"style":588},[20434],{"type":48,"value":20435},"        CELERY_METRICS_URL",{"type":42,"tag":467,"props":20437,"children":20438},{"style":480},[20439],{"type":48,"value":572},{"type":42,"tag":467,"props":20441,"children":20442},{"class":469,"line":1362},[20443,20448,20452],{"type":42,"tag":467,"props":20444,"children":20445},{"style":554},[20446],{"type":48,"value":20447},"        data",{"type":42,"tag":467,"props":20449,"children":20450},{"style":474},[20451],{"type":48,"value":542},{"type":42,"tag":467,"props":20453,"children":20454},{"style":480},[20455],{"type":48,"value":20456},"params,\n",{"type":42,"tag":467,"props":20458,"children":20459},{"class":469,"line":1380},[20460,20465,20469,20473,20478,20482,20487],{"type":42,"tag":467,"props":20461,"children":20462},{"style":554},[20463],{"type":48,"value":20464},"        headers",{"type":42,"tag":467,"props":20466,"children":20467},{"style":474},[20468],{"type":48,"value":542},{"type":42,"tag":467,"props":20470,"children":20471},{"style":480},[20472],{"type":48,"value":916},{"type":42,"tag":467,"props":20474,"children":20475},{"style":564},[20476],{"type":48,"value":20477},"'content-type'",{"type":42,"tag":467,"props":20479,"children":20480},{"style":480},[20481],{"type":48,"value":3668},{"type":42,"tag":467,"props":20483,"children":20484},{"style":564},[20485],{"type":48,"value":20486},"'application/json'",{"type":42,"tag":467,"props":20488,"children":20489},{"style":480},[20490],{"type":48,"value":20491},"},\n",{"type":42,"tag":467,"props":20493,"children":20494},{"class":469,"line":1388},[20495],{"type":42,"tag":467,"props":20496,"children":20497},{"style":480},[20498],{"type":48,"value":20499},"    )\n",{"type":42,"tag":467,"props":20501,"children":20502},{"class":469,"line":1423},[20503,20508,20512],{"type":42,"tag":467,"props":20504,"children":20505},{"style":480},[20506],{"type":48,"value":20507},"    response ",{"type":42,"tag":467,"props":20509,"children":20510},{"style":474},[20511],{"type":48,"value":542},{"type":42,"tag":467,"props":20513,"children":20514},{"style":480},[20515],{"type":48,"value":20516}," urllib.request.urlopen(req)\n",{"type":42,"tag":467,"props":20518,"children":20519},{"class":469,"line":1441},[20520,20525],{"type":42,"tag":467,"props":20521,"children":20522},{"style":474},[20523],{"type":48,"value":20524},"    return",{"type":42,"tag":467,"props":20526,"children":20527},{"style":480},[20528],{"type":48,"value":20529}," response.read()\n",{"type":42,"tag":51,"props":20531,"children":20532},{},[20533],{"type":48,"value":20534},"Finally, here is the code for defining the lambda function and scheduled invocation of the lambda function:",{"type":42,"tag":401,"props":20536,"children":20538},{"code":20537,"language":19,"meta":8,"className":461,"style":8},"class CeleryAutoscalingStack(cloudformation.NestedStack):\n    def __init__(self, scope: core.Construct, id: str, **kwargs) -> None:\n        super().__init__(\n            scope, id, **kwargs,\n        )\n\n        self.lambda_function = aws_lambda.Function(\n            self,\n            \"CeleryMetricsLambdaFunction\",\n            code=aws_lambda.Code.asset(\"awslambda\"),\n            handler=\"publish_celery_metrics.lambda_handler\",\n            runtime=aws_lambda.Runtime.PYTHON_3_7,\n            environment=scope.variables.regular_variables,\n        )\n\n        self.celery_default_cw_metric_schedule = events.Rule(\n            self,\n            \"CeleryDefaultCWMetricSchedule\",\n            schedule=events.Schedule.rate(core.Duration.minutes(5)),\n            targets=[\n                events_targets.LambdaFunction(handler=self.lambda_function)\n            ],\n        )\n\n        # TODO: refactor this to loop through CloudWatch metrics multiple celery queues\n        scope.celery_default_service.default_celery_queue_cw_metric.grant_put_metric_data(\n            scope.backend_service.backend_task.task_role\n        )\n",[20539],{"type":42,"tag":349,"props":20540,"children":20541},{"__ignoreMap":8},[20542,20575,20646,20669,20694,20701,20708,20729,20741,20753,20779,20800,20826,20843,20850,20857,20878,20889,20901,20927,20943,20969,20976,20983,20990,21007,21015,21023],{"type":42,"tag":467,"props":20543,"children":20544},{"class":469,"line":470},[20545,20549,20554,20558,20563,20567,20571],{"type":42,"tag":467,"props":20546,"children":20547},{"style":903},[20548],{"type":48,"value":1949},{"type":42,"tag":467,"props":20550,"children":20551},{"style":1952},[20552],{"type":48,"value":20553}," CeleryAutoscalingStack",{"type":42,"tag":467,"props":20555,"children":20556},{"style":480},[20557],{"type":48,"value":806},{"type":42,"tag":467,"props":20559,"children":20560},{"style":1962},[20561],{"type":48,"value":20562},"cloudformation",{"type":42,"tag":467,"props":20564,"children":20565},{"style":480},[20566],{"type":48,"value":1970},{"type":42,"tag":467,"props":20568,"children":20569},{"style":1962},[20570],{"type":48,"value":17674},{"type":42,"tag":467,"props":20572,"children":20573},{"style":480},[20574],{"type":48,"value":1508},{"type":42,"tag":467,"props":20576,"children":20577},{"class":469,"line":486},[20578,20582,20587,20591,20595,20599,20603,20608,20612,20616,20620,20624,20628,20633,20638,20642],{"type":42,"tag":467,"props":20579,"children":20580},{"style":903},[20581],{"type":48,"value":1988},{"type":42,"tag":467,"props":20583,"children":20584},{"style":798},[20585],{"type":48,"value":20586}," __init__",{"type":42,"tag":467,"props":20588,"children":20589},{"style":480},[20590],{"type":48,"value":806},{"type":42,"tag":467,"props":20592,"children":20593},{"style":2001},[20594],{"type":48,"value":2004},{"type":42,"tag":467,"props":20596,"children":20597},{"style":480},[20598],{"type":48,"value":935},{"type":42,"tag":467,"props":20600,"children":20601},{"style":2001},[20602],{"type":48,"value":8814},{"type":42,"tag":467,"props":20604,"children":20605},{"style":480},[20606],{"type":48,"value":20607},": core.Construct, ",{"type":42,"tag":467,"props":20609,"children":20610},{"style":2001},[20611],{"type":48,"value":7918},{"type":42,"tag":467,"props":20613,"children":20614},{"style":480},[20615],{"type":48,"value":3668},{"type":42,"tag":467,"props":20617,"children":20618},{"style":809},[20619],{"type":48,"value":812},{"type":42,"tag":467,"props":20621,"children":20622},{"style":480},[20623],{"type":48,"value":935},{"type":42,"tag":467,"props":20625,"children":20626},{"style":474},[20627],{"type":48,"value":1595},{"type":42,"tag":467,"props":20629,"children":20630},{"style":2001},[20631],{"type":48,"value":20632},"kwargs",{"type":42,"tag":467,"props":20634,"children":20635},{"style":480},[20636],{"type":48,"value":20637},") -> ",{"type":42,"tag":467,"props":20639,"children":20640},{"style":588},[20641],{"type":48,"value":1548},{"type":42,"tag":467,"props":20643,"children":20644},{"style":480},[20645],{"type":48,"value":3693},{"type":42,"tag":467,"props":20647,"children":20648},{"class":469,"line":499},[20649,20654,20659,20664],{"type":42,"tag":467,"props":20650,"children":20651},{"style":809},[20652],{"type":48,"value":20653},"        super",{"type":42,"tag":467,"props":20655,"children":20656},{"style":480},[20657],{"type":48,"value":20658},"().",{"type":42,"tag":467,"props":20660,"children":20661},{"style":798},[20662],{"type":48,"value":20663},"__init__",{"type":42,"tag":467,"props":20665,"children":20666},{"style":480},[20667],{"type":48,"value":20668},"(\n",{"type":42,"tag":467,"props":20670,"children":20671},{"class":469,"line":522},[20672,20677,20681,20685,20689],{"type":42,"tag":467,"props":20673,"children":20674},{"style":480},[20675],{"type":48,"value":20676},"            scope, ",{"type":42,"tag":467,"props":20678,"children":20679},{"style":798},[20680],{"type":48,"value":7918},{"type":42,"tag":467,"props":20682,"children":20683},{"style":480},[20684],{"type":48,"value":935},{"type":42,"tag":467,"props":20686,"children":20687},{"style":474},[20688],{"type":48,"value":1595},{"type":42,"tag":467,"props":20690,"children":20691},{"style":480},[20692],{"type":48,"value":20693},"kwargs,\n",{"type":42,"tag":467,"props":20695,"children":20696},{"class":469,"line":531},[20697],{"type":42,"tag":467,"props":20698,"children":20699},{"style":480},[20700],{"type":48,"value":18639},{"type":42,"tag":467,"props":20702,"children":20703},{"class":469,"line":550},[20704],{"type":42,"tag":467,"props":20705,"children":20706},{"emptyLinePlaceholder":37},[20707],{"type":48,"value":528},{"type":42,"tag":467,"props":20709,"children":20710},{"class":469,"line":575},[20711,20715,20720,20724],{"type":42,"tag":467,"props":20712,"children":20713},{"style":2067},[20714],{"type":48,"value":18569},{"type":42,"tag":467,"props":20716,"children":20717},{"style":480},[20718],{"type":48,"value":20719},".lambda_function ",{"type":42,"tag":467,"props":20721,"children":20722},{"style":474},[20723],{"type":48,"value":542},{"type":42,"tag":467,"props":20725,"children":20726},{"style":480},[20727],{"type":48,"value":20728}," aws_lambda.Function(\n",{"type":42,"tag":467,"props":20730,"children":20731},{"class":469,"line":598},[20732,20737],{"type":42,"tag":467,"props":20733,"children":20734},{"style":2067},[20735],{"type":48,"value":20736},"            self",{"type":42,"tag":467,"props":20738,"children":20739},{"style":480},[20740],{"type":48,"value":572},{"type":42,"tag":467,"props":20742,"children":20743},{"class":469,"line":616},[20744,20749],{"type":42,"tag":467,"props":20745,"children":20746},{"style":564},[20747],{"type":48,"value":20748},"            \"CeleryMetricsLambdaFunction\"",{"type":42,"tag":467,"props":20750,"children":20751},{"style":480},[20752],{"type":48,"value":572},{"type":42,"tag":467,"props":20754,"children":20755},{"class":469,"line":625},[20756,20761,20765,20770,20775],{"type":42,"tag":467,"props":20757,"children":20758},{"style":554},[20759],{"type":48,"value":20760},"            code",{"type":42,"tag":467,"props":20762,"children":20763},{"style":474},[20764],{"type":48,"value":542},{"type":42,"tag":467,"props":20766,"children":20767},{"style":480},[20768],{"type":48,"value":20769},"aws_lambda.Code.asset(",{"type":42,"tag":467,"props":20771,"children":20772},{"style":564},[20773],{"type":48,"value":20774},"\"awslambda\"",{"type":42,"tag":467,"props":20776,"children":20777},{"style":480},[20778],{"type":48,"value":13703},{"type":42,"tag":467,"props":20780,"children":20781},{"class":469,"line":633},[20782,20787,20791,20796],{"type":42,"tag":467,"props":20783,"children":20784},{"style":554},[20785],{"type":48,"value":20786},"            handler",{"type":42,"tag":467,"props":20788,"children":20789},{"style":474},[20790],{"type":48,"value":542},{"type":42,"tag":467,"props":20792,"children":20793},{"style":564},[20794],{"type":48,"value":20795},"\"publish_celery_metrics.lambda_handler\"",{"type":42,"tag":467,"props":20797,"children":20798},{"style":480},[20799],{"type":48,"value":572},{"type":42,"tag":467,"props":20801,"children":20802},{"class":469,"line":664},[20803,20808,20812,20817,20822],{"type":42,"tag":467,"props":20804,"children":20805},{"style":554},[20806],{"type":48,"value":20807},"            runtime",{"type":42,"tag":467,"props":20809,"children":20810},{"style":474},[20811],{"type":48,"value":542},{"type":42,"tag":467,"props":20813,"children":20814},{"style":480},[20815],{"type":48,"value":20816},"aws_lambda.Runtime.",{"type":42,"tag":467,"props":20818,"children":20819},{"style":588},[20820],{"type":48,"value":20821},"PYTHON_3_7",{"type":42,"tag":467,"props":20823,"children":20824},{"style":480},[20825],{"type":48,"value":572},{"type":42,"tag":467,"props":20827,"children":20828},{"class":469,"line":672},[20829,20834,20838],{"type":42,"tag":467,"props":20830,"children":20831},{"style":554},[20832],{"type":48,"value":20833},"            environment",{"type":42,"tag":467,"props":20835,"children":20836},{"style":474},[20837],{"type":48,"value":542},{"type":42,"tag":467,"props":20839,"children":20840},{"style":480},[20841],{"type":48,"value":20842},"scope.variables.regular_variables,\n",{"type":42,"tag":467,"props":20844,"children":20845},{"class":469,"line":690},[20846],{"type":42,"tag":467,"props":20847,"children":20848},{"style":480},[20849],{"type":48,"value":18639},{"type":42,"tag":467,"props":20851,"children":20852},{"class":469,"line":1336},[20853],{"type":42,"tag":467,"props":20854,"children":20855},{"emptyLinePlaceholder":37},[20856],{"type":48,"value":528},{"type":42,"tag":467,"props":20858,"children":20859},{"class":469,"line":1344},[20860,20864,20869,20873],{"type":42,"tag":467,"props":20861,"children":20862},{"style":2067},[20863],{"type":48,"value":18569},{"type":42,"tag":467,"props":20865,"children":20866},{"style":480},[20867],{"type":48,"value":20868},".celery_default_cw_metric_schedule ",{"type":42,"tag":467,"props":20870,"children":20871},{"style":474},[20872],{"type":48,"value":542},{"type":42,"tag":467,"props":20874,"children":20875},{"style":480},[20876],{"type":48,"value":20877}," events.Rule(\n",{"type":42,"tag":467,"props":20879,"children":20880},{"class":469,"line":1362},[20881,20885],{"type":42,"tag":467,"props":20882,"children":20883},{"style":2067},[20884],{"type":48,"value":20736},{"type":42,"tag":467,"props":20886,"children":20887},{"style":480},[20888],{"type":48,"value":572},{"type":42,"tag":467,"props":20890,"children":20891},{"class":469,"line":1380},[20892,20897],{"type":42,"tag":467,"props":20893,"children":20894},{"style":564},[20895],{"type":48,"value":20896},"            \"CeleryDefaultCWMetricSchedule\"",{"type":42,"tag":467,"props":20898,"children":20899},{"style":480},[20900],{"type":48,"value":572},{"type":42,"tag":467,"props":20902,"children":20903},{"class":469,"line":1388},[20904,20909,20913,20918,20922],{"type":42,"tag":467,"props":20905,"children":20906},{"style":554},[20907],{"type":48,"value":20908},"            schedule",{"type":42,"tag":467,"props":20910,"children":20911},{"style":474},[20912],{"type":48,"value":542},{"type":42,"tag":467,"props":20914,"children":20915},{"style":480},[20916],{"type":48,"value":20917},"events.Schedule.rate(core.Duration.minutes(",{"type":42,"tag":467,"props":20919,"children":20920},{"style":588},[20921],{"type":48,"value":1059},{"type":42,"tag":467,"props":20923,"children":20924},{"style":480},[20925],{"type":48,"value":20926},")),\n",{"type":42,"tag":467,"props":20928,"children":20929},{"class":469,"line":1423},[20930,20935,20939],{"type":42,"tag":467,"props":20931,"children":20932},{"style":554},[20933],{"type":48,"value":20934},"            targets",{"type":42,"tag":467,"props":20936,"children":20937},{"style":474},[20938],{"type":48,"value":542},{"type":42,"tag":467,"props":20940,"children":20941},{"style":480},[20942],{"type":48,"value":19985},{"type":42,"tag":467,"props":20944,"children":20945},{"class":469,"line":1441},[20946,20951,20956,20960,20964],{"type":42,"tag":467,"props":20947,"children":20948},{"style":480},[20949],{"type":48,"value":20950},"                events_targets.LambdaFunction(",{"type":42,"tag":467,"props":20952,"children":20953},{"style":554},[20954],{"type":48,"value":20955},"handler",{"type":42,"tag":467,"props":20957,"children":20958},{"style":474},[20959],{"type":48,"value":542},{"type":42,"tag":467,"props":20961,"children":20962},{"style":2067},[20963],{"type":48,"value":2004},{"type":42,"tag":467,"props":20965,"children":20966},{"style":480},[20967],{"type":48,"value":20968},".lambda_function)\n",{"type":42,"tag":467,"props":20970,"children":20971},{"class":469,"line":1449},[20972],{"type":42,"tag":467,"props":20973,"children":20974},{"style":480},[20975],{"type":48,"value":20075},{"type":42,"tag":467,"props":20977,"children":20978},{"class":469,"line":1458},[20979],{"type":42,"tag":467,"props":20980,"children":20981},{"style":480},[20982],{"type":48,"value":18639},{"type":42,"tag":467,"props":20984,"children":20985},{"class":469,"line":1476},[20986],{"type":42,"tag":467,"props":20987,"children":20988},{"emptyLinePlaceholder":37},[20989],{"type":48,"value":528},{"type":42,"tag":467,"props":20991,"children":20992},{"class":469,"line":1511},[20993,20998,21002],{"type":42,"tag":467,"props":20994,"children":20995},{"style":1176},[20996],{"type":48,"value":20997},"        # ",{"type":42,"tag":467,"props":20999,"children":21000},{"style":474},[21001],{"type":48,"value":11035},{"type":42,"tag":467,"props":21003,"children":21004},{"style":1176},[21005],{"type":48,"value":21006},": refactor this to loop through CloudWatch metrics multiple celery queues\n",{"type":42,"tag":467,"props":21008,"children":21009},{"class":469,"line":1519},[21010],{"type":42,"tag":467,"props":21011,"children":21012},{"style":480},[21013],{"type":48,"value":21014},"        scope.celery_default_service.default_celery_queue_cw_metric.grant_put_metric_data(\n",{"type":42,"tag":467,"props":21016,"children":21017},{"class":469,"line":1528},[21018],{"type":42,"tag":467,"props":21019,"children":21020},{"style":480},[21021],{"type":48,"value":21022},"            scope.backend_service.backend_task.task_role\n",{"type":42,"tag":467,"props":21024,"children":21025},{"class":469,"line":1575},[21026],{"type":42,"tag":467,"props":21027,"children":21028},{"style":480},[21029],{"type":48,"value":18639},{"type":42,"tag":112,"props":21031,"children":21033},{"id":21032},"miscellaneous-grievances",[21034],{"type":48,"value":21035},"Miscellaneous Grievances",{"type":42,"tag":57,"props":21037,"children":21038},{},[21039,21044,21057],{"type":42,"tag":61,"props":21040,"children":21041},{},[21042],{"type":48,"value":21043},"Fargate tasks cannot access Secrets that use JSON template",{"type":42,"tag":61,"props":21045,"children":21046},{},[21047,21049,21055],{"type":48,"value":21048},"You cannot select ",{"type":42,"tag":349,"props":21050,"children":21052},{"className":21051},[],[21053],{"type":48,"value":21054},"FARGATE_SPOT",{"type":48,"value":21056}," on a CDK-created ECS cluster. This option seems to only be available from the ECS Wizard in the AWS Console",{"type":42,"tag":61,"props":21058,"children":21059},{},[21060,21062,21068],{"type":48,"value":21061},"It's not super clear how to package dependencies in Lambda with CDK. Here's an interesting approach that I would like to try: ",{"type":42,"tag":138,"props":21063,"children":21066},{"href":21064,"rel":21065},"https://github.com/aws-samples/aws-cdk-examples/issues/130#issuecomment-554097487",[142],[21067],{"type":48,"value":21064},{"type":48,"value":21069},". The Lambda functions I'm using don't require anything outside of the standard library, but if they did it would require some additional work to make sure dependencies can be added as Lambda Layers.",{"type":42,"tag":112,"props":21071,"children":21072},{"id":11032},[21073],{"type":48,"value":11035},{"type":42,"tag":57,"props":21075,"children":21076},{},[21077,21082,21087,21092],{"type":42,"tag":61,"props":21078,"children":21079},{},[21080],{"type":48,"value":21081},"Create an IAM role template that can be used to create an IAM role that has access to setup infrastructure through CDK. Currently I'm using an admin account which is not a best practice.",{"type":42,"tag":61,"props":21083,"children":21084},{},[21085],{"type":48,"value":21086},"Move this Wiki Article to the project documentation site and main README",{"type":42,"tag":61,"props":21088,"children":21089},{},[21090],{"type":48,"value":21091},"Expand on each topic, replace existing documentation",{"type":42,"tag":61,"props":21093,"children":21094},{},[21095,21097,21102],{"type":48,"value":21096},"Add a summary of each ",{"type":42,"tag":349,"props":21098,"children":21100},{"className":21099},[],[21101],{"type":48,"value":17674},{"type":48,"value":21103}," from CDK code",{"type":42,"tag":3468,"props":21105,"children":21106},{},[21107],{"type":48,"value":3472},{"title":8,"searchDepth":486,"depth":486,"links":21109},[21110,21111,21123,21137,21144,21145,21146],{"id":15628,"depth":486,"text":15631},{"id":15711,"depth":486,"text":15714,"children":21112},[21113,21114,21115,21116,21117,21118,21119,21120,21121,21122],{"id":5609,"depth":499,"text":5612},{"id":15896,"depth":499,"text":15899},{"id":15940,"depth":499,"text":15943},{"id":15987,"depth":499,"text":15611},{"id":16088,"depth":499,"text":16091},{"id":16168,"depth":499,"text":16171},{"id":16211,"depth":499,"text":16214},{"id":16403,"depth":499,"text":16406},{"id":16499,"depth":499,"text":15664},{"id":16550,"depth":499,"text":16553},{"id":16629,"depth":486,"text":16632,"children":21124},[21125,21127,21128,21130,21132,21134,21135],{"id":16640,"depth":499,"text":21126},"Start here: https://cdkworkshop.com",{"id":16657,"depth":499,"text":16660},{"id":17581,"depth":499,"text":21129},"Using cdk synth in development",{"id":17667,"depth":499,"text":21131},"NestedStacks",{"id":17798,"depth":499,"text":21133},"cdk deploy and CDK in GitLab CI pipelines",{"id":18259,"depth":499,"text":18266},{"id":18700,"depth":499,"text":21136},"Quick tour of ApplicationStack",{"id":19337,"depth":486,"text":21138,"children":21139},"Why X? Why not Y?",[21140,21141,21142,21143],{"id":19364,"depth":499,"text":19367},{"id":19421,"depth":499,"text":19424},{"id":19432,"depth":499,"text":19435},{"id":19486,"depth":499,"text":19489},{"id":19497,"depth":486,"text":19500},{"id":21032,"depth":486,"text":21035},{"id":11032,"depth":486,"text":11035},"content:2020:06:02:django-postgres-vue-gitlab-ecs.md","2020/06/02/django-postgres-vue-gitlab-ecs.md","2020/06/02/django-postgres-vue-gitlab-ecs",{"_path":21151,"_dir":11060,"_draft":7,"_partial":7,"_locale":8,"title":21152,"description":21153,"layout":8366,"date":21154,"comments":37,"image":21155,"tags":21156,"body":21157,"_type":3490,"_id":21250,"_source":3492,"_file":21251,"_stem":21252,"_extension":3495},"/2019/01/09/django-docker-vue-nginx-drf-traefik-celery","Setup, Development and Deployment of a web app using Django, VueJS, VuePress, Docker, nginx, traefik and GitLab","This project is currently deployed on https://verbose-equals-true.tk. The source code is available at https://gitlab.com/briancaffey/verbose-equals-true.","2019-01-09T00:00:00.000Z","/static/technologies.png",[5369,25,7534,8140],{"type":39,"children":21158,"toc":21248},[21159,21179,21184,21224,21229,21236],{"type":42,"tag":51,"props":21160,"children":21161},{},[21162,21164,21170,21172,21178],{"type":48,"value":21163},"This project is currently deployed on ",{"type":42,"tag":138,"props":21165,"children":21168},{"href":21166,"rel":21167},"https://verbose-equals-true.tk",[142],[21169],{"type":48,"value":21166},{"type":48,"value":21171},". The source code is available at ",{"type":42,"tag":138,"props":21173,"children":21176},{"href":21174,"rel":21175},"https://gitlab.com/briancaffey/verbose-equals-true",[142],[21177],{"type":48,"value":21174},{"type":48,"value":1970},{"type":42,"tag":51,"props":21180,"children":21181},{},[21182],{"type":48,"value":21183},"The goal of this project is to explain how to setup a project starting with a fresh installation of 16.04. Setup includes local development environment, GitLab CI/CD, VSCode settings and configuration of the different containers that make up the application:",{"type":42,"tag":57,"props":21185,"children":21186},{},[21187,21191,21196,21200,21204,21209,21214,21219],{"type":42,"tag":61,"props":21188,"children":21189},{},[21190],{"type":48,"value":15591},{"type":42,"tag":61,"props":21192,"children":21193},{},[21194],{"type":48,"value":21195},"Node (for local development with VueJS)",{"type":42,"tag":61,"props":21197,"children":21198},{},[21199],{"type":48,"value":11069},{"type":42,"tag":61,"props":21201,"children":21202},{},[21203],{"type":48,"value":14673},{"type":42,"tag":61,"props":21205,"children":21206},{},[21207],{"type":48,"value":21208},"Postgres",{"type":42,"tag":61,"props":21210,"children":21211},{},[21212],{"type":48,"value":21213},"Celery",{"type":42,"tag":61,"props":21215,"children":21216},{},[21217],{"type":48,"value":21218},"flower",{"type":42,"tag":61,"props":21220,"children":21221},{},[21222],{"type":48,"value":21223},"portainer",{"type":42,"tag":51,"props":21225,"children":21226},{},[21227],{"type":48,"value":21228},"Here's an overview of the architecture used in the application:",{"type":42,"tag":51,"props":21230,"children":21231},{},[21232],{"type":42,"tag":127,"props":21233,"children":21235},{"alt":5444,"src":21234},"/static/architecture.png",[],{"type":42,"tag":51,"props":21237,"children":21238},{},[21239,21241,21247],{"type":48,"value":21240},"Extensive documentation for this project can be found at ",{"type":42,"tag":138,"props":21242,"children":21245},{"href":21243,"rel":21244},"https://verbose-equals-true.tk/docs",[142],[21246],{"type":48,"value":21243},{"type":48,"value":1970},{"title":8,"searchDepth":486,"depth":486,"links":21249},[],"content:2019:01:09:django-docker-vue-nginx-drf-traefik-celery.md","2019/01/09/django-docker-vue-nginx-drf-traefik-celery.md","2019/01/09/django-docker-vue-nginx-drf-traefik-celery",1723432995287]