<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Display, filter and export geographical data in a Django app with Leaflet, Mapbox, DataTables, Bootstrap 4 and Travis-CI</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Brian Caffey's personal website"><meta data-n-head="ssr" name="robots" content="all"><meta data-n-head="ssr" property="og:title" content="Display, filter and export geographical data in a Django app with Leaflet, Mapbox, DataTables, Bootstrap 4 and Travis-CI"><meta data-n-head="ssr" property="og:description" content="undefined"><meta data-n-head="ssr" property="og:image" content="https://briancaffey.github.io/static/map_homepage.png"><meta data-n-head="ssr" property="twitter:card" content="https://briancaffey.github.io/static/map_homepage.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><script data-n-head="ssr" data-hid="adsbygoogle-script" defer crossorigin="anonymous" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4924597640144289"></script><script data-n-head="ssr" data-hid="adsbygoogle">window.__abg_called||((adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0,(window.adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-4924597640144289",enable_page_level_ads:!1,overlays:{bottom:!1}}),window.__abg_called=!0)</script><link rel="preload" href="/_nuxt/688b6c2.js" as="script"><link rel="preload" href="/_nuxt/9ee0ef6.js" as="script"><link rel="preload" href="/_nuxt/f51c3d4.js" as="script"><link rel="preload" href="/_nuxt/d4698ff.js" as="script"><link rel="preload" href="/_nuxt/9d8324e.js" as="script"><style data-vue-ssr-id="38dfa7e4:0 f52d43e0:0 9592d830:0 517a8dd7:0 072b2f8a:0 fa7ff0ca:0 56b15182:0 5a4b6265:0 14b1eaf9:0 a0fa61ae:0 7f6c3ed0:0 68771c59:0 5586ddaf:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-black{--bg-opacity:1;background-color:#000;background-color:rgba(0,0,0,var(--bg-opacity))}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-red-300{--bg-opacity:1;background-color:#feb2b2;background-color:rgba(254,178,178,var(--bg-opacity))}.border-white{--border-opacity:1;border-color:#fff;border-color:rgba(255,255,255,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t{border-top-left-radius:.25rem;border-top-right-radius:.25rem}.border{border-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.float-right{float:right}.font-bold{font-weight:700}.h-3{height:.75rem}.h-4{height:1rem}.h-12{height:3rem}.h-32{height:8rem}.h-64{height:16rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.text-4xl{font-size:2.25rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.m-2{margin:.5rem}.m-4{margin:1rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.-ml-1{margin-left:-.25rem}.max-w-5xl{max-width:64rem}.max-w-6xl{max-width:72rem}.object-cover{-o-object-fit:cover;object-fit:cover}.p-3{padding:.75rem}.p-4{padding:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.py-32{padding-top:8rem;padding-bottom:8rem}.pt-2{padding-top:.5rem}.pt-4{padding-top:1rem}.pr-4{padding-right:1rem}.pb-4{padding-bottom:1rem}.pt-8{padding-top:2rem}.pb-8{padding-bottom:2rem}.pt-16{padding-top:4rem}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.resize{resize:both}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.fill-current{fill:currentColor}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-black{--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.text-gray-500{--text-opacity:1;color:#a0aec0;color:rgba(160,174,192,var(--text-opacity))}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-red-400{--text-opacity:1;color:#fc8181;color:rgba(252,129,129,var(--text-opacity))}.text-red-600{--text-opacity:1;color:#e53e3e;color:rgba(229,62,62,var(--text-opacity))}.uppercase{text-transform:uppercase}.visible{visibility:visible}.w-3{width:.75rem}.w-4{width:1rem}.w-12{width:3rem}.w-32{width:8rem}.w-full{width:100%}.z-10{z-index:10}.gap-4{grid-gap:1rem;gap:1rem}.gap-6{grid-gap:1.5rem;gap:1.5rem}.gap-8{grid-gap:2rem;gap:2rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition-all{transition-property:all}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform}.duration-150{transition-duration:.15s}.delay-150{transition-delay:.15s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:640px){.sm\:inline{display:inline}.sm\:hidden{display:none}.sm\:p-16{padding:4rem}.sm\:px-4{padding-left:1rem;padding-right:1rem}.sm\:w-2\/3{width:66.666667%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:768px){.md\:flex{display:flex}.md\:hidden{display:none}.md\:px-1{padding-left:.25rem;padding-right:.25rem}.md\:px-4{padding-left:1rem;padding-right:1rem}.md\:w-1\/2{width:50%}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (min-width:1024px){.lg\:px-16{padding-left:4rem;padding-right:4rem}.lg\:px-32{padding-left:8rem;padding-right:8rem}.lg\:pl-64{padding-left:16rem}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:1280px){.xl\:pb-16{padding-bottom:4rem}}:root{--color:#243746;--color-primary:#158876;--color-secondary:#0e2233;--bg:#f3f5f4;--bg-secondary:#fff;--bg-code:#ddd;--border-color:#ddd}.dark-mode{--color:#ebf4f1;--color-primary:#41b38a;--color-secondary:#fdf9f3;--bg:#091a28;--bg-secondary:#071521;--bg-code:#ddd;--border-color:#0d2538}.sepia-mode{--color:#433422;--color-primary:#504231;--color-secondary:#504231;--bg:#f1e7d0;--bg-code:#ddd;--bg-secondary:#eae0c9;--border-color:#ded0bf}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;background-color:#f3f5f4;background-color:var(--bg);color:#243746;color:var(--color);transition:background-color .7s}a{color:#158876;color:var(--color-primary)}.py-05{padding-top:.125rem;padding-bottom:.125rem}.markdown{--text-opacity:1;color:#1a202c;color:rgba(26,32,44,var(--text-opacity));line-height:1.5;color:#0e2233;color:var(--color-secondary)}.markdown .token.operator{background:0 0}.markdown>*+*{margin-top:0;margin-bottom:1rem}.markdown li+li{margin-top:.25rem}.markdown li>p+p{margin-top:1.5rem;color:#158876;color:var(--color-primary)}.markdown img{margin:auto}.markdown a,.markdown strong{font-weight:600}.markdown strong a{font-weight:700}.markdown h1{font-size:2.25rem}.markdown h1,.markdown h2{border-color:#158876;border-color:var(--color-primary);line-height:1.25;border-bottom-width:1px;font-weight:600;margin-bottom:1rem;margin-top:1.5rem;padding-bottom:.5rem}.markdown h2{font-size:1.5rem}.markdown h3{line-height:1.375;font-size:1.125rem}.markdown h3,.markdown h4{border-color:#158876;border-color:var(--color-primary);font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown h4{line-height:1;font-size:1rem}.markdown h5{border-color:#158876;border-color:var(--color-primary)}.markdown h5,.markdown h6{line-height:1.25;font-size:.875rem;font-weight:600;margin-bottom:1rem;margin-top:1.5rem}.markdown blockquote,.markdown h6{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.markdown blockquote{font-size:1rem;border-left-width:4px;--border-opacity:1;border-color:#e2e8f0;border-color:rgba(226,232,240,var(--border-opacity));padding-left:1rem;padding-right:1rem;border-color:#158876;border-color:var(--color-primary)}.markdown code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.875rem;display:inline;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity));padding:.125rem .25rem;background-color:#ddd;background-color:var(--bg-code);color:#000}.markdown code,.markdown pre{--bg-opacity:1;border-radius:.25rem}.markdown pre{background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity));padding:1rem}.markdown pre code{display:block;background-color:transparent;padding:0;overflow:visible;border-radius:0;color:#000}.markdown p{margin-bottom:10px}code[class*=language-],pre[class*=language-]{background:#ddd!important;background:var(--bg-code)!important;text-shadow:none!important}.markdown ul{list-style-type:disc}.markdown ol,.markdown ul{font-size:1rem;padding-left:2rem}.markdown ol{list-style-type:decimal}.markdown kbd{font-size:.75rem;display:inline-block;border-radius:.25rem;border-width:1px;padding:.125rem .25rem;vertical-align:middle;font-weight:400;font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.markdown table,td,th{font-size:1rem;border:1px solid #243746;border-color:var(--color)}.markdown table{overflow-x:scroll}.markdown td,.markdown th{border-width:1px;padding:.25rem .75rem}.markdown .highlight pre{--bg-opacity:1!important;background-color:#f7fafc!important;background-color:rgba(247,250,252,var(--bg-opacity))!important}.article-card{box-shadow:0 5px 10px 0 #0e2233;box-shadow:0 5px 10px 0 var(--color-secondary);transition:box-shadow .2s,transform .2s;height:100%}.article-card:hover{box-shadow:0 10px 40px 0 #0e2233;box-shadow:0 10px 40px 0 var(--color-secondary);transform:scale(1.025)}.blog-card-description,.blog-date{color:#0e2233;color:var(--color-secondary)}.blog-date{font-style:italic}hr{background-color:#243746;background-color:var(--color);border:none;height:1px}.menu-icon{background-color:#ddd;background-color:var(--border-color)}.menu-icon,.mobile-menu{color:#243746;color:var(--color)}.mobile-menu{background-color:#fff;background-color:var(--bg-secondary)}.btn{border-radius:1;border-color:#158876;border-color:var(--color-primary)}.btn:hover{background-color:#fff;background-color:var(--bg-secondary)}.hero{border-color:#158876;border-color:var(--color-primary)}.markdown{word-wrap:break-word}.markdown h2:before,.markdown h3:before{content:" ";margin-top:-85px;pointer-events:none}.markdown h2>a,.markdown h3>a{margin-left:1.25rem}.markdown h2>a:before,.markdown h3>a:before{content:"#";font-weight:400;font-size:1.25rem;line-height:2rem;margin-left:-1.25rem;padding-right:.5rem;position:absolute;opacity:1}@media (min-width:1024px){.markdown h2>a,.markdown h3>a{margin-left:0}.markdown h2>a:before,.markdown h3>a:before{opacity:0}}.markdown h2:hover>a:before,.markdown h3:hover>a:before{opacity:1}& pre[class*=language-]{--bg-opacity:1;background-color:#2d3748;background-color:rgba(45,55,72,var(--bg-opacity));position:static}.mc{background-color:#f3f5f4;background-color:var(--bg);border-color:#158876;border-color:var(--color-primary);border-width:1px;color:#158876;color:var(--color-primary);justify-content:center;padding:5px 10px;border-radius:5px;width:100%}.mc-btn{color:#fff;color:var(--bg-secondary);background-color:#0e2233;background-color:var(--color-secondary);cursor:pointer}.page-enter-active,.page-leave-active{transition:filter 2s linear;transition:margin-top .15s,opacity .15s}.page-enter,.page-leave-to{opacity:0;margin-top:5px}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.emoji-mart,.emoji-mart *{-webkit-box-sizing:border-box;box-sizing:border-box;line-height:1.15}.emoji-mart{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;font-size:16px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;height:420px;color:#222427;border:1px solid #d9d9d9;border-radius:5px;background:#fff}.emoji-mart-emoji{padding:6px;border:none;background:0 0;-webkit-box-shadow:none;box-shadow:none}.emoji-mart-emoji span{display:inline-block}.emoji-mart-preview-emoji .emoji-mart-emoji span{width:38px;height:38px;font-size:32px}.emoji-type-native{font-family:"Segoe UI Emoji","Segoe UI Symbol","Segoe UI","Apple Color Emoji","Twemoji Mozilla","Noto Color Emoji","EmojiOne Color","Android Emoji";word-break:keep-all}.emoji-type-image{background-size:5700%}.emoji-type-image.emoji-set-apple{background-image:url(https://unpkg.com/emoji-datasource-apple@6.0.1/img/apple/sheets-256/64.png)}.emoji-type-image.emoji-set-facebook{background-image:url(https://unpkg.com/emoji-datasource-facebook@6.0.1/img/facebook/sheets-256/64.png)}.emoji-type-image.emoji-set-google{background-image:url(https://unpkg.com/emoji-datasource-google@6.0.1/img/google/sheets-256/64.png)}.emoji-type-image.emoji-set-twitter{background-image:url(https://unpkg.com/emoji-datasource-twitter@6.0.1/img/twitter/sheets-256/64.png)}.emoji-mart-bar{border:0 solid #d9d9d9}.emoji-mart-bar:first-child{border-bottom-width:1px;border-top-left-radius:5px;border-top-right-radius:5px}.emoji-mart-bar:last-child{border-top-width:1px;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.emoji-mart-scroll{position:relative;overflow-y:scroll;-webkit-box-flex:1;-ms-flex:1;flex:1;padding:0 6px 6px;z-index:0;will-change:transform;-webkit-overflow-scrolling:touch}.emoji-mart-anchors{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding:0 6px;color:#858585;line-height:0}.emoji-mart-anchor{position:relative;display:block;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;text-align:center;padding:12px 4px;overflow:hidden;-webkit-transition:color .1s ease-out;-o-transition:color .1s ease-out;transition:color .1s ease-out;border:none;background:0 0;-webkit-box-shadow:none;box-shadow:none}.emoji-mart-anchor-selected,.emoji-mart-anchor:hover{color:#464646}.emoji-mart-anchor-selected .emoji-mart-anchor-bar{bottom:0}.emoji-mart-anchor-bar{position:absolute;bottom:-3px;left:0;width:100%;height:3px;background-color:#464646}.emoji-mart-anchors i{display:inline-block;width:100%;max-width:22px}.emoji-mart-anchors svg{fill:currentColor;max-height:18px}.emoji-mart .scroller{height:250px;position:relative;-webkit-box-flex:1;-ms-flex:1;flex:1;padding:0 6px 6px;z-index:0;will-change:transform;-webkit-overflow-scrolling:touch}.emoji-mart-search{margin-top:6px;padding:0 6px}.emoji-mart-search input{font-size:16px;display:block;width:100%;padding:.2em .6em;border-radius:25px;border:1px solid #d9d9d9;outline:0}.emoji-mart-search-results{height:250px;overflow-y:scroll}.emoji-mart-category{position:relative}.emoji-mart-category .emoji-mart-emoji span{z-index:1;position:relative;text-align:center;cursor:default}.emoji-mart-category .emoji-mart-emoji:hover:before,.emoji-mart-emoji-selected:before{z-index:0;content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#f4f4f4;border-radius:100%;opacity:0;opacity:1}.emoji-mart-category-label{position:-webkit-sticky;position:sticky;top:0}.emoji-mart-static .emoji-mart-category-label{z-index:2;position:relative}.emoji-mart-category-label h3{display:block;font-size:16px;width:100%;font-weight:500;padding:5px 6px;background-color:#fff;background-color:hsla(0,0%,100%,.95)}.emoji-mart-emoji{position:relative;display:inline-block;font-size:0}.emoji-mart-no-results{font-size:14px;text-align:center;padding-top:70px;color:#858585}.emoji-mart-no-results .emoji-mart-category-label{display:none}.emoji-mart-no-results .emoji-mart-no-results-label{margin-top:.2em}.emoji-mart-no-results .emoji-mart-emoji:hover:before{content:none}.emoji-mart-preview{position:relative;height:70px}.emoji-mart-preview-data,.emoji-mart-preview-emoji,.emoji-mart-preview-skins{position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%)}.emoji-mart-preview-emoji{left:12px}.emoji-mart-preview-data{left:68px;right:12px;word-break:break-all}.emoji-mart-preview-skins{right:30px;text-align:right}.emoji-mart-preview-name{font-size:14px}.emoji-mart-preview-shortname{font-size:12px;color:#888}.emoji-mart-preview-emoticon+.emoji-mart-preview-emoticon,.emoji-mart-preview-shortname+.emoji-mart-preview-emoticon,.emoji-mart-preview-shortname+.emoji-mart-preview-shortname{margin-left:.5em}.emoji-mart-preview-emoticon{font-size:11px;color:#bbb}.emoji-mart-title span{display:inline-block;vertical-align:middle}.emoji-mart-title .emoji-mart-emoji{padding:0}.emoji-mart-title-label{color:#999a9c;font-size:21px;font-weight:300}.emoji-mart-skin-swatches{font-size:0;padding:2px 0;border:1px solid #d9d9d9;border-radius:12px;background-color:#fff}.emoji-mart-skin-swatches-opened .emoji-mart-skin-swatch{width:16px;padding:0 2px}.emoji-mart-skin-swatches-opened .emoji-mart-skin-swatch-selected:after{opacity:.75}.emoji-mart-skin-swatch{display:inline-block;width:0;vertical-align:middle;-webkit-transition-property:width,padding;-o-transition-property:width,padding;transition-property:width,padding;-webkit-transition-duration:.125s;-o-transition-duration:.125s;transition-duration:.125s;-webkit-transition-timing-function:ease-out;-o-transition-timing-function:ease-out;transition-timing-function:ease-out}.emoji-mart-skin-swatch:first-child{-webkit-transition-delay:0s;-o-transition-delay:0s;transition-delay:0s}.emoji-mart-skin-swatch:nth-child(2){-webkit-transition-delay:.03s;-o-transition-delay:.03s;transition-delay:.03s}.emoji-mart-skin-swatch:nth-child(3){-webkit-transition-delay:.06s;-o-transition-delay:.06s;transition-delay:.06s}.emoji-mart-skin-swatch:nth-child(4){-webkit-transition-delay:.09s;-o-transition-delay:.09s;transition-delay:.09s}.emoji-mart-skin-swatch:nth-child(5){-webkit-transition-delay:.12s;-o-transition-delay:.12s;transition-delay:.12s}.emoji-mart-skin-swatch:nth-child(6){-webkit-transition-delay:.15s;-o-transition-delay:.15s;transition-delay:.15s}.emoji-mart-skin-swatch-selected{position:relative;width:16px;padding:0 2px}.emoji-mart-skin-swatch-selected:after{content:"";position:absolute;top:50%;left:50%;width:4px;height:4px;margin:-2px 0 0 -2px;background-color:#fff;border-radius:100%;pointer-events:none;opacity:0;-webkit-transition:opacity .2s ease-out;-o-transition:opacity .2s ease-out;transition:opacity .2s ease-out}.emoji-mart-skin{display:inline-block;width:100%;padding-top:100%;max-width:12px;border-radius:100%}.emoji-mart-skin-tone-1{background-color:#ffc93a}.emoji-mart-skin-tone-2{background-color:#fadcbc}.emoji-mart-skin-tone-3{background-color:#e0bb95}.emoji-mart-skin-tone-4{background-color:#bf8f68}.emoji-mart-skin-tone-5{background-color:#9b643d}.emoji-mart-skin-tone-6{background-color:#594539}.emoji-mart .vue-recycle-scroller{position:relative}.emoji-mart .vue-recycle-scroller.direction-vertical:not(.page-mode){overflow-y:auto}.emoji-mart .vue-recycle-scroller.direction-horizontal:not(.page-mode){overflow-x:auto}.emoji-mart .vue-recycle-scroller.direction-horizontal{display:-webkit-box;display:-ms-flexbox;display:flex}.emoji-mart .vue-recycle-scroller__slot{-webkit-box-flex:1;-ms-flex:auto 0 0px;flex:auto 0 0}.emoji-mart .vue-recycle-scroller__item-wrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;position:relative}.emoji-mart .vue-recycle-scroller.ready .vue-recycle-scroller__item-view{position:absolute;top:0;left:0;will-change:transform}.emoji-mart .vue-recycle-scroller.direction-vertical .vue-recycle-scroller__item-wrapper{width:100%}.emoji-mart .vue-recycle-scroller.direction-horizontal .vue-recycle-scroller__item-wrapper{height:100%}.emoji-mart .vue-recycle-scroller.ready.direction-vertical .vue-recycle-scroller__item-view{width:100%}.emoji-mart .vue-recycle-scroller.ready.direction-horizontal .vue-recycle-scroller__item-view{height:100%}.emoji-mart .resize-observer[data-v-b329ee4c]{border:none;background-color:transparent;opacity:0}.emoji-mart .resize-observer[data-v-b329ee4c],.emoji-mart .resize-observer[data-v-b329ee4c] object{position:absolute;top:0;left:0;z-index:-1;width:100%;height:100%;pointer-events:none;display:block;overflow:hidden}.emoji-mart-search .hidden{display:none;visibility:hidden}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}span.emoji-mart-emoji[data-v-3f691362]{padding:0}.selected[data-v-3f691362]{text-shadow:.25px 0 0 #000}.picker[data-v-3f691362]{position:absolute;top:10px;margin-left:auto;margin-right:auto;transform:translate(50%,50%)}.top[data-v-3f691362]{width:100%;background-color:var(--color-primary);height:3px}.selected[data-v-107ae01e]{text-shadow:.9px 0 0}span.emoji-mart-emoji[data-v-288717a6]{padding:0;transition:transform .2s}span.emoji-mart-emoji[data-v-288717a6]:hover{transform:scale(1.3)}.centered[data-v-288717a6]{position:absolute;left:50vw;right:50vw;margin-left:auto;margin-right:auto}span.emoji-mart-emoji[data-v-4f7c5820]{padding:0}.modal[data-v-4f7c5820]{z-index:100000000;top:0;-webkit-backdrop-filter:blur(.4px);backdrop-filter:blur(.4px);background-color:rgba(0,0,0,.2)}.modal[data-v-4f7c5820],.picker[data-v-4f7c5820]{position:absolute;left:0}.picker[data-v-4f7c5820]{z-index:10000000000;right:0;margin-left:auto;margin-right:auto}.tag[data-v-3fbcd028]{background-color:var(--color-primary);transition:transform .2s}.tag[data-v-3fbcd028]:hover{transform:scale(1.05)}</style><link rel="preload" href="/_nuxt/static/1682886979/2018/02/19/leaflet-maps-with-django.html/state.js" as="script"><link rel="preload" href="/_nuxt/static/1682886979/2018/02/19/leaflet-maps-with-django.html/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1682886979/manifest.js" as="script">
  </head>
  <body>
    <script data-n-head="ssr" data-hid="nuxt-color-mode-script" data-pbody="true">!function(){"use strict";var t=window,r=document,s=r.documentElement,n=["dark","light"],e=function(){for(var e="nuxt-color-mode=",t=r.cookie.split(";"),s=0;s<t.length;s++){for(var n=t[s];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null}()||"system",a="system"===e?l():e;function c(e){e+="-mode";s.classList?s.classList.add(e):s.className+=" "+e}function o(e){return t.matchMedia("(prefers-color-scheme"+e+")")}function l(){if(t.matchMedia&&"not all"!==o("").media)for(var e of n)if(o(":"+e).matches)return e;return"light"}c(a),t.__NUXT_COLOR_MODE__={preference:e,value:a,getColorScheme:l,addClass:c,removeClass:function(e){e+="-mode";s.classList?s.classList.remove(e):s.className=s.className.replace(new RegExp(e,"g"),"")}}}()</script><div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div data-v-3f691362><div class="top" data-v-3f691362></div> <div class="mx-auto flex py-2 px-2 sm:px-4 items-center max-w-6xl justify-center" data-v-3f691362><div class="justify-left flex-grow flex-cols-4" data-v-3f691362><a href="/" class="text-xl nuxt-link-active" data-v-3f691362><span class="hidden sm:inline text-2xl" data-v-3f691362>Brian Caffey</span><span class="inline sm:hidden" data-v-3f691362>JBC</span></a></div> <div class="flex-grow relative" data-v-3f691362><nav z-index="10000" data-v-107ae01e data-v-3f691362><div data-v-107ae01e><ul class="items-right float-right hidden md:flex" data-v-107ae01e><li class="px-4 text-lg" data-v-107ae01e><a href="/blog/1" data-v-107ae01e>
          Blog
        </a></li> <li class="px-4 text-lg" data-v-107ae01e><a href="/projects" data-v-107ae01e>
          Projects
        </a></li> <li class="px-4 text-lg" data-v-107ae01e><a href="/contact" data-v-107ae01e>
          Contact
        </a></li></ul> <div class="flex justify-end md:hidden z-1000" data-v-107ae01e><button class="flex items-center px-3 py-2 border rounded menu-icon" data-v-107ae01e><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="fill-current h-3 w-3" data-v-107ae01e><title data-v-107ae01e>Menu</title> <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" data-v-107ae01e></path></svg></button></div> <!----></div></nav></div></div> <div class="picker" data-v-3f691362><div class="centered" data-v-288717a6 data-v-3f691362><div class="grid items-center justify-center" data-v-288717a6><ul class="flex px-4" data-v-288717a6><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="🖥️, desktop_computer" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:52.63% 12.28%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="🌞, sun_with_face" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:8.77% 77.19%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="🌚, new_moon_with_face" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:8.77% 70.18%;width:32px;height:32px"></span></span></li><li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><span aria-label="☕, coffee" class="emoji-mart-emoji" data-v-288717a6><span class="emoji-set-apple emoji-type-image" style="background-position:94.74% 8.77%;width:32px;height:32px"></span></span></li> <li class="md:px-1 px-1 cursor-pointer" data-v-288717a6><div data-v-4f7c5820 data-v-288717a6><!----> <ul data-v-4f7c5820><li class="md:px-1 px-1 cursor-pointer" data-v-4f7c5820><span aria-label="🇺🇸, us, flag-us" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:7.02% 68.42%;width:32px;height:32px"></span></span></li></ul> <div class="rounded-md z-10 picker" data-v-4f7c5820><div class="bg-white shadow-md rounded px-4 py-2 w-32 text" style="display:none" data-v-4f7c5820><a href="/2018/02/19/leaflet-maps-with-django.html" aria-current="page" class="nuxt-link-exact-active nuxt-link-active" data-v-4f7c5820><span aria-label="🇺🇸, us, flag-us" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:7.02% 68.42%;width:16px;height:16px"></span></span> English <br data-v-4f7c5820></a><a href="/fr/2018/02/19/leaflet-maps-with-django.html" data-v-4f7c5820><span aria-label="🇫🇷, fr, flag-fr" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:1.75% 91.23%;width:16px;height:16px"></span></span> Français <br data-v-4f7c5820></a><a href="/zh/2018/02/19/leaflet-maps-with-django.html" data-v-4f7c5820><span aria-label="🇨🇳, cn, flag-cn" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:1.75% 36.84%;width:16px;height:16px"></span></span> 简体中文 <br data-v-4f7c5820></a><a href="/ru/2018/02/19/leaflet-maps-with-django.html" data-v-4f7c5820><span aria-label="🇷🇺, ru, flag-ru" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:5.26% 92.98%;width:16px;height:16px"></span></span> Русский <br data-v-4f7c5820></a><a href="/jp/2018/02/19/leaflet-maps-with-django.html" data-v-4f7c5820><span aria-label="🇯🇵, jp, flag-jp" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:3.51% 59.65%;width:16px;height:16px"></span></span> 日本語 <br data-v-4f7c5820></a><a href="/in/2018/02/19/leaflet-maps-with-django.html" data-v-4f7c5820><span aria-label="🇮🇳, flag-in" class="emoji-mart-emoji" data-v-4f7c5820><span class="emoji-set-apple emoji-type-image" style="background-position:3.51% 43.86%;width:16px;height:16px"></span></span> हिंदी <br data-v-4f7c5820></a></div></div></div></li></ul></div></div></div></div> <article data-v-07b74c72><img src="/static/map_homepage.png" class="pt-2 w-full object-cover cover-image" style="height:24rem" data-v-07b74c72> <div class="mx-auto max-w-5xl px-2 sm:px-4 md:px-4 lg:px-16 mt-2" data-v-07b74c72><h1 class="prose text-4xl leading-9 py-4 font-bold" data-v-07b74c72>
      Display, filter and export geographical data in a Django app with Leaflet, Mapbox, DataTables, Bootstrap 4 and Travis-CI
    </h1> <div class="flex flex-wrap -ml-1 py-2" data-v-21780fb6 data-v-07b74c72><a href="/blog/tags/leaflet" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    leaflet 🏷️
    <!----></div></a><a href="/blog/tags/django" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    django 🏷️
    <!----></div></a><a href="/blog/tags/mapbox" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    mapbox 🏷️
    <!----></div></a><a href="/blog/tags/data-tables" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    data-tables 🏷️
    <!----></div></a><a href="/blog/tags/bootstrap" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    bootstrap 🏷️
    <!----></div></a><a href="/blog/tags/travis-ci" data-v-3fbcd028 data-v-21780fb6><div class="px-2 text-lg text-white shadow rounded-lg bg-black mx-1 mt-1 uppercase cursor-pointer tag" data-v-3fbcd028>
    travis-ci 🏷️
    <!----></div></a></div> <!----> <p class="blog-date text-gray-500 mb-4" data-v-07b74c72>
      Last Updated on
      February 19, 2018
    </p> <!----> <div class="markdown nuxt-content" data-v-07b74c72 data-v-07b74c72><p data-v-07b74c72 data-v-07b74c72><img alt="png" src="/static/map_entire.png" data-v-07b74c72 data-v-07b74c72></p>
<h3 id="live-demo-on-digitalocean" data-v-07b74c72 data-v-07b74c72><a href="#live-demo-on-digitalocean" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a><a href="http://159.89.235.193/books/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Live Demo on DigitalOcean</a></h3>
<p data-v-07b74c72 data-v-07b74c72>This post is a review of my first attempt at using geographical data in a Django project. I have been interested in working with map APIs, and I once looked into the Google Maps API. For this project I chose to use <a href="http://leafletjs.com/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Leaflet</a>:</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>an open-source JavaScript library for mobile-friendly interactive maps</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>Getting started with Leaflet is easy. All you need to do is request a public Mapbox API key which is free (with no credit card required). You can get a key from <a href="https://www.mapbox.com/account/access-tokens/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>https://www.mapbox.com/account/access-tokens/</a>.</p>
<p data-v-07b74c72 data-v-07b74c72>Then you will follow steps on the <a href="http://leafletjs.com/examples/quick-start/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>quickstart guide</a> and replace <code data-v-07b74c72 data-v-07b74c72>your.mapbox.access.token</code> with your Mapbox API key.</p>
<p data-v-07b74c72 data-v-07b74c72>{% raw %}</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-javascript" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token constant" data-v-07b74c72 data-v-07b74c72>L</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>tileLayer</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
  <span class="token string" data-v-07b74c72 data-v-07b74c72>'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    attribution<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span>
      <span class="token string" data-v-07b74c72 data-v-07b74c72>'Map data &ampcopy; &lt;a href="http://openstreetmap.org">OpenStreetMap&lt;/a> contributors, &lt;a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA&lt;/a>, Imagery © &lt;a href="http://mapbox.com">Mapbox&lt;/a>'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    maxZoom<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>18</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    id<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'mapbox.streets'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    accessToken<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'your.mapbox.access.token'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addTo</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>mymap<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>{% endraw %}</p>
<p data-v-07b74c72 data-v-07b74c72>I'll come back to using Leaflet later on, and also show how to use Leaflet plugins that can be used to add functionality such as aggregating markers on a map.</p>
<h2 id="django-model" data-v-07b74c72 data-v-07b74c72><a href="#django-model" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Django model</h2>
<p data-v-07b74c72 data-v-07b74c72>Next, let's look at the Django setup. For now I'm simply working with a local project and SQLite3 backend.</p>
<p data-v-07b74c72 data-v-07b74c72>To store latitude and longitude data, we can use <code data-v-07b74c72 data-v-07b74c72>DecimalField</code>:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>class</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>Book</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Model<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    title <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>CharField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>max_length<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>300</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    lat <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>DecimalField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>max_digits<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>9</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> decimal_places<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    lon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>DecimalField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>max_digits<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>9</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> decimal_places<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>6</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This allows us to store numbers to six decimal places. The difference between 0 and 0.00001 is about 3 feet, so this gives us plenty of accuracy for our geographical coordinate data.</p>
<h2 id="plotting-books-on-a-map" data-v-07b74c72 data-v-07b74c72><a href="#plotting-books-on-a-map" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Plotting books on a map</h2>
<p data-v-07b74c72 data-v-07b74c72>Plotting our books on a map is fairly straightforward, but there were a few obstacles to work around. Initially I setup an additional endpoint that returned an AJAX response with the longitude, latitude, title and link for each book. The <code data-v-07b74c72 data-v-07b74c72>success</code> function in the AJAX call then passed the returned JSON into a function that populated the book data in the map.</p>
<p data-v-07b74c72 data-v-07b74c72>The main <code data-v-07b74c72 data-v-07b74c72>books</code> page displays book data in two places: on the map and on the DataTable below the map. Since I was already making one database query for DataTables, I decided to reuse this data for the map and not use a separate request and database query. There are a few helpful idioms in Python and JavaScript to accomplish this.</p>
<p data-v-07b74c72 data-v-07b74c72>First, let's look at the request with some added comments:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>all_books</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    <span class="token triple-quoted-string string" data-v-07b74c72 data-v-07b74c72>"""
    Main view for books. request.GET parameters are used to filter books
    """</span>
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>all</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    form <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> QueryForm<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET <span class="token keyword" data-v-07b74c72 data-v-07b74c72>or</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    paramDict <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET

    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> filter_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    page_count <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>aggregate<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>Sum<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'pages'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># This takes the first book query an reformats the data so it can be read</span>
    <span class="token comment" data-v-07b74c72 data-v-07b74c72># by the map script on the frontend.</span>
    map_books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'loc'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>float</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>float</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lat<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                  <span class="token string" data-v-07b74c72 data-v-07b74c72>'title'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>title<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                  <span class="token string" data-v-07b74c72 data-v-07b74c72>'url'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get_absolute_url<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> book <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
    context <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'books'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token comment" data-v-07b74c72 data-v-07b74c72># Here, we apply `json.dumps`, `escapejs` and `marksafe` for security</span>
        <span class="token comment" data-v-07b74c72 data-v-07b74c72># and proper formatting</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'map_books'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> mark_safe<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>escapejs<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>json<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>dumps<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>map_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'page_count'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>page_count<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'pages__sum'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'form'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> render<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'books/books.html'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> context<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>On the frontend, I passed the <code data-v-07b74c72 data-v-07b74c72>map_books</code> variable to the template like this:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-javascript" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> map_books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token known-class-name class-name" data-v-07b74c72 data-v-07b74c72>JSON</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>parse</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'{{ map_books }}'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Now that I have <code data-v-07b74c72 data-v-07b74c72>map_books</code> as a JavaScript object, I can simply pass it into the map function that populates data in the Leaflet map. Here's the function that does that:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-javascript" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>function</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>populateMap</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token parameter" data-v-07b74c72 data-v-07b74c72>data</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
  <span class="token keyword control-flow" data-v-07b74c72 data-v-07b74c72>for</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>i <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> title <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>title</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//value searched</span>
      loc <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>loc</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//position found</span>
      url <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>url</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
      marker <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Marker</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>latLng</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>loc<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span> title<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> title<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> icon<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> bookIcon <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//se property searched</span>
    marker<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>bindPopup</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'&lt;p>&lt;a href="'</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> url <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'">'</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> title <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'&lt;/a>&lt;/p>'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    markersLayer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addLayer</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>marker<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This adds our markers to the map, and also passes link and title data to the popup box when a marker is clicked.</p>
<p data-v-07b74c72 data-v-07b74c72>Here's the entire script that is used to populate map data:</p>
<p data-v-07b74c72 data-v-07b74c72>{% raw %}</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>script</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span><span class="token script" data-v-07b74c72 data-v-07b74c72><span class="token language-javascript" data-v-07b74c72 data-v-07b74c72>
  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> mymap <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Map</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'mapid'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span> zoom<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>9</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> center<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>latLng</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>40</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>13</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//set center from first location</span>

  <span class="token constant" data-v-07b74c72 data-v-07b74c72>L</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>tileLayer</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
    <span class="token string" data-v-07b74c72 data-v-07b74c72>'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
      attribution<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'Map data &ampcopy; &lt;a href="http://openstreetmap.org">OpenStreetMap&lt;/a> contributors, &lt;a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA&lt;/a>, Imagery © &lt;a href="http://mapbox.com">Mapbox&lt;/a>'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
      maxZoom<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>18</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
      id<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'mapbox.streets'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
      accessToken<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'pk.eyJ1IjoiYnJpYW5jYWZmZXkiLCJhIjoiY2pkczJycjl5MmhqbTMzbzQ3bHJuaHA3aiJ9.cvRYYPNjQJVpFjdUcmIHzA'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addTo</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>mymap<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> bookIcon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token constant" data-v-07b74c72 data-v-07b74c72>L</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>icon</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    iconUrl<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'/static/images/marker-icon.png'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    iconSize<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>35</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>35</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>// size of the icon</span>
    iconAnchor<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>17</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>35</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>// point of the icon which will correspond to marker's location</span>
    popupAnchor<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span><span class="token number" data-v-07b74c72 data-v-07b74c72>30</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>// point from which the popup should open relative to the iconAnchor</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> markersLayer <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token constant" data-v-07b74c72 data-v-07b74c72>L</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>markerClusterGroup</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  mymap<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addLayer</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>markersLayer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> controlSearch <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Control<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Search</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    position<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'topright'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    layer<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> markersLayer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    initial<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>false</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    zoom<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>12</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    marker<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>false</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  mymap<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addControl</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>controlSearch<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>function</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>populateMap</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token parameter" data-v-07b74c72 data-v-07b74c72>data</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
    <span class="token keyword control-flow" data-v-07b74c72 data-v-07b74c72>for</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>i <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
      <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> title <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>title</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//value searched</span>
        loc <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>loc</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//position found</span>
        url <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>i<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>url</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        marker <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Marker</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>new</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>L<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>latLng</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>loc<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
          title<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> title<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
          icon<span class="token operator" data-v-07b74c72 data-v-07b74c72>:</span> bookIcon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72>//se property searched</span>
      marker<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>bindPopup</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'&lt;p>&lt;a href="'</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> url <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'">'</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> title <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'&lt;/a>&lt;/p>'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
      markersLayer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>addLayer</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>marker<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>

  <span class="token comment" data-v-07b74c72 data-v-07b74c72>// use context variable instead of making AJAX call</span>
  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> map_books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token known-class-name class-name" data-v-07b74c72 data-v-07b74c72>JSON</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>parse</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'{{ map_books }}'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> new_lat <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> map_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>loc</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
  <span class="token keyword" data-v-07b74c72 data-v-07b74c72>var</span> new_lon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> map_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>loc</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>1</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
  mymap<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token method function property-access" data-v-07b74c72 data-v-07b74c72>setView</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
  <span class="token function" data-v-07b74c72 data-v-07b74c72>populateMap</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>map_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</span></span><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>script</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>{% endraw %}</p>
<h2 id="login-redirect" data-v-07b74c72 data-v-07b74c72><a href="#login-redirect" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Login Redirect</h2>
<p data-v-07b74c72 data-v-07b74c72>I wanted to include a small note on a simple issue that I previously had trouble with, which is using the <code data-v-07b74c72 data-v-07b74c72>next</code> parameter to do a redirect to a page that an unauthenticated user will be redirected to after they successfully login.</p>
<p data-v-07b74c72 data-v-07b74c72>Here's the login view:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>login_view</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    next_redirect <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'next'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    form <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> UserLoginForm<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>POST <span class="token keyword" data-v-07b74c72 data-v-07b74c72>or</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>is_valid<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
        next_redirect <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>POST<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'next'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        username <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>cleaned_data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'username'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        password <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>cleaned_data<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'password'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        user <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> authenticate<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>username<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>username<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> password<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>password<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        login<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> user<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>next_redirect<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> next_redirect <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'None'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> redirect<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>next_redirect<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> redirect<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'books:all'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    context <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'form'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'next'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>next_redirect <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> render<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'accounts/login_form.html'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> context<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Notice that I pass <code data-v-07b74c72 data-v-07b74c72>next</code> as a context variable. I use this in the login form here:</p>
<p data-v-07b74c72 data-v-07b74c72>{% raw %}</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>form</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>method</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>POST<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>action</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>.<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  {% csrf_token %} {{ form | crispy }}
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>input</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>hidden<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>value</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{{ next }}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>name</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>next<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>div</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>login-center<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>input</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-success login-center<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>submit<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>value</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>Login<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>div</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>br</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
  or <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>a</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>href</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{% url <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span>accounts:register<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span> %}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>create an account<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>a</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>form</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>{% endraw %}</p>
<p data-v-07b74c72 data-v-07b74c72>By passing this as a hidden value to the form, when a <code data-v-07b74c72 data-v-07b74c72>POST</code> request is made, we are redirected to the value of <code data-v-07b74c72 data-v-07b74c72>next</code> if it is not <code data-v-07b74c72 data-v-07b74c72>None</code>, or if there is no redirect.</p>
<p data-v-07b74c72 data-v-07b74c72>When a <code data-v-07b74c72 data-v-07b74c72>@login_required</code> decorator is used, and we want to access a url such as <code data-v-07b74c72 data-v-07b74c72>/books/add</code>, we are redirected to a url that looks like this:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>http://localhost:8000/accounts/login/?next=/books/new/
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>In this way we can pass the next parameter from the <code data-v-07b74c72 data-v-07b74c72>GET</code> request to the <code data-v-07b74c72 data-v-07b74c72>POST</code> request that is made when the login view is hit.</p>
<h2 id="authors" data-v-07b74c72 data-v-07b74c72><a href="#authors" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Authors</h2>
<p data-v-07b74c72 data-v-07b74c72>For illustration purposes, I included an <code data-v-07b74c72 data-v-07b74c72>Author</code> model. Since a book can have zero, one or many Authors, I used a many-to-many relationship to link authors to books. Here is how we do this in our Book model:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>class</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>Book</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Model<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>other fields<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
    authors <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> models<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>ManyToManyField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'authors.Author'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This dot notation with <code data-v-07b74c72 data-v-07b74c72>'authors.Author'</code> is important. Previously I would have just imported the <code data-v-07b74c72 data-v-07b74c72>Author</code>model and then referenced that in the ManyToManyField. However, this can lead to circular import errors which are hard to debug unless you know what a circular import is.</p>
<p data-v-07b74c72 data-v-07b74c72>Now let's look at how to find all <code data-v-07b74c72 data-v-07b74c72>Books</code> by a certain author, as well as all <code data-v-07b74c72 data-v-07b74c72>Authors</code> of a given book. Uing the Django shell, we can do the following:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> authors<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>models <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> Author
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>models <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> Book
a <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Author<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>all</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>first<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
a<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>book_set<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>values<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
<span class="token operator" data-v-07b74c72 data-v-07b74c72>&lt;</span>QuerySet <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'id'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>583</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'title'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'None Or Other'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'lat'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> Decimal<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'-118.035345'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'lon'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> Decimal<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'34.139729'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'pages'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>1881</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2018</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>18</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'website'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'https://www.fleming-mitchell.com/'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'synopsis'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'Option ever large throw dinner worker ahead realize clearly congress as smile size spend expert chair well. Brother item win follow hope coach garden later arrive who if ago voice analysis simply reflect. Amount under data drug kind book fish still information president minute stage dog. Focus full green society parent door according my management sell arrive only send international tonight. Player character financial detail oil check bring pressure possible former. Learn politics compare position large loss exactly probably approach physical international machine as model. '</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'slug'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'none-or-other'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'status'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>True</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'id'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>601</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'title'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'Teacher Them Step'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'lat'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> Decimal<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'-80.268357'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'lon'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> Decimal<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'26.661763'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'pages'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>206</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2018</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>27</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'website'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'http://www.rodriguez.net/'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'synopsis'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'Drug fact behavior environment green try account where training brother building particular window even reach. Pressure lawyer dog world thought near institution we get force market can guy receive matter structure research foot of small. Professor production very this practice car wind wish relationship after follow professor news card concern media property have. According majority owner go mention reach store computer project kitchen group quality present several another time school and will. Before during central artist page only health region happen share traditional section well out human. Mention quite short race only education heavy book up recent official here spring oil buy which language information practice. Time mother better peace girl defense rock mr never feeling tax city stock bar tv others right conference skin. '</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'slug'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'teacher-them-step'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'status'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>True</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>></span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This gave us two books by an author.</p>
<p data-v-07b74c72 data-v-07b74c72>Now, let's look at how to find all authors of a given book. For this example, we can get authors directly in the template from a book object. This example come from the <code data-v-07b74c72 data-v-07b74c72>book_detail</code> template:</p>
<p data-v-07b74c72 data-v-07b74c72>{% raw %}</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>h3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  Authors: {% for author in book.authors.all %}
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>a</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>href</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{% url <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span>authors:author_detail<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span> id=author.id %}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>{{ author.full_name }}<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>a</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  {% endfor %}
<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>h3</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>{% endraw %}</p>
<p data-v-07b74c72 data-v-07b74c72>We could just as well access <code data-v-07b74c72 data-v-07b74c72>books.authors.all</code> in the view and pass authors in a variable that we can iterate over in the template, but this keeps things simpler without much more code to write.</p>
<h2 id="filtering-data" data-v-07b74c72 data-v-07b74c72><a href="#filtering-data" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Filtering Data</h2>
<p data-v-07b74c72 data-v-07b74c72>One other question I wanted to answer with this project is how to do relatively complex data filtering. To do this, I used Django forms to create a form that calls a <code data-v-07b74c72 data-v-07b74c72>GET</code> request to the same view it came from, which is to say, a filter form on the template for the <code data-v-07b74c72 data-v-07b74c72>all</code> books view has a form action with an <code data-v-07b74c72 data-v-07b74c72>action</code> value of the url that returns the <code data-v-07b74c72 data-v-07b74c72>all</code> view.</p>
<p data-v-07b74c72 data-v-07b74c72>Here's a look at the form I put together for filtering data:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>class</span> <span class="token class-name" data-v-07b74c72 data-v-07b74c72>QueryForm</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>Form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>

    publish_date_before <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>DateField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
        label<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        required<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token boolean" data-v-07b74c72 data-v-07b74c72>False</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token comment" data-v-07b74c72 data-v-07b74c72># initial = datetime.datetime.now(),</span>
        widget <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>TextInput<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
            attrs<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'class'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'form-control'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'id'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'datepicker1'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'placeholder'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'published before'</span>
            <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    publish_date_after <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>DateField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
        label<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        required<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token boolean" data-v-07b74c72 data-v-07b74c72>False</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token comment" data-v-07b74c72 data-v-07b74c72># initial = datetime.datetime.now(),</span>
        widget <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>TextInput<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
            attrs<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'class'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'form-control'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'id'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'datepicker2'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'placeholder'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'published after'</span>
            <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    keywords <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>CharField<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
        required<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token boolean" data-v-07b74c72 data-v-07b74c72>False</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        label<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        widget<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>forms<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>TextInput<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>

            attrs<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'class'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'form-control'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
                <span class="token string" data-v-07b74c72 data-v-07b74c72>'placeholder'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'space-separated words matching title, synopsis, website or tags'</span>
            <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Here we are using three fields to filter data, a <code data-v-07b74c72 data-v-07b74c72>published_before</code> date, a <code data-v-07b74c72 data-v-07b74c72>published_after</code> date and a <code data-v-07b74c72 data-v-07b74c72>keywords</code> field.</p>
<p data-v-07b74c72 data-v-07b74c72>Filtering this data can really clog up code in <code data-v-07b74c72 data-v-07b74c72>views.py</code>, and I know I was going to need this same code again for filtering data for CSV and XLS file downloads (more on this in a minute), so I decided to wrote a utility function that takes a <code data-v-07b74c72 data-v-07b74c72>Book</code> queryset and parameter dictionary (<code data-v-07b74c72 data-v-07b74c72>request.GET</code>), and returns a filtered <code data-v-07b74c72 data-v-07b74c72>Book</code> queryset. Here's what that function looks like:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> django<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>db<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>models <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> Q
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> functools <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>reduce</span>
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>models <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> Book
<span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> datetime

<span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>filter_books</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    <span class="token comment" data-v-07b74c72 data-v-07b74c72># paramDict = request.GET</span>
    params <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>keys<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># data filtering</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>any</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>x<span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>''</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> x <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>values<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date_after'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            after_date <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date_after'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
            _after_date <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>strptime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>after_date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'%m/%d/%Y'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

            books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>filter</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>publish_date__gte<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>_after_date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date_before'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            before_date <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'publish_date_before'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
            _before_date <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>datetime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>strptime<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>before_date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'%m/%d/%Y'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
            books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>filter</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>publish_date__lte<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>_before_date<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

        <span class="token comment" data-v-07b74c72 data-v-07b74c72># filters records that contain any of the following keywords</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'keywords'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            kws <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'keywords'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>split<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
            q_lookups <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>title__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> \
                        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>synopsis__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> \
                        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>website__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
            filters <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
            filters <span class="token operator" data-v-07b74c72 data-v-07b74c72>|</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>reduce</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>lambda</span> x<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> y<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> x <span class="token operator" data-v-07b74c72 data-v-07b74c72>|</span> y<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> q_lookups<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
            books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>filter</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>filters<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> books
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This makes things much more simple in our views. Here's the code in the main <code data-v-07b74c72 data-v-07b74c72>books</code> view that uses this filter function, truncated for simplicity:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>all_books</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>all</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    form <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> QueryForm<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET <span class="token keyword" data-v-07b74c72 data-v-07b74c72>or</span> <span class="token boolean" data-v-07b74c72 data-v-07b74c72>None</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    paramDict <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> filter_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
    context <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'books'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'form'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> render<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'books/books.html'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> context<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<h2 id="exporting-data-as-csv-or-xls" data-v-07b74c72 data-v-07b74c72><a href="#exporting-data-as-csv-or-xls" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Exporting data as CSV or XLS</h2>
<p data-v-07b74c72 data-v-07b74c72>One other requirement I gave myself for this project was giving users the option to export data in CSV or XLS file formats.</p>
<p data-v-07b74c72 data-v-07b74c72>With the filter data function, I was able to keep things DRY (Don't Repeart Yourself). This task taught me about a few aspects of HTML5 and forms that I wasn't aware of. First, let's take a look at the CSV export function that I learned about throught <a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/29/how-to-export-to-excel.html" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>this blog post</a>, from a great Django blog called <a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/29/how-to-export-to-excel.html" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Simple is Better than Complex</a> by <a href="https://github.com/vitorfs" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>Vitor Freitas</a>:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>export_filtered_books_csv</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    response <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> HttpResponse<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>content_type<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'text/csv'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    response<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'Content-Disposition'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'attachment; filename="books.csv"'</span>

    writer <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> csv<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>writer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>response<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    writer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>writerow<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'Title'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'Synopsis'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'Pages'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>all</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    paramDict <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>GET
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> filter_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>values_list<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'title'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'synopsis'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'pages'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> book <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
        writer<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>writerow<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> response
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>I wanted to put this button in the filter form on the main <code data-v-07b74c72 data-v-07b74c72>books</code> page, but I need to place the button outside of the form tag. To get around this, here is the HTML I used:</p>
<p data-v-07b74c72 data-v-07b74c72>{% raw %}</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>form</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>action</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{% url <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span>books:csv<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span> %}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>a</span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-primary<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>data-toggle</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>collapse<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>href</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>#collapseExample<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>aria-expanded</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>false<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>aria-controls</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>collapseExample<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    Filter Books
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>a</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>input</span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>submit<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-info<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>form</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>id_query_form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>formaction</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{% url <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span>books:csv<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span> %}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>value</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>Export CSV<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>input</span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>submit<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-default<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>form</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>id_query_form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>formaction</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>{% url <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span>books:xls<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>'</span> %}<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
    <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>value</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>Export XLS<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>form</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>

<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>form</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>method</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>action</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>.<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>id</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>id_query_form<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>{{ form.keywords }}<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>div</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>row<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>div</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>col-md-6<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>{{ form.publish_date_before }}<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>div</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>div</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>col-md-6<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>{{ form.publish_date_after }}<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>div</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>div</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>

  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>input</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-success<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>submit<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>/></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>button</span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>reset<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-info<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span> <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>value</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>Reset filters<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
      Reset filters
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>button</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;</span>button</span>
      <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>type</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>reset<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
      <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>class</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>btn btn-warning<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
      <span class="token attr-name" data-v-07b74c72 data-v-07b74c72>id</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span>id_clear_filters<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span>
      <span class="token special-attr" data-v-07b74c72 data-v-07b74c72><span class="token attr-name" data-v-07b74c72 data-v-07b74c72>onclick</span><span class="token attr-value" data-v-07b74c72 data-v-07b74c72><span class="token punctuation attr-equals" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span><span class="token value javascript language-javascript" data-v-07b74c72 data-v-07b74c72><span class="token keyword control-flow" data-v-07b74c72 data-v-07b74c72>return</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>resetForm</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>this</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token property-access" data-v-07b74c72 data-v-07b74c72>form</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>;</span></span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>"</span></span></span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
      Clear Filters
    <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>button</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
  <span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>p</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
<span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token tag" data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>&lt;/</span>form</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>></span></span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>{% endraw %}</p>
<p data-v-07b74c72 data-v-07b74c72>There are two forms here, but the first form has an <code data-v-07b74c72 data-v-07b74c72>input</code> of <code data-v-07b74c72 data-v-07b74c72>type=submit</code> that references another form with <code data-v-07b74c72 data-v-07b74c72>form="id_query_form"</code>, and this button's action is the url for the <code data-v-07b74c72 data-v-07b74c72>export_filtered_books_csv</code> function shown above.</p>
<p data-v-07b74c72 data-v-07b74c72>For the filter function, I make a <code data-v-07b74c72 data-v-07b74c72>utils</code> folder in the app I am working with, so the directory structure looks like this (for the <code data-v-07b74c72 data-v-07b74c72>books</code> app):</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-text" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>.
├── admin.py
├── apps.py
├── forms.py
├── __init__.py
├── migrations
│   ├── 0001_initial.py
│   ├── 0002_book_authors.py
│   └── __init__.py
├── models.py
├── templates
│   └── books
├── tests.py
├── urls.py
├── utils
│   ├── filter.py
│   ├── __init__.py
│   └── nearby.py
└── views.py
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>I initially had a litte bit of confusion on how to write a simple search query. I wanted a user to be able to enter terms that would return a query set where the items in the query set contained at least on of the terms in at least on of a few different fields (<code data-v-07b74c72 data-v-07b74c72>title</code>, <code data-v-07b74c72 data-v-07b74c72>synopsis</code>, <code data-v-07b74c72 data-v-07b74c72>website</code>).</p>
<p data-v-07b74c72 data-v-07b74c72>To make this filter, I found a nice idiomatic pattern:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'keywords'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>''</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    kws <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> paramDict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token string" data-v-07b74c72 data-v-07b74c72>'keywords'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>split<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    q_lookups <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>title__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> \
                <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>synopsis__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> \
                <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>website__icontains<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>kw<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> kw <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> kws<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
    filters <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Q<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    filters <span class="token operator" data-v-07b74c72 data-v-07b74c72>|</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>reduce</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>lambda</span> x<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> y<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> x <span class="token operator" data-v-07b74c72 data-v-07b74c72>|</span> y<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> q_lookups<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>filter</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>filters<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This is good for a small database, but could end up having to do lots of operations, especially if I decided that I want to add more fields to be searched, such as category or tags.</p>
<p data-v-07b74c72 data-v-07b74c72>One option that I have considered to simplify the search query is to make one field called something like <code data-v-07b74c72 data-v-07b74c72>search_string</code>. This field would be modified on <code data-v-07b74c72 data-v-07b74c72>save</code>, and it would simply appends the text from all of the fields I'm interested in searching. Then, instead of doing Q lookups for each word over many different fields, I could search each word in <code data-v-07b74c72 data-v-07b74c72>keywords</code> over one field. I haven't implemented this here, but I would like to test this in the future.</p>
<h2 id="finding-books-nearby" data-v-07b74c72 data-v-07b74c72><a href="#finding-books-nearby" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Finding "Books Nearby"</h2>
<p data-v-07b74c72 data-v-07b74c72>On the pages that show details for each book I wanted to add additional information. I thought it would be interesting to show the 5 books closest to the book we are currently showing. Since we are dealing with coordinate points on a globe, the best way to calculate distance between two points is to use the Halversine formula:</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>The haversine formula determines the great-circle distance between two points on a sphere given their longitudes and latitudes. Important in navigation, it is a special case of a more general formula in spherical trigonometry, the law of haversines, that relates the sides and angles of spherical triangles.</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72><img alt="png" src="/static/great_circle.png" data-v-07b74c72 data-v-07b74c72></p>
<p data-v-07b74c72 data-v-07b74c72>Here's the code I used for calculating distance (using the Halversine formula):</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>from</span> math <span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> radians<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> cos<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> sin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> asin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> sqrt

<span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>distance</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>origin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> destination<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
    <span class="token triple-quoted-string string" data-v-07b74c72 data-v-07b74c72>"""
    Calculate the great circle distance between two points
    on the earth (specified in decimal degrees)
    """</span>

    lon1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat1 <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> origin
    lon2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat2 <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> destination
    <span class="token comment" data-v-07b74c72 data-v-07b74c72># convert decimal degrees to radians</span>
    lon1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lon2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat2 <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>map</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>radians<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>lon1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lon2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> lat2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    <span class="token comment" data-v-07b74c72 data-v-07b74c72># haversine formula</span>
    dlon <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> lon2 <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span> lon1
    dlat <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> lat2 <span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span> lat1
    a <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> sin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>dlat<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>**</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>+</span> cos<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>lat1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> cos<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>lat2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> sin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>dlon<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>**</span><span class="token number" data-v-07b74c72 data-v-07b74c72>2</span>
    c <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>2</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> asin<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>sqrt<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>a<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    r <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>3956</span> <span class="token comment" data-v-07b74c72 data-v-07b74c72># miles</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> c <span class="token operator" data-v-07b74c72 data-v-07b74c72>*</span> r
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>This formula assumes that the earth is a perfect sphere. Another approach would be to use the the Vincety Formula:</p>
<blockquote data-v-07b74c72 data-v-07b74c72>
<p data-v-07b74c72 data-v-07b74c72>Vincenty's formulae are two related iterative methods used in geodesy to calculate the distance between two points on the surface of a spheroid, developed by Thaddeus Vincenty (1975a). They are based on the assumption that the figure of the Earth is an oblate spheroid, and hence are more accurate than methods that assume a spherical Earth, such as great-circle distance.</p>
</blockquote>
<p data-v-07b74c72 data-v-07b74c72>This distance is packaged in <code data-v-07b74c72 data-v-07b74c72>geopy</code> and can be calculated easily:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>import</span> geopy<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>distance

coords_1 <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token number" data-v-07b74c72 data-v-07b74c72>52.2296756</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>21.0122287</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
coords_2 <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token number" data-v-07b74c72 data-v-07b74c72>52.406374</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token number" data-v-07b74c72 data-v-07b74c72>16.9251681</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

<span class="token keyword" data-v-07b74c72 data-v-07b74c72>print</span> geopy<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>distance<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>vincenty<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>coords_1<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> coords_2<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>km
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Here's a look at the function I wrote for the <code data-v-07b74c72 data-v-07b74c72>book_detail</code> view. I have commented out parts that aren't related to finding nearby books:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-python" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token keyword" data-v-07b74c72 data-v-07b74c72>def</span> <span class="token function" data-v-07b74c72 data-v-07b74c72>book_detail</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>id</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> slug<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>

    book <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>get<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>id</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>id</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> slug<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>slug<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    b_coords <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lat<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    all_books <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> Book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>objects<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span><span class="token builtin" data-v-07b74c72 data-v-07b74c72>all</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
    coords <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>b<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lat<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> b<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>lon<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>b<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span> <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> b <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> all_books<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>

    distance_dict <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>for</span> c <span class="token keyword" data-v-07b74c72 data-v-07b74c72>in</span> coords<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
        <span class="token keyword" data-v-07b74c72 data-v-07b74c72>if</span> c<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span> <span class="token operator" data-v-07b74c72 data-v-07b74c72>!=</span> b_coords<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
            distance_dict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>c<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>distance<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>c<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>b_coords<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>c<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>

    sorted_nearby <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token builtin" data-v-07b74c72 data-v-07b74c72>sorted</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>distance_dict<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>items<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> key<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token keyword" data-v-07b74c72 data-v-07b74c72>lambda</span> x<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> x<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>1</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token number" data-v-07b74c72 data-v-07b74c72>0</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span><span class="token number" data-v-07b74c72 data-v-07b74c72>5</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>

    <span class="token comment" data-v-07b74c72 data-v-07b74c72># map_book = [{'loc':[float(book.lon), float(book.lat)],</span>
    <span class="token comment" data-v-07b74c72 data-v-07b74c72>#              'title':book.title,</span>
    <span class="token comment" data-v-07b74c72 data-v-07b74c72>#              'url':book.get_absolute_url()}]</span>
    context <span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'book'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>book<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
        <span class="token comment" data-v-07b74c72 data-v-07b74c72># 'map_book':mark_safe(escapejs(json.dumps(map_book))),</span>
        <span class="token string" data-v-07b74c72 data-v-07b74c72>'sorted_nearby'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>sorted_nearby<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span>
    <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
    <span class="token keyword" data-v-07b74c72 data-v-07b74c72>return</span> render<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>(</span>request<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'books/book_detail.html'</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>,</span> context<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>)</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>To find the 5 closest books I arrived at a solution that seems fairly convoluted and should be refactored, but works! I start with a queryset of all books, then use list comprehension to make a list of tuples containing <code data-v-07b74c72 data-v-07b74c72>((&lt; longitutde >, &lt; latitude >), &lt; Book Object >)</code>. Then I loop over this list and create a dictionary where the keys are <code data-v-07b74c72 data-v-07b74c72>(&lt; longitutde >, &lt; latitude >)</code> and the values are tuples of the form: <code data-v-07b74c72 data-v-07b74c72>(&lt; distance in miles >, &lt; Book Object >)</code>. Finally, I use <code data-v-07b74c72 data-v-07b74c72>sorted</code> on <code data-v-07b74c72 data-v-07b74c72>dictionary_dict.items()</code> where the key is <code data-v-07b74c72 data-v-07b74c72>lambda x: x[1][0]</code>. The <code data-v-07b74c72 data-v-07b74c72>[1]</code> accesses the <code data-v-07b74c72 data-v-07b74c72>value</code> of the <code data-v-07b74c72 data-v-07b74c72>(&lt; key >, &lt; value>)</code> tuple returned by <code data-v-07b74c72 data-v-07b74c72>items()</code>, and the <code data-v-07b74c72 data-v-07b74c72>[0]</code> access the first item, which is the <code data-v-07b74c72 data-v-07b74c72>distance</code> value we calculated. Finally, I take the first <code data-v-07b74c72 data-v-07b74c72>[:5]</code> items of this sorted list.</p>
<p data-v-07b74c72 data-v-07b74c72>With this approach I think I avoided the possible issue of ambiguity if we have two books with the same coordinates. I'll need to add this scenario to my test suite later.</p>
<h2 id="testing--travis-ci" data-v-07b74c72 data-v-07b74c72><a href="#testing--travis-ci" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Testing & Travis CI</h2>
<p data-v-07b74c72 data-v-07b74c72>Speaking of testing, this applcation includes a simple testing suite (that I am currently working on expanding). I have also managed to setup Travis CI for this project. When I push code from my local repo to GitHub, Travis CI automatically runs test, and the commit message contains additional information about whether or not all of the tests were successful.</p>
<p data-v-07b74c72 data-v-07b74c72>Setting up Travis CI is very simple. We need to grant Travis CI (.org) access to our GitHub account, enable Travis CI on the repository we are working with, and then add a <code data-v-07b74c72 data-v-07b74c72>.travis.yml</code> file to the top level of the project directory. Here's the <code data-v-07b74c72 data-v-07b74c72>.travis.yml</code> file I have for this project:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-yml" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token key atrule" data-v-07b74c72 data-v-07b74c72>language</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> python

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>python</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span> <span class="token string" data-v-07b74c72 data-v-07b74c72>'3.5'</span>

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>services</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span> postgresql

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>env</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>DJANGO=2.0 DB=postgresql

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>install</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span> pip install <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>r requirements.txt

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>before_script</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span> psql <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>c "CREATE USER u_brian WITH PASSWORD 'password'; ALTER USER u_brian CREATEDB;" <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>U postgres

<span class="token key atrule" data-v-07b74c72 data-v-07b74c72>script</span><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>
  <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span> python manage.py test books/
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>We can generate a Travis CI badge that shows the status of the current Github deploy with the following code:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-html" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>[![Build
Status](https://travis-ci.org/briancaffey/django-leaflet-demo.svg?branch=master)](https://travis-ci.org/briancaffey/django-leaflet-demo)
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72><a href="https://travis-ci.org/briancaffey/django-leaflet-demo" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72><img alt="Build Status" src="https://travis-ci.org/briancaffey/django-leaflet-demo.svg?branch=master" data-v-07b74c72 data-v-07b74c72></a></p>
<h2 id="deploying-to-digitalocean" data-v-07b74c72 data-v-07b74c72><a href="#deploying-to-digitalocean" aria-hidden="true" tabindex="-1" data-v-07b74c72 data-v-07b74c72><span class="icon icon-link" data-v-07b74c72 data-v-07b74c72></span></a>Deploying to DigitalOcean</h2>
<p data-v-07b74c72 data-v-07b74c72>Finally, I used DigitalOcean to deploy this app. I have used Heroku for most of my previous projects, but I decided to use DigitalOcean for this one to learn something new and get more experience with using Ubuntu and related tools for running a website: nginx and gunicorn.</p>
<p data-v-07b74c72 data-v-07b74c72>Again, for I turned to Vitor's blog for a very straightforward introduction to deploying on DigitalOcean with a simple Droplet. You can read more about the instructions for deployment <a href="https://simpleisbetterthancomplex.com/tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>here</a>, and I can say that I had no problems following the instructions step by step. Here are the <code data-v-07b74c72 data-v-07b74c72>gunicorn</code> and <code data-v-07b74c72 data-v-07b74c72>nginx</code> scripts I have used to successfully deploy my project:</p>
<p data-v-07b74c72 data-v-07b74c72><em data-v-07b74c72 data-v-07b74c72>/home/brian/bin/gunicorn_start</em></p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-bash" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token shebang important" data-v-07b74c72 data-v-07b74c72>#!/bin/bash</span>

<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>NAME</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token string" data-v-07b74c72 data-v-07b74c72>"django-leaflet-demo"</span>
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>DIR</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>/home/brian/django-leaflet-demo
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72><span class="token environment constant" data-v-07b74c72 data-v-07b74c72>USER</span></span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>brian
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>GROUP</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>brian
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>WORKERS</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token number" data-v-07b74c72 data-v-07b74c72>3</span>
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>BIND</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>unix:/home/brian/run/gunicorn.sock
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>DJANGO_SETTINGS_MODULE</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>djangoapp.settings
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>DJANGO_WSGI_MODULE</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>djangoapp.wsgi
<span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>LOG_LEVEL</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>error
<span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>cd</span> <span class="token variable" data-v-07b74c72 data-v-07b74c72>$DIR</span>
<span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>source</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>..</span>/bin/activate

<span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>export</span> <span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>DJANGO_SETTINGS_MODULE</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$DJANGO_SETTINGS_MODULE</span>
<span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>export</span> <span class="token assign-left variable" data-v-07b74c72 data-v-07b74c72>PYTHONPATH</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$DIR</span><span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>:</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$PYTHONPATH</span>

<span class="token builtin class-name" data-v-07b74c72 data-v-07b74c72>exec</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>..</span>/bin/gunicorn <span class="token variable" data-v-07b74c72 data-v-07b74c72>${DJANGO_WSGI_MODULE}</span>:application <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --name<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$NAME</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --workers<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$WORKERS</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --user<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token environment constant" data-v-07b74c72 data-v-07b74c72>$USER</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --group<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$GROUP</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --bind<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$BIND</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --log-level<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token variable" data-v-07b74c72 data-v-07b74c72>$LOG_LEVEL</span> <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>\</span>
  --log-file<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span>-
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72><em data-v-07b74c72 data-v-07b74c72>/etc/nginx/sites-available</em></p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-yml" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72>upstream app_server <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
server unix<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>/home/brian/run/gunicorn.sock fail_timeout=0;
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>

server <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
listen 80;
server_name 159.89.235.193
keepalive_timeout 5;
client_max_body_size 4G;
access_log /home/brian/logs/nginx<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>access.log;
error_log /home/brian/logs/nginx<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>error.log;

location /static/ <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
alias /home/brian/static/;
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>

location / <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
try_files $uri @proxy_to_app;
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>

location @proxy_to_app <span class="token punctuation" data-v-07b74c72 data-v-07b74c72>{</span>
proxy_set_header X<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>Forwarded<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>-</span>For $proxy_add_x_forwarded_for;
proxy_set_header Host $http_host;
proxy_redirect off;
proxy_pass http<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>//app_server;
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>}</span>
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>Finally, here is the Supervisor configuration file that runs the gunicorn server:</p>
<div class="nuxt-content-highlight" data-v-07b74c72 data-v-07b74c72><pre class="line-numbers language-cs" data-v-07b74c72 data-v-07b74c72><code data-v-07b74c72 data-v-07b74c72><span class="token punctuation" data-v-07b74c72 data-v-07b74c72>[</span>program<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>:</span>django<span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span>leaflet<span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span>demo<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>]</span>
command<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>home<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>brian<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>bin<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span><span class="token class-name" data-v-07b74c72 data-v-07b74c72>gunicorn_start</span>
user<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token class-name" data-v-07b74c72 data-v-07b74c72>brian</span>
autostart<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token class-name" data-v-07b74c72 data-v-07b74c72>true</span>
autorestart<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token class-name" data-v-07b74c72 data-v-07b74c72>true</span>
redirect_stderr<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token class-name" data-v-07b74c72 data-v-07b74c72>true</span>
stdout_logfile<span class="token operator" data-v-07b74c72 data-v-07b74c72>=</span><span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>home<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>brian<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>logs<span class="token operator" data-v-07b74c72 data-v-07b74c72>/</span>gunicorn<span class="token operator" data-v-07b74c72 data-v-07b74c72>-</span>error<span class="token punctuation" data-v-07b74c72 data-v-07b74c72>.</span>log
</code></pre></div>
<p data-v-07b74c72 data-v-07b74c72>I would definitely like to dive into DigitalOcean deployment in more depth in my next post.</p>
<p data-v-07b74c72 data-v-07b74c72>For now, you can view the live project on DigitalOcean here: <a href="http://159.89.235.193/books/" rel="nofollow noopener noreferrer" target="_blank" data-v-07b74c72 data-v-07b74c72>http://159.89.235.193/books/</a>. In the future I would like to use this Droplet to do more demo apps like this one as I continue to learn the ins and outs of using Django and more frontend tools. Thanks for reading to the end and let me know if you have any comments or critiques on how I went about this project, I would be happy to hear from you!</p></div> <div class="text-center pb-4 pt-8" data-v-07b74c72><button class="mc-btn rounded py-1 px-2" data-v-07b74c72>
        Show Disqus Comments 💬
      </button></div> <!----> <h1 data-v-07b74c72></h1></div></article> <div class="mx-auto max-w-6xl p-4 lg:px-16 text-center" data-v-7b3a3fe4><hr class="mt-4" data-v-7b3a3fe4> <div class="mx-auto py-4" data-v-7b3a3fe4><div class="pb-4" data-v-7b3a3fe4>
      Join my mailing list to get updated whenever I publish a new article.
    </div> <div class="mx-auto" data-v-89248ae4 data-v-7b3a3fe4><div id="mc_embed_signup" class="mx-auto w-full md:w-1/2" data-v-89248ae4><form id="mc-embedded-subscribe-form" action="https://github.us2.list-manage.com/subscribe/post?u=43a795784ca963e25903a0da6&id=9937fe4fc5" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="validate" data-v-89248ae4><div id="mc_embed_signup_scroll" class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center" data-v-89248ae4><input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Enter your email address" class="rounded mc text-center" data-v-89248ae4> <div aria-hidden="true" style="position:absolute;left:-5000px" data-v-89248ae4><input name="b_43a795784ca963e25903a0da6_9937fe4fc5" tabindex="-1" data-v-89248ae4></div> <div data-v-89248ae4><input id="mc-embedded-subscribe" type="submit" name="subscribe" value="Subscribe" class="mc-btn rounded px-2 py-1 w-full" data-v-89248ae4></div></div></form></div></div></div> <hr data-v-7b3a3fe4> <div class="py-4" data-v-7b3a3fe4>
    Thanks for checking out my site!
  </div> <div class="pb-4" data-v-7b3a3fe4>
    © 2023 Brian Caffey
  </div></div></div></div></div><script defer src="/_nuxt/static/1682886979/2018/02/19/leaflet-maps-with-django.html/state.js"></script><script src="/_nuxt/688b6c2.js" defer></script><script src="/_nuxt/9d8324e.js" defer></script><script src="/_nuxt/9ee0ef6.js" defer></script><script src="/_nuxt/f51c3d4.js" defer></script><script src="/_nuxt/d4698ff.js" defer></script>
  </body>
</html>
